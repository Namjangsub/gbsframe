<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">    
	<meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="/static/fontawesome/css/all.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5grid.css" />
    <link rel="stylesheet" href="/static/css/ax5/ax5mask.css" />
    <link rel="stylesheet" href="/static/css/ax5/ax5modal.css" />
    <link rel="stylesheet" href="/static/css/ax5/ax5toast.css" />
    <link rel="stylesheet" href="/static/css/jstree/style.min.css" />
    <link rel="stylesheet" href="/static/css/gnb.css" />
    <link rel="stylesheet" href="/static/css/main.css" />
    <link rel="stylesheet" href="/static/mobile/css/sub.css" />
    <link rel="stylesheet" href="/static/css/common.css" />
	<link rel="stylesheet" href="/static/css/mobile.css" />

    <script src="/static/js/jquery-latest.min.js"></script>
    <script src="/static/js/jquery.serializeObject.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
    <script src="/static/js/moment/moment-with-locales.js"></script>
    <script src="/static/js/ax5/ax5core.min.js"></script>
    <script src="/static/js/ax5/ax5grid.min.js"></script>
    <script src="/static/js/ax5/ax5mask.min.js"></script>
    <script src="/static/js/ax5/ax5modal.min.js"></script>
    <script src="/static/js/ax5/ax5toast.min.js"></script>
    <script src="/static/js/jstree/jstree.min.js"></script>
    <script src="/static/js/global.js"></script>
    <script src="/static/js/fileTree.js"></script>
    <!-- 공통결재 -->
	<script src="/static/js/commApprovalMobile.js"></script>
    <style type="text/css">

	#appViewArea table tr th {
	    text-align: center;
	    width: 20%;
	    font-size: 12px;
	    font-weight: bold;
	    color: #000000;
	    border: 1px solid #e8ebf2;
	}
	#appViewArea table tr td {
	    text-align: center;
	    width: 80%;
	    font-size: 12px;
	    border: 1px solid #e8ebf2;
	}

    .table_input tr th {
	    text-align: left;
	    font-size: 10px;
	    color: #888888;
	    padding: 2px 2px;
	    border: 1px solid #e8ebf2;
	}
	
	.table_input tr td {
	    text-align: left;
	    height: 5px;
	    font-size: 12px;
	    padding: 3px 3px;
	    border: 1px solid #e8ebf2;
	    color: blue;
	    font-weight: bold;
	}
	
    </style>
</head>


<body>
	<div id="head_area" class="off">
		<div class="left_btn" onclick="history.back(-1)">
			<a class="back_btn"></a>
		</div>
		<h1 class="logo">
			<img src="/static/img/Logo_gunyangitt.gif" alt="건양ITT" />
		</h1>
	</div>
	<div id="main_area">
        <h3 id="popupTit" class="tit">WBS 실적 이슈 보기</h4>
		<div class="contents search">
            <form id="popForm">   
			    <table class="table_input">
			    	<input  type="hidden" id="coCd" name="coCd" readonly>
			    	<input  type="hidden" id="issNo" name="issNo" readonly>
					
		             <colgroup>
		                  <col width="20%">
		                  <col width="30%">
		                  <col width="20%">
		                  <col width="30%">
		             </colgroup>
	                <tr>
	                    <th colspan="4">▣ TASK 정보</th>                                                
	                </tr>
	                <tr>   
						<th>과제명</th>
						<td colspan="1"><input type="text" id="sjNm" name="sjNm" readonly></td>    
						<th >SalesCode</th>
						<td><input type="text" id="salesCd" name="salesCd" readonly></td>             
	                </tr>
	                <tr>  
						<th>과제번호</th>
						<td>
							<input type="text" id="sjNo" name="sjNo" readonly >              
               				<input type="hidden" id="verNo" name="verNo" readonly>   
						</td>       
						<th>고객사</th>
						<td>
							<input type="hidden" id="clntCd" name="clntCd" >
							<input type="text"   id="clntNm" name="clntNm" readonly >
						</td>       
	                </tr>
	                <tr>  
						<th>담당자</th>
						<td><input type="text" id="wbsPlanMngNm" name="wbsRsltsNm" readonly></td>  
						<th>고객사프로젝트</th>
						<td><input type="text"   id="clntPjtNm" name="clntPjtNm" readonly></td>            
	                </tr>
	                <tr>                         
	                     <th>TASK명</th>
	                     <td colspan="3"> <input type="text" id="wbsPlanCodeNm" name="wbsPlanCodeNm" readonly></td>                           
	                </tr>
	                <tr>
	                     <th>시작일자</th>
	                     <td><input type="text" id="wbsPlaneDt" name="wbsPlaneDt" readonly></td>                               
	                     <th>종료일자</th>
	                     <td><input type="text" id="wbsPlaneDt" name="wbsPlaneDt" readonly></td>	
	                 </tr>
					<tr>
                          <td colspan="4" bgcolor="gray" style="height:2px;"></td>                                                
                    </tr>
                    <tr>
                        <td colspan="4">▣ 이슈정보</td>                                                
                     </tr>
                    <tr>                         
                         <th>유형</th>
                         <td colspan="1"><input type="text" id="issDivNm" name="issDivNm" readonly></td>
                         <th>진행상태</th>
                         <td colspan="1"><input type="text" id="issStsNm" name="issStsNm" readonly></td>
                    </tr> 
                    <tr>                            
                         <th>제목</th>
                         <td colspan="1"><input type="text" id="issSj" name="issSj" readonly></td> 
                                                  
                         <th>요청자</th>
                         <td> 
                            <input type="text" id=creatIdNm name="id=creatIdNm" readonly>
                         </td> 
                                                      
                     </tr>
                    <tr>                            
                         <th>내용</th>
                         <td colspan="3"> 
                            <textarea id="issCnts" name="issCnts" rows="4" style="border:none; width: 100%;" readonly></textarea> 
                         </td> 
                                                      
                     </tr>
                    <tr>
                        <th>조치담당자</th>
                            <td>
                               <input type="hidden" id="actId" name="actId">
                               <input type="text" id="actNm" name="actNm" readonly>                              
                            </td>                            
                            <td colspan="2"></td>
                    </tr>
                    
                    <tr>
                      <td colspan="4" >
                              <table>
                               <tr>
                                 <td>※ 이슈정보 공유 및 결재</td>
                               </tr>
                               <tr>
                                 <td><div class="ax5_grid" data-ax5grid="first-grid-modal" data-ax5grid-config="{}" style="height: 150px; width: 100%;" ></div></td> 
                               </tr>  
                           </table>       
                      </td>                                                
                   </tr>
					<tr>
                          <td colspan="4" bgcolor="gray" style="height:2px;"></td>                                                
                    </tr>
                    <tr>
                    	<td colspan="4">▣ 조치내역</td>                                                
                    </tr>
                    <tr>
                        <th>시작일</th>
                        <td><input type="text" id="actsDt" name="actsDt" readonly></td>
                        <th>종료일</th>
                        <td><input type="text" id="acteDt" name="acteDt" readonly></td>
                    </tr> 
                    <tr>
                        <th>투입공수</th>
                        <td><input type="text" id="actMh" name="actMh" readonly></td>
                        <th>비용유형</th>
                        <td><input type="text" id="actAmtStsNm" name="actAmtStsNm" readonly></td>
                    </tr>
                    <tr>
                        <th>담당위험도평가</th>
                        <td><input type="text" id="actDngNm" name="actDngNm" readonly></td>
                        <th>발주요청번호</th>
                        <td><input type="text" id="reqNo" name="reqNo" readonly></td>
                    </tr>
                    <tr>
                        <th>팀장위험도평가</th>
                        <td><input type="text" id="actDngEvaNml" name="actDngEvalNm" readonly ></td>
                        <th></th>
                        <td></td>
                    </tr>
                    <tr>
                        <th>조치내용</th>
                        <td colspan=3><textarea id="actCnts" name="actCnts" rows="4"  style="border:none; width: 100%"></textarea></td>
                    </tr>  
                    <tr>
                      <td colspan="4" >
                           <table>
                               <tr>
                                 <td>※ 조치정보 공유 및 결재</td>
                               </tr>
                               <tr>
                                 <td><div class="ax5_grid" data-ax5grid="second-grid-modal" data-ax5grid-config="{}" style="height: 150px; width: 100%;" ></div></td> 
                               </tr>  
                           </table>    
                       </td>   
                    </tr>
                 </table> 

		    </form>                 
        </div>
	    <div class="contents search">     
	        <table class="table_input">
	            <tr>
					<!-- todo 결재 -->
					<div align="center" style="width: 100%; height: 30%;">
						<div id="wbsPopup" class="popup_area">
							<!-- 결제창 -->
							<div id="approval_area"></div>
						</div>
					</div>  
	            </tr>
	        </table>    
		</div>         
    </div>
</body>

<script type="text/javascript">

function getParams() {
	var url = window.location.search.replace('?', '');
	var params = {};
	var urlArray = url.split('&');

	for ( var i in urlArray) {
		var param = urlArray[i].split('=');
		params[param[0]] = param[1];
	}
	return params;
}

/*todo 결재*/
var btnApproval = null;
//div area id 
var htmlParam = {
	htmlArea : "approval_area"
};

//세션에 정보를 활용하여 승인처리3
//JSON.parse : JSON.stringify를 받을 때 / 문자열-> 자바스크립트로 변환
var paramObj = JSON.parse(sessionStorage.getItem('paramObj'));
//sessionStorage.removeItem('paramObj');제거??
if (paramObj && paramObj != "undefined") {
	//to-do 에서 넘어온 param;
	var popParam = paramObj;
	//추가로 넣어줄 param
	var approvalParam = {
		coCd : paramObj.coCd,
		todoDiv1CodeId : paramObj.todoDiv1CodeId,
		todoDiv2CodeId : paramObj.todoDiv2CodeId,
		pgmId : paramObj.pgmId
	};
	//삭제할 키가 있으면 쓴다.
	delete popParam.sanctnSn;
	delete popParam.pgmId;
	//결재/승인버튼 생성하기
	var commApproval = new Approval(htmlParam, approvalParam, popParam);
	commApproval.makeHtml();
} else {
	window.history.back();
}

function approvalConfirm() {
	if (commApproval.confirmApproval()) {
		window.history.back();
	}
}
/*todo 결재*/

var gridViewPop = {
        initView : function() {
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: true,
                multipleSelect: false,
                sortable: false,
                target: $('[data-ax5grid="first-grid-modal"]'),
                header: {
                    align: "center",
                    selector: true
                },
                body: {
                     onClick: function () {
                        this.self.select(this.dindex);
                    },
                    onDBLClick: function () {
                    },
                    mergeCells : ["gb"],
                },
                page : {
                    navigationItemCount : 10,
                    height : 30,
                    display : true,
                    firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
                    prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
                    nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                    lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
                    onChange : function() {
                        gridView.setData(this.page.selectPage);
                    }
                },
                columns : [
                        {key: "gb",                 label: "구분",        align: "center",   width: 40},
                        {key: "wbsPlancoCdNm",      label: "회사명",      align: "center",   width: 130, hidden: true},
                        {key: "usrNm",              label: "ID",        align: "center",   width: 130, hidden: true},
                        {key: "empNo",              label: "사원번호",  align: "center",   width: 130, hidden: true},
                        {key: "name",               label: "성명",        align: "center",   width: 80},
                        {key: "jik",                label: "직위",        align: "center",   width: 60},
                        {key: "reqDate",            label: "요청일자",  align: "center",   width: 90},
                        {key: "todoCfDt",           label: "확인일자",      align: "center",   width: 130},
                        {key: "todoCfOpn",          label: "확인의견",  align: "left",     width: 200},
                        {key: "telNo",              label: "H.P",       align: "center",   width: 130},
                      ]
                    });
                    return this;
                },

                setData : function(_pageNo) {
                    var targetObj = this.target;
                    var formData = {
                            "fileTrgtKey" :  paramObj.todoFileTrgtKey,
                            "reqNo" :  $("#popForm #issNo").val(), 
                            "flag" :  "Y1",
                            "pageNo" : _pageNo + 1
                    }
                    postAjax("/user/qm/qm01/selectShareUserlst", formData, null, function(data){    
                    var list = data.result;
                        targetObj.setData({
                            list : list,
                            page : {
                                        totalElements :  list.length,
                            } 
                        });
                    });
                }
    }
    
    
    
var gridViewPop2 = {
        initView : function() {
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: true,
                multipleSelect: false,
                sortable: false,
                target: $('[data-ax5grid="second-grid-modal"]'),
                header: {
                    align: "center",
                    selector: true
                },
                body: {
                     onClick: function () {
                        this.self.select(this.dindex);
                    },
                    onDBLClick: function () {
                    },
                    mergeCells : ["gb"],
                },
                page : {
                    navigationItemCount : 10,
                    height : 30,
                    display : true,
                    firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
                    prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
                    nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                    lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
                    onChange : function() {
                        gridView.setData(this.page.selectPage);
                    }
                },
                columns : [
                        {key: "gb",                 label: "구분",        align: "center",   width: 40},
                        {key: "wbsPlancoCdNm",      label: "회사명",      align: "center",   width: 130, hidden: true},
                        //{key: "wbsSharngUserId",  label: "ID",        align: "center",   width: 130, hidden: false},
                        {key: "usrNm",              label: "ID",        align: "center",   width: 130, hidden: true},
                        {key: "empNo",              label: "사원번호",  align: "center",   width: 130, hidden: true},
                        {key: "name",               label: "성명",        align: "center",   width: 80},
                        {key: "jik",                label: "직위",        align: "center",   width: 60},
                        {key: "reqDate",            label: "요청일자",  align: "center",   width: 90},
                        {key: "todoCfDt",           label: "확인일자",      align: "center",   width: 130},
                        {key: "todoCfOpn",          label: "확인의견",  align: "left",     width: 200},
                        {key: "telNo",              label: "H.P",       align: "center",   width: 130},
                      ]
                    });
                    return this;
                },

                setData : function(_pageNo) {
                    var targetObj = this.target;
                    var formData = {
                            "fileTrgtKey" : paramObj.todoFileTrgtKey,
                            "reqNo" :  $("#popForm #issNo").val(), 
                            "flag" :  "Y2",
                            "pageNo" : _pageNo + 1
                    }
                    postAjax("/user/qm/qm01/selectShareUserlst", formData, null, function(data){    
                    var list = data.result;
                        targetObj.setData({
                            list : list,
                            page : {
                                        totalElements :  list.length,
                            } 
                        });
                    });
                }
    }    

$(document).ready(function() {
	const params = getParams();

	var formData1 = {
		"fileTrgtKey" : paramObj.todoFileTrgtKey
	}

	   postAjaxSync("/user/wb/wb24/selectTodoRsltsView", paramObj, null, function(data){
	       var list = data.result[0];
	       if (list != undefined) {
	           $.each(list, function (key, val) {
	               $("#popForm #" + key).val(val);
	               if ($('#popForm #' + key).is('[comma]')) {
	                   onlyNumber($('#popForm #' + key)[0]);
	               }
	           });  
	           if (paramObj.todoDiv2CodeId == 'TODODIV1030' || paramObj.todoDiv2CodeId == 'TODODIV2060') {
	        	   $("#popupTit").text('WBS이슈 등록 [' + list.salesCd + ', ' + list.clntPjtNm + ']');
	           } else {
	        	   $("#popupTit").text('WBS조치 결과 [' + list.salesCd + ', ' + list.clntPjtNm + ']');
	           }
	                    
	       }
	   }); 

	gridViewPop.initView().setData(0);
	gridViewPop2.initView().setData(0);
	  
});


</script>

</html>