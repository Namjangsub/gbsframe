<!DOCTYPE html>
<html lang="ko">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, minimum-scale=1">
<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
<!-- <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css"> -->
<!-- <link rel="stylesheet" href="/static/bootstrap/css/dashboard.css"> -->
<!-- <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css"> -->
<!-- <link rel="stylesheet" href="/static/fontawesome/css/all.css"> -->
<link rel="stylesheet" href="/static/css/ax5/ax5grid.css" />
<!-- <link rel="stylesheet" href="/static/css/ax5/ax5mask.css" /> -->
<!-- <link rel="stylesheet" href="/static/css/ax5/ax5modal.css" /> -->
<!-- <link rel="stylesheet" href="/static/css/ax5/ax5toast.css" /> -->
<!-- <link rel="stylesheet" href="/static/css/jstree/style.min.css" /> -->
<link rel="stylesheet" href="/static/css/gnb.css" />
<link rel="stylesheet" href="/static/css/main.css" />
<link rel="stylesheet" href="/static/mobile/css/sub.css" />
<link rel="stylesheet" href="/static/css/common.css" />
<link rel="stylesheet" href="/static/css/mobile.css" />

<script src="/static/js/jquery-latest.min.js"></script>
<script src="/static/js/jquery.serializeObject.js"></script>
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<!-- <script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script> -->
<!-- <script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script> -->
<script src="/static/js/moment/moment-with-locales.js"></script>
<script src="/static/js/ax5/ax5core.min.js"></script>
<script src="/static/js/ax5/ax5grid.min.js"></script>
<!-- <script src="/static/js/ax5/ax5mask.min.js"></script> -->
<!-- <script src="/static/js/ax5/ax5modal.min.js"></script> -->
<!-- <script src="/static/js/ax5/ax5toast.min.js"></script> -->
<!-- <script src="/static/js/jstree/jstree.min.js"></script> -->
<script src="/static/js/global.js"></script>
<!-- <script src="/static/js/fileTree.js"></script> -->
<!-- 공통결재 -->
<script src="/static/js/commApprovalMobile.js"></script>
<style type="text/css">

	#appViewArea table tr th {
	    text-align: center;
	    width: 20%;
	    font-size: 12px;
	    font-weight: bold;
	    color: #000000;
	    border: 1px solid #e8ebf2;
	}
	#appViewArea table tr td {
	    text-align: center;
	    width: 80%;
	    font-size: 12px;
	    border: 1px solid #e8ebf2;
	}

    .table_input th {
	    text-align: left;
	    font-size: 10px;
	    color: #888888;
	    padding: 3px 3px;
	    border: 1px solid #e8ebf2;
	}
	
	.table_input td {
	    text-align: left;
	    height: 5px;
	    font-size: 10px;
	    padding: 3px 3px;
	    border: 1px solid #e8ebf2;
	    color: blue;
	    font-weight: bold;
	}
	
</style>
</head>

<body>
	<div id="head_area" class="off">
		<div class="left_btn" onclick="history.back(-1)">
			<a class="back_btn"></a>
		</div>
		<h1 class="logo">
			<img src="/static/img/Logo_gunyangitt.gif" alt="건양ITT" />
		</h1>
	</div>
	<div id="main_area">
		<div class="contents_tit">
			<span style="height: 20px; line-height: 20px; font-size: 17px; margin-left: 15px; font-weight: bold;">요인별 발주 및 출장 요청 결재</span>
		</div>
		<div class="contents search">
			<div class="popup_table" id="appViewArea"></div>
			<br>
			<form id="mForm">
				<input type="hidden" id="pgmId" name="pgmId" value="QM0101P01_M">
				<table class="table_input">
		             <colgroup>
		                  <col width="16%">
		                  <col width="34%">
		                  <col width="16%">
		                  <col width="34%">
		             </colgroup>
					<tr>
						<th>회사</th>
						<td><input type="text" id="coNm" name="coNm" readonly></td>
						<th>발행일자</th>
						<td><input class="input" type="text" id="ordrgDt" name="ordrgDt" readonly></td>
					</tr>
					<tr>
						<th>발행자</th>
						<td><input class="input" type="text" id="ordrgNm" data-search="ordrgNm" readonly ></td>
						<th>접수자</th>
						<td><input class="input" type="text" id="regNm" data-search="regNm" readonly></td>
					</tr>
					<tr>
						<th>SalesCode</th>
						<td colspan="3"><input class="input" type="text" id="salesCd" name="salesCd" readonly></td>
					</tr>
					<tr>
						<th>고객사</th>
						<td><input class="input" type="text" id="clntNm" name="clntNm" readonly></td>
						<th>고객사PJT</th>
						<td><input class="input" type="text" id="clntPjtNm" name="clntPjtNm" readonly ></td>
					</tr>
					<tr>
						<th>신작구분</th>
						<td ><input class="input" type="text" id="newCd" name="newCd" readonly></td>
						<th>요청구분</th>
						<td ><input class="input" type="text" id="reqCdNm" name="reqCdNm" readonly></td>
					</tr>
					<tr>
						<th>요구일정</th>
						<td ><input class="input" type="text" id="reqDt" name="reqDt" readonly></td>
						<th>수주번호</th>
						<td><input class="input" type="text" id="ordrsNo" name="ordrsNo" readonly></td>
					</tr>
					<tr>
						<th>프로젝트명</th>
						<td colspan="3"><input class="input" type="text" id="projNm" name="projNm" readonly></td>
					</tr>
					<tr>
						<th>출장자명</th>
                        <td colspan="3"><input class="input"  type="text" id="bustNm" name="bustNm" readonly></td>
					</tr>
					<tr>
						<th>사내작업</th>
						<td colspan="3"><input class="input" type="text" id="inwkCdNm" name="inwkCdNm" readonly></td>
					</tr>
					<tr>
						<th>출장장소</th>
						<td colspan="3"><input class="input" type="text" id="bustPe" name="bustPe" readonly></td>
					</tr>
					<tr>
						<th>분류</th>
						<td colspan="3"><input class="input" type="text" id="partCdNm" name="partCdNm" readonly></td>
					</tr>
					<tr>
						<th>소속부서</th>
						<td colspan="3"><input class="input" type="text" id="deptNm" name="deptNm" readonly></td>
					</tr>
					<tr>
						<th>중분류</th>
						<td colspan="3"><input class="input" type="text" id="midNm" name="midNm" readonly></td>
					</tr>
					<tr>
						<th>비고</th>
						<td colspan="3"><input class="input" type="text" id="reqRmk" name="reqRmk" readonly></td>
					</tr>
					<tr>
						<th>결재일자</th>
						<td colspan="3"><input class="input" type="text" id="todoCfDt" name="todoCfDt" readonly></td>
					</tr>
				</table>
				
			</form>

		</div>
	    <div class="contents search">     
	        <table class="table_input">
	            <tr>
					<!-- todo 결재 -->
					<div align="center" style="width: 100%; height: 30%;">
						<div id="wbsPopup" class="popup_area">
							<!-- 결제창 -->
							<div id="approval_area"></div>
						</div>
					</div>  
	            </tr>
	        </table>    
		</div>         
	</div>
</body>

<script type="text/javascript">
	var todoFileTrgtKey = null;
	var sanctnSn = null;
	var coCd = null;
	var salesCd = null;
	var todoDiv1CodeId = "TODODIV20";
	var todoDiv2CodeId = "TODODIV2020";

	function getParams() {
		var url = window.location.search.replace('?', '');
		var params = {};
		var urlArray = url.split('&');

		for ( var i in urlArray) {
			var param = urlArray[i].split('=');
			params[param[0]] = param[1];
		}
		return params;
	}
	
	/*todo 결재*/
	var btnApproval = null;
	//div area id 
	var htmlParam = {
		htmlArea : "approval_area"
	};

	//세션에 정보를 활용하여 승인처리3
	//JSON.parse : JSON.stringify를 받을 때 / 문자열-> 자바스크립트로 변환
	var paramObj = JSON.parse(sessionStorage.getItem('paramObj'));
	//sessionStorage.removeItem('paramObj');제거??
	if (paramObj && paramObj != "undefined") {
		//to-do 에서 넘어온 param;
		var popParam = paramObj;
		//추가로 넣어줄 param
		var approvalParam = {
			coCd : paramObj.coCd,
			todoDiv1CodeId : paramObj.todoDiv1CodeId,
			todoDiv2CodeId : paramObj.todoDiv2CodeId,
			pgmId : paramObj.pgmId
		};
		//삭제할 키가 있으면 쓴다.
		delete popParam.sanctnSn;
		delete popParam.pgmId;
		var commApproval = new Approval(htmlParam, approvalParam, popParam);
		commApproval.makeHtml();
	} else {
		window.history.back();
	}

	/*todo 결재*/
	
	$(document).ready(function() {
				const params = getParams();
				var today = new Date();
				var strDate = today.getFullYear() + "-"
						+ ('0' + (today.getMonth() + 1)).slice(-2) + "-"
						+ ('0' + today.getDate()).slice(-2);
				$('#todoCfDt').val(strDate);

				var formData1 = {
					"fileTrgtKey" : paramObj.todoFileTrgtKey
				}
				postAjaxSync("/user/qm/qm01/selectQtyReqInfo", paramObj, null,
						function(data) {
							$.each(data.result, function(key, value) {
								if (key == "coCd") {
									coCd = value;
								} else if (key == "salesCd") {
									salesCd = value;
								}
								if ($("#mForm #" + key)[0]) {
									$("#mForm #" + key).val(value);
								}
							});
						});

				var formData2 = {
					"coCd" : coCd,
					"salesCd" : salesCd,
					"todoDiv1CodeId" : todoDiv1CodeId,
					"todoDiv2CodeId" : todoDiv2CodeId,
					"fileTrgtKey" : paramObj.todoFileTrgtKey
				}
				postAjaxSync("/user/wb/wb20/selectApprovalYnList", formData2, null, function(data) {
					if (data.resultList) {
						createHtmlAppView(data.resultList);
					}
				});
		});

	function createHtmlAppView(appDataList) {
		if (appDataList.length == 0)
			return;
		var cHtml = '';
		cHtml += '  <table style="width:100%; margin-bottom:15px;float:right;">\n';
		cHtml += '      <tr>\n';
		cHtml += '          <th rowspan="2" style="width:40px;">결재</th>\n';
		$.each(appDataList,function(idx, elem) {
			cHtml += '          <td>' + elem.levelNm + '</th>\n';
		});
		cHtml += '      </tr>\n';
		cHtml += '      <tr>\n';
		$.each(appDataList,function(idx, elem) {
			let span_text = '(대기)';
			if (elem.todoCfDt != undefined) {
				span_text = '(결재)';
			}
			cHtml += '       <td>' + elem.name + span_text + '</td>\n';
		});
		cHtml += '      </tr>\n';
		cHtml += '  </table>';
		//alert(cHtml);
		$("#appViewArea")[0].innerHTML = cHtml;
	}
</script>

</html>