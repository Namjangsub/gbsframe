<!DOCTYPE html>
<html lang="ko">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport"
	content="width=device-width, initial-scale=1, mimum-scale=1, maximum-scale=1, user-scalable=no">
<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet"
	href="/static/bootstrap/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
<link rel="stylesheet"
	href="/static/bootstrap/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="/static/fontawesome/css/all.css">
<link rel="stylesheet" href="/static/css/ax5/ax5grid.css" />
<link rel="stylesheet" href="/static/css/ax5/ax5mask.css" />
<link rel="stylesheet" href="/static/css/ax5/ax5modal.css" />
<link rel="stylesheet" href="/static/css/ax5/ax5toast.css" />
<link rel="stylesheet" href="/static/css/jstree/style.min.css" />
<link rel="stylesheet" href="/static/css/gnb.css" />
<link rel="stylesheet" href="/static/css/main.css" />
<link rel="stylesheet" href="/static/mobile/css/sub.css" />
<link rel="stylesheet" href="/static/css/common.css" />
<link rel="stylesheet" href="/static/css/mobile.css" />

<script src="/static/js/jquery-latest.min.js"></script>
<script src="/static/js/jquery.serializeObject.js"></script>
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
<script src="/static/js/moment/moment-with-locales.js"></script>
<script src="/static/js/ax5/ax5core.min.js"></script>
<script src="/static/js/ax5/ax5grid.min.js"></script>
<script src="/static/js/ax5/ax5mask.min.js"></script>
<script src="/static/js/ax5/ax5modal.min.js"></script>
<script src="/static/js/ax5/ax5toast.min.js"></script>
<script src="/static/js/jstree/jstree.min.js"></script>
<script src="/static/js/global.js"></script>
<script src="/static/js/fileTree.js"></script>
<!-- 공통결재 -->
<script src="/static/js/commApprovalMobile.js"></script>
<style type="text/css">
.input {
	border-top: none;
	border-left: none;
	border-right: none;
	border-bottom: 0.3px solid #e9ecef;
}
</style>
</head>

<body>
	<div id="head_area" class="off">
		<div class="left_btn" onclick="history.back(-1)">
			<a class="back_btn"></a>
		</div>
		<h1 class="logo">
			<img src="/static/img/Logo_gunyangitt.gif" alt="건양ITT" />
		</h1>
	</div>
	<div id="main_area">
		<div class="contents_tit">
			<span
				style="height: 20px; line-height: 20px; font-size: 17px; margin-left: 15px; font-weight: bold;">요인별
				발주 및 출장 요청 결재</span>
		</div>
		<div class="contents search">
			<div class="popup_table" id="appViewArea"></div>
			<br>
			<form id="mForm">
				<input type="hidden" id="pgmId" name="pgmId" value="QM0101P01_M">
				<table class="table_input">
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: #000000;">회사</th>
						<td style="text-align: left; width: 30%; font-size: 14px;"><input
							type="text" id="coNm" name="coNm" disabled
							style="color: blue; font-weight: bold;"></td>
						<!-- <th style="text-align:left;width:20%;font-size:14px;font-weight:bold;color:black;">관리번호</th>
                        <td style="text-align:left;width:30%;font-size:14px;">
                        <input class="input"  type="text" id="reqNo" name="reqNo" disabled style="color:blue;font-weight:bold;">                      
                        </td>-->
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">발행일자</th>
						<td style="text-align: left; width: 30%; font-size: 14px;"><input
							class="input" type="text" id="ordrgDt" name="ordrgDt" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<!-- <tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">발행일자</th>
						<td colspan="3"
							style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="ordrgDt" name="ordrgDt" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr> -->
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">발행자</th>
						<td style="text-align: left; width: 30%; font-size: 14px;"><input
							class="input" type="text" id="ordrgNm" data-search="ordrgNm"
							disabled style="color: blue; font-weight: bold;"></td>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">접수자</th>
						<td style="text-align: left; width: 30%; font-size: 14px;"><input
							class="input" type="text" id="regNm" data-search="regNm" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 40%; font-size: 13px; font-weight: bold; color: black;">SalesCode</th>
						<td colspan="3"
							style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="salesCd" name="salesCd" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<!-- <tr>                    
                        <th colspan="1" style="text-align:left;width:20%;font-size:14px;font-weight:bold;color:black;">대표도면<br>번호</th>
                        <td  colspan="3" style="text-align:left;width:60%;font-size:14px;">
                        <input class="input"  type="text" id="matrDrwNo" name="matrDrwNo" disabled style="color:blue;font-weight:bold;">                
                        </td>
                    </tr> -->
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">고객사</th>
						<td style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="clntNm" name="clntNm" disabled
							style="color: blue; font-weight: bold;"></td>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">고객사PJT</th>
						<td style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="clntPjtNm" name="clntPjtNm"
							disabled style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">신작구분</th>
						<td style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="newCd" name="newCd" disabled
							style="color: blue; font-weight: bold;"></td>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">요청구분</th>
						<td style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="reqCdNm" name="reqCdNm" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">요구일정</th>
						<td style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="reqDt" name="reqDt" disabled
							style="color: blue; font-weight: bold;"></td>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">수주번호</th>
						<td style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="ordrsNo" name="ordrsNo" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">프로젝트명</th>
						<td colspan="3"
							style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="projNm" name="projNm" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<!-- <th style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">출장자</th>
						<td style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="bustCdNm" name="bustCdNm" disabled
							style="color: blue; font-weight: bold;"></td> -->
						<th style="text-align:left;width:20%;font-size:14px;font-weight:bold;color:black;">출장자명</th>
                        <td style="text-align:left;width:60%;font-size:14px;">
                         <input class="input"  type="text" id="bustNm" name="bustNm" disabled style="color:blue;font-weight:bold;">           
                        </td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">사내작업</th>
						<td colspan="3"
							style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="inwkCdNm" name="inwkCdNm" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">출장장소</th>
						<td colspan="3"
							style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="bustPe" name="bustPe" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">분류</th>
						<td colspan="3"
							style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="partCdNm" name="partCdNm" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">소속부서</th>
						<td colspan="3"
							style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="deptNm" name="deptNm" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<!-- <tr>                    
                        <th colspan="1" style="text-align:left;width:30%;font-size:14px;font-weight:bold;color:black;">소속부서<br>상세</th>
                        <td colspan="3" style="text-align:left;width:70%;font-size:14px;">
                         <input class="input"  type="text" id="dept2Nm"  name="dept2Nm" disabled style="color:blue;font-weight:bold;">             
                        </td>
                    </tr> -->
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">중분류</th>
						<td colspan="3"
							style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="midNm" name="midNm" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<!-- <tr>                    
                        <th style="text-align:left;width:20%;font-size:14px;font-weight:bold;color:black;">소분류</th>
                        <td  colspan="3" style="text-align:left;width:60%;font-size:14px;">
                          <input class="input"  type="text" id="subNm"  name="subNm" disabled style="color:blue;font-weight:bold;">             
                        </td>
                    </tr> -->
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">비고</th>
						<td colspan="3"
							style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="reqRmk" name="reqRmk" disabled
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<tr>
						<th
							style="text-align: left; width: 20%; font-size: 14px; font-weight: bold; color: black;">결재일자</th>
						<td colspan="3"
							style="text-align: left; width: 60%; font-size: 14px;"><input
							class="input" type="text" id="todoCfDt" name="todoCfDt" readonly
							style="color: blue; font-weight: bold;"></td>
					</tr>
					<tr>
						<td colspan="4" style="height: 5px;"></td>
					</tr>
					<!-- <tr>                    
                        <th style="text-align:left;width:20%;font-size:14px;font-weight:bold;color:black;">결재의견</th>
                        <td colspan="3" style="text-align:left;width:40%;font-size:14px;color:blue;font-weight:bold;">
                         <textarea rows="3" cols="19" name="todoCfOpn"></textarea>          
                        </td>
                    </tr>   -->
				</table>
				<!-- todo 결재 -->
				<div align="center" style="width: 100%; height: 30%;">
					<!-- <button type="button" id="actionBtn" onclick="updateQmMobileApproval();">결재</button> -->
					<div id="wbsPopup" class="popup_area">
						<!-- <div class="tit_contents"> -->
						<!-- <h4 class="tit">TODO 결재</h4> -->
						<!--  </div> -->
						<div id="approval_area"></div>
					</div>
				</div>
			</form>

		</div>
	</div>
</body>

<script type="text/javascript">
	var todoFileTrgtKey = null;
	var sanctnSn = null;
	var coCd = null;
	var salesCd = null;
	var todoDiv1CodeId = "TODODIV20";
	var todoDiv2CodeId = "TODODIV2020";

	function getParams() {
		var url = window.location.search.replace('?', '');
		var params = {};
		var urlArray = url.split('&');

		for ( var i in urlArray) {
			var param = urlArray[i].split('=');
			params[param[0]] = param[1];
		}
		return params;
		//debugger;
	}
	
	/*todo 결재*/
	var btnApproval = null;
	//div area id 
	var htmlParam = {
		htmlArea : "approval_area"
	};

	//세션에 정보를 활용하여 승인처리
	var paramObj = JSON.parse(sessionStorage.getItem('paramObj'));
	//sessionStorage.removeItem('paramObj');제거??
	if (paramObj && paramObj != "undefined") {
		//to-do 에서 넘어온 param;
		var popParam = paramObj;
		//추가로 넣어줄 param
		var approvalParam = {
			coCd : paramObj.coCd,
			todoDiv1CodeId : paramObj.todoDiv1CodeId,
			todoDiv2CodeId : paramObj.todoDiv2CodeId,
			pgmId : paramObj.pgmId
		};
		//삭제할 키가 있으면 쓴다.
		delete popParam.sanctnSn;
		delete popParam.pgmId;
		var commApproval = new Approval(htmlParam, approvalParam, popParam);
		commApproval.makeHtml();
	} else {
		window.history.back();
	}

	function approvalConfirm() {
		commApproval.confirmApproval();
		window.history.back();
	}
	/*todo 결재*/
	
	$(document).ready(
			function() {
				const params = getParams();
				var today = new Date();
				var strDate = today.getFullYear() + "-"
						+ ('0' + (today.getMonth() + 1)).slice(-2) + "-"
						+ ('0' + today.getDate()).slice(-2);
				$('#todoCfDt').val(strDate);

				//var formData = modalStack.last().paramObj;

				//세션에 정보를 활용하여 승인처리
				//JSON.parse : JSON.stringify를 받을 때 / 문자열-> 자바스크립트로 변환
				//var paramObj1 = JSON.parse(sessionStorage.getItem('paramObj'));
				//sessionStorage.removeItem('paramObj');삭제?!

				// debugger;
				//todoFileTrgtKey = params["fileTrgtKey"];??
				//sanctnSn = params["sanctnSn"];??
				var formData1 = {
					"fileTrgtKey" : paramObj.todoFileTrgtKey
				}
				postAjaxSync("/user/qm/qm01/selectQtyReqInfo", paramObj, null,
						function(data) {
							$.each(data.result, function(key, value) {
								if (key == "coCd") {
									coCd = value;
								} else if (key == "salesCd") {
									salesCd = value;
								}
								if ($("#mForm #" + key)[0]) {
									$("#mForm #" + key).val(value);
								}
							});
						});

				var formData2 = {
					"coCd" : coCd,
					"salesCd" : salesCd,
					"todoDiv1CodeId" : todoDiv1CodeId,
					"todoDiv2CodeId" : todoDiv2CodeId,
					"fileTrgtKey" : todoFileTrgtKey
				}
				postAjaxSync("/user/wb/wb20/selectApprovalYnList", formData2,
						null, function(data) {
							if (data.resultList) {
								createHtmlAppView(data.resultList);
							}
						});
			});

	function createHtmlAppView(appDataList) {
		if (appDataList.length == 0)
			return;
		var cHtml = '';
		cHtml += '  <table style="width:330px;margin-bottom:15px;float:right;border:1px;">\n';
		cHtml += '      <tr style="height:25px;border:1px;">\n';
		cHtml += '          <th rowspan="2" style="width:50px;margin-left:0px">결재</th>\n';
		$
				.each(
						appDataList,
						function(idx, elem) {
							cHtml += '          <th style="text-align:center;margin-left:0px;">'
									+ elem.levelNm + '</th>\n';
						});
		cHtml += '      </tr>\n';
		cHtml += '      <tr style="height:30px;border:1px;">\n';
		$
				.each(
						appDataList,
						function(idx, elem) {
							var span_text = '<span style="font-size:12px;color:gray;">(대기)</span>';
							if (elem.todoCfDt != undefined) {
								span_text = '<span style="font-size:12px;color:blue;">(결재)</span>';
							}
							cHtml += '<td style="text-align:center;border:1px;">'
									+ elem.name + '' + span_text + '</td>\n';
						});
		cHtml += '      </tr>\n';
		cHtml += '  </table>';
		//alert(cHtml);
		$("#appViewArea")[0].innerHTML = cHtml;
	}

	function updateQmMobileApproval() {
		var formData = new FormData();
		formData.append("todoFileTrgtKey", todoFileTrgtKey);
		formData.append("todoCfDt", $('#todoCfDt').val());
		formData.append("todoCfOpn", $('#todoCfOpn').val());
		formData.append("creatId", jwt.userId);
		formData.append("userId", jwt.userId);
		formData.append("creatPgm", $('#pgmId').val());
		formData.append("todoCoCd", coCd);
		formData.append("todoId", jwt.userId);
		formData.append("todoDiv1CodeId", todoDiv1CodeId);
		formData.append("todoDiv2CodeId", todoDiv2CodeId);
		formData.append("salesCd", salesCd);
		formData.append("sanctnSn", sanctnSn);

		filePutAjax("/user/wb/wb20/updateQmMobileApproval", formData, function(
				data) {
			if (data.resultCode == 200) {
				alert("결재되었습니다");
				//modalStack.close();
			}
		});
	}
</script>

</html>