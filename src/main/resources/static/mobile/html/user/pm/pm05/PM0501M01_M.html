<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">    
	<meta name="viewport" content="width=device-width, initial-scale=1, mimum-scale=1">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="/static/fontawesome/css/all.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5grid.css" />
    <link rel="stylesheet" href="/static/css/ax5/ax5mask.css" />
    <link rel="stylesheet" href="/static/css/ax5/ax5modal.css" />
    <link rel="stylesheet" href="/static/css/gnb.css" />
    <link rel="stylesheet" href="/static/css/main.css" />
    <link rel="stylesheet" href="/static/css/sub.css" />
    <link rel="stylesheet" href="/static/css/common.css" />
	<link rel="stylesheet" href="/static/css/mobile.css" />

    <script src="/static/js/jquery-latest.min.js"></script>
    <script src="/static/js/jquery.serializeObject.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
    <script src="/static/js/moment/moment-with-locales.js"></script>
    <script src="/static/js/ax5/ax5core.min.js"></script>
    <script src="/static/js/ax5/ax5grid.min.js"></script>
    <script src="/static/js/ax5/ax5mask.min.js"></script>
    <script src="/static/js/ax5/ax5modal.min.js"></script>
	<script src="/static/js/global.js"></script>
</head>

<body>
	<div id="head_area" class="off" >
		<div class="left_btn" onclick="history.back(-1)">
      		<a class="back_btn"></a>
    	</div>
		<h1 class="logo">
      		<img src="/static/img/Logo_gunyangitt.gif" alt="건양ITT" />  
    	</h1>
	</div>

    <div id="main_area">
  <div class="contents no_bg">
      <div class="contents_tit">
        <span style="height: 30px; line-height: 30px;font-size: 20px;margin-left: 15px;font-weight:bold;">출장 및 휴가자 현황</span> 
			<div class="contents search" style="margin-bottom: 0px; padding-bottom: 0px;">
				<table class="table_input">
                    <tr>
                       <th style="width:25px;">회사</th>
                        <td style="width:60px;">
                            <select id="coCd" name="coCd" data-kind="CO" data-search="coCd"
                             onchange="gridView.setData(0)">
                                <option value="">전체</option>
                            </select>
                        </td>
                        <td style="width:10px;"></td>
                        <th style="width:25px;">일자</th>
                        <td style="width:90px;">
                            <div class="date_input">
                                <input id="reqDtFrom" name="reqDtFrom" class="input_calendar" autocomplete="off" onkeyup="dateMask(this);"
                                msg="시작일자" data-search="reqDtFrom" onchange="gridView.setData(0)">
                            </div>
                        </td>
                        <td style="width:10px;">
                       ~
                        </td>
                        <td style="width:90px;">
                            <div class="date_input">
                                <input id="reqDtTo" name="reqDtTo" class="input_calendar" autocomplete="off" onkeyup="dateMask(this);"
                                msg="종료일자" data-search="reqDtTo" onchange="gridView.setData(0)">
                            </div>
                        </td>
                    </tr>
                    <tr>
                       
                        <th style="width:25px;"> 구분</th>
                        <td style="width:160px;">
                            <select id="sGbn" name="sGbn" data-search="sGbn" onchange="gridView.setData(0)">
                                <option value="">전체</option>
                                <option value="01">휴가</option>
                                <option value="02">출장</option>
                            </select>
                        </td>
                        <td style="width:10px;"></td>
                        <th style="width:25px;">성명</th>
                        <td style="width:120px;">
                            <div class="search_form">
                                <input type="text"  id="workRptIdNm" name="workRptIdNm">
                            </div>
                        </td>
                         <td style="width:10px;">
                        <td style="width:70px;">
                           <button style="width:70px;height: 30px; padding:0px;" type="button" onclick="gridView.setData(0);">검색</button>
                        </td>
                    </tr>
               </table>
			</div>
      </div>
    </div>
    <div data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 640px; width: 100%; font-size:16px;"></div>
    
</body>

<script type="text/javascript">
    var gridView = {
        initView : function() {
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: true,
                multipleSelect: false,
                sortable: true,
                target: $('[data-ax5grid="first-grid"]'),
                header: {
                    align: "center",
                    selector: true
                },
                body: {
                    mergeCells : ["coNm","workRptDt","lNm"],
                    onClick: function () {
                        this.self.select(this.dindex);
                    },
//                     grouping: {
//                         by: ["workRptDt"],
//                         columns : [
//                             {
//                                 label : function () {
//                                     if(this.groupBy.labels.length == 1) {
//                                         group_text = "[ " + this.groupBy.labels[0] + " 합계 ]";
//                                     } else if(this.groupBy.labels.length == 2) {
//                                         group_text = this.groupBy.labels[0];
//                                     }
//                                     return group_text;
//                                 }, colspan: 1, align: "left"
//                             },
//                             {
//                                 label : function () {
//                                     if(this.groupBy.labels.length == 1) {
//                                         group_text = "";
//                                     } else if(this.groupBy.labels.length == 2) {
//                                         group_text = "[ " + this.groupBy.labels[1] + " 합계 ]";
//                                     }
//                                     return group_text;
//                                 }, colspan: 1, align: "left"
//                             },
//                             {},
//                             {},
//                             {key : "workRptHour", collector : "sum", formatter : "money", align : "right"},
//                         ]
//                     }
                },
                page : {
                	display : true,
                },
//                 footSum: [
//                     [
//                         {label: "총계", colspan:4, align:"center"},
//                         {key: "workRptHour", collector: "sum", formatter:"money", align: "right"}
//                     ]
//                 ],
                columns : [
                    {key: "workRptDt"  , label: "작성일자"  , width:  80, align: "center"},
                    {key: "idNm"       , label: "성 명"    , width:60, align: "center"},
                    {key: "sNm"        , label: "소분류"    , width:  60, align: "left"},
                    {key: "workRptRmk" , label: "비고"      , width: 150, align: "left",
                        formatter: function () {
                            return (this.value) ? '<span style="display: block; height: 40px; white-space: pre;">'+this.value+'</span>' : ''
                        }
                    },
                    {key: "workRptHour", label: "작업시간"  , width:  70, align: "right", formatter: "money"},
                    {key: "clntNm"     , label: "고객사"    , width: 100, align: "left"},
                    {key: "clntPjtNm"  , label: "고객사PJT" , width: 100, align: "left"},
                    {key: "salesCd"    , label: "Sales Code", width: 120, align: "center"},
                    {key: "prdtNm"     , label: "제품구분"  , width: 150, align: "left"},
                    {key: "itemDivNm"  , label: "아이템구분", width: 100, align: "left"},
                    {key: "eqpNm"      , label: "설비명"    , width: 200, align: "left"},
                    {key: "coNm"       , label: "회사"      , width: 120, align: "left"},
                    {key: "lNm"        , label: "대분류"    , width: 150, align: "left"},
                    {key: "mNm"        , label: "중분류"    , width: 100, align: "left", hidden:true},

                    {key: "fileTrgtKey", label: "파일대상KEY" , width:100, align: "center", hidden:true},
                    {key: "coCd"       , label: "회사코드"    , width:100, align: "center", hidden:true},
                    {key: "workRptNo"  , label: "작업일보번호", width:100, align: "center", hidden:true},
                    {key: "sGbn"       , label: "sGbn"       , width:100, align: "center", hidden:true},
                    {key: "workRptL"   , label: "대분류"      , width:100, align: "center", hidden:true},
                    {key: "workRptM"   , label: "중분류"      , width:100, align: "center", hidden:true},
                    {key: "workRptS"   , label: "소분류"      , width:100, align: "center", hidden:true},
                    {key: "clntCd"     , label: "고객사"      , width:100, align: "center", hidden:true},
                    {key: "ordrsNo"    , label: "수주번호"    , width:100, align: "center", hidden:true},
                    {key: "clntPjt"    , label: "고객사PJT"   , width:100, align: "center", hidden:true},
                    {key: "prdtCd"     , label: "제품구분"    , width:100, align: "center", hidden:true},
                    {key: "itemDiv"    , label: "아이템구분"  , width:100, align: "center", hidden:true},
                    {key: "issueYn"    , label: "issueYn"    , width:100, align: "center", hidden:true},
                    {key: "issueTitle" , label: "issueTitle" , width:100, align: "center", hidden:true},
                ]
            });
            return this;
        },
        
        setData : function() {
            var targetObj = this.target;
            var formData = {
                "coCd"        : $("#coCd").val(),
                "reqDtFrom"   : $("#reqDtFrom").val(),
                "reqDtTo"     : $("#reqDtTo").val(),
                "sGbn"        : $("#sGbn").val(),
                "workRptIdNm" : $("#workRptIdNm").val() 
            }            
            postAjax("/user/pm/pm05/pm05_grid1_selectList_m", formData, null, function(data){
                var list = data.result;
                if (list) {
                    targetObj.setData({
                            list : list,
                            page : {
                                totalElements : list.length
                            }
                        });
                }
            });
        }
    }

    $(document).ready(function() {
        setCommonSelect($("#main_area select[data-kind]"));  // 공통코드 set
        
        $("#coCd").val(jwt.coCd);

        $('#reqDtFrom').datepicker({
            format : "yyyy-mm-dd",
            language : "ko",
            autoclose : true
        })
        .datepicker("setDate", moment(new Date()).startOf("month").toDate())
        .on("changeDate", function(){
            if($('#reqDtFrom').val() > $('#reqDtTo').val()){
                alert("날짜를 확인해주세요");
                $('#reqDtFrom').datepicker("setDate", new Date($('#reqDtTo').val()));
            }
        });
        
        $('#reqDtTo').datepicker({
            format : "yyyy-mm-dd",
            language : "ko",
            autoclose : true
        })
        .datepicker("setDate", moment(new Date()).endOf("month").toDate())
        .on("changeDate", function(){
            if($('#reqDtFrom').val() > $('#reqDtTo').val()){
                alert("날짜를 확인해주세요");
                $('#reqDtTo').datepicker("setDate", new Date($('#reqDtFrom').val()));
            }
        });
        gridView.initView().setData(0);
    });
    

</script>
</html>