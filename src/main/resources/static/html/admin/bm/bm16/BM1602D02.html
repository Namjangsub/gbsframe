<script type="text/javascript">

	var insertOK = false;

	$(document).ready(function() {

		// setCombo();

		var row = PD01GridView.getList("selected")[0];
		$("#prdtDivCd").val(row.prdtDiv);

		setPrdtStkn();

		if(actionType == 'U'){
			$('#actionBtn').text("수정");
			setData();
			insertOK = true;

		}else if(actionType == 'C'){

				if( PD01GridView.getList("selected")[0]){
					row = PD01GridView.getList("selected")[0];
				}
				$("#prjctSeq").val(row.prjctSeq);

				$('#actionBtn').text("등록");

		}

		$("#prdtErqkCd").on("change", function(){
			insertOK = false;
		});
		$("#prdtStkn").on("change", function(){
			insertOK = false;
		});

		 authChk("BM1601M01");
	})

// 	function setPrdtStkn(){

// 		var paramObj = {"codeKind" : $("#prdtDivCd").val()};
// 		postAjaxSync("/admin/cm/cm05/selectChildCodeList", paramObj, null, function(data){
// 			var optionHtml = '<option value="">선택</option>';
// 			var childCodeList = data.childCodeList;

// 			$.each(childCodeList, function(index, obj){
// 				optionHtml += '<option value='+obj.codeId+'>';
// 				optionHtml += obj.codeNm;
// 				optionHtml += '</option>';
// 			});
// 				$('#prdtStkn').html(optionHtml);

// 		});
// 	}


	function setData() {

		var row = secondGrid.getList("selected")[0];

		var paramObj = {
				"prjctSeq": row.prjctSeq,
				"codeId" : row.codeId,
				"codeNm" : row.codeNm,
				"prjctRmk" : row.prjctRmk,
				"prjctItemCd" : row.prjctItemCd,
				"userId": jwt.userId

		};


		postAjax("/admin/bm/bm16/selectPrjctInfo", paramObj, null, function(data){
			setDetailInfo(data.detailInfo);
		});

	}

	function setDetailInfo(data){
		$.each(data, function(key, value){
			if(key == 'prjctSeq'){
				$("#prjctSeq").val(value);
			}
			else if(key == 'prjctItemCd'){
				$("#prjctItemCd").val(value).attr("selected", "selected");
				$("#prjctItemCd").val(value).prop('disabled',true);

			}else if(key == 'codeNm'){

				$("#codeNm").val(value).attr("selected", "selected");
				$("#codeNm").val(value).prop('disabled',true);
			}
			else{
				$('#'+key).val(value);
			}


		});

	}

	function insertOneDetail01() {

			if(insertOK) {
				var formData = {
						"basisPriceSeq" : $("#basisPriceSeqCd").val(),
						"prdtErqkCd" : $("#prdtErqkCd").val(),
						"prdtStkn" : $("#prdtStkn").val(),
						"scAmt" : deleteCommaStr($("#scAmt").val()),
						"userId" : jwt.userId,
						"pgmId" : $("#pgmId").val()
				}
				putAjax("/user/sd/sd06/insertOneDetail01", formData, null, function(data){
					if(data.resultCode == 200){
						if(actionType == 'C'){
							alert("등록되었습니다.");
						}else{
							alert(data.resultMessage);
						}
						modalStack.close();
						gridView.initView().setData(0);
					}
				});
			} else {
				alert("중복체크 해주세요.")
			}

	}

	function checkOverLap() {

		var isValid = true;

		$('#frm [required]').each(function(idx, elem){
				if($.trim($(elem).val()) == ""){
					alert("필수값을 입력해 주세요.");
					$(elem).focus();
					isValid = false;
				return false;
			}
		});

		if(isValid){

			if(insertOK){
				insertOneDetail01();
			}else{
				var formData = {
						"basisPriceSeq" : $("#basisPriceSeqCd").val(),
						"prdtStkn" : $("#prdtStkn").val(),
						"prdtErqkCd" : $("#prdtErqkCd").val()
				}
				postAjax("/user/sd/sd06/checkOverLapDetail01", formData, null, function(data){
					if(data.resultCode != 200){
						alert(data.resultMessage);
					}
					if(data.resultCode == 200){
						insertOK = true;
						insertOneDetail01();
					}
				})
			}
		}

	}




</script>
<body>
	<div class="container-fluid">
      <div class="row">
        <div class="popup_area">
	        <form id="frm">
	          <table class="popup_table">
	          	<tbody>
	          		<tr>
                <tr>
                <th class="hit" colspan= "1">코드아이디</th>
                     <td>
                        <select type="text" id="codeId" name="codeId"></select>
                    </td>
                      <th class="hit" colspan= "1">아이템 내역</th>
                    <td>
                        <select type="text" id="codeNm" name= "codeNm"></select>
                    </td>

                       </tr>
                       <tr>
                    <th colspan= "1">비고</th>
                    <td colspan="3">
                     <textarea class="form-control" id="prjctRmk" name="prjctRmk" style="height: 60px;" maxlength="500"></textarea>
                    </td>
                   </tr>

	          	</tbody>
	          </table>
	      		    <input id="userId" name="userId" type="text" >
	      		    <input id="codeNm" name="codeNm" type="text" >
		          	<input type="hidden" id="pgmId" name="pgmId" value="SD0602P02">
<!-- 		          	<input type="hidden" id="prdtDivCd" > -->
	        </form>
	        <div class ="popup_bottom_btn">
				<!-- <button id="checkBtn" type="button" class="bg_g fs-5" onclick="checkOverLap()">중복체크</button> -->
				<button type="button"  onclick="checkOverLap();" id ="actionBtn" authchk></button>
				<button type="button"  onclick="modalStack.close();">닫기</button>
			</div>
        </div>
      </div>
    </div>


</body>
</html>
