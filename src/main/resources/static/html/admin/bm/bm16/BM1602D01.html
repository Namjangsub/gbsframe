<script type="text/javascript">

	var insertOK = false;

	$(document).ready(function() {
    /* 페이지 로드 시 $(document).ready() 함수를 호출하여 페이지가 로드될 때 실행 */

		if(actionType == 'U'){
			$('#actionBtn').text("수정");
			insertOK = true;
			setData();
		}else if(actionType == 'C'){
			$('#actionBtn').text("등록");
		}
		$("#prdtNm").on("change", function(){
			insertOK = false;
		});
		$("#prjctPrdtCd").on("change", function(){
			insertOK = false;
		});
		$("#prjctItemRmk").on("change", function(){
			insertOK = false;
		});

		authChk();
	})

    /* 이 코드는 변수 insertOK를 false로 설정하고,
    actionType 변수의 값에 따라 조건 분기합니다.
    actionType 변수가 'U'일 경우 #actionBtn 요소의 텍스트를 "수정"로 변경하고,
    insertOK 변수를 true로 설정하고 setData() 함수를 호출합니다.
    actionType 변수가 'C'일 경우 #actionBtn 요소의 텍스트를 "ActionBtn"로 변경합니다.

    이후 #prjctPrdtCd, #prdtNm, #prjctItemRmk 요소의 값이 변경될 때마다 insertOK 변수를 false로 설정합니다.
    마지막으로 authCheck() 함수를 호출합니다. */

	function setData() {
	//setData() 함수를 정의

	var row = PD01GridView.getList("selected")[0];

		var paramObj = {
    		    "prjctSeq": row.prjctSeq
    			,"prjctPrdtCd"  : row.prjctPrdtCd
  				,"prdtNm"		: row.prdtNm
  				,"prjctItemRmk" : row.prjctItemRmk
    			,"userId"		: jwt.userId
		};

		postAjax("/admin/bm/bm16/seletOneMaster", formData, null, function(data) {
			setPrjctInfo(data.result);
		});

	}
	/* 	gridView.getList("selected")[0]으로 선택한 행의 prjctSeq 값을 가져와서 paramObj 변수에 설정한 후,
 		 postAjax() 함수를 호출합니다.
		 postAjax() 함수는 첫 번째 인자로 "/admin/bm/bm16/seletOneMaster" URL을 받으며,
		 두 번째 인자로 formData를 전달합니다. postAjax() 함수는 비동기식으로 데이터를 전송하고,
		 서버로부터 받은 응답 데이터는 콜백 함수인 function(data) 내에서 처리됩니다.

	 	응답 데이터에서 result 값을 가져와서 setPrjctInfo() 함수를 호출합니다.
	 	이 함수는 가져온 프로젝트 정보를 화면에 출력하는 등의 역할을 수행합니다.

		(맥락) 이 코드는 선택한 행의 prjctSeq 값을 이용하여 서버로부터 프로젝트 정보를 가져와서 화면에
		 출력하는 기능을 수행합니다. */

	function setDetailInfo(data){
		// 	 setDetailInfo(data) 함수를 정의

		$.each(data, function(key, value){
			if(key == 'prjctSeq'){
				$("#prjctSeq").val(value);
			}
			else if(key == 'prjctPrdtCd'){
				$("#prjctPrdtCd").val(value).attr("selected", "selected");
				$("#prjctPrdtCd").val(value).prop('disabled',true);
			}
			else if(key == 'prjctItemCd'){
				$("#prdtNm").val(value).attr("selected", "selected");
				$("#prdtNm").val(value).prop('disabled',true);
			}
			else if(key == 'prjctPrdtCd'){
				$("#prjctItemRmk").val(value).attr("selected", "selected");
				$("#prjctItemRmk").val(value).prop('disabled',true);
			}
			else{
				$('#'+key).val(value);
			}
		});

	}

/* 	  이 함수는 인자로 전달받은 data 객체의 속성을 순회하면서 각 속성의 값을 화면의 각 요소에 설정

	(if) 먼저, key 값이 'prjctSeq'일 경우, #prjctSeq 요소에 value 값을 설정합니다.

	 (else if) key 값이 'prjctPrdtCd'일 경우,
	 #prjctPrdtCd 요소에 value 값을 설정하고, 선택된 상태(selected)로 설정하며, 요소를 비활성화(disabled)합니다.

	 (else if)key 값이 'prjctItemCd'일 경우,
	 #prdtNm 요소에 value 값을 설정하고, 선택된 상태(selected)로 설정하며, 요소를 비활성화(disabled)합니다.

	 (else if)key 값이 'prjctItemRmk'일 경우,
	 #prjctItemRmk 요소에 value 값을 설정하고, 선택된 상태(selected)로 설정하며, 요소를 비활성화(disabled)합니다.

	 만약 key 값이 위의 값들 중 하나가 아닐 경우, 해당 key 값과 일치하는 ID를 가진 요소에 value 값을 설정합니다.


	 (동작목적) 서버에서 가져온 데이터(data)를 이용하여 화면의 각 요소에 값을 설정하는 기능을 수행합니다. */


	function insertOneMaster() {
		//   insertOneMaster() 함수를 정의

		if(insertOK){
				var formData = {
						"prjctSeq" : $("#prjctSeq").val(),
						"prdtNm" : $("#prdtNm").val(),
						"prjctPrdtCd" : $("#prjctPrdtCd").val(),
						"prjctItemRmk" : $("#prjctItemRmk").val(),
						"userId" : jwt.userId,
						"pgmId" : $("#pgmId").val()
				}
				putAjax("/admin/bm/bm16/insertOneMaster", formData, null, function(data){
					if(data.resultCode == 200){
						if(actionType == 'C'){
							alert("등록되었습니다.");
						}else{
							alert(data.resultMessage);
						}
						modalStack.close();
						first.gidView.initView().setData(0);
					}
				});
		}
	}

	/* 이 함수는 데이터를 입력하는 기능을 수행.

	먼저, insertOK 값이 true인 경우(formData 객체가 존재하는 경우),
	formData 객체를 생성하고, 화면의 각 요소의 값을 해당 속성에 매핑하여 객체의 속성으로 설정.

	그 다음, putAjax() 함수를 호출하여, 서버로 데이터를 전송합니다.
	첫 번째 인자로 전송할 URL을, 두 번째 인자로 전송할 데이터 객체(formData)를, 세 번째 인자로는 전송이 완료된 후 수행할 콜백 함수를 받습니다.

	서버로부터 데이터가 정상적으로 수신되면, resultCode 값이 200인지 확인한 후, actionType 값이 'C'인 경우 "Updates."라는 알림 창을 띄우고, 그 외의 경우에는 서버로부터 받은 결과 메시지(resultMessage)를 알림 창으로 띄웁니다.

	마지막으로, modalStack.close() 함수를 호출하여 모달 창을 닫고, gridView 객체를 초기화하고 화면을 갱신합니다.

	(동작목적)따라서, 이 코드는 사용자로부터 입력받은 데이터를 서버에 전송하여 데이터베이스에 저장하는 기능을 수행합니다. */


	function checkOverLap() {
		//   checkOverLap() 함수를 정의
		var isValid = true;
		$('#frm [required]').each(function(idx, elem){
				if($.trim($(elem).val()) == ""){
					alert("필수값을 입력해 주세요.");
					$(elem).focus();
					isValid = false;
				return false;
			}
		});

		if(isValid){
			if(insertOK){
				insertOneMaster();
			}else{
				var formData = {

						"prjctPrdtCd" : $("#prjctPrdtCd").val(),
						"prdtNm" : $("#prdtNm").val(),
						"prjctItemRmk" : $("#prjctItemRmk").val(),
				}
				postAjax("/admin/bm/bm16/selectPrjctInfo", formData, null, function(data){

					if(data.resultCode != 200){
						alert(data.resultMessage);
					}
					if(data.resultCode == 200){
						insertOK = true;
						insertOneMaster();
					}
				})
			}
		}

		/* 먼저, isValid 변수를 true로 초기화합니다.
		그리고 필수 입력 항목인 "#from" 요소에 대해 각각 루프를 돌면서 값이 비어있는지 체크하고,
		비어있으면 경고창을 띄우고 해당 요소에 focus를 줍니다.
		이 때 isValid 변수를 false로 바꿔줍니다.

		그 다음, isValid 변수가 true인 경우, insertOK 변수를 체크합니다.
		insertOK가 true인 경우 insertOneMaster 함수를 호출합니다.
		insertOK가 false인 경우, formData 변수를 설정하고 postAjax 함수를 호출하여 프로젝트 정보를 조회합니다.
		조회 결과가 성공인 경우, insertOK를 true로 설정하고 insertOneMaster 함수를 호출합니다.
		그 외의 경우는 조회 실패 메시지를 출력합니다.


		(동작목적) 중복체크 */

	}
</script>

<body>
  <div class="container-fluid">
      <div class="row">
        <div class="popup_area">
          <form id="frm">
            <div  class="popup_table">
              <table>
                <tbody>
                  <tr>
                      <th class="hit" colspan= "1">설비코드</th>
                    <td>
                        <select id="prjctPrdtCd" name="prjctPrdtCd" data-search="prjctPrdtCd" required></select>
                    </td>
                             <th class="hit" colspan= "1">대상설비</th>
                             <td>
                                <select id="prdtNm" name="prdtNm"></select>
                            </td>
                       </tr>
                       <tr>
                    <th colspan= "1">특이사항</th>
                    <td colspan="3">
                     <textarea class="form-control" id="prjctItemRmk" name="prjctItemRmk" style="height: 60px;" maxlength="500"></textarea>
                    </td>
                  </tr>
                </tbody>

              </table>
<!--                     <input type="hidden"   id="prjctSeq"     name="prjctSeq"> -->
<!--                     <input type="hidden"   id="prjctPrdtCd"  name="prjctPrdtCd"> -->
<!--                     <input type="hidden"   id="prjctItemRmk" name="prjctItemRmk"> -->
<!--                     <input type="hidden"   id="prjctRmk"     name="prjctRmk"> -->
<!--                     <input type="hidden"   id="userId"       name="userId" > -->
<!--                     <input type="hidden"   id="pgmId"        name="pgmId" value="BM1602M01"> -->
            </div>

          </form>

        <div class ="popup_bottom_btn">
          <!--  <button id="checkBtn" type="button" class="bg_g fs-5" onclick="checkOverLap()">중복체크</button> -->
          <button type="button"  onclick="checkOverLap();" id ="actionBtn" authchk></button>
          <button type="button"  onclick="modalStack.close();">닫기</button>

        </div>
        </div>
      </div>
    </div>
</body>
</html>
