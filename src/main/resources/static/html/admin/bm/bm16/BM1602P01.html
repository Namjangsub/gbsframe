<style>
* input[comma] {
  text-align: right;
 }
</style>

<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">프로젝트 등록</h4>
    </div>

  <form id="popForm" onSubmit="return false;">
    <div class="form-group popup_table">
      <input type="hidden" id="prjctInfo" style="display: none" multiple="multiple" onchange="setPrjct(this);">
<!--       <input type="hidden" name="prjctSeq"></td>    // 저장 시 있으면 Undefine에러 , 없으면 성공인데 prjctSeq가 " "값이 나옴. 없는 게 맞는듯 -->
      <input type="hidden" id="pgmId"     name="pgmId" value="BM1601M01">
      <table>

        <colgroup>
          <col width="15%">
          <col width="18%">
          <col width="15%">
          <col width="18%">
          <col width="15%">
          <col width="19%">
        </colgroup>

        <tr>

          <th class="hit">회사</th>
          <td>
            <select id="coCd" name="coCd" data-kind="CO" required="required" >
            </select>
          </td>
          <th class="hit">업체명</th>
          <td>
            <input type="hidden" id="clntCd" name="clntCd">
            <div class="search_form">
              <input type="text" id="clntNm" name="clntNm" maxlength="25">
              <a onclick="clntSearch();">
                <i class="i_search_w"></i>
              </a>
            </div>
          </td>

          <th class="hit">계약년월</th>
          <td>
            <input id="yyyymm" name="yyyymm" class="input_calendar" msg="계약년월" data-search="yyyymm">
        </tr>

        <tr>
          <th>국내/국외</th>
          <td>
            <select data-kind="INPEXP" id="inpexpCd" name="inpexpCd" style="text-align: center;">
            </select>
          </td>

          <th>업체담당자</th>
          <td>
            <input type="hidden" id="clntMng" name="clntMng" >
            <div class="search_form">
              <input type="text" id="clntMngNm" name="clntMngNm" class="form-control">
                <a onclick="clntSearch2();">
                <i class="i_search_w"></i>
              </a>
          </td>
          <th>구매방법</th>
          <td>
            <select id="odrCd" name="odrCd" data-search="odrCd" data-kind="PCHORD" style="text-align: center;">
             </select>
          </td>
        </tr>

        <tr>
          <th class="hit">프로젝트코드</th>
          <td>
            <input type="text" id="prjctCd" name="prjctCd" data-search="prjctCd" class="form-control">
          </td>

          <th>프로젝트명</th>
          <td>
            <input type="text" id="prjctNm" name="prjctNm" data-search="prjctNm">

          </td>
           <th>신규여부</th>
               <td>
                  <select id="newPrdtCd" name="newPrdtCd" data-kind="BIZDIV" style="text-align: center;">
                   </select>
               </td>
        </tr>

        <tr>
          <th>설비명</th>
          <td>
            <input type="text" id="eqpNm" name="eqpNm" data-search="eqpNm">
          </td>

          <th>수량</th>
          <td>
            <input type="text" id="eqpQty" name="eqpQty" class="form-control" style="text-align: right;">
          </td>

          <th>예상물량</th>
          <td>
            <input type="text" id="epctAmt" name="epctAmt" class="form-control" comma>
          </td>
          </td>
        </tr>

        <tr>
          <th>영업상황</th>
          <td colspan="3">
            <input type="text" id="winbdRmk" name="winbdRmk">
          </td>
          <th>수주목표</th>
          <td>
            <input type="text"  id="ordrsPlanAmt" name="ordrsPlanAmt" comma>
          </td>
        </tr>

        <tr>
          <th>예상납기일</th>
          <td>
            <input id="dudtPlanDt" name="dudtPlanDt" class="input_calendar form-control" data-search="dudtPlanDt" autocomplete="off" onkeyup="dateMask(this);" date>
          </td>

          <th>수주예정일</th>
          <td>
            <input id="ordrsPlanDt" name="ordrsPlanDt" class="input_calendar form-control" data-search="ordrsPlanDt" autocomplete="off" onkeyup="dateMask(this);" date>
          </td>

          <th>수주금액</th>
          <td>
            <input type="text" id="ordrsAmt" name="ordrsAmt" comma>
           </td>
        </tr>

        <tr>
          <th>영업담당자</th>
          <td>
             <div class="search_form">
                  <input type="text" id="mngId" name="mngId" class="form-control">
                 <a onclick="setMngInfo(paramObj);">
                <i class="i_search_w"></i>
              </a></div>
          </td>
          <th>수주확정</th>
          <td>
            <select id="winbdCd" name="winbdCd" data-kind="YN" data-search="winbdCd" >
            </select>
          </td>
          <th>미수주금액</th>
          <td>
              <input type="text" id="unordrsAmt2" name="unordrsAmt"  money style="text-align: right;" >
          </td>
        </tr>
        <tr>
          <th>수주가치</th>
          <td>
            <input type="text" id="odrRmk" name="odrRmk" class="form-control" money>
          </td>
          <th>수주일</th>
          <td>
            <input type="text" id="ordrsDt" name="ordrsDt" class="input_calendar form-control"  data-search="ordrsDt" autocomplete="off" onkeyup="dateMask(this);" date>
          </td>
          <th>수주확률</th>
          <td>
               <select type="text" id="ordrsPct" name="ordrsPct" >
                    <option value="10" selected>선택</option>
                    <option value="10">10%</option>
                    <option value="20">20%</option>
                    <option value="50">50%</option>
                    <option value="100">100%</option>
              </select>
          </td>
        </tr>
        <tr>
          <th>비고</th>
          <td colspan="5">
            <textarea class="form-control" id="prjctRmk" name="prjctRmk" style="height: 60px;" maxlength="500"></textarea>
          </td>
        </tr>

      </table>
                          <input type="hidden"   id="prjctSeq"     name="prjctSeq">         <!--  itemList Grid에 영향 -->
                          <input type="hidden"   id="udtPgm"     name="udtPgm">
<!--                     <input type="hidden"   id="prjctPrdtCd"  name="prjctPrdtCd"> -->
<!--                     <input type="hidden"   id="prjctItemRmk" name="prjctItemRmk"> -->
<!--                     <input type="hidden"   id="prjctRmk"     name="prjctRmk"> -->

      </form>
</div>

    <div class="contents">
	      <!-- 리스트 -->
	    <div class="ax5_grid">
	        <ul class="ul_list type02">
	            <li>
	                <div class="table_list_tit">
                              <h5 align="left" class="tit">대상설비</h5>
	                      <div class="add_btn_small">
<!--                             <a onclick="updatePrdtList('C');" style="height: 25px; line-height: 25px;" authchk><i class="fas fa-plus"></i>등록</a> -->
<!--                             <a onclick="updatePrdtList('U');" style="height: 25px; line-height: 25px;" authchk><i class="fas fa-minus"></i>수정</a> -->
                           <div style="padding: 10px;">

                              <button class="btn btn-default btn-xs" data-grid-control="row-add" style="height: 25px; line-height: 25px;"authchk>+</button>
                              <button class="btn btn-default btn-xs" data-grid-control="row-remove" style="height: 25px; line-height: 25px;" authchk>-</button>
                           </div>
<!--                           </div> -->
                      </div>

    	                   <div data-ax5grid="PD01-grid" data-ax5grid-config="{}" style="height:300px; width: 100%" >
                           </div>
    	              </div>
        	      </li>
        	      <li>
  	                <div class="table_list_tit">
                              <h5 align="left" class="tit">아이템 상세 내역</h5>
                          <div class="add_btn_small">
<!--                            <a onclick="updateItemList('C');" style="height: 25px; line-height: 25px;" authchk><i class="fas fa-plus"></i>등록</a> -->
<!--                             <a onclick="updateItemList('U');" style="height: 25px; line-height: 25px;" authchk><i class="fas fa-minus"></i>수정</a> -->
                           <div style="padding: 10px;">

                              <button class="btn btn-default btn-xs" data-grid-control="row-add2" style="height: 25px; line-height: 25px;"authchk>+</button>
                              <button class="btn btn-default btn-xs" data-grid-control="row-remove2" style="height: 25px; line-height: 25px;" authchk>-</button>
                           </div>

                          </div>

            	             <div data-ax5grid="PJ01-grid" data-ax5grid-config="{}" style="height: 300px; width: 100%" >
                             </div>
                         </div>
                         </div>
                    </li>
                </ul>
         </div>
      <br>
				<div>
					<button type="button" id="prjctActionBtn" authChk>등록</button>
					<button type="button" class="close_btn"
						onclick="modalStack.close();">닫기</button>
				</div>



<script type="text/javascript">
debugger;
var actionType = null;
var prdtArr = [];
var firstGrid = null;
var secondGrid = null;

var PD01GridView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	 showRowSelector: true,
		    	 multipleSelect: false,
		    	 sortable: false,
		         target: $('[data-ax5grid="PD01-grid"]'),
		         header: {
		        		 align: "center",
		        		 selector: false
		         },
		         body: {
			        	 onClick: function () {
// 			        	 onClick: function (event, columnIndex) {
			                this.self.select(this.dindex);
			                 $("#prjctSeq").val( this.item.prjctSeq );
			                 $("#prjctPrdtCd").val( this.item.prjctPrdtCd );
			               /* 클릭했을 때 prjctSeq와 prjctPrdtCd(PK) */

			                PJ01GridView.initView().setData(this.item.prjctSeq);
			                /*"PJ01GridView" 객체의 초기화 및 데이터 설정을 수행
			                현재 그리드는 PD01Grid(첫번째) 이거 누르면 PK인prjctSeq를 기준으로
			                  프로젝트그리드(두번째)를 다시 그려라 */


			        	 },
	            onDBLClick: function () {
//	            onDBLClick: function (event, columnIndex) {

	            },
	        },
		        page: {
		            navigationItemCount: 9,
		            height: 30,
		            display: true,
		            firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
		            prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
		            nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
		            lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
		            onChange: function () {
		            	gridView.setData(this.page.selectPage);
		            }
		        },
		        columns : [
		            {key : "prjctSeq",  	label : "프로젝트시퀀스",   width : 30}
		           ,{key : "prjctPrdtCd",  	label : "설비코드",      	width : 80,	hidden: true}
		           ,{key : "prjctPrdtCd",  	label : "설비코드",      	width : 80,	hidden: true}
		           ,{key : "prjctPrdtCd",  	label : "설비코드",      	width : 80,	hidden: true}
		           ,{key : "prdtNm",  		label : "대상설비",      	width : 208,	editor: {type: "text"}}
		           ,{key : "prjctItemRmk", 	label : "특이사항",   		width : 200,  	editor: {type: "textarea"}}
			     ]
		    });
			return this;
		},


        setData: function(){
    		PJ01GridView.initView().setData(0); //데이터 설정 및 초기화
// 		 	 $("#prjctSeq").val("");  													//id가 "prjctSeq"인 요소의 값 초기화

        		 /* "PJ01GridView"라는 객체의 "initView" 함수를 호출 후,
        		반환된 결과에 대해 "setData" 함수를 호출. 값은 0(초기화) */

        		firstGrid = this.target;
        		 //firstGrid 변수설정
        		 var formData = {
              	"prjctPrdtCd" : $("#prjctPrdtCd").val(),
      					"prdtNm" : $("#prdtNm").val(),
      					"prjctItemRmk" : $("#prjctItemRmk").val(),
//       				"pageNo" : _pageNo + 1,
//       				"recordCnt" : $("#recordCnt").val()
        		 }

    		postAjax("/admin/bm/bm16/selectPrdtList", formData, null, function(data) {
				var list = data.prdtList;
// 		  prdtArr = list; // prdtArr를 list로 설정

				/* "/admin/bm/bm16/selectPrdtList"에 AJAX POST 요청.
				요청 시 "formData"라는 변수가 사용
				응답을 받았을 때 실행되는 콜백 함수가 제공 */

				firstGrid.setData({
            		list : prdtArr,
            		page : {
            			totalElements : prdtArr.length				 	//그리드 하단 파일 수 표시용
            		}
       			 });
				/* 	콜백 함수 내부에서는 "prjctInfo.prdtList"라는 변수에 할당된 리스트를 "list" 변수에 저장.
					"firstGrid" 객체의 "setData" 함수를 호출하여 데이터를 설정
					설정되는 데이터는 "prdtArr"라는 변수,
					이 변수는 전체 길이를 나타내는 속성인 "totalElements"를 가진 "page" 객체와 함께 "list"로 전달됩니다. */
    	 	});
     	   }
        }


var itemArr = [];
var deleteItemArr = [];
var PJ01GridView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	 showRowSelector: true,
		    	 multipleSelect: true,
		    	 sortable: false,
		         target: $('[data-ax5grid="PJ01-grid"]'),
		         header: {
			        		 align: "center",
			        		 selector: false
		        },
		        body: {
  			        	 onClick: function () {
  			                this.self.select(this.dindex);
			                $("#prjctSeq").val(this.item.prjctSeq);

	            },
	            onDBLClick: function () {

	            },
	        },
		        page: {
		            navigationItemCount: 9,
		            height: 30,
		            display: true,
		            firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
		            prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
		            nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
		            lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
		            onChange: function () {
		            	gridView.setData(this.page.selectPage);
		            }
		        },
		        columns : [
		               {key : "isChk",    		label : "선택",   		width : 80,
	          	  		editor: {type: "checkbox",	config: {height : 20,	trueValue : "Y",	falseValue : "N"}}}
                  ,{key : "prjctSeq",  		label : "프로젝트시퀀스", 	width : 40}
		              ,{key : "codeId",			  label : "코드아이디",  hidden: true}
		              ,{key : "prjctItemCd", 	label : "등록아이템코드", 	width : 100,   hidden: true}
		              ,{key : "codeNm",  	  	label : "아이템내역",      	width : 200,	editor: {type: "text"}}
		              ,{key : "prjctRmk", 		label : "비고",   		    	width : 208,  editor: {type: "textarea"}}
		         	]
		    });
			return this;
		},

		setData: function(){
			secondGrid = this.target;
   		 var formData = {
          "prjctSeq" : $("#prjctSeq").val(),
        	"prjctItemCd" : $("#prjctItemCd").val(),
   				"codeNm" : $("#codeNm").val(),
   				"prjctRmk" : $("#prjctRmk").val()
   		 }
			// 페이징 전체 유무
// 			var recordCnt = $("#recordCnt").val();
// 			if(recordCnt == '9999'){formData.pageNo = 1;}

		postAjax("/admin/bm/bm16/selectItemList", formData, null, function(data) {
				var list = data.itemList;

        for(var i=0; i<list.length; i++) { 						//  isChk 값이 true인 데이터만 itemArr에 추가
            if(list[i].isChk == true) {
                itemArr.push(list[i]);
            }
        }

			secondGrid.setData({
				list : itemArr,
				page : {
					totalElements : itemArr.length
				}
	     });
	});
	}
}

	$(document).ready(function() {
		setCommonSelect($(".popup_area select[data-kind]"));
		$("#userId").val(jwt.userId);
		$("#pgmId").val(jwt.pgmId);
		$("#prjctSeq").val(jwt.prjctSeq);
                                    // 		$("#clntNm").val(jwt.clntNm);
                                                                  // 		$("#coCd").val(jwt.coCd)
                                                                  // 		$("#popForm #ordrsAmt").attr("disabled", true); //수주금액은 호출만

		selectPrjctInfo();				//프로젝트 정보 호출

		//계약년월//
		$('#yyyymm').datepicker({
			format : "yyyy-mm",
			language : "ko",
			autoclose : true
		}).datepicker("setDate", "today");
		//예상납기//
		$('#dudtPlanDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		}).datepicker("setDate", "today");
		//수주예정//
		$('#ordrsPlanDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		}).datepicker("setDate", "today");
		//수주일//
		$('#ordrsDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		}).datepicker("setDate", "today");

		//PD01 열추가,삭제//
		$('[data-grid-control]').click(function () {
              switch (this.getAttribute("data-grid-control")) {
                case "row-add":
                     var newRow = $.extend({}, firstGrid.list, {__index: undefined});
                     firstGrid.addRow(newRow);
                     openMenuOnDoubleClick(newRow); // Call the function to open the menu on double-click
                     break;
	            case "row-remove":
	             	 firstGrid.removeRow();
	                  break;
	    		}
		});

		//PJ01 열추가,삭제//
		$('[data-grid-control]').click(function () {
	           switch (this.getAttribute("data-grid-control")) {
	              case "row-add2":
	            	  secondGrid.addRow($.extend({}, secondGrid.list, {__index: undefined} ));
	                  break;
	              case "row-remove2":
	            	  secondGrid.removeRow();
	                  break;
	    		}
		});




		// 저장/수정 기능(원복)
	var actionType = modalStack.last().paramObj.actionType;
		//변수 actionType을 선언하고, modalStack.last().paramObj.actionType의 값을 할당
		if (actionType == "C") {
			/* $("#prjctActionBtn").text("등록");을 통해 id가 "prjctActionBtn"인 요소의 텍스트를 "등록"으로 설정.
			   $('#prjctActionBtn').on("click", function() { insertPrjct(); });를 통해 id가 "prjctActionBtn"인 요소의 클릭 이벤트에 대한 핸들러를 등록.
			   클릭 시 insertPrjct() 함수 호출 */
			$("#prjctActionBtn").text("등록");
			$('#prjctActionBtn').on("click", function() {
			insertPrjct();
			});

		} else if (actionType == "U") {
			/* actionType의 값이 "U"인 경우에는 다른 조건문 블록이 실행.
			PD01GridView.initView();와 PJ01GridView.initView();를 통해 PD01GridView와 PJ01GridView 객체의 초기화를 수행. */
			PD01GridView.initView();
			PJ01GridView.initView();

            /* $('#prjctActionBtn').text("수정");를 통해 id가 "prjctActionBtn"인 요소의 텍스트를 "수정"으로 설정
			   $('#prjctActionBtn').on("click", function() { updatePrjct(); });를 통해 id가 "prjctActionBtn"인 요소의 클릭 이벤트에 대한 핸들러를 등록
			클릭 시 updatePrjct() 함수가 호출 */
			$('#prjctActionBtn').text("수정");
			$('#prjctActionBtn').on("click", function() {
				updatePrjct();
			});
		}

		authChk();						// 권한체크
	});

//------------------------------------------------------------//

// function openMenuOnDoubleClick(row) {
//     // Assuming prjctPrdtCd and prdtNm are the newly added fields
//     // You can attach a double-click event listener to the corresponding cells in the grid
//     // When double-clicked, open the menu for selecting a value
//     var prjctPrdtCdCell = firstGrid.getCells("prjctPrdtCd")[row.__index];
//     var prdtNmCell = firstGrid.getCells("prdtNm")[row.__index];

//     $(prjctPrdtCdCell.element).on("dblclick", function () {
//         // Open menu for selecting prjctPrdtCd value
//         // Add your code here to handle the menu opening
//     });

//     $(prdtNmCell.element).on("dblclick", function () {
//         // Open menu for selecting prdtNm value
//         // Add your code here to handle the menu opening
//     });
// }

//------------------------------------------------------------//

    var prjctDtl;
	function setPrjctInfo(obj) {
		var itemInfo = obj.itemList;
		var prdtInfo = obj.prdtList;
		var prjctInfo = obj;
		prjctDtl = obj.prjctDtl;

		//메인정보 세팅
		$.each(prjctInfo, function(key, value) {
			$('#' + key).val(value);
        			/* prjctInfo 객체를 $.each() 함수를 사용하여 반복(iteration). $.each() 함수는 jQuery 라이브러리의 함수로,
        			 객체 또는 배열의 각 요소에 대해 반복 작업 수행
        			 각 반복에서는 key와 value 매개변수가 사용
        			 key는 현재 요소의 키(key), value는 해당 요소의 값(value).
        			 반복문 내부에서는 $( '#' + key ).val(value); 코드가 실행.
        			 이 코드는 선택자를 사용하여 해당하는 요소를 찾고, value를 해당 요소의 값으로 설정합니다.
        			 key를 사용하여 '#' + key로 선택자를 생성하고, 해당 선택자에 대한 요소의 값을 value로 설정합니다.
        			 위의 코드는 prjctInfo 객체의 각 요소를 순회하면서 해당 요소의 키를 id로 갖는 요소를 찾아 값을 설정 */

			//수주확정 set
			if (key == "winbdCd" && value == "Y") {
				$('#' + key).prop("checked", true);
			}
        			/* key와 value를 확인한 후 작업을 수행합니다.
        			 조건문은 key가 "winbdCd"이고 value가 "Y"인 경우를 확인합니다.
        			 이 조건이 참인 경우, $('#' + key).prop("checked", true); 코드가 실행됩니다.
        			 이 코드는 key를 사용하여 해당하는 요소를 선택하고, prop() 함수를 사용하여 해당 요소의 "checked" 속성을 true로 설정합니다.

        			 즉, 위의 코드는 "winbdCd"라는 특정 키의 값이 "Y"인 경우, 해당 요소의 체크 상태를 선택된(true) 상태로 설정 */
		});
	}

	function selectPrjctInfo() {						//그리드에 뿌리는 데이터
		var row = gridView.target.getList("selected")[0];
		var formData = {
			"prjctSeq" : row.prjctSeq,
			"mngId"    : row.mngId
		}
		postAjax("/admin/bm/bm16/selectPrjctInfo", formData, null, function(
				data) {
			setPrjctInfo(data.result);
		});
	}

	function setPrjctInfo(prjctInfo) {					//기본정보 set
		$.each(prjctInfo, function(key, value) {
			if ($('#' + key)[0]) {
				console.log(key + " :: " + value);
				$('#' + key).val(value);
				if ($('#' + key).is('[comma]')) {
					onlyNumber($('#' + key)[0]);
				}
			}
		});

		prdtArr = prjctInfo.prdtList;
		itemArr = prjctInfo.itemList;

		PD01GridView.setData(prjctInfo.prdtList); 		//첫 번째 그리드의 데이터를 불러오기
		PJ01GridView.setData(prjctInfo.itemList); 		//두 번째 그리드의 데이터를 불러오기
	}


	//-----아래로 인서트,업데이트 PrdtList , ItemList 개별 저장 ----------------------//
    //--  SD0601M01 복사 수정 본 참고자료-----  //

// 	function updatePrdtList(type){
// 		actionType = type;

// 		if ( actionType == 'U' && selectGridValidation(firstGrid))
// 			return;

// 		openSecondModal("/static/html/admin/bm/bm16/bm1602d01.html", 400, 100, "대상설비");
//          // 중복 모달 창 띄우기
//       			$('#prjctSeq').val(row.prjctSeq);
//       			$('#prjctPrdtCd').val(row.prjctPrdtCd);
//       			$('#prjctItemRmk').val(row.prjctItemRmk);
// 	}

// 	function updateItemList(type){
// 		//updatePrdDtltList로 계획했으나 ItemList를 재활용하는 것이 맞을듯.
// 		actionType = type;

// 		if ( actionType == 'U' && selectGridValidation(secondGrid))
// 			return;

// 		if ( actionType == 'C' && selectGridValidation(firstGrid))
// 			return;

// 		openSecondModal("/static/html/admin/bm/bm16/bm1602d02.html", 400, 100, "아이템상세내역");

// 	}

	//-----인서트,업데이트,삭제 구문 ----------------------//
 /* 기존 저장과 중복 될 수 있음. 개별 저장 완료 후 수정 필요 */

	 // 등록
	function insertPrjct() {
		if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사
			var formData = makeFormData();															// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
			filePostAjax("/admin/bm/bm16/insertPrjct", formData,				// 파일을 포함한 데이터를 서버로 전송하는 비동기적인 AJAX 요청을 수행
					function(data) {
						alert(data.resultMessage);														// 결과 메시지를 alert으로 출력
						if (data.resultCode == 200) {													//  요청이 성공(200)한 경우, gridView.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
							gridView.setData(0);																// 결과갑시 200인 경우 리드 뷰를 업데이트
							modalStack.close();																  // 모달을 닫음
						}
					});
		}
	}

	// 수정
	function updatePrjct() {
		if (inputValidation($('.popup_area [required]'))) {									// 필수 필드의 유효성 검사
			var formData = makeFormData();																		// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
	      	filePostAjax("/admin/bm/bm16/updatePrjct", formData,function(data) {
						alert(data.resultMessage);
						if (data.resultCode == 200) {

							gridView.setData(0);
//                             PD01GridView.gridView.setData(0);
//                             PJ01GridView.gridView.setData(0);
							modalStack.close();
						}
					});
		}
	}
	 /* 기존 저장과 중복 될 수 있음. 개별 저장 완료 후 수정 필요 */
/* 프로젝트 인서트, 업데이트 조건에 따른 간섭이 없는지 재확인 할 것 */

	//----------------------------------------------//

	function makeFormData() {
		// 금액 콤마 제거
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		// 폼데이터 생성
		var formData = new FormData($("#popForm")[0]);
		// 유저아이디 추가
		formData.append("userId", jwt.userId);

		//-------itemarr
		$.each(itemArr, function(idx, obj) {
			if (obj.fileKey == 0) {
				formData.append("files", obj.file);
			}
				//  itemArr 배열의 각 항목에 대해 반복하면서 obj.fileKey가 0인 경우에만 formData 객체에 "files"라는 키와 obj.file을 추가합니다.
		});
		//-------prdtArr
		$.each(prdtArr, function(idx, obj) {
			if (obj.fileKey == 0) {
				formData.append("files", obj.file);
			}
		});
		//  prdtArr 배열의 각 항목에 대해 반복하면서 obj.fileKey가 0인 경우에만 formData 객체에 "files"라는 키와 obj.file을 추가합니다.

		formData.append("deleteItemArr", JSON.stringify(deleteItemArr));
		if (actionType == "D") {
			formData.append("deleteItemArr", JSON.stringify(deleteItemArr));
		}
/* 	deleteItemArr 배열을 JSON 문자열로 변환하여 formData에 "deleteItemArr"키와 함께 추가하고,
		만약 actionType이 "D"인 경우에는 다시 같은 작업을 수행하여 formData에 추가 */




/* -----인서트,업데이트,삭제 때 사용하는 구문. ---------------------- */
		//이 코드는 주어진 조건에 따라 list 내의 객체를 처리하고, 처리된 결과를 detailArr 배열에 저장한 후, 해당 배열을 JSON 문자열로 변환하여 formData에 추가하는 작업을 수행.

// 	var list = PJ01GridView.target.list; 							//상세내역 그리드 항목에 있는 내용이 담겨있는 자료들의 집합,PD01쪽 데이터를 추후 고려할 것
		var list = PD01GridView.target.list;
		var detailArr = []; 				 // 처리할 대상 자료만 모아놓을 자료배열변수
		$.each(list,
				function(idx, obj) {
					if ((!obj.prjctItemCd || obj.prjctItemCd == "")
							&& obj.isChk == 'Y') {
						obj.dtaChk = 'I';
						obj.prjctPrdtCd = $("#prjctPrdtCd").val();
						obj.prjctSeq = $("#prjctSeq").val();
						detailArr.push(obj);
					} else if (obj.prjctItemCd && obj.isChk == 'Y') {
						obj.dtaChk = 'U';
						obj.prjctPrdtCd = $("#prjctPrdtCd").val();
						detailArr.push(obj);
					} else if (obj.prjctItemCd && obj.isChk == 'N') {
						obj.dtaChk = 'D';
						detailArr.push(obj);
					}
				});

/* 	PD01GridView.target.list를 list로 변수 할당
		빈 배열인 detailArr를 선언
		$.each 함수를 사용하여 list의 각 항목에 대해 반복	조건문을 동작을 수행

		 obj.projectItemCd가 비어있거나 obj.isChk가 'Y'인 경우, obj.dtaChk를 'I'로 설정하고 detailArr에 해당 객체를 추가
		그렇지 않고 obj.prjctItemCd와 obj.isChk가 'Y'인 경우, obj.dtaChk를 'U'로 설정하고 detailArr에 해당 객체를 추가
		그렇지 않고 obj.prjctItemCd가 존재하고 obj.isChk가 'N'인 경우, obj.dtaChk를 'D'로 설정한 후 detailArr에 해당 객체를 추가합니다. */

		formData.append("detailArr", JSON.stringify(detailArr));//선택된 ROW 만 formData에 저장
		return formData;
	}

/* 	formData 객체에 "detailArr"라는 키와 detailArr 배열을 JSON 문자열로 변환하여 추가.
	  최종 formData 객체를 반환. */

/* 	-----위로 인서트,업데이트,삭제 구문 ---------------------- */




/* 	-----아래로 검색용 함수, ETC ----------------------------- */

	//  업체명 검색 //
	function clntSearch() {
		openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420,
				"업체명 검색", {}, function(grid) {
					var row = grid.target.getList("selected")[0];
					$('#prjctSeq').val(row.prjctSeq);
					$('#clntCd').val(row.clntCd);
// 					$('#clntNm').val(row.clntNm);

					var paramObj = {
						"coCd" : $('#coCd').val(),
						"clntCd" : row.clntCd

					}
					setMngInfo(paramObj);
				});
	}

	// 영업담당자 set
	function setMngInfo(paramObj) {
		postAjax("/admin/bm/bm02/selectMngInfo", paramObj, null,
				function(data) {
					if (data.mngInfo) {
						$('#mngId').val(data.mngInfo.salesEmpId);
						$('#mngIdNm').val(data.mngInfo.salesEmpNm);
					} else {
						$('#mngId').val("");
						$('#mngIdNm').val("");
					}
				});
	}

	//  업체담당자 검색 //
	function clntSearch2() {
		var paramObj = {
			"coCd" : "GUN", //$('#coCd').val(),
			"userId" : $('#clntMngNm').val(),
			"useYn" : "Y"
		};

		openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420,
				"업체담당자 검색", paramObj, function(grid) {
					var checkedId = tree.get_checked()[0];
					var checkedNode = tree.get_node(checkedId);
					$('#clntCd').val(checkedNode.id);
					$('#clntMngNm').val(checkedNode.text);
				});
	}

	function setByCoCd(value) {
		$('#coCd').data("desc", value);
		$('#coCd option:not([value=""])').remove();
		setCommonSelect($('#coCd'));
	}

</script>