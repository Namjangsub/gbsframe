<div id="pmPopForm" class="popup_area of_a" style="width: 100%; height: 100%;">
	<div class="tit_contents">
		<h4 class="tit">작업일보 결과표</h4>
	</div>
	
	<form id="popForm" onSubmit="return false;">
		<div class="form-group popup_table">
			<input type="hidden" id="fileTrgtKey" name="fileTrgtKey">
			<input type="hidden" id="deptCd"  name="deptCd">
			<input type="hidden" id="pgmId"       name="pgmId" value="PM4001P02">
			<table>
				<colgroup>
					<col width="11%">
					<col width="14%">
					<col width="11%">
					<col width="14%">
					<col width="11%">
					<col width="14%">
					<col width="11%">
					<col width="14%">
				</colgroup>
				<!-- 1행 -->
				<tr>
					<th>작성자</th>
					<td>
		               <div class="search_form">
		               	  <input type="hidden"	id="coCd" name = "coCd" readonly="readonly">						
					      <input type="hidden" id="ordrgId" name="ordrgId"  data-search="ordrgId"  >
		             	  <input type="text"	id="ordrgNm"  name="ordrgNm" readonly="readonly">
		               </div>
					</td>
					<th>년월</th>
					<td>
						 <div class="date_input">
<!-- 						   <select id="writeYear" name="writeYear" data-search="writeYear" style="width:100px;"> -->
<!-- 						   </select> -->
<!-- 						   <select id="writeMonth" name="writeMonth" data-search="writeMonth"  style="width:100px;" onchange="Modal_DataSearch();"> -->
<!-- 						   </select>							 -->
						   <input type="month" id="workYm" name="workYm"  msg="년월"  style="height:25px" max="9999-12" >
						 </div>					
					</td>
					<th>고찰번호</th>
					<td>
						 <div class="search_form">
						   
						   <input type="text"	id="workNo" name="workNo" readonly="readonly">						
						 </div>					
					</td>
					<th>고찰일자</th>
					<td>
						 <div class="search_form">	
						   <input type="text" id="resDt" name = "resDt"  readonly="readonly">						
						 </div>											
					</td>
				</tr>

			</table>
		</div>
			<!-- 콘텐츠 -->
			<div class="contents">
				<!-- 리스트 -->
				<div class="ax5_grid">
					<div>
						<div data-ax5grid="first-grid-modal" data-ax5grid-config="{}" style="height:400px; width: 100%" ></div>
					</div>
				</div>
			</div>
		<table>
			<tr>
					<th class="">1. 잘한점</th>
					<td colspan="7">
						<textarea class="form-control" id="workGoodTxt" name="workGoodTxt" style="height: 60px;"></textarea>
					</td>
				</tr>
				<tr>
					<th class="">2. 아쉬운점</th>
					<td colspan="7">
						<textarea class="form-control" id="workBadTxt" name="workBadTxt" style="height: 60px;"></textarea>
					</td>
				</tr>
				<tr>
					<th class="">3. 개선할점</th>
					<td colspan="7">
						<textarea class="form-control" id="workNeedTxt" name="workNeedTxt" style="height: 60px;"></textarea>
					</td>
				</tr>
				<tr>
					<th class="">4. 건의사항</th>
					<td colspan="7">
						<textarea class="form-control" id="workProposalTxt" name="workProposalTxt" style="height: 60px;"></textarea>
					</td>
				</tr>
				<tr>
					<th class="">비고</th>
					<td colspan="7">
						<textarea class="form-control" id="workRmk" name="workRmk" style="height: 60px;"></textarea>
					</td>
				</tr>
		</table>
	<table>
			
			<td colspan= 5>
	          <!-- 공유대상자-->
	          <div class="popup_table" id="approval_trgt">
	              <table style="border:0px;">
	                  <tr style="height:30px;">
	                    <td style="text-align: LEFT; border-right: 0px;;font-size:13px;font-weight:bold;">※ 공유 및 결재</td>
	                    <td colspan="3">
	                       <div class="add_btn_small pdl10" id="plus-minus">
	                         <a onclick="insertShareUserModal();" style="height: 30px; line-height: 28px;" authchk>+</a>
	                         <a onclick="deleteShareUser();" style="height: 30px; line-height: 28px;" authchk>-</a>
	                     </div>
	                    </td>
	                  </tr>
	                 <tr>
	                    <td colspan="4">
	                     <div>
	                   		<div class="ax5_grid" data-ax5grid="third-grid-modal" data-ax5grid-config="{}" style="height: 300px; width: 100%;" ></div>
	                  	 </div>
	                 	</td>
	              	 </tr>
	              </table>
	          </div>
          </td>
			</table>
	</form>
	
	<!-- 공통 파일 영역 -->
	<div id="fileList_area" style="display: none;"></div>
	<!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtn" authChk>등록</button>
		<button type="button" id ="reportBtn" onclick="setReportOrderDetail(1);" authChk>팀고찰출력(1)</button>
		<button type="button" id ="reportBtn" onclick="setReportOrderDetail(2);" authChk>팀고찰출력(2)</button>
		<button type="button" class="close_btn" onclick="modalStack.close();">닫기</button>
	</div>
</div>


<script type="text/javascript">
	
	var actionType  = null;
	var beforeGridSize = 0; //수주상세그리드의 갯수용 그리드컨텐츠 높이조절용
	var userName  = [];
	var userDeptId = jwt.deptId; //소속부서
	var userDept = userDeptId.substr(0, 5); //상위 소속부서
	var workNo = null;
	
	var kakaoCnt = 0;
	var kakaoErr = [];
		
	var gridViewPop = {
		initView : function() {
			this.target = new ax5.ui.grid();
			this.target.setConfig({
				showRowSelector: true,
				multipleSelect: false,
			    sortable: false,
			    target: $('[data-ax5grid="third-grid-modal"]'),
			    header: {
			       align: "center",
			       selector: true
			    },
			    body: {
			        onClick: function () {
			            this.self.select(this.dindex);
			        },
			        onDBLClick: function () {
			        },
			    	mergeCells : ["gb"],
			    },
		        page : {
		           navigationItemCount : 10,
		           height : 30,
		           display : true,
		           firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
		           prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
		           nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
		           lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
		           onChange : function() {
		              gridView2.setData(this.page.selectPage);
		           }
		        },
		        columns : [
					{key: "gb",               label: "구분",         align: "center",   width: 40},
					{key: "sanctnSn",          label: "순번",       align: "center",   width: 50},
					{key: "coCd",               label: "coCd",      align: "center",   width: 50, hidden: true},
					{key: "wbsPlancoCdNm",      label: "회사명",      align: "center",   width: 130, hidden: true},
					//{key: "wbsSharngUserId",   label: "ID",         align: "center",   width: 130, hidden: false},
					{key: "usrNm",            label: "ID",         align: "center",   width: 130, hidden: true},
					{key: "empNo",            label: "사원번호",    align: "center",   width: 130, hidden: true},
		            {key: "name",             label: "성명",         align: "center",   width: 80},
		            {key: "jik",                label: "직위",         align: "center",   width: 60},
		            {key: "creatDttm",         label: "요청일자",    align: "center",   width: 90},
		            {key: "todoCfDt",            label: "확인일자",      align: "center",   width: 130},
		            {key: "todoCfOpn",         label: "확인의견",    align: "left",     width: 200},
//		             {key: "telNo",            label: "H.P",      align: "center",   width: 130},
		            {key: "todoKey",            label: "todoKey",      align: "center",   width: 130, hidden: true},
		            {key: "sanctnSttus",         label: "sanctnSttus",      align: "center",   width: 130, hidden: true},
		            {key: "todoId",            label: "todoId",      align: "center",   width: 130, hidden: true},
		            {key: "flag",               label: "flag",      align: "center",   width: 130, hidden: true}
		        ]
		    });
		    return this;
		},
						
		setData : function(_pageNo) {
			var targetObj = this.target;
			var formData = {
					"fileTrgtKey"  : "",
					"reqNo" 		: workNo,
					"pageNo" 		: _pageNo + 1
		    }

		    postAjax("/user/pm/pm40/selectSignResUserlst", formData, null, function(data){
				var list = data.result;
				targetObj.setData({
					list : list,
		            page : {
		                     totalElements : list.length
					}
				});
	
				$.each(list, function(idx, elem){
					if(elem.sanctnSn == 1 && elem.gb == "결재") {
					   $('#reportRegBtn').show();
					}
				});
		        gridResize1();
		    });
		       
		},

		setData2 : function(_list) {
		   this.target.setData({
		            list : _list,
		            page : {
		                     totalElements :  _list.length,
		        		}
		         });
		   gridResize1();
		},
		setData3 : function(_pageNo) {
			var targetObj = this.target;
			var paramObj = { 
				      "userId": $("#popForm #ordrgId").val()
			        , "appDiv": 'APPDIV02'
			};
			postAjax("/user/wb/wb20/selectSignResUserlstInit", paramObj, null, function(data){
		        var list = data.result;
		        targetObj.setData({
		                list : list,
		                page : { totalElements : list.length }
		        });
		        gridResize1();
			});
		}
	}
	
	
	
	
	var ModalgridView1 = {
			initView : function() {
				this.target = new ax5.ui.grid();
				this.target.setConfig({
			    	showRowSelector: true,
			    	multipleSelect: false,
			    	sortable: true,
			        target: $('[data-ax5grid="first-grid-modal"]'),
			        header: {
			        	align: "center",
			        	selector: true
			        },
			        body: {
			        	mergeCells : ["workRptLNm","workRptMNm","workRptSNm"],
			        	 onClick: function () {
			                this.self.select(this.dindex);
			            },
//	 		            onDBLClick: function () {
//	 		            },

			            grouping: {
		                    by: ["workRptMNm" ],
		                    columns: [
		                        {
		                            label: function () {
		                                return this.groupBy.labels.join(", ") + " 소계";
		                            }, colspan: 3, align: "center"
		                        },
								{key: "totalSum", 		collector: "sum", formatter:"money", align: "right"},
								{key: "totPct",  	collector: "sum", 	formatter:"money",	align: "right"},
		    					{key: "user1", 		collector: "sum", formatter:"money", align: "right"},
		    					{key: "user2", 		collector: "sum", formatter:"money", align: "right"},
		    					{key: "user3", 		collector: "sum", formatter:"money", align: "right"},
		    					{key: "user4", 		collector: "sum", formatter:"money", align: "right"},
		    					{key: "user5", 		collector: "sum", formatter:"money", align: "right"},
		    					{key: "user6", 		collector: "sum", formatter:"money", align: "right"},
		    					{key: "user7", 		collector: "sum", formatter:"money", align: "right"},
		    					{key: "user8", 		collector: "sum", formatter:"money", align: "right"},
		    					{key: "user9", 		collector: "sum", formatter:"money", align: "right"},
		    					{key: "user10", 	collector: "sum", formatter:"money", align: "right"},
		    					{key: "user11", 	collector: "sum", formatter:"money", align: "right"},
		    					{key: "user12", 	collector: "sum", formatter:"money", align: "right"},
		    					{key: "user13", 	collector: "sum", formatter:"money", align: "right"},
		    					{key: "user14", 	collector: "sum", formatter:"money", align: "right"},
		    					{key: "user15", 	collector: "sum", formatter:"money", align: "right"},
		                    ]
		                }		        
			        },

				page : {
					navigationItemCount : 10,
					height : 30,
					display : true,
					firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
					prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
					nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
					lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
					onChange : function() {
						gridView.setData(this.page.selectPage);
					}
				},

				footSum: [
				    	[
				    		{label: "총계", colspan:3, align:"center"},
						{key: "totalSum", 		collector: "sum", formatter:"money", align: "right"},
						{key: "totPct",  	collector: "sum", 	formatter:"money",	align: "right"},
						{key: "user1", 		collector: "sum", formatter:"money", align: "right"},
						{key: "user2", 		collector: "sum", formatter:"money", align: "right"},
						{key: "user3", 		collector: "sum", formatter:"money", align: "right"},
						{key: "user4", 		collector: "sum", formatter:"money", align: "right"},
						{key: "user5", 		collector: "sum", formatter:"money", align: "right"},
						{key: "user6", 		collector: "sum", formatter:"money", align: "right"},
						{key: "user7", 		collector: "sum", formatter:"money", align: "right"},
						{key: "user8", 		collector: "sum", formatter:"money", align: "right"},
						{key: "user9", 		collector: "sum", formatter:"money", align: "right"},
						{key: "user10", 	collector: "sum", formatter:"money", align: "right"},
						{key: "user11", 	collector: "sum", formatter:"money", align: "right"},
						{key: "user12", 	collector: "sum", formatter:"money", align: "right"},
						{key: "user13", 	collector: "sum", formatter:"money", align: "right"},
						{key: "user14", 	collector: "sum", formatter:"money", align: "right"},
						{key: "user15", 	collector: "sum", formatter:"money", align: "right"},
		                 ]
				    ],

		    	columns : [
						 {key: "workRptLNm", 	label: "부서구분", 			width: 140,		align: "left"}
						,{key: "workRptMNm",  	label: "업무분류", 			width: 180,		align: "left"}
						,{key: "workRptSNm",  	label: "업무일지", 			width: 450,		align: "left"}
						,{key: "totalSum",  	label: "합계", 			width: 70,		align: "right"}
						,{key: "totPct",  	label: "백분률", 			width: 70,		align: "right"}
		            ]

							});
	    			return this;
	    		},

		setData : function(_pageNo) {
			var targetObj = this.target;
			if (inputValidation($('input[required]'))) {
				
				var formData = {
					"coCd" 			: jwt.coCd,
					"workYm"	 	: $('#workYm').val().replace('-',''),
					"workRptId" 	: "",
					"workRptL" 		: $('#deptCd').val(),
					"userName" 		: userName,
				}
				postAjax("/user/pm/pm40/selectWorkPrtList", formData, null, function(data){
					var list = data.result;
				
					targetObj.setData({
							list : list,
							page : {
								totalElements : list.count,
							}
					});
					
					gridResize2();
				});
			}
		}
	}
	
	
	//화면 초기 설정
	$(document).ready(function() {
		setCommonSelect($(".popup_area select[data-kind]"));
		$("#coCd").val(modalStack.last().paramObj.coCd);
		
		//고찰일자//
		$("#resDt").val(new Date().format('yyyy-MM-dd'));
		
		ModalgridView1.initView();
		gridViewPop.initView();
		
		SetYm(); //월 셀렉트박스 세팅
		GridHeaderWrite(); //메인그리드 헤더 그리기

		authChk(); //권한체크
		
		actionType = modalStack.last().paramObj.actionType;
		workNo = modalStack.last().paramObj.workNo;
		
		formActionControl();
		
		
		//왜 결재를 이쪽으로 빼 놓았나??????
		//왜 첨부자료 기능은 안넣고 이렇게 한건가?
		var _todoViewMode =modalStack.last().paramObj.todoView;
		if (_todoViewMode != undefined && _todoViewMode == "INQ") {
			$('.tit').text('작업 일보 팀 고찰 조회');
			
			$('#popForm #actionBtn').remove();
			$("#plus-minus").remove();
			$('#actionBtn').remove();
			//input readonly, radio.checkbox disabled
			$.each($('#popForm select, input, textarea'), function(idx, elem){
	            var id = $(elem).attr("ID");
	            if( id ) {
	               var eleId = "#popForm #"+id;
	               if( $(elem).prop('tagName') == "INPUT" ) $(eleId).attr("readonly", true);
	               if( $(elem).prop('tagName') == "TEXTAREA" ) $(eleId).attr("readonly", true);
	               if( $(elem).prop('tagName') == "SELECT" ) $(eleId).css({'background-color':'#e6e6e6', 'pointer-events':'none'});
	               if( $(elem).prop('type') == "checkbox" || $(elem).prop('type') == "radio") $(eleId).on('click', function(e) {e.preventDefault();});
	            }

			});


		}

		//년월이 바꾸면 등록된 내용 있는지 확인 필요
		//writeMonth
		$('#workYm').on("change", function(){
     		var formData = {
     				'workYm'  : $('#workYm').val().replace('-',''),
     				'userId'  : $("#popForm #ordrgId").val(),
     				'workDiv' : '팀'
    			}
   			postAjaxSync("/user/pm/pm40/select_pm40_Check_Info", formData, null, function(data) {
   				
   				if (data.result != null) {	//해당 자료가 존재해야함
   					//수정모드로 진입한것과 동일하게 파라메터 변경 처리				
   					actionType = modalStack.last().paramObj.actionType = "U"
   					workNo = modalStack.last().paramObj.workNo = data.result.workNo;
   					modalStack.last().paramObj.userId = data.result.userId;
   					modalStack.last().paramObj.userNm = data.result.userNm;
   					modalStack.last().paramObj.deptCd = data.result.deptCd;
   					modalStack.last().paramObj.workYm = data.result.workYm;
   					
   				} else {
   					actionType = modalStack.last().paramObj.actionType = "C"
   					workNo = modalStack.last().paramObj.workNo = "";
   				}
   			});
        	formActionControl();
		});
	
		//---------------------------------------------------------------
		//첨부 화일 처리 시작
		//---------------------------------------------------------------
		fileParam = {
            fileTrgtTyp		: $("#popForm #pgmId").val(),
            fileTrgtKey		: $("#popForm #workNo").val(),
            todoNo			: $("#popForm #workNo").val(),		//결재정보처리를 위함
		}
		treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
		//---------------------------------------------------------------
		//첨부 화일 처리 끝
		//---------------------------------------------------------------

		
	});
	
	//화면단에서 년월을 변경했을때 기존 등록된 자료처리 및 신규등록에 대한 컨트롤 작업용
	function formActionControl() {
		if (actionType == "C") {
			$("#deptCd").val(jwt.deptId.slice(0,5));
			$("#popForm #ordrgId").val(jwt.userId);
			$("#popForm #ordrgNm").val(jwt.userNm);
			//버튼명 변경
			
			$("#actionBtn").text("등록");
			$('#actionBtn').on("click", function() {
				insert_pm40_p02();
			});
			$('#reportBtn').remove();
			//발행자 세팅
			gridViewPop.setData3(0);
			ModalgridView1.setData(0);
			
		} else if (actionType == "U" || actionType == "T" || actionType == "S") {
			//타이틀명 변경
			$('.tit').text('작업일보 월별 고찰 수정')
			$('#popForm #workYm').css({'background-color':'#e6e6e6', 'pointer-events':'none'});
			$("#popForm #ordrgId").val(modalStack.last().paramObj.userId);
			$("#popForm #ordrgNm").val(modalStack.last().paramObj.userNm);
			$("#popForm #deptCd").val(modalStack.last().paramObj.deptCd);
			$('#popForm #workYm').val(modalStack.last().paramObj.workYm);
			
			select_pm40_Info();
			
			//버튼명 변경
			$('#actionBtn').text("수정");
			$('#actionBtn').on("click", function() {
				update_pm40_p02();
			});
		}

	}
	
	
	//입력정보
	function select_pm40_Info() {
		var formData = {
				"workNo" : workNo,
		}
		postAjaxSync("/user/pm/pm40/select_pm40_Info", formData, null, function(data) {
			if (data.result.workNo) {	//해당 자료가 존재해야함
				$.each(data.result, function(key, value) {
					if ($('#popForm #' + key)[0]) {
						$('#popForm #' + key).val(value);
						if ($('#popForm #' + key).is('[comma]')) {
							onlyNumber($('#popForm #' + key)[0]);
						}
					}
					if (key === "userNm") {
			            $("#popForm #ordrgNm").val(value);
			        }
					if (key === "userId") {
			            $("#popForm #ordrgId").val(value);
			            
			            if (value != jwt.userId && data.result.creatId != jwt.userId) {	//수정 버튼 작성자이면 수정 가능하게 하고 아니면 수정버튼 숨김
							$('.popup_area #actionBtn').hide();
						} else {
							$('.popup_area #actionBtn').show();
						}
			        }
				});

				// 크기 조절할 textarea ID 리스트
				const textAreas = [
				    '#workGoodTxt',  // 잘한점
				    '#workBadTxt',   // 아쉬운점
				    '#workNeedTxt',  // 개선할점
				    '#workProposalTxt', // 건의사항
				    '#workRmk'       // 비고
				];
				// 각 textarea에 대해 크기 조절 함수 호출
				textAreas.forEach(textAreaId => {
				    txtareaHeightResize($(textAreaId));
				});
				
				ModalgridView1.setData(0);
				gridViewPop.setData(0);

				selectApprovalCheck(data.result.workNo);
				
			} else {
				alert('해당 고찰 자료가 없습니다.  전산실 확인 바랍!')
			}
		});

	}
	
	// 등록
	function insert_pm40_p02() {
		if (inputValidation($('.popup_area [required]'))) {		// 필수 필드의 유효성 검사
			var formData = makeFormData();
			filePostAjax("/user/pm/pm40/insert_pm40_p02", formData,	function(data) {
				alert(data.resultMessage);
				if (data.resultCode == 200) {
					$('#workNo').val(data.workNo);
					kakaoTodo();

					gridView.setData(0);
					
					modalStack.close();				// 모달을 닫음
				}
			});
		}
	}
	
	// 수정
	function update_pm40_p02() {
		
		if( approvalYn() ) {
	         alert("결재가 이미 진행중입니다.");
	         return;
	      }
		
	
		if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사
			var formData = makeFormData();										// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
			filePostAjax("/user/pm/pm40/update_pm40", formData,function(data) {
				if (data.resultCode == 200) {
					kakaoTodo();
					
					if (typeof gridView !== 'undefined') gridView.setData(0);
					
					modalStack.close();
				}
			});
		}
	}
	
	function makeFormData() {
		// 금액 콤마 제거
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		
		//////오늘 날짜의 월의 고찰을 등록하려할떄 체크
		var toDay = new Date().format("yyyyMM"); //오늘 날짜의 년월 체크
// 		var resDay = $("#writeYear").val() + $("#writeMonth").val(); //사용자가 등록하려는 년월
		var resDay = $('#workYm').val().replace('-',''); //사용자가 등록하려는 년월
		
		if (toDay < resDay){
			alert("해당 월에 고찰 등록은 할 수 없습니다.");
			return
		}
		
		// 폼데이터 생성
		var formData = new FormData($("#popForm")[0]);
		
		var writeDt = $("#resDt").val().replace(/\-/g, '');

		formData.append("userId", jwt.userId);
		formData.append("statym", resDay);
		formData.append("writeDt", writeDt);
		formData.append("resDiv", "팀");
		formData.append("workDiv", "팀");
		formData.set("workYm", resDay)
		//---------------------------------------------------------------
		//-------itemarr  --첨부화일 처리를 위한 부분 시작
		//---------------------------------------------------------------
		// 유저아이디 추가

		//상세자료 준비
 		var rowSharngList = gridViewPop.target.list;
        var ParamObj = modalStack.last().paramObj;

        var approvalArr = []; //결재정보
		//TITLE 추가
        var tempTitl = $("#workYm").val() + "월 팀 작업일보 고찰";//$("#clntNm").val(); + ',' /* + clntPjt + ',' */ + $("input[name='COBTP']:checked")[0].dataset.label + ', ' + $("input[name='CODECOBGB']:checked")[0].dataset.label ;

        //각업무에 맞는 param insert - 하드코딩값
		var addParam = {
					  coCd: $('#coCd').val()
					, salesCd: $("#workNo").val()
					, pgmId: $("#pgmId").val()
					, pgPath: "/user/pm/pm40/PM4001P02.html"
					, sanctnSttus: "N"
					, todoCoCd: $('#coCd').val()
					, todoNo: $("#workNo").val()
					, todoFileTrgtKey: $("#workNo").val()
					, userId: $("#ordrgId").val()
					, todoTitl:  wordRemove(tempTitl)
					, todoTitle:  wordRemove(tempTitl)
					, todoKey: ""
					, todoCodeKind: ""
					, todoCodeId: ""
			};

        let 결재순번 = 0;
        let 공유순번 = 0;
       if(rowSharngList.length > 0) {
           $.each(rowSharngList, function(idx, elem) {
		           	/* rowSharngList 내용입니다.
		           	{
					    "rnum": "2",
					    "wbsPlancoCd": "GUN",
					    "coCd": "GUN",
					    "wbsPlancoCdNm": "건양ITT",
					    "usrNm": "gyrsult10",
					    "empNo": "gyrsult10",
					    "name": "외부설계",
					    "telNo": "010-1234-1321",
					    "email": "발주요청서 실적 관리용입니다.",
					    "dtNm": "실적관리용",
					    "jik": "담 당",
					    "todoDiv1CodeId": "TODODIV20",
					    "gb": "결재",
					    "sanctnSttus": "N",
					    "sanctnSttusNm": "미승인",
					    "creatDttm": "2024-07-01",
					    "todoKey": "5778",
					    "sanctnSn": "2",
					    "todoId": "gyrsult10",
					    "todoDiv2CodeId": "TODODIV2020",
					    "salesCd": "24000-00DUMMY",
					    "flag": "U",
					    "__original_index": 1,
					    "__index": 1
					}
			   	*/
			   	if (elem.usrNm.includes('gyrsult')) {
			   		//퇴사자 또는 외주업체담담자등록용으로 결재 제외처리함
			   		// gyrsult10 외부설계
			   		// gyrsult20 외부기계
			   		// gyrsult30 외부전기
			   		// gyrsult90 퇴사자
			   	} else {
	               var approvalListObj = elem;

	               addParam["todoId"] = elem.usrNm;
	               addParam["empNo"] = elem.empNo;
	               addParam["name"] = elem.name;
	               addParam["telNo"] = elem.telNo;
	               addParam["email"] = elem.eMail;
	               addParam["gb"] = elem.gb;

	               ParamObj["actionType"] = (elem.gb == '공유')? "T" : "S";
	               addParam["pgParam"] = JSON.stringify(ParamObj);

	               if (elem.gb == '공유') {
		               	공유순번 += 1;
		               	approvalListObj["sanctnSn"] = 공유순번;
		               	approvalListObj["todoDiv1CodeId"] = "TODODIV10";
		               	approvalListObj["todoDiv2CodeId"] = "TODODIV1140";
	               } else if (elem.gb == '결재') {
		               	결재순번 += 1;
		               	approvalListObj["sanctnSn"] = 결재순번;
		               	approvalListObj["todoDiv1CodeId"] = "TODODIV20";
		               	approvalListObj["todoDiv2CodeId"] = "TODODIV2140";
	               }
	               const mergedParam = {...addParam, ...approvalListObj}//속성합치기
	               approvalArr.push(mergedParam);
			   	}
           });
       }

		//작성자와 발행자가 다를경우 발행자에게 공유카톡 자동 발송 추가
		if ($("#ordrgId").val().includes('gyrsult')) {
			//외주업체이면 공유제외 처리함
		} else {
			/* if (!$("#ordrgId").val().includes('gyrsult') && $("#userId").val() != $("#ordrgId").val()) {

	            addParam["todoId"] = $("#ordrgId").val();
	            addParam["usrNm"] = $("#ordrgId").val();
	            addParam["empNo"] = $("#ordrgId").val();
	            addParam["name"] = $('#ordrgNm').val();
	            addParam["telNo"] = '';
	            addParam["email"] = '';
	            addParam["gb"] = '공유';
	            ParamObj["actionType"] = "T";
	            addParam["pgParam"] = JSON.stringify(ParamObj);

	            var approvalListObj = {};

	           	공유순번 += 1;
	           	approvalListObj["sanctnSn"] = 공유순번;
	           	approvalListObj["todoDiv1CodeId"] = "TODODIV10";
	           	approvalListObj["todoDiv2CodeId"] = "TODODIV1140";

	            const mergedParam = {...addParam, ...approvalListObj}//속성합치기
	            approvalArr.push(mergedParam);
			} */
		}
		formData.append("approvalArr", JSON.stringify(approvalArr));
	    /*	결재그리드 insert make end */

		formData.append("S_todoDiv1CodeId", "TODODIV10");
		formData.append("S_todoDiv2CodeId", "TODODIV1140");
		return formData;
	}


	
	function selectApprovalCheck(value) {
	      var formData = {
	            "reqNo" : value
	      }
	      postAjaxSync("/user/qm/qm01/selectApprovalChk", formData, null, function(data) {//결재가 진행이 되었는지 안되었는지 DB체크
	         var list = data.result[0]
	          if (list == 'Y'){//결재가 한개라도 진행이 되었으면 알림창

	              //input readonly, radio.checkbox disabled
	            $.each($('#popForm select, input, textarea'), function(idx, elem){
	               var id = $(elem).attr("ID");
	               if( id ) {
	                  var eleId = "#popForm #"+id;
	                  if( $(elem).prop('tagName') == "INPUT" ) $(eleId).attr("readonly", true);
	                  if( $(elem).prop('tagName') == "TEXTAREA" ) $(eleId).attr("readonly", true);
	                  if( $(elem).prop('tagName') == "SELECT" ) $(eleId).css({'background-color':'#e6e6e6', 'pointer-events':'none'});
	                  if( $(elem).prop('type') == "checkbox" || $(elem).prop('type') == "radio") $(eleId).on('click', function(e) {e.preventDefault();});
	               }

	            });

	            $('.popForm #actionBtn').remove();
	            $("#plus-minus").remove();
	          }
	      });
	   }
	
	// 팝업 그리드 조회
	function Modal_DataSearch() {
		ModalgridView1.setData(0);
	}

	
	function SetYm(){
		if (modalStack.last().paramObj.workYm != undefined) {
			$("#popForm #workYm").val(modalStack.last().paramObj.workYm);
		} else {
			var nym = new Date().format('yyyy-MM');
			$("#popForm #workYm").val(nym);
		}
	}

    function GridHeaderWrite(){
		var userDeptId = jwt.deptId.substr(0, 5);
		var userDept = userDeptId.substr(0, 5);
		
		formData = {
					 "deps": userDept,
					 "userId": modalStack.last().paramObj.userId
		           }
		postAjaxSync("/user/pm/pm37/select_all_name", formData, null, function(data) {
			var list = data.result;
			userName='';
		
			 if (list.length > 0) {
                    $.each(list, function(idx, elem){
                    	ModalgridView1.target.addColumn({key: "user"+[idx+1], label:elem.name, width: 70, align: "right"});
                    	//excelView.target.addColumn({key: "user"+[idx+1], label:elem.name, width: 70,  align: "right"});
                    	userName += elem.name + ',';
                    });
			 }
		});
    }
    
    //결재 여부
    function approvalYn() {
       var gridList = gridViewPop.target.getList();
       var inCnt = 0;
       if( gridList.length > 0 ) {
            var msgArr = [];
            $.each(gridList, function (idx, elem) {
               //결재자가 본인이 아니면서 상태가 Y인 경우
               if( elem.todoId != jwt.userId && elem.sanctnSttus == "Y" ) inCnt++;
            })
       }
       return inCnt;
    }
    
    function insertShareUserModal() {
        if( approvalYn() ) {
          alert("결재가 이미 진행중입니다.");
          return;
       }

         var paramObj = {};
         var appshaList = gridViewPop.target.list;
         paramObj["coCd"] = $('#coCd').val();
         paramObj["useYn"] =  "Y";
         paramObj["userId"] =  $('#ordrgId').val();
         paramObj["userNm"] =  $('#ordrgNm').val();
         paramObj["approvalGrid"] = $.grep(appshaList, function(item) {return item.gb === "결재";
         }).map(function(item) {
                 return {
                     gb: "결재"
                   , id: item.usrNm
                   , text: item.name
                   , parent: item.jik
                   , deptNm: item.dtNm
                   , telNo: item.telNo
                   , offTelNo: item.offTelNo
                   , email: item.email
                   , id: item.todoId
                   , todoKey: item.todoKey
 	              , todoDiv2CodeId: item.todoDiv2CodeId
                   , sanctnSn: item.sanctnSn
                   , sanctnSttus: item.sanctnSttus
                   , todoCfDt: item.todoCfDt
                   , todoCfOpn: item.todoCfOpn
                   , flag: item.flag
                   , coCd: item.coCd
               };
         });
 		  paramObj["shareGrid"] =  $.grep(appshaList, function(item) { return item.gb === "공유";
 		        }).map(function(item) {
 		              return {
 		                  gb: "공유"
 		                , id: item.usrNm
 		                , text: item.name
 		                , parent: item.jik
 		                , deptNm: item.dtNm
 		                , telNo: item.telNo
 		                , offTelNo: item.offTelNo
 		                , email: item.email
 		                , id: item.todoId
 		                , todoKey: item.todoKey
 			            , todoDiv2CodeId: item.todoDiv2CodeId
 		                , sanctnSn: item.sanctnSn
 		                , sanctnSttus: item.sanctnSttus
 		                , todoCfDt: item.todoCfDt
 		                , todoCfOpn: item.todoCfOpn
 		                , flag: item.flag
 		                , coCd: item.coCd
 		            };
 		      });

         openSecondModal("/static/html/cmn/modal/userLstSearch.html", 900, 500, "작성자 검색", paramObj, function (approvalGrid, shareGrid){
//            console.log('결재라인 : ', approvalGrid.target.list);
//            console.log('공유라인 : ', shareGrid.target.list);

		    var appArray = approvalGrid.target.list.map(function(item) {
		         return {
		                 gb: "결재"
		               , usrNm: item.id
		               , name: item.text
		               , jik: item.parent
		               , dtNm: item.deptNm
		               , telNo: item.telNo
		               , offTelNo: item.offTelNo
		               , email: item.email
		               , todoId: item.id
		               , todoKey: item.todoKey
		               , todoDiv2CodeId: item.todoDiv2CodeId
		               , sanctnSn: item.sanctnSn
		               , sanctnSttus: 'N'	//신규 등록은 무조건 미결상태임
		               , todoCfDt: item.todoCfDt
		               , todoCfOpn: item.todoCfOpn
		               , flag: item.flag
		               , coCd: item.coCd
		         };
		   });
		    var shaArray = shareGrid.target.list.map(function(item) {
		       return {
		                 gb: "공유"
		               , usrNm: item.id
		               , name: item.text
		               , jik: item.parent
		               , dtNm: item.deptNm
		               , telNo: item.telNo
		               , offTelNo: item.offTelNo
		               , email: item.email
		               , todoId: item.id
		               , todoKey: item.todoKey
		               , todoDiv2CodeId: item.todoDiv2CodeId
		               , sanctnSn: item.sanctnSn
		               , sanctnSttus: 'N'	//신규 등록은 무조건 미결상태임
		               , todoCfDt: item.todoCfDt
		               , todoCfOpn: item.todoCfOpn
		               , flag: item.flag
		               , coCd: item.coCd
		         };
		   });
            gridViewPop.setData2(appArray.concat(shaArray));

//            approvalGrid.id //userId
//            approvalGrid.text //성명
//            approvalGrid.parent //직책
//            approvalGrid.deptNm //부서
//            approvalGrid.telNo
//            approvalGrid.offTelNo
//            approvalGrid.email

//            shareGrid.id //userId
//            shareGrid.text //성명
//            shareGrid.parent //직책
//            shareGrid.deptNm //부서
//            shareGrid.telNo
//            shareGrid.offTelNo
//            shareGrid.email
         });

     }

     function deleteShareUser(){

        if( approvalYn() ) {
          alert("결재가 이미 진행중입니다.");
          return;
       }

        var selRow = parseInt(gridViewPop.target.selectedDataIndexs);
        if( isNaN(selRow) ) {
//            alert("선택된 행이 없습니다.");
           return;
        } else {
              if( selRow > -1 ) {
                 //gridViewPop.target.removeRow(selRow);
                 var todoKey = gridViewPop.target.getList()[selRow].todoKey;
                 var gridList = gridViewPop.target.getList("selected")[0];
             if( typeof(todoKey) == "undefined" ) {
                gridViewPop.target.removeRow(selRow);
                $.gridNoSet(gridViewPop, "sanctnSn");
             } else {
                var paramObj = {
                      todoNo: $("#popForm #workNo").val(),
                      todoKey: gridList.todoKey,
                      sanctnSn: gridList.sanctnSn,
                      todoDiv2CodeId: gridList.todoDiv2CodeId
                }
//                 if( confirm("선택행을 삭제하시겠습니까?")) {
                   deleteAjax("/user/wb/wb20/deleteTodoMaster", paramObj, null, function(data) {
                      if (data.resultCode == 200) {
//                          alert(data.resultMessage);
                         gridViewPop.setData(0);
                      } else {
                         alert("삭제중 오류가 발생했습니다");
                      }
                   });
//                 }
             }
           }
        }
     }
     function kakaoTodo() {

         //message load
         if (kakaoErr.length == 0) {
  	        var paramObj = {
  	            "userId" : jwt.userId
  	            , "codeKind" : "KAKAOMSG"
  	        };
  	        postAjaxSync("/user/sm/sm02/selectCurrToday", paramObj, null, function(data) {
  	            if(data.resultList.length > 0 ) {
  	                kakaoErr = data.resultList;
  	            }
  	        });
         }

        let clntNm = (jwt.coCd=="GUN") ? "(주)건양ITT" : "트루넷";

        // Kakao 알림톡 보내는사람(userID) 연락처 조회 값 세팅
          var paramObj1 = {
                  "coCd" : $("#coCd").val(),
                  "userId" : $("#ordrgId").val()
              };
           postAjaxSync("/user/wb/wb24/selectMemberTelNo", paramObj1, null, function(data){
               if (data.result[0] == undefined
                    || data.result[0].telNo == "") {
                  teleNo = "051-312-2400";
               }
               else {
                  teleNo = data.result[0].telNo;

               }
           });
          //---------------------------------------
        let param = {
              "tmplatDiv": "TMPLATDIV02"
              , "coCd": $("#popForm #coCd").val()            //해당업무의 coCd(트르넷발주 TRN )
              , "todoDiv1CodeId": "TODODIV20"               //공통코드 해당업무 - 결재
              , "todoDiv2CodeId": "TODODIV2140"               //공통코드 해당업무 - 결재 - 발주서
              , "todoDiv1CodeNm": "결재"                  //공통코드 해당업무 - 결재 - 발주서
              //, "todoDiv2CodeNm": "발주 및 출장 요청"                  //공통코드 해당업무 - 결재 - 발주서
              , "title": "작업일보 월별 고찰"
              , "sanctnDiv2": "결재"                     //템플릿 결재구분2    #{sanctnDiv2} 처리 바랍니다.
              , "todoNo": $("#popForm #workNo").val()
              , "clntCd": "1"               //발신회사는 로그인사용자 회사
              , "clntNm": clntNm            //로그의 수신거래처명
              , "ordrgMngNm": $("#popForm #ordrgNm").val()         //발주작성자(담당자)
              , "ordrgMngTelNo": teleNo      //담당자전화번호
              , "creatPgm"  : "QM0101P01"
        }
        commKaKaoSendTodo(param);

        //공유
        let param2 = {
              "tmplatDiv": "TMPLATDIV02"
                 , "coCd": $("#popForm #coCd").val()            //해당업무의 coCd(트르넷발주 TRN )
                 , "todoDiv1CodeId": "TODODIV10"               //공통코드 해당업무 - 결재
                 , "todoDiv2CodeId": "TODODIV1140"               //공통코드 해당업무 - 결재 - 발주서
                 , "todoDiv1CodeNm": "공유"                  //공통코드 해당업무 - 결재 - 발주서
                 , "title": "작업일보 월별 고찰"
                 , "sanctnDiv2": "공유"                     //템플릿 결재구분2    #{sanctnDiv2} 처리 바랍니다.
                 , "todoNo": $("#popForm #workNo").val()
                 , "clntCd": "1"               //발신회사는 로그인사용자 회사
                 , "clntNm": clntNm            //로그의 수신거래처명
                 , "ordrgMngNm": $("#popForm #ordrgNm").val()         //발주작성자(담당자)
                 , "ordrgMngTelNo": teleNo      //담당자전화번호
                 , "creatPgm"  : "QM0101P01"
        }
        commKaKaoSendTodo(param2);

        if (kakaoCnt > 0) {
            kakaoCnt = 0;
//             alert("알림톡이 정상 발송되었습니다.");
         }
     }

     //to-do결재요청 알림톡
     function commKaKaoSendTodo(param) {
//         console.log('---카카오 발주및출장요청서 알림톡발송시작 --' + param);

        //알림톡수신번호 채번
        var maxMessageId = null;         //message id(unique key)
        var talkMessage = null             //발송될 내용 template
        var mobile = null               //수신인 휴대전화번호
        var title = null               //todo title
        var todoDiv2CodeNm = null               //todo title
        var sendList = [];
        let talkParam = {};
        let talkBody = {};
        let sendCnt = 0;
        postAjaxSync("/user/bm/bm18/selectMaxMessageIdTodo", param, null
                 , function(data) {
                    if(data.resultList.length > 0 ) {
                       if( data.resultList[0].maxMessageId != "" ) {
                          sendList = data.resultList;
                       } else {
                          alert("알림톡 발송을 위한 messageId 생성에 실패 했습니다.");
                          return;
                       }

                    }
        });
        //user search ajax end

        //대상 loop
        $.each(sendList, function (key, sendObj) {
           maxMessageId = sendObj.maxMessageId;
           talkMessage = sendObj.messageDesc;
           mobile =  sendObj.telNo;
           //로그용
           param.rcvId = sendObj.todoId;         //todo 수신id
           param.rcvNm = sendObj.name;            //todo 수신자명
           param.nameTo = sendObj.name;            //todo 수신자명
           //title      = sendObj.todoTitl;
           todoDiv2CodeNm =   sendObj.todoTitl;
           param.todoDiv2CodeNm = todoDiv2CodeNm;
           //param.title = title;                        //요청내용제목
           param.sendDt = sendObj.sendDt;

           if(mobile == "" || mobile == null) {
              alert('수신전화번호가 없습니다.\r\n['+clntNm+'] 거래처관리의 사업부 첫번째 항목을 확인해 주십시오.');
              return;
           }
           if(talkMessage == "" || talkMessage == null) {
              alert('발송할 내용이 없습니다.\r\n알림톡템플릿관리를 확인해 주십시오.');
              return;
           }
           //message 치환
           let message = talkMessage;
           let splitStr = Array.from(message.matchAll('\\{(.*?)\\}'), match => `${match[0]}`);
           //loop
           $.each(splitStr, function (key, val) {
              let compKey = val.substring(1, val.length-1);
              if( compKey != "" && compKey != "undefined" ) {
                 if( typeof(param[compKey]) != "undefined" ) {
                    let val2 = '#'+val;
                    message = message.replaceAll(val2, param[compKey]);
                 }
              }
           });

           talkParam.authToken = "e/eDfZOFCsrBqadaECQ0+g==";
           talkParam.serverName = "gyitt2400";
           talkParam.paymentType = "P";
           talkBody.service = "2310086157";            //서비스번호(1000000000 - 예시  real : 2310086157
           talkBody.messageId = maxMessageId;         //고객사에서 관리하는 메시지No - 40byte (unique 값);
  		if (param.title.length > 50) {
  			param.title = param.title.substring(0, 49); // 50자까지만 자르기
  		}
           talkBody.title = param.title;               //알림톡 타이틀 -
           talkBody.message = message;            //알림톡 메시지 (1000 byte)
           talkBody.mobile = mobile;            //휴대전화번호
           talkBody.template = "10003";         //템플릿관리화면 템플릿ID   - 발주서 V2
           let talkJson = JSON.stringify(talkBody);
           sendCnt = kakaoSendReal(talkJson, talkParam, param);
        });
        //대상 loop end
        if( sendCnt > 0 ) {
           //alert("알림톡 정상 발송되었습니다.");
           kakaoCnt++;
        }
     }

     //조치담당자 팀장 정보 가져오기
  	function selectTeamManagerInfo(paramUserId) {
  		//결자자 정보 가져오기//결자자 정보 가져오기 gridViewPop2
         var appshaList = gridViewPop.target.list.map(function(item) {
  			            return {
  			                gb: item.gb,
  			                usrNm: item.usrNm,
  			                name: item.name,
  			                jik: item.jik,
  			                dtNm: item.dtNm,
  			                telNo: item.telNo,
  			                offTelNo: item.offTelNo,
  			                email: item.email,
  			            };
  			        });


         var appArray = $.grep(appshaList, function(item) { return item.gb === "결재"; }).map(function(item) {
  			            return {
  			                gb: item.gb,
  			                usrNm: item.usrNm,
  			                name: item.name,
  			                jik: item.jik,
  			                dtNm: item.dtNm,
  			                telNo: item.telNo,
  			                offTelNo: item.offTelNo,
  			                email: item.email
  			            };
  			        });
         var shaArray =  $.grep(appshaList, function(item) { return item.gb === "공유"; }).map(function(item) {
  			            return {
  			                gb: item.gb,
  			                usrNm: item.usrNm,
  			                name: item.name,
  			                jik: item.jik,
  			                dtNm: item.dtNm,
  			                telNo: item.telNo,
  			                offTelNo: item.offTelNo,
  			                email: item.email
  			            };
  			        });

         var formData = {
             "userId" : paramUserId,
         }
         postAjaxSync("/user/wb/wb24/selectTeamManagerInfo", formData, null, function(data) {
         	if (data.result != '' && data.result!=null) {
         		//결자자 정보 가져오기
         		let list = data.result;
         		if (appArray.some(item => item.usrNm === list.id)) {
         			//Array에 usrNm 의 값중에 list.id와 같은 값이 있으면 true
         		} else {
         			appArray.push({
  		                        gb: "결재",
  		                        usrNm: list.id,
  		                        name: list.name,
  		                        jik: list.levelNm,
  		                        dtNm: list.deptNm,
  		                        telNo: list.telNo,
  		                        offTelNo: list.offTelNo,
  		                        email: list.email,
  		                        todoNo: $('#rsltNo').val(),
  		                        sanctnSn: 0,
  		                    });
         		}

         		gridViewPop.setData2(appArray.concat(shaArray));
         	}
  		});
  	}


      //조치담당자 팀장 정보 가져오기
  	function selectTeamManagerApprovalAdd() {
      	//------------------------------------------------
      	//이슈등록, 조치결과 등록시 결재자 정보를 메모리에 가져오기  start
      	//결재자 정보와 공유자 정보를 분리하고 조치담당자, 조치담당자 팀장이 공유에 있으면 제외 처리함.
      	//------------------------------------------------
      	let appshaList = gridViewPop.target.getList();

  		var appArray = [];	//결재권자 정보
  		var shaArray = [];	//공유자 정보
  		var tempActId = $("#ordrgId").val();	//발행자ID
  		if (tempActId.slice(0,7) == 'gyrsult') return false; //실적관리용 ID는 결제 제외처리함.

          $.each(appshaList, function(idx, item){
              if (item.gb === "결재") {
              	appArray.push(item);
              } else {
              	//공유일경우 조치담당자가 공유에 있으면 제외처리함.
              	if (item.usrNm != tempActId) {
              		shaArray.push(item);
              	}
              }
          });
  		//------------------------------------------------
  		//이슈등록, 조치결과 등록시 결재자 정보를 메모리에 가져오기  end
  		//------------------------------------------------

  		//발행자의 팀장 정보 가져오기
//   		appArray = approvalUserInfoData(tempActId, appArray);
  		appArray = approvalTeamManagerInfoData(tempActId, appArray);
  		if (userDept == 'GUN40') {
  			appArray = approvalTeamManagerSpecialInfoData('shjung', appArray);	//특정유저 추가하기(설계이면 정상훈차장 추가)
  		}
//   		appArray = approvalTeamManagerInfoData(jwt.userId, appArray);


  		gridViewPop.setData2(appArray.concat(shaArray));
  	}

      //조치담당자정보 자동 추가하기
  	function approvalUserInfoData (appUserId, appArray) {
  	    var formData = {
  	        "userId" : appUserId,
  	    }
  	    postAjaxSync("/user/wb/wb24/selectRsltsMemberList", formData, null, function(data) {
  	    	if (data.resultList != '' && data.resultList!=null) {
  	    		//조치결과 결자자 정보 가져오기
  	    		let list = data.resultList[0];
  	    		if (appArray.some(item => item.usrNm === list.usrNm)) {
  	    			//Array에 usrNm 의 값중에 list.id와 같은 값이 있으면 true
  	    		} else {
  	    			appArray.push({
  		                        gb: "공유",
  		                        usrNm: list.usrNm,
  		                        name: list.name,
  		                        jik: list.jik,
  		                        dtNm: list.deptNm,
  		                        telNo: list.telNo,
  		                        offTelNo: list.offTelNo,
  		                        email: list.email,
  		                    });
  	    		}
  	    	}
  		});
  		return appArray;
  	}

  	function wordRemove(originalWord) {
 		let tempWord = originalWord.replace(/주식회사/g, '');
 		tempWord = tempWord.replace(/\(주\)/g, '');
 		tempWord = tempWord.replace(/,,/g, ',');
 		tempWord = tempWord.replace(/\(주\)/g, '');
 		tempWord = tempWord.replace(/ ,/g, ',');
 	   return tempWord;
    }


      //담당자 팀장 정보 가져오기
  	function approvalTeamManagerInfoData(appUserId, appArray) {
  	    var formData = {
  		        "userId" : appUserId,
  		}
          postAjaxSync("/user/wb/wb24/selectTeamManagerInfo", formData, null, function(data) {
          	if (data.result != '' && data.result!=null) {
          		//결자자 정보 가져오기
          		let list = data.result;
          		if (appArray.some(item => item.usrNm === list.id)) {
          			//Array에 usrNm 의 값중에 list.id와 같은 값이 있으면 true
          		} else {
          			appArray.push({
  		                        gb: "결재",
  		                        usrNm: list.id,
  		                        name: list.name,
  		                        jik: list.levelNm,
  		                        dtNm: list.deptNm,
  		                        telNo: list.telNo,
  		                        offTelNo: list.offTelNo,
  		                        email: list.email,

  		                    });
          		}
          	}
  		});
  		return appArray;
  	}
    
      
  //고찰 보고서 출력 - report 출력
 	function setReportOrderDetail(sel=1, _type = "") {
		const workYm = $('#workYm').val().replace('-','')
 	
		let fileName = '';
		if ($('#workProposalTxt').val().replace(/[ \n]+/g, '') == "") { // 특수문자 제거 '\n'과 공백제거후 비교
			fileName = (sel == 1) ? "PM0102R22.jrf" :  "PM0102R32.jrf";
		} else {
			fileName = (sel == 1) ? "PM0102R02.jrf" :  "PM0102R12.jrf";
		}
		let arg =  
			  "coCd#"		+  $('#coCd').val()
		    + "#userId#"	+  $('#ordrgId').val()
		    + "#workYm#"	+  workYm
		    + "#workNo#"	+ $('#workNo').val()
		    + "#workRptL#"	+ $("#deptCd").val()
	    	+ "#";    
		
 		if (_type == '' || _type == undefined ) {
 			callReport(fileName, arg, 1150, 720, '작업일보 월별 고찰');
 		} else { //Export 작업
 			ubiExportAjax(fileName, arg, function(response) {
 				if (response.resultCode === 200) {
 					var base64FileData = response.base64FileData;
 					var fileName = response.exportFileName;
 					downloadPDFFromBase64(base64FileData, fileName);
 				} else {
 					alert('PDF 내보내기 실패: ' + response.resultText);
 				}

 			});
 		}
 	}
      

 	function gridResize1() {
    	let size = gridViewPop.target.list.length;
        let tagHeight = (size) * 28 + 50 ;
        tagHeight = tagHeight > 750 ? 750 : tagHeight;
        tagHeight = tagHeight < 100 ? 100 : tagHeight;
        gridViewPop.target.setHeight(tagHeight);
    }
  
    function gridResize2() {
    	let size = ModalgridView1.target.list.length ;
        let tagHeight = (size) * 28 + 50 ;
        tagHeight = tagHeight > 750 ? 750 : tagHeight;
        tagHeight = tagHeight < 200 ? 200 : tagHeight;
        ModalgridView1.target.setHeight(tagHeight);
    }
    
    


	function txtareaHeightResize(obj) {
		const rowCount = obj.val().split(/\r\n|\r|\n/).length;

		if(rowCount < 4)
			obj.css('height', "60px");
		else
			obj.css('height', (rowCount * 20) + "px");
	}

  
      
    </script>