<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">요인별 발주 및 출장결과 등록</h4>
    </div>
  <form id="popForm2" onSubmit="return false;">
    <div class="form-group popup_table">
		<input type="hidden" id="fileTrgtKey"  	name="fileTrgtKey">
		<input type="hidden" id="pgmId"     	name="pgmId"	value="QM0101M01">
 	<table>
        <colgroup>
          <col width="10%">
          <col width="15%">
          <col width="10%">
          <col width="16%">
          <col width="10%">
          <col width="14%">
          <col width="10%">
          <col width="15%">
        </colgroup>
        <tr>
          <th colspan="8" height="30" style="margin-left:0px;text-align:left;">요인별 발주 및 출장요청서</th>
        </tr>
        <tr>
			<th>회사</th>
			<td>
				<select id="coCd" name="coCd" data-kind="CO" class="form-control input-sm" >
				</select>
			</td>
			<th>접수자</th>
			<td>
			     <div class="search_form">						
			    	<input type="hidden" id="regId" name="regId">
             		<input type="text"	id="regNm" data-search="regNm" readonly="readonly">
             		
                 </div>
			</td>
			<th>출장자</th>
			<td style="text-align:left;">
				<div id="BUSTCD-radioButtonContainer"></div>
			</td>
			<th >관리번호</th>
			<td>
				 <div class="search_form">
				  <input type="text" id="reqNo" name="reqNo" readonly="readonly" >
				 </div>
			</td>
        </tr>
		 <tr>
			<th>발행일자</th>
			<td>
				<input type="text" id="ordrgDt" name="ordrgDt" readonly="readonly">
			</td>
			<th>요구일정</th>
			<td>
				<input type="text" id="reqDt" name="reqDt" readonly="readonly" >
			</td>
			<th>출장자명</th>
			<td>
			     <input type="text" id="bustNm" name="bustNm" readonly="readonly" >
			</td>
			<th>수주번호</th>
			<td>
                <input type="text" id="ordrsNo" name="ordrsNo" readonly="readonly">
			</td>
        </tr>
        <tr>		
			<th>발행자</th>
			<td>
                 <div class="search_form">						
			    	<input type="hidden" id="ordrgId" name="ordrgId"  data-search="ordrgId">
             		<input type="text"	id="ordrgNm" data-search="ordrgNm" readonly="readonly">
                 </div>
			</td>
			<th>요청구분</th>
			<td style="text-align:left;">
			  <div id="REQCD-radioButtonContainer"></div>
			</td>
			<th>출장장소(고객사)</th>
			<td>
			     <input type="text" id="bustPe" name="bustPe" readonly="readonly">
			</td>
			<th>대표도면번호</th>
			<td>
				<input type="text" id="matrDrwNo" name="matrDrwNo" readonly="readonly" >
			</td>
        </tr>
        <tr>
		   <th>SalesCode</th>
				<td>
					<div class="search_form">
					    <input type="text" id="salesCd" name="salesCd" readonly="readonly" >
				    </div>
				</td>
			<th>사내작업</th>
			<td style="text-align:left;">
			    <div id="INWKCD-radioButtonContainer"></div> 
			</td>
			<th>고객사</th>
			<td>
			    <input type="hidden" id="clntCd" name="clntCd" >				
				<input type="text" id="clntNm" name="clntNm" readonly="readonly">
			</td>
			<th>Project명</th>
			<td>
			    <input type="text" id="projNm" name="projNm" readonly="readonly">
			</td>
        </tr>
        <tr>
			<th>분류</th>
			<td>	
				<input type="text" id="partCdNm" name="partCdNm" readonly="readonly">
			</td>
			<th>등록 사유</th>
			<td>	
				<input type="text" id="subCdNm" name="subCdNm" readonly="readonly">
				<input type="hidden" id="subCd" name="subCd">
			</td>
			<th>고객사PJT</th>
            <td>
                <div class="search_form">
                    <select id="clntPjt" name="clntPjt" data-kind="PRJCTCD"></select>
                </div>
            </td>
			<th>신작구분</th>
			<td>
			   <input type="hidden" id="ordrsdtldiv20" name="ordrsdtldiv20">
			   <input type="text" id="newCd" name="newCd" readonly="readonly" >
			</td>
        </tr>
        <tr>
          <th colspan="8" height="30" style="margin-left:0px;text-align:left;">요인별 결과 등록</th>
        </tr>
        <tr>
			<th>실적번호</th>
               <td>
      	 		<input type="hidden" id="resReqNo" name="resReqNo" >
        		<input type="text" id="rsltNo" name="rsltNo" readonly="readonly">
	           </td>
	       <th>등록일자</th>
	         <td>
	           	<input id="resDt" name="resDt" class="input_calendar form-control">
	         </td>
	       <th>결과 등록자</th>
		     <td>
	           	<div class="search_form">						
				   <input type="hidden" id="resRegId" name="resRegId" >
	               <input type="text"	id="resRegNm" data-search="resRegNm" msg="등록자" required>
	               <a onclick="openFirstResUserSearch();"><i class="i_search_w" id="userIdBtn"></i></a>
	            </div>
		     </td>
		   <th colspan="2"></th>
	    </tr>
	    <tr>
	      <th >결과사유</th>
			<td colspan= "3" style="text-align:left; vertical-align:top;">	
				<div id="COBGB-checkboxContainer"></div>		   
			</td>
		    <td colspan="4">
			  <div>
				<table>
				    <th >비고</th> 
					  <td colspan="3">	
						 <textarea  class="form-control" id="rsltRmk" name="rsltRmk" rows="5" style="width:570px; border: none;" maxlength="1000"></textarea>		
					  </td>
				   <tr>
				    <th >조치</th> 
				      <td colspan="3">	
					    <textarea  class="form-control" id="measRst" name="measRst" rows="5" style="width:570px; border: none;" maxlength="1000"></textarea>
				      </td>  
				  </tr>
				  <tr>
				   <th >결과</th> 
				     <td colspan="3">	
					   <textarea  class="form-control" id="resltRst" name="resltRst" rows="5" style="width:570px; border: none;" maxlength="1000"></textarea>	
				     </td> 
				  </tr> 
				  <tr>
				   <th >고찰</th> 
				     <td colspan="3">
				        <textarea  class="form-control" id="thghRst" name="thghRst" rows="5" style="width:570px; border: none;" maxlength="1000"></textarea>	
				     </td>
				  </tr>
				</table>
			 </div>
		  </td>
	    </tr>
	    <tr>
	    <td colspan= 8>
		    <!-- 공유대상자-->
		    <div class="popup_table" id="approval_trgt" style="display:none;">               
		        <table style="border:0px;">
		            <tr style="height:30px;">
		              <td style="text-align: LEFT; border-right: 0px;;font-size:13px;font-weight:bold;">※ 공유 및 결재</td>
		              <td>
			              <div class="add_btn_small pdl10" id="plus-minus">       
					          <a onclick="insertShareUserModal1();" style="height: 30px; line-height: 28px;" authchk>+</a>
					          <a onclick="deleteShareUser1();" style="height: 30px; line-height: 28px;" authchk>-</a>    
					      </div>
		              </td>
		            </tr>
		            <tr>
		              <td colspan="2">
		               <div>
						 <div class="ax5_grid" data-ax5grid="second-grid-modal" data-ax5grid-config="{}" style="height: 300px; width: 100%;" ></div>
					   </div>
					  </td> 
					</tr>  
		        </table>
		    </div> 
		    </td>
		 </tr>
      </table>
    </form>
  </div>

	<!-- 공통 파일 영역-->
    <div id="fileList_area"></div>
	<!-- 공통 파일 영역 -->
	 <br>
    <div class="col-xs-2" style="height: 70px;">
    </div>
    
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtn" authChk>등록</button>
		<button type="button" id="approvalReqBtn" authChk>결재요청</button>
		<button type="button" id="approvalReqTodoBtn" authChk>결재요청알림톡</button>
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>
	
<script type="text/javascript">
	var actionType = null;
	var fileTrgtKey = null;
    var approvalList = null;
    var reqNo = null;
    var clntPjt = "";
	
	var gridViewPop1 = {
		initView : function() {
  			this.target = new ax5.ui.grid();
  			this.target.setConfig({
  		    	showRowSelector: true,
  		    	multipleSelect: false,
  		    	sortable: false,
  		        target: $('[data-ax5grid="second-grid-modal"]'),
  		        header: {
  		        	align: "center",
  		        	selector: true
  		        },
  		        body: {
  		        	 onClick: function () {
  		                this.self.select(this.dindex);
  		            },
  		            onDBLClick: function () {
  		            },
					mergeCells : ["gb"],
  		        },
				page : {
					navigationItemCount : 10,
					height : 30,
					display : true,
					firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
					prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
					nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
					lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
					onChange : function() {
						gridView.setData(this.page.selectPage);
					}
				},
		    	columns : [
		    		{key: "gb",      			label: "구분",      	align: "center",   width: 40},
			    	{key: "sanctnSn", 			label: "순번", 		align: "center",   width: 50},
			    	{key: "coCd",      			label: "coCd",		align: "center",   width: 50, hidden: true},
                    {key: "wbsPlancoCdNm",      label: "회사명",      align: "center",   width: 130, hidden: true},
                    //{key: "wbsSharngUserId",	label: "ID",      	align: "center",   width: 130, hidden: false},
                    {key: "usrNm",				label: "ID",      	align: "center",   width: 130, hidden: true},
                    {key: "empNo",      		label: "사원번호", 	align: "center",   width: 130, hidden: true},
                    {key: "name",       		label: "성명",      	align: "center",   width: 80},
                    {key: "jik",       			label: "직위",      	align: "center",   width: 60},
                    {key: "reqDate",      		label: "요청일자", 	align: "center",   width: 90},
                    {key: "todoCfDt",      		label: "확인일자",		align: "center",   width: 130},
                    {key: "todoCfOpn",      	label: "확인의견", 	align: "left",     width: 200},
                    {key: "telNo",      		label: "H.P",		align: "center",   width: 130},
                    {key: "todoKey",      		label: "todoKey",		align: "center",   width: 130, hidden: true},
                    {key: "sanctnSttus",      	label: "sanctnSttus",		align: "center",   width: 130, hidden: true},                   
                    {key: "todoId",      		label: "todoId",		align: "center",   width: 130, hidden: true},
                    {key: "flag",      			label: "flag",		align: "center",   width: 130, hidden: true}
    	              ]
					});
        			return this;
        		},

        		setData : function(_pageNo) {
        			var targetObj = this.target;
        			var formData = {
     	        			"fileTrgtKey" : fileTrgtKey,
     	        			"reqNo" : reqNo, 
     	        			"pageNo" : _pageNo + 1
     	    		}

   					//postAjax("/user/qm/qm01/selectShareUserlst", formData, null, function(data){
   					postAjax("/user/wb/wb20/selectSignResUserlst", formData, null, function(data){
   					var list = data.result;
   						targetObj.setData({
   	  						list : list,
	   	  					page : {
// // 	   	  							currentPage : _pageNo,
// // 				                    pageSize : data.paginationInfo.pageSize,
				                    	totalElements : list.length
// // 				                    totalPages : data.paginationInfo.totalPageCount
						    } 
   	  					});
   	  				});
          		},

        		setData2 : function(_list) {
        			this.target.setData({
   	  						list : _list,
	   	  					page : {
				                    	totalElements :  _list.length,
						    } 
   	  					});
          		}
  	}

	//************************************************************************************
	/*radio button,  checkbox 공통코드에서 가져오기 start
	 *  아래의 코드가 HTML에 추가함 
	 *  <div id="COBGB-checkboxContainer"></div>
	 *  <div id="COBTP-radioButtonContainer"></div>	
	 */	
	//************************************************************************************
	
	function createRadioOptions(groupName, _type) {
		var param = {
				"codeKind" : groupName
		};
		postAjaxSync("/admin/cm/cm05/selectChildCodeList", param , null,  function(data){
			const codeList = data.childCodeList;
			var container = $('#' + groupName + '-radioButtonContainer');
			var typeStr = _type =="radio" ? "radio" : "checkbox";
			codeList.forEach(item => {
				const iHtml = '<td><input type="' + typeStr  + '" id="' + item.codeId + 
				                              '" name="' + item.codeKind + 
				                             '" value="' + item.codeId + 
				                        '" data-label="' + item.codeNm + 
				              '" onchange="fnc(this)"> ' + item.codeNm + ' </td>';
				container.append(iHtml);
			});
		})	
	}
	
	function createCheckBox(deptCode) {
		$('#COBGB-checkboxContainer').empty();
		var param = {
			"userDept" : deptCode
 		};
		postAjaxSync("/admin/cm/cm05/selectCheckboxList", param , null,  function(data){
			var codeList = data.childCodeList;
			var container = $('#COBGB-checkboxContainer');
			var lastKind = '';
			const table = $('<table>').appendTo('#COBGB-checkboxContainer')
			var tableRow = '';	
			$.each(codeList, function (index, item){
				if (lastKind != item.codeKind) {
					tableRow = $('<tr>').appendTo(table);
					var trElement = $('<tr>');
					$('<th>').attr('rowspan', item.rowCnt).css('width', '90').text(item.codeDesc).appendTo(tableRow);
					lastKind = item.codeKind;
				} else {
					tableRow = $('<tr>').appendTo(table);
					var trElement = $('<tr>');
				}
				const comboName= "CODECOBGB";
				const iHtml = 
				  '<input type="radio" id="' + item.codeId + 
									 '" name="' + comboName + 
									'" value="' + item.codeId + 
							   '" data-label="' + item.codeNm + 
				     '" onchange="fnc(this)" style="margin-left:20px"> ' + item.codeNm + '\n';

				const tdElement  = $('<td>').attr('style', 'text-align:left;height:20px;').text('').appendTo(tableRow);
				tdElement.append(iHtml);

			});
		})	
		gridViewPop1.initView();
		const grdiHeight = $('#COBGB-checkboxContainer').height()-35;
		gridViewPop1.target.setHeight(grdiHeight< 162 ? 162 : grdiHeight);
	}
	

	function fnc(thisButton) {
		const inputType = $(thisButton).attr('type');
		  
		if (inputType === 'radio') {
			console.log(thisButton.dataset.label + ' radio button. = ' + $("input[name='COBTP']:checked").val() + ' 선택');
		} else if (inputType === 'checkbox') {
			console.log(thisButton.dataset.label + ' checkbox. = ' + thisButton.value + '의 상태는 ' + thisButton.checked);
		}
		if (thisButton.id == 'COBTP99') {
			$("#COBGB9999").prop("checked", $("#COBTP99")[0].checked);  
		}
	}
/*************************************************************************************
 * radio button,  checkbox 공통코드에서 가져오기 end
 */
//*************************************************************************************	
	
	$(document).ready(function() {
		actionType = modalStack.last().paramObj.actionType;
		fileTrgtKey = modalStack.last().paramObj.fileTrgtKey;
		$("#fileTrgtKey").val(fileTrgtKey);
		setCommonSelect($(".popup_area select[data-kind]"));
// 		setCommonDiv($(".popup_area div[data-kind]"));
// 		setCommonItem($(".popup_area table[data-kind]"));
		//setCommonCheck($(".popup_area th[data-kind]"));
		setByCoCd(modalStack.last().paramObj.coCd);
// 		$("#popForm2 #userId").val(jwt.userId);
		$("#resRegId").val(jwt.userId);
		$("#resRegNm").val(jwt.userNm);
// 		$("#userEmpNo").val(jwt.empNo);
// 		$("#userDeptId").val(jwt.deptId);
		var userDeptId = jwt.deptId;
		var userDept = userDeptId.substr(0, 5);
// 		$("#userDept").val(userDept);
		
		//처리일자//
		$('#resDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		}).datepicker("setDate", new Date());
		
		//createRadioOptions('COBTP', "radio");  //분류 자동 생성
		createRadioOptions('BUSTCD', "checkbox");  //출장차 구분
		createRadioOptions('INWKCD', "checkbox");  //사내작업 구분
		createRadioOptions('REQCD', "radio");  //요청구분 구분
		createCheckBox(userDept);	//부서별 장애원인 자동 생성
		
		$('#coCd').css({'background-color':'#e6e6e6', 'pointer-events':'none'});
		$('#clntPjt').css({'background-color':'#e6e6e6', 'pointer-events':'none'});
		
		selectAuth(jwt.deptId);
		
		authChk();						// 권한체크
		
//		gridViewPop.initView(); 
        
        $("#REQCD01").prop("disabled", true);
		$("#REQCD02").prop("disabled", true);
		$("#BUSTCD01").prop("disabled", true);
		$("#BUSTCD02").prop("disabled", true);
		$("#INWKCD01").prop("disabled", true);
		$("#INWKCD02").prop("disabled", true);
		$("#ordrgId").val(modalStack.last().paramObj.userId);
		$("#ordrgNm").val(modalStack.last().paramObj.userName);
		$("#regId").val(modalStack.last().paramObj.userId);
		$("#regNm").val(modalStack.last().paramObj.userName);
		$("#creatId").val(modalStack.last().paramObj.userId);
        
		if (actionType == "C") {
			
			selectQtyReqInfo();
			
			$("#approvalReqBtn").hide();
			
			$("#actionBtn").text("등록");
			$('#actionBtn').on("click", function() {
				insertQualityResp();
			});

		} else if (actionType == "U") {
			$('.tit').text('요인별 발주 및 출장결과 수정');
			reqNo = modalStack.last().paramObj.rsltNo;
			
			selectQtyReqInfo();		
			selectQtyReqRespInfo();
			gridViewPop1.setData();
			
			selectApprovalCheck(reqNo);//결재가 되었는지 안되었는지 체크
			
			$('#actionBtn').text("수정");
			$('#actionBtn').on("click", function() {
				updateQualityResp();
			});
		}
		
		//---------------------------------------------------------------  
		//첨부 화일 처리 시작 
		//---------------------------------------------------------------  
		fileParam = {
				fileTrgtTyp	: $("#pgmId").val(),
				fileTrgtKey		:fileTrgtKey
		}
  		treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
		//---------------------------------------------------------------  
		//첨부 화일 처리 끝
		//---------------------------------------------------------------  
        
	});
	
	
	// 공유대상자 추가//  
    function insertShareUserModal1() {
		
    	if( approvalYn() ) {
			alert("결재가 이미 진행중입니다.");
			return;
		}

        var paramObj = {};
        var appshaList = gridViewPop1.target.list;
        paramObj["coCd"] = $('#coCd').val();
        paramObj["useYn"] =  "Y";
        paramObj["userId"] =  $('#ordrgId').val();
        paramObj["userNm"] =  $('#ordrgNm').val();
        paramObj["approvalGrid"] = $.grep(appshaList, function(item) {return item.gb === "결재";   
        		}).map(function(item) {
	        		  	return {
	        			    gb: "결재",
	        			    id: item.usrNm,
	        			    text: item.name,
	        			    parent: item.jik,
	        			    deptNm: item.dtNm,
	        			    telNo: item.telNo,
	        			    offTelNo: item.offTelNo,
	        			    email: item.email,
	        			    todoId: item.id
	        			    , todoKey: item.todoKey        			    
	        			    , sanctnSn: item.sanctnSn
	        			    , sanctnSttus: item.sanctnSttus
	        		        , todoCfDt: item.todoCfDt
	        		        , todoCfOpn: item.todoCfOpn        			    
	        			    , flag: item.flag
	        			};
        		});
        paramObj["shareGrid"] =  $.grep(appshaList, function(item) { return item.gb === "공유";
        		}).map(function(item) {
				  		return {
						    gb: "공유",
						    id: item.usrNm,
						    text: item.name,
						    parent: item.jik,
						    deptNm: item.dtNm,
						    telNo: item.telNo,
						    offTelNo: item.offTelNo,
						    email: item.email,
						    todoId: item.id
	        			    , todoKey: item.todoKey        			    
	        			    , sanctnSn: item.sanctnSn
	        			    , sanctnSttus: item.sanctnSttus
	        		        , todoCfDt: item.todoCfDt
	        		        , todoCfOpn: item.todoCfOpn        			    
	        			    , flag: item.flag
						};
				});
        
        openSecondModal("/static/html/cmn/modal/userLstSearch.html", 900, 500, "작성자 검색", paramObj, function (approvalGrid, shareGrid){
    		console.log('결재라인 : ', approvalGrid.target.list);
    		console.log('공유라인 : ', shareGrid.target.list);
    		
    		var appArray = approvalGrid.target.list.map(function(item) {
    			  return {
    				  	gb: "결재",
    				  	usrNm: item.id,
    				  	name: item.text,
						jik: item.parent,
						dtNm: item.deptNm,
						telNo: item.telNo,
						offTelNo: item.offTelNo,
						email: item.email,
						todoId: item.id
        			    , todoKey: item.todoKey        			    
        			    , sanctnSn: item.sanctnSn
        			    , sanctnSttus: item.sanctnSttus
        		        , todoCfDt: item.todoCfDt
        		        , todoCfOpn: item.todoCfOpn        			    
        			    , flag: item.flag
					};
			});
    		var shaArray = shareGrid.target.list.map(function(item) {
  			  return {
	  				  	gb: "공유",
						usrNm: item.id,
						name: item.text,
						jik: item.parent,
						dtNm: item.deptNm,
						telNo: item.telNo,
						offTelNo: item.offTelNo,
						email: item.email,
						todoId: item.id
        			    , todoKey: item.todoKey        			    
        			    , sanctnSn: item.sanctnSn
        			    , sanctnSttus: item.sanctnSttus
        		        , todoCfDt: item.todoCfDt
        		        , todoCfOpn: item.todoCfOpn        			    
        			    , flag: item.flag
					};
			});
  			gridViewPop1.setData2(appArray.concat(shaArray));
  			
//     		approvalGrid.id //userId
//     		approvalGrid.text //성명
//     		approvalGrid.parent //직책
//     		approvalGrid.deptNm //부서
//     		approvalGrid.telNo
//     		approvalGrid.offTelNo
//     		approvalGrid.email
    		
//     		shareGrid.id //userId
//     		shareGrid.text //성명
//     		shareGrid.parent //직책
//     		shareGrid.deptNm //부서
//     		shareGrid.telNo
//     		shareGrid.offTelNo
//     		shareGrid.email
        });
		
    }   
	
//     function deleteShareUser1(){
    	
//     	var selRow = parseInt(gridViewPop1.target.selectedDataIndexs);    
//  		if( isNaN(selRow) ) {
//  			alert("선택된 행이 없습니다.");
//  			return;
//  		} else {			
//  				if( selRow > -1 ) {
//  					gridViewPop1.target.removeRow(selRow); 					
//  				}
//  		}
//     }

    function deleteShareUser1(){
    	if( approvalYn() ) {
			alert("결재가 이미 진행중입니다.");
			return;
		}
    	
    	var selRow = parseInt(gridViewPop1.target.selectedDataIndexs);    
	 		if( isNaN(selRow) ) {
	 			alert("선택된 행이 없습니다.");
	 			return;
	 		} else {			
	 				if( selRow > -1 ) {
	 					//gridViewPop.target.removeRow(selRow);
	 					var todoKey = gridViewPop1.target.getList()[selRow].todoKey;
					if( typeof(todoKey) == "undefined" ) {
						gridViewPop1.target.removeRow(selRow);	
						$.gridNoSet(gridViewPop1, "sanctnSn");
					} else {
						var paramObj = {
								todoNo: $("#popForm2 #rsltNo").val()
						}
						var gridList = gridViewPop1.target.getList("selected")[0];	
		 		        $.each(gridList, function (key, val) {			     	        	
		 					if( typeof(val) == "undefined") val = "";
		 					paramObj[key] = val; 						    			            		
		 		        });		
		 		        if(paramObj.todoKey && paramObj.sanctnSn && paramObj.coCd && paramObj.todoDiv1CodeId && paramObj.todoDiv2CodeId ) {
	 	 					if( confirm("선택행을 삭제하시겠습니까?")) {
	 	 						deleteAjax("/user/wb/wb20/deleteTodoMaster", paramObj, null, function(data) {
	 	 							if (data.resultCode == 200) {
	 	 								alert(data.resultMessage);
	 	 								gridViewPop1.setData(0);
	 	 							} else {
	 	 								alert("삭제중 오류가 발생했습니다");	 	 								
	 	 							}
	 	 						}); 						
	 	 					}		 		        			 		        	
		 		        } else {
		 		        	alert("삭제중 오류가 발생했습니다.")
		 		        }		
					}
	 			}
	 		}
    }
	
	
	 // 발행자 검색 //  
    function openFirstUserSearch() {
		 if (actionType == "C"){
		    	var paramObj = {
		    		  "coCd" : $('#coCd').val(),
		    		"userId" : $('#ordrgId').val(),
		    		"userNm" : $('#ordrgNm').val(),
					"useYn": "Y"
		    	};
		    	openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,
		    			"사용자 검색", paramObj, function(tree) {
		    				var checkedId = tree.get_checked()[0];
		    				var checkedNode = tree.get_node(checkedId);
		    				$('#ordrgId').val(checkedNode.id);
		    				$('#ordrgNm').val(checkedNode.text);
		    				$('#userDept').val(checkedNode.parent.slice(0,5));
		    				createCheckBox($('#userDept').val())
		    				selectAuth(checkedNode.original.parent);
		    				  //gridView.setData(0);
		    			});
		 }
    }   
	 
	 // 접수자 검색 //  
    function openSecondUserSearch() {
		 if (actionType =="C"){
	    	var paramObj = {
	    		  "coCd" : $('#coCd').val(),
	    		"userId" : $('#regId').val(),
	    		"userNm" : $('#regNm').val(),
				"useYn": "Y"
	    	};
	    	openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,
	    			"사용자 검색", paramObj, function(tree) {
	    				var checkedId = tree.get_checked()[0];
	    				var checkedNode = tree.get_node(checkedId);    				
	    				$('#regId').val(checkedNode.id);
	    				$('#regNm').val(checkedNode.text);
	    				 gridView.setData(0);
	    			});
		 }
    }  	
    
    
	function selectQtyReqInfo() {						//그리드에 뿌리는 데이터
		var formData = {
			"fileTrgtKey" : fileTrgtKey,
		}
		postAjax("/user/qm/qm01/selectQtyReqInfo", formData, null, function(data) {
				$.each(data.result, function(key, value) {
					if ($('#popForm2 #' + key)[0]) {
						$('#popForm2 #' + key).val(value);	
					}
					if (key == 'reqCd'){//요청구분 뿌려주기
						$('#'+value).prop("checked", true);
					}
					if (key == 'partCd'){//분류체크하기
						$('#'+value).prop("checked", true);
					}
					if (key == 'subCd'){//등록사유체크하기
						$('#'+value).prop("checked", true);
					}
					if (key == 'bustCd01'){//출장자체크
						$('#'+value).prop("checked", true);
					}
					if (key == 'bustCd02'){//출장자체크
						$('#'+value).prop("checked", true);
					}
					if (key == 'inwkCd01'){//사내작업체크하기
						$('#'+value).prop("checked", true);
					}
					if (key == 'inwkCd02'){//사내작업체크하기
						$('#'+value).prop("checked", true);
					}
					if (key == 'clntPjtNm') {
						clntPjt = value;
					}
				});
				
		});
	}

	
	 // 등록
	function insertQualityResp() {
		
		if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사				
			if($("input[name='CODECOBGB']:checked").val() == undefined || $("input[name='CODECOBGB']:checked").val() == ""){
		        alert("등록사유를 선택해주세요");  
			}else{	
				var formData = makeFormData();										// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
				filePostAjax("/user/qm/qm01/insertQualityResp", formData,				// 파일을 포함한 데이터를 서버로 전송하는 비동기적인 AJAX 요청을 수행
						function(data) {
							alert(data.resultMessage);								// 결과 메시지를 alert으로 출력
							if (data.resultCode == 200) {							//  요청이 성공(200)한 경우, gridView.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
								gridView.setData(0);
								modalStack.close();									// 모달을 닫음
							}
						});
			}
		}
	}
	
	// 수정
	function updateQualityResp(){	
		if( approvalYn() ) {
			alert("결재가 이미 진행중입니다.");
			return;
		}
		
		 if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사
			var formData = makeFormData();										// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
			
			 /*
		        *	결재그리드 insert make start
		        */	
		        //각업무에 맞는 param insert - 하드코딩값
				var addParam = {
							coCd: $("#popForm2 #coCd").val()
							//, todoDiv2CodeId: "TODODIV2030"
							, pgmId: "QM0101P01"
							, pgPath: "/user/qm/qm01/QM0101P04.html"
							, sanctnSttus: "N"
							, salesCd: $("#popForm2 #salesCd").val()
							, todoCoCd: $("#popForm2 #coCd").val()
							, todoNo: $("#popForm2 #rsltNo").val()
							, todoFileTrgtKey: modalStack.last().paramObj.fileTrgtKey
							, userId: jwt.userId
							};

				//부모창에서 넘어온값 - pgp
				var modalParam = {}; 
				$.each(modalStack.last().paramObj, function (key, val) {		
					modalParam[key] = val;
				});		
				if( Object.keys(modalParam).length > 0 ) {
					var pgParam = {pgParam: JSON.stringify(modalParam)}
					Object.assign(addParam, pgParam);
				}
		        approvalArr = $.approvalInsertArr(gridViewPop1, addParam);
				//결재그리드
				if(approvalArr.length > 0) {
					formData.append("approvalArr", JSON.stringify(approvalArr));
				}
		        /* 결재그리드 insert make end */
			
	      	filePostAjax("/user/qm/qm01/updateQualityResp", formData,function(data) {
						alert(data.resultMessage);
						//alert(data.resultCode);
						if (data.resultCode == 200) {
							//kakaoTodo();
							gridView.setData(0);
							modalStack.close();
						}
					});
			}
	}

	//----------------------------------------------//

	function makeFormData() {		
		// 금액 콤마 제거
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		// 폼데이터 생성
		var formData = new FormData($("#popForm2")[0]);
		formData.append("coCd", $('#coCd').val());

        //---------------------------------------------------------------
		//-------itemarr  --첨부화일 처리를 위한 부분 시작
		//---------------------------------------------------------------
		formData.append("ordrsNo", $("#ordrsNo").val());
		formData.append("userId" , jwt.userId);
		formData.append("clntCd" , $('#clntCd').val());			//첨부화일용
		formData.append("prdtCd" , $('#prdtCd').val(""));			//첨부화일용
		formData.append("itemCd" , $('#itemDiv').val(""));			//첨부화일용
		formData.append("prjctCd", $('#clntPjt').val());		//첨부화일용
		formData.append("comonCd", treeModule.getFileNodeId());	//첨부화일용
		
		//---------------------------------------------------------------  
        
        //---------------------------------------------------------------  
		var fileUploadArr = [];
		var tempArr = [];
		
		tempArr = treeModule.getFileArr();
		$.each(tempArr, function(idx, obj) {
			if (obj.fileKey == 0) {
                formData.append("files", obj.file);
                obj.file = '';
                fileUploadArr.push(obj);
			}
		});

		formData.append("uploadFileArr", JSON.stringify(fileUploadArr));
		formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
		
		
		//---------------------------------------------------------------  
		//--첨부화일 처리를 위한 부분 끝
		//--------------------------------------------------------------- 

       // 공유대상자 리스트  TODO LIST에 등록하기 위한 모듈 추가 (박성준 : 2023.08.03) 
      // 공유 : TODODIV10, TODODIV1040  결재 :TODODIV20, TODODIV2020
       var rowSharngList = gridViewPop1.target.list;
       var ParamObj = modalStack.last().paramObj.ParamObj;

       if(rowSharngList.length > 0) {
           var rowSharngListArr = []; //공유정보
           var rowApprovalListArr = []; //결재정보
           $.each(rowSharngList, function(idx, elem){
               var rowSharngListObj = elem;
               var rowApprovalListObj = elem;

               if (elem.gb == '공유'){
            	   rowSharngListObj["gb"] = elem.gb;
            	   rowSharngListObj["coCd"] = $('#coCd').val();
                   rowSharngListObj["salesCd"] = $('#salesCd').val();
                   rowSharngListObj["todoDiv1CodeId"] = "TODODIV10";
                   rowSharngListObj["todoDiv2CodeId"] = "TODODIV1050";
                   rowSharngListObj["todoId"] = elem.usrNm;
                   rowSharngListObj["todoCoCd"] = $('#coCd').val();
                   rowSharngListObj["empNo"] = elem.empNo;
                   rowSharngListObj["name"] = elem.name;
                   rowSharngListObj["telNo"] = elem.telNo;
                   rowSharngListObj["email"] = elem.eMail;    
                   rowSharngListObj["pgPath"] = "/user/qm/qm01/QM0101P03.html";
                   rowSharngListArr.push(rowSharngListObj);

               }
               else if (elem.gb == '결재'){
            	   rowApprovalListObj["gb"] = elem.gb;
            	   rowApprovalListObj["coCd"] = $('#coCd').val();
    			   rowApprovalListObj["salesCd"] = $('#salesCd').val();
    			   rowApprovalListObj["todoDiv1CodeId"] = "TODODIV20";
    			   rowApprovalListObj["todoDiv2CodeId"] = "TODODIV2030";
    			   rowApprovalListObj["todoId"] = elem.usrNm;
    			   rowApprovalListObj["todoCoCd"] = $('#coCd').val();
    			   rowApprovalListObj["empNo"] = elem.empNo;
    			   rowApprovalListObj["name"] = elem.name;
    			   rowApprovalListObj["telNo"] = elem.telNo;
    			   rowApprovalListObj["email"] = elem.eMail;    
    			   rowApprovalListObj["pgPath"] = "/user/qm/qm01/QM0101P03.html";
    			   rowApprovalListArr.push(rowApprovalListObj);
               }

               
           });

           formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));
           formData.append("rowApprovalListArr", JSON.stringify(rowApprovalListArr));
       }
       formData.append("S_todoDiv1CodeId", "TODODIV10");
       formData.append("S_todoDiv2CodeId", "TODODIV1050");

	   return formData;
	}
	
	//결재 여부
	function approvalYn() {
		var gridList = gridViewPop1.target.getList();
		var inCnt = 0;
		if( gridList.length > 0 ) {
        	var msgArr = [];			
	        $.each(gridList, function (idx, elem) {	
	        	//결재자가 본인이 아니면서 상태가 Y인 경우
	        	if( elem.todoId != jwt.userId && elem.sanctnSttus == "Y" ) inCnt++;
	        })
		}
		return inCnt;
	}
	
	function opendOrdrsSearch() {
    	var paramObj = {
    			"searchValue" : $('#ordrsNo').val(),
    			"coCd" : $('#coCd').val()
    		};
    	
    	openSecondModal("/static/html/cmn/modal/ordrsSearch.html", 800, 420, "수주번호 검색", paramObj, function (grid) {
            var row = grid.target.getList("selected")[0];
            $('#ordrsNo').val(row.ordrsNo);
        });
    }
	
    //Sales Code (수주마스터, 수주상세테이블 조인) 검색
    function wbsSalesCodeSearch() {
    	if (actionType == "C"){
	        var paramObj = {
	           "coCd" : $('#coCd').val(),
	           "salesCd": $('#salesCd').val()
	        };
	        openSecondModal("/static/html/cmn/modal/SalesCodeTreeSearch.html", 1000, 500, "SALES CODE 검색", paramObj, function (grid){
	            var row = grid.target.getList("selected")[0];
	             $('#salesCd').val(row.salesCd);
	             $('#matrDrwNo').val(row.salesCd);
	             $('#clntPjt').val(row.clntPjt);
	             $('#clntPjtCd').val(row.clntPjtCd);
	             $('#clntCd').val(row.ordrsClntCd);
	             $('#clntNm').val(row.ordrsClntNm);
	             $('#newCd').val(row.ordrsDtlDiv20Nm);
	             $('#ordrsdtldiv20').val(row.ordrsDtlDiv20);
	             $('#ordrsNo').val(row.ordrsNo);
	             $('#prdtCd').val(row.prdtCd);
	             $('#itemDiv').val(row.itemDiv);
	             $('#projNm').val(row.ctrtNm);
	        });
    	}
    }
    		
	
	// 고객사 검색
	function clntSearch() {
		openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420,
				"고객사 검색", {}, function(grid) {
					var row = grid.target.getList("selected")[0];
					$('#clntCd').val(row.clntCd);
					$('#clntNm').val(row.clntNm);
				});
	}
	
	// 자재 품번 팝업 호출하는 함수
    function openMatListSearch(openType) {
          //debugger;
          var paramObj = {
      			"searchValue" : $("#matrNm").val()
          }
          openSecondModal("/static/html/cmn/modal/matListSearch.html", 600, 420, "자재 품번 검색", paramObj, function(grid) {
                        var row = grid.target.getList("selected")[0];
                        if (openType == "P") {
							$('#matrCd').val(row.matrCd);		// 	품번 값 가져오기
							$('#matrNm').val(row.matrNm);	//	품번 값 가져오기
                        } 
                 });
    }
		
	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();
	}
	
	function selectAuth(value){
		var userDeptId = value;
		var userDept = userDeptId.substr(0, 5);
	}

	function selectQtyReqRespInfo() {						//그리드에 뿌리는 데이터
		var formData = {
			"rsltNo" : reqNo,
		}

		postAjax("/user/qm/qm01/selectQtyReqRespInfo", formData, null, function(data) {
			createCheckBox(data.result.deptId);
				$.each(data.result, function(key, value) {
					if ($('#popForm2 #' + key)[0]) {
						$('#popForm2 #' + key).val(value);	
						  if(key == "subCd" ){
							  $('#'+value).prop("checked", true);
						  }
					}
					if (key == 'todoYn'){
						if(value == 'Y'){
							$("#approval_trgt").show();
							$("#approvalReqBtn").hide();
							$("#approvalReqBtn").removeAttr("onclick");
							//결재대상자 load
							gridViewPop1.initView().setData(0);
							}
					}
				});
				
		});

	}
	
	// 등록자 검색 //  
    function openFirstResUserSearch() {
    	var paramObj = {
    		  "coCd" : $('#resCoCd').val(),
    		"userId" : $('#resRegId').val(),
    		"userNm" : $('#resRegNm').val(),
			"useYn": "Y"
    	};
    	if (actionType == "C"){
        	openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,
        			"사용자 검색", paramObj, function(tree) {
        				var checkedId = tree.get_checked()[0];
        				var checkedNode = tree.get_node(checkedId);  
        				$('#resRegId').val(checkedNode.id);
        				$('#resRegNm').val(checkedNode.text);
        				 gridView.setData(0);
        			});
    	}
    }
	
	//결재요청
	$("#approvalReqBtn").on("click", function() {
		//결재  show
		$("#approval_trgt").show();
		gridViewPop1.initView();
		$("#approvalReqBtn").hide();
	})
	
	
	//등록시 그리드값 배열 저장
	$.approvalInsertArr = function(gridObj, addParam) {
		var gridList = gridObj.target.getList();
		var gridColumns = gridObj.target.columns;
		var detailArr = [];    	
		var msgArr = [];    	
		var errCnt = 0;		
		if( gridList.length > 0 ) {
        	var msgArr = [];			
	        $.each(gridList, function (idx, elem) {
	            var detailObj = {};	     	        	
	        	//컬럼수 루프 
	        	for(var i=0; i<gridColumns.length; i++) {
					var key = gridColumns[i].key;
					var val = elem[key];
					if( typeof(val) == "undefined") val = "";					
					detailObj["idx"] = i + 1;
					//발주순번 은 select key로  ORDRG_SEQ  
					detailObj[key] = val;			            			            
	        	}
	            //필수값 체크를 여기서 한다.
	            if( detailObj['todoId'] != ""  ) {		            
		            detailArr.push(detailObj);	        	
	            }
	            //공유/결재구분
	            if( detailObj['gb'] == "결재" ) {	
	            	detailObj['todoDiv1CodeId'] = "TODODIV20";
	            	detailObj['todoDiv2CodeId'] = "TODODIV2030";
	            } else if( detailObj['gb'] == "공유" ) {
	            	detailObj['todoDiv1CodeId'] = "TODODIV10";
	            	detailObj['todoDiv2CodeId'] = "TODODIV1050";
	            }
	            //추가할 param
				$.each(addParam, function(key, val){
					detailObj[key] = val;						
				});
				//TITLE 추가
				detailObj['todoTitl'] = $("#clntNm").val() + '-' + clntPjt + '(' + $("#salesCd").val() + ") " + $("input[name='CODECOBGB']:checked")[0].dataset.label + " 발주및출장요청서 결과 " + detailObj['gb'];
	        });	
	        //error alert 후 종료
	        if( msgArr.length > 0 ) {
	        	alert(msgArr.join("\r\n"));
	        	return false;
	        }
		}
		return detailArr;
	}
	
	//입력그리드 No. 재정립
	$.gridNoSet = function(gridObj, key) {
		console.log('---gridNoset run ---');		
		var gridList = gridObj.target.getList();
		if( gridList.length > 0 ) {
			$.each(gridList, function (idx, elem) {
				let detailObj = {};	 
				gridObj.target.setValue(idx, key, idx+1);
			});	
			gridObj.target.repaint();
		}		
	}
	
	function selectApprovalCheck(value) {
		var formData = {
				"reqNo" : value
		}

		postAjaxSync("/user/qm/qm01/selectApprovalChk", formData, null, function(data) {//결재가 진행이 되었는지 안되었는지 DB체크
			var list = data.result[0]
		    if (list == 'Y'){//결재가 한개라도 진행이 되었으면 알림창

		        //input readonly, radio.checkbox disabled
				$.each($('#popForm2 select, input, textarea'), function(idx, elem){
					var id = $(elem).attr("ID");
					if( id ) {
						var eleId = "#popForm2 #"+id;
						if( $(elem).prop('tagName') == "INPUT" ) $(eleId).attr("readonly", true);
						if( $(elem).prop('tagName') == "TEXTAREA" ) $(eleId).attr("readonly", true);
						if( $(elem).prop('tagName') == "SELECT" ) $(eleId).css({'background-color':'#e6e6e6', 'pointer-events':'none'});
						if( $(elem).prop('type') == "checkbox" || $(elem).prop('type') == "radio") $(eleId).prop("disabled", true);
					} 
					
				});	
		    	
				$("#resDt").prop("disabled", true);
		    	$("#actionBtn").hide();
		        $("#plus-minus").hide();
		    }
		});
	}
	
	/*
	#	TODO 알림톡발송 시작
	#
	*/
	$("#approvalReqTodoBtn").on("click", function () {
		kakaoTodo();
	});

	function kakaoTodo() {
		let clntNm = (jwt.coCd=="GUN") ? "(주)건양ITT" : "트루넷";
		
		// Kakao 알림톡 보내는사람(userID) 연락처 조회 값 세팅 
	     var paramObj1 = {
	             "coCd" : $("#coCd").val(),
	             "userId" : $("#resRegId").val()
	         };
	      postAjaxSync("/user/wb/wb24/selectMemberTelNo", paramObj1, null, function(data){  
	          if (data.result[0] == undefined
	               || data.result[0].telNo == "") {
	        	  telNo = "051-312-2400";  
	          }
	          else {
	        	  telNo = data.result[0].telNo;
	             
	          }
	      }); 
	     //---------------------------------------
		
		let param = {
				"tmplatDiv": "TMPLATDIV02"
				, "coCd": $("#popForm2 #coCd").val()				//해당업무의 coCd(트르넷발주 TRN )
				, "todoDiv1CodeId": "TODODIV20"					//공통코드 해당업무 - 결재
				, "todoDiv2CodeId": "TODODIV2030"					//공통코드 해당업무 - 결재 - 발주서
				, "todoDiv1CodeNm": "결재"						//공통코드 해당업무 - 결재 - 발주서
				//, "todoDiv2CodeNm": "발주 및 출장 요청"						//공통코드 해당업무 - 결재 - 발주서
				, "title": "발주 및 출장 결과서"
				, "sanctnDiv2": "결재"							//템플릿 결재구분2    #{sanctnDiv2} 처리 바랍니다.
				, "todoNo": $("#popForm2 #rsltNo").val()
				, "clntCd": "1"					//발신회사는 로그인사용자 회사
				, "clntNm": clntNm				//로그의 수신거래처명
				, "ordrgMngNm": $("#popForm2 #resRegNm").val()			//발주작성자(담당자)
				, "ordrgMngTelNo": telNo		//담당자전화번호		
				, "creatPgm"  : "QM0101P01"
		}
	     debugger;
		commKaKaoSendTodo(param);
	     
		//공유
		let param2 = {
				"tmplatDiv": "TMPLATDIV02"
					, "coCd": $("#popForm2 #coCd").val()				//해당업무의 coCd(트르넷발주 TRN )
					, "todoDiv1CodeId": "TODODIV10"					//공통코드 해당업무 - 결재
					, "todoDiv2CodeId": "TODODIV1050"					//공통코드 해당업무 - 결재 - 발주서
					, "todoDiv1CodeNm": "공유"						//공통코드 해당업무 - 결재 - 발주서
					, "title": "발주 및 출장 결과서"
					, "sanctnDiv2": "공유"							//템플릿 결재구분2    #{sanctnDiv2} 처리 바랍니다.
					, "todoNo": $("#popForm2 #rsltNo").val()
					, "clntCd": "1"					//발신회사는 로그인사용자 회사
					, "clntNm": clntNm				//로그의 수신거래처명
					, "ordrgMngNm": $("#popForm2 #resRegNm").val()			//발주작성자(담당자)
					, "ordrgMngTelNo": telNo		//담당자전화번호		
					, "creatPgm"  : "QM0101P01"
		}
		commKaKaoSendTodo(param2);
	}

	//to-do결재요청 알림톡
	function commKaKaoSendTodo(param) {
		console.log('---카카오 발주및출장결과서 알림톡발송시작 --' + param);

		//알림톡수신번호 채번
		var maxMessageId = null;			//message id(unique key)
		var talkMessage = null 				//발송될 내용 template
		var mobile = null					//수신인 휴대전화번호
		//var title = null					//todo title
		var todoDiv2CodeNm = null					//todo title
		var sendList = [];
		let talkParam = {};
		let talkBody = {};		
		let sendCnt = 0;
		postAjaxSync("/user/bm/bm18/selectMaxMessageIdTodo", param, null
					, function(data) {   
						if(data.resultList.length > 0 ) {
							if( data.resultList[0].maxMessageId != "" ) {
								sendList = data.resultList; 
							} else {
								alert("알림톡 발송을 위한 messageId 생성에 실패 했습니다.");
								return;
							} 

						}
		});     	
		//user search ajax end
		
		//대상 loop
		$.each(sendList, function (key, sendObj) {
			maxMessageId = sendObj.maxMessageId;							
			talkMessage = sendObj.messageDesc;
			mobile =  sendObj.telNo;
			//로그용
			param.rcvId = sendObj.todoId;			//todo 수신id
			param.rcvNm = sendObj.name;				//todo 수신자명
			param.nameTo = sendObj.name;				//todo 수신자명
			//title		= sendObj.todoTitl;
			todoDiv2CodeNm =   sendObj.todoTitl;
			param.todoDiv2CodeNm = todoDiv2CodeNm;
			//param.title = title;								//요청내용제목
			param.sendDt = sendObj.sendDt;
			
			if(mobile == "" || mobile == null) {
				alert('수신전화번호가 없습니다.\r\n['+clntNm+'] 거래처관리의 사업부 첫번째 항목을 확인해 주십시오.');
				return;
			}
			if(talkMessage == "" || talkMessage == null) {
				alert('발송할 내용이 없습니다.\r\n알림톡템플릿관리를 확인해 주십시오.');
				return;
			}	
			//message 치환
			let message = talkMessage;
			let splitStr = Array.from(message.matchAll('\\{(.*?)\\}'), match => `${match[0]}`);	
			//loop
			$.each(splitStr, function (key, val) {		
				let compKey = val.substring(1, val.length-1);
				if( compKey != "" && compKey != "undefined" ) {
					if( typeof(param[compKey]) != "undefined" ) {
						let val2 = '#'+val;
						message = message.replaceAll(val2, param[compKey]);
					}
				}
			});

			talkParam.authToken = "e/eDfZOFCsrBqadaECQ0+g==";
			talkParam.serverName = "gyitt2400";		
			talkParam.paymentType = "P";
			talkBody.service = "2310086157";				//서비스번호(1000000000 - 예시  real : 2310086157
			talkBody.messageId = maxMessageId;			//고객사에서 관리하는 메시지No - 40byte (unique 값);	
			talkBody.title = param.title;					//알림톡 타이틀 -
			talkBody.message = message;				//알림톡 메시지 (1000 byte) 
			talkBody.mobile = mobile;				//휴대전화번호
			talkBody.template = "10003";			//템플릿관리화면 템플릿ID	- 발주서 V2
			let talkJson = JSON.stringify(talkBody);
			sendCnt = kakaoSendReal(talkJson, talkParam, param);		
		});
		//대상 loop end
		if( sendCnt > 0 ) {
			alert("알림톡 정상 발송되었습니다.");		
		}
	}



	var kakaoErr = [];
	//message load
	var paramObj = {
					"userId" : jwt.userId
					, "codeKind" : "KAKAOMSG"
					};
	postAjax("/user/sm/sm02/selectCurrToday", paramObj, null
				, function(data) {   
					if(data.resultList.length > 0 ) {
						kakaoErr = data.resultList;
					}
	});     //user search ajax end	
</script>