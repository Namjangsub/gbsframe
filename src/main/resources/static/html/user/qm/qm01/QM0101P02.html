<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">요인별 발주 및 출장결과 등록</h4>
    </div>
  <form id="popForm" onSubmit="return false;">
    <div class="form-group popup_table">
		<input type="hidden" id="fileTrgtKey"  name="fileTrgtKey">
		<input type="hidden" id="userId"     name="userId">
		<input type="hidden" id="pgmId"     name="pgmId"	value="QM0101M01">
		<input type="hidden" id="sharId1"     name="sharId1" >
		<input type="hidden" id="sharId2"     name="sharId2" >
		<input type="hidden" id="sharId3"     name="sharId3" >
		<input type="hidden" id="sharId4"     name="sharId4" >
		<input type="hidden" id="sharId5"     name="sharId5" >
		<input type="hidden" id="sharId6"     name="sharId6" >
		<input type="hidden" id="sharId7"     name="sharId7" >
		<input type="hidden" id="sharId8"     name="sharId8" >
		<input type="hidden" id="sharId9"     name="sharId9" >
		<input type="hidden" id="sharId10"    name="sharId10" >
		<input type="hidden" id="signId1"   name="signId1" >
		<input type="hidden" id="signId2"   name="signId2" >
		<input type="hidden" id="signId3"   name="signId3" >
		<input type="hidden" id="signId4"   name="signId4" >
		<input type="hidden" id="signId5"   name="signId5" >
		<input type="hidden" id="signId6"   name="signId6" >
		<input type="hidden" id="signId7"   name="signId7" >
		<input type="hidden" id="signId8"   name="signId8" >
		<input type="hidden" id="signId9"   name="signId9" >
		<input type="hidden" id="signId10"  name="signId10" >
		<input type="hidden" id="sharIdNull"     name="sharIdNull" >
		<input type="hidden" id="signIdNull"    name="signIdNull" >
		<input type="hidden" id="userEmpNo"     name="userEmpNo" >
		<input type="hidden" id="userDeptId"    name="userDeptId" >
		<input type="hidden" id="userDept"      name="userDept" >
 	<table>
        <colgroup>
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
        </colgroup>
        <!-- 요청 정보 readOnly-->
         <tr><th colspan="10" style="height:25px;text-align:center;font-size:15px;">[요청된 정보]</th></tr>
        <tr>
			<th>회사</th>
			<td>
				<select id="coCd" name="coCd" data-kind="CO" readonly="readonly" ></select>
			</td>
			<th >관리번호</th>
			<td>
				 <input type="text" id="reqNo" name="reqNo" >
			</td>
			<th>발행일자</th>
			<td>
				<input id="ordrgDt" name="ordrgDt" class="input_calendar form-control" autocomplete="off" readonly="readonly"  >
			</td>			
			<th>발행자</th>
			<td>
                 <div class="search_form">						
			    	<input type="hidden" id="ordrgId" name="ordrgId"  data-search="ordrgId"  >
             		<input type="text"	id="ordrgNm" data-search="ordrgNm" readonly="readonly">
                 </div>
			</td>
			<th>접수자</th>
			<td>
			     <div class="search_form">						
			    	<input type="hidden" id="regId" name="regId" data-search="regId"  >
             		<input type="text"	id="regNm" data-search="regNm"  readonly="readonly">
                 </div>
			</td>
        </tr>
		 <tr>     
		   <th>SalesCode</th>
				<td>
					<div class="search_form">
					    <input type="text" id="salesCd" name="salesCd" readonly="readonly">
				    </div>
				</td>
			<th>대표도면번호</th>
			<td>
				<input type="text" id="matrDrwNo" name="matrDrwNo" readonly="readonly">
			</td>
			<th>고객사</th>
			<td>
			    <input type="hidden" id="clntCd" name="clntCd" data-search="clntCd" >				
				<div class="search_form">
					<input type="text" id="clntNm" name="clntNm" data-search="clntNm" readonly="readonly">
				</div>
			</td>
			<th>고객사PJT</th>
			<td>
				<input type="text" id="clntPjt" name="clntPjt" readonly="readonly"> 
			</td>
			<th>신작구분</th>
			<td>
			   <select id="newCd" name="newCd" data-kind="NEWCD" data-search="newCd" >
				 <option value="">전체</option>
			   </select>
			</td>
        </tr>
        <tr>
			<th class="hit">요청구분</th>
			<td style="text-align:left;">
			  <input type="hidden" id="reqCd"  name="reqCd" >
			 <!--   <div data-kind="REQCD"></div> -->
			    <input type="radio" id="REQCD1" name="REQCDCP" value="REQCD01" style="padding:0px;margin:0;width:auto;" > 발주
			    <input type="radio" id="REQCD2" name="REQCDCP" value="REQCD02" style="padding:0px;margin:0;width:auto;" > 출장
			</td>
			<th>요구일정</th>
			<td>
				<input id="reqDt" name="reqDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);"  date >
			</td>
			<th>수주번호</th>
			<td>
		         <div class="search_form">
                       <input type="text" id="ordrsNo" name="ordrsNo">
                 </div>
			</td>
			<th>Project명</th>
			<td>
			    <input type="text" id="projNm" name="projNm" >
			</td>
			<th colspan="2">
			</th>
        </tr>

        <tr>
			<th>출장자</th>
			<td style="text-align:left;">
			   <input type="hidden" id="bustCd"  name="bustCd" >
			  <!--  -  <div data-kind="BUSTCD"></div>-->
			    <input type="radio" id="BUSTCD1" name="BUSTCDCP" value="BUSTCD01" style="padding:0px;margin:0;width:auto;" > 생산
			     <input type="radio" id="BUSTCD2" name="BUSTCDCP" value="BUSTCD02" style="padding:0px;margin:0;width:auto;" > 전기
			</td>
			<th>출장자명</th>
			<td>
			     <input type="text" id="bustNm" name="bustNm" readonly="readonly">
			</td>
			<th>사내작업</th>
			<td style="text-align:left;">
			    <input type="hidden" id="inwkCd" name="inwkCd" >
			   <!-- <div data-kind="INWKCD"></div>-->
			    <input type="radio" id="INWKCD1" name="INWKCDCP" value="INWK01" style="padding:0px;margin:0;width:auto;" > 생산
			    <input type="radio" id="INWKCD2" name="INWKCDCP" value="INWK02" style="padding:0px;margin:0;width:auto;" > 전기
			</td>
			<th>출장장소(고객사)</th>
			<td>
			     <input type="text" id="bustPe" name="bustPe" readonly="readonly">
			</td>
			<th colspan="2">
			</th>
        </tr>
        <tr style="height:25px;">
			<th>분류</th>
			<td colspan= "9" style="text-align:left;">	
			  <input type="hidden" id="partCd" name="partCd">		   
			 <!--  <div data-kind="COBTP"></div>-->
			 <input type="radio" id="COBTP1" name="COBTPCP" value="COBTP01" style="padding:0px;margin:0;width:auto;"> 출도
			 <input type="radio" id="COBTP2" name="COBTPCP" value="COBTP02" style="padding:0px;margin:0;width:auto;"> 추가
			 <input type="radio" id="COBTP3" name="COBTPCP" value="COBTP03" style="padding:0px;margin:0;width:auto;"> 장애
			 <input type="radio" id="COBTP4" name="COBTPCP" value="COBTP04" style="padding:0px;margin:0;width:auto;"> A/S유상
			 <input type="radio" id="COBTP5" name="COBTPCP" value="COBTP05" style="padding:0px;margin:0;width:auto;"> A/S무상
			 <input type="radio" id="COBTP6" name="COBTPCP" value="COBTP06" style="padding:0px;margin:0;width:auto;"> SPARE유상
			 <input type="radio" id="COBTP7" name="COBTPCP" value="COBTP07" style="padding:0px;margin:0;width:auto;"> SPARE무상
			 <input type="radio" id="COBTP8" name="COBTPCP" value="COBTP08" style="padding:0px;margin:0;width:auto;"> 고객E/O
			 <input type="radio" id="COBTP9" name="COBTPCP" value="COBTP09" style="padding:0px;margin:0;width:auto;"> 설치시운전
			 <input type="radio" id="COBTP10" name="COBTPCP" value="COBTP99" style="padding:0px;margin:0;width:auto;"> 기타
			</td>
       </tr>
        <tr style="height:25px;">
          <th>요청구분</th>
          <td><!-- COBGB -->
            <input type="hidden" name="deptCd" id="deptCd" >
            <input type="text" name="deptNm1" id="deptNm1" >
          </td>
          <td style="height:20px;text-align:left;" colspan="2" data-id="DEPTCD2"><!-- COBGBP -->
             <input type="hidden" name="deptCd2" id="deptCd2">
             <input type="hidden" name="deptNm2" id="deptNm2" >
          </td>
          <th>요청내용</th>
          <td>
            <input type="hidden" name="midCd" id="midCd" >
            <input type="text" name="midNm" id="midNm" >
          </td>
         <td style="height:20px;text-align:left;" colspan="4">
            <input type="hidden" name="subCd" id="subCd" >  <!-- "소속부서의 분류 항목 " --> 
          </td>
        </tr>
        <tr style="height:25px;">
		  <th >비고</th> 
		  <td colspan= "10" style="text-align:left;">	
			 <input type="text" id="reqRmk" name="reqRmk">	
		  </td>
        </tr>
        <!---------------- 결과정보 입력  ------------------>
        <tr><th colspan="10" style="height:25px;text-align:center;font-size:15px;">[결과정보 입력]</th></tr>
        <tr><th class="hit">회사</th>
            <td>
                <select id="resCoCd" name="resCoCd" data-kind="CO" msg="회사" required>
				</select>
			</td>
            <th>실적번호</th>
            <td>
               <input type="hidden" id="resReqNo" name="resReqNo" >
             <input type="text" id="rsltNo" name="rsltNo" readonly="readonly"><!-- 결과정보 입력시 자동생성 -->
            </td>          
            <th class="hit">실적일자</th>
			<td>
				<input id="rsltDt" name="rsltDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);"  msg="실적일자"  date  required>
			</td>			
			<th class="hit">등록자</th>
			<td>
                 <div class="search_form">						
			    	<input type="hidden" id="resRegId" name="resRegId"  data-search="resRegId" msg="등록자아이디" required>
             		<input type="text"	id="resRegNm" data-search="resRegNm" msg="등록자" required>
             		<a onclick="openFirstResUserSearch();"><i class="i_search_w" id="userIdBtn"></i></a>
                 </div>
			</td>
            <th colspan="2"></th>
        </tr>          
      </table>
      <table width="100%">
        <colgroup>
          <col width="8%">
          <col width="15%">
          <col width="26%">
          <col width="15%">
          <col width="26%">
          <col width="10%">
        </colgroup>        
           <tr>
             <th> 
              <input type="hidden" name="resDeptCd" id="resDeptCd" >
              <input type="hidden" name="resDeptCd2" id="resDeptCd2" >
             </th>           
               <th style="text-align:center;font-weight:bold;" >
	                             영업<br>
	             <input type="checkbox" id="COBGBP1" name="COBGBPCP" value="COBGBP11" onClick="checkOneDept(this,'COBGBPCP','COBGB1','COBGBP11');"> 국내
	             <input type="checkbox" id="COBGBP2" name="COBGBPCP" value="COBGBP12" onClick="checkOneDept(this,'COBGBPCP','COBGB1','COBGBP12');"> 해외
             </th>
             <th style="text-align:center;font-weight:bold;" >
                                      기술연구소<br>
                 <input type="checkbox" id="COBGBP3" name="COBGBPCP" value="COBGBP21" onClick="checkOneDept(this,'COBGBPCP','COBGB2','COBGBP21');"> 선형개발
                 <input type="checkbox" id="COBGBP4" name="COBGBPCP" value="COBGBP22" onClick="checkOneDept(this,'COBGBPCP','COBGB2','COBGBP22');"> 개발설계
                 <input type="checkbox" id="COBGBP5" name="COBGBPCP" value="COBGBP23" onClick="checkOneDept(this,'COBGBPCP','COBGB2','COBGBP23');"> 양산설계
             </th>
             <th style="text-align:center;font-weight:bold;">
                              생산<br>
             </th>
             <th style="text-align:center;font-weight:bold;">
				 구매외주팀<br>
				 <input type="checkbox" id="COBGBP6" name="COBGBPCP" value="COBGBP41" onClick="checkOneDept(this,'COBGBPCP','COBGB4','COBGBP41');"> 기계
				 <input type="checkbox" id="COBGBP7" name="COBGBPCP" value="COBGBP42" onClick="checkOneDept(this,'COBGBPCP','COBGB4','COBGBP42');"> 가공
				 <input type="checkbox" id="COBGBP8" name="COBGBPCP" value="COBGBP43" onClick="checkOneDept(this,'COBGBPCP','COBGB4','COBGBP43');"> 전기
		     </th>
             <th style="text-align:center;font-weight:bold;">
                 <input type="checkbox" id="COBGBP9" name="COBGBPCP" value="COBGBP91" onClick="checkOneDept(this,'COBGBPCP','COBGB9','COBGBP91');">기타( )
             </th> 
          </tr>
             <tr> 
                <th class="hit"> 발생원인 
			     <input type="hidden" id="resMidCd" name="resMidCd">
			     <input type="hidden" id="resSubCd" name="resSubCd">
			     <input type="hidden" id="resSubCd1" name="resSubCd1">
			    </th>          
			    <td style="vertical-align:top;">
			    <table id="COBGB1">
			    </table>
			    </td> 
			     <td style="vertical-align:top;">
			    <table id="COBGB2">
			    </table>
			    </td> 
			     <td style="vertical-align:top;">
			    <table id="COBGB3">
			    </table>
			    </td> 
			     <td style="vertical-align:top;">
			    <table id="COBGB4">
			    </table>
			    </td> 
			     <td style="vertical-align:top;">
			    <table id="COBGB9">
			    </table>
			    </td> 
                 <td>
	         </tr>
	         <tr>
             <tr style="height:25px;">
			  <th >비고</th> 
			  <td colspan ="5" style="text-align:left;">	
				 <input type="text" id="rsltRmk" name="rsltRmk">	
			  </td>
	         </tr>
	         <tr style="height:25px;">
			  <th >조치</th> 
			  <td colspan ="5" style="text-align:left;">	
				<textarea id="measRst" name="measRst" cols="200" rows="5" style="border: none" ></textarea>	
			  </td>
	         </tr>
	         <tr style="height:25px;">
			  <th >결과</th> 
			  <td colspan ="5" style="text-align:left;">
				 <textarea id="resltRst" name="resltRst" cols="200" rows="5" style="border: none" ></textarea>	
			  </td>
	         </tr>
	         <tr style="height:25px;">
			  <th >고찰</th> 
			  <td colspan ="5" style="text-align:left;">
				 <textarea id="thghRst" name="thghRst" cols="200" rows="5"  style="border: none"></textarea>	
			  </td>
	         </tr>
      </table>
    </form>
     <div class="popup_table">  
      <table style="border:0px;">
       <tr>
        <td>
          <!-- 결제대상자-->    
         <table style="border:0px;">
            <tr style="height:30px;">
              <td style="text-align: LEFT; border-right: 0px;;font-size:13px;font-weight:bold;">※ 결제대상자</td>
              <td>
	              <div class="add_btn_small pdl10">   
	              	  <button type="button" class="btn btn-primary btn-sm" id="approvalBtn" onclick="opendModalApprovalListList();">결재라인</button>    
			          <a onclick="insertSignUserResModal();" style="height: 30px; line-height: 28px;" authchk>+</a>
			          <a onclick="deleteSignUser();" style="height: 30px; line-height: 28px;" authchk>-</a>    
			      </div>
              </td>
            </tr>
            <tr>
              <td colspan="2">
               <div class="contents">
				 <div class="ax5_grid" data-ax5grid="first-grid-modal1" data-ax5grid-config="{}" style="height: 350px; width: 99%" ></div>
			   </div>
			  </td> 
			</tr>  
        </table>
        </td>
        <td>
          <!-- 공유대상자   -->
         <table style="border:0px;">
            <tr style="height:30px;">
              <td style="text-align: LEFT; border-right: 0px;;font-size:13px;font-weight:bold;">※ 공유대상자</td>
              <td>
	              <div class="add_btn_small pdl10">
	              	  <button type="button" class="btn btn-primary btn-sm" id="shareBtn" onclick="opendModalSharngListList();">공유라인</button>       
			          <a onclick="insertShareUserResModal();" style="height: 30px; line-height: 28px;" authchk>+</a>
			          <a onclick="deleteShareUser();" style="height: 30px; line-height: 28px;" authchk>-</a>    
			      </div>
              </td>
            </tr>
            <tr>
              <td colspan="2">
               <div class="contents">
				 <div class="ax5_grid" data-ax5grid="second-grid-modal2" data-ax5grid-config="{}" style="height: 350px; width: 99%" ></div>
			   </div>
			  </td> 
			</tr>  
        </table> 
        </td>
       </tr>   
      </table>
     </div>
    
	</div>

	<!-- 공통 파일 영역-->
    <div id="fileList_area"></div>
	<!-- 공통 파일 영역 -->
       
    <br>
	
</div>
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtn" authChk>등록</button>
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>

<script type="text/javascript">
	var fileTrgtKey = null;
	var gridViewPop1 = {
		initView : function() {
  			this.target = new ax5.ui.grid();
  			this.target.setConfig({
  		    	showRowSelector: true,
  		    	multipleSelect: false,
  		    	sortable: true,
  		        target: $('[data-ax5grid="first-grid-modal1"]'),
  		        header: {
  		        	align: "center",
  		        	selector: true
  		        },
  		        body: {
  		        	 onClick: function () {
  		                this.self.select(this.dindex);
  		            },
  		            onDBLClick: function () {
  		            },
  		        },
				page : {
					navigationItemCount : 10,
					height : 30,
					display : true,
					firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
					prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
					nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
					lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
					onChange : function() {
						gridViewPop1.setData(this.page.selectPage);
					}
				},
		    	columns : [
		    		     {key: "rnum",	        label: "NUM",	    width: 30,		align: "center", 	hidden:false}
		    		    ,{key: "coCd",	        label: "회사코드",		width: 100,		align: "center", 	hidden:true}
		    		    ,{key: "wbsSharngUserId",	label: "아이디",		width: 100,		align: "center", 	hidden:true}
						,{key: "empNo",	        label: "사번",		width: 100,		align: "center", 	hidden:false}
						,{key: "usrNm",	        label: "성명",		width: 100,		align: "center", 	hidden:false}
						,{key: "telNo",	        label: "전화번호",		width: 100,		align: "center", 	hidden:false}
						,{key: "eMail",	        label: "E-mail",	width: 200,		align: "center", 	hidden:false}
						,{key: "dtNm",	        label: "부서",		width: 100,		align: "center", 	hidden:true}
						,{key: "rsltNo",	    label: "key",		width: 100,		align: "center", 	hidden:true}						
    	              ]
					});
        			return this;
        		},

        		setData : function(_pageNo) {
        			
        			var approval = ""
            			
            			if (actionType == "S" || actionType == "T"){
            				approval = (modalStack.last().paramObj.reqNo);
            			}
            			else {
            				approval = $('#rsltNo').val()
            			}

        			var targetObj = this.target;
        			var formData = {
     	        			"rsltNo" : approval   	        			
     	    		}

   					postAjax("/user/qm/qm01/selectSignResUserlst", formData, null, function(data){		
   					var list = data.result;
   						targetObj.setData({
   	  						list : list,
	   	  					page : {
				                   totalElements : data.paginationInfo.totalRecordCount
						    } 
   	  					});
   	  				});
          		}
  	}
	
	
	
	var gridViewPop = {
		initView : function() {
  			this.target = new ax5.ui.grid();
  			this.target.setConfig({
  		    	showRowSelector: true,
  		    	multipleSelect: false,
  		    	sortable: true,
  		        target: $('[data-ax5grid="second-grid-modal2"]'),
  		        header: {
  		        	align: "center",
  		        	selector: true
  		        },
  		        body: {
  		        	 onClick: function () {
  		                this.self.select(this.dindex);
  		            },
  		            onDBLClick: function () {
  		            },
  		        },
				page : {
					navigationItemCount : 10,
					height : 30,
					display : true,
					firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
					prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
					nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
					lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
					onChange : function() {
						gridViewPop.setData(this.page.selectPage);
					}
				},
		    	columns : [
		    		     {key: "rnum",	        label: "NUM",	    width: 30,		align: "center", 	hidden:false}
		    		    ,{key: "coCd",	        label: "회사코드",		width: 100,		align: "center", 	hidden:true}
		    		    ,{key: "wbsSharngUserId", label: "아이디",		width: 100,		align: "center", 	hidden:true}
						,{key: "empNo",	        label: "사번",		width: 100,		align: "center", 	hidden:false}
						,{key: "usrNm",	        label: "성명",		width: 100,		align: "center", 	hidden:false}
						,{key: "telNo",	        label: "전화번호",		width: 100,		align: "center", 	hidden:false}
						,{key: "eMail",	        label: "E-mail",	width: 200,		align: "center", 	hidden:false}
						,{key: "dtNm",	        label: "부서",		width: 100,		align: "center", 	hidden:true}
						,{key: "rsltNo",	    label: "key",		width: 100,		align: "center", 	hidden:true}						
    	              ]
					});
        			return this;
        		},

        		setData : function(_pageNo) {
        			var sign = ""
        			
        			if (actionType == "S" || actionType == "T"){
        				sign = (modalStack.last().paramObj.reqNo);
        			}
        			else {
        				sign = $('#rsltNo').val()
        			}
        			var targetObj = this.target;
        			var formData = {
        					//"rsltNo" : $('#rsltNo').val()
        					"rsltNo" : sign
     	    		}

   					postAjax("/user/qm/qm01/selectShareResUserlst", formData, null, function(data){		
   					var list = data.result;
   						targetObj.setData({
   	  						list : list,
	   	  					page : {
				                   totalElements : data.paginationInfo.totalRecordCount
						    } 
   	  					});
   	  				});
          		}
  	}
	
	
	
	function checkOneDept(element,itemCd,deptVal,deptVal2) {
// 		 const checkboxes = document.getElementsByName(itemCd);
// 		  checkboxes.forEach((cb) => {   cb.checked = false; })		  
// 		  element.checked = true;
		  $("#resDeptCd").val(deptVal);
		  $("#resDeptCd2").val(deptVal2);
	}
	
	function checkOne(element,itemCd,midVal,subVal) {
		//https://hianna.tistory.com/434 [체크박스 하나만 선택되도록 구현하기]
// 		 const checkboxes = document.getElementsByName(itemCd);
// 		  checkboxes.forEach((cb) => {   cb.checked = false; })		  
// 		  element.checked = true;		  
		  $("#resMidCd").val(midVal);
		  $("#resSubCd").val(subVal);

	}
	
	function checkOne2(element,itemCd,midVal,subVal,deptVal,deptVal2) {
		//https://hianna.tistory.com/434 [체크박스 하나만 선택되도록 구현하기]
// 		 const checkboxes = document.getElementsByName(itemCd);
// 		  checkboxes.forEach((cb) => {   cb.checked = false; })		  
// 		  element.checked = true;		  
		  $("#resMidCd").val(midVal);
		  $("#resSubCd").val(subVal);
		  $("#resDeptCd").val(deptVal);
		  $("#resDeptCd2").val(deptVal2);
	}
	
	$(document).ready(function() {
		actionType = modalStack.last().paramObj.actionType
		fileTrgtKey = modalStack.last().paramObj.fileTrgtKey;		
		setCommonSelect($(".popup_area select[data-kind]"));
		setCommonDiv($(".popup_area div[data-kind]"));
		//setCommonItem($(".popup_area table[data-kind]"));	
		$("#resSubCd1").val(modalStack.last().paramObj.rsltSubCd);

		const arr = [1,2,3,4,9];
	    for (var i =  0; i < arr.length; i++){
	    	setCommonCode('COBGB'+arr[i]);
	    }


		setByCoCd(modalStack.last().paramObj.coCd);
	    setByresCoCd(modalStack.last().paramObj.coCd);
	    //$("#resCoCd").prop("disabled", true);
	    
		$("#popForm #userId").val(jwt.userId);
		$("#userEmpNo").val(jwt.empNo);
		$("#userDeptId").val(jwt.deptId); 
		var userDeptId = jwt.deptId;
		var userDept = userDeptId.substr(0, 5);
		$("#userDept").val(userDept);
		
		//영업 30, 기술연구소 40, 생산 60, 구매외주팀 50 
		if(userDept == "GUN30"){
			$("#resDeptCd").val("COBGB1");
			$("#COBGB111").prop("disabled", false);
			$("#COBGB121").prop("disabled", false);
			$("#COBGB122").prop("disabled", false);
			$("#COBGB123").prop("disabled", false);
			$("#COBGB124").prop("disabled", false);
			$("#COBGB125").prop("disabled", false);
			$("#COBGB126").prop("disabled", false);
			$("#COBGB131").prop("disabled", false);
			$("#COBGB132").prop("disabled", false);
			$("#COBGB133").prop("disabled", false);
			$("#COBGB191").prop("disabled", false);		
			
			 if (jwt.deptId == "GUN3010"){           //국내영업
				$("#COBGBP1").prop("disabled", false); 
				$("#COBGBP1").prop("checked", true);  
				$("#resDeptCd2").val("COBGBP11");
			 }else if (jwt.deptId == "GUN3020"){    //해외영업
				$("#COBGBP2").prop("disabled", false); 
				$("#COBGBP2").prop("checked", true);
				$("#resDeptCd2").val("COBGBP12");
			 }
		 
		}else if(userDept == "GUN40"){
				$("#resDeptCd").val("COBGB2");
				$("#COBGB211").prop("disabled", false);
				$("#COBGB251").prop("disabled", false);
				$("#COBGB212").prop("disabled", false);
				$("#COBGB252").prop("disabled", false);
				$("#COBGB221").prop("disabled", false);
				$("#COBGB253").prop("disabled", false);
				$("#COBGB222").prop("disabled", false);
				$("#COBGB254").prop("disabled", false);
				$("#COBGB223").prop("disabled", false);
				$("#COBGB255").prop("disabled", false);
				$("#COBGB224").prop("disabled", false);
				$("#COBGB256").prop("disabled", false);
				$("#COBGB231").prop("disabled", false);
				$("#COBGB257").prop("disabled", false);
				$("#COBGB232").prop("disabled", false);
				$("#COBGB261").prop("disabled", false);
				$("#COBGB233").prop("disabled", false);
				$("#COBGB262").prop("disabled", false);
				$("#COBGB234").prop("disabled", false);
				$("#COBGB263").prop("disabled", false);
				$("#COBGB235").prop("disabled", false);
				$("#COBGB291").prop("disabled", false);
				$("#COBGB241").prop("disabled", false);
				$("#COBGB242").prop("disabled", false);
				$("#COBGB243").prop("disabled", false);
				$("#COBGB244").prop("disabled", false);
			
			  if(jwt.deptId == "GUN4010"){        //선형개발 //기술개발
				 $("#COBGBP3").prop("disabled", false); 
				 $("#COBGBP3").prop("checked", true); 	
				 $("#resDeptCd2").val("COBGBP21");
			  }else if(jwt.deptId == "GUN4020"){  //개발설계 //기술개발
				  $("#COBGBP4").prop("disabled", false); 
				  $("#COBGBP4").prop("checked", true); 
				  $("#resDeptCd2").val("COBGBP22");
			  }else if(jwt.deptId == "GUN4030"){  //양산설계 //기술개발
				  $("#COBGBP5").prop("disabled", false); 
				  $("#COBGBP5").prop("checked", true);
				  $("#resDeptCd2").val("COBGBP23");
			  }
		  
		}else if(userDept == "GUN60"){ 
			
			$("#resDeptCd").val("COBGB3");
			$("#resDeptCd2").val("COBGB31");
			$("#COBGB311").prop("disabled", false);
			$("#COBGB312").prop("disabled", false);
			$("#COBGB321").prop("disabled", false);
			$("#COBGB322").prop("disabled", false);
			$("#COBGB323").prop("disabled", false);
			$("#COBGB324").prop("disabled", false);
			$("#COBGB325").prop("disabled", false);
			$("#COBGB396").prop("disabled", false);
	    
		}else if(userDept == "GUN50"){
			
			$("#resDeptCd").val("COBGB4");
			$("#COBGB411").prop("disabled", false);
			$("#COBGB454").prop("disabled", false);
			$("#COBGB412").prop("disabled", false);
			$("#COBGB453").prop("disabled", false);
			$("#COBGB421").prop("disabled", false);
			$("#COBGB452").prop("disabled", false);
			$("#COBGB431").prop("disabled", false);
			$("#COBGB451").prop("disabled", false);
			$("#COBGB432").prop("disabled", false);
			$("#COBGB461").prop("disabled", false);
			$("#COBGB433").prop("disabled", false);
			$("#COBGB462").prop("disabled", false);
			$("#COBGB434").prop("disabled", false);
			$("#COBGB471").prop("disabled", false);
			$("#COBGB441").prop("disabled", false);
			$("#COBGB472").prop("disabled", false);
			$("#COBGB473").prop("disabled", false);
			$("#COBGB481").prop("disabled", false);
			$("#COBGB482").prop("disabled", false);
			$("#COBGB483").prop("disabled", false);
			$("#COBGB484").prop("disabled", false);
			
			if(jwt.deptId == "GUN5010"){  //기계//구매외주팀
				$("#COBGBP6").prop("disabled", false); 
				$("#COBGBP6").prop("checked", true);
				$("#resDeptCd2").val("COBGBP41");
			}else if(jwt.deptId == "GUN5020"){  //전기/구매외주팀
				$("#COBGBP8").prop("disabled", false); 
				$("#COBGBP8").prop("checked", true); 
				$("#resDeptCd2").val("COBGBP43");
			}else if(jwt.deptId == "GUN5030"){  //가공//구매외주팀
				$("#COBGBP7").prop("disabled", false); 
				$("#COBGBP7").prop("checked", true);			
				$("#resDeptCd2").val("COBGBP42");
			}			
		}else{ //기타 부서
			   $("#COBGBP9").prop("disabled", false); 
			   $("#COBGBP9").prop("checked", true); 
			   $("#resDeptCd").val("COBGB9");
			   $("#resDeptCd2").val("COBGBP91");
			   $("#resSubCd").val("rsltRmk");
		}
		 			 
	   
       	//발행일자//
// 		$('#ordrgDt').datepicker({
// 			format : "yyyy-mm-dd",
// 			language : "ko",
// 			autoclose : true
// 		}).datepicker("setDate", "today");
		
		//요구일정//
		$('#reqDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		}).datepicker("setDate", "today");
       //실적일자
		$('#rsltDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		}).datepicker("setDate", "today");

		authChk();						// 권한체크
		
		selectQtyReqRespInfo();
		
		 $("#REQCD1").prop("disabled", true); //요청구분[발주] disabled
		 $("#REQCD2").prop("disabled", true); //요청구분[출장] disabled
		 
		 $("#BUSTCD1").prop("disabled", true); //출장자[생산] disabled
		 $("#BUSTCD2").prop("disabled", true); //출장자[전기] disabled
		 
		 $("#INWKCD1").prop("disabled", true); //사내작업[생산] disabled
		 $("#INWKCD2").prop("disabled", true); //사내작업[전기] disabled
		 
		 $("#COBTP1").prop("disabled", true); 
		 $("#COBTP2").prop("disabled", true);
		 $("#COBTP3").prop("disabled", true); 
		 $("#COBTP4").prop("disabled", true);
		 $("#COBTP5").prop("disabled", true);
		 $("#COBTP6").prop("disabled", true);
		 $("#COBTP7").prop("disabled", true);
		 $("#COBTP8").prop("disabled", true);
		 $("#COBTP9").prop("disabled", true);
		 $("#COBTP10").prop("disabled", true);
		 
		
		$("#reqNo").prop("readonly", true); 

		$("#newCd").prop("disabled", true);				
		$("#reqDt").prop("disabled", true);
		$("#ordrsNo").prop("readonly", true); 
		$("#projNm").prop("readonly", true); 
	
		$("#deptCd").prop("disabled", true);
		$("#deptCd2").prop("disabled", true);
		$("#deptNm1").prop("disabled", true);
		$("#deptNm2").prop("disabled", true);
		$("#midCd").prop("disabled", true);
		$("#midNm").prop("disabled", true);
		$("#subCd").prop("disabled", true);
		$("#reqRmk").prop("disabled", true);			
		
		$("#creatId").val(modalStack.last().paramObj.userId);	
		$("#resRegId").val(jwt.userId);
		$("#resRegNm").val(modalStack.last().paramObj.userName);
		var reqNo = modalStack.last().paramObj.reqNo;
		var rsltNo_ = modalStack.last().paramObj.rsltNo;	
		$("#resReqNo").val(reqNo);
		$("#rsltNo").val(rsltNo_);
			
			//요청정보 			
			var valId ="";
			var midCd_ = modalStack.last().paramObj.midCd;
			if (midCd_ != undefined){			
				var valId2 = modalStack.last().paramObj.midCd;
				setCommonTd($(".popup_area td[data-kind]"),'',valId2); 
			}
		  
			if($("#deptCd").val() == "COBGB1" || $("#resDeptCd").val() == "COBGB1" ){  //영업
		      valId = "COBGBP1";
			}else if($("#deptCd").val() == "COBGB2"|| $("#resDeptCd").val() == "COBGB2"){ //기술연구소
			  valId = "COBGBP2";
			}else if($("#deptCd").val() == "COBGB3"|| $("#resDeptCd").val() == "COBGB3"){
			  valId = "COBGBP3";
			}else if($("#deptCd").val() == "COBGB4"|| $("#resDeptCd").val() == "COBGB4"){
			  valId = "COBGBP4";
			}else if($("#deptCd").val() == "COBGB9" || $("#resDeptCd").val() == "COBGB9"){
			  valId = "COBGBP9";
			}
				   
		    gridViewPop1.initView().setData(0);
		    gridViewPop.initView().setData(0);

			if((rsltNo_ == undefined || rsltNo_ == "")&& actionType == "C"){
				$('.tit').text('요인별 발주 및 출장결과 등록');
				$("#actionBtn").text("등록");
				$('#actionBtn').on("click", function() {
					insertQualityResp();
				});
				
			}else if (actionType == "U") {
				$("#rsltNo").prop("readonly", true); //실적번호
				$('.tit').text('요인별 발주 및 출장결과 수정');
				$('#actionBtn').text("수정");
				$('#actionBtn').on("click", function() {
					updateQualityResp();
				});
			}else if (actionType == "S") {
				$('.tit').text('발주 및 출장요청서 결과 결재')
	        	actionBtn.style.display = "none";
	        	selectQtyReqRespInfo();
	        	
	        	gridViewPop.setData();
	        	gridViewPop1.setData();

			}else if (actionType == "T") {
				$('.tit').text('발주 및 출장요청서 결과 공유')
	        	actionBtn.style.display = "none";
	        	selectQtyReqRespInfo();
	        	
	        	gridViewPop.setData();
	        	gridViewPop1.setData();
			}
			
		    
		//---------------------------------------------------------------  
		//첨부 화일 처리 시작 
		//---------------------------------------------------------------  
		fileParam = {
				fileTrgtTyp	: $("#pgmId").val(),
				fileTrgtKey		:fileTrgtKey
		}
  		treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
		//---------------------------------------------------------------  
		//첨부 화일 처리 끝
		//---------------------------------------------------------------  		
		
	});
		
	
	// 결제대상자 추가// 	
	function insertSignUserResModal() {   
		var paramObj = {"coCd" : $('#resCoCd').val()	};	    
    	openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,  
    			"사용자 검색", paramObj, function(tree) {
    				var checkedId = tree.get_checked()[0];
    				var checkedNode = tree.get_node(checkedId);
    				var paramObj = {"coCd" : $(".popup_area #resCoCd").val(), "userId" : checkedId};
    				 postAjax("/user/qm/qm01/selectShareUserInfo", paramObj, null, function(data) {    					
    						gridViewPop1.target.addRow($.extend({}, "last", false));                             
    						var row = gridViewPop1.target.getList().length -1 ;
    						gridViewPop1.target.setValue(row, "rnum", gridViewPop1.target.getList().length);

    						gridViewPop1.target.setValue(row, "empNo", data.resultList[0].empNo);
    						gridViewPop1.target.setValue(row, "usrNm", data.resultList[0].usrNm);
    						gridViewPop1.target.setValue(row, "telNo", data.resultList[0].telNo);
    						gridViewPop1.target.setValue(row, "levelNm", data.resultList[0].levelNm);
    						gridViewPop1.target.setValue(row, "eMail", data.resultList[0].eMail);
    						gridViewPop1.target.setValue(row, "dtNm", data.resultList[0].dtNm);
    						gridViewPop1.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
    				});     
    			});
    }   
	
	
	// 공유대상자 추가//  
    function insertShareUserResModal() {    
		var paramObj = {"coCd" : $('#resCoCd').val()	};	    
    	openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,
    			"사용자 검색", paramObj, function(tree) {
    				var checkedId = tree.get_checked()[0];
    				var checkedNode = tree.get_node(checkedId); 
    				var paramObj = {"coCd" : $(".popup_area #resCoCd").val(), "userId" : checkedId};
                    postAjax("/user/qm/qm01/selectShareUserInfo", paramObj, null, function(data) {
    						gridViewPop.target.addRow($.extend({}, "last", false));                             
    						var row = gridViewPop.target.getList().length -1 ;
    						gridViewPop.target.setValue(row, "rnum", gridViewPop.target.getList().length);
//     						if(row == 0){ $('#sharId1').val(data.resultList[0].id); }
//     						if(row == 1){ $('#sharId2').val(data.resultList[0].id); }
//     						if(row == 2){ $('#sharId3').val(data.resultList[0].id); }
//     						if(row == 3){ $('#sharId4').val(data.resultList[0].id); }
//     						if(row == 4){ $('#sharId5').val(data.resultList[0].id); }
//     						if(row == 5){ $('#sharId6').val(data.resultList[0].id); }
//     						if(row == 6){ $('#sharId7').val(data.resultList[0].id); }
//     						if(row == 7){ $('#sharId8').val(data.resultList[0].id); }
//     						if(row == 8){ $('#sharId9').val(data.resultList[0].id); }
//     						if(row == 9){ $('#sharId10').val(data.resultList[0].id); }
    						gridViewPop.target.setValue(row, "empNo", data.resultList[0].empNo);
    						gridViewPop.target.setValue(row, "usrNm", data.resultList[0].usrNm);
    						gridViewPop.target.setValue(row, "telNo", data.resultList[0].telNo);
    						gridViewPop.target.setValue(row, "levelNm", data.resultList[0].levelNm);
    						gridViewPop.target.setValue(row, "eMail", data.resultList[0].eMail);
    						gridViewPop.target.setValue(row, "dtNm", data.resultList[0].dtNm);
    						gridViewPop.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
    				});     
    			});
    }   
	
    function deleteShareUser(){
    	
    	var selRow = parseInt(gridViewPop.target.selectedDataIndexs);    	
 		if( isNaN(selRow) ) {
 			alert("선택된 행이 없습니다.");
 			return;
 		} else {			
 				if( selRow > -1 ) {
 					gridViewPop.target.removeRow(selRow);
 					 				
 					if(selRow == 0){ $('#sharId1').val($('#sharIdNull').val()); }
					if(selRow == 1){ $('#sharId2').val($('#sharIdNull').val()); }
					if(selRow == 2){ $('#sharId3').val($('#sharIdNull').val()); }
					if(selRow == 3){ $('#sharId4').val($('#sharIdNull').val()); }
					if(selRow == 4){ $('#sharId5').val($('#sharIdNull').val()); }
					if(selRow == 5){ $('#sharId6').val($('#sharIdNull').val()); }
					if(selRow == 6){ $('#sharId7').val($('#sharIdNull').val()); }
					if(selRow == 7){ $('#sharId8').val($('#sharIdNull').val()); }
					if(selRow == 8){ $('#sharId9').val($('#sharIdNull').val()); }
					if(selRow == 9){ $('#sharId10').val($('#sharIdNull').val()); }
 				}
 		}
    }
    
    function deleteSignUser(){
    	
    	var selRow = parseInt(gridViewPop1.target.selectedDataIndexs);    	
 		if( isNaN(selRow) ) {
 			alert("선택된 행이 없습니다.");
 			return;
 		} else {			
 				if( selRow > -1 ) {
 					gridViewPop1.target.removeRow(selRow); 					
 					if(selRow == 0){ $('#signId1').val($('#signIdNull').val()); }
					if(selRow == 1){ $('#signId2').val($('#signIdNull').val()); }
					if(selRow == 2){ $('#signId3').val($('#signIdNull').val()); }
					if(selRow == 3){ $('#signId4').val($('#signIdNull').val()); }
					if(selRow == 4){ $('#signId5').val($('#signIdNull').val()); }
					if(selRow == 5){ $('#signId6').val($('#signIdNull').val()); }
					if(selRow == 6){ $('#signId7').val($('#signIdNull').val()); }
					if(selRow == 7){ $('#signId8').val($('#signIdNull').val()); }
					if(selRow == 8){ $('#signId9').val($('#signIdNull').val()); }
					if(selRow == 9){ $('#signId10').val($('#signIdNull').val()); }
 				}
 		}
    }
	
	
	 // 발행자 검색 //  
    function openFirstUserSearch() {
    	var paramObj = {
    		  "coCd" : $('#coCd').val(),
    		"userId" : $('#ordrgNm').val(),
    	};
    	openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,
    			"사용자 검색", paramObj, function(tree) {
    				var checkedId = tree.get_checked()[0];
    				var checkedNode = tree.get_node(checkedId);    				
    				$('#ordrgId').val(checkedNode.id);
    				$('#ordrgNm').val(checkedNode.text);
    				 gridView.setData(0);
    			});
    }   
	 
	 // 접수자 검색 //  
    function openSecondUserSearch() {
    	var paramObj = {
    		  "coCd" : $('#coCd').val(),
    		"userId" : $('#regNm').val(),
    	};
    	openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,
    			"사용자 검색", paramObj, function(tree) {
    				var checkedId = tree.get_checked()[0];
    				var checkedNode = tree.get_node(checkedId);    				
    				$('#regId').val(checkedNode.id);
    				$('#regNm').val(checkedNode.text);
    				 gridView.setData(0);
    			});
    }  	
    
    // 등록자 검색 //  
    function openFirstResUserSearch() {
    	var paramObj = {
    		  "coCd" : $('#resCoCd').val(),
    		"userId" : $('#resRegNm').val(),
    	};
    	openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,
    			"사용자 검색", paramObj, function(tree) {
    				var checkedId = tree.get_checked()[0];
    				var checkedNode = tree.get_node(checkedId);  
    				$('#resRegId').val(checkedNode.id);
    				$('#resRegNm').val(checkedNode.text);
    				 gridView.setData(0);
    			});
    }   
    
	function selectQtyReqRespInfo() {						//그리드에 뿌리는 데이터
		var formData = {
			"fileTrgtKey" : fileTrgtKey,
		}

		postAjax("/user/qm/qm01/selectQtyReqRespInfo", formData, null, function(data) {
				$.each(data.result, function(key, value) {
					if ($('#popForm #' + key)[0]) {
						$('#popForm #' + key).val(value);	

							if(key == "reqCd"){ 
 								if(value == $("#REQCD1").val()){ $("#REQCD1").prop("checked", true); $("#REQCD1").prop("disabled", true);}
								if(value == $("#REQCD2").val()){ $("#REQCD2").prop("checked", true); $("#REQCD2").prop("disabled", true);}
							}
							if(key == "bustCd"){ 
 								if(value == $("#BUSTCD1").val()){ $("#BUSTCD1").prop("checked", true); $("#BUSTCD1").prop("disabled", true);}
 								if(value == $("#BUSTCD2").val()){ $("#BUSTCD2").prop("checked", true); $("#BUSTCD2").prop("disabled", true);}
 							}
							if(key == "inwkCd"){ 
								if(value == $("#INWKCD1").val()){ $("#INWKCD1").prop("checked", true);  $("#INWKCD1").prop("disabled", true);}
 								if(value == $("#INWKCD2").val()){ $("#INWKCD2").prop("checked", true);  $("#INWKCD2").prop("disabled", true);}	
							}
							if(key == "partCd"){ 
								if(value == $("#COBTP1").val()){ $("#COBTP1").prop("checked", true);  $("#COBTP1").prop("disabled", true) }
								if(value == $("#COBTP2").val()){ $("#COBTP2").prop("checked", true);  $("#COBTP2").prop("disabled", true) }	
								if(value == $("#COBTP3").val()){ $("#COBTP3").prop("checked", true);  $("#COBTP3").prop("disabled", true) }	
								if(value == $("#COBTP4").val()){ $("#COBTP4").prop("checked", true);  $("#COBTP4").prop("disabled", true) }	
								if(value == $("#COBTP5").val()){ $("#COBTP5").prop("checked", true);  $("#COBTP5").prop("disabled", true) }	
								if(value == $("#COBTP6").val()){ $("#COBTP6").prop("checked", true);  $("#COBTP6").prop("disabled", true) }	
								if(value == $("#COBTP7").val()){ $("#COBTP7").prop("checked", true);  $("#COBTP7").prop("disabled", true) }	
								if(value == $("#COBTP8").val()){ $("#COBTP8").prop("checked", true);  $("#COBTP8").prop("disabled", true) }	
								if(value == $("#COBTP9").val()){ $("#COBTP9").prop("checked", true); $("#COBTP9").prop("disabled", true) }	
								if(value == $("#COBTP10").val()){ $("#COBTP10").prop("checked", true); $("#COBTP10").prop("disabled", true) }
							}
							
						  if(key == "resDeptCd2" ){
							  var test = value.split(",");
							   for (var j = 0; j < test.length; j++){
								   if (test[j] == $("#COBGBP1").val()){ $("#COBGBP1").prop("checked", true); }
	 							   if (test[j] == $("#COBGBP2").val()){ $("#COBGBP2").prop("checked", true); } 
	 							   if (test[j] == $("#COBGBP3").val()){ $("#COBGBP3").prop("checked", true); } 
	 							   if (test[j] == $("#COBGBP4").val()){ $("#COBGBP4").prop("checked", true); } 
	 							   if (test[j] == $("#COBGBP5").val()){ $("#COBGBP5").prop("checked", true); } 
	 							   if (test[j] == $("#COBGBP6").val()){ $("#COBGBP6").prop("checked", true); } 
	 							   if (test[j] == $("#COBGBP7").val()){ $("#COBGBP7").prop("checked", true); } 
	 							   if (test[j] == $("#COBGBP8").val()){ $("#COBGBP8").prop("checked", true); } 
	 							   if (test[j] == $("#COBGBP9").val()){ $("#COBGBP9").prop("checked", true); } 

							   }
							  
						  }

// 						if ($('#popForm #' + key).is('[comma]')) {
// 							onlyNumber($('#popForm #' + key)[0]);
							
// 						}
					}
				});
				
		});

	}

	
	 // 등록
	function insertQualityResp() {
		
		if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사
			
			if($("#resRegId").val() == ""){	
				alert("등록자 아이디를 선택해주세요");
			}else if($("#resDeptCd").val() == "COBGB9" && $("#rsltRmk").val() == ""){ //비고
		        alert("기타사항 비고를 입력해주세요"); 
			}else{	
				var formData = makeFormData();										// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
				filePostAjax("/user/qm/qm01/insertQualityResp", formData,				// 파일을 포함한 데이터를 서버로 전송하는 비동기적인 AJAX 요청을 수행
						function(data) {
							alert(data.resultMessage);								// 결과 메시지를 alert으로 출력
							if (data.resultCode == 200) {							//  요청이 성공(200)한 경우, gridView.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
								gridView.setData(0);
								modalStack.close();									// 모달을 닫음
							}
						});
			}
		}
	}
	
	// 수정
	function updateQualityResp(){	
		
		 if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사
			var formData = makeFormData();										// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
	      	filePostAjax("/user/qm/qm01/updateQualityResp", formData,function(data) {
						alert(data.resultMessage);
						//alert(data.resultCode);
						if (data.resultCode == 200) {
							gridView.setData(0);
							modalStack.close();
						}
					});
			}
	}

	//----------------------------------------------//

	function makeFormData() {		
		// 금액 콤마 제거
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		// 폼데이터 생성
		var formData = new FormData($("#popForm")[0]);
		
		formData.append("ordrsNo", $("#ordrsNo").val());
		formData.append("userId" , jwt.userId);
		formData.append("clntCd" , $('#clntCd').val());			//첨부화일용
		formData.append("prdtCd" , $('#prdtCd').val(""));			//첨부화일용
		formData.append("itemCd" , $('#itemDiv').val(""));			//첨부화일용
		formData.append("prjctCd", $('#clntPjt').val());		//첨부화일용
		formData.append("comonCd", treeModule.getFileNodeId());	//첨부화일용		
		
		//---------------------------------------------------------------  

		var copArr = []
		var copbgbdiv = []
		
		
		$('input:checkbox[name=COBGBPCP]').each(function (index) {
			if($(this).is(":checked")==true){
		    	console.log($(this).val());
		    	copArr.push($(this).val());
		   		
		    }
		});
		
        $('input:checkbox[name=COPBGBDIV]').each(function (index) {
			if($(this).is(":checked")==true){
		    	console.log($(this).val());
		    	copbgbdiv.push($(this).val());
		   		
		    }
		});
		
		console.log(copArr);
		console.log(copbgbdiv);
		formData.append("copArr", copArr);		
		formData.append("copBgbDiv", copbgbdiv);	

        //---------------------------------------------------------------  
		var fileUploadArr = [];
		var tempArr = [];
		
		tempArr = treeModule.getFileArr();
		$.each(tempArr, function(idx, obj) {
			if (obj.fileKey == 0) {
                formData.append("files", obj.file);
                obj.file = '';
                fileUploadArr.push(obj);
			}
		});

		formData.append("uploadFileArr", JSON.stringify(fileUploadArr));
		formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
		//---------------------------------------------------------------  
		//--첨부화일 처리를 위한 부분 끝
		//--------------------------------------------------------------- 

		// 공유대상자 리스트  TODO LIST에 등록하기 위한 모듈 추가 (박성준 : 2023.08.03) 
      // 공유 : TODODIV10, TODODIV1040  결재 :TODODIV20, TODODIV2020
       var rowSharngList = gridViewPop.target.list;
	   var rowApprovalList = gridViewPop1.target.list;
       var ParamObj = modalStack.last().paramObj.ParamObj;

       if(rowSharngList.length > 0) {
           var rowSharngListArr = [];
           $.each(rowSharngList, function(idx, elem){
               var rowSharngListObj = elem;
               rowSharngListObj["coCd"] = $('#coCd').val();
               rowSharngListObj["salesCd"] = $('#salesCd').val();
               rowSharngListObj["todoDiv1CodeId"] = "TODODIV10";
               rowSharngListObj["todoDiv2CodeId"] = "TODODIV1040";
               rowSharngListObj["todoId"] = elem.id;
               rowSharngListObj["todoCoCd"] = elem.coCd;
               rowSharngListObj["empNo"] = elem.empNo;
               rowSharngListObj["name"] = elem.usrNm;
               rowSharngListObj["telNo"] = elem.telNo;
               rowSharngListObj["email"] = elem.eMail;    
               rowSharngListObj["pgPath"] = "/user/qm/qm01/QM0101P02.html";
               //rowSharngListObj["pgParam"] = ParamObj;
              
               rowSharngListArr.push(rowSharngListObj);
           });
           formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));           
       }
       formData.append("S_todoDiv1CodeId", "TODODIV10");
       formData.append("S_todoDiv2CodeId", "TODODIV1040");

//        if (actionType == "C") {
    	   if (rowApprovalList.length > 0) {
    		   $.each(rowApprovalList, function(idx, elem) {
    			   var rowApprovalListArr = [];
    			   var rowApprovalListObj = elem;
    			   rowApprovalListObj["coCd"] = $('#coCd').val();
    			   rowApprovalListObj["salesCd"] = $('#salesCd').val();
    			   rowApprovalListObj["todoDiv1CodeId"] = "TODODIV20";
    			   rowApprovalListObj["todoDiv2CodeId"] = "TODODIV2020";
    			   rowApprovalListObj["todoId"] = elem.id;
    			   rowApprovalListObj["todoCoCd"] = elem.coCd;
    			   rowApprovalListObj["empNo"] = elem.empNo;
    			   rowApprovalListObj["name"] = elem.usrNm;
    			   rowApprovalListObj["telNo"] = elem.telNo;
    			   rowApprovalListObj["email"] = elem.eMail;    
    			   rowApprovalListObj["pgPath"] = "/user/qm/qm01/QM0101P02.html";
    			   //rowApprovalListObj["pgParam"] = ParamObj;
    			   rowApprovalListArr.push(rowApprovalListObj);
               });
    		   formData.append("rowApprovalListArr", JSON.stringify(rowApprovalList));
    	   }
//        }
//        else if (actionType == "U") {
//     	   formData.append("reqNo", $('#reqNo').val());
//            formData.append("salesCd", $('#salesCd').val());           
//        }
       
       formData.append("A_todoDiv1CodeId", "TODODIV20");
       formData.append("A_todoDiv2CodeId", "TODODIV2020");
       
		return formData;
	}
	
	function opendOrdrsSearch() {
    	var paramObj = {
    			"searchValue" : $('#ordrsNo').val(),
    			"coCd" : $('#coCd').val()
    		};
    	
    	openSecondModal("/static/html/cmn/modal/ordrsSearch.html", 800, 420, "수주번호 검색", paramObj, function (grid) {
            var row = grid.target.getList("selected")[0];
            $('#ordrsNo').val(row.ordrsNo);
        });
    }
	
    //Sales Code (수주마스터, 수주상세테이블 조인) 검색
    function wbsSalesCodeSearch() {
        var paramObj = {
           "coCd" : $('#coCd').val(),
           "salesCd": $('#salesCd').val()
        };
        openSecondModal("/static/html/cmn/modal/SalesCodeTreeSearch.html", 1000, 500, "SALES CODE 검색", paramObj, function (grid){
            var row = grid.target.getList("selected")[0];
            $('#salesCd').val(row.salesCd);
            $('#clntPjt').val(row.clntPjt);
        });
    }
    		
	
	// 고객사 검색
	function clntSearch() {
		openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420,
				"고객사 검색", {}, function(grid) {
					var row = grid.target.getList("selected")[0];
					$('#clntCd').val(row.clntCd);
					$('#clntNm').val(row.clntNm);
				});
	}
	
	// 자재 품번 팝업 호출하는 함수
    function openMatListSearch(openType) {
          //debugger;
          var paramObj = {
      			"searchValue" : $("#matrNm").val()
          }
          openSecondModal("/static/html/cmn/modal/matListSearch.html", 600, 420, "자재 품번 검색", paramObj, function(grid) {
                        var row = grid.target.getList("selected")[0];
                        if (openType == "P") {
							$('#matrCd').val(row.matrCd);		// 	품번 값 가져오기
							$('#matrNm').val(row.matrNm);	//	품번 값 가져오기
                        } 
                 });
    }
		
	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();
	}
	
	function setByresCoCd(value) {
		$('#resCoCd option:not([value="'+value+'"])').remove();
	}
	  
	function setCommonCode(value){
			var param = {
				"codeKind" : value,

			};

			postAjaxSync("/user/qm/qm01/selectMainCodeList", param , null,  function(data) {
				var inputHtml = '';
				var codeList = data.childCodeList;
				var i = "CP";
				var j = 0;

				var cop1Chk = false;
				var cop1Db = $('#resSubCd1').val();
				var cop1DbArr = cop1Db.split(",");

				   $.each(codeList, function (index, item){
						j = j+1;

						inputHtml += '<tr>'
							if(item.midNm2 == ' '){
							    inputHtml += ' ';
							}else{
								inputHtml += '<th rowspan="'+item.subCnt+'" style="width:25%;height:20px;">'+item.midNm
								inputHtml += '</th>'
							}

						if (cop1Db != ''){
							var sop = $.inArray(item.subCd,cop1DbArr );
							if (sop >= 0){
								var ck = "checked";
							}
							else if (sop < 0){
								ck = "";
							}

						}

						inputHtml += '<td style="width:75%;text-align:left;">'
						//inputHtml += '<input type="checkbox" name="'+item.midCd+i+'" value="'+item.subCd+'">';
						inputHtml += '<input type="checkbox" name="COPBGBDIV" value="'+item.subCd+'" '+ck+'>';
						inputHtml += ' ';
						inputHtml += item.subNm;
						inputHtml += `</td>`
						inputHtml += '</tr>'

					});
				   
					$('#'+value).append(inputHtml);
					//$('#'+value).append("<input type='button' value='test' onclick='kk()'>");

			})

	}
	
	//공유대상자 팝업
	   function opendModalSharngListList() { 
		   //debugger;
	       var formData = {};
	       openSecondModal("/static/html/user/wb/wb02/WB0202P01.html", 1300, 780, "결재선 지정", formData, function (grid){
	               var rowList = grid.target.getList("selected");
	               if (rowList.length > 0) {
	                   var chk = false;
	                   $.each(rowList, function(idx, elem){ 
	                       if (elem.check == "Y") { 
	                           var userId = elem.appId;
	                           var rowList1 = gridViewPop.target.getList();
	                           $.each(rowList1, function(idx, elem){
	                                if (elem.wbsSharngUserId == userId) {
	                                   chk = true;
	                               }
	                           });
	                       }
	                   });
	                   if (chk == false) {
	                       $.each(rowList, function(idx, elem){
	                           if (elem.check == "Y") {
	                                   var paramObj = {"coCd" : elem.coCd, "userId" : elem.appId};            
	                                   postAjax("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
	                                	   		gridViewPop.target.addRow($.extend({}, "last", false));
	                                           var row = gridViewPop.target.getList().length - 1;
	                                           gridViewPop.target.setValue(row, "salesCd", $("#salesCd").val());
	                                           //gridViewPop.target.setValue(row, "wbsPlanNo", $("#wbsPlanNo").val());
//	                                           if (lvl == 1) {
//	                                        	   gridViewPop.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel1").val());
//	                                               gridViewPop.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel1 option:checked").text());
//	                                           }
//	                                           else if (lvl == 2) {
//	                                        	   gridViewPop.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel2").val());
//	                                              gridViewPop.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel2 option:checked").text());
//	                                           }
//	                                           else if (lvl == 3) {
//	                                        	   gridViewPop.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel3").val());
//	                                              gridViewPop.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel3 option:checked").text());
//	                                           }
	                                           
	                                           //gridViewPop.target.setValue(row, "wbsPlancoCd", data.resultList[0].coCd);
	                                          // gridViewPop.target.setValue(row, "wbsPlancoCdNm", data.resultList[0].coCdNm);
	                                           gridViewPop.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
	                                           gridViewPop.target.setValue(row, "empNo", data.resultList[0].empNo);
	                                           gridViewPop.target.setValue(row, "usrNm", data.resultList[0].name);
	                                           gridViewPop.target.setValue(row, "telNo", data.resultList[0].telNo);
	                                           gridViewPop.target.setValue(row, "eMail", data.resultList[0].email);                                        
	                                   });
	                             }
	                       });
	                  }
	                  else {
	                      alert("중복 공유를 지정할 수 없습니다.");
	                      return;
	                  }
	               }
	               
	       });
	   }
	
	 //결재대상자 팝업
	   function opendModalApprovalListList() { 
		   //debugger;
	       var formData = {};
	       openSecondModal("/static/html/user/wb/wb02/WB0202P01.html", 1300, 780, "결재선 지정", formData, function (grid){
	               var rowList = grid.target.getList("selected");
	               if (rowList.length > 0) {
	                   var chk = false;
	                   $.each(rowList, function(idx, elem){ 
	                       if (elem.check == "Y") { 
	                           var userId = elem.appId;
	                           var rowList1 = gridViewPop.target.getList();
	                           $.each(rowList1, function(idx, elem){
	                                if (elem.wbsSharngUserId == userId) {
	                                   chk = true;
	                               }
	                           });
	                       }
	                   });
	                   if (chk == false) {
	                       $.each(rowList, function(idx, elem){
	                           if (elem.check == "Y") {
	                                   var paramObj = {"coCd" : elem.coCd, "userId" : elem.appId};            
	                                   postAjax("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
	                                      		gridViewPop1.target.addRow($.extend({}, "last", false));
	                                           var row = gridViewPop1.target.getList().length - 1;
	                                           gridViewPop1.target.setValue(row, "salesCd", $("#salesCd").val());
	                                           //gridViewPop.target.setValue(row, "wbsPlanNo", $("#wbsPlanNo").val());
//	                                           if (lvl == 1) {
//	                                        	   gridViewPop.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel1").val());
//	                                               gridViewPop.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel1 option:checked").text());
//	                                           }
//	                                           else if (lvl == 2) {
//	                                        	   gridViewPop.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel2").val());
//	                                              gridViewPop.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel2 option:checked").text());
//	                                           }
//	                                           else if (lvl == 3) {
//	                                        	   gridViewPop.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel3").val());
//	                                              gridViewPop.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel3 option:checked").text());
//	                                           }
	                                           
	                                           //gridViewPop.target.setValue(row, "wbsPlancoCd", data.resultList[0].coCd);
	                                          // gridViewPop.target.setValue(row, "wbsPlancoCdNm", data.resultList[0].coCdNm);
	                                           gridViewPop1.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
	                                           gridViewPop1.target.setValue(row, "empNo", data.resultList[0].empNo);
	                                           gridViewPop1.target.setValue(row, "usrNm", data.resultList[0].name);
	                                           gridViewPop1.target.setValue(row, "telNo", data.resultList[0].telNo);
	                                           gridViewPop1.target.setValue(row, "eMail", data.resultList[0].email);                                        
	                                   });
	                             }
	                       });
	                  }
	                  else {
	                      alert("중복 공유를 지정할 수 없습니다.");
	                      return;
	                  }
	               }
	               
	       });
	   }

</script>