<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">요인별 발주 및 출장요청 등록</h4>
    </div>
  <form id="popForm" onSubmit="return false;">
    <div class="form-group popup_table">
		<input type="hidden" id="fileTrgtKey"  	name="fileTrgtKey">
		<input type="hidden" id="userId"     	name="userId">
		<input type="hidden" id="pgmId"     	name="pgmId"	value="QM0101M01">
		<input type="hidden" id="sharId1"       name="sharId1" >
		<input type="hidden" id="sharId2"       name="sharId2" >
		<input type="hidden" id="sharId3"       name="sharId3" >
		<input type="hidden" id="sharId4"       name="sharId4" >
		<input type="hidden" id="sharId5"       name="sharId5" >
		<input type="hidden" id="sharId6"       name="sharId6" >
		<input type="hidden" id="sharId7"       name="sharId7" >
		<input type="hidden" id="sharId8"       name="sharId8" >
		<input type="hidden" id="sharId9"       name="sharId9" >
		<input type="hidden" id="sharId10"      name="sharId10" >
		<input type="hidden" id="sharIdNull"    name="sharIdNull" >
		<input type="hidden" id="userEmpNo"     name="userEmpNo" >
		<input type="hidden" id="userDeptId"    name="userDeptId" >
		<input type="hidden" id="userDept"      name="userDept" >
		<input type="hidden" id="appCnt"      name="appCnt">
 	<table>
        <colgroup>
          <col width="10%">
          <col width="15%">
          <col width="10%">
          <col width="16%">
          <col width="10%">
          <col width="14%">
          <col width="10%">
          <col width="15%">
        </colgroup>
        <tr>
			<th class="hit">회사</th>
			<td>
				<select id="coCd" name="coCd" data-kind="CO" class="form-control input-sm"  msg="회사" required >
				</select>
			</td>
			<th class="hit">접수자</th>
			<td>
			     <div class="search_form">						
			    	<input type="hidden" id="regId" name="regId" data-search="regId" msg="접수자아이디">
             		<input type="text"	id="regNm" data-search="regNm" msg="접수자이름" readonly="readonly">
             		<a onclick="openSecondUserSearch();"><i class="i_search_w" id="userIdBtn"></i></a>
                 </div>
			</td>
			<th>출장자</th>
			<td style="text-align:left;">
			    <input type="checkbox" id="BUSTCD1" name="BUSTCDCP" value="BUSTCD01"  onClick="checkCd(this,'BUSTCDCP','BUSTCD01');"> 생산 
			    <input type="checkbox" id="BUSTCD2" name="BUSTCDCP" value="BUSTCD02"  onClick="checkCd(this,'BUSTCDCP','BUSTCD02');"> 전기 
			</td>
			<th >관리번호</th>
			<td>
				 <div class="search_form">
				  <input type="text" id="reqNo" name="reqNo" readonly="readonly" >
				 </div>
			</td>
        </tr>
		 <tr>
			<th class="hit">발행일자</th>
			<td>
				<input id="ordrgDt" name="ordrgDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);"   msg="발행일자"  date  required>
			</td>
			<th class="hit">요구일정</th>
			<td>
				<input id="reqDt" name="reqDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);"    msg="요구일정"  date  required >
			</td>
			<th>출장자명</th>
			<td>
			     <input type="text" id="bustNm" name="bustNm" >
			</td>
			<th>수주번호</th>
			<td>
                <input type="text" id="ordrsNo" name="ordrsNo" readonly="readonly">
			</td>
        </tr>
        <tr>		
			<th class="hit">발행자</th>
			<td>
                 <div class="search_form">						
			    	<input type="hidden" id="ordrgId" name="ordrgId"  data-search="ordrgId" msg="발행자아이디" >
             		<input type="text"	id="ordrgNm" data-search="ordrgNm" msg="발행자" readonly="readonly">
             		<a onclick="openFirstUserSearch();"><i class="i_search_w" id="userIdBtn"></i></a>
                 </div>
			</td>
			<th class="hit">요청구분</th>
			<td style="text-align:left;">
			  <input type="hidden" id="reqCd"  name="reqCd" msg="요청구분" required>
			 <!--   <div data-kind="REQCD"></div> -->
			    <input type="radio" id="REQCD1" name="REQCDCP" value="REQCD01" style="padding:0px;margin:0;width:auto;" onClick="checkCd(this,'REQCDCP','REQCD01');"> 발주
			    <input type="radio" id="REQCD2" name="REQCDCP" value="REQCD02" style="padding:0px;margin:0;width:auto;" onClick="checkCd(this,'REQCDCP','REQCD02');"> 출장
			</td>
			<th>출장장소(고객사)</th>
			<td>
			     <input type="text" id="bustPe" name="bustPe">
			</td>
			<th>대표도면번호</th>
			<td>
				<input type="text" id="matrDrwNo" name="matrDrwNo" readonly="readonly" >
			</td>
        </tr>
		   <th class="hit">SalesCode</th>
				<td>
					<div class="search_form">
					    <input type="text" id="salesCd" name="salesCd" msg="salesCode" readonly="readonly" >
					   	<a onclick="wbsSalesCodeSearch();"><i class="i_search_w"></i></a>
				    </div>
				</td>
			<th>사내작업</th>
			<td style="text-align:left;">
			    <input type="hidden" id="inwkCd" name="inwkCd" >
			    <input type="checkbox" id="INWKCD1" name="INWKCDCP" value="INWK01"  onClick="checkCd(this,'INWKCDCP','INWK01');"> 생산 
			    <input type="checkbox" id="INWKCD2" name="INWKCDCP" value="INWK02"  onClick="checkCd(this,'INWKCDCP','INWK02');"> 전기 
			</td>
			<th>고객사</th>
			<td>
			    <input type="hidden" id="clntCd" name="clntCd" data-search="clntCd" msg="고객사코드">				
				<input type="text" id="clntNm" name="clntNm" data-search="clntNm" msg="고객사" readonly="readonly">
			</td>
			<th>Project명</th>
			<td>
			    <input type="text" id="projNm" name="projNm" readonly="readonly">
			</td>
        </tr>
        <tr>
			<th>분류</th>
			<td colspan= "3" style="text-align:left;">	
				<div id="COBTP-radioButtonContainer"></div>		   
			</td>
			<th>고객사PJT</th>
			<td>
				<input type="text" id="clntPjt" name="clntPjt" msg="고객사PJT" readonly="readonly"> 
			</td>
			<th>신작구분</th>
			<td>
			   <input type="hidden" id="ordrsdtldiv20" name="ordrsdtldiv20">
			   <input type="text" id="newCd" name="newCd" readonly="readonly" >
			</td>
        </tr>
        
        <tr>
			<th >등록 사유</th>
			<td colspan= "3" style="text-align:left;">	
				<div id="COBGB-checkboxContainer"></div>		   
			</td>
           <td colspan= 5>
		    <!-- 공유대상자-->
		    <div class="popup_table">               
		        <table style="border:0px;">
		            <tr style="height:30px;">
		              <td style="text-align: LEFT; border-right: 0px;;font-size:13px;font-weight:bold;">※ 공유대상자</td>
		              <td>
			              <div class="add_btn_small pdl10">       
			              	  <button type="button" class="btn btn-primary btn-sm" id="shareBtn" onclick="opendModalSharngListList();">공유라인</button>
					          <a onclick="insertShareUserModal();" style="height: 30px; line-height: 28px;" authchk>+</a>
					          <a onclick="deleteShareUser();" style="height: 30px; line-height: 28px;" authchk>-</a>    
					      </div>
		              </td>
		            </tr>
		            <tr>
		              <td colspan="2">
		               <div>
						 <div class="ax5_grid" data-ax5grid="first-grid-modal" data-ax5grid-config="{}" style="height: 300px; width: 100%;" ></div>
					   </div>
					  </td> 
					</tr>  
		        </table>
		    </div> 
		    </td>
           </tr>

        <tr>
			<th >비고</th> <!-- 기타선택시 비고 입력값 필수 -->
			<td colspan= "7" style="text-align:left;">	
				<input type="text" id="reqRmk" name="reqRmk">	
			</td>
        </tr>
      </table>
    </form>
    
    
	</div>

	<!-- 공통 파일 영역-->
    <div id="fileList_area"></div>
	<!-- 공통 파일 영역 -->
	
</div>
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtn" authChk>등록</button>
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>

<script type="text/javascript">
	var actionType = null;
	var fileTrgtKey = null;
    var approvalList = null;
    var reqNo = null;
	
	var gridViewPop = {
		initView : function() {
  			this.target = new ax5.ui.grid();
  			this.target.setConfig({
  		    	showRowSelector: true,
  		    	multipleSelect: false,
  		    	sortable: false,
  		        target: $('[data-ax5grid="first-grid-modal"]'),
  		        header: {
  		        	align: "center",
  		        	selector: true
  		        },
  		        body: {
  		        	 onClick: function () {
  		                this.self.select(this.dindex);
  		            },
  		            onDBLClick: function () {
  		            },
  		        },
				page : {
					navigationItemCount : 10,
					height : 30,
					display : true,
					firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
					prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
					nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
					lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
					onChange : function() {
						gridView.setData(this.page.selectPage);
					}
				},
		    	columns : [
			    		{key: "gb",      			label: "구분",      	align: "center",   width: 40},
	                    {key: "wbsPlancoCdNm",      label: "회사명",      align: "center",   width: 130, hidden: true},
	                    {key: "wbsSharngUserId",	label: "ID",      	align: "center",   width: 130, hidden: true},
	                    {key: "empNo",      		label: "사원번호", 	align: "center",   width: 130, hidden: true},
	                    {key: "name",       		label: "성명",      	align: "center",   width: 80},
	                    {key: "jik",       			label: "직위",      	align: "center",   width: 60},
	                    {key: "reqDate",      		label: "요청일자", 	align: "center",   width: 90},
	                    {key: "todoCfDt",      		label: "확인일자",		align: "center",   width: 130},
	                    {key: "todoCfOpn",      	label: "확인의견", 	align: "left",     width: 200},
	                    {key: "telNo",      		label: "H.P",		align: "center",   width: 130},
    	              ]
					});
        			return this;
        		},

        		setData : function(_pageNo) {
        			var targetObj = this.target;
        			var formData = {
     	        			"fileTrgtKey" : fileTrgtKey,
     	        			"reqNo" : reqNo, 
     	        			"pageNo" : _pageNo + 1
     	    		}
        			
   					postAjax("/user/qm/qm01/selectShareUserlst", formData, null, function(data){	
   					var list = data.result;
   						targetObj.setData({
   	  						list : list,
	   	  					page : {
// // 	   	  							currentPage : _pageNo,
// // 				                    pageSize : data.paginationInfo.pageSize,
				                    	totalElements :  data.paginationInfo.totalRecordCount,
// // 				                    totalPages : data.paginationInfo.totalPageCount
						    } 
   	  					});
   	  				});
          		}
  	}
	debugger;
	//************************************************************************************
	/*radio button,  checkbox 공통코드에서 가져오기 start
	 *  아래의 코드가 HTML에 추가함 
	 *  <div id="COBGB-checkboxContainer"></div>
	 *  <div id="COBTP-radioButtonContainer"></div>	
	 */	
	//************************************************************************************
	
	function createRadioOptions(groupName) {
		var param = {
				"codeKind" : groupName
		};
		postAjaxSync("/admin/cm/cm05/selectChildCodeList", param , null,  function(data){
			const codeList = data.childCodeList;
			var container = $('#' + groupName + '-radioButtonContainer');
			codeList.forEach(item => {
				const iHtml = '<td><input type="radio" id="' + item.codeId + 
				                              '" name="' + item.codeKind + 
				                             '" value="' + item.codeId + 
				                        '" data-label="' + item.codeNm + 
				              '" onchange="fnc(this)"> ' + item.codeNm + ' </td>';
				container.append(iHtml);
			});
		})	
	}
	
	function createCheckBox(deptCode) {
		$('#COBGB-checkboxContainer').empty();
		var param = {
			"userDept" : deptCode
 		};
		postAjaxSync("/admin/cm/cm05/selectCheckboxList", param , null,  function(data){
			var codeList = data.childCodeList;
			var container = $('#COBGB-checkboxContainer');
			var lastKind = '';
			const table = $('<table>').appendTo('#COBGB-checkboxContainer')
			var tableRow = '';	
			$.each(codeList, function (index, item){
				if (lastKind != item.codeKind) {
					tableRow = $('<tr>').appendTo(table);
					var trElement = $('<tr>');
					$('<th>').attr('rowspan', item.rowCnt).css('width', '80').text(item.codeDesc).appendTo(tableRow);
					lastKind = item.codeKind;
				} else {
					tableRow = $('<tr>').appendTo(table);
					var trElement = $('<tr>');
				}
				const comboName= "CODECOBGB";
				const iHtml = 
				  '<input type="radio" id="' + item.codeId + 
									 '" name="' + comboName + 
									'" value="' + item.codeId + 
							   '" data-label="' + item.codeNm + 
				     '" onchange="fnc(this)" style="margin-left:20px"> ' + item.codeNm + '\n';

				const tdElement  = $('<td>').attr('style', 'text-align:left;height:20px;').text('').appendTo(tableRow);
				tdElement.append(iHtml);

			});
		})	
	}

	function fnc(thisButton) {
		const inputType = $(thisButton).attr('type');
		  
		if (inputType === 'radio') {
			console.log(thisButton.dataset.label + ' radio button. = ' + $("input[name='COBTP']:checked").val() + ' 선택');
		} else if (inputType === 'checkbox') {
			console.log(thisButton.dataset.label + ' checkbox. = ' + thisButton.value + '의 상태는 ' + thisButton.checked);
		}
		if (thisButton.id == 'COBTP99') {
			$("#COBGB9999").prop("checked", $("#COBTP99")[0].checked);  
		}
	}
/*************************************************************************************
 * radio button,  checkbox 공통코드에서 가져오기 end
 */
//*************************************************************************************	

	function checkCd(element,itemCd,val){
		if(itemCd == "REQCDCP") { $("#reqCd").val(val);  }
		if(itemCd == "BUSTCDCP"){ $("#bustCd").val(val); }
		if(itemCd == "INWKCDCP"){ $("#inwkCd").val(val); }
		if(itemCd == "COBTPCP") { $("#partCd").val(val); }
	}	
	
	$(document).ready(function() {
		actionType = modalStack.last().paramObj.actionType;
		fileTrgtKey = modalStack.last().paramObj.fileTrgtKey;
		reqNo = modalStack.last().paramObj.reqNo;
		$("#fileTrgtKey").val(fileTrgtKey);
		
		setCommonSelect($(".popup_area select[data-kind]"));
		setCommonDiv($(".popup_area div[data-kind]"));
		setCommonItem($(".popup_area table[data-kind]"));
		//setCommonCheck($(".popup_area th[data-kind]"));
		setByCoCd(modalStack.last().paramObj.coCd);
		$("#popForm #userId").val(jwt.userId);
		$("#userEmpNo").val(jwt.empNo);
		$("#userDeptId").val(jwt.deptId); 
		var userDeptId = jwt.deptId;
		var userDept = userDeptId.substr(0, 5);
		$("#userDept").val(userDept);
		
		createRadioOptions('COBTP');  //분류 자동 생성
		createCheckBox(userDept);	//부서별 장애원인 자동 생성
		
		$("#coCd").prop("disabled", true);
		
		selectAuth(jwt.deptId);
		
       	//발행일자//
		$('#ordrgDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		}).datepicker("setDate", new Date());
		
		//요구일정//
		$('#reqDt').datepicker({
			format : "yyyy-mm-dd",
			language : "ko",
			autoclose : true
		}).datepicker("setDate", new Date());

		authChk();						// 권한체크
		
		gridViewPop.initView(); 
		
		var paramObj = {"coCd" : $('#coCd').val(), "userId" : jwt.userId};
        postAjaxSync("/user/qm/qm01/selectApprovalList", paramObj, null, function(data) {
        	approvalList = data.resultList;
        });
        
		if (actionType == "C") {
			
			$("#ordrgId").val(modalStack.last().paramObj.userId);
			$("#ordrgNm").val(modalStack.last().paramObj.userName);
			$("#regId").val(modalStack.last().paramObj.userId);
			$("#regNm").val(modalStack.last().paramObj.userName);
			$("#creatId").val(modalStack.last().paramObj.userId);
			
			 
			$("#actionBtn").text("등록");
			$('#actionBtn').on("click", function() {
				insertQualityReq();
			});

		} else if (actionType == "U") {
			$('.tit').text('요인별 발주 및 출장요청 수정');

			selectQtyReqInfo();
			
			$('#popForm input#coCd').attr('required', 'required');
			$('#coCd').css({'background-color':'#e6e6e6', 'pointer-events':'none'});

			$("#ordrgDt").prop("disabled", true);
			$("#REQCD1").prop("disabled", true); //reqCd
			$("#REQCD2").prop("disabled", true); 
			$("#reqDt").prop("disabled", true);
			$("#newCd").prop("disabled", true);
			$("#creatId").val(modalStack.last().paramObj.userId);			
			gridViewPop.initView().setData(0);
			
			$('#actionBtn').text("수정");
			$('#actionBtn').on("click", function() {
				updateQualityReq();
			});
		}
		 // TODO 리스트에서 호출 시 공유 : actionType:T  결재: actionType:S 처리 부분 
        else if (actionType == "T"){
        	$('.tit').text('발주 및 출장요청서 공유')
        	shareBtn.style.display = "none";
        	actionBtn.style.display = "none";
        	selectQtyReqInfo();
        	gridViewPop.setData();

        }
		//---------------------------------------------------------------  
		//첨부 화일 처리 시작 
		//---------------------------------------------------------------  
		fileParam = {
				fileTrgtTyp	: $("#pgmId").val(),
				fileTrgtKey		:fileTrgtKey
		}
  		treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
		//---------------------------------------------------------------  
		//첨부 화일 처리 끝
		//---------------------------------------------------------------  
        
		if (approvalList.length == 0) {
			alert("결재선 지정 정보가 존재하지 않습니다. 기준관리에서 결재선을 추가 하세요");
		}
	});
	
	
	// 공유대상자 추가//  
    function insertShareUserModal() {    
        var paramObj = {};
        paramObj["coCd"] = $('#coCd').val();
        paramObj["useYn"] =  "Y";
        paramObj["userId"] =  $('#ordrgId').val();
        paramObj["userNm"] =  $('#ordrgNm').val();
        paramObj["approvalGrid"] = [
            {
                "id": "danhergy",
                "text": "김상화",
                "parent": "기 장",
                "deptNm": "국내영업",
                "telNo": "010-3332-5301",
                "offTelNo": "051-660-9172",
                "email": "danhergy@gunyangitt.co.kr",
            },
            {
                "id": "kbh",
                "text": "김배현",
                "parent": "반 장",
                "deptNm": "국내영업",
                "telNo": "010-4767-3600",
                "offTelNo": "051-660-9113",
                "email": "kbh@gunyangitt.co.kr",
            }
        ];
        paramObj["shareGrid"] =  [
            {
                "id": "danhergy",
                "text": "김상화",
                "parent": "기 장",
                "deptNm": "국내영업",
                "telNo": "010-3332-5301",
                "offTelNo": "051-660-9172",
                "email": "danhergy@gunyangitt.co.kr",
            },
            {
                "id": "kbh",
                "text": "김배현",
                "parent": "반 장",
                "deptNm": "국내영업",
                "telNo": "010-4767-3600",
                "offTelNo": "051-660-9113",
                "email": "kbh@gunyangitt.co.kr",
            }
        ];
        
        openSecondModal("/static/html/cmn/modal/userLstSearch.html", 900, 500, "작성자 검색", paramObj, function (approvalGrid, shareGrid){
    		console.log('결재라인 : ', approvalGrid.target.list);
    		console.log('공유라인 : ', shareGrid.target.list);
    		
//     		approvalGrid.id //userId
//     		approvalGrid.text //성명
//     		approvalGrid.levelNm //직책
//     		approvalGrid.deptNm //부서
//     		approvalGrid.telNo
//     		approvalGrid.offTelNo
//     		approvalGrid.email
    		
//     		shareGrid.id //userId
//     		shareGrid.text //성명
//     		shareGrid.levelNm //직책
//     		shareGrid.deptNm //부서
//     		shareGrid.telNo
//     		shareGrid.offTelNo
//     		shareGrid.email

			gridViewPop.target.setValue(row, "empNo", data.resultList[0].empNo);
			gridViewPop.target.setValue(row, "name", data.resultList[0].usrNm);
			gridViewPop.target.setValue(row, "telNo", data.resultList[0].telNo);
			gridViewPop.target.setValue(row, "levelNm", data.resultList[0].levelNm);
			gridViewPop.target.setValue(row, "email", data.resultList[0].email);
			gridViewPop.target.setValue(row, "dtNm", data.resultList[0].dtNm);
        });
		
		
// 		var paramObj = {"coCd" : $('#coCd').val()	};	
//     	openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,
//     			"사용자 검색", paramObj, function(tree) {
//     				var checkedId = tree.get_checked()[0];
//     				var checkedNode = tree.get_node(checkedId); 
//     				var paramObj = {"coCd" : $(".popup_area #coCd").val(), "userId" : checkedId};

//                     postAjax("/user/qm/qm01/selectShareUserInfo", paramObj, null, function(data) {
//     						gridViewPop.target.addRow($.extend({}, "last", false));                             
//     						var row = gridViewPop.target.getList().length -1 ;
// 							debugger;
//     						gridViewPop.target.setValue(row, "rnum", "");
//     						gridViewPop.target.setValue(row, "wbsPlancoCd", data.resultList[0].coCd);
//     						gridViewPop.target.setValue(row, "wbsPlancoCdNm", data.resultList[0].coNm);
//     						gridViewPop.target.setValue(row, "empNo", data.resultList[0].empNo);
//     						gridViewPop.target.setValue(row, "name", data.resultList[0].usrNm);
//     						gridViewPop.target.setValue(row, "telNo", data.resultList[0].telNo);
//     						gridViewPop.target.setValue(row, "levelNm", data.resultList[0].levelNm);
//     						gridViewPop.target.setValue(row, "email", data.resultList[0].email);
//     						gridViewPop.target.setValue(row, "dtNm", data.resultList[0].dtNm);
//     				});     
//     			});
    }   
	
    function deleteShareUser(){
    	
    	var selRow = parseInt(gridViewPop.target.selectedDataIndexs);    
 		if( isNaN(selRow) ) {
 			alert("선택된 행이 없습니다.");
 			return;
 		} else {			
 				if( selRow > -1 ) {
 					gridViewPop.target.removeRow(selRow); 					
 				}
 		}
    }
	
	
	 // 발행자 검색 //  
    function openFirstUserSearch() {
		 if (actionType == "C"){
		    	var paramObj = {
		    		  "coCd" : $('#coCd').val(),
		    		"userId" : $('#ordrgNm').val(),
		    	};
		    	openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,
		    			"사용자 검색", paramObj, function(tree) {
		    				var checkedId = tree.get_checked()[0];
		    				var checkedNode = tree.get_node(checkedId);
		    				$('#ordrgId').val(checkedNode.id);
		    				$('#ordrgNm').val(checkedNode.text);
		    				$('#userDept').val(checkedNode.parent.slice(0,5));
		    				createCheckBox($('#userDept').val())
		    				selectAuth(checkedNode.original.parent);
		    				  //gridView.setData(0);
		    			});
		 }
    }   
	 
	 // 접수자 검색 //  
    function openSecondUserSearch() {
		 if (actionType =="C"){
	    	var paramObj = {
	    		  "coCd" : $('#coCd').val(),
	    		"userId" : $('#regNm').val(),
	    	};
	    	openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,
	    			"사용자 검색", paramObj, function(tree) {
	    				var checkedId = tree.get_checked()[0];
	    				var checkedNode = tree.get_node(checkedId);    				
	    				$('#regId').val(checkedNode.id);
	    				$('#regNm').val(checkedNode.text);
	    				 gridView.setData(0);
	    			});
		 }
    }  	
    
    
	function selectQtyReqInfo() {						//그리드에 뿌리는 데이터
		var formData = {
			"fileTrgtKey" : fileTrgtKey,
		}
		postAjax("/user/qm/qm01/selectQtyReqInfo", formData, null, function(data) {
				$.each(data.result, function(key, value) {
					if ($('#popForm #' + key)[0]) {
						$('#popForm #' + key).val(value);	
						
						if ($('#popForm #' + key).is('[comma]')) {
							onlyNumber($('#popForm #' + key)[0]);
						}
					}
				});
				
		});
	}

	
	 // 등록
	function insertQualityReq() {
		
		if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사			
			if($("#ordrgId").val() == ""){	
				alert("발행자 아이디를 선택해주세요");			
			}else if($("#regId").val() == ""){	
				alert("접수자 아이디를 선택해주세요");
			}else if($("#salesCd").val() == ""){	
				alert("세일즈코드를 선택해주세요");					
			}else if($("#deptCd").val() == "COBGB9" && $("#reqRmk").val() == ""){ //비고
		        alert("기타사항 비고를 입력해주세요"); 
			}else{	
				var formData = makeFormData();										// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
				filePostAjax("/user/qm/qm01/insertQualityReq", formData,				// 파일을 포함한 데이터를 서버로 전송하는 비동기적인 AJAX 요청을 수행
						function(data) {
							alert(data.resultMessage);								// 결과 메시지를 alert으로 출력
							if (data.resultCode == 200) {							//  요청이 성공(200)한 경우, gridView.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
								gridView.setData(0);
								modalStack.close();									// 모달을 닫음
							}
						});
			}
		}
	}
	
	// 수정
	function updateQualityReq(){	
		
		 if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사

			var formData = makeFormData();										// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
	      	filePostAjax("/user/qm/qm01/updateQualityReq", formData,function(data) {
						alert(data.resultMessage);
						if (data.resultCode == 200) {
							gridView.setData(0);
							modalStack.close();
						}
					});
			}
	}

	//----------------------------------------------//

	function makeFormData() {		
		// 금액 콤마 제거
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		// 폼데이터 생성
		var formData = new FormData($("#popForm")[0]);
		formData.append("coCd", $('#coCd').val());
        //---------------------------------------------------------------
		//-------itemarr  --첨부화일 처리를 위한 부분 시작
		//---------------------------------------------------------------
		formData.append("ordrsNo", $("#ordrsNo").val());
		formData.append("userId" , jwt.userId);
		formData.append("clntCd" , $('#clntCd').val());			//첨부화일용
		formData.append("prdtCd" , $('#prdtCd').val(""));			//첨부화일용
		formData.append("itemCd" , $('#itemDiv').val(""));			//첨부화일용
		formData.append("prjctCd", $('#clntPjt').val());		//첨부화일용
		formData.append("comonCd", treeModule.getFileNodeId());	//첨부화일용
		
		//---------------------------------------------------------------  
        
        //---------------------------------------------------------------  
		var fileUploadArr = [];
		var tempArr = [];
		
		tempArr = treeModule.getFileArr();
		$.each(tempArr, function(idx, obj) {
			if (obj.fileKey == 0) {
                formData.append("files", obj.file);
                obj.file = '';
                fileUploadArr.push(obj);
			}
		});

		formData.append("uploadFileArr", JSON.stringify(fileUploadArr));
		formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
		
		
		//---------------------------------------------------------------  
		//--첨부화일 처리를 위한 부분 끝
		//--------------------------------------------------------------- 

       // 공유대상자 리스트  TODO LIST에 등록하기 위한 모듈 추가 (박성준 : 2023.08.03) 
      // 공유 : TODODIV10, TODODIV1040  결재 :TODODIV20, TODODIV2020
       var rowSharngList = gridViewPop.target.list;
       var ParamObj = modalStack.last().paramObj.ParamObj;

       if(rowSharngList.length > 0) {
           var rowSharngListArr = [];
           $.each(rowSharngList, function(idx, elem){
               var rowSharngListObj = elem;
               rowSharngListObj["coCd"] = $('#coCd').val();
               rowSharngListObj["salesCd"] = $('#salesCd').val();
               rowSharngListObj["todoDiv1CodeId"] = "TODODIV10";
               rowSharngListObj["todoDiv2CodeId"] = "TODODIV1040";
               rowSharngListObj["todoId"] = elem.id;
               rowSharngListObj["todoCoCd"] = elem.coCd;
               rowSharngListObj["empNo"] = elem.empNo;
               rowSharngListObj["name"] = elem.usrNm;
               rowSharngListObj["telNo"] = elem.telNo;
               rowSharngListObj["email"] = elem.eMail;    
               rowSharngListObj["pgPath"] = "/user/qm/qm01/QM0101P01.html";
               //rowSharngListObj["pgParam"] = ParamObj;
              
               rowSharngListArr.push(rowSharngListObj);
           });
           formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));           
       }
       formData.append("S_todoDiv1CodeId", "TODODIV10");
       formData.append("S_todoDiv2CodeId", "TODODIV1040");

	   return formData;
	}
	
	function opendOrdrsSearch() {
    	var paramObj = {
    			"searchValue" : $('#ordrsNo').val(),
    			"coCd" : $('#coCd').val()
    		};
    	
    	openSecondModal("/static/html/cmn/modal/ordrsSearch.html", 800, 420, "수주번호 검색", paramObj, function (grid) {
            var row = grid.target.getList("selected")[0];
            $('#ordrsNo').val(row.ordrsNo);
        });
    }
	
    //Sales Code (수주마스터, 수주상세테이블 조인) 검색
    function wbsSalesCodeSearch() {
    	if (actionType == "C"){
	        var paramObj = {
	           "coCd" : $('#coCd').val(),
	           "salesCd": $('#salesCd').val()
	        };
	        openSecondModal("/static/html/cmn/modal/SalesCodeTreeSearch.html", 1000, 500, "SALES CODE 검색", paramObj, function (grid){
	            var row = grid.target.getList("selected")[0];
	
	             $('#salesCd').val(row.salesCd);
	             $('#matrDrwNo').val(row.salesCd);
	             $('#clntPjt').val(row.clntPjt);
	             $('#clntCd').val(row.ordrsClntCd);
	             $('#clntNm').val(row.ordrsClntNm);
	             $('#newCd').val(row.ordrsDtlDiv20Nm);
	             $('#ordrsdtldiv20').val(row.ordrsDtlDiv20);
	             $('#ordrsNo').val(row.ordrsNo);
	             $('#prdtCd').val(row.prdtCd);
	             $('#itemDiv').val(row.itemDiv);
	             $('#projNm').val(row.ctrtNm);
	        });
    	}
    }
    		
	
	// 고객사 검색
	function clntSearch() {
		openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420,
				"고객사 검색", {}, function(grid) {
					var row = grid.target.getList("selected")[0];
					$('#clntCd').val(row.clntCd);
					$('#clntNm').val(row.clntNm);
				});
	}
	
	// 자재 품번 팝업 호출하는 함수
    function openMatListSearch(openType) {
          //debugger;
          var paramObj = {
      			"searchValue" : $("#matrNm").val()
          }
          openSecondModal("/static/html/cmn/modal/matListSearch.html", 600, 420, "자재 품번 검색", paramObj, function(grid) {
                        var row = grid.target.getList("selected")[0];
                        if (openType == "P") {
							$('#matrCd').val(row.matrCd);		// 	품번 값 가져오기
							$('#matrNm').val(row.matrNm);	//	품번 값 가져오기
                        } 
                 });
    }
		
	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();
	}
	
	//공유대상자 팝업
	   function opendModalSharngListList() { 
// 		   //debugger;
// 	       var formData = {};
// 	       openSecondModal("/static/html/user/wb/wb02/WB0202P01.html", 1300, 780, "결재선 지정", formData, function (grid){
// 	               var rowList = grid.target.getList("selected");
// 	               if (rowList.length > 0) {
// 	                   var chk = false;
// 	                   $.each(rowList, function(idx, elem){ 
// 	                       if (elem.check == "Y") { 
// 	                           var userId = elem.appId;
// 	                           var rowList1 = gridViewPop.target.getList();
// 	                           $.each(rowList1, function(idx, elem){
// 	                                if (elem.wbsSharngUserId == userId) {
// 	                                   chk = true;
// 	                               }
// 	                           });
// 	                       }
// 	                   });
// 	                   if (chk == false) {
// 	                       $.each(rowList, function(idx, elem){
// 	                           if (elem.check == "Y") {
// 	                                   var paramObj = {"coCd" : elem.coCd, "userId" : elem.appId};            
// 	                                   postAjax("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
	                                	   
// 	                                	   		gridViewPop.target.addRow($.extend({}, "last", false));
// 	                                           var row = gridViewPop.target.getList().length - 1;
// 	                                           gridViewPop.target.setValue(row, "salesCd", $("#salesCd").val());
// 	                                           gridViewPop.target.setValue(row, "wbsPlancoCd", data.resultList[0].coCd);
// 	                                           gridViewPop.target.setValue(row, "wbsPlancoCdNm", data.resultList[0].coCdNm);
// 	                                           gridViewPop.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
// 	                                           gridViewPop.target.setValue(row, "empNo", data.resultList[0].empNo);
// 	                                           gridViewPop.target.setValue(row, "name", data.resultList[0].name);
// 	                                           gridViewPop.target.setValue(row, "telNo", data.resultList[0].telNo);
// 	                                           gridViewPop.target.setValue(row, "email", data.resultList[0].email);                                        
// 	                                   });
// 	                             }
// 	                       });
// 	                  }
// 	                  else {
// 	                      alert("중복 공유를 지정할 수 없습니다.");
// 	                      return;
// 	                  }
// 	               }
	               
// 	       });
	   }
	
	
	function selectAuth(value){
		var userDeptId = value;
		var userDept = userDeptId.substr(0, 5);
	}

</script>