<style>
* input[comma] {
  text-align: right;
 }
/* 인풋 테이블 2분할 */
.table_input.type08 tr td:nth-of-type(1) {
    width: 39%;
}

.table_input.type08 tr td:nth-of-type(2) {
    width: 59%;
}
.title_m_td {text-align:left; height:25px; background:#fff; font-weight:bold; color:blue; padding:5px;
}

/* 크기 조절되지 않아 임시로 */
.date_input .input_calendar2 {
    background-color: #fff;
    width: calc(100%) !important;
}

.input_calendar2 {
    background-color: #fff;
    width: 100% !important;
    background: url("../../../../img/svg/calendar-alt-regular.svg") no-repeat 95% 50%;
    background-size: 13px 13px;
    cursor: pointer
}

* input[comma] {
  text-align: right;
 }
</style>

<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">발주 및 출장요청서 결과 상세</h4>
    </div>

  <form id="popForm" onSubmit="return false;">
    <div class="form-group popup_table">
		<input type="hidden" id="fileTrgtKey"  	name="fileTrgtKey">
		<input type="hidden" id="pgmId"     	name="pgmId"	value="QM0101M01">
 	<table>
        <colgroup>
          <col width="10%">
          <col width="15%">
          <col width="10%">
          <col width="16%">
          <col width="10%">
          <col width="14%">
          <col width="10%">
          <col width="15%">
        </colgroup>
        <tr>
          <th colspan="8" height="30" style="margin-left:0px;text-align:left;">요인별 발주 및 출장요청서</th>
        </tr>
        <tr>
			<th>회사</th>
			<td>
				<select id="coCd" name="coCd" data-kind="CO" class="form-control input-sm" >
				</select>
			</td>
			<th>접수자</th>
			<td>
			     <div class="search_form">						
			    	<input type="hidden" id="regId" name="regId">
             		<input type="text"	id="regNm" data-search="regNm" readonly="readonly">
             		
                 </div>
			</td>
			<th>출장자</th>
			<td style="text-align:left;">
				<div id="BUSTCD-radioButtonContainer"></div>
			</td>
			<th >관리번호</th>
			<td>
				 <div class="search_form">
				  <input type="text" id="reqNo" name="reqNo" readonly="readonly" >
				 </div>
			</td>
        </tr>
		 <tr>
			<th>발행일자</th>
			<td>
				<input type="text" id="ordrgDt" name="ordrgDt" readonly="readonly">
			</td>
			<th>요구일정</th>
			<td>
				<input type="text" id="reqDt" name="reqDt" readonly="readonly" >
			</td>
			<th>출장자명</th>
			<td>
			     <input type="text" id="bustNm" name="bustNm" readonly="readonly" >
			</td>
			<th>수주번호</th>
			<td>
                <input type="text" id="ordrsNo" name="ordrsNo" readonly="readonly">
			</td>
        </tr>
        <tr>		
			<th>발행자</th>
			<td>
                 <div class="search_form">						
			    	<input type="hidden" id="ordrgId" name="ordrgId"  data-search="ordrgId">
             		<input type="text"	id="ordrgNm" data-search="ordrgNm" readonly="readonly">
                 </div>
			</td>
			<th>요청구분</th>
			<td style="text-align:left;">
			  <div id="REQCD-radioButtonContainer"></div>
			</td>
			<th>출장장소(고객사)</th>
			<td>
			     <input type="text" id="bustPe" name="bustPe" readonly="readonly">
			</td>
			<th>대표도면번호</th>
			<td>
				<input type="text" id="matrDrwNo" name="matrDrwNo" readonly="readonly" >
			</td>
        </tr>
        <tr>
		   <th>SalesCode</th>
				<td>
					<div class="search_form">
					    <input type="text" id="salesCd" name="salesCd" readonly="readonly" >
				    </div>
				</td>
			<th>사내작업</th>
			<td style="text-align:left;">
			    <div id="INWKCD-radioButtonContainer"></div> 
			</td>
			<th>고객사</th>
			<td>
			    <input type="hidden" id="clntCd" name="clntCd" >				
				<input type="text" id="clntNm" name="clntNm" readonly="readonly">
			</td>
			<th>Project명</th>
			<td>
			    <input type="text" id="projNm" name="projNm" readonly="readonly">
			</td>
        </tr>
        <tr>
			<th>분류</th>
			<td>	
				<input type="text" id="partCdNm" name="partCdNm" readonly="readonly">
			</td>
			<th>등록 사유</th>
			<td>	
				<input type="text" id="subCdNm" name="subCdNm" readonly="readonly">
				<input type="hidden" id="subCd" name="subCd">
			</td>
			<th>고객사PJT</th>
            <td>
                <div class="search_form">
                    <select id="clntPjt" name="clntPjt" data-kind="PRJCTCD"></select>
                </div>
            </td>
			<th>신작구분</th>
			<td>
			   <input type="hidden" id="ordrsdtldiv20" name="ordrsdtldiv20">
			   <input type="text" id="newCd" name="newCd" readonly="readonly" >
			</td>
        </tr>
        <tr>
          <th colspan="8" height="30" style="margin-left:0px;text-align:left;">요인별 결과 등록</th>
        </tr>
        <tr>
			<th>실적번호</th>
               <td>
      	 		<input type="hidden" id="resReqNo" name="resReqNo" >
        		<input type="text" id="rsltNo" name="rsltNo" readonly="readonly">
	           </td>
	       <th>등록일자</th>
	         <td>
	           	<input id="resDt" name="resDt" class="input_calendar form-control">
	         </td>
	       <th>결과 등록자</th>
		     <td>
	           	<div class="search_form">						
				   <input type="hidden" id="resRegId" name="resRegId" >
	               <input type="text"	id="resRegNm" data-search="resRegNm" msg="등록자" required>
	               
	            </div>
		     </td>
		   <th colspan="2"></th>
	    </tr>
	    <tr>
	      <th >결과사유</th>
			<td colspan= "3" style="text-align:left; vertical-align:top;">	
				<div id="COBGB-checkboxContainer"></div>		   
			</td>
		    <td colspan="4">
			  <div>
				<table>
				    <th >비고</th> 
					  <td colspan="3">	
						 <textarea  class="form-control" id="rsltRmk" name="rsltRmk" rows="5" style="width:570px; border: none;" maxlength="1000"></textarea>		
					  </td>
				   <tr>
				    <th >조치</th> 
				      <td colspan="3">	
					    <textarea  class="form-control" id="measRst" name="measRst" rows="5" style="width:570px; border: none;" maxlength="1000"></textarea>
				      </td>  
				  </tr>
				  <tr>
				   <th >결과</th> 
				     <td colspan="3">	
					   <textarea  class="form-control" id="resltRst" name="resltRst" rows="5" style="width:570px; border: none;" maxlength="1000"></textarea>	
				     </td> 
				  </tr> 
				  <tr>
				   <th >고찰</th> 
				     <td colspan="3">
				        <textarea  class="form-control" id="thghRst" name="thghRst" rows="5" style="width:570px; border: none;" maxlength="1000"></textarea>	
				     </td>
				  </tr>
				</table>
			 </div>
		  </td>
	    </tr>
      </table>
    </form>
  </div>

	<!-- 공통 파일 영역-->
    <div id="fileList_area"></div>
	<!-- 공통 파일 영역 -->

    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>

<script type="text/javascript">
	var actionType = null;
	var fileTrgtKey = null;
    var approvalList = null;
    var reqNo = null;

	//************************************************************************************
	/*radio button,  checkbox 공통코드에서 가져오기 start
	 *  아래의 코드가 HTML에 추가함 
	 *  <div id="COBGB-checkboxContainer"></div>
	 *  <div id="COBTP-radioButtonContainer"></div>	
	 */	
	//************************************************************************************
	
	function createRadioOptions(groupName, _type) {
		var param = {
				"codeKind" : groupName
		};
		postAjaxSync("/admin/cm/cm05/selectChildCodeList", param , null,  function(data){
			const codeList = data.childCodeList;
			var container = $('#' + groupName + '-radioButtonContainer');
			var typeStr = _type =="radio" ? "radio" : "checkbox";
			codeList.forEach(item => {
				const iHtml = '<td><input type="' + typeStr  + '" id="' + item.codeId + 
				                              '" name="' + item.codeKind + 
				                             '" value="' + item.codeId + 
				                        '" data-label="' + item.codeNm + 
				              '" onchange="fnc(this)"> ' + item.codeNm + ' </td>';
				container.append(iHtml);
			});
		})	
	}
	
	function createCheckBox(deptCode) {
		$('#COBGB-checkboxContainer').empty();
		var param = {
			"userDept" : deptCode
 		};

		postAjaxSync("/admin/cm/cm05/selectCheckboxList", param , null,  function(data){
			var codeList = data.childCodeList;
			var container = $('#COBGB-checkboxContainer');
			var lastKind = '';
			const table = $('<table>').appendTo('#COBGB-checkboxContainer')
			var tableRow = '';	
			$.each(codeList, function (index, item){
				if (lastKind != item.codeKind) {
					tableRow = $('<tr>').appendTo(table);
					var trElement = $('<tr>');
					$('<th>').attr('rowspan', item.rowCnt).css('width', '90').text(item.codeDesc).appendTo(tableRow);
					lastKind = item.codeKind;
				} else {
					tableRow = $('<tr>').appendTo(table);
					var trElement = $('<tr>');
				}
				const comboName= "CODECOBGB";
				const iHtml = 
				  '<input type="radio" id="' + item.codeId + 
									 '" name="' + comboName + 
									'" value="' + item.codeId + 
							   '" data-label="' + item.codeNm + 
				     '" onchange="fnc(this)" style="margin-left:20px"> ' + item.codeNm + '\n';

				const tdElement  = $('<td>').attr('style', 'text-align:left;height:20px;').text('').appendTo(tableRow);
				tdElement.append(iHtml);

			});
		})	
		//gridViewPop.initView();
		const grdiHeight = $('#COBGB-checkboxContainer').height()-35;
		//gridViewPop.target.setHeight(grdiHeight< 162 ? 162 : grdiHeight);
	}

	function fnc(thisButton) {
		const inputType = $(thisButton).attr('type');
		  
		if (inputType === 'radio') {
			console.log(thisButton.dataset.label + ' radio button. = ' + $("input[name='COBTP']:checked").val() + ' 선택');
		} else if (inputType === 'checkbox') {
			console.log(thisButton.dataset.label + ' checkbox. = ' + thisButton.value + '의 상태는 ' + thisButton.checked);
		}
		if (thisButton.id == 'COBTP99') {
			$("#COBGB9999").prop("checked", $("#COBTP99")[0].checked);  
		}
	}
/*************************************************************************************
 * radio button,  checkbox 공통코드에서 가져오기 end
 */
//*************************************************************************************	
	
	$(document).ready(function() {
		actionType = modalStack.last().paramObj.actionType;
		fileTrgtKey = modalStack.last().paramObj.fileTrgtKey;
		reqNo = modalStack.last().paramObj.rsltNo;

		$("#fileTrgtKey").val(fileTrgtKey);
		setCommonSelect($(".popup_area select[data-kind]"));
		setByCoCd(modalStack.last().paramObj.coCd);

		var userDeptId = jwt.deptId;
		var userDept = userDeptId.substr(0, 5);

		selectAuth(userDeptId);
		//$(".i_search_w").hide();
		
		createRadioOptions('COBTP', "radio");  //분류 자동 생성
		createRadioOptions('BUSTCD', "checkbox");  //출장자 구분
		createRadioOptions('INWKCD', "checkbox");  //사내작업 구분
		createRadioOptions('REQCD', "radio");  //요청구분 구분
		createCheckBox(userDept);	//부서별 장애원인 자동 생성

		authChk();						// 권한체크
// 		gridViewPop.initView(); 
        
        selectQtyReqInfo();
        selectQtyReqRespInfo();
      //input readonly, radio.checkbox disabled
		$.each($('#popForm select, input, textarea'), function(idx, elem){
			var id = $(elem).attr("ID");
			if( id ) {
				var eleId = "#popForm #"+id;
				if( $(elem).prop('tagName') == "INPUT" ) $(eleId).attr("readonly", true);
				if( $(elem).prop('tagName') == "TEXTAREA" ) $(eleId).attr("readonly", true);
				if( $(elem).prop('tagName') == "SELECT" ) $(eleId).css({'background-color':'#e6e6e6', 'pointer-events':'none'});
				if( $(elem).prop('type') == "checkbox" || $(elem).prop('type') == "radio") $(eleId).prop("disabled", true);
			} 
			
		});		

		//---------------------------------------------------------------  
		//첨부 화일 처리 시작 
		//---------------------------------------------------------------  
		fileParam = {
				fileTrgtTyp	: $("#pgmId").val(),
				fileTrgtKey		:fileTrgtKey
		}
  		treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
		//---------------------------------------------------------------  
		//첨부 화일 처리 끝
		//---------------------------------------------------------------  
        
	});
    
	function selectQtyReqInfo() {						//그리드에 뿌리는 데이터
		var formData = {
			"fileTrgtKey" : fileTrgtKey,
		}
		postAjax("/user/qm/qm01/selectQtyReqInfo", formData, null, function(data) {
			createCheckBox(data.result.deptCd);
				$.each(data.result, function(key, value) {
					if ($('#popForm #' + key)[0]) {
						$('#popForm #' + key).val(value);	
						
					}
					if (key == 'reqCd'){//요청구분 뿌려주기
						$('#'+value).prop("checked", true);
					}
					if (key == 'partCd'){//분류체크하기
						$('#'+value).prop("checked", true);
					}
					if (key == 'subCd'){//등록사유체크하기
						$('#'+value).prop("checked", true);
					}
					if (key == 'bustCd01'){//출장자체크
						$('#'+value).prop("checked", true);
					}
					if (key == 'bustCd02'){//출장자체크
						$('#'+value).prop("checked", true);
					}
					if (key == 'inwkCd01'){//사내작업체크하기
						$('#'+value).prop("checked", true);
					}
					if (key == 'inwkCd02'){//사내작업체크하기
						$('#'+value).prop("checked", true);
					}
				});	
		});
	}
	
	function selectQtyReqRespInfo() {						//그리드에 뿌리는 데이터
		var formData = {
			"rsltNo" : reqNo,
		}

		postAjax("/user/qm/qm01/selectQtyReqRespInfo", formData, null, function(data) {
				$.each(data.result, function(key, value) {
					if ($('#popForm #' + key)[0]) {
						$('#popForm #' + key).val(value);	
						  if(key == "subCd" ){
							  $('#'+value).prop("checked", true);
						  }
					}
					if (key == 'todoYn'){
						if(value == 'Y'){
							$("#approval_trgt").show();
							$("#approvalReqBtn").hide();
							$("#approvalReqBtn").removeAttr("onclick");
							}
					}
				});
				
		});

	}
	
	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();
	}
	
	function selectAuth(value){
		var userDeptId = value;
		var userDept = userDeptId.substr(0, 5);
	}

</script>