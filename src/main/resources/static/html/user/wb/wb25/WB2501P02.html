<div id="wbsPopup" class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
        <h4 class="tit">WBS 과제 평가 보기</h4>
    </div>
    <div class="popup_table">
        <div class="form-group">            
            <form id="popForm_S">
                 <input type="hidden" id="actionType"   name="actionType">
                 <input type="hidden" id="coCd"   name="coCd">
                 <input type="hidden" id="userId" name="userId">
                 <input type="hidden" id="pgmId"  name="pgmId" value="WB2501P01">
                 <input type="hidden" id="fileTrgtKey" name="fileTrgtKey">
                 <input type="hidden" id="salesCd" name="salesCd">
                 
                 <table class="popup_table">
                     <colgroup>
                          <col width="8%">
                          <col width="8%">
                          <col width="8%">
                          <col width="8%">
                          <col width="8%">
                          <col width="8%">
                          <col width="8%">
                          <col width="9%">
                          <col width="8%">
                          <col width="9%">
                          <col width="8%">                          
                     </colgroup>
                          <tr>
                           <th>▣ 수주정보</th>
                           <th style="text-align:center;">고객명</th>
                           <td colspan="3"><input type="text" id="clntNm" name="clntNm" readonly style="text-align:center;font-weight:bold;color:#000000;"></td>
                           <th style="text-align:center;">고객사프로젝트명</th>
                           <td><input type="text" id="clntPjtNm" name="clntPjtNm" readonly style="text-align:center;font-weight:bold;color:#000000;"></td>
                           <th style="text-align:center;">수주번호</th>
                           <td><input type="text" id="ordrsNo" name="ordrsNo" readonly style="text-align:center;font-weight:bold;color:#000000;"></td>   
                           <th style="text-align:center;">SALES CODE</th>
                           <td><input type="text" id="salesCd" name="salesCd" readonly style="text-align:center;font-weight:bold;color:#000000;"></td>
                                                               
                         </tr>
                         <tr>
                           <th>▣ 원가정보</th>
                           <th style="text-align:center;">견적원가</th>
                           <td><input type="text" id="estPrc" name="estPrc" comma readonly style="text-align:right;font-weight:bold;color:blue;"></td>
                           <th style="text-align:center;">목표원가</th>
                           <td><input type="text" id="trgtPrc" name="trgtPrc" comma readonly style="text-align:right;font-weight:bold;color:blue;"></td>
                           <th style="text-align:center;">실행원가</th>
                           <td><input type="text" id="actPrc" name="actPrc" comma readonly style="text-align:right;font-weight:bold;color:blue;"></td>
                           <th style="text-align:center;">견적대비 목표율 (%)</th>
                           <td><input type="text" id="trgtRate" name="trgtRate" comma readonly style="text-align:right;font-weight:bold;color:blue;"></td>
                           <th style="text-align:center;">목표대비 실적율 (%)</th>
                           <td><input type="text" id="actRate" name="actRate" comma readonly style="text-align:right;font-weight:bold;color:blue;"></td>                                       
                         </tr>
                        <tbody>
                        <tr>
                            <td colspan="11" style="height:30px;text-align: left;">&nbsp;&nbsp;&nbsp;&nbsp;▣ 계획 & 실적</td>                                                
                        </tr>
                        </tbody>
                      <tr>
                        <td colspan="11" style="text-align: left;">
                        <div class="ax5_grid" data-ax5grid="grid-modal" data-ax5grid-config="{}" style="height: 475px; width: 100%;" ></div>
                        </td>                                                
                      </tr>
                      <tr style="text-align: left;">
                      <th>평가의견 <br> (2000자)</th>                         
                      <td colspan="10"> 
                         <textarea id="evlCnts" name="evlCnts" cols="245" rows="5"   style="border-width:0px;border-color:red;" > </textarea>                        
                      </td>
                      </tr>   
                 </table>  
                 <table style="border:0px;">
                     <tr style="height:30px;">
                       <td style="width:100px;text-align: LEFT; border-right: 0px;;font-size:13px;font-weight:bold;">※ 공유 및 결재</td>
                       <td>
                       </td>
                       <td rowspan="2" style="vertical-align:top;">
                       <div class="contents"> 
                        <!-- 공통 파일 영역 -->
                             <div id="fileList_area" style="width:100%;"></div>       
                        </div>                       
                       </td>
                     </tr>
                     <tr>
                       <td colspan="2" style="vertical-align:top;">
                       <div class="ax5_grid" data-ax5grid="first-grid-modal" data-ax5grid-config="{}" style="height: 100px; width: 100%;" ></div>
                       </td> 
                     </tr>  
                 </table>                  
               </form>                 
        </div>
    </div>
    

    
    
     <br>
    <div class="col-xs-2" style="height: 70px;">
    </div>

<div class ="popup_bottom_btn">
        <button type="button" class="close_btn" onclick="modalStack.close();">닫기</button>
    </div>
 </div>
    
<script type="text/javascript">
var actionType = null;
var coCd = null;
var salesCd = null;
var evlCnts = null;


setCommonSelect($(".popup_area select[data-kind]"));

var rGridView = {
        initView: function(){
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: false,
                multipleSelect: false,
                sortable: true,
                target: $('[data-ax5grid="grid-modal"]'),
                header: {
                  align: "center",
                  selector: false
                },
                body: {
                    onClick: function () {
                        this.self.select(this.dindex); 
                    },
                    onDBLClick: function () {
                        this.self.clearSelect();
                        this.self.select(this.dindex);
                    },
               },
               page : {
                   display : false,
               },
               columns: [
                     {key: "salesCd",             label: "SALES CD",     hidden:true},
                     {label: "계획정보", columns: [ 
                         {key: "wbsPlanCodeNm",   label: "계획명",          align: "left",   width: 115},  
                         {key: "wbsPlanMngNm",    label: "담당자",          align: "center",   width: 60},
                         {key: "wbsPlansDt",      label: "시작일",          align: "center",   width: 80},
                         {key: "wbsPlaneDt",      label: "종료일",          align: "center",   width: 80},
                         {key: "daycnt",          label: "소요일",         align: "right",   width: 60},                         
                     ]},
                     {label: "TASK계획정보", columns: [ 
                         {key: "plansDt",         label: "시작일",      align: "center",   width: 80, styleClass: "grid-font-bold"},
                         {key: "planeDt",         label: "종료일",      align: "center",   width: 80, styleClass: "grid-font-bold"},
                         {key: "planDaycnt",      label: "소요일",      align: "right",   width: 60, styleClass: "grid-font-bold"},                         
                     ]},
                     {label: "TASK실적정보", columns: [ 
                         {key: "rsltssDt",         label: "시작일",      align: "center",   width: 80, styleClass: "grid-font-bold"},
                         {key: "rsltseDt",         label: "종료일",      align: "center",   width: 80, styleClass: "grid-font-bold"},
                         {key: "rsltDaycnt",       label: "소요일",      align: "right",   width: 60, styleClass: "grid-font-bold"}, 
                         {key: "rsltsMh",       label: "실적공수",      align: "right",   width: 80, styleClass: "grid-font-bold"}, 
                     ]},
                     {key: "dayRate",          label: "계획대비<br>실적율 (%)",      align: "right",   width: 70, styleClass: "grid-font-bold"},
                     {label: "계획이슈정보", columns: [ 
                         {key: "planCnt",         label: "이슈횟수",      align: "right",   width: 80, styleClass: "grid-font-blue-bold"},
                         {key: "planActsDt",      label: "조치시작일",       align: "center",   width: 80, styleClass: "grid-font-blue-bold"},
                         {key: "planActeDt",      label: "조치종료일",       align: "center",   width: 80, styleClass: "grid-font-blue-bold"},
                         {key: "planActMh",       label: "투입공수",        align: "right",   width: 80, formatter:"money", styleClass: "grid-font-blue-bold"},
                         {key: "planActAmt",      label: "투입비용",        align: "right",   width: 80, formatter:"money", styleClass: "grid-font-blue-bold"},                                                 
                     ]},
                     {label: "실적이슈정보", columns: [ 
                         {key: "rsltCnt",         label: "이슈횟수",      align: "right",   width: 80, styleClass: "grid-font-blue-bold"},
                         {key: "rsltActsDt",      label: "시작일",       align: "center",   width: 80, styleClass: "grid-font-blue-bold"},
                         {key: "rsltActeDt",      label: "종료일",       align: "center",   width: 80, styleClass: "grid-font-blue-bold"},
                         {key: "rsltActMh",       label: "투입공수",        align: "right",   width: 80, formatter:"money", styleClass: "grid-font-blue-bold"},
                         {key: "rsltActAmt",      label: "투입비용",        align: "right",   width: 80, formatter:"money", styleClass: "grid-font-blue-bold"},
                     ]},
                     ],
                     footSum: [
                         [
                             {label: "합계",   align:"center",      colspan:4},
                             {key: "daycnt",     collector: "sum",   formatter:"money",  align: "right"},
                             {colspan:2},
                             {key: "planDaycnt",     collector: "sum",   formatter:"money",  align: "right"},
                             {colspan:2},
                             {key: "rsltDaycnt",     collector: "sum",   formatter:"money",  align: "right"},
                             {key: "rsltsMh",     collector: "sum",   formatter:"money",  align: "right"},                          
                             {colspan:1},
                             {key: "planCnt",     collector: "sum",   formatter:"money",  align: "right"},
                             {colspan:2},
                             {key: "planActMh",     collector: "sum",   formatter:"money",  align: "right"},
                             {key: "planActAmt",     collector: "sum",   formatter:"money",  align: "right"},
                             {key: "rsltCnt",     collector: "sum",   formatter:"money",  align: "right"},
                             {colspan:2},
                             {key: "rsltActMh",     collector: "sum",   formatter:"money",  align: "right"},
                             {key: "rsltActAmt",     collector: "sum",   formatter:"money",  align: "right", styleClass: "grid-font-bold"},
                         ]
                     ],
            });
            return this;
          },
          setData: function() {
              var targetObj = this.target;
              var formData = {
                  "coCd" : coCd,
                  "salesCd" : salesCd
              }
              postAjax("/user/wb/wb25/selectWbsTaskEvlResultList", formData, null, function(data){
                  if (data.resultList.length > 0) {
                	  $('#popForm_S #clntNm').val(data.resultList[0].clntNm);
                      $('#popForm_S #clntPjtNm').val(data.resultList[0].clntPjtNm);
                      $('#popForm_S #ordrsNo').val(data.resultList[0].ordrsNo);
                      $('#popForm_S #salesCd').val(data.resultList[0].salesCd);
                      
                      $('#popForm_S #estPrc').val(data.resultList[0].estPrc);
                      $('#popForm_S #trgtPrc').val(data.resultList[0].trgtPrc);
                      $('#popForm_S #actPrc').val(data.resultList[0].actPrc);
                      $('#popForm_S #trgtRate').val(data.resultList[0].trgtRate);
                      $('#popForm_S #actRate').val(data.resultList[0].actRate);   
                      $('#popForm_S #evlCnts').val(evlCnts);    
                      $.each($('.popup_area input[comma]'), function(idx, elem) {
                          onlyNumber(elem);
                        });
                  }
                  var list = data.resultList;                  
                  targetObj.setData({
                       list : list,
                       page : {
                           totalElements : list.length
                       }
                   });
                  
              });
         } 
     }
    

var gridViewPop = {
        initView : function() {
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: true,
                multipleSelect: false,
                sortable: false,
                target: $('[data-ax5grid="first-grid-modal"]'),
                header: {
                    align: "center",
                    selector: true
                },
                body: {
                     onClick: function () {
                        this.self.select(this.dindex);
                    },
                    onDBLClick: function () {
                    },
                    mergeCells : ["gb"],
                },
                page : {
                    navigationItemCount : 10,
                    height : 30,
                    display : false,
                    firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
                    prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
                    nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                    lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
                    onChange : function() {
                        gridView.setData(this.page.selectPage);
                    }
                },
                columns : [
                        {key: "gb",                 label: "구분",        align: "center",   width: 40},
                        {key: "wbsPlancoCdNm",      label: "회사명",      align: "center",   width: 130, hidden: true},
                        //{key: "wbsSharngUserId",  label: "ID",        align: "center",   width: 130, hidden: false},
                        {key: "usrNm",              label: "ID",        align: "center",   width: 130, hidden: true},
                        {key: "empNo",              label: "사원번호",  align: "center",   width: 130, hidden: true},
                        {key: "name",               label: "성명",        align: "center",   width: 80},
                        {key: "jik",                label: "직위",        align: "center",   width: 60},
                        {key: "reqDate",            label: "요청일자",  align: "center",   width: 90},
                        {key: "todoCfDt",           label: "확인일자",      align: "center",   width: 130},
                        {key: "todoCfOpn",          label: "확인의견",  align: "left",     width: 200},
                        {key: "telNo",              label: "H.P",       align: "center",   width: 130},
                      ]
                    });
                    return this;
                },

                setData : function(_pageNo) {
                    var targetObj = this.target;
                    var formData = {
                            "fileTrgtKey" : $("#popForm_S #fileTrgtKey").val(),
                            "reqNo" :  $("#popForm_S #fileTrgtKey").val(), 
                            "pageNo" : _pageNo + 1
                    }
                    postAjax("/user/qm/qm01/selectShareUserlst", formData, null, function(data){    
                    var list = data.result;
                        targetObj.setData({
                            list : list,
                            page : {
// //                                   currentPage : _pageNo,
// //                                   pageSize : data.paginationInfo.pageSize,
                                        totalElements :  data.paginationInfo.totalRecordCount,
// //                                   totalPages : data.paginationInfo.totalPageCount
                            } 
                        });
                    });
                },

                setData2 : function(_list) {
                    this.target.setData({
                            list : _list,
                            page : {
                                        totalElements :  _list.length,
                            } 
                        });
                }
    }

$(document).ready(function() {
    actionType = modalStack.last().paramObj.actionType;
    coCd = modalStack.last().paramObj.coCd;
    salesCd = modalStack.last().paramObj.salesCd;
    evlCnts = modalStack.last().paramObj.evlCnts;
    
    $('#popForm_S #actionType').val(actionType);
    $("#popForm_S #coCd").val(coCd);
    $("#popForm_S #salesCd").val(salesCd);
    $("#popForm_S #userId").val(jwt.userId);
    $("#popForm_S #fileTrgtKey").val(modalStack.last().paramObj.fileTrgtKey);
    
    $('.tit').text('WBS 과제 보기')
    rGridView.initView().setData(0);
     
    gridViewPop.initView().setData(0);
    
    //---------------------------------------------------------------  
      //첨부 화일 처리 시작 
      //---------------------------------------------------------------
      fileParam = {
              fileTrgtTyp : $("#popForm_S #pgmId").val(),
              fileTrgtKey     :$("#popForm_S #fileTrgtKey").val()
      }
      treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
      //---------------------------------------------------------------  
      //첨부 화일 처리 끝
      //---------------------------------------------------------------  
      
      authChk();          
});


 </script>
 
