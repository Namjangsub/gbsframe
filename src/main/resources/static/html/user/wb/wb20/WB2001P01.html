<div id="wbsPopup" class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
        <h4 class="tit">WBS 일정계획 보기</h4>
    </div>
    
    <div class="popup_table">
        <div class="form-group">
            <form id="popForm">
            <input type="hidden" id="fileTrgtKey"    name="fileTrgtKey">
            <input type="hidden" id="userId"        name="userId">
            <input type="hidden" id="pgmId"         name="pgmId"    value="WB0101M02">
                <table class="popup_table">
                    <colgroup>
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="6%">
                    </colgroup>
                    
                    <thead>
                        <tr>
                           <td colspan="9" style="height:30px;text-align: left;">기본정보</td>                                                
                        </tr>
                    </thead>
                    
                    <tbody>
                        <!-- 1행 -->
                        <tr>
                            <th class="hit">회사</th>
                            <td>
                                <select id="coCd" name="coCd" data-kind="CO" required msg="회사">
                                </select>
                            </td>
                            <th>관리번호</th>
                            <td>
                                <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsPlanNo" name="wbsPlanNo"  data-search="wbsPlanNo"  readonly >
                                </div>
                            </td>
                            <th class="hit">작성일자</th>
                            <td>
                            <input id="wbsPlanDt" id="wbsPlanDt" name="wbsPlanDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" required date>
                            </td>
                            <th class="hit">작성자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanId" name="wbsPlanId" msg="작성자" >
                                    <input type="text" id="wbsPlanNm" name="wbsPlanNm" onkeyUp="if(window.event.keyCode == 8){wbsPlanId.value = ''};" readonly required msg="작성자" >
                                    <a onclick="openUserSearch(1);">
                                        <i class="i_search_w"></i>
                                    </a>
                                </div>
                            </td>
                            <th rowspan="6" style="vertical-align:top;">
                               
                            </th>
                        </tr>
                                     
                        <!-- 2행 -->
                         <tr>
                            <th class="hit">Sales Code</th>
                            <td>
                                <div class="search_form">
                                    <input type="text" id="salesCd" name="salesCd" required readonly msg="salesCd">
                                    <a onclick="wbsSalesCodeSearch();"><i class="i_search_w" readonly></i></a>
                                </div>
                            </td>
                            <th>고객사</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="clntCd" name="clntCd" msg="고객사">
                                    <input type="text" id="clntNm" data-search="clntNm" msg="고객사" readonly>
                                   
                                </div>
                            </td>
                            <th>고객사PJT</th>
                            <td>
                                 <input type="text" id="clntPjt" name="clntPjt" msg="고객사PJT" readonly>
                            </td>
                            <th>신작구분</th>
                            <td>
                                 <input type="hidden" id="ordrsDtlDiv20" name="ordrsDtlDiv20" msg="신작구분">
                                 <input type="text" id="ordrsDtlDiv20Nm" name="ordrsDtlDiv20Nm" readonly msg="신작구분">
                            </td>
                        </tr>
                        
                         
                         <tr>
                            <th class="hit">Lv.1</th>
                            <td>
                                    <select id="wbsLevel1" name="wbsLevel1"  data-kind="WBSDIV" onchange="selectCodeList(this,0);optionGubun();" data-depth="0" required msg="WBS레벨 1">
                                      <option value="">선택</option>
                                    </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId1" name="wbsPlanMngId1">
                                    <input type="text" id="wbsPlanMngNm1" name="wbsPlanMngNm1" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId1.value = ''};" readonly required msg="레벨1담당자">
                                    <a onclick="openUserSearch(2);">
                                        <i class="i_search_w"></i>
                                </a>
                                </div>
                            </td>
                            <th class="hit">시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt1" name="wbsPlansDt1" autocomplete="off" date>
                                </div>
                            </td>
                            <th class="hit">종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt1" name="wbsPlaneDt1" autocomplete="off" date>
                                </div>
                            </td>
                        </tr>
                        


                        <tr id = "level2Area" style="display:none">
                            <th class="hit">Lv.2</th>
                            <td>
                                  <select class="division" id="wbsLevel2" name="wbsLevel2" onchange="selectCodeList(this,1);" data-depth="1" msg="WBS레벨 2">
                                    <option value="">선택</option>
                                  </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId2" name="wbsPlanMngId2">
                                    <input type="text" id="wbsPlanMngNm2" name="wbsPlanMngNm2"onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId2.value = ''};" readonly  msg="레벨2담당자">
                                    <a onclick="openUserSearch(3);">
                                        <i class="i_search_w"></i>
                                </a>
                                </div>
                            </td>
                            <th class="hit">시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt2" name="wbsPlansDt2" autocomplete="off" date>
                                </div>
                            </td>
                            <th class="hit">종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt2" name="wbsPlaneDt2" autocomplete="off" date>
                                </div>
                            </td>
                        </tr>


                         <tr  id = "level3Area"  style="display:none">
                            <th class="hit">Lv.3</th>
                            <td>
                                 <select class="division" id="wbsLevel3" name="wbsLevel3" data-depth="2"  msg="WBS레벨 3">
                                    <option value="">선택</option>
                                 </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                 <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId3" name="wbsPlanMngId3">
                                    <input type="text" id="wbsPlanMngNm3" name="wbsPlanMngNm3"onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId3.value = ''};" readonly  msg="레벨3담당자">
                                    <a onclick="openUserSearch(4);">
                                        <i class="i_search_w"></i>
                                </a>
                                </div>
                            </td>
                            <th class="hit">시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt3" name="wbsPlansDt3" autocomplete="off" date>
                                </div>
                            </td>
                            <th class="hit">종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt3" name="wbsPlaneDt3" autocomplete="off" date>
                                </div>
                            </td>
                        </tr>
                        
                        
                        
                         <tr>
                            <th class="hit">주요내용</th>
                            <td colspan=3>
                                   <input type="text" id="wbsPlanCnts" name="wbsPlanCnts"  required msg="주요내용">
                            </td>
                            <th>비고</th>
                            <td colspan=3>
                                    <input type="text" id="wbsPlanRmk" name="wbsPlanRmk">
                            </td>
                        </tr>

                         <tr  id = "level1Area"  style="display:none">
                            <th>설계난이도</th>
                            <td>
                              <select id="dsgnDifCodeId" name="dsgnDifCodeId" data-kind="DSGNDIF"> 
                              <option value="">선택</option>
                              </select>
                            </td>
                            <th>설계계획공수</th>
                            <td>
                                <input type="text" id="dsgnPlanHour" name="dsgnPlanHour" msg="설계계획공수">
                            </td>
                            <th>생산난이도</th>
                            <td>
                              <select id="prdctnDifCodeId" name="prdctnDifCodeId" data-kind="PRDCTNDIF">
                              <option value="">선택</option>
                              </select>
                            </td>
                            <th>생산계획공수</th>
                            <td>
                               <input type="text" id="prdctnPlanHour" name="prdctnPlanHour" msg="생산계획공수">  
                            </td>
                         </tr>

                         <tr>
                            <th>외주여부</th>
                            <td>
                                <input type=radio id="wbsPlanOsYn_Y" name="wbsPlanOsYn_Y" value="Y">Y &ensp; &ensp; &ensp; &ensp; 
                                <input type=radio id="wbsPlanOsYn_N" name="wbsPlanOsYn_N" value="N" checked>N <br>
                            </td>
                            <th>계획상태</th>
                            <td>
                                <select id="wbsPlanStsCodeId" name="wbsPlanStsCodeId" required data-kind="WBSPLANSTS">
                                    <option value="">선택</option>
                                </select>
                            </td>
                            <th></th>
                            <td></td>
                            <th></th>
                            <td></td>
                         </tr>
                    </tbody>
                </table>    
            </form>
        </div>
    </div>
    <div class="popup_table">               
        <table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※공유 대상자</td>
                <td style="text-align:right;">
                   <!--  <button type="button" class="btn btn-primary btn-sm"  id="shareBtn" onclick="opendModalSharngListList();">공유라인</button>
                    <div id="addrow" class="add_btn_small pdl10">
                        <a onclick="" data-grid-control="row-add" style="height: 30px; line-height: 28px;">+</a>
                        <a onclick="" data-grid-control="row-remove" style="height: 30px; line-height: 28px;">-</a>
                    </div> -->
                </td>
            </tr>
        </table>
    </div>
    
    <div class="contents">
         <!-- 공유대상자 리스트 -->
            <div data-ax5grid="second-grid" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
            </div> 
            
             
         <!-- 공통 파일 영역 -->
        <div class="col-sm-2" style="padding-right: 5px;">
            <div class="contents" style="margin: 0; padding: 0;width: 100%; min-width: 200px">
                <h3 class="location">
                    <span class="page_tit" style="text-align: left;"> 파일트리</span>
                </h3>
                <div id="treeview" style="height: 240px;padding: 5px">
                    <div id="deptTreeOrdars"></div>
                </div>
            </div>
        </div>
        <div class="col-sm-10" style="padding-left: 0;">
            <div class="contents" style="margin: 0; padding: 0;  width: 100%; min-width: 200px">
                <h3 class="location">
                    <a class="file_tag" id="file_tag" style="font-weight: bold; color: blue; padding-left: 20px; padding-right: 10px;"></a>
                    <span class="page_tit" id="file_tit" style="text-align: right;"> 문서현황</span>
                </h3>

                <button disabled type="button" id="button_file" style="background-color: gray;height: 25px; line-height: 15px;" onclick="file.click();" > 첨부파일</button>
                <div class="ax5_grid" data-ax5grid="file-grid" data-ax5grid-config="{}" style="height: 240px; width: 100%"></div>
            </div>
        </div>
          <!-- 공통 파일 END -->
    </div>
    <br>
    <div class="col-xs-2" style="height: 70px;">
    </div>

    <!-- 하단 버튼 -->
    <div class ="popup_bottom_btn">
        <!-- <button type="button" id="actionBtn" >등록</button> -->
        <button type="button" class="close_btn"
            onclick="modalStack.close();">닫기</button>
    </div>
    
<script type="text/javascript">
    var actionType = null;
    var fileTrgtKey = null;
    var lvl = null;
    var idx = null;

    var sGridView = {
            initView: function(){
                this.target = new ax5.ui.grid();
                this.target.setConfig({
                    showRowSelector: true,
                    multipleSelect: false,
                    sortable: true,
                    target: $('[data-ax5grid="second-grid"]'),
                    header: {
                      align: "center",
                      selector: false
                    },
                    body: {
                        onClick: function () {
                            this.self.select(this.dindex); 
                        },
                        onDBLClick: function () {
                            this.self.clearSelect();
                            this.self.select(this.dindex);
                        },
                   },
                   columns: [
                         {key: "rn",      label: "No.",      align: "center",   width: 60},
                         {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 130},
                         {key: "wbsPlanNo",      label: "관리번호",      align: "center",   width: 130},
                         {key: "wbsPlanCodeId",      label: "계획항목코드",      hidden: true},
                         {key: "wbsPlanCodeNm",      label: "LEVEL",      align: "center",   width: 130},
                         {key: "todoCfDt",      label: "확인일자",      align: "center",   width: 130},
                         {key: "todoCfOpn",      label: "확인의견",      align: "left",   width: 200},
                         {key: "wbsPlancoCd",      label: "회사",          hidden: true},
                         {key: "wbsPlancoCdNm",      label: "회사명",      align: "center",   width: 130},
                         {key: "wbsSharngUserId",      label: "ID",      align: "center",   width: 130},
                         {key: "empNo",      label: "사원번호",      align: "center",   width: 130},
                         {key: "name",      label: "성명",      align: "center",   width: 130},
                         {key: "telNo",      label: "H.P",      align: "center",   width: 130},
                         {key: "email",      label: "E-Mail",      align: "center",   width: 200}
                         ]
                });   
                return this;
              },
              setData: function() {
                  var targetObj = this.target;
                  var row = toDoGridView.target.getList()[idx];
                  var paramObj = {};
                  if (row != undefined) {
                	  paramObj["coCd"] = row.coCd;
                      paramObj["salesCd"] = row.salesCd;
                      paramObj["codeKind"] = row.wbsPlanCodeKind;
                      paramObj["codeId"] = row.wbsPlanCodeId;
                  }
                  else {
                	  paramObj["coCd"] = " ";
                      paramObj["salesCd"] = " ";
                      paramObj["codeKind"] = " ";
                      paramObj["codeId"] = " ";
                  }
                  postAjax("/user/wb/wb01/selectPlanSharngList", paramObj, null, function(data){
                     var list = data.resultList;
                      targetObj.setData({
                           list : list,
                           page : {
                               totalElements : list.length
                           }
                       });
                      
                  }); 
             } 
         }
    
    $(document).ready(function() {
        setCommonSelect($(".popup_area select[data-kind]"));
        setByCoCd(modalStack.last().paramObj.coCd);
        
        authChk();                      // 권한체크

        actionType = modalStack.last().paramObj.actionType;
        fileTrgtKey = modalStack.last().paramObj.fileTrgtKey;
        lvl = modalStack.last().paramObj.lvl;
        idx = modalStack.last().paramObj.idx;
        
        $('#wbsPlanDt').datepicker({
            format : "yyyy-mm-dd",
            language : "ko",
            autoclose : true
        }).datepicker("setDate", new Date());
        
        
        $("#popForm #wbsPlanId").val(jwt.userId);
        $("#popForm #userId").val(jwt.userId);
        $("#popForm #wbsPlanNm").val(jwt.userNm);
        
        if (lvl==1){
            $("#level1Area").show();
            $("#level2Area").hide();
            $("#level3Area").hide();
        }
        else if (lvl==2) {
            $("#level1Area").hide();
            $("#level2Area").show();
            $("#level3Area").hide();
        }
        else {
            $("#level1Area").hide();
            $("#level2Area").show();
            $("#level3Area").show();
        }
        
        
        $('#wbsPlansDt1').datepicker({
            format : "yyyy-mm-dd",
            language : "ko",
            autoclose : true
        }).datepicker("setDate", new Date())
        
        
        $('#wbsPlaneDt1').datepicker({
            format : "yyyy-mm-dd",
            language : "ko",
            autoclose : true
        }).datepicker("setDate", new Date())
        
        $("#popForm #wbsPlanMngId1").val(jwt.userId);
        $("#popForm #wbsPlanMngNm1").val(jwt.userNm);
        
        if (lvl==2) {
            $('#wbsPlansDt2').datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", new Date())
            
            $('#wbsPlaneDt2').datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", new Date())
            
            $("#popForm #wbsPlanMngId2").val(jwt.userId);
            $("#popForm #wbsPlanMngNm2").val(jwt.userNm);
        }
        else if (lvl==3) {
            $('#wbsPlansDt2').datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", new Date())
            
            $('#wbsPlaneDt2').datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", new Date())
            
            $("#popForm #wbsPlanMngId2").val(jwt.userId);
            $("#popForm #wbsPlanMngNm2").val(jwt.userNm);
            
            $('#wbsPlansDt3').datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", new Date())
            
            $('#wbsPlaneDt3').datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", new Date())
            
            $("#popForm #wbsPlanMngId3").val(jwt.userId);
            $("#popForm #wbsPlanMngNm3").val(jwt.userNm);
        }
        
        optionGubun();
        
        if (actionType == "C") {
            $('#wbsPlansDt1').datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", new Date())
            
            
            
            var strYear = new Date().toISOString().substring(2, 4);
            var planData = {
                    "coCd" : $('#coCd').val(),
                    "year" : "W" + strYear
                }; 
             postAjaxSync("/user/wb/wb01/selectMaxWbsPlanNo", planData, null, function(data){
            	 $('#wbsPlanNo').val(data.result[0].wbsPlanNo); 

            }); 
        }
        else {
        	//$('.tit').text('WBS 일정계획 수정')
        	debugger;
            var row = toDoGridView.target.getList()[idx];
            var paramObj1 = {};
            var paramObj2 = {};
            var paramObj3 = {};
            
            if (lvl == 1) {
                paramObj1["coCd"] = row.coCd;
                paramObj1["salesCd"] = row.salesCd;
                paramObj1["codeKind"] = row.wbsPlanCodeId.substring(0,6);;
                paramObj1["codeId"] = row.wbsPlanCodeId;
                selectWbsPlanInfo(1, paramObj1, 1);
            }
            else if (lvl == 2) {
            	paramObj1["coCd"] = row.coCd;
                paramObj1["salesCd"] = row.salesCd;
                paramObj1["codeKind"] = row.wbsPlanCodeId.substring(0,6);
                paramObj1["codeId"] = row.wbsPlanCodeId.substring(0,8);
                selectWbsPlanInfo(1, paramObj1, 0);
                
                paramObj2["coCd"] = row.coCd;
                paramObj2["salesCd"] = row.salesCd;
                paramObj2["codeKind"] = row.wbsPlanCodeId.substring(0,8);
                paramObj2["codeId"] = row.wbsPlanCodeId;
                selectWbsPlanInfo(2, paramObj2, 1);
            }
            else if (lvl == 3) {
            	paramObj1["coCd"] = row.coCd;
                paramObj1["salesCd"] = row.salesCd;
                paramObj1["codeKind"] = row.wbsPlanCodeId.substring(0,6);
                paramObj1["codeId"] = row.wbsPlanCodeId.substring(0,8);
                selectWbsPlanInfo(1, paramObj1, 0);
                
                paramObj2["coCd"] = row.coCd;
                paramObj2["salesCd"] = row.salesCd;
                paramObj2["codeKind"] = row.wbsPlanCodeId.substring(0,8);
                paramObj2["codeId"] = row.wbsPlanCodeId.substring(0,10);
                selectWbsPlanInfo(2, paramObj2, 0);
                
                paramObj3["coCd"] = row.coCd;
                paramObj3["salesCd"] = row.salesCd;
                paramObj3["codeKind"] = row.wbsPlanCodeId.substring(0,10);
                paramObj3["codeId"] = row.wbsPlanCodeId;
                selectWbsPlanInfo(3, paramObj3, 1);
            }

        }
        sGridView.initView().setData();
        
       
        //---------------------------------------------------------------  
        //첨부 화일 처리 시작 
        //---------------------------------------------------------------
        //debugger;
        fileParam = {
                fileTrgtTyp : $("#pgmId").val(),
                fileTrgtKey     :fileTrgtKey
        }
        treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
        //---------------------------------------------------------------  
        //첨부 화일 처리 끝
        //---------------------------------------------------------------  

        
    });
    
    
    function setByCoCd(value) {
        $('#coCd option:not([value="'+value+'"])').remove();
    }
    
    
    //작성자, 담당자  검색
    function openUserSearch(type) {
        var paramObj = {};
        paramObj["coCd"] = $('#coCd').val();
        if (type == 1) {
            paramObj["userId"] = $('#popForm #wbsPlanId').val();
        }
        else if (type == 2) {
            paramObj["userId"] = $('#popForm #wbsPlanMngId1').val();
        }
        else if (type == 3) {
            paramObj["userId"] = $('#popForm #wbsPlanMngId2').val();
        }
        else if (type == 4) {
            paramObj["userId"] = $('#popForm #wbsPlanMngId3').val();
        }
        paramObj["useYn"] =  "Y";
        
        openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "작성자 검색", paramObj, function (tree){
            var checkedId = tree.get_checked()[0];
            var checkedNode = tree.get_node(checkedId);
            if (type == 1) {
                $('#popForm #wbsPlanId').val(checkedNode.id);
                $('#popForm #wbsPlanNm').val(checkedNode.text);
            }
            else if (type == 2) {
                $('#popForm #wbsPlanMngId1').val(checkedNode.id);
                $('#popForm #wbsPlanMngNm1').val(checkedNode.text);
            }
            else if (type == 3) {
                $('#popForm #wbsPlanMngId2').val(checkedNode.id);
                $('#popForm #wbsPlanMngNm2').val(checkedNode.text);
            }
            else if (type == 4) {
                $('#popForm #wbsPlanMngId3').val(checkedNode.id);
                $('#popForm #wbsPlanMngNm3').val(checkedNode.text);
            }
            
            
        });
    }
    
  //Sales Code (수주마스터, 수주상세테이블 조인) 검색
    function wbsSalesCodeSearch() {
      if (actionType == "U") {
          alert("정보 수정시 선택이 불가합니다.");
          return;
      }
        var paramObj = {
           "coCd" : $('#coCd').val(),
           "salesCd": $('#salesCd').val()
        };
        openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 430, "SALES CODE 검색", paramObj, function (grid){
            var row = grid.target.getList("selected")[0];
            $('#salesCd').val(row.salesCd); // Sales Code
            $('#clntPjt').val(row.clntPjt); // 고객사 PJT
            $('#clntCd').val(row.ordrsClntCd); // 고객사코드
            $('#clntNm').val(row.ordrsClntNm); // 고객사명
            $("#ordrsDtlDiv20").val(row.ordrsDtlDiv20); // 신작구분
            $("#ordrsDtlDiv20Nm").val(row.ordrsDtlDiv20Nm); // 신작구분
        });
    }
  
    function optionGubun() {
        if ($("#wbsLevel1 option:checked").text() == "설계") {
           $("#dsgnDifCodeId").prop('readonly',false);
           $("#dsgnPlanHour").prop('readonly',false);
           $("#prdctnDifCodeId").prop('readonly',true);
           $("#prdctnPlanHour").prop('readonly',true);
       }
       else if ($("#wbsLevel1 option:checked").text() == "생산") {
           $("#dsgnDifCodeId").prop('readonly',true);
           $("#dsgnPlanHour").prop('readonly',true);
           $("#prdctnDifCodeId").prop('readonly',false);
           $("#prdctnPlanHour").prop('readonly',false);
       }
       else {
           $("#dsgnDifCodeId").prop('readonly',true);
           $("#dsgnPlanHour").prop('readonly',true);
           $("#prdctnDifCodeId").prop('readonly',true);
           $("#prdctnPlanHour").prop('readonly',true);
       }
   }
    
   
   function selectCodeList(obj,idx) { 
       
        var codeKind = $(obj).val();
        var target = $(obj).next('select.division');
        if(idx == 0){
            target = $("#wbsLevel2");
            $('#wbsLevel2 option[value!=""]').remove();
            $('#wbsLevel3 option[value!=""]').remove();
        }else{
            target = $("#wbsLevel3");
            $('#wbsLevel3 option[value!=""]').remove();
        }
        var paramObj = {"codeKind": codeKind};
        if (codeKind != '') {
            postAjaxSync("/admin/cm/cm05/selectChildCodeList", paramObj, null, function(data){
                var optionHtml = '';
                var childCodeList = data.childCodeList;
                $.each(childCodeList, function(index, item){
                    optionHtml += '<option value='+item.codeId+'>';
                    optionHtml += item.codeNm;
                    optionHtml += '</option>';
                });
                $(target).append(optionHtml);
            });
        }
        
    }
   
   function selectWbsPlanInfo(infoLvl, paramObj, chkIdx) {   
       var row = toDoGridView.target.getList()[idx];
       if (row != undefined) {
           postAjaxSync("/user/wb/wb01/selectWbsPlanInfo", paramObj, null, function(data) {
        	   if (infoLvl == 1) {
                   $.each(data.result, function(key, value) {
                       if (key == "codeId") {
                           $('#wbsLevel1 option[value!="' + value + '"]').remove();
                       }
                       else if (key == "wbsPlanMngId") {
                           $("#wbsPlanMngId1").val(value);
                       }
                       else if (key == "wbsPlanMngNm") {
                           $("#wbsPlanMngNm1").val(value);
                       }
                       else if (key == "wbsPlansDt") {
                           $("#wbsPlansDt1").val(value);
                       }
                       else if (key == "wbsPlaneDt") {
                           $("#wbsPlaneDt1").val(value);
                       }
                       else if (key == "wbsPlanOsYn" && value == "Y"){ 
                           $("#wbsPlanOsYn_Y").prop('checked',true);
                           $("#wbsPlanOsYn_N").prop('checked',false);
                       }
                       else if (key == "wbsPlanOsYn" && value == "N"){ 
                           $("#wbsPlanOsYn_Y").prop('checked',false);
                           $("#wbsPlanOsYn_N").prop('checked',true);
                       }
                       else if (key == "wbsPlanStsCodeId") {
                           $('#wbsPlanStsCodeId option[value!="' + value + '"]').remove();
                       }
                       else {
                           if (chkIdx == 1) {
                               if ($("#popForm #" + key)[0]) {
                                   $("#popForm #" + key).val(value);
                               }
                           }
                       }
                   });
               }
               else if (infoLvl == 2) {
                   $.each(data.result, function(key, value) {
                       if (key == "codeId") {
                           $('#wbsLevel1 option[value!="' + value.substring(0,8) + '"]').remove();
                           selectCodeList("#wbsLevel1",0);
                           $('#wbsLevel2 option[value!="' + value + '"]').remove();
                       }
                       else if (key == "wbsPlanMngId") {
                           $("#wbsPlanMngId2").val(value);
                           
                       }
                       else if (key == "wbsPlanMngNm") {
                           $("#wbsPlanMngNm2").val(value);
                           $("#wbsPlanMngNm1").prop("readonly", true);
                       }
                       else if (key == "wbsPlansDt") {
                           $("#wbsPlansDt2").val(value);
                           $("#wbsPlansDt1").prop("readonly", true);
                       }
                       else if (key == "wbsPlaneDt") {
                           $("#wbsPlaneDt2").val(value);
                           $("#wbsPlaneDt1").prop("readonly", true);
                       }
                       else if (key == "wbsPlanOsYn" && value == "Y"){ 
                           $("#wbsPlanOsYn_Y").prop('checked',true);
                           $("#wbsPlanOsYn_N").prop('checked',false);
                       }
                       else if (key == "wbsPlanOsYn" && value == "N"){ 
                           $("#wbsPlanOsYn_Y").prop('checked',false);
                           $("#wbsPlanOsYn_N").prop('checked',true);
                       }
                       else if (key == "wbsPlanStsCodeId") {
                           $('#wbsPlanStsCodeId option[value!="' + value + '"]').remove();
                       }
                       else {
                           if (chkIdx == 1) {
                               if ($("#popForm #" + key)[0]) {
                                   $("#popForm #" + key).val(value);
                               }
                           }
                       }
                   });
               }
               else if (infoLvl == 3) {
                   $.each(data.result, function(key, value) {
                       if (key == "codeId") {
                           $('#wbsLevel1 option[value!="' + value.substring(0,8) + '"]').remove();
                           selectCodeList("#wbsLevel1",0);
                           $('#wbsLevel2 option[value!="' + value.substring(0,10) + '"]').remove();
                           selectCodeList("#wbsLevel2",1);
                           $('#wbsLevel3 option[value!="' + value + '"]').remove();
                       }
                       else if (key == "wbsPlanMngId") {
                           $("#popForm #wbsPlanMngId3").val(value);
                           
                       }
                       else if (key == "wbsPlanMngNm") {
                           $("#popForm #wbsPlanMngNm3").val(value);
                           $("#popForm #wbsPlanMngNm1").prop("readonly", true);
                           $("#popForm #wbsPlanMngNm2").prop("readonly", true);
                       }
                       else if (key == "wbsPlansDt") {
                           $("#popForm #wbsPlansDt3").val(value);
                           $("#popForm #wbsPlansDt1").prop("readonly", true);
                           $("#popForm #wbsPlansDt2").prop("readonly", true);
                       }
                       else if (key == "wbsPlaneDt") {
                           $("#popForm #wbsPlaneDt3").val(value);
                           $("#popForm #wbsPlaneDt1").prop("readonly", true);
                           $("#popForm #wbsPlaneDt2").prop("readonly", true);
                       }
                       else if (key == "wbsPlanOsYn" && value == "Y"){ 
                           $("#wbsPlanOsYn_Y").prop('checked',true);
                           $("#wbsPlanOsYn_N").prop('checked',false);
                       }
                       else if (key == "wbsPlanOsYn" && value == "N"){ 
                           $("#wbsPlanOsYn_Y").prop('checked',false);
                           $("#wbsPlanOsYn_N").prop('checked',true);
                       }
                       else if (key == "wbsPlanStsCodeId") {
                           $('#wbsPlanStsCodeId option[value!="' + value + '"]').remove();
                       }
                       else {
                           if (chkIdx == 1) {
                               if ($("#popForm #" + key)[0]) {
                                   $("#popForm #" + key).val(value);
                               }
                           }
                       }
                   });
               }
           });
       }
   }
   
   //공유대상자 팝업
   function opendModalSharngListList() { 
       var formData = {};
       openSecondModal("/static/html/user/wb/wb02/WB0202P01.html", 1300, 780, "결재선 지정", formData, function (grid){
               var rowList = grid.target.getList("selected");
               if (rowList.length > 0) {
                   var chk = false;
                   $.each(rowList, function(idx, elem){ 
                       if (elem.check == "Y") { 
                           var userId = elem.appId;
                           var rowList1 = sGridView.target.getList();
                           $.each(rowList1, function(idx, elem){
                                if (elem.wbsSharngUserId == userId) {
                                   chk = true;
                               }
                           });
                       }
                   });
                   if (chk == false) {
                       $.each(rowList, function(idx, elem){
                           if (elem.check == "Y") {
                                   var paramObj = {"coCd" : elem.coCd, "userId" : elem.appId};            
                                   postAjax("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
                                      
                                           sGridView.target.addRow($.extend({}, "last", false));
                                           var row = sGridView.target.getList().length - 1;
                                           sGridView.target.setValue(row, "salesCd", $("#salesCd").val());
                                           sGridView.target.setValue(row, "wbsPlanNo", $("#wbsPlanNo").val());
                                           if (lvl == 1) {
                                              sGridView.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel1").val());
                                              sGridView.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel1 option:checked").text());
                                           }
                                           else if (lvl == 2) {
                                              sGridView.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel2").val());
                                              sGridView.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel2 option:checked").text());
                                           }
                                           else if (lvl == 3) {
                                              sGridView.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel3").val());
                                              sGridView.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel3 option:checked").text());
                                           }
                                           
                                           sGridView.target.setValue(row, "wbsPlancoCd", data.resultList[0].coCd);
                                           sGridView.target.setValue(row, "wbsPlancoCdNm", data.resultList[0].coCdNm);
                                           sGridView.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
                                           sGridView.target.setValue(row, "empNo", data.resultList[0].empNo);
                                           sGridView.target.setValue(row, "name", data.resultList[0].name);
                                           sGridView.target.setValue(row, "telNo", data.resultList[0].telNo);
                                           sGridView.target.setValue(row, "email", data.resultList[0].email);                                        
                                   });
                             }
                       });
                  }
                  else {
                      alert("중복 공유를 지정할 수 없습니다.");
                      return;
                  }
               }
               
       });
   }
   
   $('[data-grid-control]').click(function () {

        switch (this.getAttribute("data-grid-control")) {    
            case "row-add":
                var paramObj = {
                        "coCd" : $('#coCd').val(),
                        "userId": '',
                        "useYn": "Y"
                    };
                    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
                       var checkedId = tree.get_checked()[0];
                       var checkedNode = tree.get_node(checkedId);   
                       
                       var paramObj = {"coCd" : $('#coCd').val(), "userId" : checkedId};
                       
                       postAjax("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
                               var chk = false;
                               var rowList = sGridView.target.getList();
                               $.each(rowList, function(idx, elem){
                                   if (elem.wbsSharngUserId == data.resultList[0].id) {
                                       chk = true;
                                   }
                               });
            
                               if (chk == false) {
                                   sGridView.target.addRow($.extend({}, "last", false));                             
                                   var row = sGridView.target.getList().length - 1;
                                   sGridView.target.setValue(row, "salesCd", $("#salesCd").val());
                                   sGridView.target.setValue(row, "wbsPlanNo", $("#wbsPlanNo").val());
                                   if (lvl == 1) {
                                       sGridView.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel1").val());
                                       sGridView.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel1 option:checked").text());
                                   }
                                   else if (lvl == 2) {
                                       sGridView.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel2").val());
                                       sGridView.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel2 option:checked").text());
                                   }
                                   else if (lvl == 3) {
                                       sGridView.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel3").val());
                                       sGridView.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel3 option:checked").text());
                                   }
                                   sGridView.target.setValue(row, "wbsPlancoCd", data.resultList[0].coCd);
                                   sGridView.target.setValue(row, "wbsPlancoCdNm", data.resultList[0].coCdNm);
                                   sGridView.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
                                   sGridView.target.setValue(row, "empNo", data.resultList[0].empNo);
                                   sGridView.target.setValue(row, "name", data.resultList[0].name);
                                   sGridView.target.setValue(row, "telNo", data.resultList[0].telNo);
                                   sGridView.target.setValue(row, "email", data.resultList[0].email);   
                               }
                               else {
                                   alert("중복 공유를 지정할 수 없습니다.");
                                   return;
                               }
                       });                 
                    });
              break;
            case "row-remove":
                var row = sGridView.target.getList("selected");
                if (row.todoDt == undefined && row.todoDt == null) {
                    sGridView.target.deleteRow("selected");
                }              
                else{
                    alert("공유 데이터가 확인되었으며 삭제할 수 없습니다.");
                }           
              break;
        }
    });

    
   
</script>
