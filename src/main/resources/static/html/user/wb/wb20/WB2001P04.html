<div id="wbsPopup" class="popup_area of_a" style="width: 100%; height: 100%;">
	<div class="tit_contents">
	    <h4 class="tit">WBS Level 1 실적 보기</h4>
	</div>
	
	<div class="popup_table">
		<div class="form-group">
			<form id="popForm">
			<input type="hidden" name="wbsPlanCodeKind_S1" id="wbsPlanCodeKind_S1" data-search="wbsPlanCodeKind" value="WBSDIV">
			<input type="hidden" name="creatPgm" id="creatPgm" data-search="creatPgm" value="WB2001P04">
			<input type="hidden" name="fileTrgtKey_S1" data-search="fileTrgtKey" id="fileTrgtKey_S1">
		        <table class="popup_table">
					<colgroup>
					     <col width="8%">
					     <col width="11%">
					     <col width="8%">
					     <col width="11%">
					     <col width="8%">
					     <col width="11%">
					     <col width="8%">
					     <col width="11%">
					     <col width="6%">
					</colgroup>					
					<thead>
						<tr>
						   <td colspan="9" style="height:30px;text-align: left;">기본정보</td>	                                              
						</tr>
					</thead>
					
					<tbody>
						<!-- 1행 -->
						<tr>
							<th class="hit">회사</th>
							<td>
								<select  id="coCd_S1" data-kind="CO" data-search="coCd" required="required" disabled>
                                   <option value="">전체</option>
                                </select>
							</td>
							<th>관리번호</th>
							<td>
								<div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsPlanNo_S1" name="wbsPlanNo_S1"  required="required" data-search="wbsPlanNo" disabled>
                                </div>
							</td>
							<th class="hit">작성일자</th>
							<td>
	                            <div class="date_input">
	                                <input type="text" class="input_calendar" data-search="wbsPlanDt" style="width: 100% !important; display: inline-block !important;" id="wbsPlanDt_S1" name="wbsPlanDt_S1" autocomplete="off" msg="작성일자" date required disabled>
	                            </div>
							</td>
							<th class="hit">작성자</th>
							<td>
								<div class="search_form">
	                                <input type="hidden" id="wbsPlanId_S1" name="wbsPlanId_S1" data-search="wbsPlanId">
	                                <input type="text" id="wbsPlanNm_S1" name="wbsPlanNm_S1" msg="작성자" data-search="wbsPlanNm" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId_S1.value = ''};" readonly required disabled>
	                               
                                </div>
							</td>
							<th rowspan="5" style="vertical-align:top;">
							    </th>
						</tr>
						             
						<!-- 2행 -->
						 <tr>
						    <th  class="hit">Sales Code</th>
						    <td>
							    <div class="search_form" style="width: 100%;">
                                    <input type="text" class="form-control input-sm" id="salesCd_S1" data-search="salesCd" disabled>
                                   
                                </div>
						    </td>
						    <th  class="hit">고객사</th>
						    <td>
		                            <input type="hidden" id="clntCd_S1" name="clntCd_S1"  data-search="clntCd">
		                            <div class="search_form">
		                                <input type="text" id="clntNm_S1" name="clntNm_S1"  data-search="clntNm" onkeyup="if(event.keyCode == 13){openClntSearch('P')};" disabled> 
		                              
		                            </div>   
						    </td>
						    <th>고객사PJT</th>
						    <td>
						        <input type="text" class="form-control input-sm" id="wbsClntPjt_S1" data-search="clntPjt" disabled>
						    </td>
						    <th class="hit">신작구분</th>
						    <td>
						      <select id="wbsPlanDiv_S1" name="wbsPlanDiv_S1" data-kind="wbsPlanDiv_S1" data-search="wbsPlanDiv" disabled>
						      <option value="">선택</option>
                              </select>
						    </td>
						</tr>
						
						 <!-- 3행 -->
						 <tr>
						    <th class="hit">Lv.1</th>
						    <td>
                                  <select id="wbsLevel1_S1" name="wbsLevel1_S1" data-kind="wbsLevel1_S1" data-search="wbsPlanCodeId" disabled>
                                     <option value="">선택</option>
                                  </select>
						    </td>
						    <th>담당자</th>
						    <td>
						        <div class="search_form">
	                                <input type="hidden" id="wbsPlanMngId_S1" name="wbsPlanMngId_S1" data-search="wbsPlanMngId">
	                                <input type="text" id="wbsPlanMngNm_S1" name="wbsPlanMngNm_S1" msg="담당자" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId_S1.value = ''};" required disabled>
	                                
                                </div>
						    </td>
						    <th class="hit">시작일자</th>
						    <td>
						    <div class="date_input">
                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt_S1" data-search="wbsPlansDt"  "autocomplete="off" date disabled>
                            </div>
						    </td>
						    <th class="hit">종료일자</th>
						    <td>
						    <div class="date_input">
                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt_S1" data-search="wbsPlaneDt"  autocomplete="off" date disabled>
                            </div>
						    </td>
						</tr>
						
						<!-- 4행 -->
						 <tr>
						    <th class="hit">주요내용</th>
						    <td colspan=3>
						            <input type="text" id="wbsPlanCnts_S1" data-search="wbsPlanCnts" disabled>
						    </td>
						    <th>비고</th>
						    <td colspan=3>
						            <input type="text" id="wbsPlanRmk_S1" data-search="wbsPlanRmk" disabled>
						    </td>
						</tr>
						
						<!-- 5행 -->
						 <tr>
					        <th>설계난이도</th>
					        <td>
					          <select id="dsgnDifCodeId_S1" name="dsgnDifCodeId_S1" data-kind="dsgnDifCodeId_S1" data-search="dsgnDifCodeId" disabled>
					          <option value="">선택</option>
                              </select>
					        </td>
					        <th>설계계획공수</th>
					        <td>
					            <input type="text" id="dsgnPlanHour_S1" data-search="dsgnPlanHour" disabled>
					        </td>
					        <th>생산난이도</th>
					        <td>
					          <select id="prdctnDifCodeId_S1" name="prdctnDifCodeId_S1" data-kind="prdctnDifCodeId_S1" data-search="prdctnDifCodeId" disabled>
					          <option value="">선택</option>
                              </select>
					        </td>
					        <th>생산계획공수</th>
					        <td>
					           <input type="text" id="prdctnPlanHour_S1" data-search="prdctnPlanHour" disabled>  
					        </td>
						 </tr>

                        <!-- 6행 -->
                         <tr>
                            <th>외주여부</th>
                            <td>
								<input type=radio id="wbsPlanOsYn_Y_S1" name="wbsPlanOsYn_Y_S1" value="Y" data-search="wbsPlanOsYn_Y" disabled>Y &ensp; &ensp; &ensp; &ensp; 
								<input type=radio id="wbsPlanOsYn_N_S1" name="wbsPlanOsYn_N_S1" value="N" data-search="wbsPlanOsYn_N" checked disabled>N<br>
                            </td>
                            <th>계획상태</th>
                            <td>
                                <select id="wbsPlanStsCodeId_S1" name="wbsPlanStsCodeId_S1" data-kind="wbsPlanStsCodeId_S1" data-search="wbsPlanStsCodeId" disabled>
                                    <option value="">선택</option>
                                </select>
                            </td>                            
                         </tr>
				    </tbody>
				    
				    <thead>
                        <tr>
                           <td colspan="9" style="height:30px;text-align: left;">결과정보</td>                                                
                        </tr>
                    </thead>
                    
                    <tbody>
                          <!-- 1행 -->
                         <tr>
                            <th>실적번호</th>
                            <td>
                                <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsNo_S1" name="wbsRsltsNo_S1"  required="required" data-search="wbsRsltsNo" disabled>
                                </div>
                            </td>
                            <th>실적일자</th>
                            <td>
                                    <div class="date_input">
                                    <input type="text" class="input_calendar" data-search="wbsRsltsDt" style="width: 100% !important; display: inline-block !important;" id="wbsRsltsDt_S1" name="wbsRsltsDt_S1" autocomplete="off" msg="실적일자" date required disabled>
                                </div>
                            </td>
                            <th>작성자</th>
                            <td>
                               <div class="search_form">
                                    <input type="hidden" id="wbsRsltsId_S1" name="wbsRsltsId_S1" data-search="wbsRsltsId">
                                    <input type="text" id="wbsRsltsNm_S1" name="wbsRsltsNm_S1" msg="작성자" data-search="wbsRsltsNm" onkeyUp="if(window.event.keyCode == 8){wbsRsltsId_S1.value = ''};" readonly required disabled>                                   
                                </div>
                            </td>
                            <th></th>
                            <td>
                              
                            </td>
                        </tr>
                        <!-- 2행 -->
                         <tr>
                            <th>시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" data-search="wbsRsltssDt" style="width: 100% !important; display: inline-block !important;" id="wbsRsltssDt_S1" name="wbsRsltssDt_S1" autocomplete="off" msg="시작일자" date required disabled>
                                </div>
                            </td>
                            <th>종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" data-search="wbsRsltseDt" style="width: 100% !important; display: inline-block !important;" id="wbsRsltseDt_S1" name="wbsRsltseDt_S1" autocomplete="off" msg="종료일자" date required disabled>
                                </div>
                            </td>
                            <th>진척율</th>
                            <td>
                               <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsRate_S1" name="wbsRsltsRate_S1"  required="required" data-search="wbsRsltsRate" disabled>
                                </div>
                            </td>
                            <th>실투입공수</th>
                            <td>
                              <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsMh_S1" name="wbsRsltsMh_S1"  required="required" data-search="wbsRsltsMh" disabled>
                                   <input type="hidden"  id="wbsPlanMh_S1" name="wbsPlanMh_S1"  required="required" data-search="wbsPlanMh" disabled>
                                </div>
                            </td>
                        </tr>
                        <!-- 3행 -->
                       <tr>
                            <th>주요내용</th>
                            <td colspan=3>
                                    <input type="text" id="wbsRsltsCnts_S1" data-search="wbsRsltsCnts" disabled> 
                            </td>
                            <th>비고</th>
                            <td colspan=3>
                                    <input type="text" id="wbsRsltsRmk_S1" data-search="wbsRsltsRmk" disabled>
                                    <input type="hidden" id="closeYn_S1">
                                    <input type="hidden" id="lockYn_S1">
                            </td>
                        </tr>   
                    </tbody>
				    
		        </table>	
			</form>
		</div>
	</div>
	<div class="popup_table">               
        <table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※실적상세</td>
                <td></td>
            </tr>
        </table>
    </div> 
    
    <div class="contents">
        <!-- 실적상세 리스트 -->
        <div data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
    </div>

    <div class="popup_table">               
        <table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※공유 대상자</td>
                <td style="text-align:right;">                    
                </td>
                <td style="text-align: LEFT; border-right: 0px;">※결재 대상자</td>
                <td style="text-align:right;">                   
                </td>
                
            </tr>
            <tr>
                <td colspan="2" style="text-align: LEFT; border-right: 0px;">
                   <div data-ax5grid="second-grid1" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
                </td>
                 <td colspan="2" style="text-align: LEFT; border-right: 0px;">
                 <div data-ax5grid="second-grid2" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
                </td>                
            </tr>
        </table>
                    <!-- 공유대상자 리스트 -->
              
    </div>

    <div class="contents">
                <!-- 첨부파일 리스트 -->
                <div class="row" style="margin-top: 15px;margin-bottom:40px;">
                    <div class="col-xs-2" style="padding-right: 5px;">
                        <div class="contents" style="margin: 0; padding: 0;width: 100%; min-width: 100px">
                            <h3 class="location">
                                <span class="page_tit" style="text-align: left;"> 파일트리</span>
                            </h3>
                            <div id="treeview" style="height: 100px;padding: 5px;overflow: scroll;">
                                <div id="WB0201P01"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-10" style="padding-left: 0;">
                        <div class="contents" style="margin: 0; padding: 0;  width: 100%; min-width: 100px">
                            <h3 class="location">
                                <a class="file_tag" id="file_tag" style="font-weight: bold; color: blue; padding-left: 20px; padding-right: 10px;"></a>
                                <span class="page_tit" id="file_tit" style="text-align: right;"> 문서현황</span>
                            </h3>
                            <button disabled type="button" id="button_file" class="" style="  background-color: gray;height: 25px; line-height: 15px;" onclick="file.click();" authchk>첨부파일</button>
                            <div class="ax5_grid" data-ax5grid="file-grid" data-ax5grid-config="{}" style="height: 100px; width: 100%"></div>
                            </div>
                    </div>
                </div>
                 <!-- 첨부파일 리스트 END -->                
         </div>  
     <div class="popup_bottom_btn">
          <button type="button"  onclick="modalStack.close();">닫기</button>
     </div>
</div>   
    
<script type="text/javascript">

var paramFlag = modalStack.last().paramObj.flag;
var paramRpw = modalStack.last().paramObj.row;
var paramTreeObj = {};
var fileTreeKey; // 파일생성TreeKey



//실적상세테이블 그리드 초기화 영역
var wbsRsltsGridView = {
   initView: function(){
       this.target = new ax5.ui.grid();
       this.target.setConfig({
           showRowSelector: true,
           multipleSelect: false,
           sortable: true,
           target: $('[data-ax5grid="first-grid"]'),
           header: {
             align: "center",
             selector: false
           },
           body: {
               onClick: function () {
            	   if ($("#closeYn_S1").val() == "Y" || $("#lockYn_S1").val() == "Y") {
            	        alert("실적데이터가 잠김 또는 마감된 상태입니다.");
            	        return;
            	    }
                   this.self.select(this.dindex); 
               },
               onDBLClick: function () {
            	   if ($("#closeYn_S1").val() == "Y" || $("#lockYn_S1").val() == "Y") {
            	        alert("실적데이터가 잠김 또는 마감된 상태입니다.");
            	        return;
            	    }
                   this.self.clearSelect();
                   this.self.select(this.dindex);
               },
              
               onDataChanged: function () {
            	  if (this.item.wbsRsltsRate != undefined && this.item.wbsAssRate != undefined) {
                	   this.self.setValue(this.dindex, "wbsAssRateVal", Math.round(parseInt(this.item.wbsRsltsRate) * (parseInt(this.item.wbsAssRate) / 100)));
                	   umWbsAssRateVal();
                	   
                   }
                
                   if (this.item.wbsPlanMh != undefined) {
                       this.self.setValue(this.dindex, "wbsPlanMh", parseInt(this.item.wbsPlanMh));
                       umWbsAssRateVal();
                       
                   }
                   
                   if (this.item.wbsRsltsMh != undefined) {
                       this.self.setValue(this.dindex, "wbsRsltsMhVal", parseInt(this.item.wbsRsltsMh));
                       umWbsAssRateVal();
                       
                   }
            	   
                   
               },
          },
          columns: [
                {key: "rn",      label: "No.",      align: "center",   width: 60},
                {key: "wbsRsltsRate",      label: "진척율",  width: 100, align: "right", editor: {type: "text"}},
                {key: "wbsAssRate",  label: "가중치(%)",    width: 100,  align: "right", editor:  {type: "text"} },  
                {key: "wbsAssRateVal",      label: "가중치 합계(%)",    hidden: true},
                {key: "wbsRsltsCnts",      label: "실적내용", width: 200, align: "right", editor: {type: "text"}},
                {key: "wbsPlanMh",      label: "계획공수",   width: 100, align: "right", editor: {type: "text"}},
                {key: "wbsRsltsMh",      label: "실투입공수",  width: 100, align: "right", editor: {type: "text"}},
                {key: "wbsRsltsMhVal",      label: "공수합계",      hidden: true},
                {key: "lockYn",      label: "잠금여부",      width: 100, align: "center"},
                {key: "closeYn",      label: "마감여부",      width: 100, align: "center"}
                ]
       });

       return this;
     },
     
     setData: function() {
         var targetObj = this.target;
         var formData = {
             "coCd" : $("#coCd_S1").val(),
             "codeKind" : "WBSDIV",
             "codeId" : $("#wbsLevel1_S1").val(),
             "salesCd" : $("#salesCd_S1").val()
         }
         postAjax("/user/wb/wb02/selectWbsRsltsDetailList", formData, null, function(data){
             var list = data.resultList;
             if (list != undefined) {
	             targetObj.setData({
	                  list : list,
	                  page : {
	                      totalElements : list.length
	                  }
	              });
             }
         }); 
    } 
}

//공유 테이블 그리드 초기화 영역
var secondGridView1 = {
		   initView: function(){
		       this.target = new ax5.ui.grid();
		       this.target.setConfig({
		           showRowSelector: true,
		           multipleSelect: false,
		           sortable: true,
		           target: $('[data-ax5grid="second-grid1"]'),
		           header: {
		             align: "center",
		             selector: false
		           },
		           body: {
		               onClick: function () {
		                   this.self.select(this.dindex); 
		               },
		               onDBLClick: function () {
		                   this.self.clearSelect();
		                   this.self.select(this.dindex);
		               },
		          },
		          columns: [
		                {key: "rn",      label: "No.",      align: "center",   width: 60},
		                {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 130},
		                {key: "wbsRsltsPlanNo",      label: "관리번호",      align: "center",   width: 130},
		                {key: "wbsRsltsPlanCodeId",      label: "계획항목코드",      hidden: true},
		                {key: "wbsRsltsPlanCodeNm",      label: "LEVEL",      align: "center",   width: 130},
		                {key: "todoCfDt",      label: "확인일자",      align: "center",   width: 130},
		                {key: "todoCfOpn",      label: "확인의견",      align: "left",   width: 200},
		                {key: "wbsRsltsCoCd",      label: "회사",          hidden: true},
	                    {key: "wbsRsltsCoCdNm",      label: "회사명",      align: "center",   width: 130},
		                {key: "wbsSharngUserId",      label: "ID",      align: "center",   width: 130},
		                {key: "empNo",      label: "사원번호",      align: "center",   width: 130},
		                {key: "name",      label: "성명",      align: "center",   width: 130},
		                {key: "telNo",      label: "H.P",      align: "center",   width: 130},
		                {key: "email",      label: "E-Mail",      align: "center",   width: 200}
		                ]
		       });
		       return this;
		     },
		     setData: function() {
		         var targetObj = this.target;
		         var formData = {
		             "coCd" : $("#coCd_S1").val(),
		             "codeKind" : $("#wbsPlanCodeKind_S1").val(),
		             "codeId" : $("#wbsLevel1_S1").val(),
		             "salesCd" : $("#salesCd_S1").val()
		         }
		         postAjax("/user/wb/wb02/selectRsltsSharngList", formData, null, function(data){
		             var list = data.resultList;
		             targetObj.setData({
		                  list : list,
		                  page : {
		                      totalElements : list.length
		                  }
		              });
		             
		         }); 
		    } 
		}
		
		
//결재 테이블 그리드 초기화 영역
var secondGridView2 = {
        initView: function(){
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: true,
                multipleSelect: false,
                sortable: true,
                target: $('[data-ax5grid="second-grid2"]'),
                header: {
                  align: "center",
                  selector: false
                },
                body: {
                    onClick: function () {
                        this.self.select(this.dindex); 
                    },
                    onDBLClick: function () {
                        this.self.clearSelect();
                        this.self.select(this.dindex);
                    },
               },
               columns: [
                     {key: "rn",      label: "No.",      align: "center",   width: 60},
                     {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 130},
                     {key: "wbsRsltsPlanNo",      label: "관리번호",      align: "center",   width: 130}, 
                     {key: "wbsRsltsPlanCodeId",      label: "계획항목코드",      hidden: true},
                     {key: "wbsRsltsPlanCodeNm",      label: "LEVEL",      align: "center",   width: 130},
                     {key: "todoCfDt",      label: "확인일자",      align: "center",   width: 130},
                     {key: "todoCfOpn",      label: "확인의견",      align: "left",   width: 200},
                     {key: "wbsRsltsCoCd",      label: "회사",          hidden: true},
                     {key: "wbsRsltsCoCdNm",      label: "회사명",      align: "center",   width: 130},
                     {key: "wbsSharngUserId",      label: "ID",      align: "center",   width: 130},
                     {key: "empNo",      label: "사원번호",      align: "center",   width: 130},
                     {key: "name",      label: "성명",      align: "center",   width: 130},
                     {key: "telNo",      label: "H.P",      align: "center",   width: 130},
                     {key: "email",      label: "E-Mail",      align: "center",   width: 200}
                     ]
            });
            return this;
          },
          setData: function() {
              var targetObj = this.target;
              var formData = {
                  "coCd" : $("#coCd_S1").val(),
                  "codeKind" : $("#wbsPlanCodeKind_S1").val(),
                  "codeId" : $("#wbsLevel1_S1").val(),
                  "salesCd" : $("#salesCd_S1").val()
              }
              postAjax("/user/wb/wb02/selectRsltsApprovalList", formData, null, function(data){
                  var list = data.resultList;
                  
                  targetObj.setData({
                       list : list,
                       page : {
                           totalElements : list.length
                       }
                   });
                  
              }); 
         } 
     }

////////////////


$(document).ready(function() {  
	
	setCommonSelect($('#wbsPopup select[data-kind]'));

	$('#coCd_S1').val(jwt.coCd);
	$('#wbsPlanId_S1').val(jwt.userId);
	$('#wbsPlanNm_S1').val(jwt.userNm);
	$('#wbsPlanMngId_S1').val(jwt.userId);
    $('#wbsPlanMngNm_S1').val(jwt.userNm);    
    $('#wbsRsltsId_S1').val(jwt.userId);
    $('#wbsRsltsNm_S1').val(jwt.userNm);
    
    $('#wbsRsltsRate_S1').val(0);
    $('#wbsRsltsMh_S1').val(0);
    $('#wbsPlanMh_S1').val(0);
    
    
    
	var today = new Date();
    var strDate = today.getFullYear()+"-"+('0'+(today.getMonth()+1)).slice(-2)+"-"+('0'+today.getDate()).slice(-2);
    
	// 작성일 초기화
	$('#wbsPopup #wbsPlanDt_S1').datepicker({
        format : "yyyy-mm-dd",
        language : "ko",
        autoclose : true
	})
	.datepicker("setDate", strDate)

	 // 시작일자 (현재날짜의 월 첫일)
	$('#wbsPlansDt_S1').datepicker({
	          format : "yyyy-mm-dd",
	          language : "ko",
	          autoclose : true
	})
	.datepicker("setDate", strDate)
	.on("changeDate", function(){
	          if($('#wbsPlansDt_S1').val() > $('#wbsPlaneDt_S1').val()){
	                    alert("날짜를 확인해주세요");
	                    $('#wbsPlansDt_S1').datepicker("setDate", new Date($('#wbsPlaneDt_S1').val()));
	          }
	});
	
	// 종료일자 (현재날짜의 월 말일)
	$('#wbsPlaneDt_S1').datepicker({
	          format : "yyyy-mm-dd",
	          language : "ko",
	          autoclose : true
	})
	.datepicker("setDate", strDate)
	.on("changeDate", function(){
	          if($('#wbsPlansDt_S1').val() > $('#wbsPlaneDt_S1').val()){
	                    alert("날짜를 확인해주세요");
	                    $('#wbsPlaneDt_S1').datepicker("setDate", new Date($('#wbsPlansDt_S1').val()));
	          }
	});
	
	
	// 실적부분 작성자 현재 사용자로 초기화
	$('#wbsRsltsId_S1').val(jwt.userId);
    $('#wbsRsltsNm_S1').val(jwt.userNm);
	
	
    // 실적부분 실적일자 (현재날짜의 월 첫일)
    $('#wbsRsltsDt_S1').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
        
    // 실적부분 시작일자 (현재날짜의 월 첫일)
    $('#wbsRsltssDt_S1').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsRsltssDt_S1').val() > $('#wbsRsltseDt_S1').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsRsltssDt_S1').datepicker("setDate", new Date($('#wbsRsltseDt_S1').val()));
              }
    });
    
    // 실적부분 종료일자 (현재날짜의 월 말일)
   $('#wbsRsltseDt_S1').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsRsltssDt_S1').val() > $('#wbsRsltseDt_S1').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsRsltseDt_S1').datepicker("setDate", new Date($('#wbsRsltssDt_S1').val()));
              }
    });

    //////////////////////////////////////////////////////////////////////
      
	openFirstWbsLevel1Change();
    openFirstWbsPlanDivChange();
    openFirstWbsDsgnDifChange();
	openFirstWbsPrdctnDifChange();
	openFirstWbsPlanStsChange();

	var row;
	//debugger;
	if (paramFlag == "D") { 
		
		row = toDoGridView.target.getList()[paramRpw];
        if (row != undefined) {
        	var formData = {
                    "coCd" : row.wbsRsltsCoCd,
                    "codeKind" : row.wbsRsltsPlanCodeKind,
                    "codeId" : row.wbsRsltsPlanCodeId,	
                    "salesCd" : row.salesCd
                }
               
                postAjax("/user/wb/wb02/selectWbsPlanInfoSelect", formData, null, function(data){  
                	//debugger;
                	$("#coCd_S1").val(data.resultList[0].coCd); // 회사
                    $("#wbsPlanNo_S1").val(data.resultList[0].wbsPlanNo); // 관리번호
                    $("#wbsPlanDt_S1").val(data.resultList[0].wbsPlanDt); // 작성일자
                    $("#wbsPlanId_S1").val(data.resultList[0].wbsPlanId); // 작성자ID
                    $("#wbsPlanNm_S1").val(data.resultList[0].wbsPlanNm);// 작성자명
                    $("#salesCd_S1").val(data.resultList[0].salesCd); // Sales Code
                    $("#clntCd_S1").val(data.resultList[0].ordrsClntCd); // 고겍사ID
                    $("#clntNm_S1").val(data.resultList[0].ordrsClntNm); // 고객사명
                    $("#wbsClntPjt_S1").val(data.resultList[0].clntPjt); // 고객사PJT
                    $("#wbsPlanDiv_S1").val(data.resultList[0].ordrsDtlDiv20); // 신작구분
                    $("#wbsLevel1_S1").val(data.resultList[0].codeId); // 1Level WBS 구분
                    $("#wbsPlanMngId_S1").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                    $("#wbsPlanMngNm_S1").val(data.resultList[0].wbsPlanMngNm); //담당자명
                    $("#wbsPlansDt_S1").val(data.resultList[0].wbsPlansDt);// 시작일자
                    $("#wbsPlaneDt_S1").val(data.resultList[0].wbsPlaneDt); // 종료일자
                    $("#wbsPlanCnts_S1").val(data.resultList[0].wbsPlanCnts);// 주요내용
                    $("#wbsPlanRmk_S1").val(data.resultList[0].wbsPlanRmk);// 비고
                    $("#wbsPlanStsCodeId_S1").val(data.resultList[0].wbsPlanStsCodeId); //계획상태코드
                    $("#dsgnDifCodeId_S1").val(data.resultList[0].dsgnDifCodeId); // 설계난이도코드
                    $("#dsgnPlanHour_S1").val(data.resultList[0].dsgnPlanHour); // 설계계획공수
                    $("#prdctnDifCodeId_S1").val(data.resultList[0].prdctnDifCodeId); // 생산난이도코드
                    $("#prdctnPlanHour_S1").val(data.resultList[0].prdctnPlanHour); // 생산계획공수
                    if (data.resultList[0].wbsPlanOsYn == "Y"){ // 외주유무
                        $("#wbsPlanOsYn_Y_S1").prop('checked',true);
                        $("#wbsPlanOsYn_N_S1").prop('checked',false);
                    }
                    else{            
                        $("#wbsPlanOsYn_Y_S1").prop('checked',false);
                        $("#wbsPlanOsYn_N_S1").prop('checked',true);
                    } 
                    
                    var formData = {
                            "coCd" : $("#coCd_S1").val(),
                            "codeKind" : "WBSDIV",
                            "codeId" : $("#wbsLevel1_S1").val(),
                            "salesCd" : $("#salesCd_S1").val()
                        }
                       
                        postAjax("/user/wb/wb02/selectWbsRsltsMasterList", formData, null, function(data){
                            $("#fileTrgtKey_S1").val(data.resultList[0].fileTrgtKey);
                            $("#wbsRsltsNo_S1").val(data.resultList[0].wbsPlanNo);
                            $("#wbsRsltsDt_S1").val(data.resultList[0].wbsRsltsDt);// 실적일자  
                            $("#wbsRsltsId_S1").val(data.resultList[0].wbsRsltsId);//작성자 
                            $("#wbsRsltssDt_S1").val(data.resultList[0].wbsRsltssDt); //시작일자
                            $("#wbsRsltseDt_S1").val(data.resultList[0].wbsRsltseDt);//종료일자
                            $("#wbsRsltsRate_S1").val(data.resultList[0].wbsRsltsRate);//진척율
                            $("#wbsRsltsMh_S1").val(data.resultList[0].wbsRsltsMh);//실투입공수
                            $("#wbsRsltsCnts_S1").val(data.resultList[0].wbsRsltsCnts);//  주요내용
                            $("#wbsRsltsRmk_S1").val(data.resultList[0].wbsRsltsRmk); //비고
                            $("#closeYn_S1").val(data.resultList[0].closeYn); 
                            $("#lockYn_S1").val(data.resultList[0].lockYn); 
                           // debugger;
                            /* if (data.resultList[0].lockYn == "Y" || data.resultList[0].closeYn == "Y") {
                                $("#wbsRsltsDt_S1").prop('disabled',true);// 실적일자  
                                $("#wbsRsltsId_S1").prop('disabled',true);//작성자 
                                $("#wbsRsltssDt_S1").prop('disabled',true); //시작일자
                                $("#wbsRsltseDt_S1").prop('disabled',true);//종료일자
                                $("#wbsRsltsCnts_S1").prop('disabled',true);// 주요내용
                                $("#wbsRsltsRmk_S1").prop('disabled',true); //비고
                            }
                            else if (data.resultList[0].lockYn == "N" && data.resultList[0].closeYn == "N") {
                                $("#wbsRsltsDt_S1").prop('disabled',false);// 실적일자  
                                $("#wbsRsltsId_S1").prop('disabled',false);//작성자 
                                $("#wbsRsltssDt_S1").prop('disabled',false); //시작일자
                                $("#wbsRsltseDt_S1").prop('disabled',false);//종료일자
                                $("#wbsRsltsCnts_S1").prop('disabled',false);// 주요내용
                                $("#wbsRsltsRmk_S1").prop('disabled',false); //비고
                            } */
                        }); 
                    
                       //실적 상세 테이블 조회
                       wbsRsltsGridView.initView().setData();
                       
                       //공유 테이블 조회
                       secondGridView1.initView().setData();
                     
                       //결재 테이블 조회
                       secondGridView2.initView().setData();
                }); 
           }
	}
});



//WBS LEVEL 1 구분
function openFirstWbsLevel1Change() {
	var paramObj = {"codeKind" :""};
    postAjaxSync("/user/wb/wb01/selectWbsLevel1List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel1_S1"]').html(optionHtml);
    });
}




//관리번호 (WbsPlanNo) 검색
function openFirstWbsPlanNoSearch() {
    var paramObj = {
       "coCd" : $('#coCd_S1').val(),
       "salesCd": $('#salesCd_S1').val()
    };
    openThirdModal("/static/html/cmn/modal/wbsPlanNoSearch.html", 450, 270, "관리번호 검색", paramObj, function (grid){
        var row = grid.target.getList("selected")[0];
        $('#wbsPlanNo_S1').val(row.wbsPlanNo);
    });
}


//작성자 검색
function openFirstWbsPlanUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S1').val(),
        "userId": $('#wbsPopup #wbsPlanId_S1').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "작성자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup #wbsPlanId_S1').val(checkedNode.id);
        $('#wbsPopup #wbsPlanNm_S1').val(checkedNode.text);
    });
}


//실적 작성자 검색
function openFirstWbsPlanUserSearch_S1() {
    var paramObj = {
        "coCd" : $('#coCd_S1').val(),
        "userId": $('#wbsPopup #wbsPlanId_S1').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "작성자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup #wbsRsltsId_S1').val(checkedNode.id);
        $('#wbsPopup #wbsRsltsNm_S1').val(checkedNode.text);
    });
}


//담당자 검색
function openFirstWbsPlanMngUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S1').val(),
        "userId": $('#wbsPopup #wbsPlanId_S1').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup #wbsPlanMngId_S1').val(checkedNode.id);
        $('#wbsPopup #wbsPlanMngNm_S1').val(checkedNode.text);
    });
}


//Sales Code (수주마스터, 수주상세테이블 조인) 검색
function openFirstWbsSalesCodeSearch() {
    var paramObj = {
       "coCd" : $('#coCd_S1').val(),
       "salesCd": $('#salesCd_S1').val()
    };

    openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 330, "SALES CODE 검색", paramObj, function (grid){
        var row = grid.target.getList("selected")[0];
        $('#salesCd_S1').val(row.salesCd); // Sales Code
        $('#wbsClntPjt_S1').val(row.clntPjt); // 고객사 PJT
        $('#clntCd_S1').val(row.ordrsClntCd); // 고객사코드
        $('#clntNm_S1').val(row.ordrsClntNm); // 고객사명
        $("#wbsPlanDiv_S1").val(row.ordrsDtlDiv20); // 신작구분

    });
    
}


// 고객사 검색
function openFirstClntSearch(type) {
    openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "고객사 검색", {}, function (grid) {
        var row = grid.target.getList("selected")[0];
        $('#wbsPopup #clntCd_S1').val(row.clntCd);
        $('#wbsPopup #clntNm_S1').val(row.clntNm);
    });
}

//신작구분
function openFirstWbsPlanDivChange() {
	var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsPlanDivList", paramObj, null, function(data){
    	//debugger;
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="wbsPlanDiv"]').html(optionHtml);
    });
}

//설계난이도 구분//DSGN_DIF_CODE_ID
function openFirstWbsDsgnDifChange() {
    var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsDsgnDifList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        optionHtml += '<option value=>';
        optionHtml += '</option>';
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="dsgnDifCodeId"]').html(optionHtml);
    });
}

//생산난이도 구분 PRDCTN_DIF_CODE_ID
function openFirstWbsPrdctnDifChange() {
    //DSGN_DIF_CODE_ID
    var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsPrdctnDifList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        optionHtml += '<option value=>';
        optionHtml += '</option>';
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="prdctnDifCodeId"]').html(optionHtml);
    });
}


// WBS 계획상태  WBS_PLAN_STS_CODE_ID
function openFirstWbsPlanStsChange() {
    //DSGN_DIF_CODE_ID
    var paramObj = {"codeKind" : "WBSPLANSTS"};
    postAjaxSync("/user/wb/wb01/selectWbsPlanStsList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="wbsPlanStsCodeId"]').html(optionHtml);
    });
}

//공유대상자 삭제
function openFirstWbsSharngUserDelete() {
	var row = wbsInsPop01GridView.target.getList("selected")[0];
	if (row == null) {
		alert("삭제할 행을 선택하세요");
		return;
	}
	
    var formData = {
        "coCd" : row.coCd,
        "salesCd" : row.salesCd,
        "wbsPlanNo" : row.wbsPlanNo,
        "wbsPlanCodeId" : row.wbsPlanCodeId,
        "id" : row.id 
    }
    if(confirm("삭제하시겠습니까?")){
        deleteAjax("/user/wb/wb01/deleteWbsSharngUser", formData, null, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                wbsInsPop01GridView.initView().setData(); 
            }
        });
    }   
}

function umWbsAssRateVal() {
	//debugger;
    var rowList = wbsRsltsGridView.target.getList();
    var sumWbsAssRate = 0;
    var sumWbsPlanMh = 0;
    var sumWbsRsltsMh = 0;
    $.each(rowList, function(idx, elem){
    	//debugger;
        sumWbsAssRate = parseInt(sumWbsAssRate) + parseInt(elem.wbsAssRateVal); 
        sumWbsPlanMh = parseInt(sumWbsPlanMh) + parseInt(elem.wbsPlanMh);
        sumWbsRsltsMh = parseInt(sumWbsRsltsMh) + parseInt(elem.wbsRsltsMh); 
    });
    $('#wbsRsltsRate_S1').val(sumWbsAssRate);
    $('#wbsPlanMh_S1').val(sumWbsPlanMh);
    $('#wbsRsltsMh_S1').val(sumWbsRsltsMh);
}

function rsltsLevel1Insert() {
	
	 umWbsAssRateVal();
	 if (paramFlag == "I") { // 실적등록
        if ($('#wbsRsltsId_S1').val() == "") {
            alert("작성자를 입력하세요");
            return;
        }
    
        if ($('#wbsRsltsCnts_S1').val() == "") {
            alert("주요내용을 입력하세요");
            return;
        }
       // debugger;
        var formData = new FormData();
        
        //파일 fileTrgtKey키 생성
        if ($("#fileTrgtKey_S1").val() == "" || $("#fileTrgtKey_S1").val() == undefined) {
        	var paramObj = {"coCd" : $('#coCd_S1').val()};
	        postAjaxSync("/user/wb/wb02/selectMaxTrgtKey", paramObj, null, function(data){    
	        	//debugger;
	        	fileTreeKey = data.result;
	        	$("#fileTrgtKey_S1").val(fileTreeKey);
	        	//alert(fileTreeKey);
	            //formData.append("fileTrgtKey", fileTreeKey);
	        }); 
        }
        
        var strYear = new Date().toISOString().substring(2, 4);
        var planData = {
                "coCd" : $('#coCd_S1').val(),
                "year" : "W" + strYear
            }; 
         postAjaxSync("/user/wb/wb02/selectMaxWbsPlanNo", planData, null, function(data){
            var strLen = String(data.result);
            //alert(data.result);
            if (data.result == undefined || data.result == "") {
                $('#wbsRsltsNo_S1').val("W" + strYear + "0001");
            }
            else {
                if (strLen.length == 1) {
                    $('#wbsRsltsNo_S1').val("W" + strYear + "000" + data.result); 
                    }
                else if (strLen.length == 2) {
                    $('#wbsRsltsNo_S1').val("W" + strYear + "00" + data.result); 
                }
                else if (strLen.length == 3) {
                    $('#wbsRsltsNo_S1').val("W" + strYear + "0" + data.result); 
                }
                else if (strLen.length == 4) {
                    $('#wbsRsltsNo_S1').val("W" + strYear + data.result); 
                }
            }
            
        }); 
        //alert( $('#wbsRsltsNo_S1').val());
         
         
         $.each($('#wbsPopup [data-search]'), function(idx, elem){
             formData.append($(elem).data("search"), $(elem).val());
         });
         
         formData.append("creatPgm", $('#creatPgm').val());
         // 실적 공유테이블 TODO CODE_ID
         formData.append("S_todoDiv1CodeId", "TODODIV10");
         formData.append("S_todoDiv2CodeId", "TODODIV1020");
          // 실적 결재테이블 TODO CODE_ID
         formData.append("A_todoDiv1CodeId", "TODODIV20");
         formData.append("A_todoDiv2CodeId", "TODODIV2010");
         
         
         //debugger;
         formData.append("creatId", jwt.userId);     
         formData.append("userId", jwt.userId);
         
         // 실적리스트 정리
        var rowRsltsList = wbsRsltsGridView.target.list;
        if(rowRsltsList.length > 0) {
        	var rowRsltsListArr = [];
            
            $.each(rowRsltsList, function(idx, elem){
                var rowRsltsListObj = elem;
                //debugger;
                rowRsltsListObj["wbsRsltsRate"] = elem.wbsRsltsRate;
                rowRsltsListObj["wbsAssRate"] =  elem.wbsAssRate;
                if (elem.wbsRsltsCnts == undefined) {
                	rowRsltsListObj["wbsRsltsCnts"] = " ";
                }
                else {
                	rowRsltsListObj["wbsRsltsCnts"] = elem.wbsRsltsCnts;
                }
                
                rowRsltsListObj["wbsPlanMh"] =  elem.wbsPlanMh;  
                rowRsltsListObj["wbsRsltsMh"] =  elem.wbsRsltsMh; 
                rowRsltsListObj["lockYn"] =  elem.lockYn; 
                rowRsltsListObj["closeYn"] =  elem.closeYn; 
                rowRsltsListArr.push(rowRsltsListObj);           
            });
            
            formData.append("rowRsltsListArr", JSON.stringify(rowRsltsListArr));
        }       
        
        // 공유대상자 리스트
        var rowSharngList = secondGridView1.target.list;
        if(rowSharngList.length > 0) {
        	var rowSharngListArr = [];
            $.each(rowSharngList, function(idx, elem){
                var rowSharngListObj = elem;
                rowSharngListObj["coCd"] = $("#coCd_S1").val();
                rowSharngListObj["salesCd"] = elem.salesCd;
                rowSharngListObj["wbsRsltsPlanNo"] = $("#wbsRsltsNo_S1").val();
                rowSharngListObj["wbsRsltsPlanCodeId"] = elem.wbsRsltsPlanCodeId;
                rowSharngListObj["wbsRsltsPlanCodeNm"] = elem.wbsRsltsPlanCodeNm;
                rowSharngListObj["todoCfDt"] = elem.todoCfDt;
                rowSharngListObj["todoCfOpn"] = elem.todoCfOpn;
                rowSharngListObj["wbsRsltsCoCd"] = elem.wbsRsltsCoCd;
                rowSharngListObj["wbsRsltsCoCdNm"] = elem.wbsRsltsCoCdNm;
                rowSharngListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
                rowSharngListObj["empNo"] = elem.empNo;
                rowSharngListObj["name"] = elem.name;
                rowSharngListObj["telNo"] = elem.telNo;
                rowSharngListObj["email"] = elem.email;    
                rowSharngListObj["pgPath"] = "/user/wb/wb20/WB2001P04.html";
                rowSharngListArr.push(rowSharngListObj);
            });
            formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));
        }       
        
        
        // 결재대상자 리스트
        var rowApprovalList = secondGridView2.target.list;
        if(rowApprovalList.length > 0) {
        	var rowApprovalListArr = [];
            $.each(rowApprovalList, function(idx, elem){
                var rowApprovalListObj = elem;
                rowApprovalListObj["salesCd"] = elem.salesCd;
                rowApprovalListObj["wbsRsltsPlanNo"] = $("#wbsRsltsNo_S1").val();
                rowApprovalListObj["wbsRsltsPlanCodeId"] = elem.wbsRsltsPlanCodeId;
                rowApprovalListObj["wbsRsltsPlanCodeNm"] = elem.wbsRsltsPlanCodeNm;
                rowApprovalListObj["todoCfDt"] = elem.todoCfDt;
                rowApprovalListObj["todoCfOpn"] = elem.todoCfOpn;
                rowApprovalListObj["wbsRsltsCoCd"] = elem.wbsRsltsCoCd;
                rowApprovalListObj["wbsRsltsCoCdNm"] = elem.wbsRsltsCoCdNm;
                rowApprovalListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
                rowApprovalListObj["empNo"] = elem.empNo;
                rowApprovalListObj["name"] = elem.name;
                rowApprovalListObj["telNo"] = elem.telNo;
                rowApprovalListObj["email"] = elem.email;    
                rowApprovalListObj["pgPath"] = "/user/wb/wb20/WB2001P07.html";
                rowApprovalListArr.push(rowApprovalListObj);
                
            });
            formData.append("rowApprovalListArr", JSON.stringify(rowApprovalListArr));
        }       
    }
    else if (paramFlag == "U") { // 수정
         if ($('#wbsRsltsId_S1').val() == "") {
             alert("작성자를 입력하세요");
             return;
         }
     
         if ($('#wbsRsltsCnts_S1').val() == "") {
             alert("주요내용을 입력하세요");
             return;
         }
         
         var formData = new FormData();
         $.each($('#wbsPopup [data-search]'), function(idx, elem){
             formData.append($(elem).data("search"), $(elem).val());
         });
         
         formData.append("creatId", jwt.userId);     
         formData.append("userId", jwt.userId);
          
         formData.append("creatPgm", $('#creatPgm').val());
         // 실적 공유테이블 TODO CODE_ID
         formData.append("S_todoDiv1CodeId", "TODODIV10");
         formData.append("S_todoDiv2CodeId", "TODODIV1020");
          // 실적 결재테이블 TODO CODE_ID
         formData.append("A_todoDiv1CodeId", "TODODIV20");
         formData.append("A_todoDiv2CodeId", "TODODIV2020");
 
          // 실적리스트 정리
         var rowRsltsList = wbsRsltsGridView.target.list;
         if(rowRsltsList.length > 0) {
             var rowRsltsListArr = [];
             
             $.each(rowRsltsList, function(idx, elem){
                 var rowRsltsListObj = elem;
                 //debugger;
                 rowRsltsListObj["wbsRsltsRate"] = elem.wbsRsltsRate;
                 rowRsltsListObj["wbsAssRate"] =  elem.wbsAssRate;
                 if (elem.wbsRsltsCnts == undefined) {
                     rowRsltsListObj["wbsRsltsCnts"] = " ";
                 }
                 else {
                     rowRsltsListObj["wbsRsltsCnts"] = elem.wbsRsltsCnts;
                 }
                 rowRsltsListObj["wbsPlanMh"] =  elem.wbsPlanMh;  
                 rowRsltsListObj["wbsRsltsMh"] =  elem.wbsRsltsMh; 
                 rowRsltsListObj["lockYn"] =  elem.lockYn; 
                 rowRsltsListObj["closeYn"] =  elem.closeYn; 
                 rowRsltsListArr.push(rowRsltsListObj);           
             });
             
             formData.append("rowRsltsListArr", JSON.stringify(rowRsltsListArr));
         }       
         
         // 공유대상자 리스트
         var rowSharngList = secondGridView1.target.list;
         if(rowSharngList.length > 0) {
             var rowSharngListArr = [];
             $.each(rowSharngList, function(idx, elem){
                 var rowSharngListObj = elem;
                 rowSharngListObj["coCd"] = $("#coCd_S1").val();
                 rowSharngListObj["salesCd"] = elem.salesCd;
                 rowSharngListObj["wbsRsltsPlanNo"] = $("#wbsRsltsNo_S1").val();
                 rowSharngListObj["wbsRsltsPlanCodeId"] = elem.wbsRsltsPlanCodeId;
                 rowSharngListObj["wbsRsltsPlanCodeNm"] = elem.wbsRsltsPlanCodeNm;
                 rowSharngListObj["todoCfDt"] = elem.todoCfDt;
                 rowSharngListObj["todoCfOpn"] = elem.todoCfOpn;
                 rowSharngListObj["wbsRsltsCoCd"] = elem.wbsRsltsCoCd;
                 rowSharngListObj["wbsRsltsCoCdNm"] = elem.wbsRsltsCoCdNm;
                 rowSharngListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
                 rowSharngListObj["empNo"] = elem.empNo;
                 rowSharngListObj["name"] = elem.name;
                 rowSharngListObj["telNo"] = elem.telNo;
                 rowSharngListObj["email"] = elem.email;    
                 rowSharngListObj["pgPath"] = "/user/wb/wb20/WB2001P04.html";
                 rowSharngListArr.push(rowSharngListObj);
             });
             formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));
         }       
         
         
         // 결재대상자 리스트
         var rowApprovalList = secondGridView2.target.list;
         if(rowApprovalList.length > 0) {
             var rowApprovalListArr = [];
             $.each(rowApprovalList, function(idx, elem){
                 var rowApprovalListObj = elem;
                 rowApprovalListObj["salesCd"] = elem.salesCd;
                 rowApprovalListObj["wbsRsltsPlanNo"] = $("#wbsRsltsNo_S1").val();
                 rowApprovalListObj["wbsRsltsPlanCodeId"] = elem.wbsRsltsPlanCodeId;
                 rowApprovalListObj["wbsRsltsPlanCodeNm"] = elem.wbsRsltsPlanCodeNm;
                 rowApprovalListObj["todoCfDt"] = elem.todoCfDt;
                 rowApprovalListObj["todoCfOpn"] = elem.todoCfOpn;
                 rowApprovalListObj["wbsRsltsCoCd"] = elem.wbsRsltsCoCd;
                 rowApprovalListObj["wbsRsltsCoCdNm"] = elem.wbsRsltsCoCdNm;
                 rowApprovalListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
                 rowApprovalListObj["empNo"] = elem.empNo;
                 rowApprovalListObj["name"] = elem.name;
                 rowApprovalListObj["telNo"] = elem.telNo;
                 rowApprovalListObj["email"] = elem.email;    
                 rowApprovalListObj["pgPath"] = "/user/wb/wb20/WB2001P07.html";
                 rowApprovalListArr.push(rowApprovalListObj);
                 
             });
             formData.append("rowApprovalListArr", JSON.stringify(rowApprovalListArr));
         } 
    }
    
   // debugger;
    var paramObj = {
            "coCd" : $('#coCd_S1').val(),
            "salesCd" : $('#salesCd_S1').val(),
            "codeId" : $('#wbsLevel1_S1').val()
      };    
    var chk;
    postAjaxSync("/user/wb/wb02/selectWbsPlanChk", paramObj, null, function(data){ 
        chk = data.result;
    });
    
    //debugger;
    if (chk == undefined) {
    	filePostAjax("/user/wb/wb02/wbsLevel1RsltsInsert", formData, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                modalStack.close();
                gridView1.setData(0); 
                gridView2.setData(0);
            }
        });      	
    }
    else {
    	filePutAjax("/user/wb/wb02/wbsLevel1RsltsUpdate", formData, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                modalStack.close();
                gridView1.setData(0);
                gridView2.setData(0); 
            }
        });        
    }    
}
