<div id="wbsPopup3" class="popup_area of_a" style="width: 100%; height: 100%;">
	<div class="tit_contents">
	    <h4 class="tit">WBS Level 3 실적 결재</h4>
	</div>
	
	<div class="popup_table">
		<div class="form-group">
			<form id="popForm3">
			<input type="hidden" name="creatPgm3" id="creatPgm3" data-search="creatPgm" value="WB2001P09">
			<input type="hidden" name="todoKey_S3" id="todoKey_S3">
			<input type="hidden" name="fileTrgtKey_S3" data-search="fileTrgtKey" id="fileTrgtKey_S3">
		        <table class="popup_table">
					<colgroup>
					     <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="6%">
					</colgroup>
					
					<thead>
						<tr>
						   <td colspan="9" style="height:30px;text-align: left;">기본정보(3레벨화면)</td>	                                              
						</tr>
					</thead>
					
					<tbody>
						<!-- 1행 -->
						<tr>
							<th class="hit">회사</th>
							<td>
								<select class="form-control input-sm" id="coCd_S3" data-kind="CO" data-search="coCd"  required="required" disabled>
                                   <!-- <option value="">전체</option> -->
                                </select>
							</td>
							<th>관리번호</th>
							<td>
								<div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsPlanNo_S3" name="wbsPlanNo_S3"  data-search="wbsPlanNo" required="required" disabled>
                                </div>
							</td>
							<th class="hit">작성일자</th>
							<td>
	                            <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlanDt_S3" name="wbsPlanDt_S3" data-search="wbsPlanDt" autocomplete="off" msg="작성일자" date required disabled>
                                </div>
							</td>
							<th class="hit">작성자</th>
							<td>
								<div class="search_form">
                                    <input type="hidden" id="wbsPlanId_S3" name="wbsPlanId_S3" data-search="wbsPlanId">
                                    <input type="text" id="wbsPlanNm_S3" name="wbsPlanNm_S3" data-search="wbsPlanNm" msg="작성자" onkeyUp="if(window.event.keyCode == 8){wbsPlanId_S3.value = ''};" readonly required disabled>
                                    
                                </div>
							</td>
							<th rowspan="6" style="vertical-align:top;">
                                
                            </th>
						</tr>
						             
						<!-- 2행 -->
						 <tr>
						    <th>Sales Code</th>
						    <td>
							    <div class="search_form" style="width: 100%;">
                                    <input type="text" class="form-control input-sm" id="salesCd_S3" data-search="salesCd" disabled>
                                    
                                </div>
						    </td>
						    <th  class="hit">고객사</th>
						    <td>
								<div class="search_form">
                                    <input type="hidden" id="clntCd_S3" name="clntCd_S3" msg="고객사" data-search="clntCd">
                                    <input type="text" class="form-control input-sm" id="clntNm_S3" data-search="clntNm" readonly msg="고객사" required disabled>
                                   
                                </div>
						    </td>
						    <th>고객사PJT</th>
						    <td>
						         <input type="text" class="form-control input-sm" id="wbsClntPjt_S3"  data-search="clntPjt" disabled>
						    </td>
						    <th class="hit">신작구분</th>
						    <td>
						        <select id="wbsPlanDiv_S3" name="wbsPlanDiv_S3" data-kind="wbsPlanDiv_S3" data-search="wbsPlanDiv" disabled>
						        <option value="">선택</option>
                                </select>
						    </td>
						</tr>
						
						 <!-- 3행 -->
						 <tr>
						    <th class="hit">Lv.1</th>
						    <td>
						          <select id="wbsLevel1_S3" name="wbsLevel1_S3" data-kind="wbsLevel1_S3" data-search="wbsPlanCodeId0" onchange="openThirdWbsLevel2Change();openThirdWbsLevel3Change();" disabled>
                                     <option value="">선택</option>
                                  </select>
						    </td>
						    <th>담당자</th>
						    <td>
						        <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId_S3_1" name="wbsPlanMngId_S3_1" data-search="wbsPlanMngId">
                                    <input type="text" id="wbsPlanMngNm_S3_1" name="wbsPlanMngNm_S3_1" msg="담당자" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId_S3_1.value = ''};" readonly required disabled>
                                </div>
						    </td>
						    <th class="hit">시작일자</th>
						    <td>
						        <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt_S3_1" data-search="wbsPlansDt"  "autocomplete="off" date disabled>
                                </div>
						    </td>
						    <th class="hit">종료일자</th>
						    <td>
							    <div class="date_input">
	                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt_S3_1" data-search="wbsPlaneDt"  autocomplete="off" date disabled>
	                            </div>
						    </td>
						</tr>
						<!-- 4행 -->
                         <tr>
                            <th class="hit">Lv.2</th>
                            <td>
                                <select id="wbsLevel2_S3" name="wbsLevel2_S3" data-kind="wbsLevel2_S3" data-search="wbsPlanCodeKind" onchange="openThirdWbsLevel3Change();" disabled>
                                   <option value="">선택</option>
                                </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId_S3_2" name="wbsPlanMngId_S3_2" data-search="wbsPlanMngId2">
                                    <input type="text" id="wbsPlanMngNm_S3_2" name="wbsPlanMngNm_S3_2" msg="담당자" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId_S3_2.value = ''};" readonly required disabled>
                                    
                                </div>
                            </td>
                            <th class="hit">시작일자</th>
                            <td>
	                            <div class="date_input">
	                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt_S3_2" data-search="wbsPlansDt2"  "autocomplete="off" date disabled>
	                            </div>
                            </td>
                            <th class="hit">종료일자</th>
                            <td>
	                            <div class="date_input">
	                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt_S3_2" data-search="wbsPlaneDt2"  autocomplete="off" date disabled>
	                            </div>
                            </td>
                        </tr>
                        <!-- 5행 -->
                         <tr>
                            <th class="hit">Lv.3</th>
                            <td>
		                        <select id="wbsLevel3_S3" name="wbsLevel3_S3" data-kind="wbsLevel3_S3" data-search="wbsPlanCodeId" disabled>
                                    <option value="">선택</option>
                                </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId_S3_3" name="wbsPlanMngId_S3_3" data-search="wbsPlanMngId3">
                                    <input type="text" id="wbsPlanMngNm_S3_3" name="wbsPlanMngNm_S3_3" msg="담당자" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId_S3_3.value = ''};" readonly required disabled>
                                    
                                </div>
                            </td>
                            <th class="hit">시작일자</th>
                            <td>
	                            <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt_S3_3" data-search="wbsPlansDt3"  "autocomplete="off" date disabled>
	                            </div>
                            </td>
                            <th class="hit">종료일자</th>
                            <td>
	                            <div class="date_input">
	                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt_S3_3" data-search="wbsPlaneDt3"  autocomplete="off" date disabled>
	                                </div>
                            </td>
                        </tr>
						
						<!-- 6행 -->
						 <tr>
						    <th class="hit">주요내용</th>
						    <td colspan=3>
						           <input type="text" id="wbsPlanCnts_S3" data-search="wbsPlanCnts" disabled>
						    </td>
						    <th>비고</th>
						    <td colspan=3>
						            <input type="text" id="wbsPlanRmk_S3" data-search="wbsPlanRmk" disabled>
						    </td>
						</tr>
						
						<!-- 7행 -->
						 <tr>
                            <th>외주여부</th>
                            <td>
                                <input type=radio id="wbsPlanOsYn_Y_S3" name="wbsPlanOsYn_Y_S3" value="Y" data-search="wbsPlanOsYn_Y" disabled>Y &ensp; &ensp; &ensp; &ensp; 
                                <input type=radio id="wbsPlanOsYn_N_S3" name="wbsPlanOsYn_N_S3" value="N" data-search="wbsPlanOsYn_N" checked disabled>N <br>
                            </td>
                            <th>계획상태</th>
                            <td>
                                <select id="wbsPlanStsCodeId_S3" name="wbsPlanStsCodeId_S3" data-kind="wbsPlanStsCodeId_S3" data-search="wbsPlanStsCodeId" disabled>
                                    <option value="">선택</option>
                                </select>
                            </td>
                            
                         </tr>
				    </tbody>
				    <thead>
                        <tr>
                           <td colspan="9" style="height:30px;text-align: left;">결과정보</td>                                                
                        </tr>
                    </thead>
                    <tbody>
                          <!-- 1행 -->
                         <tr>
                            <th>실적번호</th>
                            <td>
                                <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsNo_S3" name="wbsRsltsNo_S3"  required="required" data-search="wbsRsltsNo" disabled>
                                </div>
                            </td>
                            <th>실적일자</th>
                            <td>
                                    <div class="date_input">
                                    <input type="text" class="input_calendar" data-search="wbsRsltsDt" style="width: 100% !important; display: inline-block !important;" id="wbsRsltsDt_S3" name="wbsRsltsDt_S3" autocomplete="off" msg="실적일자" date required disabled>
                                </div>
                            </td>
                            <th>작성자</th>
                            <td>
                               <div class="search_form">
                                    <input type="hidden" id="wbsRsltsId_S3" name="wbsRsltsId_S3" data-search="wbsRsltsId">
                                    <input type="text" id="wbsRsltsNm_S3" name="wbsRsltsNm_S3" msg="작성자" data-search="wbsRsltsNm" onkeyUp="if(window.event.keyCode == 8){wbsRsltsId_S3.value = ''};" readonly required disabled>
                                </div>
                            </td>
                            <th></th>
                            <td>
                              
                            </td>
                        </tr>
                        <!-- 2행 -->
                         <tr>
                            <th>시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" data-search="wbsRsltssDt" style="width: 100% !important; display: inline-block !important;" id="wbsRsltssDt_S3" name="wbsRsltssDt_S3" autocomplete="off" msg="시작일자" date required disabled>
                                </div>
                            </td>
                            <th>종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" data-search="wbsRsltseDt" style="width: 100% !important; display: inline-block !important;" id="wbsRsltseDt_S3" name="wbsRsltseDt_S3" autocomplete="off" msg="종료일자" date required disabled>
                                </div>
                            </td>
                            <th>진척율</th>
                            <td>
                               <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsRate_S3" name="wbsRsltsRate_S3"  required="required" data-search="wbsRsltsRate" disabled>
                                </div>
                            </td>
                            <th>실투입공수</th>
                            <td>
                              <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsMh_S3" name="wbsRsltsMh_S3"  required="required" data-search="wbsRsltsMh" disabled>
                                   <input type="hidden"  id="wbsPlanMh_S3" name="wbsPlanMh_S3"  required="required" data-search="wbsPlanMh" disabled>
                                </div>
                            </td>
                        </tr>
                        <!-- 3행 -->
                       <tr>
                            <th>주요내용</th>
                            <td colspan=3>
                                    <input type="text" id="wbsRsltsCnts_S3" data-search="wbsRsltsCnts" disabled> 
                            </td>
                            <th>비고</th>
                            <td colspan=3>
                                    <input type="text" id="wbsRsltsRmk_S3" data-search="wbsRsltsRmk" disabled>
                                    <input type="hidden" id="closeYn_S3">
                                    <input type="hidden" id="lockYn_S3">
                            </td>
                        </tr>  
                        <!-- 4행 -->
                        <tr>
                            <th  class="hit">결재일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" data-search="todoCfDt" style="width: 100% !important; display: inline-block !important;" id="todoCfDt_S3" name="todoCfDt_S3" autocomplete="off" msg="결재일자" date required>
                                </div>
                            </td>
                            <th>결재의견</th>
                            <td colspan=5>
                                <div class="date_input">
                                    <input type="text" id="todoCfOpn_S3" data-search="todoCfOpn"> 
                                </div>
                            </td>
                        </tr>
                    </tbody>       
				    
		        </table>	
			</form>
		</div>
	</div>
	<div class="popup_table">               
        <table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※실적상세</td>
                <td >
                </td>
            </tr>
        </table>
    </div> 
	<div class="contents">
        <!-- 실적상세 리스트 -->
        <div data-ax5grid="first-grid_S3" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
    </div>
    <div class="popup_table">               
        <table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※공유 대상자</td>
                <td style="text-align:right;">
                </td>
                <td style="text-align: LEFT; border-right: 0px;">※결재 대상자</td>
                <td style="text-align:right;">
                </td>
                
            </tr>
            <tr>
                <td colspan="2" style="text-align: LEFT; border-right: 0px;">
                   <div data-ax5grid="second-grid1_S3" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
                </td>
                 <td colspan="2" style="text-align: LEFT; border-right: 0px;">
                 <div data-ax5grid="second-grid2_S3" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
                </td>                
            </tr>
        </table>
                    <!-- 공유대상자 리스트 -->
              
    </div>

    <div class="contents">
                <!-- 첨부파일 리스트 -->
                <div class="row" style="margin-top: 15px;margin-bottom:40px;">
                    <div class="col-xs-2" style="padding-right: 5px;">
                        <div class="contents" style="margin: 0; padding: 0;width: 100%; min-width: 100px">
                            <h3 class="location">
                                <span class="page_tit" style="text-align: left;"> 파일트리</span>
                            </h3>
                            <div id="treeview" style="height: 100px;padding: 5px;overflow: scroll;">
                                <div id="WB0201P03"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-10" style="padding-left: 0;">
                        <div class="contents" style="margin: 0; padding: 0;  width: 100%; min-width: 100px">
                            <h3 class="location">
                                <a class="file_tag" id="file_tag" style="font-weight: bold; color: blue; padding-left: 20px; padding-right: 10px;"></a>
                                <span class="page_tit" id="file_tit" style="text-align: right;"> 문서현황</span>
                            </h3>
                            <button disabled type="button" id="button_file" class="" style="  background-color: gray;height: 25px; line-height: 15px;" onclick="file.click();" authchk>첨부파일</button>
                            <div class="ax5_grid" data-ax5grid="file-grid_S3" data-ax5grid-config="{}" style="height: 100px; width: 100%"></div>
                            </div>
                    </div>
                </div>
                 <!-- 첨부파일 리스트 END -->                
         </div>  
     <div class="popup_bottom_btn">
          <button type="button" id="actionBtn" onclick="updateRsltsApproval();" authchk>결재</button>
          <button type="button"  onclick="modalStack.close();">닫기</button>
     </div>		
</div>
    
<script type="text/javascript">
var paramFlag = modalStack.last().paramObj.flag;
var paramRpw = modalStack.last().paramObj.row;
var paramTreeObj = {};
var fileTreeKey; // 파일생성TreeKey


/////////////////////////////////////////////////////////////////////////////////
//실적상세테이블 그리드 초기화 영역
var wbsRsltsGridView_S3 = {
 initView: function(){
     this.target = new ax5.ui.grid();
     this.target.setConfig({
         showRowSelector: true,
         multipleSelect: false,
         sortable: true,
         target: $('[data-ax5grid="first-grid_S3"]'),
         header: {
           align: "center",
           selector: false
         },
         body: {
             onClick: function () {
            	 if ($("#closeYn_S3").val() == "Y" || $("#lockYn_S3").val() == "Y") {
                     alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                     return;
                 }
                 this.self.select(this.dindex); 
             },
             onDBLClick: function () {
            	 if ($("#closeYn_S3").val() == "Y" || $("#lockYn_S3").val() == "Y") {
                     alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                     return;
                 }
                 this.self.clearSelect();
                 this.self.select(this.dindex);
             },
            
             onDataChanged: function () {
                 if (this.item.wbsRsltsRate != undefined && this.item.wbsAssRate != undefined) {
                     this.self.setValue(this.dindex, "wbsAssRateVal", Math.round(parseInt(this.item.wbsRsltsRate) * (parseInt(this.item.wbsAssRate) / 100)));
                     umWbsAssRateVal_S3();
                     
                 }
              
                 if (this.item.wbsPlanMh != undefined) {
                     this.self.setValue(this.dindex, "wbsPlanMh", parseInt(this.item.wbsPlanMh));
                     umWbsAssRateVal_S3();
                     
                 }
                 
                 if (this.item.wbsRsltsMh != undefined) {
                     this.self.setValue(this.dindex, "wbsRsltsMhVal", parseInt(this.item.wbsRsltsMh));
                     umWbsAssRateVal_S3();
                     
                 }
                 
                 
             },
        },
        columns: [
              {key: "rn",      label: "No.",      align: "center",   width: 60},
              {key: "wbsRsltsRate",      label: "진척율",  width: 100, align: "right", editor: {type: "text"}},
              {key: "wbsAssRate",  label: "가중치(%)",    width: 100,  align: "right", editor:  {type: "text"} },  
              {key: "wbsAssRateVal",      label: "가중치 합계(%)",    hidden: true},
              {key: "wbsRsltsCnts",      label: "실적내용", width: 200, align: "right", editor: {type: "text"}},
              {key: "wbsPlanMh",      label: "계획공수",   width: 100, align: "right", editor: {type: "text"}},
              {key: "wbsRsltsMh",      label: "실투입공수",  width: 100, align: "right", editor: {type: "text"}},
              {key: "wbsRsltsMhVal",      label: "공수합계",      hidden: true},
              {key: "lockYn",      label: "잠금여부",      width: 100, align: "center"},
              {key: "closeYn",      label: "마감여부",      width: 100, align: "center"}
              ]
     });
     
     return this;
   },
   
   setData: function() {
       var targetObj = this.target;
       var formData = {
           "coCd" : $("#coCd_S3").val(),
           "codeKind" : $("#wbsLevel2_S3").val(),
           "codeId" : $("#wbsLevel3_S3").val(),
           "salesCd" : $("#salesCd_S3").val()
       }
       postAjax("/user/wb/wb02/selectWbsRsltsDetailList", formData, null, function(data){
           var list = data.resultList;
           if (list != undefined) {
               targetObj.setData({
                    list : list,
                    page : {
                        totalElements : list.length
                    }
                });
           }
       }); 
  } 
}

//공유 테이블 그리드 초기화 영역
var secondGridView1_S3 = {
         initView: function(){
             this.target = new ax5.ui.grid();
             this.target.setConfig({
                 showRowSelector: true,
                 multipleSelect: false,
                 sortable: true,
                 target: $('[data-ax5grid="second-grid1_S3"]'),
                 header: {
                   align: "center",
                   selector: false
                 },
                 body: {
                     onClick: function () {
                         this.self.select(this.dindex); 
                     },
                     onDBLClick: function () {
                         this.self.clearSelect();
                         this.self.select(this.dindex);
                     },
                },
                columns: [
                      {key: "rn",      label: "No.",      align: "center",   width: 60},
                      {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 130},
                      {key: "wbsRsltsPlanNo",      label: "관리번호",      align: "center",   width: 130},
                      {key: "wbsRsltsPlanCodeId",      label: "계획항목코드",      hidden: true},
                      {key: "wbsRsltsPlanCodeNm",      label: "LEVEL",      align: "center",   width: 130},
                      {key: "todoCfDt",      label: "확인일자",      align: "center",   width: 130},
                      {key: "todoCfOpn",      label: "확인의견",      align: "left",   width: 200},
                      {key: "wbsRsltsCoCd",      label: "회사",          hidden: true},
                      {key: "wbsRsltsCoCdNm",      label: "회사명",      align: "center",   width: 130},
                      {key: "wbsSharngUserId",      label: "ID",      align: "center",   width: 130},
                      {key: "empNo",      label: "사원번호",      align: "center",   width: 130},
                      {key: "name",      label: "성명",      align: "center",   width: 130},
                      {key: "telNo",      label: "H.P",      align: "center",   width: 130},
                      {key: "email",      label: "E-Mail",      align: "center",   width: 200}
                      ]
             });
             return this;
           },
           setData: function() {
               var targetObj = this.target;
               var formData = {
                       "coCd" : $("#coCd_S3").val(),
                       "codeKind" : $("#wbsLevel2_S3").val(),
                       "codeId" : $("#wbsLevel3_S3").val(),
                       "salesCd" : $("#salesCd_S3").val()
               }
               postAjax("/user/wb/wb02/selectRsltsSharngList", formData, null, function(data){
                   var list = data.resultList;
                   targetObj.setData({
                        list : list,
                        page : {
                            totalElements : list.length
                        }
                    });
                   
               }); 
          } 
      }
      
      
//결재 테이블 그리드 초기화 영역
var secondGridView2_S3 = {
      initView: function(){
          this.target = new ax5.ui.grid();
          this.target.setConfig({
              showRowSelector: true,
              multipleSelect: false,
              sortable: true,
              target: $('[data-ax5grid="second-grid2_S3"]'),
              header: {
                align: "center",
                selector: false
              },
              body: {
                  onClick: function () {
                      this.self.select(this.dindex); 
                  },
                  onDBLClick: function () {
                      this.self.clearSelect();
                      this.self.select(this.dindex);
                  },
             },
             columns: [
                   {key: "rn",      label: "No.",      align: "center",   width: 60},
                   {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 130},
                   {key: "wbsRsltsPlanNo",      label: "관리번호",      align: "center",   width: 130}, 
                   {key: "wbsRsltsPlanCodeId",      label: "계획항목코드",      hidden: true},
                   {key: "wbsRsltsPlanCodeNm",      label: "LEVEL",      align: "center",   width: 130},
                   {key: "todoCfDt",      label: "확인일자",      align: "center",   width: 130},
                   {key: "todoCfOpn",      label: "확인의견",      align: "left",   width: 200},
                   {key: "wbsRsltsCoCd",      label: "회사",          hidden: true},
                   {key: "wbsRsltsCoCdNm",      label: "회사명",      align: "center",   width: 130},
                   {key: "wbsSharngUserId",      label: "ID",      align: "center",   width: 130},
                   {key: "empNo",      label: "사원번호",      align: "center",   width: 130},
                   {key: "name",      label: "성명",      align: "center",   width: 130},
                   {key: "telNo",      label: "H.P",      align: "center",   width: 130},
                   {key: "email",      label: "E-Mail",      align: "center",   width: 200}
                   ]
          });
          return this;
        },
        setData: function() {
            var targetObj = this.target;
            var formData = {
                    "coCd" : $("#coCd_S3").val(),
                    "codeKind" : $("#wbsLevel2_S3").val(),
                    "codeId" : $("#wbsLevel3_S3").val(),
                    "salesCd" : $("#salesCd_S3").val()
            }
            postAjax("/user/wb/wb02/selectRsltsApprovalList", formData, null, function(data){
                var list = data.resultList;
                
                targetObj.setData({
                     list : list,
                     page : {
                         totalElements : list.length
                     }
                 });
                
            }); 
       } 
   }
///////////////////////////////////


$(document).ready(function() {

    setCommonSelect($('#wbsPopup3 select[data-kind]'));
    
    $('#coCd_S3').val(jwt.coCd);
    $('#wbsPlanId_S3').val(jwt.userId);
    $('#wbsPlanNm_S3').val(jwt.userNm);
    $('#wbsPlanMngId_S3_1').val(jwt.userId);
    $('#wbsPlanMngNm_S3_1').val(jwt.userNm);
    $('#wbsPlanMngId_S3_2').val(jwt.userId);
    $('#wbsPlanMngNm_S3_2').val(jwt.userNm);
    $('#wbsPlanMngId_S3_3').val(jwt.userId);
    $('#wbsPlanMngNm_S3_3').val(jwt.userNm);
    
    $('#wbsRsltsRate_S3').val(0);
    $('#wbsRsltsMh_S3').val(0);
    $('#wbsPlanMh_S3').val(0);
    
    var today = new Date();
    var strDate = today.getFullYear()+"-"+('0'+(today.getMonth()+1)).slice(-2)+"-"+('0'+today.getDate()).slice(-2);
    
    // 작성일자 초기화
    $('#wbsPlanDt_S3').datepicker({
        format : "yyyy-mm-dd",
        language : "ko",
        autoclose : true
    })
    .datepicker("setDate", strDate)

    
    
    //  Level1  시작일 (현재날짜의 월 첫일)
    $('#wbsPlansDt_S3_1').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_1').val() > $('#wbsPlaneDt_S3_1').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlansDt_S3_1').datepicker("setDate", new Date($('#wbsPlaneDt_S3_1').val()));
              }
    });
    
    //  Level1  종료일 (현재날짜의 월 말일)
    $('#wbsPlaneDt_S3_1').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_1').val() > $('#wbsPlaneDt_S3_1').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlaneDt_S3_1').datepicker("setDate", new Date($('#wbsPlansDt_S3_1').val()));
              }
    });
    
    
    //  Level2 시작일 (현재날짜의 월 첫일)
    $('#wbsPlansDt_S3_2').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_2').val() > $('#wbsPlaneDt_S3_2').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlansDt_S3_2').datepicker("setDate", new Date($('#wbsPlaneDt_S3_2').val()));
              }
    });
    
    //  Level2 종료일 (현재날짜의 월 말일)
    $('#wbsPlaneDt_S3_2').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_2').val() > $('#wbsPlaneDt_S3_2').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlaneDt_S3_2').datepicker("setDate", new Date($('#wbsPlansDt_S3_2').val()));
              }
    });    
    

    //  Level3 시작일 (현재날짜의 월 첫일)
    $('#wbsPlansDt_S3_3').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_3').val() > $('#wbsPlaneDt_S3_3').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlansDt_S3_3').datepicker("setDate", new Date($('#wbsPlansDt_S3_3').val()));
              }
    });
    
    //  Level3 종료일 (현재날짜의 월 말일)
    $('#wbsPlaneDt_S3_3').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_3').val() > $('#wbsPlaneDt_S3_3').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlaneDt_S3_3').datepicker("setDate", new Date($('#wbsPlansDt_S3_3').val()));
              }
    });    
 
    
///////////////////////////////////////////////////////////////
    // 실적부분 작성자 현재 사용자로 초기화
   $('#wbsRsltsId_S3').val(jwt.userId);
   $('#wbsRsltsNm_S3').val(jwt.userNm);
   
   
   // 실적부분 실적일자 (현재날짜의 월 첫일)
   $('#wbsRsltsDt_S3').datepicker({
             format : "yyyy-mm-dd",
             language : "ko",
             autoclose : true
   })
   .datepicker("setDate", strDate)
       
   // 실적부분 시작일자 (현재날짜의 월 첫일)
   $('#wbsRsltssDt_S3').datepicker({
             format : "yyyy-mm-dd",
             language : "ko",
             autoclose : true
   })
   .datepicker("setDate", strDate)
   .on("changeDate", function(){
             if($('#wbsRsltssDt_S3').val() > $('#wbsRsltseDt_S3').val()){
                       alert("날짜를 확인해주세요");
                       $('#wbsRsltssDt_S3').datepicker("setDate", new Date($('#wbsRsltseDt_S3').val()));
             }
   });
   
   // 실적부분 종료일자 (현재날짜의 월 말일)
  $('#wbsRsltseDt_S3').datepicker({
             format : "yyyy-mm-dd",
             language : "ko",
             autoclose : true
   })
   .datepicker("setDate", strDate)
   .on("changeDate", function(){
             if($('#wbsRsltssDt_S3').val() > $('#wbsRsltseDt_S3').val()){
                       alert("날짜를 확인해주세요");
                       $('#wbsRsltseDt_S3').datepicker("setDate", new Date($('#wbsRsltssDt_S3').val()));
             }
   });
   
    // 결재일자
   $('#todoCfDt_S3').datepicker({
             format : "yyyy-mm-dd",
             language : "ko",
             autoclose : true
   })
   .datepicker("setDate", strDate)
   ///////////////////////////////////////////////////////////////

    
    openThirdWbsPlanDivChange();
    openThirdWbsLevel1Change();
    openThirdWbsLevel2Change();	
    openThirdWbsLevel3Change();
    openThirdWbsPlanStsChange();
    
    
    var row;
    
    if (paramFlag == "D") {  // 결과 수정
        row = toDoGridView.target.getList()[paramRpw];
        if (row != undefined) {
        	$("#todoKey_S3").val(row.todoKey); // todoKey                                        
            var formData = {
            		 "coCd" : row.wbsRsltsCoCd,
                     "codeKind" : row.wbsRsltsPlanCodeKind,
                     "codeId" : row.wbsRsltsPlanCodeId,  
                     "salesCd" : row.salesCd
                }
               
                postAjax("/user/wb/wb02/selectWbsPlanInfoSelect", formData, null, function(data){                   
                	$("#coCd_S3").val(data.resultList[0].coCd); // 회사
                    $("#wbsPlanNo_S3").val(data.resultList[0].wbsPlanNo); // 관리번호
                    $("#wbsPlanDt_S3").val(data.resultList[0].wbsPlanDt); // 작성일자
                    $("#wbsPlanId_S3").val(data.resultList[0].wbsPlanId); // 작성자ID
                    $("#wbsPlanNm_S3").val(data.resultList[0].wbsPlanNm);// 작성자명
                    $("#salesCd_S3").val(data.resultList[0].salesCd); // Sales Code
                    
                    $("#clntCd_S3").val(data.resultList[0].ordrsClntCd); // 고겍사ID
                    $("#clntNm_S3").val(data.resultList[0].ordrsClntNm); // 고객사명

                    $("#wbsClntPjt_S3").val(data.resultList[0].clntPjt); // 고객사PJT
                    $("#wbsPlanDiv_S3").val(data.resultList[0].ordrsDtlDiv20); // 신작구분
                    
                    
                    $("#wbsLevel1_S3").val(data.resultList[0].codeId.substring(0,8)); // 1 Level WBS 구분
                    openThirdWbsLevel2Change();
                    $("#wbsLevel2_S3").val(data.resultList[0].codeId.substring(0,10)); // 2 Level WBS 구분
                    openThirdWbsLevel3Change();                 
                    $("#wbsLevel3_S3").val(data.resultList[0].codeId); // 3 Level WBS 구분
                    
                    $("#wbsPlanMngId_S3_3").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                    $("#wbsPlanMngNm_S3_3").val(data.resultList[0].wbsPlanMngNm); //담당자명
                    $("#wbsPlansDt_S3_3").val(data.resultList[0].wbsPlansDt);// 시작일자
                    $("#wbsPlaneDt_S3_3").val(data.resultList[0].wbsPlaneDt); // 종료일자
                    $("#wbsPlanCnts_S3").val(data.resultList[0].wbsPlanCnts);// 주요내용
                    $("#wbsPlanRmk_S3").val(data.resultList[0].wbsPlanRmk);// 비고
                    if (row.wbsPlanOsYn == "Y"){ // 외주유무
                        $("#wbsPlanOsYn_Y_S3").prop('checked',true);
                        $("#wbsPlanOsYn_N_S3").prop('checked',false);
                    }
                    else{
                        $("#wbsPlanOsYn_Y_S3").prop('checked',false);
                        $("#wbsPlanOsYn_N_S3").prop('checked',true);
                    }
                    
                    // 1레벨 정보 조회
                    var formData = {
                            "coCd" : $("#coCd_S3").val(),
                            "salesCd" : $("#salesCd_S3").val(),
                            "wbsPlanCodeId" : $("#wbsLevel1_S3").val().substring(0,8)
                        }
                    
                        postAjax("/user/wb/wb01/selectWbsInfoList", formData, null, function(data){
                            $("#wbsPlanMngId_S3_1").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                            $("#wbsPlanMngNm_S3_1").val(data.resultList[0].wbsPlanMngNm); //담당자명
                            $("#wbsPlansDt_S3_1").val(data.resultList[0].wbsPlansDt);// 시작일자
                            $("#wbsPlaneDt_S3_1").val(data.resultList[0].wbsPlaneDt); // 종료일자
                        });
                    
                    // 2레벨 정보 조회
                    var formData1 = {
                            "coCd" : $("#coCd_S3").val(),
                            "salesCd" : $("#salesCd_S3").val(),
                            "wbsPlanCodeId" : $("#wbsLevel2_S3").val().substring(0,8)
                        }
                    
                        postAjax("/user/wb/wb01/selectWbsInfoList", formData1, null, function(data){
                            $("#wbsPlanMngId_S3_2").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                            $("#wbsPlanMngNm_S3_2").val(data.resultList[0].wbsPlanMngNm); //담당자명
                            $("#wbsPlansDt_S3_2").val(data.resultList[0].wbsPlansDt);// 시작일자
                            $("#wbsPlaneDt_S3_2").val(data.resultList[0].wbsPlaneDt); // 종료일자
                        });
                    
                    // 3레벨 정보 조회
                    var formData2 = {
                            "coCd" : $("#coCd_S3").val(),
                            "salesCd" : $("#salesCd_S3").val(),
                            "wbsPlanCodeId" : $("#wbsLevel3_S3").val().substring(0,10)
                        }
                    
                        postAjax("/user/wb/wb01/selectWbsInfoList", formData2, null, function(data){
                            $("#wbsPlanMngId_S3_3").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                            $("#wbsPlanMngNm_S3_3").val(data.resultList[0].wbsPlanMngNm); //담당자명
                            $("#wbsPlansDt_S3_3").val(data.resultList[0].wbsPlansDt);// 시작일자
                            $("#wbsPlaneDt_S3_3").val(data.resultList[0].wbsPlaneDt); // 종료일자
                        });
                	
                    
                    var formData3 = {
                    		"coCd" : $("#coCd_S3").val(),
                            "codeKind" : $("#wbsLevel2_S3").val(),
                            "codeId" : $("#wbsLevel3_S3").val(),
                            "salesCd" : $("#salesCd_S3").val()
                        }
                       
                        postAjax("/user/wb/wb02/selectWbsRsltsMasterList", formData3, null, function(data){
                        	$("#fileTrgtKey_S3").val(data.resultList[0].fileTrgtKey);
                            $("#wbsRsltsNo_S3").val(data.resultList[0].wbsPlanNo);
                            $("#wbsRsltsDt_S3").val(data.resultList[0].wbsRsltsDt);// 실적일자  
                            $("#wbsRsltsId_S3").val(data.resultList[0].wbsRsltsId);//작성자 
                            $("#wbsRsltssDt_S3").val(data.resultList[0].wbsRsltssDt); //시작일자
                            $("#wbsRsltseDt_S3").val(data.resultList[0].wbsRsltseDt);//종료일자
                            $("#wbsRsltsRate_S3").val(data.resultList[0].wbsRsltsRate);//진척율
                            $("#wbsRsltsMh_S3").val(data.resultList[0].wbsRsltsMh);//실투입공수
                            $("#wbsRsltsCnts_S3").val(data.resultList[0].wbsRsltsCnts);//  주요내용
                            $("#wbsRsltsRmk_S3").val(data.resultList[0].wbsRsltsRmk); //비고
                   
                            if (data.resultList[0].lockYn == "Y" || data.resultList[0].closeYn == "Y") {
                                $("#wbsRsltsDt_S3").prop('disabled',true);// 실적일자  
                                $("#wbsRsltsId_S3").prop('disabled',true);//작성자 
                                $("#wbsRsltssDt_S3").prop('disabled',true); //시작일자
                                $("#wbsRsltseDt_S3").prop('disabled',true);//종료일자
                                $("#wbsRsltsCnts_S3").prop('disabled',true);// 주요내용
                                $("#wbsRsltsRmk_S3").prop('disabled',true); //비고
                            }
                            else if (data.resultList[0].lockYn == "N" || data.resultList[0].closeYn == "N") {
                                $("#wbsRsltsDt_S3").prop('disabled',false);// 실적일자  
                                $("#wbsRsltsId_S3").prop('disabled',false);//작성자 
                                $("#wbsRsltssDt_S3").prop('disabled',false); //시작일자
                                $("#wbsRsltseDt_S3").prop('disabled',false);//종료일자
                                $("#wbsRsltsCnts_S3").prop('disabled',false);// 주요내용
                                $("#wbsRsltsRmk_S3").prop('disabled',false); //비고
                            }
                            
                            
                            
                        }); 
                    
                       //실적 상세 테이블 조회
                       wbsRsltsGridView_S3.initView().setData();
                       
                       //공유 테이블 조회
                       secondGridView1_S3.initView().setData();
                     
                       //결재 테이블 조회
                       secondGridView2_S3.initView().setData();
                }); 
            
            
           }
    }    

    
});   

//관리번호 (WbsPlanNo) 검색
function openThirdWbsPlanNoSearch() {
    var paramObj = {
       "coCd" : $('#coCd_S3').val(),
       "salesCd": $('#salesCd_S3').val()
    };
    openSecondModal("/static/html/cmn/modal/wbsPlanNoSearch.html", 450, 270, "관리번호 검색", paramObj, function (grid){
        var row = grid.target.getList("selected")[0];
        $('#wbsPlanNo_S3').val(row.wbsPlanNo);
    });
}


//작성자 검색
function openThirdWbsPlanUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S3').val(),
        "userId": $('#wbsPopup3 #wbsPlanId_S3').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "작성자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup3 #wbsPlanId_S3').val(checkedNode.id);
        $('#wbsPopup3 #wbsPlanNm_S3').val(checkedNode.text);
    });
}





//Level1 담당자 검색
function openThirdWbsLevel1PlanMngUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S3').val(),
        "userId": $('#wbsPopup3 #wbsPlanId_S3_1').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup3 #wbsPlanMngId_S3_1').val(checkedNode.id);
        $('#wbsPopup3 #wbsPlanMngNm_S3_1').val(checkedNode.text);
    });
}

//Level2 담당자 검색
function openThirdWbsLevel2PlanMngUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S3').val(),
        "userId": $('#wbsPopup3 #wbsPlanId_S3_2').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup3 #wbsPlanMngId_S3_2').val(checkedNode.id);
        $('#wbsPopup3 #wbsPlanMngNm_S3_2').val(checkedNode.text);
    });
}


//Level3 담당자 검색
function openThirdWbsLevel3PlanMngUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S3').val(),
        "userId": $('#wbsPopup3 #wbsPlanId_S3_3').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup3 #wbsPlanMngId_S3_3').val(checkedNode.id);
        $('#wbsPopup3 #wbsPlanMngNm_S3_3').val(checkedNode.text);
    });
}


//Sales Code (수주마스터, 수주상세테이블 조인) 검색
function openThirdWbsSalesCodeSearch() {
    var paramObj = {
       "coCd" : $('#coCd_S3').val(),
       "salesCd": $('#salesCd_S3').val()
    };
    openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 330, "SALES CODE 검색", paramObj, function (grid){
        var row = grid.target.getList("selected")[0];
        $('#salesCd_S3').val(row.salesCd); // Sales Code
        $('#wbsClntPjt_S3').val(row.clntPjt); // 고객사 PJT
        $('#clntCd_S3').val(row.ordrsClntCd); // 고객사코드
        $('#clntNm_S3').val(row.ordrsClntNm); // 고객사명
        $("#wbsPlanDiv_S3").val(row.ordrsDtlDiv20); // 신작구분
    });
}

// 고객사 검색
function openThirdClntSearch(type) {
    openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "고객사 검색", {}, function (grid) {
        var row = grid.target.getList("selected")[0];
        $('#wbsPopup3 #clntCd_S3').val(row.clntCd);
        $('#wbsPopup3 #clntNm_S3').val(row.clntNm);
    });
}

//신작구분
function openThirdWbsPlanDivChange() {
    var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsPlanDivList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="wbsPlanDiv"]').html(optionHtml);
    });
}

//WBS LEVEL 1 구분
function openThirdWbsLevel1Change() {
    var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsLevel1List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel1_S3"]').html(optionHtml);
    });
}

//WBS LEVEL 2 구분
function openThirdWbsLevel2Change() {
	//debugger;
    var paramObj = {"codeKind" : $('#wbsLevel1_S3').val()};

    postAjaxSync("/user/wb/wb01/selectWbsLevel2List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel2_S3"]').html(optionHtml);
    });
}

//WBS LEVEL 3 구분
function openThirdWbsLevel3Change() {
	
    var paramObj = {"codeKind" : $('#wbsLevel2_S3').val()};

    postAjaxSync("/user/wb/wb01/selectWbsLevel3List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel3_S3"]').html(optionHtml);
    });
}


//WBS 계획상태  WBS_PLAN_STS_CODE_ID
function openThirdWbsPlanStsChange() {
    //DSGN_DIF_CODE_ID
    var paramObj = {"codeKind" : "WBSPLANSTS"};
    postAjaxSync("/user/wb/wb01/selectWbsPlanStsList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="wbsPlanStsCodeId"]').html(optionHtml);
    });
}



//실적 작성자 검색
function openSecondWbsPlanUserSearch_S3() {
    var paramObj = {
        "coCd" : $('#coCd_S3').val(),
        "userId": $('#wbsPopup3 #wbsPlanId_S3').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "작성자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup3 #wbsRsltsId_S3').val(checkedNode.id);
        $('#wbsPopup3 #wbsRsltsNm_S3').val(checkedNode.text);
    });
}

function umWbsAssRateVal_S3() {
    //debugger;
    var rowList = wbsRsltsGridView_S3.target.getList();
    var sumWbsAssRate = 0;
    var sumWbsPlanMh = 0;
    var sumWbsRsltsMh = 0;
    $.each(rowList, function(idx, elem){
        //debugger;
        sumWbsAssRate = parseInt(sumWbsAssRate) + parseInt(elem.wbsAssRateVal); 
        sumWbsPlanMh = parseInt(sumWbsPlanMh) + parseInt(elem.wbsPlanMh);
        sumWbsRsltsMh = parseInt(sumWbsRsltsMh) + parseInt(elem.wbsRsltsMh); 
    });
    $('#wbsRsltsRate_S3').val(sumWbsAssRate);
    $('#wbsPlanMh_S3').val(sumWbsPlanMh);
    $('#wbsRsltsMh_S3').val(sumWbsRsltsMh);
}


function rsltsLevel1Insert() {
    
    umWbsAssRateVal_S3();
    if (paramFlag == "I") { // 실적등록
       if ($('#wbsRsltsId_S3').val() == "") {
           alert("작성자를 입력하세요");
           return;
       }
   
       if ($('#wbsRsltsCnts_S3').val() == "") {
           alert("주요내용을 입력하세요");
           return;
       }
       
       var formData = new FormData();
       
       //파일 fileTrgtKey키 생성

       if ($("#fileTrgtKey_S3").val() == "" || $("#fileTrgtKey_S3").val() == undefined) {
           var paramObj = {"coCd" : $('#coCd_S3').val()};
           postAjaxSync("/user/wb/wb02/selectMaxTrgtKey", paramObj, null, function(data){ 
               fileTreeKey = data.result;
               $("#fileTrgtKey_S3").val(fileTreeKey);
           }); 
       }
     
       var strYear = new Date().toISOString().substring(2, 4);
       var planData = {
               "coCd" : $('#coCd_S3').val(),
               "year" : "W" + strYear
           }; 
        postAjaxSync("/user/wb/wb02/selectMaxWbsPlanNo", planData, null, function(data){
           var strLen = String(data.result);
           //alert(data.result);
           if (data.result == undefined || data.result == "") {
               $('#wbsRsltsNo_S3').val("W" + strYear + "0001");
           }
           else {
               if (strLen.length == 1) {
                   $('#wbsRsltsNo_S3').val("W" + strYear + "000" + data.result); 
                   }
               else if (strLen.length == 2) {
                   $('#wbsRsltsNo_S3').val("W" + strYear + "00" + data.result); 
               }
               else if (strLen.length == 3) {
                   $('#wbsRsltsNo_S3').val("W" + strYear + "0" + data.result); 
               }
               else if (strLen.length == 4) {
                   $('#wbsRsltsNo_S3').val("W" + strYear + data.result); 
               }
           }
           
       }); 

       
       $.each($('#wbsPopup3 [data-search]'), function(idx, elem){
           formData.append($(elem).data("search"), $(elem).val());
       });
       
       formData.append("creatId", jwt.userId);     
       formData.append("userId", jwt.userId);
       
       formData.append("creatPgm", $('#creatPgm').val());
       // 실적 공유테이블 TODO CODE_ID
       formData.append("S_todoDiv1CodeId", "TODODIV10");
       formData.append("S_todoDiv2CodeId", "TODODIV1020");
        // 실적 결재테이블 TODO CODE_ID
       formData.append("A_todoDiv1CodeId", "TODODIV20");
       formData.append("A_todoDiv2CodeId", "TODODIV2010");
             
        // 실적리스트 정리
       var rowRsltsList = wbsRsltsGridView_S3.target.list;
       if(rowRsltsList.length > 0) {
           var rowRsltsListArr = [];
           
           $.each(rowRsltsList, function(idx, elem){
               var rowRsltsListObj = elem;
               
               //debugger;
               rowRsltsListObj["wbsRsltsRate"] = elem.wbsRsltsRate;
               rowRsltsListObj["wbsAssRate"] =  elem.wbsAssRate;
               if (elem.wbsRsltsCnts == undefined) {
                   rowRsltsListObj["wbsRsltsCnts"] = " ";
               }
               else {
                   rowRsltsListObj["wbsRsltsCnts"] = elem.wbsRsltsCnts;
               }
               rowRsltsListObj["wbsPlanMh"] =  elem.wbsPlanMh;  
               rowRsltsListObj["wbsRsltsMh"] =  elem.wbsRsltsMh; 
               rowRsltsListObj["lockYn"] =  elem.lockYn; 
               rowRsltsListObj["closeYn"] =  elem.closeYn; 
               rowRsltsListArr.push(rowRsltsListObj);           
           });
           
           formData.append("rowRsltsListArr", JSON.stringify(rowRsltsListArr));
       }       
       
       // 공유대상자 리스트
       var rowSharngList = secondGridView1_S3.target.list;
       if(rowSharngList.length > 0) {
           var rowSharngListArr = [];
           $.each(rowSharngList, function(idx, elem){
               var rowSharngListObj = elem;
               rowSharngListObj["coCd"] = $("#coCd_S3").val();
               rowSharngListObj["salesCd"] = elem.salesCd;
               rowSharngListObj["wbsRsltsPlanNo"] = $("#wbsRsltsNo_S3").val();
               rowSharngListObj["wbsRsltsPlanCodeId"] = elem.wbsRsltsPlanCodeId;
               rowSharngListObj["wbsRsltsPlanCodeNm"] = elem.wbsRsltsPlanCodeNm;
               rowSharngListObj["todoCfDt"] = elem.todoCfDt;
               rowSharngListObj["todoCfOpn"] = elem.todoCfOpn;
               rowSharngListObj["wbsRsltsCoCd"] = elem.wbsRsltsCoCd;
               rowSharngListObj["wbsRsltsCoCdNm"] = elem.wbsRsltsCoCdNm;
               rowSharngListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
               rowSharngListObj["empNo"] = elem.empNo;
               rowSharngListObj["name"] = elem.name;
               rowSharngListObj["telNo"] = elem.telNo;
               rowSharngListObj["email"] = elem.email;    
               rowSharngListObj["pgPath"] = "/user/wb/wb20/WB2001P06.html";
               rowSharngListArr.push(rowSharngListObj);
           });
           formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));
       }       
       
       
       // 결재대상자 리스트
       var rowApprovalList = secondGridView2_S3.target.list;
       if(rowApprovalList.length > 0) {
           var rowApprovalListArr = [];
           $.each(rowApprovalList, function(idx, elem){
               var rowApprovalListObj = elem;
               rowApprovalListObj["salesCd"] = elem.salesCd;
               rowApprovalListObj["wbsRsltsPlanNo"] = $("#wbsRsltsNo_S3").val();
               rowApprovalListObj["wbsRsltsPlanCodeId"] = elem.wbsRsltsPlanCodeId;
               rowApprovalListObj["wbsRsltsPlanCodeNm"] = elem.wbsRsltsPlanCodeNm;
               rowApprovalListObj["todoCfDt"] = elem.todoCfDt;
               rowApprovalListObj["todoCfOpn"] = elem.todoCfOpn;
               rowApprovalListObj["wbsRsltsCoCd"] = elem.wbsRsltsCoCd;
               rowApprovalListObj["wbsRsltsCoCdNm"] = elem.wbsRsltsCoCdNm;
               rowApprovalListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
               rowApprovalListObj["empNo"] = elem.empNo;
               rowApprovalListObj["name"] = elem.name;
               rowApprovalListObj["telNo"] = elem.telNo;
               rowApprovalListObj["email"] = elem.email;    
               rowApprovalListObj["pgPath"] = "/user/wb/wb20/WB2001P09.html";
               rowApprovalListArr.push(rowApprovalListObj);
               
           });
           formData.append("rowApprovalListArr", JSON.stringify(rowApprovalListArr));
       }       
   }
   else if (paramFlag == "U") { // 수정
        if ($('#wbsRsltsId_S3').val() == "") {
            alert("작성자를 입력하세요");
            return;
        }
    
        if ($('#wbsRsltsCnts_S3').val() == "") {
            alert("주요내용을 입력하세요");
            return;
        }
        
        var formData = new FormData();
        $.each($('#wbsPopup3 [data-search]'), function(idx, elem){
            formData.append($(elem).data("search"), $(elem).val());
        });
        
        formData.append("creatId", jwt.userId);     
        formData.append("userId", jwt.userId);
         
        formData.append("creatPgm", $('#creatPgm').val());
        // 실적 공유테이블 TODO CODE_ID
        formData.append("S_todoDiv1CodeId", "TODODIV10");
        formData.append("S_todoDiv2CodeId", "TODODIV1020");
         // 실적 결재테이블 TODO CODE_ID
        formData.append("A_todoDiv1CodeId", "TODODIV20");
        formData.append("A_todoDiv2CodeId", "TODODIV2020");

         // 실적리스트 정리
        var rowRsltsList = wbsRsltsGridView_S3.target.list;
        if(rowRsltsList.length > 0) {
            var rowRsltsListArr = [];
            
            $.each(rowRsltsList, function(idx, elem){
                var rowRsltsListObj = elem;
                //debugger;
                rowRsltsListObj["wbsRsltsRate"] = elem.wbsRsltsRate;
                rowRsltsListObj["wbsAssRate"] =  elem.wbsAssRate;
                if (elem.wbsRsltsCnts == undefined) {
                    rowRsltsListObj["wbsRsltsCnts"] = " ";
                }
                else {
                    rowRsltsListObj["wbsRsltsCnts"] = elem.wbsRsltsCnts;
                } 
                rowRsltsListObj["wbsPlanMh"] =  elem.wbsPlanMh;  
                rowRsltsListObj["wbsRsltsMh"] =  elem.wbsRsltsMh; 
                rowRsltsListObj["lockYn"] =  elem.lockYn; 
                rowRsltsListObj["closeYn"] =  elem.closeYn; 
                rowRsltsListArr.push(rowRsltsListObj);           
            });
            
            formData.append("rowRsltsListArr", JSON.stringify(rowRsltsListArr));
        }       
        
        // 공유대상자 리스트
        var rowSharngList = secondGridView1_S3.target.list;
        if(rowSharngList.length > 0) {
            var rowSharngListArr = [];
            $.each(rowSharngList, function(idx, elem){
                var rowSharngListObj = elem;
                rowSharngListObj["coCd"] = $("#coCd_S3").val();
                rowSharngListObj["salesCd"] = elem.salesCd;
                rowSharngListObj["wbsRsltsPlanNo"] = $("#wbsRsltsNo_S3").val();
                rowSharngListObj["wbsRsltsPlanCodeId"] = elem.wbsRsltsPlanCodeId;
                rowSharngListObj["wbsRsltsPlanCodeNm"] = elem.wbsRsltsPlanCodeNm;
                rowSharngListObj["todoCfDt"] = elem.todoCfDt;
                rowSharngListObj["todoCfOpn"] = elem.todoCfOpn;
                rowSharngListObj["wbsRsltsCoCd"] = elem.wbsRsltsCoCd;
                rowSharngListObj["wbsRsltsCoCdNm"] = elem.wbsRsltsCoCdNm;
                rowSharngListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
                rowSharngListObj["empNo"] = elem.empNo;
                rowSharngListObj["name"] = elem.name;
                rowSharngListObj["telNo"] = elem.telNo;
                rowSharngListObj["email"] = elem.email;    
                rowSharngListObj["pgPath"] = "/user/wb/wb20/WB2001P06.html";
                rowSharngListArr.push(rowSharngListObj);
            });
            formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));
        }       
        
        
        // 결재대상자 리스트
        var rowApprovalList = secondGridView2_S3.target.list;
        if(rowApprovalList.length > 0) {
            var rowApprovalListArr = [];
            $.each(rowApprovalList, function(idx, elem){
                var rowApprovalListObj = elem;
                rowApprovalListObj["salesCd"] = elem.salesCd;
                rowApprovalListObj["wbsRsltsPlanNo"] = $("#wbsRsltsNo_S3").val();
                rowApprovalListObj["wbsRsltsPlanCodeId"] = elem.wbsRsltsPlanCodeId;
                rowApprovalListObj["wbsRsltsPlanCodeNm"] = elem.wbsRsltsPlanCodeNm;
                rowApprovalListObj["todoCfDt"] = elem.todoCfDt;
                rowApprovalListObj["todoCfOpn"] = elem.todoCfOpn;
                rowApprovalListObj["wbsRsltsCoCd"] = elem.wbsRsltsCoCd;
                rowApprovalListObj["wbsRsltsCoCdNm"] = elem.wbsRsltsCoCdNm;
                rowApprovalListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
                rowApprovalListObj["empNo"] = elem.empNo;
                rowApprovalListObj["name"] = elem.name;
                rowApprovalListObj["telNo"] = elem.telNo;
                rowApprovalListObj["email"] = elem.email;    
                rowApprovalListObj["pgPath"] = "/user/wb/wb20/WB2001P09.html";
                rowApprovalListArr.push(rowApprovalListObj);
                
            });
            formData.append("rowApprovalListArr", JSON.stringify(rowApprovalListArr));
        } 
   }
   
   var paramObj = {
           "coCd" : $('#coCd_S3').val(),
           "salesCd" : $('#salesCd_S3').val(),
           "codeId" : $('#wbsLevel3_S3').val()
     };    
   var chk;
   postAjaxSync("/user/wb/wb02/selectWbsPlanChk", paramObj, null, function(data){ 
       chk = data.result;
   });
  // alert(chk);
   if (chk == undefined) {
        //debugger;
       filePostAjax("/user/wb/wb02/wbsLevel1RsltsInsert", formData, function(data){
           // debugger;
           if(data.resultCode == 200){
               alert(data.resultMessage);
               modalStack.close();
               gridView1.setData(0); 
               gridView2.setData(0);
           }
       });         
   }
   else{
       filePutAjax("/user/wb/wb02/wbsLevel1RsltsUpdate", formData, function(data){
           if(data.resultCode == 200){
               alert(data.resultMessage);
               modalStack.close();
               gridView1.setData(0);
               gridView2.setData(0); 
           }
       });        
   }    
}

function updateRsltsApproval() {
    var formData = new FormData();
    formData.append("todoKey", $('#todoKey_S3').val()); 
    formData.append("todoCfDt",  $('#todoCfDt_S3').val()); 
    formData.append("todoCfOpn", $('#todoCfOpn_S3').val()); 
    formData.append("creatId", jwt.userId);     
    formData.append("userId", jwt.userId);     
    formData.append("creatPgm", $('#creatPgm_S3').val());
    filePutAjax("/user/wb/wb20/updateRsltsApproval", formData, function(data){
        if(data.resultCode == 200){
            alert(data.resultMessage);
            modalStack.close();
            toDoGridView.setData(0);
        }
    });    
    
}
</script>
