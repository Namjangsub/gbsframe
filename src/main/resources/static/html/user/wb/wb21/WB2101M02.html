<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="/static/fontawesome/css/all.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5grid.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5mask.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5modal.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5toast.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5menu.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5calendar.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5picker.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5select.css">
    <link rel="stylesheet" href="/static/css/jstree/style.min.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5combobox.css">
    <link rel="stylesheet" href="/static/css/gnb.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/sub.css">
    <link rel="stylesheet" href="/static/css/common.css">

    <script type="text/javascript" src="/static/js/jquery-latest.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.serializeObject.js"></script>
    <script type="text/javascript" src="/static/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript" src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
    <script type="text/javascript" src="/static/js/moment/moment-with-locales.js"></script>
    <script type="text/javascript" src="/static/js/jstree/jstree.min.js"></script>
    <script type="text/javascript" src="/static/js/ax5/ax5core.min.js"></script>
    <script type="text/javascript" src="/static/js/ax5/ax5grid.min.js"></script>
    <script type="text/javascript" src="/static/js/ax5/ax5mask.min.js"></script>
    <script type="text/javascript" src="/static/js/ax5/ax5modal.min.js"></script>
    <script type="text/javascript" src="/static/js/ax5/ax5toast.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.5.0/jszip.min.js"></script>
    <script type="text/javascript" src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" ></script>
    <script type="text/javascript" src="/static/js/global.js"></script>
    <script type="text/javascript" src="/static/js/fileTree.js"></script>
    <script type="text/javascript" src="/static/js/workingDayCalc.js"></script>
    <script type="text/javascript" src="/static/js/korean-lunar-calendar.min.js"></script>

    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-calendar/master/dist/ax5calendar.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-picker/master/dist/ax5picker.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-menu/master/dist/ax5menu.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-formatter/master/dist/ax5formatter.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-combobox/master/dist/ax5combobox.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-select/master/dist/ax5select.min.js"></script>

	<!-- 도움말 팝업 -->
	<script src="/static/js/manualPopup.js"></script>

</head>

<body>
    <div id="head_area"></div>
    <div id="top_area"></div>
    
    <div id="main_area">
        <!-- 페이지 상단 -->
        <div class="contents no_bg">
        <input type="hidden" id="pgmId"  name="pgmId" value="WB2101M01">
            <ul class="btn_ul">
                <li class="btn_r">
                	<a onclick="manualPopup();"> <button type="button" class="bg_gray" onclick="manualPopup();">도움말</button> </a>
                    <a onclick="initSearch();"><button class="bg_gray">초기화</button></a>
                    <a onclick="searchList();"><button class="bg_gray">검 색</button></a>
                </li>
            </ul>
        </div>
         <!-- 검색 콘텐츠 -->
        <div class="contents search">
            <div class="">
                <!-- 테이블 인풋 3분할 -->
                <table class="table_input type04">
                
                    <!-- 검색조건 1행 -->
                    <tr>
                        <th class="hit" style="width:80px;">회사</th>
                        <td style="width:200px;">
                           <select id="coCd_S" name="coCd_S" data-kind="CO" data-search="coCd" required msg="회사" onChange="gridView.setData(0);changeCocd();">
                           </select>
                        </td>
                        <th class= "hit" style="width:90px;">Sales Code</th>
                        <td style="width:200px;">
                            <div class="search_form">
                                <input type="text" id="salesCd_S" name="salesCd_S" data-search="salesCd" onkeyup="event.keyCode == 13 ? gridView.setData(0) : ''">
                                <a onclick="wbsSalesCodeSearch('S');"><i class="i_search_w"></i></a>
                            </div>
                            <input type="hidden" id="salesNm_S" name="salesNm_S" >
                        </td>
                        <th class="">고객사</th>
						<td>
							<input type="hidden" id="ordrsClntCd_S" name="ordrsClntCd_S" data-search="ordrsClntCd">
							<div class="search_form">
								<input type="text" id="ordrsClntNm_S" name="ordrsClntNm_S" data-search="ordrsClntNm" onkeyup="event.keyCode == 8 ? ordrsClntCd_S.value = '' : event.keyCode == 13 ? gridView.setData(0) : ''">
								<a onclick="opendClntSearch($('#ordrsClntNm_S').val());"><i class="i_search_w"></i></a>
							</div>
						</td>
						<th>고객사PJT</th>
						<td>
                            <select id="clntPjt_S" name="clntPjt_S" data-kind="PRJCTCD" data-search="clntPjt" onchange="gridView.setData(0);">
								<option value="">전체</option>
							</select>
						</td>
                        <th >과제명</th>
                        <td style="width:260px;">
                        <input type="text" id="sjNm_S" name="sjNm_S" data-search="sjNm" onChange="gridView.setData(0);" onkeyup="event.keyCode == 13 ? gridView.setData(0) : ''">
                        </td>   
                        
                    </tr>
                    <!-- 검색조건 2행 -->
					<tr>
						<th style="width:100px;">시작일</th>
	                    <td >
	                    <div style="width:400px;">
	                      <input type="text" class="input_calendar" id="beginDt_S" name="beginDt_S" data-search="beginDt_S" autocomplete="off" date data-search="beginDt" onkeyup="dateMask(this);">
	                      <span>~</span>
	                      <input type="text" class="input_calendar" id="deDt_S" name="deDt_S" data-search="deDt_S"  autocomplete="off" date data-search="deDt" onkeyup="dateMask(this);">
	                    </div>
	                    </td>
	                    <td></td><td></td>
	                    <th style="width:100px;">확정구분</th>
                        <td>
                        <select id="closeYn_S" name="closeYn_S" data-search="closeYn" onChange="gridView.setData(0);">
							<option value="" selected>전체</option>
							<option value="Y">확정</option>
							<option value="N">미확정</option>
                        </select>
                        </td>
					</tr>
                    <!-- 검색조건 END -->
                </table>
            </div>
        </div>

        <!-- 콘텐츠 -->
    <div class="contents no_bg">
              <div class="contents_tit">
                <div class="add_btn_small pdl10">
                  <a id="cretSjNo" onclick="cretSjNo();" style="height: 30px; line-height: 28px; width: 90px;"><i class="fas fa-folder-plus"></i> 신규과제등록</a>
<!--                   <a id="saveBtn" onclick="saveSj()" style="height: 30px; line-height: 28px; width: 60px;">저장</a> -->
<!--                   <a onclick="confirmY();" style="height: 30px; line-height: 28px; width: 60px;">확정</a> -->
<!--                   <a onclick="confirmN();" style="height: 30px; line-height: 28px; width: 60px;">미확정</a> -->
<!--                   <a onclick="createVerUp();" style="height: 30px; line-height: 28px; width: 60px;">Ver.Up</a> -->
                  <a onclick="excelDown();" style="height: 30px; line-height: 28px; width: 90px;"><i class="fas fa-file-excel"></i> 엑셀다운로드</a>
                </div>
                <select id="recordCnt" style="height: 30px;" class="prae_select" onChange="gridView.setData(0);">
                  <option value="25" selected>25</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                  <option value="9999999" >전체</option>
                </select> 
             </div>
             
             <div class="contents">
			      <div class="ax5_grid">
			      	  <div class="ax5_grid" data-ax5grid="first-grid" data-ax5grid-config="{}" style="width: 100%; height: 750px;" ></div>
		              <div data-ax5grid="excel-grid" data-ax5grid-config="{}" style="display: none;"></div>
			      </div>
			  </div>
			  
<!--       <div class="row" style="margin-top: 15px;"> -->
<!-- 	      <div class="col-xs-4" style="padding-right: 5px;"> -->
<!-- 	        <div class="contents" style="margin: 0px; padding: 0px; height: 750px; width: 100%; min-width: 300px"> -->
<!-- 	              <div class="ax5_grid" data-ax5grid="first-grid" data-ax5grid-config="{}" style="width: 100%; height: 750px;" ></div> -->
<!-- 	              <div data-ax5grid="excel-grid" data-ax5grid-config="{}" style="display: none;"></div>               -->
<!-- 	        </div> -->
<!-- 	      </div> -->
	      
<!-- 	      <div class="col-xs-8" style="padding-left: 0;"> -->
<!-- 	        <div class="contents"> -->
<!-- 	              <div id="wbsPopup" class="popup_area of_a"  style="width: 100%; height: 750px;"> -->
<!-- 	                  <form id="popForm"> -->
<!-- 	                    <input type="hidden" id="coCd"   name="coCd"> -->
<!-- 	                    <input type="hidden" id="userId" name="userId"> -->
<!-- 	                    <input type="hidden" id="pgmId"  name="pgmId" value="WB2101M01"> -->
<!-- 	                    <input type="hidden" id="closeYn" name="closeYn"> -->
	                    
<!-- 	                    <table class="popup_table"> -->
<!-- 	                        <colgroup> -->
<!-- 	                             <col width="19%"> -->
<!-- 	                             <col width="20%"> -->
<!-- 	                             <col width="20%"> -->
<!-- 	                             <col width="20%"> -->
<!-- 	                             <col width="18%"> -->
<!-- 	                             <col width="17%"> -->
<!-- 	                             <col width="18%"> -->
<!-- 	                             <col width="20%"> -->
<!-- 	                             <col width="18%"> -->
<!-- 	                        </colgroup> -->
	                        
<!-- 	                        <thead> -->
<!-- 	                            <tr> -->
<!-- 	                               <td colspan="9" style="height:30px;text-align: left;">과제정보</td>                                                 -->
<!-- 	                            </tr> -->
<!-- 	                        </thead> -->
<!-- 	                           <tr style="height:40px;text-align: left;" rowspan="2"> -->
<!-- 	                                <th>과제기본정보</th>                             -->
<!-- 	                                <th>과제번호</th> -->
<!-- 	                                <td>  -->
<!-- 	                                   <input type="text" id="sjNo" name="sjNo" readonly required msg="과제번호"> -->
<!-- 	                                </td> -->
<!-- 	                                <th class="hit">과제명</th> -->
<!-- 	                                <td colspan="3">  -->
<!-- 	                                   <input type="text" id="sjNm" name="sjNm" required msg="과제명"> -->
<!-- 	                                </td>                                -->
<!-- 	                                <th>Ver.</th> -->
<!-- 	                                <td>    -->
<!-- 	                                   <input type="text" id="verNo" name="verNo" onkeyup="onlyNumber(this)" maxlength="1" readonly> -->
<!-- 	                                </td> -->
	
<!-- 	                            </tr> -->
	                            
<!-- 	                            <tr> -->
<!-- 	                               <td colspan="9" style="height:8px;text-align: left;"></td>                                                 -->
<!-- 	                            </tr> -->
	                            
<!-- 	                             <tr style="height:40px;text-align: left;" rowspan="2"> -->
<!-- 	                                <th>고객기본정보</th>                             -->
<!-- 	                                <th  class="hit">SALES CODE</th> -->
<!-- 	                                <td>  -->
<!-- 	                                   <div class="search_form"> -->
<!-- 	                                    <input type="text" id="salesCd" name="salesCd" required readonly msg="salesCd"> -->
<!-- 	                                    <a onclick="wbsSalesCodeSearch('P');"><i class="i_search_w" readonly></i></a> -->
<!-- 	                                </div> -->
<!-- 	                                </td> -->
<!-- 	                                <th>고객사</th> -->
<!-- 	                                <td>  -->
<!-- 	                                   <input type="hidden" id="clntCd" name="clntCd" > -->
<!-- 	                                   <input type="text" id="clntNm" name="clntNm" readonly > -->
<!-- 	                                </td> -->
<!-- 	                                <th>제품</th> -->
<!-- 	                                <td> -->
<!-- 	                                    <input type="hidden" id="prdtCd" name="prdtCd" > -->
<!-- 	                                    <input type="text" id="prdtNm" name="prdtNm" readonly > -->
<!-- 	                                </td> -->
<!-- 	                                <th>차종</th> -->
<!-- 	                                <td>    -->
<!-- 	                                   <input type="hidden" id="clntPjt" name="clntPjt"> -->
<!-- 	                                   <input type="text" id="clntPjtNm" name="clntPjtNm" readonly > -->
<!-- 	                                </td> -->
<!-- 	                            </tr> -->
	                            
<!-- 	                             <tr> -->
<!-- 	                               <td colspan="9" style="height:8px;text-align: left;"></td>                                                 -->
<!-- 	                            </tr> -->
<!-- 	                            <tr  style="height:40px;text-align: left;"> -->
<!-- 	                                <th>실행정보</th>                             -->
<!-- 	                                <th>제작처 구분</th> -->
<!-- 	                                <td> -->
<!-- 	                                    <select id="mkerDiv" name="mkerDiv" data-kind="MAKERDIV" onchange="mkerCd.value='';mkerNm.value='';"> -->
<!-- 	                                    </select> -->
<!-- 	                                </td> -->
<!-- 	                                <th>제작업체</th> -->
<!-- 	                                <td colspan="2">  -->
<!-- 	                                   <input type="hidden" id="mkerCd" name="mkerCd"> -->
<!-- 	                                    <div class="search_form" style="width: 100%;"> -->
<!-- 	                                        <input type="text" id="mkerNm" name="mkerNm" readonly>  -->
<!-- 	                                        <a onclick="openClntSearch();"><i class="i_search_w"></i></a> -->
<!-- 	                                    </div> -->
<!-- 	                                </td> -->
<!-- 	                                <td colspan="3"></td> -->
<!-- 	                            </tr> -->
<!-- 	                            <tr> -->
<!-- 	                               <td colspan="9" style="height:8px;text-align: left;"></td>                                                 -->
<!-- 	                            </tr> -->
<!-- 	                             <tr style="height:40px;text-align: left;"> -->
<!-- 	                                <th>납기정보</th>                             -->
<!-- 	                                <th class="hit">시작일</th> -->
<!-- 	                                <td>         -->
<!-- 	                                <input id="beginDt" name="beginDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" required msg="시작일" date>                             -->
<!-- 	                                </td> -->
<!-- 	                                <th class="hit">출고일</th> -->
<!-- 	                                <td>                    -->
<!-- 	                                <input id="deDt" name="deDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" required msg="출고일" date>                  -->
<!-- 	                                </td> -->
<!-- 	                                <th class="hit">완료검수일</th> -->
<!-- 	                                <td>                    -->
<!-- 	                                <input id="acptncDt" name="acptncDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" required msg="완료검수일" date>                     -->
<!-- 	                                </td> -->
<!-- 	                                <th>소요일수</th> -->
<!-- 	                                <td>                    -->
<!-- 	                                <input id="reqreDaycnt" name="reqreDaycnt"  required msg="소요일수" readonly >                     -->
<!-- 	                                </td> -->
<!-- 	                            </tr> -->
<!-- 	                            <tr> -->
<!-- 	                               <td colspan="9" style="height:8px;text-align: left;"></td>                                                 -->
<!-- 	                            </tr> -->
<!-- 	                            <tr  style="height:40px;text-align: left;"> -->
<!-- 	                                <th>참조정보</th>                             -->
<!-- 	                                <th>설계난이도</th> -->
<!-- 	                                <td>         -->
<!-- 	                                <select id="dsgnDifCodeId" name="dsgnDifCodeId" data-kind="DSGNDIF">  -->
<!-- 	                                </select>                     -->
<!-- 	                                </td> -->
<!-- 	                                <th>설계계획공수</th> -->
<!-- 	                                <td>                    -->
<!-- 	                                <input type="text" class="form-control" id="dsgnPlanHour" name="dsgnPlanHour" onkeyup="onlyNumber(this)">             -->
<!-- 	                                </td> -->
<!-- 	                                <th>생산난이도</th> -->
<!-- 	                                <td>                    -->
<!-- 	                                <select id="prdctnDifCodeId" name="prdctnDifCodeId" data-kind="PRDCTNDIF"> -->
<!-- 	                                </select>                 -->
<!-- 	                                </td> -->
<!-- 	                                <th>생산계획공수</th> -->
<!-- 	                                <td>                    -->
<!-- 	                                <input type="text" class="form-control" id="prdctnPlanHour" name="prdctnPlanHour" onkeyup="onlyNumber(this)">                   -->
<!-- 	                                </td> -->
<!-- 	                            </tr> -->
<!-- 	                            <tr> -->
<!-- 	                               <td colspan="9" style="height:8px;text-align: left;"></td>                                                 -->
<!-- 	                            </tr> -->
	                            
<!-- 	                            <tr> -->
<!-- 	                            <th class="hit">총괄PM</th> -->
<!-- 	                            <td colspan="3">  -->
<!-- 	                              <div class="search_form"> -->
<!-- 	                                <input type="hidden" id="smrizeId" name="smrizeId" msg="총괄PM" > -->
<!-- 	                                <input type="text" id="smrizeNm" name="smrizeNm" onkeyUp="if(window.event.keyCode == 8){smrizeId.value = ''};" readonly required msg="총괄PM"> -->
<!-- 	                                <a onclick="openUserSearch();"> -->
<!-- 	                                    <i class="i_search_w"></i> -->
<!-- 	                                </a> -->
<!-- 	                            </div> -->
<!-- 	                            <td colspan="5"> -->
<!-- 	                            </td>                                                              -->
<!-- 	                            </tr> -->
<!-- 	                            <tr style="height:150px;text-align: left;">                          -->
<!-- 	                                <th>비고<br>(1000자)</th>                             -->
<!-- 	                                <td colspan="8">    -->
<!-- 	                                <textarea id="sjRmk" name="sjRmk" cols="40" rows="24" style="border:none;outline: none;"></textarea>                                                                                    -->
<!-- 	                                </td> -->
<!-- 	                            </tr> -->
<!-- 	                    </table>                     -->
<!-- 	                  </form>                  -->
<!-- 	                </div>                     -->
<!-- 	        </div> -->
<!-- 	      </div> -->
<!--      </div>   -->
  </div> 
 
</body>
</html>

<script type="text/javascript">
var isFirst = true;
var actionType = null;
var fileTrgtKey = null;
var verNo_S = null;

ax5.ui.grid.formatter["chkYn"] = function () {
    var color = this.value == "Y" ? "color-circle_02.png" : "color-circle_01.png";
    if (this.value == "E"){
        return ' ';
    } else {
        return '<img src="/static/img/'+color+'" style="width: 10px;height: 10px;"></img>';
    }
};

var gridView = {
        initView : function() {
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: false,
                multipleSelect: false,
                sortable: false,
                target: $('[data-ax5grid="first-grid"]'),
                header : {
                    align : "center",
                    selector : false
                },
               columns: [
            	   {key: "rn",  label: "NO.",  align: "center",   width: 40},
                   {key: "fileTrgtKey",         label: "FileTrgtKey",      hidden:true},
                   {key: "coCd",  label: "회사코드", width: 80, hidden:true},
                   {key: "clntCd",  label: "고객사", width: 80, hidden:true},
                   {key: "clntNm", label: "고객사명", align: "center", width: 120 },
                   {key: "clntPjt",          label: "고객사프로젝트",      hidden:true},
		       	   {key: "clntPjtNm",        label: "고객사프로젝트",     width: 100,  align: "center"},
                   {key: "salesCd",  label: "SALES CD", align: "center",   width: 110},
                   {key: "sjNo",  label: "과제번호",  align: "center",   width: 80, hidden:true},
                   {key: "sjNm",  label: "과제명", align: "left",   width: 200},
                   {key: "verNo",  label: "Ver.", align: "center",   width: 50},
                   {key: "closeYn",  label: "확정", align: "center",   width: 40, formatter: "chkYn"},                    
                   {key: "maxVerNo",  label: "MAX Ver.", hidden:true},
                   {key: "ordrsNo",  label: "수주번호", align: "center",   width: 70},
                   {key: "smrizeId",   label: "총괄PM",   width: 80,   hidden: true},
                   {key: "smrizeNm",   label: "총괄PM명", align: "center",   width: 70},
                   {key: "mkerDiv",   label: "제작처구분",  width: 80,   hidden: true},
                   {key: "mkerDivNm",   label: "제작처구분", align: "center",   width: 70},
                   {key: "mkerCd",   label: "제작처",   width: 80,   hidden: true},
                   {key: "mkerNm",   label: "제작처명", align: "center",   width: 80},
                   {key: "beginDt",   label: "시작일", align: "center",   width: 80},
                   {key: "deDt",   label: "출고일", align: "center",   width: 80},
                   {key: "acptncDt",   label: "검수일", align: "center",   width: 80},
                   {key: "reqreDaycnt",   label: "소요일수", align: "center",   width: 70},
                   {key: "dsgnDifCodeId",   label: "설계난이도코드",   width: 80,   hidden: true},
                   {key: "dsgnDifCodeNm",   label: "설계난이도", align: "center",   width: 70},
                   {key: "dsgnPlanHour",   label: "설계공수", align: "center",   width: 60},
                   {key: "prdctnDifCodeId",   label: "생산난이도코드",  width: 80,   hidden: true},
                   {key: "prdctnDifCodeNm",   label: "생산난이도", align: "center",   width: 70},
                   {key: "prdctnPlanHour",   label: "생산공수", align: "center",   width: 60},
                   {key: "prdtCd",   label: "제품코드",   hidden: true},
                   {key: "prdtNm",   label: "제품명",   hidden: true},
                   {key: "sjRmk",   label: "비고",   hidden:false,   width: "*"},
                   {key: "creatId",      label: "생성자",      hidden: true},
                   {key: "creatNm",      label: "생성자명",      hidden:true},
                   {key: "creatPgm",      label: "생성프로그램ID",      hidden: true},
                   {key: "creatDttm",      label: "생성일시",      hidden:true},                 
                   {key: "udtId",      label: "최종변경자",      hidden: true},
                   {key: "udtNm",      label: "최종변경자명",      hidden:true},
                   {key: "udtPgm",      label: "최종수정프로그램ID",     hidden: true},
                   {key: "udtDttm",      label: "최종변경일자",      hidden:true}
               ],
                body: {
                	mergeCells : ["salesCd", "clntNm","clntPjtNm"],
                    columnHeight: 26,
                    onClick: function () {
                    	this.self.select(this.dindex); 
                    	actionType = "U";
                    	fileTrgtKey = this.item.fileTrgtKey;
                    	var row = this.self.getList()[this.dindex];                    
                    },
                    onDBLClick: function () {
                    	this.self.select(this.dindex); 
                    	actionType = "U";
                    	fileTrgtKey = this.item.fileTrgtKey;
                    	var row = this.self.getList()[this.dindex];       
                    	callUpdatePopup();
  		            },
               },
               page: {
                   navigationItemCount: 9,
                   height: 30,
                   display: true,
                   firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
                   prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
                   nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                   lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
                   onChange: function () {
                       gridView.setData(this.page.selectPage);
                       pageNo = this.page.selectPage; 
                   }
                 },
            });
            return this;
        },
        setData : function(_pageNo) {
            if (isFirst) return;
            var targetObj = this.target;
            var paramObj = {
            		"coCd": $('#coCd_S').val(),
            		"salesCd": $('#salesCd_S').val(),
            		"ordrsClntNm": $('#ordrsClntNm_S').val(),
					"clntPjt": $('#clntPjt_S').val(),
            		"beginDt": $('#beginDt_S').val(),
            		"deDt": $('#deDt_S').val(),
            		"sjNm": $('#sjNm_S').val(),
            		"closeYn": $('#closeYn_S').val(),
            		"pageNo" : _pageNo + 1, 
                    "recordCnt" : $("#recordCnt").val()
                    };
            postAjax("/user/wb/wb21/selectSjList", paramObj, null, function(data){
            	var list = data.resultList;
                targetObj.setData({
                    list : list,
                    page : {
                           currentPage : _pageNo,
                           pageSize : data.paginationInfo.pageSize,
                           totalElements : data.paginationInfo.totalRecordCount,
                           totalPages : data.paginationInfo.totalPageCount
                    } 
                });
                if(list.length > 0){
					// 리스트의 길이를 얻어옵니다.
					var listLength = list.length;
					console.log("listLength : " + listLength);
					console.log("verNo_S : " + verNo_S);
					for (var i = 0; i < listLength; i++) {
					    if (list[i].verNo === verNo_S) {
					      	//그리드 선택
		                    gridView.target.select(i);
							gridView.target.focused = true;
					    }
					}

				}
            });
        } 

    }

var excelView = {
        initView: function(){
        this.target = new ax5.ui.grid();
        this.target.setConfig({
        target: $('[data-ax5grid="excel-grid"]'),
        columns: [
        	{key: "rn",  label: "NO.",  align: "center",   width: 40},
            {key: "fileTrgtKey",         label: "FileTrgtKey",      hidden:true},
            {key: "coCd",  label: "회사코드", width: 80},
            {key: "sjNo",  label: "과제번호",  align: "center",   width: 80},
            {key: "sjNm",  label: "과제명", align: "left",   width: 200},
            {key: "verNo",  label: "Ver.", align: "center",   width: 50},
            {key: "closeYn",  label: "확정", align: "center",   width: 40, formatter: "chkYn"},                    
            {key: "maxVerNo",  label: "MAX Ver.", hidden:true},
            {key: "salesCd",  label: "SALES CD", align: "center",   width: 110},
            {key: "ordrsNo",  label: "수주번호", align: "center",   width: 80},
            {key: "clntCd",  label: "고객사", width: 80},
            {key: "clntNm", label: "고객사명", align: "center", width: 120 },
            {key: "smrizeId",   label: "총괄PM",   width: 80},
            {key: "smrizeNm",   label: "총괄PM명",   width: 80},
            {key: "mkerDiv",   label: "제작처구분",  width: 80},
            {key: "mkerDivNm",   label: "제작처구분명",   width: 80},
            {key: "mkerCd",   label: "제작처",   width: 80},
            {key: "mkerNm",   label: "제작처명",   width: 80},
            {key: "beginDt",   label: "시작일",   width: 80},
            {key: "deDt",   label: "출고일",   width: 80},
            {key: "acptncDt",   label: "검수일",   width: 80},
            {key: "reqreDaycnt",   label: "소요일수",   width: 80},
            {key: "dsgnDifCodeId",   label: "설계난이도코드",   width: 80},
            {key: "dsgnDifCodeNm",   label: "설계난이도명",   width: 80},
            {key: "dsgnPlanHour",   label: "설계계획공수",   width: 80},
            {key: "prdctnDifCodeId",   label: "생산난이도코드",  width: 80},
            {key: "prdctnDifCodeNm",   label: "생산난이도명",   width: 80},
            {key: "prdctnPlanHour",   label: "생산계획공수",   width: 80},
            {key: "clntPjt",          label: "차종", width: 80},
            {key: "clntPjtNm",          label: "차종명", width: 80},
            {key: "prdtCd",   label: "제품코드",  width: 80},
            {key: "prdtNm",   label: "제품명",   width: 80},
            {key: "sjRmk",   label: "비고",   width: 80},
            {key: "creatId",      label: "생성자",      width: 80},
            {key: "creatNm",      label: "생성자명",      width: 80},
            {key: "creatPgm",      label: "생성프로그램ID",      width: 80},
            {key: "creatDttm",      label: "생성일시",      width: 80},                 
            {key: "udtId",      label: "최종변경자",     width: 80},
            {key: "udtNm",      label: "최종변경자명",      width: 80},
            {key: "udtPgm",      label: "최종수정프로그램ID",    width: 80},
            {key: "udtDttm",      label: "최종변경일자",      width: 80}
           ]
        });
        return this;
    }
}        

$(document).ready(function() {
    mainDefaultLoad("실행계획", "과제관리");
    setCommonSelect($("#main_area select[data-kind]"));
    
    $('#coCd').val(jwt.coCd);
    $('#userId').val(jwt.userId);
    $('#coCd_S').val(jwt.coCd);
    
    isFirst = false; 
    
     $('#beginDt_S').datepicker({
        format : "yyyy-mm-dd",
        language : "ko",
        autoclose : true
      })
     .datepicker("setDate", moment(new Date()).startOf("month").toDate())
     .on("changeDate", function(){
	     if($('#beginDt_S').val() > $('#deDt_S').val()){
             alert("시작일과 출고일를 확인해주세요");
             $('#beginDt_S').datepicker("setDate", new Date($('#deDt_S').val()));
	     }
	     gridView.setData(0);
      });
     
     $('#deDt_S').datepicker({
        format : "yyyy-mm-dd",
        language : "ko",
        autoclose : true
      })
     .datepicker("setDate",  moment(new Date()).endOf("month").toDate())
     .on("changeDate", function(){
    	 gridView.setData(0);
      });
    
    gridView.initView().setData(0);
    excelView.initView();
})

function dateChk() {
	 if($('#beginDt').val() != "" && $('#deDt').val() != "" && $('#beginDt').val() > $('#deDt').val()){
        alert("시작일과 출고일이 맞지 않습니다.");
        $('#beginDt').datepicker("setDate", $('#deDt').val());
        return;
	}
	if($('#beginDt').val() != "" && $('#acptncDt').val() != "" && $('#beginDt').val() > $('#acptncDt').val()){
        alert("시작일과 완료 검수일이 맞지 않습니다.");
        $('#beginDt').datepicker("setDate", $('#acptncDt').val());
        return;
    }
	
	if($('#deDt').val() != "" && $('#acptncDt').val() != "" && $('#deDt').val() > $('#acptncDt').val()){
        alert("출고일과 완료 검수일이 맞지 않습니다.");
        $('#acptncDt').datepicker("setDate", $('#deDt').val());
        return;
    }
	
	$('#reqreDaycnt').val(calcDate()); 
}

 // 고객사 검색
 function openClntSearch() {
     var paramObj = {
    	 "searchValue" :  $("#mkerNm").val(),
         "clntDivCd"   : "CLNTDIV12"				
     }       
     openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색", paramObj, function (grid) {
         var row = grid.target.getList("selected")[0];
         $('#mkerCd').val(row.clntCd);
         $('#mkerNm').val(row.clntNm);
     });
 }


function wbsSalesCodeSearch(flag) {
	if(flag != "S" && actionType == "U"){
		alert("SALES CODE는 수정 불가합니다.");
		return;
	}
    var paramObj = {};
    if (flag == "S") {
    	paramObj["coCd"] = $('#coCd_S').val();
        paramObj["searchValue"] = $('#salesCd_S').val();
    }
    else {
    	paramObj["coCd"] = jwt.coCd;
        paramObj["searchValue"] = $('#salesCd').val();
    }
    console.log(flag);
    openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 980, 550, "SALES CODE 검색", paramObj, function (grid){
        var row = grid.target.getList("selected")[0];
        if (flag == "S") {
        	$('#salesCd_S').val(row.salesCd);
        	gridView.setData(0);
        }
        else {
//         	console.log(row);
        	$('#salesCd').val(row.salesCd);
        	$('#clntCd').val(row.ordrsClntCd);
        	$('#clntNm').val(row.ordrsClntNm);
        	$('#prdtCd').val(row.prdtCd);
            $('#prdtNm').val(row.prdtCdNm);     	
            $('#clntPjt').val(row.clntPjt);
            $('#clntPjtNm').val(row.clntPjtNm);
            
            //과제명 = 설비명 적용 후 수정 불가
            $('#sjNm').val(row.eqpNm);
            $('#sjNm').prop('readonly', true);
            
        }
    });
}

function calcDate() {
	var date1 = new Date($('#beginDt').val().substr(0,4), $('#beginDt').val().substr(5,2), $('#beginDt').val().substr(8,2));
    var date2 = new Date($('#acptncDt').val().substr(0,4), $('#acptncDt').val().substr(5,2), $('#acptncDt').val().substr(8,2));
    
	return calculateHolidayCnt($('#beginDt').val(), $('#acptncDt').val()).workingDays;
}

//신규 등록
function cretSjNo() {
 	actionType = "C";
 	fileTrgtKey = null;
 	
	var paramObj = {
       	"userId"   : jwt.userId,
       	"fileTrgtKey" : "",
       	"pgmId"    : "WB2101M02"
	};
	
	openModal("/static/html/user/wb/wb21/WB2101P01.html", 1200, 800, "과제관리등록", paramObj);
	
}

//수정 팝업
function callUpdatePopup() {
	var row = gridView.target.getList("selected")[0];
	var paramObj = {
		"sjNo"     : row.sjNo,
		"verNo"    : row.verNo,
		"fileTrgtKey" : row.fileTrgtKey,
		"coCd" 	   : row.coCd,
       	"userId"   : jwt.userId,
       	"pgmId"    : "WB2101M02",
       	"row"	   : row
	};
	
	openModal("/static/html/user/wb/wb21/WB2101P01.html", 1200, 800, "과제관리수정", paramObj);
	
}

function openUserSearch() {
    var paramObj = {};
    paramObj["userId"] = $('#popForm #smrizeId').val();
    paramObj["useYn"] =  "Y";
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "총괄PM 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#popForm #smrizeId').val(checkedNode.id);
        $('#popForm #smrizeNm').val(checkedNode.text);
    });
}

function initSearch() {
    $('[data-search]').off("change");   //바인딩기능 오프
    $('.contents.search select, .contents.search input').val("");
    
    $("#beginDt_S").val(dateToStr( moment(new Date()).startOf("month").toDate() ));
    $("#deDt_S").val(dateToStr( moment(new Date()).endOf("month").toDate() ));

    $("#coCd_S").val(jwt.coCd);
    gridView.initView().setData(0);
    
}

function searchList() {
	gridView.initView().setData(0);
}

function excelDown() {
	var paramObj = {
            "coCd": $('#coCd_S').val(),
            "salesCd": $('#salesCd_S').val(),
            "beginDt": $('#beginDt_S').val(),
            "deDt": $('#deDt_S').val(),
            "sjNm": $('#sjNm_S').val(),
            "pageNo" : 1, 
            "recordCnt" : 9999999
            };
    postAjax("/user/wb/wb21/selectSjList", paramObj, null, function(data){
        var list = data.resultList;
        excelView.target.setData({
            list : list,
            page : {
            	totalElements : list.length,
            } 
        });
        var todayDate = new Date().format('yyyyMMddHHmmss');
        excelView.target.exportExcel("WBS과제관리리스트"+todayDate+".xls");
    }); 
}      

// 거래처 검색 함수
function opendClntSearch(inputValue) {
	var paramObj = {
            "searchValue" : inputValue,
            "clntDivCd"   : "CLNTDIV12"
        };
	openModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색", paramObj, function(grid) {
		var row = grid.target.getList("selected")[0];
		$('#ordrsClntCd_S').val(row.clntCd);
		$('#ordrsClntNm_S').val(row.clntNm);
		gridView.setData(0);
	});
}

//회사 변경시 과제등록 기능 잠금
function changeCocd() {
	if($("#coCd_S").val() == jwt.coCd){
		$("#cretSjNo").show();
	}else{
		$("#cretSjNo").hide();
	}
} 
</script>
