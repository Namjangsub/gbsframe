<div id="wbsPopupRslt" class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
        <h4 class="tit">TASK 실적 및 결재 관리</h4>
    </div>
    
    <div class="popup_table">
        <div class="form-group">
            <form id="popFormRslts">
                <input type="hidden" id="userId" name="userId">
                <input type="hidden" id="userNm" name="userNm">
                <input type="hidden" id="telNo" name="telNo">
                <input type="hidden" id="pgmId" name="pgmId" value="WB2201P02">
                
                <table class="popup_table">
                    <colgroup>
                        <col width="15%">
                        <col width="35%">
                        <col width="15%">
                        <col width="35%">
                    </colgroup>                  
                    <thead>
                        <tr>
                            <td colspan="4" style="height:30px;text-align: left;">▣ 기본 정보</td>                                                
                        </tr>
                    </thead>
                    <tr style="text-align: left;">  
                        <th>TASK명</th>
                        <td colspan="3"> 
                            <input type="text" class="form-control" id="wbsPlanCodeNm" name="wbsPlanCodeNm" readonly>
                            <input type="hidden" id="coCd" name="coCd">      
                            <input type="hidden" id="salesCd" name="salesCd2_P">      
                            <input type="hidden" id="wbsPlanNo" name="wbsPlanNo"> 
                            <input type="hidden" id="wbsPlanCodeKind" name="wbsPlanCodeKind2_P">
                            <input type="hidden" id="wbsPlanCodeId" name="wbsPlanCodeId2_P">
                        </td>
                    </tr>
                    <tr style="text-align: left;">
                        <th>계획 일정</th>
                        <td colspan="3">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <input type="text" class="form-control" id="wbsPlansDt" style="width: 120px;" readonly>
                                <span>~</span>
                                <input type="text" class="form-control" id="wbsPlaneDt" style="width: 120px;" readonly>
                                <span style="margin-left: 10px;">(소요일수:</span>
                                <input type="text" class="form-control" id="daycnt" style="width: 60px; text-align: center;" readonly>
                                <span>일)</span>
                            </div>
                        </td>
                    </tr>

                    <thead>
                        <tr>
                            <td colspan="4" style="height:30px;text-align: left;">▣ 실적 및 상태 정보</td>
                        </tr>
                    </thead>                    
                    <tbody>
                        <tr style="text-align: left;">
                            <th class="hit">실적 시작일</th>
                            <td>
                                <div class="date_input">
                                    <input type="hidden" id="wbsRsltsNo" name="wbsRsltsNo">
                                    <input type="hidden" id="wbsRsltsId" name="wbsRsltsId">
                                    <input type="hidden" id="rsltsDaycnt" name="rsltsDaycnt">    
                                    <input type="hidden" id="rsltsFileTrgtKey" name="rsltsFileTrgtKey">
                                    <input type="text" class="input_calendar form-control" id="wbsRsltsSDt" name="wbsRsltssDt" autocomplete="off" onchange="dateChk();" required msg="실적 시작일">
                                </div>
                            </td>
                            <th>실적 종료일</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar form-control" id="wbsRsltsEDt" name="wbsRsltseDt" autocomplete="off" onchange="dateChk();" msg="실적 종료일"> 
                                </div>
                            </td>
                        </tr>
                        <tr style="text-align: left;">
                            <th class="hit">진척율 (%)</th>
                            <td>
                                <input type="number" class="form-control" id="actProgress" name="wbsRsltsRate" required msg="진척율" min="0" max="100">
                            </td>
                            <th class="hit">투입공수 (MH)</th>
                            <td>
                                <input type="number" class="form-control" id="wbsRsltsMh" name="wbsRsltsMh" required msg="실투입공수" step="0.1">
                            </td>
                        </tr>
                        <tr style="text-align: left;">
                            <th class="hit">상태</th>
                            <td>
                                <select class="form-control" id="wbsPlanStsCodeId" name="wbsPlanStsCodeId" required onchange="toggleRevisedDt();">
                                    <!-- Options will be populated via JS -->
                                </select>
                            </td>
                            <th id="thRevisedFinishDt" style="display: none;">완료예정일</th>
                            <td id="tdRevisedFinishDt" style="display: none;">
                                <div class="date_input">
                                    <input type="text" class="input_calendar form-control" id="revisedFinishDt" name="revisedFinishDt" autocomplete="off">
                                </div>
                            </td>
                        </tr>
                        <tr style="text-align: left;">
                            <th>특이사항</th>
                            <td colspan="3">
                                <textarea id="wbsRsltsCnts" name="wbsRsltsCnts" class="form-control" style="height: 80px;"></textarea> 
                            </td>
                        </tr> 
                    </tbody>                    
                </table>

                <div style="margin-top: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <span style="font-size:13px; font-weight:bold;">▣ 공유 및 결재</span>
                        <div class="add_btn_small">       
                            <a onclick="insertShareUserModal();" style="height: 24px; line-height: 22px;">+</a>
                            <a onclick="deleteShareUser();" style="height: 24px; line-height: 22px;">-</a>    
                        </div>
                    </div>
                    <div class="ax5_grid" data-ax5grid="first-grid-modal" style="height: 180px; width: 100%;"></div>
                </div>

            </form>
        </div>
    </div>    

    <div class="contents"> 
        <!-- 공통 파일 영역 -->
        <div id="fileList_area" style="margin-top: 20px;"></div>       
    </div>
    
    <div class ="popup_bottom_btn">
        <button type="button" id="actionBtn" class="btn primary">저장</button>
        <button type="button" class="close_btn" onclick="modalStack.close();">닫기</button>
    </div>
</div>   

<script type="text/javascript">
    const STS_NAME = {
        "WBSPLANSTS10": "미진행",
        "WBSPLANSTS20": "진행중",
        "WBSPLANSTS30": "지연",
        "WBSPLANSTS40": "지연완료",
        "WBSPLANSTS50": "정상완료"
    };

    var actionType = null;
    var evlCloseChk = "N";
    var kakaoErr = [];

    var gridViewPop = {
        initView: function() {
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: true,
                multipleSelect: false,
                target: $('#wbsPopupRslt [data-ax5grid="first-grid-modal"]'),
                header: { align: "center", selector: true },
                body: {
                    onClick: function () { this.self.select(this.dindex); },
                    mergeCells: ["gb"],
                },
                columns: [
                    {key: "gb", label: "구분", align: "center", width: 60},
                    {key: "name", label: "성명", align: "center", width: 80},
                    {key: "jik", label: "직위", align: "center", width: 80},
                    {key: "dtNm", label: "부서", align: "center", width: 120},
                    {key: "todoCfDt", label: "확인일자", align: "center", width: 100},
                    {key: "todoCfOpn", label: "확인의견", align: "left", width: 200},
                ]
            });
            return this;
        },
        setData: function() {
            var targetObj = this.target;
            var formData = {
                "fileTrgtKey": $("#popFormRslts #rsltsFileTrgtKey").val(),
                "reqNo": $("#popFormRslts #wbsRsltsNo").val(), 
                "flag": "N"
            }
            postAjax("/user/qm/qm01/selectShareUserlst", formData, null, function(data){    
                if(data.result) targetObj.setData({ list: data.result, page: { totalElements: data.result.length } });
            });
        },
        setData2: function(_list) {
            this.target.setData({ list: _list, page: { totalElements: _list.length } });
        }
    }

    $(document).ready(function() {
        var param = modalStack.last().paramObj;
        actionType = param.actionType;
        $("#popFormRslts #userId").val(jwt.userId);
        $("#popFormRslts #userNm").val(jwt.userNm);
        // 필드 바인딩 (Detail에서 넘어온 값들)
        $.each(param, function (key, val) {
            var targetId = key.replace("_P", "");
            var el = $("#popFormRslts #" + targetId);
            if (el.length) el.val(val);
        });

        // 상태 코드 콤보박스 수동 생성 (WB0604M01과 동기화)
        var stsSelect = $("#popFormRslts #wbsPlanStsCodeId");
        $.each(STS_NAME, function(code, name) {
            stsSelect.append($('<option>', { value: code, text: name }));
        });
        if(param.wbsPlanStsCodeId_P) stsSelect.val(param.wbsPlanStsCodeId_P);

        // Datepickers
        $("#popFormRslts #wbsRsltsSDt, #popFormRslts #wbsRsltsEDt, #popFormRslts #revisedFinishDt").datepicker({
            format: "yyyy-mm-dd",
            language: "ko",
            autoclose: true,
            todayHighlight: true
        });

        // 초기 지연 상태 체크
        toggleRevisedDt();

        // 팝업 타이틀 및 버튼 텍스트 설정
        if (!param.rsltsFileTrgtKey_P || param.rsltsFileTrgtKey_P == "0") {
            $(".tit").text("TASK 실적 등록 및 결재");
            $(".popup_bottom_btn #actionBtn").text("등록");
            $(".popup_bottom_btn #actionBtn").on("click", insertWbsRslts);
            toggleRevisedDt();
        } else {
            $(".tit").text("TASK 실적 수정 및 결재");
            $(".popup_bottom_btn #actionBtn").text("수정");
            $(".popup_bottom_btn #actionBtn").on("click", updateWbsRslts);
            selectWbsRsltsInfo();
            gridViewPop.initView().setData();
        }

        // 파일 첨부 모듈 초기화
        var fileParam = {
            fileTrgtTyp: $("#popFormRslts #pgmId").val(),
            fileTrgtKey: $("#popFormRslts #rsltsFileTrgtKey").val() || "0"
        }
        treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);

        getJwtTelNo();
        authChk();

        // 과제 평가 완료 시 버튼 숨김 처리
        var closeParam = {
            "coCd" : $("#popFormRslts #coCd").val(),
            "salesCd" : $("#popFormRslts #salesCd").val(),
        }; 
        postAjaxSync("/user/wb/wb25/selectEvlCloseChk", closeParam, null, function(data){
            if (data.result && data.result[0] && data.result[0].closeChk == "Y") {
                evlCloseChk = data.result[0].closeChk;
                $(".popup_bottom_btn #actionBtn").hide();
            }
        });
    });

    function toggleRevisedDt() {
        var isDelayed = $("#popFormRslts #wbsPlanStsCodeId").val() === "WBSPLANSTS30";
        $("#popFormRslts #thRevisedFinishDt, #popFormRslts #tdRevisedFinishDt").toggle(isDelayed);
    }

    function selectWbsRsltsInfo() {
        var fkey = $("#popFormRslts #rsltsFileTrgtKey").val();
        if(!fkey || fkey === "0") return;

        var paramObj = { "fileTrgtKey": fkey };
        postAjax("/user/wb/wb22/selectTodoRsltsView", paramObj, null, function(data) {
            if (data.resultList && data.resultList.length > 0) {
                var info = data.resultList[0];
                
                // 1. 자동 매핑 (ID가 동일한 경우)
                $.each(info, function(key, val) {
                    var $el = $("#popFormRslts #" + key);
                    if ($el.length && (val !== null && val !== undefined)) {
                        $el.val(val);
                    }
                });
                
                // 2. 수동 매핑 (ID 불일치 또는 특수 처리)
                if(info.wbsRsltssDt) $("#popFormRslts #wbsRsltsSDt").val(info.wbsRsltssDt);
                if(info.wbsRsltseDt) $("#popFormRslts #wbsRsltsEDt").val(info.wbsRsltseDt);
                if(info.wbsRsltsRate !== undefined) $("#popFormRslts #actProgress").val(info.wbsRsltsRate);
                if(info.wbsRsltsCnts) $("#popFormRslts #wbsRsltsCnts").val(info.wbsRsltsCnts);
                if(info.wbsRsltsMh) $("#popFormRslts #wbsRsltsMh").val(info.wbsRsltsMh);
                
                // 계획 정보 매핑 (info.wbsPlansDt2 -> #wbsPlansDt 등)
                if(info.wbsPlansDt2) $("#popFormRslts #wbsPlansDt").val(info.wbsPlansDt2);
                if(info.wbsPlaneDt2) $("#popFormRslts #wbsPlaneDt").val(info.wbsPlaneDt2);
                if(info.daycnt2) $("#popFormRslts #daycnt").val(info.daycnt2);
                if(info.wbsPlanCodeNm2) $("#popFormRslts #wbsPlanCodeNm").val(info.wbsPlanCodeNm2);
                if(info.wbsRsltsId) {
                	// 담당자가 있을 경우 hidden 필드에도 반영
                	$("#popFormRslts #wbsRsltsId").val(info.wbsRsltsId);
                }
                
                toggleRevisedDt();
            }
        });
    }

    function dateChk() {
        var s = $('#popFormRslts #wbsRsltsSDt').val();
        var e = $('#popFormRslts #wbsRsltsEDt').val();
        if(s && e && e < s) {
            alert("실적 종료일이 시작일보다 빠를 수 없습니다.");
            $('#popFormRslts #wbsRsltsEDt').val(s);
        }
        $('#popFormRslts #rsltsDaycnt').val(calculateCalendarCnt($('#popFormRslts #wbsRsltsSDt').val(), $('#popFormRslts #wbsRsltsEDt').val()));
    }

    function calculateCalendarCnt(startDate, endDate) {
        if (!startDate || !endDate) return "";
        const toUTC = (d) => {
            if (d instanceof Date) return Date.UTC(d.getUTCFullYear(), d.getUTCMonth(), d.getUTCDate());
            if (typeof d === 'string') {
                const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(d);
                if (!m) return NaN;
                return Date.UTC(+m[1], +m[2] - 1, +m[3]);
            }
            return NaN;
        };
        const startDay = toUTC(startDate);
        const endDay   = toUTC(endDate);
        if (!Number.isFinite(startDay) || !Number.isFinite(endDay)) return "";
        if (endDay < startDay) return 0;
        return Math.floor((endDay - startDay) / 86400000) + 1;
    }

    function makeFormData() {
        var formData = new FormData($("#popFormRslts")[0]);
        formData.append("comonCd", treeModule.getFileNodeId());

        var fileUploadArr = [];
        $.each(treeModule.getFileArr(), function(idx, obj) {
            if (obj.fileKey == 0) {
                formData.append("files", obj.file);
                obj.file = '';
                fileUploadArr.push(obj);
            }
        });
        formData.append("uploadFileArr", JSON.stringify(fileUploadArr));
        formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));

   formData.append("approvalYnCnt", approvalYn());
    
   var rowSharngList = gridViewPop.target.list;
   var ParamObj = modalStack.last().paramObj.ParamObj;
   if(rowSharngList.length > 0) {
       var rowSharngListArr = []; //공유정보
       var rowApprovalListArr = []; //결재정보
       $.each(rowSharngList, function(idx, elem){
           var rowSharngListObj = elem;
           var rowApprovalListObj = elem;

           if (elem.gb == '공유'){
               rowSharngListObj["gb"] = elem.gb;
               rowSharngListObj["coCd"] = $('#coCd').val();
               rowSharngListObj["salesCd"] = $("#popFormRslts #salesCd").val()
               rowSharngListObj["todoDiv1CodeId"] = "TODODIV10";
               rowSharngListObj["todoDiv2CodeId"] = "TODODIV1020";
               rowSharngListObj["todoId"] = elem.usrNm;
               rowSharngListObj["todoCoCd"] = elem.coCd;
               rowSharngListObj["empNo"] = elem.empNo;
               rowSharngListObj["name"] = elem.name;
               rowSharngListObj["telNo"] = elem.telNo;
               rowSharngListObj["email"] = elem.eMail;    
               rowSharngListObj["pgPath"] = "/user/wb/wb22/WB2201P03.html";
               rowSharngListArr.push(rowSharngListObj);

           }
           else if (elem.gb == '결재'){
               rowApprovalListObj["gb"] = elem.gb;
               rowApprovalListObj["coCd"] = $('#coCd').val();
               rowApprovalListObj["salesCd"] = $("#popFormRslts #salesCd").val()
               rowApprovalListObj["todoDiv1CodeId"] = "TODODIV20";
               rowApprovalListObj["todoDiv2CodeId"] = "TODODIV2010";
               rowApprovalListObj["todoId"] = elem.usrNm;
               rowApprovalListObj["todoCoCd"] = elem.coCd;
               rowApprovalListObj["empNo"] = elem.empNo;
               rowApprovalListObj["name"] = elem.name;
               rowApprovalListObj["telNo"] = elem.telNo;
               rowApprovalListObj["email"] = elem.eMail;    
               rowApprovalListObj["pgPath"] = "/user/wb/wb22/WB2201P03.html";
               rowApprovalListArr.push(rowApprovalListObj);
           }
       });
       formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));
       formData.append("rowApprovalListArr", JSON.stringify(rowApprovalListArr));
   }
        
        return formData;
    }

    function validate() {
        if(!inputValidation($('#popFormRslts [required]'))) return false;
        
        var rate = parseInt($("#popFormRslts #actProgress").val());
        var endDt = $("#popFormRslts #wbsRsltsEDt").val();
        
        if(rate < 100) {
            if(endDt){
                alert("진척율이 100 미만이면 종료일자가 없어야 합니다.");
                return false;
            }
        } else if(rate > 100) {
            alert("진척율은 100을 초과할 수 없습니다.");
            return false;
        } else {
            if(!endDt){
                alert("진척율이 100%이면 종료일자가 필수입니다.");
                return false;
            }
        }
        
        // 종료일자가 없으면 소요일자도 없다.
        if(!endDt) {
            $('#popFormRslts #rsltsDaycnt').val('');
        }

        if(parseFloat($("#popFormRslts #wbsRsltsMh").val()) <= 0) {
            alert("실투입공수 값을 입력해주세요.");
            return false;
        }
        return true;
    }

    function approvalYn() {
        var gridList = gridViewPop.target.getList();
        var inCnt = 0;
        if( gridList.length > 0 ) {
            $.each(gridList, function (idx, elem) { 
                if( elem.usrNm != jwt.userId && elem.sanctnSttus == "Y" ) inCnt++;
            })
        }
        return inCnt;
    }

    function kakaoTodo() {
        if (kakaoErr.length == 0) {
            var paramObj = { "userId" : jwt.userId, "codeKind" : "KAKAOMSG" };
            postAjaxSync("/user/sm/sm02/selectCurrToday", paramObj, null, function(data) {
                if(data.resultList.length > 0 ) kakaoErr = data.resultList;
            });   
        }
        
        let clntNm = (jwt.coCd=="GUN") ? "(주)건양ITT" : "트루넷";
        var taskNm = $('#popFormRslts #wbsPlanCodeNm').val();
        var jobType = (actionType == "C") ? " 입력" : " 수정";
        var statusVal = "진척율:" + $('#popFormRslts #actProgress').val() + "%, 투입공수:" + $('#popFormRslts #wbsRsltsMh').val();
        taskNm += jobType + "\n" + statusVal;

        // 공유
        let param = {
            "tmplatDiv": "TMPLATDIV02",
            "coCd": $('#popFormRslts #coCd').val(),
            "todoDiv1CodeId": "TODODIV10",
            "todoDiv2CodeId": "TODODIV1020",
            "todoDiv1CodeNm": "공유",
            "todoDiv2CodeNm": taskNm,
            "sanctnDiv2": "공유",
            "todoNo": $("#popFormRslts #wbsRsltsNo").val(),
            "clntCd": "1",
            "clntNm": clntNm,
            "ordrgMngNm": jwt.userNm,
            "ordrgMngTelNo": $("#popFormRslts #telNo").val(),
            "creatPgm": "WB0604P02"
        }
        commKaKaoSendTodo(param);

        // 결재
        let param2 = JSON.parse(JSON.stringify(param));
        param2.todoDiv1CodeId = "TODODIV20";
        param2.todoDiv2CodeId = "TODODIV2010";
        param2.todoDiv1CodeNm = "결재";
        param2.sanctnDiv2 = "결재";
        commKaKaoSendTodo(param2);
    }

    function commKaKaoSendTodo(param) {
        var sendList = [];
        postAjaxSync("/user/bm/bm18/selectMaxMessageIdTodo", param, null, function(data) {
            if(data.resultList.length > 0 && data.resultList[0].maxMessageId != "") {
                sendList = data.resultList; 
                $.each(sendList, function (key, sendObj) {
                    let talkParam = { authToken: "e/eDfZOFCsrBqadaECQ0+g==", serverName: "gyitt2400", paymentType: "P" };
                    let talkBody = {
                        service: "2310086157",
                        messageId: sendObj.maxMessageId,
                        mobile: sendObj.telNo,
                        template: "10003"
                    };
                    
                    param.rcvId = sendObj.todoId;
                    param.rcvNm = sendObj.name;
                    param.nameTo = sendObj.name;
                    param.title = sendObj.todoTitl;
                    param.sendDt = sendObj.sendDt;
                    
                    if(!talkBody.mobile) { alert('수신전화번호가 없습니다.'); return; }
                    
                    let message = sendObj.messageDesc;
                    let splitStr = Array.from(message.matchAll('\\{(.*?)\\}'), match => `${match[0]}`);	
                    $.each(splitStr, function (k, v) {		
                        let compKey = v.substring(1, v.length-1);
                        if(compKey && typeof(param[compKey]) != "undefined") {
                            message = message.replaceAll('#'+v, param[compKey]);
                        }
                    });

                    talkBody.title = sendObj.todoTitl.length > 50 ? sendObj.todoTitl.substring(0, 49) : sendObj.todoTitl;
                    talkBody.message = message;
                    kakaoSendReal(JSON.stringify(talkBody), talkParam, param);
                });
            }
        });
    }

    function insertWbsRslts() {
        if(!validate()) return;
        var formData = makeFormData();
        filePostAjax("/user/wb/wb22/wbsRsltsInsert", formData, function(data) {
            if (data.resultCode == 200) {
                alert("등록되었습니다.");
                if (data.wbsRsltseDt === "") {
                    $('#popFormRslts #wbsRsltsEDt').datepicker("setDate", new Date());
                }
                kakaoTodo();
                if(modalStack.last().callback) modalStack.last().callback();
                modalStack.close();
            }
        });
    }

    function updateWbsRslts() {
        if(!validate()) return;
        var formData = makeFormData();
        filePostAjax("/user/wb/wb22/wbsRsltsUpdate", formData, function(data) {
            if (data.resultCode == 200) {
                alert("수정되었습니다.");
                if (data.wbsRsltseDt === "") {
                    $('#popFormRslts #wbsRsltsEDt').datepicker("setDate", new Date());
                }
                kakaoTodo();
                if(modalStack.last().callback) modalStack.last().callback();
                modalStack.close();
            }
        });
    }

    function insertShareUserModal() {
        if (evlCloseChk == "Y") {
            alert("해당 SALES CODE 과제는 평가 완료 되었습니다.");
            return;
        }
        if (approvalYn() > 0) {
            alert("결재가 이미 진행중입니다.");
            return;
        }
        var paramObj = { coCd: $('#popFormRslts #coCd').val(), useYn: "Y" };
        var list = gridViewPop.target.list || [];
        paramObj.approvalGrid = list.filter(i => i.gb==='결재').map(i => ({id: i.usrNm, text: i.name, parent: i.jik, deptNm: i.dtNm, telNo: i.telNo, email: i.email}));
        paramObj.shareGrid = list.filter(i => i.gb==='공유').map(i => ({id: i.usrNm, text: i.name, parent: i.jik, deptNm: i.dtNm, telNo: i.telNo, email: i.email}));

        openThirdModal("/static/html/cmn/modal/userLstSearch.html", 900, 500, "조직도 검색", paramObj, function(appGrid, shaGrid) {
            var res = [];
            appGrid.target.list.forEach(i => res.push({gb: "결재", usrNm: i.id, name: i.text, jik: i.parent, dtNm: i.deptNm, telNo: i.telNo, email: i.email}));
            shaGrid.target.list.forEach(i => res.push({gb: "공유", usrNm: i.id, name: i.text, jik: i.parent, dtNm: i.deptNm, telNo: i.telNo, email: i.email}));
            gridViewPop.setData2(res);
        });
    }

    function deleteShareUser() {
        if (evlCloseChk == "Y") {
            alert("해당 SALES CODE 과제는 평가 완료 되었습니다.");
            return;
        }
        if (approvalYn() > 0) {
            alert("결재가 이미 진행중입니다.");
            return;
        }
        var idx = gridViewPop.target.selectedDataIndexs[0];
        if(idx === undefined) { alert("삭제할 행을 선택하세요."); return; }
        gridViewPop.target.removeRow(idx);
    }

    function getJwtTelNo() {
        postAjaxSync("/user/wb/wb24/selectMemberTelNo", { coCd: jwt.coCd, userId: jwt.userId }, null, function(data) {
            $("#popFormRslts #telNo").val(data.result && data.result[0] ? data.result[0].telNo : "051-312-2400");
        });
    }

</script>
