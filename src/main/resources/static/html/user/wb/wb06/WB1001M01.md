# WB1001M01 Drawing Editor 요구사항 명세서

## 1. 개요/범위

### 1.1 개요
WB1001M01 Drawing Editor는 웹 기반 벡터 드로잉 편집기로, 사용자가 직관적인 UI를 통해 도형, 화살표, 텍스트, 자유 곡선 등을 그리고 편집할 수 있는 도구입니다. Canvas API를 기반으로 하며, 로컬 스토리지, 파일 입출력, 서버 연동을 통한 데이터 저장/불러오기 기능을 제공합니다.

### 1.2 범위
- **포함**: 기본 도형 그리기(사각형, 타원, 화살표, 펜, 텍스트), 선택/이동/리사이즈, 속성 편집(색상, 선 두께, 투명도), 실행취소/다시실행, 저장/불러오기(로컬/파일/서버), 내보내기(JSON), 줌/패닝
- **비포함**: 이미지 파일 가져오기, 레이어 관리, 협업 기능, PDF/SVG 내보내기

## 2. 페르소나

| 페르소나 | 역할 | 특징 | 주요 요구사항 |
|---------|------|------|-------------|
| PM 관리자 | 프로젝트 관리자 | 업무 다이어그램 작성, 수정 권한 보유 | 빠른 드로잉, 서버 저장, 공유 기능 |
| 담당자 | 실무 담당자 | 개인 작업 스케치, 노트 작성 | 로컬 자동 저장, 간편한 도구 |
| 영업총괄PM | 승인권자 | PM 일정 확정 후 수정 불가 | 권한 제어, 읽기 전용 모드 |

## 3. 사용자 스토리

### 3.1 기본 도형 그리기
- **US-01**: 사용자는 직사각형을 그리기 위해 사각형 도구를 선택하고 캔버스에서 드래그할 수 있어야 한다.
- **US-02**: 사용자는 타원을 그리기 위해 타원 도구를 선택하고 캔버스에서 드래그할 수 있어야 한다.
- **US-03**: 사용자는 화살표를 그리기 위해 화살표 도구를 선택하고 캔버스에서 드래그할 수 있어야 한다.
- **US-04**: 사용자는 자유 곡선을 그리기 위해 펜 도구를 선택하고 캔버스에서 드래그할 수 있어야 한다.
- **US-05**: 사용자는 텍스트를 추가하기 위해 텍스트 도구를 선택하고 캔버스를 클릭하여 텍스트를 입력할 수 있어야 한다.

### 3.2 편집 기능
- **US-06**: 사용자는 선택 도구를 사용하여 도형을 선택할 수 있어야 한다.
- **US-07**: 사용자는 선택한 도형을 드래그하여 이동할 수 있어야 한다.
- **US-08**: 사용자는 선택한 도형의 크기를 조절할 수 있어야 한다.
- **US-09**: 사용자는 선택한 도형의 테두리 색상을 변경할 수 있어야 한다.
- **US-10**: 사용자는 선택한 도형의 채우기 색상을 변경할 수 있어야 한다.
- **US-11**: 사용자는 선택한 도형의 투명도를 설정할 수 있어야 한다.
- **US-12**: 사용자는 선택한 도형의 선 두께를 조절할 수 있어야 한다.
- **US-13**: 사용자는 선택한 도형을 삭제할 수 있어야 한다.
- **US-14**: 사용자는 마지막 작업을 실행 취소(Undo)할 수 있어야 한다.
- **US-15**: 사용자는 실행 취소한 작업을 다시 실행(Redo)할 수 있어야 한다.

### 3.3 뷰 기능
- **US-16**: 사용자는 캔버스를 확대할 수 있어야 한다.
- **US-17**: 사용자는 캔버스를 축소할 수 있어야 한다.
- **US-18**: 사용자는 뷰를 초기 위치로 재설정할 수 있어야 한다.
- **US-19**: 사용자는 마우스 휠로 줌 인/아웃을 할 수 있어야 한다.

### 3.4 저장/불러오기
- **US-20**: 사용자는 작업 내용을 로컬 스토리지에 자동 저장할 수 있어야 한다.
- **US-21**: 사용자는 작업 내용을 JSON 파일로 내보낼 수 있어야 한다.
- **US-22**: 사용자는 JSON 파일을 가져와 작업 내용을 불러올 수 있어야 한다.
- **US-23**: 사용자는 작업 내용을 서버에 저장할 수 있어야 한다.
- **US-24**: 사용자는 서버에서 작업 내용을 불러올 수 있어야 한다.

### 3.5 단축키
- **US-25**: 사용자는 Ctrl+Z를 눌러 실행 취소할 수 있어야 한다.
- **US-26**: 사용자는 Ctrl+Y를 눌러 다시 실행할 수 있어야 한다.
- **US-27**: 사용자는 Delete 키를 눌러 선택한 도형을 삭제할 수 있어야 한다.
- **US-28**: 사용자는 Ctrl+S를 눌러 서버에 저장할 수 있어야 한다.
- **US-29**: 사용자는 V, R, E, A, P, T 키를 눌러 각 도구로 전환할 수 있어야 한다.

## 4. 상세 기능 요구사항

| 요건번호 | 기능명 | 상세 설명 | 우선순위 |
|---------|--------|----------|----------|
| FR-01 | 도구 선택 | 왼쪽 툴바에서 도구 선택 시 현재 도구 상태 변경 및 UI 반영 | P0 |
| FR-02 | 사각형 그리기 | 드래그 시 시작점/끝점 기준 사각형 생성, 음수 좌표 정규화 | P0 |
| FR-03 | 타원 그리기 | 드래그 시 경계 상자 기준 타원 생성, rx/ry 자동 계산 | P0 |
| FR-04 | 화살표 그리기 | 드래그 시 선 그리기, 끝점에 화살표 머리 추가 | P0 |
| FR-05 | 펜 그리기 | 드래그 중 마우스 이동 경로 포인트 배열에 저장 | P0 |
| FR-06 | 텍스트 추가 | 클릭 시 프롬프트로 텍스트 입력 받아 텍스트 요소 생성 | P1 |
| FR-07 | 도형 선택 | 마우스 클릭 시 히트 테스트로 해당 요소 탐지, 선택 상태 표시 | P0 |
| FR-08 | 도형 이동 | 드래그 시 선택 요소의 좌표 갱신, 펜/텍스트 별도 처리 | P0 |
| FR-09 | 도형 리사이즈 | 선택 요소 모서리 핸들 클릭 시 해당 방향으로 크기 조절 | P1 |
| FR-10 | 속성 편집 | 선택 요소의 테두리/채우기 색상, 투명도, 선 두께 변경 | P0 |
| FR-11 | 색상 팔레트 | 미리 정의된 색상 팔레트 클릭 시 해당 색상 즉시 적용 | P1 |
| FR-12 | 도형 삭제 | 선택 요소 삭제, 요소 배열에서 제거, 재렌더링 | P0 |
| FR-13 | 실행취소 | 히스토리 스택에서 이전 상태 복원, 인덱스 관리 | P0 |
| FR-14 | 다시실행 | 히스토리 스택에서 다음 상태 복원, 인덱스 관리 | P0 |
| FR-15 | 히스토리 제한 | 히스토리 최대 50개로 제한, 초과 시 오래된 항목 삭제 | P2 |
| FR-16 | 줌 인/아웃 | 줌 레벨 0.1~5배 범위, 버튼/마우스 휠 지원 | P1 |
| FR-17 | 뷰 재설정 | 줌 1배, 캔버스 중앙 정렬 | P1 |
| FR-18 | 로컬 저장 | localStorage에 elements, properties JSON 저장 | P0 |
| FR-19 | 로컬 불러오기 | 초기화 시 localStorage에서 데이터 로드 | P0 |
| FR-20 | 파일 내보내기 | Blob 생성, 다운로드 링크 트리거, 타임스탬프 파일명 | P1 |
| FR-21 | 파일 가져오기 | FileReader로 JSON 파싱, elements/properties 병합 | P1 |
| FR-22 | 서버 저장 | POST /api/drawings, 요청 바디에 drawing 데이터 포함 | P1 |
| FR-23 | 서버 불러오기 | GET /api/drawings/{id}, 응답으로 elements/properties 로드 | P1 |
| FR-24 | 키보드 단축키 | Ctrl+Z, Ctrl+Y, Delete, Ctrl+S, V/R/E/A/P/T 지원 | P1 |
| FR-25 | 터치 지원 | 모바일 터치 이벤트를 마우스 이벤트로 변환 | P2 |
| FR-26 | 토스트 알림 | 작업 완료/실패 시 메시지 표시, 2초 후 자동 숨김 | P2 |
| FR-27 | 요소 수 표시 | 현재 요소 개수 실시간 표시 | P2 |
| FR-28 | 그리드 표시 | 배경에 20px 간격 그리드 렌더링 | P2 |

## 5. 데이터 모델 (Scene JSON)

### 5.1 Drawing Data Structure
```json
{
  "version": "1.0",
  "timestamp": "2026-01-23T12:00:00.000Z",
  "elements": [
    {
      "id": 1737648000000.1234,
      "type": "rectangle|ellipse|arrow|pen|text",
      "x": 100,
      "y": 100,
      "x2": 300,
      "y2": 200,
      "strokeColor": "#000000",
      "fillColor": "#ffffff|transparent",
      "strokeWidth": 2,
      "points": [{"x": 100, "y": 100}, {"x": 150, "y": 150}],
      "text": "텍스트 내용"
    }
  ],
  "properties": {
    "strokeColor": "#000000",
    "fillColor": "#ffffff",
    "fillTransparent": true,
    "strokeWidth": 2
  }
}
```

### 5.2 Element Type Definitions

#### Rectangle
```json
{
  "id": "number",
  "type": "rectangle",
  "x": "number",
  "y": "number",
  "x2": "number",
  "y2": "number",
  "strokeColor": "hex color",
  "fillColor": "hex color or 'transparent'",
  "strokeWidth": "number"
}
```

#### Ellipse
```json
{
  "id": "number",
  "type": "ellipse",
  "x": "number",
  "y": "number",
  "x2": "number",
  "y2": "number",
  "strokeColor": "hex color",
  "fillColor": "hex color or 'transparent'",
  "strokeWidth": "number"
}
```

#### Arrow
```json
{
  "id": "number",
  "type": "arrow",
  "x": "number",
  "y": "number",
  "x2": "number",
  "y2": "number",
  "strokeColor": "hex color",
  "strokeWidth": "number"
}
```

#### Pen
```json
{
  "id": "number",
  "type": "pen",
  "points": [{"x": "number", "y": "number"}],
  "strokeColor": "hex color",
  "strokeWidth": "number"
}
```

#### Text
```json
{
  "id": "number",
  "type": "text",
  "x": "number",
  "y": "number",
  "text": "string",
  "strokeColor": "hex color",
  "strokeWidth": "number"
}
```

## 6. 저장/불러오기

### 6.1 로컬 스토리지

#### 저장
- **Key**: `wb1001m01_drawing`
- **Value**: `{ elements: [], properties: {} }` JSON 문자열
- **타이밍**: 요소 추가/수정/삭제 시마다 `saveState()` 호출 후 자동 저장

#### 불러오기
- **타이밍**: 앱 초기화 시 `loadFromLocalStorage()` 호출
- **동작**: localStorage에서 JSON 파싱 후 `elements`, `properties` 복원

### 6.2 파일 입출력

#### 내보내기 (Export)
- **형식**: JSON 파일
- **파일명**: `drawing_{timestamp}.json`
- **데이터**: 전체 Drawing 데이터 (version, timestamp, elements, properties)
- **동작**: Blob 생성 → URL.createObjectURL → 다운로드 링크 클릭

#### 가져오기 (Import)
- **형식**: JSON 파일 (`.json`)
- **동작**: File Input → FileReader → JSON 파싱 → 데이터 병합
- **검증**: `elements` 배열 존재 여부 확인, 유효하지 않은 JSON 시 에러 메시지

### 6.3 서버 연동

#### 서버 저장 (POST)
- **엔드포인트**: `POST /api/drawings`
- **Content-Type**: `application/json`
- **요청 바디**:
```json
{
  "id": "wb1001m01_default",
  "name": "Default Drawing",
  "elements": [],
  "properties": {},
  "updatedAt": "2026-01-23T12:00:00.000Z"
}
```
- **응답**: `200 OK` 성공, 실패 시 토스트 메시지

#### 서버 불러오기 (GET)
- **엔드포인트**: `GET /api/drawings/{id}`
- **파라미터**: `id = "wb1001m01_default"`
- **응답**:
```json
{
  "elements": [],
  "properties": {}
}
```
- **동작**: 응답 데이터로 `elements`, `properties` 덮어쓰기, 재렌더링

## 7. 내보내기

### 7.1 JSON 내보내기
- **기능**: 현재 캔버스 상태를 JSON 파일로 내보내기
- **파일 포맷**: JSON
- **파일명**: `drawing_{timestamp}.json` (예: `drawing_1737648000000.json`)
- **내용**:
  - version: 데이터 포맷 버전
  - timestamp: 내보내기 시간 (ISO 8601)
  - elements: 모든 도형 요소 배열
  - properties: 현재 속성 설정

### 7.2 Canvas 이미지 내보내기 (향후 확장)
- **미지원**: 현재 버전에서는 이미지 내보내기 미지원
- **계획**: PNG/JPEG 형식으로 캔버스 스냅샷 저장

## 8. UI 화면 설계 요약

### 8.1 레이아웃 구성
```
┌─────────────────────────────────────────────────────────────┐
│ Header: Drawing Editor | Undo | Redo | Clear | Export | Import | Save | Load │
├──────┬──────────────────────────────────────────────────────┤
│      │                                                      │
│ Tool │               Canvas Area                            │
│ bar  │             (Centered, Zoomable)                     │
│      │                                                      │
│      │                                                      │
├──────┼──────────────────────────────────────────────────────┤
│ Prop │          Zoom Controls: [-] 100% [+] [Reset]        │
│      │         Shortcuts: Ctrl+Z Ctrl+Y Delete Ctrl+S       │
└──────┴──────────────────────────────────────────────────────┘
```

### 8.2 상세 컴포넌트

#### Header (상단 바)
- **Title**: "✏️ Drawing Editor"
- **버튼**:
  - Undo: 마지막 작업 취소
  - Redo: 실행 취소 작업 다시 실행
  - Clear: 모든 요소 삭제 (확인 대화상자)
  - Export: JSON 파일로 내보내기
  - Import: JSON 파일에서 가져오기
  - Save: 서버에 저장
  - Load: 서버에서 불러오기

#### Toolbar (왼쪽 도구 모음)
- **너비**: 60px
- **도구**: Select (↖), Rectangle (□), Ellipse (○), Arrow (→), Pen (✎), Text (T)
- **상태**: 활성 도구 하이라이트
- **단축키 표시**: title 속성에 단축키 표시

#### Properties Panel (오른쪽 속성 패널)
- **너비**: 240px
- **섹션**:
  - Stroke: 색상 선택기 + 팔레트
  - Fill: 색상 선택기 + 투명도 체크박스 + 팔레트
  - Width: 슬라이더 (1-20px)
  - Selected: 삭제 버튼 + 선택 정보
  - Info: 요소 수

#### Canvas Area (중앙 캔버스 영역)
- **캔버스 크기**: 2000px x 1500px
- **배경**: 흰색 (#ffffff)
- **그리드**: 20px 간격 회색 선 (#f1f5f9)
- **선택 박스**: 파란색 점선 (#2563eb), 핸들 표시

#### Zoom Controls (줌 컨트롤)
- **위치**: 왼쪽 하단
- **버튼**: 축소(-), 줌 레벨 표시, 확대(+), 재설정(⟲)
- **범위**: 10% ~ 500%

#### Shortcuts Info (단축키 정보)
- **위치**: 오른쪽 하단
- **내용**: 주요 단축키 표시 (Ctrl+Z, Ctrl+Y, Delete, Ctrl+S)
- **스타일**: 반투명 배경, 흰색 텍스트

### 8.3 상태 표시
- **선택 요소**: 파란색 점선 선택 박스, 모서리 핸들 8개
- **활성 도구**: 하이라이트 배경, 파란색 테두리
- **드래그 중**: 마우스 커서 변경
- **툴팁**: 선택 요소 정보 표시 (타입, 좌표)

## 9. API 상세

### 9.1 POST /api/drawings

#### 요청
```http
POST /api/drawings HTTP/1.1
Content-Type: application/json

{
  "id": "wb1001m01_default",
  "name": "Default Drawing",
  "elements": [
    {
      "id": 1737648000000.1234,
      "type": "rectangle",
      "x": 100,
      "y": 100,
      "x2": 300,
      "y2": 200,
      "strokeColor": "#000000",
      "fillColor": "transparent",
      "strokeWidth": 2
    }
  ],
  "properties": {
    "strokeColor": "#000000",
    "fillColor": "#ffffff",
    "fillTransparent": true,
    "strokeWidth": 2
  },
  "updatedAt": "2026-01-23T12:00:00.000Z"
}
```

#### 응답
**성공 (200 OK)**
```json
{
  "resultCode": 200,
  "resultMessage": "저장되었습니다.",
  "drawingId": "wb1001m01_default"
}
```

**실패 (400/500)**
```json
{
  "resultCode": 500,
  "resultMessage": "서버 오류가 발생했습니다."
}
```

### 9.2 GET /api/drawings/{id}

#### 요청
```http
GET /api/drawings/wb1001m01_default HTTP/1.1
```

#### 응답
**성공 (200 OK)**
```json
{
  "resultCode": 200,
  "resultMessage": "조회되었습니다.",
  "drawing": {
    "id": "wb1001m01_default",
    "name": "Default Drawing",
    "elements": [
      {
        "id": 1737648000000.1234,
        "type": "rectangle",
        "x": 100,
        "y": 100,
        "x2": 300,
        "y2": 200,
        "strokeColor": "#000000",
        "fillColor": "transparent",
        "strokeWidth": 2
      }
    ],
    "properties": {
      "strokeColor": "#000000",
      "fillColor": "#ffffff",
      "fillTransparent": true,
      "strokeWidth": 2
    },
    "updatedAt": "2026-01-23T12:00:00.000Z"
  }
}
```

**실패 (404)**
```json
{
  "resultCode": 404,
  "resultMessage": "도면을 찾을 수 없습니다."
}
```

## 10. DB 스키마

### 10.1 테이블: WB_DRAWING

| 컬럼명 | 타입 | 길이 | Null | 키 | 설명 |
|--------|------|------|------|-----|------|
| DRAWING_ID | VARCHAR | 50 | N | PK | 도면 ID (예: wb1001m01_default) |
| DRAWING_NM | VARCHAR | 200 | N | | 도면 이름 |
| DRAWING_DATA | CLOB | - | N | | 도면 데이터 (JSON) |
| CREAT_ID | VARCHAR | 50 | N | | 생성자 ID |
| CREAT_DTM | DATETIME | - | N | | 생성 일시 |
| UPDT_ID | VARCHAR | 50 | Y | | 수정자 ID |
| UPDT_DTM | DATETIME | - | N | | 수정 일시 |

### 10.2 인덱스
```sql
CREATE UNIQUE INDEX UK_WB_DRAWING_ID ON WB_DRAWING(DRAWING_ID);
CREATE INDEX IDX_WB_DRAWING_CREAT_ID ON WB_DRAWING(CREAT_ID);
CREATE INDEX IDX_WB_DRAWING_UPDT_DTM ON WB_DRAWING(UPDT_DTM);
```

### 10.3 DRAWING_DATA 구조
```json
{
  "version": "1.0",
  "timestamp": "2026-01-23T12:00:00.000Z",
  "elements": [],
  "properties": {}
}
```

## 11. 수용 기준

| 항목 | 수용 기준 | 검증 방법 |
|------|-----------|----------|
| FR-01 ~ FR-06 | 각 도구 선택 시 해당 기능 정상 동작 | 수동 테스트 |
| FR-07 ~ FR-09 | 선택/이동/리사이즈 시 도형 반응 정확 | 수동 테스트 |
| FR-10 ~ FR-11 | 속성 변경 시 선택 요소 즉시 반영 | 수동 테스트 |
| FR-12 | 삭제 요소가 화면 및 배열에서 제거 | 수동 테스트 |
| FR-13 ~ FR-15 | Undo/Redo 50단계까지 정확히 동작 | 수동 테스트 |
| FR-16 ~ FR-17 | 줌 0.1~5배 범위 내에서 부드럽게 동작 | 수동 테스트 |
| FR-18 ~ FR-19 | 브라우저 종료 후 다시 열어도 데이터 유지 | 브라우저 재시작 테스트 |
| FR-20 ~ FR-21 | 내보내기/가져오기 시 데이터 정합성 유지 | JSON 파일 검증 |
| FR-22 ~ FR-23 | 서버 저장/불러오기 성공 시 토스트 메시지 | API 테스트 |
| FR-24 | 단축키가 각 기능을 정확히 수행 | 수동 테스트 |
| FR-25 | 모바일 터치로 도형 그리기/이동 가능 | 모바일 테스트 |
| FR-26 | 토스트 메시지가 2초 후 자동 숨김 | 수동 테스트 |
| FR-27 | 요소 추가/삭제 시 개수 실시간 갱신 | 수동 테스트 |
| FR-28 | 그리드가 20px 간격으로 정확히 표시 | 시각 확인 |
| UI 레이아웃 | 각 패널/버튼이 지정된 위치에 렌더링 | 시각 확인 |
| 성능 | 100개 요소 렌더링 시 1초 이내 | 성능 테스트 |
| 호환성 | Chrome, Firefox, Edge 최신 2버전 정상 동작 | 브라우저 호환성 테스트 |

## 12. 오픈 질문

| 질문 | 답변 예정일 | 담당자 |
|------|-------------|--------|
| Q1. 이미지 파일(jpg, png) 가져오기 기능이 필요한가? | - | PM |
| Q2. PDF/SVG 형식 내보내기 기능 우선순위는? | - | PM |
| Q3. 레이어 기능(요소 그룹핑, 순서 조절) 필요 여부는? | - | PM |
| Q4. 실시간 협업 기능(WebSocket) 요구사항이 있는가? | - | PM |
| Q5. 요소별 애니메이션 효과 추가 필요성은? | - | PM |
| Q6. 템플릿 기능(미리 정의된 도형 세트) 필요 여부는? | - | PM |
| Q7. 도면 버전 관리(이력 조회, 복원) 요구사항은? | - | PM |
| Q8. 권한 제어(읽기 전용, 편집 권한) 세분화 필요성은? | - | PM |
| Q9. 캔버스 크기 사용자 설정 가능 여부는? | - | PM |
| Q10. 다국어 지원(영어, 일본어 등) 필요 여부는? | - | PM |

---

**문서 버전**: 1.0
**작성일**: 2026-01-23
**수정이력**
| 버전 | 날짜 | 수정자 | 수정내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-23 | System | 초기 작성 |
