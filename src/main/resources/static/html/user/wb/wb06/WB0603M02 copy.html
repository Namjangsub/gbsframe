<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì‹¤í–‰ê³„íš > ê¸°ê³„ë³„ WBSí˜„í™© (HTML5 + jQuery)</title>

  <!-- CDN (ì‚¬ë‚´ë§/ì˜¤í”„ë¼ì¸ì´ë©´ íŒŒì¼ë¡œ ë‚´ë ¤ë°›ì•„ ë¡œì»¬ ê²½ë¡œë¡œ êµì²´) -->
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>

  <style>
    :root{
      --bg:#f4f6fa;
      --panel:#ffffff;
      --line:#e5e9f2;
      --text:#1f2a37;
      --muted:#6b7280;

      --leftW: 830px;     /* ì¢Œì¸¡ ê³ ì • ì»¬ëŸ¼ í­ */
      --rightW: 240px;    /* ìš°ì¸¡ Remarks í­ */
      --cellW: 28px;      /* íƒ€ì„ë¼ì¸ 1ì¼ í­ */
      --rowH: 44px;

      --btn:#2f3a4a;
      --btn2:#475569;
      --primary:#1d4ed8;

      --shadow: 0 6px 18px rgba(16,24,40,.08);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", Arial, "Apple SD Gothic Neo", sans-serif;
      color:var(--text);
      background:var(--bg);
    }

    /* ìƒë‹¨ ê³ ì • ê²€ìƒ‰ ì˜ì—­ */
    .topbar{
      position:sticky;
      top:0;
      z-index:100;
      background:linear-gradient(180deg, #ffffff 0%, #fbfcff 100%);
      border-bottom:1px solid var(--line);
      box-shadow: 0 2px 12px rgba(16,24,40,.06);
    }
    .topbar-inner{
      padding:14px 16px 10px;
      max-width: 1920px;
      margin:0 auto;
    }
    .title-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:10px;
    }
    .title{
      display:flex;
      align-items:center;
      gap:10px;
      font-weight:800;
      letter-spacing:-.2px;
    }
    .title .crumb{
      font-weight:700;
      color:#0f172a;
    }
    .title .crumb small{
      font-weight:700;
      color:var(--muted);
    }

    .btns{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .btn{
      border:1px solid rgba(255,255,255,.15);
      background:var(--btn2);
      color:#fff;
      padding:8px 12px;
      border-radius:8px;
      font-weight:700;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{filter:brightness(1.05)}
    .btn.dark{background:var(--btn)}
    .btn.primary{background:var(--primary)}
    .btn.ghost{
      background:#fff;
      color:#111827;
      border:1px solid var(--line);
    }

    .search-grid{
      display:grid;
      grid-template-columns: 1.1fr 1.1fr 1.2fr 1fr 1.2fr 1fr 1fr 1fr;
      gap:10px 12px;
      align-items:end;
    }
    .field label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:0 0 6px;
      font-weight:700;
    }
    .control{
      display:flex;
      gap:8px;
      align-items:center;
      background:#fff;
      border:1px solid var(--line);
      border-radius:10px;
      padding:8px 10px;
      height:38px;
    }
    .control input, .control select{
      width:100%;
      border:0;
      outline:0;
      font-size:13px;
      background:transparent;
      color:#0f172a;
    }
    .icon-btn{
      width:28px;height:28px;
      border-radius:8px;
      border:1px solid var(--line);
      background:#f8fafc;
      cursor:pointer;
      font-weight:900;
      color:#334155;
    }
    .icon-btn:hover{background:#eef2ff;border-color:#c7d2fe}

    .search-actions{
      display:flex;
      justify-content:flex-end;
      gap:8px;
      align-items:center;
      grid-column: 1 / -1;
      padding-top:2px;
    }

    /* ë ˆì „ë“œ */
    .legend{
      max-width: 1600px;
      margin:10px auto 0;
      padding:0 16px 10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:6px 10px;
      background:#fff;
      border:1px solid var(--line);
      border-radius:999px;
      font-size:12px;
      font-weight:800;
      color:#0f172a;
    }
    .dot{
      width:10px;height:10px;border-radius:3px;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.08);
    }

    /* í•˜ë‹¨ WBS */
    .page{
      max-width: 1920px;
      margin:0 auto;
      padding:5px 5px 5px;
    }

    .wbs-card{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
      box-shadow:var(--shadow);
      overflow:hidden;
    }
    .wbs-toolbar{
      display:flex;
      justify-content:flex-end;
      gap:8px;
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      background:linear-gradient(180deg,#ffffff, #fbfcff);
    }
    .wbs-toolbar .btn{
      border-radius:10px;
      padding:8px 14px;
      font-size:12px;
    }
    .wbs-toolbar .btn.primary{background:#2563eb}
    .wbs-toolbar .btn.ghost{background:#fff}

    .wbs-scroll{
      height: calc(100vh - 220px);
      overflow:auto;
      background:#fff;
    }

    /* ê³µí†µ Row */
    .wbs-row{
      display:flex;
      min-height:var(--rowH);
      border-bottom:1px solid var(--line);
      position:relative;
    }

    /* Header Row sticky */
    .wbs-row.header{
      position:sticky;
      top:0;
      z-index:50;
      background:#f8fafc;
      border-bottom:1px solid #dbe2ee;
    }
    .wbs-row.header .cell{
      font-size:12px;
      font-weight:900;
      color:#0f172a;
      background:#f8fafc;
    }

    /* ì¢Œì¸¡/ìš°ì¸¡ sticky pane */
    .pane-left{
      width:var(--leftW);
      flex:0 0 var(--leftW);
      display:flex;
      position:sticky;
      left:0;
      z-index:30;
      background:#fff;
      border-right:1px solid var(--line);
    }
    .wbs-row.header .pane-left{background:#f8fafc}
    .pane-right{
      width:var(--rightW);
      flex:0 0 var(--rightW);
      position:sticky;
      right:0;
      z-index:30;
      background:#fff;
      border-left:1px solid var(--line);
    }
    .wbs-row.header .pane-right{background:#f8fafc}

    .pane-timeline{
      flex:1 1 auto;
      position:relative;
      background:#fff;
    }

    .cell{
      padding:8px 10px;
      display:flex;
      align-items:center;
      border-right:1px solid var(--line);
      height:var(--rowH);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* ì¢Œì¸¡ ì»¬ëŸ¼ ë ˆì´ì•„ì›ƒ */
    .c-machine{width:70px; flex:0 0 70px; justify-content:center; font-weight:900; color:#0f172a;}
    .c-project{width:210px; flex:0 0 210px; font-weight:800;}
    .c-equip{width:170px; flex:0 0 170px; color:#111827; font-weight:800;}
    .c-code{width:110px; flex:0 0 110px; color:#334155; font-weight:900; font-size:12px;}
    .c-owner{width:140px; flex:0 0 140px; display:flex; flex-direction:column; gap:2px;}
    .owner-badges{display:flex; gap:6px; font-size:11px; color:var(--muted); font-weight:800;}
    .owner-badges b{color:#0f172a}
    .c-modeling{width:150px; flex:0 0 150px; display:flex; flex-direction:column; gap:2px; font-size:12px; color:#0f172a;}
    .c-purchase{width:70px; flex:0 0 70px; justify-content:center; font-weight:800; color:#0f172a;}

    /* Remarks */
    .remarks{
      height:var(--rowH);
      padding:8px 10px;
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:900;
      color:#b91c1c;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .remarks small{
      color:#64748b;
      font-weight:800;
    }

    /* ê·¸ë£¹ ë¼ë²¨ í–‰ */
    .group-sep{
      background:#f3f6fb;
      font-weight:900;
      color:#0f172a;
    }
    .group-sep .pane-timeline{
      background:#f3f6fb;
    }
    .group-sep .pane-right{
      background:#f3f6fb;
    }
    .group-sep .cell{
      border-right:1px solid #dfe6f4;
      background:#f3f6fb;
      height:36px;
    }
    .group-sep .pane-left{background:#f3f6fb}

    /* íƒ€ì„ë¼ì¸ í—¤ë” */
    .timeline-header{
      position:sticky;
      top:0;
      z-index:60;
      background:#f8fafc;
    }
    .timeline-months, .timeline-days{
      display:flex;
      width:fit-content;
      border-bottom:1px solid #dbe2ee;
    }
    .timeline-month{
      height:26px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      font-weight:900;
      color:#0f172a;
      border-right:1px solid #dbe2ee;
      background:#f8fafc;
      position:relative;
    }
    .timeline-day{
      width:var(--cellW);
      height:26px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:11px;
      font-weight:900;
      color:#64748b;
      border-right:1px solid #e6ebf5;
      background:#ffffff;
    }
    .timeline-day.label{
      background:#f8fafc;
    }

    /* íƒ€ì„ë¼ì¸ ìº”ë²„ìŠ¤(í–‰ë³„) */
    .timeline-canvas{
      position:relative;
      height:var(--rowH);
      width:fit-content;
      background:
        linear-gradient(to right, rgba(229,233,242,1) 1px, transparent 1px) 0 0 / var(--cellW) 100%;
    }
    .timeline-canvas.alt{
      background:
        linear-gradient(to right, rgba(229,233,242,1) 1px, transparent 1px) 0 0 / var(--cellW) 100%,
        linear-gradient(to bottom, rgba(248,250,252,1) 50%, rgba(255,255,255,1) 50%);
      background-size: var(--cellW) 100%, 100% 100%;
    }

    /* TODAY ë¼ì¸ */
    .today-line{
      position:absolute;
      top:0;
      bottom:0;
      width:0;
      border-left:2px dashed #dc2626;
      z-index:25;
      pointer-events:none;
    }
    .today-badge{
      position:absolute;
      top:2px;
      transform:translateX(-50%);
      background:#dc2626;
      color:#fff;
      font-weight:900;
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      z-index:70;
      pointer-events:none;
      box-shadow:0 6px 12px rgba(220,38,38,.25);
    }

    /* ë°”(ì„¸ê·¸ë¨¼íŠ¸) */
    .bar{
      position:absolute;
      top:9px;
      height:26px;
      border-radius:6px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      font-size:12px;
      color:#0f172a;
      box-shadow:0 6px 14px rgba(16,24,40,.10);
      border:1px solid rgba(15,23,42,.10);
      cursor:move;
      user-select:none;
      overflow:hidden;
    }
    .bar .txt{
      padding:0 8px;
      letter-spacing:-.2px;
      white-space:nowrap;
      text-overflow:ellipsis;
      overflow:hidden;
    }
    .dirty-dot{
      display:none;
      margin-left:6px;
      width:8px;height:8px;border-radius:50%;
      background:#f59e0b;
      box-shadow:0 0 0 2px rgba(245,158,11,.18);
    }
    .row-dirty .dirty-dot{display:inline-block}

    /* jQuery UI í•¸ë“¤ */
    .ui-resizable-e, .ui-resizable-w{
      width:10px;
      top:0; bottom:0;
      background:rgba(255,255,255,.0);
    }
    .ui-resizable-e{right:-4px}
    .ui-resizable-w{left:-4px}
    .ui-resizable-handle:hover{background:rgba(15,23,42,.08)}

    /* ë¶€ì„œ ìƒ‰ìƒ(ë ˆì „ë“œì™€ ë™ì¼ ë§¤í•‘) */
    .dept-RD { background:#fde68a; }  /* ì—°/ì„¤ê³„ */
    .dept-PM { background:#bfdbfe; }  /* êµ¬ë§¤/ê°€ê³µ */
    .dept-AS { background:#bbf7d0; }  /* ì¡°ë¦½ */
    .dept-SL { background:#c4b5fd; }  /* ì˜ì—… */
    .dept-LB { background:#fbcfe8; }  /* ì—°êµ¬ì†Œ */
    .dept-PR { background:#fdba74; }  /* êµ¬ë§¤ */
    .dept-PD { background:#a7f3d0; }  /* ìƒì‚° */
    .dept-SE { background:#fecaca; }  /* ì˜/ì—° */
    .dept-RP { background:#d9f99d; }  /* ì—°/êµ¬ */
    .dept-PS { background:#99f6e4; }  /* êµ¬/ìƒ */
    .dept-SP { background:#bae6fd; }  /* ìƒ/ì˜ */

    /* Toast / Modal */
    .toast{
      position:fixed;
      right:16px;
      bottom:16px;
      z-index:200;
      background:#0f172a;
      color:#fff;
      padding:10px 12px;
      border-radius:10px;
      font-weight:800;
      box-shadow:0 12px 26px rgba(0,0,0,.22);
      display:none;
      max-width: 360px;
    }
    .modal-backdrop{
      position:fixed; inset:0;
      background:rgba(15,23,42,.55);
      z-index:300;
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .modal{
      width:min(920px, 100%);
      background:#fff;
      border-radius:14px;
      border:1px solid var(--line);
      box-shadow:0 22px 60px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .modal .m-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      background:#f8fafc;
      font-weight:900;
    }
    .modal .m-body{
      padding:12px 14px;
      max-height: 62vh;
      overflow:auto;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size:12px;
      color:#0f172a;
      background:#ffffff;
      white-space:pre-wrap;
    }
    .modal .m-foot{
      display:flex;
      justify-content:flex-end;
      gap:8px;
      padding:12px 14px;
      border-top:1px solid var(--line);
      background:#fbfcff;
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="title-row">
        <div class="title">
          <span style="font-size:18px;">âš™ï¸</span>
          <span class="crumb">ì‹¤í–‰ê³„íš <small>&gt;</small> ê¸°ê³„ë³„ WBSí˜„í™©</span>
        </div>
        <div class="btns">
          <button class="btn dark" id="btnHelp">ë„ì›€ë§ (Help)</button>
          <button class="btn" id="btnReset">ì´ˆê¸°í™” (Reset)</button>
          <button class="btn primary" id="btnSearch">ê²€ìƒ‰ (Search)</button>
        </div>
      </div>

      <div class="search-grid">
        <div class="field">
          <label>* íšŒì‚¬ (Company)</label>
          <div class="control">
            <select id="fCompany">
              <option value="ê±´ì–‘TT">ê±´ì–‘TT</option>
              <option value="ê±´ì–‘IT">ê±´ì–‘IT</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>SalesCode</label>
          <div class="control">
            <input id="fSalesCode" placeholder="SalesCode ì…ë ¥" />
            <button class="icon-btn" id="btnSalesSearch" title="SalesCode ê²€ìƒ‰">ğŸ”</button>
          </div>
        </div>

        <div class="field">
          <label>* ìˆ˜ì£¼ì¼ì (From~To)</label>
          <div class="control">
            <input id="fFrom" type="date" />
            <span style="color:#94a3b8;font-weight:900;">~</span>
            <input id="fTo" type="date" />
          </div>
        </div>

        <div class="field">
          <label>ê³ ê°ì‚¬PJT</label>
          <div class="control">
            <select id="fPjt">
              <option value="">ì „ì²´</option>
              <option value="PJT-A">PJT-A</option>
              <option value="PJT-B">PJT-B</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>ê¸°ê³„ì¢…ë¥˜</label>
          <div class="control">
            <select id="fMachine">
              <option value="">ì „ì²´</option>
              <option value="NX5E">NX5E</option>
              <option value="BC4i">BC4i</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>ê³ ê°ì‚¬</label>
          <div class="control">
            <input id="fCustomer" placeholder="ê³ ê°ì‚¬ ì…ë ¥" />
            <button class="icon-btn" id="btnCustomerSearch" title="ê³ ê°ì‚¬ ê²€ìƒ‰">ğŸ”</button>
          </div>
        </div>

        <div class="field">
          <label>ìˆ˜ì£¼êµ¬ë¶„</label>
          <div class="control">
            <select id="fOrderType">
              <option value="">ì „ì²´</option>
              <option value="ì‹ ê·œ">ì‹ ê·œ</option>
              <option value="ê°œì¡°">ê°œì¡°</option>
              <option value="AS">AS</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>PMê³„íšìƒíƒœ</label>
          <div class="control">
            <select id="fPmStatus">
              <option value="">ì „ì²´</option>
              <option value="ê³„íš">ê³„íš</option>
              <option value="ì§„í–‰">ì§„í–‰</option>
              <option value="ì™„ë£Œ">ì™„ë£Œ</option>
              <option value="ì§€ì—°">ì§€ì—°</option>
            </select>
          </div>
        </div>

      </div>
    </div>

    <div class="legend" id="legend"></div>
  </div>

  <div class="page">
    <div class="wbs-card">
      <div class="wbs-toolbar">
          <span style="color:var(--muted);font-weight:800;font-size:12px;">
            * ë°ëª¨ í™”ë©´: ë“œë˜ê·¸/ë¦¬ì‚¬ì´ì¦ˆë¡œ ì¼ì • ë³€ê²½ ê°€ëŠ¥ (SAVE CHANGESë¡œ ë³€ê²½ë¶„ í™•ì¸)
          </span>
        <button class="btn primary" id="btnSave">SAVE CHANGES</button>
        <button class="btn ghost" id="btnExport">EXPORT EXCEL</button>
      </div>

      <div class="wbs-scroll" id="wbsScroll">
        <!-- WBS ë Œë”ë§ ì˜ì—­ -->
        <div id="wbs"></div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <!-- Modal -->
  <div class="modal-backdrop" id="modal">
    <div class="modal">
      <div class="m-head">
        <div id="modalTitle">ë‚´ìš©</div>
        <button class="btn ghost" id="modalClose">ë‹«ê¸°</button>
      </div>
      <div class="m-body" id="modalBody"></div>
      <div class="m-foot">
        <button class="btn dark" id="modalCopy">ë³µì‚¬</button>
        <button class="btn primary" id="modalOk">í™•ì¸</button>
      </div>
    </div>
  </div>

  <script>
    /***********************
     * 1) ìƒ˜í”Œ ë°ì´í„°/ì„¤ì •
     ************************/
    const CELL_W = 28;                 // íƒ€ì„ë¼ì¸ 1ì¼ í­(px)
    const VIEW_START = "2026-01-01";    // íƒ€ì„ë¼ì¸ ì‹œì‘
    const VIEW_END   = "2026-04-30";    // íƒ€ì„ë¼ì¸ ë
    const DEMO_TODAY = "2026-01-27";    // ìŠ¤í¬ë¦°ìƒ· ìœ ì‚¬ TODAY í‘œì‹œ(ë°ëª¨)

    const DEPTS = [
      {code:"RD", name:"ì—°/ì„¤ê³„ (ì—°)", colorClass:"dept-RD"},
      {code:"PM", name:"êµ¬ë§¤/ê°€ê³µ (êµ¬)", colorClass:"dept-PM"},
      {code:"AS", name:"ì¡°ë¦½",         colorClass:"dept-AS"},
      {code:"SL", name:"ì˜ì—…",         colorClass:"dept-SL"},
      {code:"LB", name:"ì—°êµ¬ì†Œ",       colorClass:"dept-LB"},
      {code:"PR", name:"êµ¬ë§¤",         colorClass:"dept-PR"},
      {code:"PD", name:"ìƒì‚°",         colorClass:"dept-PD"},
      {code:"SE", name:"ì˜/ì—°",        colorClass:"dept-SE"},
      {code:"RP", name:"ì—°/êµ¬",        colorClass:"dept-RP"},
      {code:"PS", name:"êµ¬/ìƒ",        colorClass:"dept-PS"},
      {code:"SP", name:"ìƒ/ì˜",        colorClass:"dept-SP"}
    ];

    // ì´ˆê¸° ë°ì´í„°(Resetìš©)
    const INITIAL = {
      viewStart: VIEW_START,
      viewEnd: VIEW_END,
      today: DEMO_TODAY,
      rows: [
        // ê·¸ë£¹: NX5E
        {type:"group", machine:"NX5E", title:"NX5E"},
        {
          id:"R1", machine:"NX5E", salesCode:"SC-25204",
          project:"FRT UPR(IMG) LH/RH", equip:"ê°ì‹¸ê¸° MOLD",
          code:"25204-01FBFUP",
          ownerDesign:"ê¹€ì˜ì¬", ownerModel:"ì„±ì›",
          modelingStart:"2026-01-19", modelingEnd:"2026-02-01",
          buyer:"í—ˆìƒë ¬",
          remarks:"â˜… ì¶œê³  ì§€ì—° ì˜ˆìƒ",
          segments:[
            {id:"R1-S1", dept:"SL", label:"ì˜",    start:"2026-01-23", end:"2026-01-24"},
            {id:"R1-S2", dept:"RD", label:"ì—°",    start:"2026-01-25", end:"2026-01-26"},
            {id:"R1-S3", dept:"RP", label:"ì—°/êµ¬", start:"2026-01-27", end:"2026-01-28"},
            {id:"R1-S4", dept:"PD", label:"ìƒ",    start:"2026-01-29", end:"2026-01-29"},
            {id:"R1-S5", dept:"PM", label:"êµ¬",    start:"2026-02-03", end:"2026-02-06"},
            {id:"R1-S6", dept:"PM", label:"êµ¬",    start:"2026-02-07", end:"2026-02-10"}
          ]
        },
        {
          id:"R2", machine:"NX5E", salesCode:"SC-25204",
          project:"RR UPR(IMG) (CURTAIN)", equip:"LH/RH ê°ì‹¸ê¸°",
          code:"25204-02FBRUP",
          ownerDesign:"í•˜í˜„ë ¨", ownerModel:"ì„±ì›",
          modelingStart:"2026-01-27", modelingEnd:"2026-02-10",
          buyer:"",
          remarks:"â˜… ì¶œê³  ì§€ì—° ì˜ˆìƒ",
          segments:[
            {id:"R2-S1", dept:"SL", label:"ì˜",    start:"2026-01-25", end:"2026-01-26"},
            {id:"R2-S2", dept:"RD", label:"ì—°",    start:"2026-01-27", end:"2026-01-27"},
            {id:"R2-S3", dept:"RP", label:"ì—°/êµ¬", start:"2026-01-28", end:"2026-01-29"},
            {id:"R2-S4", dept:"PD", label:"ìƒ",    start:"2026-01-30", end:"2026-01-31"}
          ]
        },
        {
          id:"R3", machine:"NX5E", salesCode:"SC-25204",
          project:"RR A/REST LWR(IMG)", equip:"LH/RH ê°ì‹¸ê¸°",
          code:"25204-05FBRAR",
          ownerDesign:"í—ˆìƒí˜", ownerModel:"ë„¤ì˜¤",
          modelingStart:"2026-01-27", modelingEnd:"2026-02-10",
          buyer:"",
          remarks:"â˜… ì¶œê³  ì§€ì—° ì˜ˆìƒ",
          segments:[
            {id:"R3-S1", dept:"SL", label:"ì˜",    start:"2026-01-27", end:"2026-01-27"},
            {id:"R3-S2", dept:"RD", label:"ì—°",    start:"2026-01-29", end:"2026-01-30"},
            {id:"R3-S3", dept:"RD", label:"ì—°",    start:"2026-02-01", end:"2026-02-03"},
            {id:"R3-S4", dept:"RD", label:"ì—°",    start:"2026-02-05", end:"2026-02-08"},
            {id:"R3-S5", dept:"RP", label:"ì—°/êµ¬", start:"2026-02-10", end:"2026-02-12"}
          ]
        },
        {
          id:"R4", machine:"NX5E", salesCode:"SC-25204",
          project:"CONSOLE", equip:"GARNISH(IMG) LHD/RHD",
          code:"25204-06FBNGA",
          ownerDesign:"ê¹€ì •ë¯¼", ownerModel:"ê¹€ì§€ì—°",
          modelingStart:"2026-01-08", modelingEnd:"2026-01-25",
          buyer:"",
          remarks:"â€»ë„ë©´ ì¶œë„ í›„ ì™¸ì£¼ì œì‘ í•´ì•¼í•¨",
          segments:[
            {id:"R4-S1", dept:"SE", label:"AB/ì¼", start:"2026-01-18", end:"2026-01-31"}
          ]
        },

        // ì „ì²´ ì¼ì •(í† íƒˆ) í–‰
        {type:"total", machine:"NX5E", title:"ì „ì²´ ì¼ì • (Total Progress)",
         segments:[
           {id:"T1", dept:"PR", label:"êµ¬ë§¤", start:"2026-01-20", end:"2026-01-31"},
           {id:"T2", dept:"PM", label:"ê°€ê³µ", start:"2026-02-01", end:"2026-02-28"},
           {id:"T3", dept:"AS", label:"ì¡°ë¦½", start:"2026-03-01", end:"2026-03-25"},
           {id:"T4", dept:"PD", label:"ì „ê¸°", start:"2026-03-26", end:"2026-04-10"},
           {id:"T5", dept:"SP", label:"ì‹œìš´ì „", start:"2026-04-11", end:"2026-04-30"}
         ],
         remarks:""
        },

        // ê·¸ë£¹: BC4i
        {type:"group", machine:"BC4i", title:"BC4i"},
        {
          id:"R5", machine:"BC4i", salesCode:"SC-25206",
          project:"FRT UPR ê°ì‹¸ê¸°", equip:"MOLD(2CAV)",
          code:"25206-01FBFUP",
          ownerDesign:"ê¹€ì¢…ì„±", ownerModel:"í¬ì¸",
          modelingStart:"2026-01-27", modelingEnd:"2026-02-10",
          buyer:"",
          remarks:"â˜… ì¶œê³  ì§€ì—° ì˜ˆìƒ",
          segments:[
            {id:"R5-S1", dept:"SL", label:"ì˜",    start:"2026-02-06", end:"2026-02-08"},
            {id:"R5-S2", dept:"RD", label:"ì—°",    start:"2026-02-09", end:"2026-02-10"},
            {id:"R5-S3", dept:"RP", label:"ì—°/êµ¬", start:"2026-02-11", end:"2026-02-13"},
            {id:"R5-S4", dept:"PD", label:"ìƒ",    start:"2026-02-14", end:"2026-02-15"}
          ]
        }
      ]
    };

    let STATE = deepClone(INITIAL);    // í˜„ì¬ ìƒíƒœ(ê²€ìƒ‰/ë“œë˜ê·¸ ë°˜ì˜)
    let ORIGINAL = deepClone(INITIAL); // Reset ê¸°ì¤€

    /***********************
     * 2) ìœ í‹¸
     ************************/
    function deepClone(obj){ return JSON.parse(JSON.stringify(obj)); }
    function ymd(d){
      const yy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      return `${yy}-${mm}-${dd}`;
    }
    function parseYMD(s){
      const [y,m,d] = s.split('-').map(Number);
      return new Date(y, m-1, d);
    }
    function daysBetween(a, b){
      const ms = 24*60*60*1000;
      const da = parseYMD(a);
      const db = parseYMD(b);
      return Math.round((db - da)/ms);
    }
    function addDays(ymdStr, n){
      const d = parseYMD(ymdStr);
      d.setDate(d.getDate()+n);
      return ymd(d);
    }
    function clamp(v, min, max){ return Math.max(min, Math.min(max, v)); }

    function toast(msg){
      const $t = $("#toast");
      $t.stop(true,true).text(msg).fadeIn(120);
      setTimeout(()=> $t.fadeOut(280), 1600);
    }

    function openModal(title, body){
      $("#modalTitle").text(title);
      $("#modalBody").text(body);
      $("#modal").fadeIn(120).css("display","flex");
    }
    function closeModal(){ $("#modal").fadeOut(120); }

    /***********************
     * 3) ë ˆì „ë“œ/ê¸°ë³¸ ì„¸íŒ…
     ************************/
    function renderLegend(){
      const $l = $("#legend").empty();
      DEPTS.forEach(d=>{
        const $chip = $(`
          <span class="chip">
            <span class="dot ${d.colorClass}"></span>
            <span>${d.name}</span>
          </span>
        `);
        $l.append($chip);
      });
    }

    function initDates(){
      // ê²€ìƒ‰ ê¸°ë³¸ê°’(ìƒ˜í”Œ)
      $("#fFrom").val("2025-07-01");
      $("#fTo").val("2026-01-31");
    }

    /***********************
     * 4) íƒ€ì„ë¼ì¸ í—¤ë” ìƒì„±
     ************************/
    function buildTimelineHeader(viewStart, viewEnd){
      const start = parseYMD(viewStart);
      const end   = parseYMD(viewEnd);

      // ì›” ê·¸ë£¹ ê³„ì‚°
      const months = [];
      let cur = new Date(start.getFullYear(), start.getMonth(), 1);

      // startê°€ ì›” ì¤‘ê°„ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, startë¶€í„° endê¹Œì§€ ìˆœíšŒí•˜ë©° ì›”ë³„ ì¼ìˆ˜ ì§‘ê³„
      let iter = parseYMD(viewStart);
      let currentKey = `${iter.getFullYear()}-${iter.getMonth()}`;
      let count = 0;

      const allDays = [];
      while(iter <= end){
        allDays.push(new Date(iter));
        const key = `${iter.getFullYear()}-${iter.getMonth()}`;
        if(key !== currentKey){
          // ì´ì „ ì›” ë§ˆê°
          const [y,m] = currentKey.split('-').map(Number);
          months.push({y, m, days: count});
          currentKey = key;
          count = 0;
        }
        count++;
        iter.setDate(iter.getDate()+1);
      }
      // ë§ˆì§€ë§‰ ì›”
      {
        const [y,m] = currentKey.split('-').map(Number);
        months.push({y, m, days: count});
      }

      // DOM ìƒì„±
      const $wrap = $(`<div class="timeline-header"></div>`);
      const $months = $(`<div class="timeline-months"></div>`);
      months.forEach(m=>{
        const w = m.days * CELL_W;
        const label = `${m.y}ë…„ ${m.m+1}ì›”`;
        $months.append(`<div class="timeline-month" style="width:${w}px">${label}</div>`);
      });

      const $days = $(`<div class="timeline-days"></div>`);
      allDays.forEach((d, idx)=>{
        const day = d.getDate();
        const show = (day===5 || day===10 || day===15 || day===20 || day===25 || day===30);
        $days.append(`<div class="timeline-day ${show ? 'label':''}">${show ? String(day).padStart(2,'0') : ''}</div>`);
      });

      $wrap.append($months).append($days);
      return { $wrap, totalDays: allDays.length, totalWidth: allDays.length * CELL_W };
    }

    /***********************
     * 5) WBS ë Œë”ë§
     ************************/
    function renderWbs(){
      const $wbs = $("#wbs").empty();

      // í—¤ë”(ì¢Œì¸¡/íƒ€ì„ë¼ì¸/ìš°ì¸¡)
      const head = buildTimelineHeader(STATE.viewStart, STATE.viewEnd);

      const $headerRow = $(`
        <div class="wbs-row header">
          <div class="pane-left">
            <div class="cell c-machine">ê¸°ê³„</div>
            <div class="cell c-project">í”„ë¡œì íŠ¸ëª…</div>
            <div class="cell c-equip">ì„¤ë¹„ëª…</div>
            <div class="cell c-code">CODE</div>
            <!-- <div class="cell c-owner">ë‹´ë‹¹ì <span class="dirty-dot"></span></div>
           <div class="cell c-modeling">ëª¨ë¸ë§ ì¼ì •</div>
             <div class="cell c-purchase">êµ¬ë§¤</div> -->
          </div>
          <div class="pane-timeline"></div>
          <div class="pane-right">
            <div class="cell" style="border-right:0; justify-content:center;">ë¹„ê³  (Remarks)</div>
          </div>
        </div>
      `);
      $headerRow.find(".pane-timeline").append(head.$wrap);
      $wbs.append($headerRow);

      // TODAY ë¼ì¸(ì „ì²´ íƒ€ì„ë¼ì¸ ê¸°ì¤€) - header ë° body ëª¨ë‘ì— ê³µí†µìœ¼ë¡œ ë³´ì´ë„ë¡ sticky ì˜ì—­ì— ë³„ë„ í‘œê¸°
      const todayOffset = daysBetween(STATE.viewStart, STATE.today);
      const showToday = (todayOffset >= 0 && todayOffset <= head.totalDays-1);

      // ë°”ë”” ë Œë”
      let zebra = 0;
      STATE.rows.forEach((r, idx)=>{
        if(r.type === "group"){
//           const $g = $(`
//             <div class="wbs-row group-sep">
//               <div class="pane-left">
//                 <div class="cell c-machine">${r.title}</div>
//                 <div class="cell" style="flex:1 1 auto; border-right:0; font-weight:900;">&nbsp;</div>
//               </div>
//               <div class="pane-timeline">
//                 <div class="timeline-canvas" style="width:${head.totalWidth}px; height:36px; background:none;"></div>
//               </div>
//               <div class="pane-right">
//                 <div class="cell" style="border-right:0; height:36px;"></div>
//               </div>
//             </div>
//           `);
//           $wbs.append($g);
          return;
        }

        if(r.type === "total"){
          // Total Progress í–‰
          const $row = $(`
            <div class="wbs-row total-row" data-rowid="${r.machine}-TOTAL">
              <div class="pane-left">
                <div class="cell c-machine">${r.machine}</div>
                <div class="cell c-project" style="font-weight:900;">${r.title}</div>
                <div class="cell c-equip"> </div>
                <div class="cell c-code"> </div>
                <!-- <div class="cell c-owner"><span class="owner-badges"><b> </b></span><span class="dirty-dot"></span></div>
                <div class="cell c-modeling"> </div>
                 <div class="cell c-purchase"> </div> -->
              </div>
              <div class="pane-timeline">
                <div class="timeline-canvas ${zebra%2?'alt':''}" style="width:${head.totalWidth}px;"></div>
              </div>
              <div class="pane-right">
                <div class="remarks">${r.remarks ? r.remarks : '<small>&nbsp;</small>'}</div>
              </div>
            </div>
          `);

          const $canvas = $row.find(".timeline-canvas");
          // TODAY ë¼ì¸ ì¶”ê°€
          if(showToday){
            $canvas.append(`<div class="today-line" style="left:${todayOffset*CELL_W}px"></div>`);
          }

          // segment ê·¸ë¦¬ê¸°(ë“œë˜ê·¸/ë¦¬ì‚¬ì´ì¦ˆëŠ” totalì€ ì ê¸ˆ)
          (r.segments || []).forEach(seg=>{
            const left = daysBetween(STATE.viewStart, seg.start) * CELL_W;
            const w = (daysBetween(seg.start, seg.end) + 1) * CELL_W;
            const cls = deptClass(seg.dept);
            const $bar = $(`
              <div class="bar ${cls}" style="left:${left}px;width:${w}px; cursor:default;">
                <div class="txt">${seg.label}</div>
              </div>
            `);
            $bar.attr("title", `${seg.label} | ${seg.start} ~ ${seg.end}`);
            $canvas.append($bar);
          });

          $wbs.append($row);
          zebra++;
          return;
        }

        // ì¼ë°˜ í–‰
        const $row = $(`
          <div class="wbs-row data-row" data-rowid="${r.id}">
            <div class="pane-left">
              <div class="cell c-machine">${r.machine}</div>
              <div class="cell c-project">${escapeHtml(r.project)}</div>
              <div class="cell c-equip">${escapeHtml(r.equip)}</div>
              <div class="cell c-code">${escapeHtml(r.code)}</div>
              <div class="cell c-owner">
                <div class="owner-badges">ì„¤ê³„ <b>${escapeHtml(r.ownerDesign||'')}</b> Â· ëª¨ë¸ <b>${escapeHtml(r.ownerModel||'')}</b></div>
                <div style="font-size:11px; color:var(--muted); font-weight:800;">(ë“œë˜ê·¸/ë¦¬ì‚¬ì´ì¦ˆ ê°€ëŠ¥)</div>
                <span class="dirty-dot"></span>
              </div>
              <!-- <div class="cell c-modeling">
                <div>START <b>${r.modelingStart}</b></div>
                <div>END&nbsp;&nbsp;&nbsp;&nbsp;<b>${r.modelingEnd}</b></div>
              </div>
               <div class="cell c-purchase">${escapeHtml(r.buyer||'')}</div> -->
            </div>

            <div class="pane-timeline">
              <div class="timeline-canvas ${zebra%2?'alt':''}" style="width:${head.totalWidth}px;"></div>
            </div>

            <div class="pane-right">
              <div class="remarks">${r.remarks ? escapeHtml(r.remarks) : '<small>&nbsp;</small>'}</div>
            </div>
          </div>
        `);

        const $canvas = $row.find(".timeline-canvas");

        // TODAY ë¼ì¸(ê° í–‰ ìº”ë²„ìŠ¤ì— ë™ì¼ ìœ„ì¹˜ë¡œ)
        if(showToday){
          $canvas.append(`<div class="today-line" style="left:${todayOffset*CELL_W}px"></div>`);
        }

        // ì„¸ê·¸ë¨¼íŠ¸ ë Œë”ë§
        (r.segments || []).forEach(seg=>{
          const left = daysBetween(STATE.viewStart, seg.start) * CELL_W;
          const w = (daysBetween(seg.start, seg.end) + 1) * CELL_W;
          const cls = deptClass(seg.dept);
          const $bar = $(`
            <div class="bar ${cls}" data-row="${r.id}" data-seg="${seg.id}" style="left:${left}px;width:${w}px;">
              <div class="txt">${escapeHtml(seg.label)}</div>
            </div>
          `);
          $bar.attr("title", `${seg.label} | ${seg.start} ~ ${seg.end}`);
          $canvas.append($bar);
        });

        $wbs.append($row);
        zebra++;
      });

      // í—¤ë”ì— TODAY ë°°ì§€ í‘œì‹œ
      if(showToday){
        // íƒ€ì„ë¼ì¸ í—¤ë”ì˜ month/ì¼ ë¼ë²¨ ì˜ì—­ ìœ„ì— í‘œì‹œ
        const $badge = $(`<div class="today-badge">TODAY</div>`);
        $badge.css("left", (todayOffset*CELL_W) + "px");
        $headerRow.find(".pane-timeline").append($badge);
        // í—¤ë”ì— ë¼ì¸ í‘œì‹œ(ìƒë‹¨ì—ì„œë„ ë³´ì´ë„ë¡)
        $headerRow.find(".pane-timeline").append(
          `<div class="today-line" style="left:${todayOffset*CELL_W}px; top:0; bottom:0; position:absolute;"></div>`
        );
      }

      // ë“œë˜ê·¸/ë¦¬ì‚¬ì´ì¦ˆ ë°”ì¸ë”©
      bindBars();
    }

    function deptClass(code){
      const m = DEPTS.find(x=>x.code===code);
      return m ? m.colorClass : "dept-RD";
    }

    function escapeHtml(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    /***********************
     * 6) ë“œë˜ê·¸/ë¦¬ì‚¬ì´ì¦ˆ(ì¼ì • ìˆ˜ì •)
     ************************/
    function bindBars(){
      // ê¸°ì¡´ ë°”ì¸ë”© ì œê±° í›„ ì¬ì ìš©
      $(".bar").each(function(){
        const $b = $(this);
        const segId = $b.data("seg");
        const rowId = $b.data("row");
        if(!segId || !rowId) return; // total ë“±ì€ ì œì™¸

        // draggable
        $b.draggable({
          axis:"x",
          containment:"parent",
          grid:[CELL_W, 1],
          start: function(){ $(this).addClass("dragging"); },
          stop: function(e, ui){
            $(this).removeClass("dragging");
            applyBarChange($(this));
          }
        });

        // resizable (ì¢Œ/ìš°)
        $b.resizable({
          handles: "e,w",
          grid: [CELL_W, 0],
          containment:"parent",
          minWidth: CELL_W,
          start: function(){ $(this).addClass("resizing"); },
          stop: function(e, ui){
            $(this).removeClass("resizing");
            applyBarChange($(this));
          }
        });
      });
    }

    function applyBarChange($bar){
      const rowId = $bar.data("row");
      const segId = $bar.data("seg");
      const leftPx = parseInt($bar.css("left"), 10) || 0;
      const widthPx = Math.max(CELL_W, parseInt($bar.css("width"), 10) || CELL_W);

      const startOffset = Math.round(leftPx / CELL_W);
      const daysLen = Math.round(widthPx / CELL_W);

      const newStart = addDays(STATE.viewStart, startOffset);
      const newEnd   = addDays(newStart, daysLen-1);

      // ë·° ë²”ìœ„ í´ë¨í”„
      const minStart = STATE.viewStart;
      const maxEnd   = STATE.viewEnd;
      let s = newStart;
      let e = newEnd;

      if(daysBetween(minStart, s) < 0) s = minStart;
      if(daysBetween(e, maxEnd) < 0) e = maxEnd;

      // ë°ì´í„° ì—…ë°ì´íŠ¸
      const row = STATE.rows.find(x=>x.id===rowId);
      if(!row) return;
      const seg = (row.segments||[]).find(x=>x.id===segId);
      if(!seg) return;

      seg.start = s;
      seg.end = e;
      $bar.attr("title", `${seg.label} | ${seg.start} ~ ${seg.end}`);

      // row dirty í‘œì‹œ
      const $row = $bar.closest(".wbs-row");
      $row.addClass("row-dirty");

      toast(`ì¼ì • ë³€ê²½: ${seg.label} (${seg.start} ~ ${seg.end})`);
    }

    /***********************
     * 7) ê²€ìƒ‰/ì´ˆê¸°í™”/ì €ì¥/ì—‘ì…€
     ************************/
    function applySearch(){
      const m = $("#fMachine").val().trim();
      const sc = $("#fSalesCode").val().trim();
      const cust = $("#fCustomer").val().trim();

      // ë°ëª¨: machine/salesCode/customer 3ê°€ì§€ë¡œ í•„í„°
      // (customerëŠ” ìƒ˜í”Œ ë°ì´í„°ì— ì—†ì–´ì„œ, ì…ë ¥ ì‹œ í”„ë¡œì íŠ¸ëª…ì— í¬í•¨ ê²€ìƒ‰ìœ¼ë¡œ ëŒ€ì²´)
      STATE = deepClone(ORIGINAL);

      if(m){
        STATE.rows = STATE.rows.filter(r=>{
          if(r.type==="group" || r.type==="total") return true; // ê·¸ë£¹/í† íƒˆì€ ìœ ì§€
          return r.machine === m;
        });
      }
      if(sc){
        STATE.rows = STATE.rows.filter(r=>{
          if(r.type==="group" || r.type==="total") return true;
          return (r.salesCode||"").toLowerCase().includes(sc.toLowerCase()) ||
                 (r.code||"").toLowerCase().includes(sc.toLowerCase());
        });
      }
      if(cust){
        STATE.rows = STATE.rows.filter(r=>{
          if(r.type==="group" || r.type==="total") return true;
          return (r.project||"").includes(cust) || (r.equip||"").includes(cust);
        });
      }

      // ê·¸ë£¹ ë¼ì¸ ì •ë¦¬(í•„í„° ê²°ê³¼ì— í–‰ì´ ì—†ìœ¼ë©´ ê·¸ë£¹ ì œê±°)
      pruneEmptyGroups();
      renderWbs();
      toast("ê²€ìƒ‰ ì¡°ê±´ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }

    function pruneEmptyGroups(){
      const rows = STATE.rows;
      const out = [];
      let currentGroup = null;
      let buffer = [];
      for(const r of rows){
        if(r.type==="group"){
          if(currentGroup){
            if(buffer.some(x=>x.type!=="group")) out.push(currentGroup, ...buffer);
            buffer = [];
          }
          currentGroup = r;
        }else{
          buffer.push(r);
        }
      }
      if(currentGroup){
        if(buffer.some(x=>x.type!=="group")) out.push(currentGroup, ...buffer);
      }else{
        out.push(...buffer);
      }
      STATE.rows = out;
    }

    function doReset(){
      STATE = deepClone(ORIGINAL);
      $("#fMachine").val("");
      $("#fSalesCode").val("");
      $("#fCustomer").val("");
      renderWbs();
      toast("ì´ˆê¸°í™” ì™„ë£Œ");
    }

    function collectChanges(){
      const changes = [];
      $(".wbs-row.row-dirty").each(function(){
        const rowId = $(this).data("rowid");
        const row = STATE.rows.find(x=>x.id===rowId);
        if(!row) return;
        changes.push({
          rowId: row.id,
          machine: row.machine,
          project: row.project,
          code: row.code,
          segments: row.segments
        });
      });
      return changes;
    }

    function doSave(){
      const changes = collectChanges();
      if(!changes.length){
        toast("ë³€ê²½ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      openModal("ë³€ê²½ì‚¬í•­(JSON)", JSON.stringify(changes, null, 2));
    }

    function doExport(){
      // CSV (Excelì—ì„œ ë°”ë¡œ ì—´ë¦¼)
      const lines = [];
      lines.push([
        "MACHINE","PROJECT","EQUIP","CODE","OWNER_DESIGN","OWNER_MODEL",
        "MODEL_START","MODEL_END","BUYER","SEG_ID","DEPT","LABEL","START","END","REMARKS"
      ].join(","));

      STATE.rows.forEach(r=>{
        if(r.type==="group") return;
        if(r.type==="total"){
          (r.segments||[]).forEach(seg=>{
            lines.push([
              escCsv(r.machine), escCsv(r.title||""),
              "", "", "", "",
              "", "", "",
              escCsv(seg.id), escCsv(seg.dept), escCsv(seg.label),
              escCsv(seg.start), escCsv(seg.end), escCsv(r.remarks||"")
            ].join(","));
          });
          return;
        }

        (r.segments||[]).forEach(seg=>{
          lines.push([
            escCsv(r.machine), escCsv(r.project), escCsv(r.equip), escCsv(r.code),
            escCsv(r.ownerDesign||""), escCsv(r.ownerModel||""),
            escCsv(r.modelingStart||""), escCsv(r.modelingEnd||""),
            escCsv(r.buyer||""),
            escCsv(seg.id), escCsv(seg.dept), escCsv(seg.label),
            escCsv(seg.start), escCsv(seg.end),
            escCsv(r.remarks||"")
          ].join(","));
        });
      });

      const blob = new Blob(["\ufeff"+lines.join("\n")], {type:"text/csv;charset=utf-8"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `WBS_${STATE.viewStart}_${STATE.viewEnd}.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      toast("CSV(Excel) ë‚´ë³´ë‚´ê¸° ì™„ë£Œ");
    }

    function escCsv(v){
      const s = String(v ?? "");
      if(/[",\n]/.test(s)) return `"${s.replaceAll('"','""')}"`;
      return s;
    }

    /***********************
     * 8) ë„ì›€ë§
     ************************/
    function showHelp(){
      const msg =
`[ì¡°ì‘ ë°©ë²•]
1) íƒ€ì„ë¼ì¸ì˜ ì»¬ëŸ¬ ë°”ë¥¼ ë§ˆìš°ìŠ¤ë¡œ ì¢Œìš° ë“œë˜ê·¸ â†’ ì‹œì‘ì¼ ì´ë™(1ì¼ ë‹¨ìœ„)
2) ë°”ì˜ ì¢Œ/ìš° ëì„ ë“œë˜ê·¸(ë¦¬ì‚¬ì´ì¦ˆ) â†’ ê¸°ê°„ ë³€ê²½(1ì¼ ë‹¨ìœ„)
3) ë³€ê²½ëœ í–‰ì€ ë…¸ë€ ì (â—) í‘œì‹œ â†’ SAVE CHANGES í´ë¦­ ì‹œ ë³€ê²½ JSON í™•ì¸
4) EXPORT EXCEL â†’ CSVë¡œ ë‹¤ìš´ë¡œë“œ(Excelì—ì„œ ì—´ê¸° ê°€ëŠ¥)

[êµ¬í˜„ í¬ì¸íŠ¸]
- ì¢Œì¸¡(ê¸°ê³„~êµ¬ë§¤) / ìš°ì¸¡(Remarks) Sticky ì²˜ë¦¬
- íƒ€ì„ë¼ì¸ì€ Day Grid(1ì¼ ë‹¨ìœ„) + ì›” ë¼ë²¨ + TODAY ë¼ì¸ í‘œì‹œ
- jQuery UI draggable/resizableë¡œ ì¼ì • ìˆ˜ì •
- ì‹¤ì„œë²„ ì—°ë™ ì‹œ: SAVE ì‹œì ì— ë³€ê²½ë¶„ë§Œ ë°±ì—”ë“œ APIë¡œ ì „ì†¡ ê¶Œì¥`;
      openModal("ë„ì›€ë§", msg);
    }

    /***********************
     * 9) ì´ë²¤íŠ¸ ë°”ì¸ë”©
     ************************/
    $(function(){
      renderLegend();
      initDates();
      renderWbs();

      $("#btnSearch").on("click", applySearch);
      $("#btnReset").on("click", doReset);
      $("#btnSave").on("click", doSave);
      $("#btnExport").on("click", doExport);
      $("#btnHelp").on("click", showHelp);

      $("#btnSalesSearch").on("click", ()=> toast("ë°ëª¨: SalesCode ê²€ìƒ‰ íŒì—…ì€ ì—°ë™ ì „ ë‹¨ê³„ì…ë‹ˆë‹¤."));
      $("#btnCustomerSearch").on("click", ()=> toast("ë°ëª¨: ê³ ê°ì‚¬ ê²€ìƒ‰ íŒì—…ì€ ì—°ë™ ì „ ë‹¨ê³„ì…ë‹ˆë‹¤."));

      $("#modalClose, #modalOk").on("click", closeModal);
      $("#modal").on("click", function(e){
        if(e.target === this) closeModal();
      });
      $("#modalCopy").on("click", async function(){
        try{
          await navigator.clipboard.writeText($("#modalBody").text());
          toast("í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }catch(err){
          toast("ë³µì‚¬ ì‹¤íŒ¨(ë¸Œë¼ìš°ì € ê¶Œí•œ í™•ì¸ í•„ìš”)");
        }
      });
    });
  </script>
</body>
</html>
