<div id="wbsPopup" class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
        <h4 class="tit">WBS 실적 등록</h4>
    </div>
    
    <div class="popup_table">
        <div class="form-group">
            <form id="popFormRslts">
            <input type="hidden" id="userId"        name="userId">
            <input type="hidden" id="pgmId"         name="pgmId"    value="WB02201P02">
                <table class="popup_table">
                    <colgroup>
                         <col width="19%">
                          <col width="20%">
                          <col width="20%">
                          <col width="20%">
                          <col width="18%">
                          <col width="17%">
                          <col width="18%">
                          <col width="20%">
                          <col width="18%">
                    </colgroup>
                   <!--   <thead>
                         <tr>
                            <td colspan="9" style="height:30px;text-align: left;">▣ 과제정보</td>                                                
                         </tr>
                     </thead>
                   <tr style="text-align: left;" rowspan="2">
                       <th>과제기본정보</th>                            
                       <th>과제번호</th>
                       <td> 
                          <input type="text" id="sjNo_P" name="sjNo_P" readonly >
                       </td>
                       <th>과제명</th>
                       <td colspan="3"> 
                          <input type="text" id="sjNm_P" name="sjNm_P" readonly>
                       </td>                               
                       <th>Ver.</th>
                       <td>   
                          <input type="text" id="verNo_P" name="verNo_P" readonly>
                       </td>
  
                   </tr>
                   <tr style="text-align: left;" rowspan="2">
                      <th>고객기본정보</th>                            
                      <th >SALES CODE</th>
                      <td> 
                         <div class="search_form">
                          <input type="text" id="salesCd_P" name="salesCd_P" readonly>
                      </div>
                      </td>
                      <th>고객사</th>
                      <td> 
                         <input type="hidden" id="clntCd_P" name="clntCd_P" >
                         <input type="text" id="clntNm_P" name="clntNm_P" readonly >
                      </td>
                      <th>제품</th>
                      <td>
                          <input type="hidden" id="prdtCd_P" name="prdtCd_P" >
                          <input type="text" id="prdtNm_P" name="prdtNm_P" readonly >
                      </td>
                      <th>차종</th>
                      <td>   
                         <input type="hidden" id="clntPjt_P" name="clntPjt_P">
                         <input type="text" id="clntPjtNm_P" name="clntPjtNm_P" readonly >
                      </td>
                  </tr>
                  <tr  style="text-align: left;">
                      <th>실행정보</th>                            
                      <th>제작처 구분</th>
                      <td>
                          <select id="mkerDiv_P" name="mkerDiv_P" data-kind="MAKERDIV" readonly>
                          </select>
                      </td>
                      <th>제작업체</th>
                      <td> 
                         <input type="hidden" id="mkerCd_P" name="mkerCd_P">
                          <div class="search_form" style="width: 100%;">
                              <input type="text" id="mkerNm_P" name="mkerNm_P" readonly> 
                          </div>
                      </td>
                      <th>
                                                               총괄PM
                      </th>
                      <td>
                      <div class="search_form">
                      <input type="hidden" id="smrizeId_P" name="smrizeId_P" >
                      <input type="text" id="smrizeNm_P" name="smrizeNm_P" readonly>
                      </div>    
                      </td>
                      <th style="color: blue;">
                                                               확정
                      </th>                                
                      <td>
                      <input type="hidden" id="closeYn_P" name="closeYn_P" style="color: blue;" readonly>
                      <div id="close"></div>
                      </td>                               
                  </tr>
                   <tr style="text-align: left;">
                      <th>납기정보</th>                            
                      <th>시작일</th>
                      <td>        
                      <input id="beginDt_P" name="beginDt_P" readonly>                            
                      </td>
                      <th>출고일</th>
                      <td>                   
                      <input id="deDt_P" name="deDt_P" readonly>                 
                      </td>
                      <th>완료검수일</th>
                      <td>                   
                      <input id="acptncDt_P" name="acptncDt_P" readonly>                    
                      </td>
                      <th>소요일수</th>
                      <td>                   
                      <input id="reqreDaycnt_P" name="reqreDaycnt_P" readonly >                    
                      </td>
                  </tr>
                   <tr  style="text-align: left;">
                      <th>참조정보</th>                            
                      <th>설계난이도</th>
                      <td>        
                      <select id="dsgnDifCodeId_P" name="dsgnDifCodeId_P" data-kind="DSGNDIF" readonly> 
                      </select>                    
                      </td>
                      <th>설계계획공수</th>
                      <td>                   
                      <input type="text" class="form-control" id="dsgnPlanHour_P" name="dsgnPlanHour_P" readonly>            
                      </td>
                      <th>생산난이도</th>
                      <td>                   
                      <select id="prdctnDifCodeId_P" name="prdctnDifCodeId_P" data-kind="PRDCTNDIF" readonly>
                      </select>                
                      </td>
                      <th>생산계획공수</th>
                      <td>                   
                      <input type="text" class="form-control" id="prdctnPlanHour_P" name="prdctnPlanHour_P" readonly>                  
                      </td>
                  </tr> -->
                   <thead>
                         <tr>
                            <td colspan="9" style="height:30px;text-align: left;">▣ 1레벨 정보</td>                                                
                         </tr>
                     </thead>
                    <tr  style="text-align: left;">
                      <th>계획 정보</th>                            
                      <th>계획명</th>
                      <td> 
                      <input type="text" class="form-control" id="wbsPlanCodeNm1_P" name="wbsPlanCodeNm1_P" readonly>       
                      </td>
                      <th>버전</th>
                      <td>    
                      <input type="text" class="form-control" id="verNo1_P" name="verNo1_P" readonly>                 
                      </td>
                      <th>담당자명</th>
                      <td>
                      <input type="text" class="form-control" id="wbsPlanMngNm1_P" name="wbsPlanMngNm1_P" readonly>                    
                      </td>
                      <th style="color: blue;">확정</th>
                      <td> 
                      <div id="close1"></div>                  
                      </td>
                  </tr> 
                  <tr  style="text-align: left;">
                      <th>기간정보</th>                            
                      <th>시작일자</th>
                      <td>
                      <input type="text" class="form-control" id="wbsPlansDt1_P" name="wbsPlansDt1_P" readonly>          
                      </td>
                      <th>종료일자</th>
                      <td>    
                      <input type="text" class="form-control" id="wbsPlaneDt1_P" name="wbsPlansDt1_P" readonly>                 
                      </td>
                      <th>소요일수</th>
                      <td>  
                      <input type="text" class="form-control" id="daycnt1_P" name="daycnt1_P" readonly>                     
                      </td>
                      <th>계획상태</th>
                      <td>
                      <input type="hidden" class="form-control" id="wbsPlanStsCodeId1_P" name="wbsPlanStsCodeId1_P">   
                      <input type="text" id="wbsPlanStsNm1" name="wbsPlanStsNm1" readonly>                  
                      </td>
                  </tr>
                  <thead>
                         <tr>
                            <td colspan="9" style="height:30px;text-align: left;">▣ 2레벨 정보</td>                                                
                         </tr>
                     </thead>
                    <tr  style="text-align: left;">
                      <th>계획 정보</th>                            
                      <th>계획명</th>
                      <td> 
                      <input type="text" class="form-control" id="wbsPlanCodeNm2_P" name="wbsPlanCodeNm2_P" readonly>
                      <input type="hidden" id="coCd2_P" name="coCd2_P">      
                      <input type="hidden" id="salesCd2_P" name="salesCd2_P">      
                      <input type="hidden" id="wbsPlanNo2_P" name="wbsPlanNo2_P"> 
                      <input type="hidden" id="wbsPlanCodeKind2_P" name="wbsPlanCodeKind2_P" >
                      <input type="hidden" id="wbsPlanCodeId2_P" name="wbsPlanCodeId2_P" >
                      <input type="hidden" id="fileTrgtKey1_P"    name="fileTrgtKey1_P">
                      <input type="hidden" id="fileTrgtKey2_P"    name="fileTrgtKey2_P">
                      </td>
                      <th>버전</th>
                      <td>    
                      <input type="text" class="form-control" id="verNo2_P" name="verNo2_P" readonly>                 
                      </td>
                      <th>담당자명</th>
                      <td>
                      <input type="text" class="form-control" id="wbsPlanMngNm2_P" name="wbsPlanMngNm2_P" readonly>                    
                      </td>
                      <th style="color: blue;">확정</th>
                      <td> 
                      <div id="close2"></div>                  
                      </td>
                  </tr> 
                  <tr  style="text-align: left;">
                      <th>기간정보</th>                            
                      <th>시작일자</th>
                      <td>
                      <input type="text" class="form-control" id="wbsPlansDt2_P" name="wbsPlansDt2_P" readonly>          
                      </td>
                      <th>종료일자</th>
                      <td>    
                      <input type="text" class="form-control" id="wbsPlaneDt2_P" name="wbsPlansDt2_P" readonly>                 
                      </td>
                      <th>소요일수</th>
                      <td>  
                      <input type="text" class="form-control" id="daycnt2_P" name="daycnt2_P" readonly>                     
                      </td>
                      <th>계획상태</th>
                      <td> 
                      <input type="hidden" class="form-control" id="wbsPlanStsCodeId2_P" name="wbsPlanStsCodeId2_P">   
                      <input type="text" id="wbsPlanStsNm2" name="wbsPlanStsNm2" readonly>                     
                      </td>
                  </tr>
                   <thead>
                        <tr>
                           <td colspan="9" style="height:30px;text-align: left;">▣2레벨 실적정보</td>                                                
                        </tr>
                    </thead>                    
                    <tbody>
                    <tr style="text-align: left;">
					    <th>실적번호</th>
					    <td> 
					    <div class="search_form"  style="width: 100%;">
                            <input type="text"  id="wbsRsltsNo" name="wbsRsltsNo"  data-search="wbsRsltsNo" readonly>
                        </div>
                        </td>
                        
					    <th>담당자</th>
					    <td>
					    <div class="search_form">
                            <input type="hidden" id="wbsRsltsId" name="wbsRsltsId">
                            <input type="text" id="wbsRsltsNm" name="wbsRsltsNm" readonly>
                        </div>
					    </td>
					    <td colspan="5" rowspan="5">
					      <div class="popup_table">               
			                <table style="border:0px;">
			                    <tr style="height:30px;">
			                      <td style="text-align: LEFT; border-right: 0px;;font-size:13px;font-weight:bold;">※ 공유 및 결재</td>
			                      <td>
			                          <div class="add_btn_small pdl10">       
			                              <a onclick="insertShareUserModal();" style="height: 30px; line-height: 28px;" >+</a>
			                              <a onclick="deleteShareUser();" style="height: 30px; line-height: 28px;" >-</a>    
			                          </div>
			                      </td>
			                    </tr>
			                    <tr>
			                      <td colspan="2">
			                       <div>
			                         <div class="ax5_grid" data-ax5grid="first-grid-modal" data-ax5grid-config="{}" style="height: 220px; width: 100%;" ></div>
			                       </div>
			                      </td> 
			                    </tr>  
			                </table>
			            </div> 
					    </td>
					</tr>
					<tr style="text-align: left;">
					    <th class="hit">시작일자</th>
                        <td>
                        <div class="date_input">
                            <input type="text" class="input_calendar form-control" style="width: 100% !important; display: inline-block !important;" id="wbsRsltssDt" name="wbsRsltssDt" autocomplete="off" date required msg="시작일자">
                        </div>
                        </td>
                        <th class="hit">종료일자</th>
                        <td>
                        <div class="date_input">
                            <input type="text" class="input_calendar form-control" style="width: 100% !important; display: inline-block !important;" id="wbsRsltseDt" name="wbsRsltseDt" autocomplete="off" date required msg="종료일자"> 
                        </div>
                        </td>
					</tr>
					<tr style="text-align: left;">
					    <th style="color: blue;">일수</th>
                        <td> 
                          <input type="text" id="rsltsDaycnt" name="rsltsDaycnt" readonly>    
                          <input type="hidden" id="rsltsFileTrgtKey"    name="rsltsFileTrgtKey">
                                
                        </td>
                        <th style="color: blue;">확정</th>
	                      <td> 
	                      <div id="close3"></div>                  
	                      </td>
					</tr>
					<tr style="text-align: left;">
					    <th>진척율</th>
                            <td class="hit">
                               <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsRate" name="wbsRsltsRate" onkeyup="onlyNumber(this)" required msg="진척율">
                                </div>
                            </td>
                            <th class="hit">투입공수</th>
                            <td>
                              <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsMh" name="wbsRsltsMh"  onkeyup="onlyNumber(this)" required msg="실투입공수">
                                   <input type="hidden"  id="wbsRsltsPlanMh" name="wbsRsltsPlanMh">
                                </div>
                            </td>
					</tr>
					<tr style="text-align: left;">
					    <th>주요내용</th>
                        <td colspan=3>
                                <textarea id="wbsRsltsCnts" name="wbsRsltsCnts" cols="65" rows="6" style="border:none;outline: none;"></textarea> 
                        </td>
					</tr> 
                    </tbody>                    
                </table>    
            </form>
        </div>
    </div>    
    
    <div class="contents"> 
    <!-- 공통 파일 영역 -->
         <div id="fileList_area"></div>       
    </div>
    <br>
    <div class="col-xs-2" style="height: 70px;">
    </div>

    <!-- 하단 버튼 -->
    <div class ="popup_bottom_btn">
        <button type="button" id="actionBtn" >등록</button>
        <button type="button" class="close_btn"
            onclick="modalStack.close();">닫기</button>
    </div>
 </div>   
<script type="text/javascript">
var actionType = null;
setCommonSelect($(".popup_area select[data-kind]"));

var gridViewPop = {
        initView : function() {
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: true,
                multipleSelect: false,
                sortable: false,
                target: $('[data-ax5grid="first-grid-modal"]'),
                header: {
                    align: "center",
                    selector: true
                },
                body: {
                     onClick: function () {
                        this.self.select(this.dindex);
                    },
                    onDBLClick: function () {
                    },
                    mergeCells : ["gb"],
                },
                page : {
                    navigationItemCount : 10,
                    height : 30,
                    display : true,
                    firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
                    prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
                    nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                    lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
                    onChange : function() {
                        gridView.setData(this.page.selectPage);
                    }
                },
                columns : [
                        {key: "gb",                 label: "구분",        align: "center",   width: 40},
                        {key: "wbsPlancoCdNm",      label: "회사명",      align: "center",   width: 130, hidden: true},
                        //{key: "wbsSharngUserId",  label: "ID",        align: "center",   width: 130, hidden: false},
                        {key: "usrNm",              label: "ID",        align: "center",   width: 130, hidden: true},
                        {key: "empNo",              label: "사원번호",  align: "center",   width: 130, hidden: true},
                        {key: "name",               label: "성명",        align: "center",   width: 80},
                        {key: "jik",                label: "직위",        align: "center",   width: 60},
                        {key: "reqDate",            label: "요청일자",  align: "center",   width: 90},
                        {key: "todoCfDt",           label: "확인일자",      align: "center",   width: 130},
                        {key: "todoCfOpn",          label: "확인의견",  align: "left",     width: 200},
                        {key: "telNo",              label: "H.P",       align: "center",   width: 130},
                      ]
                    });
                    return this;
                },

                setData : function(_pageNo) {
                    var targetObj = this.target;
                    var formData = {
                            "fileTrgtKey" : $("#popFormRslts #rsltsFileTrgtKey").val(),
                            "reqNo" :  $("#popFormRslts #wbsRsltsNo").val(), 
                            "pageNo" : _pageNo + 1
                    }
                    postAjax("/user/qm/qm01/selectShareUserlst", formData, null, function(data){    
                    var list = data.result;
                        targetObj.setData({
                            list : list,
                            page : {
// //                                   currentPage : _pageNo,
// //                                   pageSize : data.paginationInfo.pageSize,
                                        totalElements :  data.paginationInfo.totalRecordCount,
// //                                   totalPages : data.paginationInfo.totalPageCount
                            } 
                        });
                    });
                },

                setData2 : function(_list) {
                    this.target.setData({
                            list : _list,
                            page : {
                                        totalElements :  _list.length,
                            } 
                        });
                }
    }
    
     
$(document).ready(function() {
  var actionType = modalStack.last().paramObj.actionType;
  var paramObj = modalStack.last().paramObj;
  $.each(paramObj, function (index, item) {
	  $("#popFormRslts #" + index).val(item);       
	  /* if (index == "mkerDiv_P") {
          $('#mkerDiv_P option[value!="' + item + '"]').remove();
      }
      else if (index == "dsgnDifCodeId_P") {    	  
          $('#dsgnDifCodeId_P option[value!="' + item + '"]').remove();
      }
      else if (index == "prdctnDifCodeId_P") {
          $('#prdctnDifCodeId_P option[value!="' + item + '"]').remove();
      } */
      if (index == "closeYn_P") {   
          var color = item == "Y" ? "color-circle_02.png" : "color-circle_01.png";
          var html = '<img src="/static/img/'+color+'" align="center" style="width: 10px;height: 10px;"></img>';
          $("#popFormRslts #close").html(html)
      }       
  })

   
  var row1 = gridView1.target.getList("selected")[0];
  if (row1 != undefined) {
	  $.each(row1, function (key, val) { 
		  $("#popFormRslts #" + key + "1_P").val(val);
		  if (key == "wbsPlanStsCodeIdNm") {
              $('#wbsPlanStsNm1').val(val);
          }
		  if (key == "closeYn") {   
	          var color = val == "Y" ? "color-circle_02.png" : "color-circle_01.png";
	          var html = '<img src="/static/img/'+color+'" align="center" style="width: 10px;height: 10px;"></img>';
	          $("#popFormRslts #close1").html(html)
	      } 	      
	  }); 
	 
  }
  
  var row2 = gridView2.target.getList("selected")[0];
  if (row2 != undefined) {
	  $.each(row2, function (key, val) {
          if (actionType == "C") {
              if (key == "wbsPlanNo") {
                  $("#popFormRslts #wbsRsltsNo").val(val);
              }          
              else if (key == "wbsPlanMngId") {
                  $("#popFormRslts #wbsRsltsId").val(val);
              }
              else if (key == "wbsPlanMngNm") {
                  $("#popFormRslts #wbsRsltsNm").val(val);
              }
              else if (key == "wbsPlansDt") {
                  $("#popFormRslts #wbsRsltssDt").val(val);
              }              
              else if (key == "wbsPlaneDt") {
                 $("#popFormRslts #wbsRsltseDt").val(val);
              }
              else if (key == "daycnt") {
                  $("#popFormRslts #rsltsDaycnt").val(val);
              }               
          }
          if (key.includes('Rslts') || key.includes('rslts')) {
        	  
              $("#popFormRslts #" + key).val(val);  
          }
          else {
              $("#popFormRslts #" + key + "2_P").val(val);  
          }  
          
          if (key == "wbsPlanStsCodeIdNm") {
              $('#wbsPlanStsNm2').val(val);
          }
          
          
          /* if (key == "wbsPlanStsCodeId") {
              $('#wbsPlanStsCodeId2_P option[value!="' + val + '"]').remove();
          } */          
          if (key == "closeYn") {   
              var color = val == "Y" ? "color-circle_02.png" : "color-circle_01.png";
              var html = '<img src="/static/img/'+color+'" align="center" style="width: 10px;height: 10px;"></img>';
              $("#popFormRslts #close2").html(html)
          } 
          else if (key == "rsltsCloseYn") {
        	  var color = val == "Y" ? "color-circle_02.png" : "color-circle_01.png";
              var html = '<img src="/static/img/'+color+'" align="center" style="width: 10px;height: 10px;"></img>';
              $("#popFormRslts #close3").html(html)
          }
      }); 
  }
  
  $("#popFormRslts #userId").val(jwt.userId);
  
  $("#popFormRslts #wbsRsltssDt").datepicker({
      format : "yyyy-mm-dd",
      language : "ko",
      autoclose : true
 })
 //.datepicker("setDate", new Date())
 .on("changeDate", function(){
     dateChk();
 });
  
 $("#popFormRslts #wbsRsltseDt").datepicker({
      format : "yyyy-mm-dd",
      language : "ko",
      autoclose : true
 })
 //.datepicker("setDate", new Date())
 .on("changeDate", function(){
     dateChk();
 });
 
 gridViewPop.initView().setData(0);
 
  //---------------------------------------------------------------  
  //첨부 화일 처리 시작 
  //---------------------------------------------------------------
  //alert(fileTrgtKey);
  //alert($("#pgmId").val());
  fileParam = {
          fileTrgtTyp : $("#popFormRslts #pgmId").val(),
          fileTrgtKey     :$("#popFormRslts #rsltsFileTrgtKey").val()
  }
  treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
  //---------------------------------------------------------------  
  //첨부 화일 처리 끝
  //---------------------------------------------------------------  
  if (actionType == "C") {
	  $('#actionBtn').text("등록");
      $('#actionBtn').on("click", function() {
          insertWbsRslts();
      });
  }
  else {
	  $('.tit').text('WBS 실적 수정')
      $('#actionBtn').text("수정");
      $('#actionBtn').on("click", function() {
          updateWbsRslts();
      });
  }
            
  authChk();
});


function makeFormData() {       
    // 폼데이터 생성
    var formData = new FormData($("#popFormRslts")[0]);
    formData.append("coCd", jwt.coCd);
    //-------itemarr  --첨부화일 처리를 위한 부분 시작
    formData.append("comonCd", treeModule.getFileNodeId()); //첨부화일용

    var fileUploadArr = [];
    var tempArr = [];
    
    tempArr = treeModule.getFileArr();
    $.each(tempArr, function(idx, obj) {
        if (obj.fileKey == 0) {
            formData.append("files", obj.file);
            obj.file = '';
            fileUploadArr.push(obj);
        }
    });

    formData.append("uploadFileArr", JSON.stringify(fileUploadArr));
    formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
    //---------------------------------------------------------------  
    //--첨부화일 처리를 위한 부분 끝
    //--------------------------------------------------------------- 

   var rowSharngList = gridViewPop.target.list;
   var ParamObj = modalStack.last().paramObj.ParamObj;

   if(rowSharngList.length > 0) {
       var rowSharngListArr = []; //공유정보
       var rowApprovalListArr = []; //결재정보
       $.each(rowSharngList, function(idx, elem){
           var rowSharngListObj = elem;
           var rowApprovalListObj = elem;

           if (elem.gb == '공유'){
               rowSharngListObj["gb"] = elem.gb;
               rowSharngListObj["coCd"] = $('#coCd').val();
               rowSharngListObj["salesCd"] = $('#salesCd2_P').val();
               rowSharngListObj["todoDiv1CodeId"] = "TODODIV10";
               rowSharngListObj["todoDiv2CodeId"] = "TODODIV1020";
               rowSharngListObj["todoId"] = elem.usrNm;
               rowSharngListObj["todoCoCd"] = elem.coCd;
               rowSharngListObj["empNo"] = elem.empNo;
               rowSharngListObj["name"] = elem.name;
               rowSharngListObj["telNo"] = elem.telNo;
               rowSharngListObj["email"] = elem.eMail;    
               rowSharngListObj["pgPath"] = "/user/wb22/WB2201P02.html";
               rowSharngListArr.push(rowSharngListObj);

           }
           else if (elem.gb == '결재'){
               rowApprovalListObj["gb"] = elem.gb;
               rowApprovalListObj["coCd"] = $('#coCd').val();
               rowApprovalListObj["salesCd"] = $('#salesCd2_P').val();
               rowApprovalListObj["todoDiv1CodeId"] = "TODODIV20";
               rowApprovalListObj["todoDiv2CodeId"] = "TODODIV2010";
               rowApprovalListObj["todoId"] = elem.usrNm;
               rowApprovalListObj["todoCoCd"] = elem.coCd;
               rowApprovalListObj["empNo"] = elem.empNo;
               rowApprovalListObj["name"] = elem.name;
               rowApprovalListObj["telNo"] = elem.telNo;
               rowApprovalListObj["email"] = elem.eMail;    
               rowApprovalListObj["pgPath"] = "/user/wb22/WB2201P02.html";
               rowApprovalListArr.push(rowApprovalListObj);
           }
       });
       formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));
       formData.append("rowApprovalListArr", JSON.stringify(rowApprovalListArr));
   }
   return formData;
}


function insertWbsRslts() {    
    if (inputValidation($('.popup_area [required]'))) { 
        if ($("#wbsRsltsRate").val() == "0") {
            alert("진척율 값이 0입니다");
            return;
        }
        if ($("#wbsRsltsMh").val() == "0") {
            alert("실투입공수 값이 0입니다");
            return;
        }
        var formData = makeFormData();                                      
        filePostAjax("/user/wb/wb22/wbsRsltsInsert", formData,             
                function(data) {
                    alert(data.resultMessage);                              
                    if (data.resultCode == 200) {                          
                        gridView2.setData(0);
                        modalStack.close();                              
                    }
                });                                
    }
}

function updateWbsRslts() {    
    if (inputValidation($('.popup_area [required]'))) { 
        if ($("#wbsRsltsRate").val() == "0") {
            alert("진척율 값이 0입니다");
            return;
        }
        if ($("#wbsRsltsMh").val() == "0") {
            alert("실투입공수 값이 0입니다");
            return;
        }
        var formData = makeFormData();                                      
        filePostAjax("/user/wb/wb22/wbsRsltsUpdate", formData,             
                function(data) {
                    alert(data.resultMessage);                              
                    if (data.resultCode == 200) {                          
                        gridView2.setData(0);
                        modalStack.close();                              
                    }
                });                                
    }
}



function dateChk() {
	//debugger;
    if($('#wbsRsltssDt').val() != "" 
       && $('#wbsRsltssDt').val() < $('#wbsPlansDt2_P').val()){
       alert("실적 시작일이 2레벨 시작일보다 이전날짜입니다.");
       $('#wbsRsltssDt').datepicker("setDate", $('#wbsPlansDt2_P').val());
       return;
    }
    
    if($('#wbsRsltssDt').val() != "" 
    	&& $('#wbsRsltssDt').val() > $('#wbsPlaneDt2_P').val()){
        alert("실적 시작일이 2레벨 종료일 이후 날짜입니다.");
        $('#wbsRsltssDt').datepicker("setDate", $('#wbsPlansDt2_P').val());
        return;
     }
    
    if($('#wbsRsltseDt').val() != "" 
    	&& $('#wbsRsltseDt').val() < $('#wbsPlansDt2_P').val()){
        alert("실적 종료일이 2레벨 시작일보다 이전날짜입니다.");
        $('#wbsRsltseDt').datepicker("setDate", $('#wbsPlaneDt2_P').val());
        return;
     }
     
    if($('#wbsRsltseDt').val() != "" 
    	&& $('#wbsRsltseDt').val() > $('#wbsPlaneDt2_P').val()){
        alert("실적 종료일이 2레벨 종료일 이후 날짜입니다.");
        $('#wbsRsltseDt').datepicker("setDate", $('#wbsPlaneDt2_P').val());
        return;
     }
     
   $('#rsltsDaycnt').val(calcDate($('#wbsRsltssDt').val(), $('#wbsRsltseDt').val())); 
}

function calcDate(fDate, tDate) {
    var date1 = new Date(fDate.substr(0,4), fDate.substr(5,2), fDate.substr(8,2));
    var date2 = new Date(tDate.substr(0,4), tDate.substr(5,2), tDate.substr(8,2));
    var count = 0;
    while(true) {   
        var temp_date = date1;
        if(temp_date.getTime() > date2.getTime()) {
            console.log("count : " + count);
            break;
        } else {
            var tmp = temp_date.getDay();
            if(tmp == 0 || tmp == 6) {
            } else {
                count++;         
            }
            temp_date.setDate(date1.getDate() + 1); 
        }
    }
    return count;
}

//공유대상자 추가//  
function insertShareUserModal() {    
    var paramObj = {};
    var appshaList = gridViewPop.target.list;
    paramObj["coCd"] = $('#coCd').val();
    paramObj["useYn"] =  "Y";
    paramObj["userId"] =  $('#ordrgId').val();
    paramObj["userNm"] =  $('#ordrgNm').val();
    paramObj["approvalGrid"] = $.grep(appshaList, function(item) {return item.gb === "결재";   
            }).map(function(item) {
                    return {
                        gb: "결재",
                        id: item.usrNm,
                        text: item.name,
                        parent: item.jik,
                        deptNm: item.dtNm,
                        telNo: item.telNo,
                        offTelNo: item.offTelNo,
                        email: item.email
                    };
            });
    paramObj["shareGrid"] =  $.grep(appshaList, function(item) { return item.gb === "공유";
            }).map(function(item) {
                    return {
                        gb: "공유",
                        id: item.usrNm,
                        text: item.name,
                        parent: item.jik,
                        deptNm: item.dtNm,
                        telNo: item.telNo,
                        offTelNo: item.offTelNo,
                        email: item.email
                    };
            });
    openModal("/static/html/cmn/modal/userLstSearch.html", 900, 500, "작성자 검색", paramObj, function (approvalGrid, shareGrid){
        console.log('결재라인 : ', approvalGrid.target.list);
        console.log('공유라인 : ', shareGrid.target.list);
        
        var appArray = approvalGrid.target.list.map(function(item) {
              return {
                    gb: "결재",
                    usrNm: item.id,
                    name: item.text,
                    jik: item.parent,
                    dtNm: item.deptNm,
                    telNo: item.telNo,
                    offTelNo: item.offTelNo,
                    email: item.email,
                };
        });
        var shaArray = shareGrid.target.list.map(function(item) {
          return {
                    gb: "공유",
                    usrNm: item.id,
                    name: item.text,
                    jik: item.parent,
                    dtNm: item.deptNm,
                    telNo: item.telNo,
                    offTelNo: item.offTelNo,
                    email: item.email,
                };
        });
        gridViewPop.setData2(appArray.concat(shaArray));
        
//      approvalGrid.id //userId
//      approvalGrid.text //성명
//      approvalGrid.parent //직책
//      approvalGrid.deptNm //부서
//      approvalGrid.telNo
//      approvalGrid.offTelNo
//      approvalGrid.email
        
//      shareGrid.id //userId
//      shareGrid.text //성명
//      shareGrid.parent //직책
//      shareGrid.deptNm //부서
//      shareGrid.telNo
//      shareGrid.offTelNo
//      shareGrid.email
    });
    
}   

function deleteShareUser(){
    
    var selRow = parseInt(gridViewPop.target.selectedDataIndexs);    
    if( isNaN(selRow) ) {
        alert("선택된 행이 없습니다.");
        return;
    } else {            
            if( selRow > -1 ) {
                gridViewPop.target.removeRow(selRow);                   
            }
    }
}


</script>
