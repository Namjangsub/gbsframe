<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="/static/fontawesome/css/all.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5grid.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5mask.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5modal.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5toast.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5menu.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5calendar.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5picker.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5select.css">
    <link rel="stylesheet" href="/static/css/jstree/style.min.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5combobox.css">
    <link rel="stylesheet" href="/static/css/gnb.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/sub.css">
    <link rel="stylesheet" href="/static/css/common.css">

    <script type="text/javascript" src="/static/js/jquery-latest.min.js"></script>
    <script type="text/javascript" src="/static/js/jquery.serializeObject.js"></script>
    <script type="text/javascript" src="/static/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
    <script type="text/javascript" src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
    <script type="text/javascript" src="/static/js/moment/moment-with-locales.js"></script>
    <script type="text/javascript" src="/static/js/jstree/jstree.min.js"></script>
    <script type="text/javascript" src="/static/js/ax5/ax5core.min.js"></script>
    <script type="text/javascript" src="/static/js/ax5/ax5grid.min.js"></script>
    <script type="text/javascript" src="/static/js/ax5/ax5mask.min.js"></script>
    <script type="text/javascript" src="/static/js/ax5/ax5modal.min.js"></script>
    <script type="text/javascript" src="/static/js/ax5/ax5toast.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.5.0/jszip.min.js"></script>
    <script type="text/javascript" src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" ></script>
    <script type="text/javascript" src="/static/js/global.js"></script>
    <script type="text/javascript" src="/static/js/fileTree.js"></script>

    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-calendar/master/dist/ax5calendar.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-picker/master/dist/ax5picker.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-menu/master/dist/ax5menu.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-formatter/master/dist/ax5formatter.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-combobox/master/dist/ax5combobox.min.js"></script>
    <script type="text/javascript" src="https://cdn.rawgit.com/ax5ui/ax5ui-select/master/dist/ax5select.min.js"></script>


</head>

<body>
	<div id="head_area"></div>
	<div id="top_area"></div>
	
	<div id="main_area">
		<!-- 페이지 상단 -->
		<div class="contents no_bg">
			<ul class="btn_ul">
				<li class="btn_r">
					 <a onclick="initSearch();"><button class="bg_gray">초기화</button></a>
					 <a onclick="salesGridView.setData(0);"><button class="bg_gray">검 색</button></a>
	            </li>
            </ul>
        </div>
    
		<!-- 검색 콘텐츠 -->
		<div class="contents search">
			<div class="">
				<!-- 테이블 인풋 3분할 -->
				<table class="table_input type04">
				
					<!-- 검색조건 1행 -->
					<tr>
						<th class= "hit">회사</th>
						<td>
							<select id="coCd_S" name="coCd_S" data-kind="CO" data-search="coCd" required msg="회사" onChange="salesGridView.setData(0);">
						      </select>
						</td>
						
						<th class= "hit">Sales Code</th>
						<td>
	                         <div class="search_form">
                                <input type="text" id="salesCd_S" name="salesCd_S" data-search="salesCd" onkeyup="event.keyCode == 13 ? salesGridView.setData(0) : ''">
                                <a onclick="wbsSalesCodeSearchM();"><i class="i_search_w"></i></a>
                            </div>
                            <input type="hidden" id="salesNm_S" name="salesNm_S" >
						</td>
						
						<th>&nbsp;</th>
						<td>&nbsp;</td>
						
						<th></th>
						<td>
						   
						</td>
					</tr>
		            <!-- 검색조건 END -->
	            </table>
	            <input type="hidden" id="userId"    name="userId">
                <input type="hidden" id="pgmId"     name="pgmId" value="WB0111M01">
            </div>
        </div>

    <div class="contents no_bg">
              <div class="contents_tit">
                <div class="add_btn_small pdl10">
                  <a onclick="wbsPlanInsertModal();" style="height: 30px; line-height: 28px; width: 100px;">WBS계획등록</a>
                  <a onclick="excelDown();" style="height: 30px; line-height: 28px; width: 90px;"><i class="fas fa-file-excel"></i> 엑셀다운로드</a>
                  
                </div>
                <select id="recordCnt" class="prae_select" onchange="salesGridView.setData(0);">
                  <option value="10">10</option>
                  <option value="20" >20</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                  <option value="9999999" selected>전체</option>
                </select> 
    </div>
        
    <div class="row" style="margin-top: 15px;">
      <div class="col-xs-4" style="padding-right: 5px;">
        <div class="contents" style="margin: 0px; padding: 0px; height: 100%; width: 100%; min-width: 300px">
		      <div class="ax5_grid" data-ax5grid="sales-grid" data-ax5grid-config="{}" style="width: 100%; height: 750px;"></div>            
        </div>
      </div>
      <div class="col-xs-8" style="padding-left: 0;">
		<div class="contents">
                <div class="ax5_grid" data-ax5grid="main-grid" data-ax5grid-config="{}" style="height: 700px; width: 100%" ></div>
              <div data-ax5grid="excel-grid" data-ax5grid-config="{}" style="display: none;"></div>                     
            </div>
		</div>
      </div>
    </div>		         
</body>
</html>

<script type="text/javascript">
 var isFirst = true;
 var coCd = null;
 var salesCd = null;

 ax5.ui.grid.formatter["chkYn"] = function () {
	    var color = this.value == "Y" ? "color-circle_02.png" : "color-circle_01.png";
	    if (this.value == "E"){
	        return ' ';
	    } else {
	        return '<img src="/static/img/'+color+'" style="width: 10px;height: 10px;"></img>';
	    }
	};
	var salesGridView = {
		    initView : function() {
		        this.target = new ax5.ui.grid();
		        this.target.setConfig({
			        showLineNumber: false,
					showRowSelector : true,
					multipleSelect : true,
					sortable : false,
		            target: $('[data-ax5grid="sales-grid"]'),
		            header : {
		                align : "center",
		                selector : true
		            },
		            body: {
		            	mergeCells : ["ordrsClntNm","ordrsNo","salesCd"],
		            	columnHeight: 26,
		                onClick: function () {	
		                	var list = salesGridView.target.getList("selected");
                            $.each(list, function(idx, obj){
                                salesGridView.target.select(obj.__origin_index__, {selected: false});
                            });
		                	this.self.select(this.doindex);
		                	
		                	coCd = this.item.coCd;
		                	salesCd = this.item.salesCd;
		                },
		                onDBLClick: function () {
		                },
		                onDataChanged: function () {
                        }
		           },
		           columns: [
		        	   {key: "pid",  			label: "pid", 		hidden: true},
		               {key: "id",  			label: "id", 		width: 160, hidden: true},
		               {key: "coCd",            label: "회사",       hidden: true},                       
		               {key: "ordrsClntNm",		label: "고객사",		width: 100, align: "left"},
		               {key: "ordrsNo",  		label: "오더번호", 	width: 100, hidden: true, align: "left"},
		               {key: "salesCd",  		label: "SALES CD", 	width: 200, hidden: false, align: "left",  treeControl: true},
		               {key: "planCnt",  		label: "계획/실적", 	width: 60, hidden: false, align: "center", formatter: function () {
		            	   return this.item.dataGbn=='D' ? this.value + '/'+this.item.rsultCnt : ''}},
// 		               {key: "rsultCnt",  		label: "실적", 	width: 100, hidden: false, align: "center"},
					   {label: "계획", columns: [  
				               {key: "planLockYn",  		label: "잠금", 	width: 35, align: "center", formatter: "chkYn"},  
				               {key: "planCloseYn",  		label: "마감", 	width: 35, align: "center", formatter: "chkYn"},
				       ]},
					   {label: "실적", columns: [  
				               {key: "rsultLockYn",  		label: "잠금", 	width: 35, align: "center", formatter: "chkYn"},  
				               {key: "rsultCloseYn",  		label: "마감", 	width: 35, align: "center", formatter: "chkYn"},  
				       ]},
		               {key: "dataGbn",  		label: "원시구분",  hidden: true},
		           ],
		           page : {
	                    navigationItemCount : 10,
	                    height : 30,
	                    display : true,
	                },
	                tree: {
	                	use: true,
                        indentWidth: 15,
                        arrowWidth: 15,
                        iconWidth: 18,
                        icons: {
                            openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
                            collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                            groupIcon: '<i class="fa fa-folder-open" aria-hidden="true"></i>',
                            collapsedGroupIcon: '<i class="fa fa-folder" aria-hidden="true"></i>',
                            itemIcon: '<i class="fa fa-file" aria-hidden="true"></i>'
                        },
                       columnKeys: {
                           parentKey: "pid",
                           selfKey: "id",
                       }
		           }
		        });
		        return this;
		    },
		    setData : function(_pageNo) {
		    	if (isFirst) return;
	            var targetObj = this.target;
    			var paramObj = {
    					"coCd": $('#coCd_S').val(),
    					"salesCd": $('#salesCd_S').val()
    			};
	            postAjax("/user/wb/wb22/selectWbsLeftSalesCodeList", paramObj, null, function(data){
	            	 var list = data.fileList;
	                    targetObj.setData({
	                        list : list,
	                        page : {
                                totalElements : list.length
	                        }
	                    });
	            });
	        } 
		    
		}
	
	$(document).ready(function() {

		 mainDefaultLoad("WBS", "일정계획관리");          // 페이지 타이틀 설정
		 setCommonSelect($("#main_area select[data-kind]"));     // 공통코드 set

		 isFirst = false;    
		 
		 $("#coCd_S").val(jwt.coCd);
		 $("#salesCd_S").val("23001-01HTFUP");
		 salesGridView.initView().setData(0);
		 //권한체크
		 authChk();

		});
	
	function wbsPlanInsertModal() {
	       var row = salesGridView.target.getList("selected")[0];
	       if (row != undefined) {
	    	   var paramObj = {"coCd": row.coCd,
	    		               "salesCd": row.salesCd
	    		              };
	    	   openSecondModal("/static/html/user/wb/wb22/WB2201P01.html", 1300,860, "WBS 계획등록", paramObj, function (){  	               
	           });
	       }
	       else {
	    	   alert("SALES CODE을 선택하세요");
	       }
	}
	
    function wbsSalesCodeSearchM() {
        var paramObj = {
           "coCd" : $('#coCd_S').val(),
           "salesCd": $('#salesCd_S').val()
        };
        openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 430, "SALES CODE 검색", paramObj, function (grid){
            var row = grid.target.getList("selected")[0];
            $('#salesCd_S').val(row.salesCd);
            salesGridView.setData(0);
        });
    }
    
</script>
