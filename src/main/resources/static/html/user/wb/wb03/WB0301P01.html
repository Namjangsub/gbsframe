
<div id="wbsPopup" class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
        <h4 class="tit">WBS 이슈 등록</h4>
    </div>
    
    <div class="popup_table">
        <div class="form-group">
            <form id="popForm">
            <input type="hidden" id="wbsPlanFileTrgtKey"    name="wbsPlanFileTrgtKey">
            <input type="hidden" id="fileTrgtKey"    name="fileTrgtKey">
            <input type="hidden" id="userId"        name="userId">
            <input type="hidden" id="wbsPlanCodeKind"    name="wbsPlanCodeKind">
            <input type="hidden" id="wbsPlanCodeId"    name="wbsPlanCodeId">
            <input type="hidden" id="pgmId"         name="pgmId"    value="WB0301P01">
                <table class="popup_table">
                    <colgroup>
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="6%">
                    </colgroup>
                    
                    <thead>
                        <tr>
                           <td colspan="9" style="height:30px;text-align: left;">기본정보</td>                                                
                        </tr>
                    </thead>
                    
                    <tbody>
                        <!-- 1행 -->
                        <tr>
                            <th>회사</th>
                            <td>
                                <select id="coCd" name="coCd" data-kind="CO" required msg="회사">
                                </select>
                            </td>
                            <th>관리번호</th>
                            <td>
                                <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsPlanNo" name="wbsPlanNo"  data-search="wbsPlanNo"  readonly >
                                </div>
                            </td>
                            <th>작성일자</th>
                            <td> 
                            <input id="wbsPlanDt" id="wbsPlanDt" name="wbsPlanDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" required date>
                            </td>
                            <th>작성자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanId" name="wbsPlanId" msg="작성자" >
                                    <input type="text" id="wbsPlanNm" name="wbsPlanNm" onkeyUp="if(window.event.keyCode == 8){wbsPlanId.value = ''};" readonly required msg="작성자" >
                                </div>
                            </td>
                            <th rowspan="6" style="vertical-align:top;">
                                
                            </th>
                        </tr>
                                     
                        <!-- 2행 -->
                         <tr>
                            <th>Sales Code</th>
                            <td>
                                <div class="search_form">
                                    <input type="text" id="salesCd" name="salesCd" required readonly msg="salesCd">                                   
                                </div>
                            </td>
                            <th>고객사</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="clntCd" name="clntCd" msg="고객사">
                                    <input type="text" id="clntNm" data-search="clntNm" msg="고객사" readonly>
                                   
                                </div>
                            </td>
                            <th>고객사PJT</th>
                            <td>
                                 <input type="text" id="clntPjt" name="clntPjt" msg="고객사PJT" readonly>
                            </td>
                            <th>신작구분</th>
                            <td>
                                 <input type="hidden" id="ordrsDtlDiv20" name="ordrsDtlDiv20" msg="신작구분">
                                 <input type="text" id="ordrsDtlDiv20Nm" name="ordrsDtlDiv20Nm" readonly msg="신작구분">
                            </td>
                        </tr>
                        
                         
                         <tr>
                            <th>Lv.1</th>
                            <td>
                                    <select id="wbsLevel1" name="wbsLevel1"  data-kind="WBSDIV" onchange="selectCodeList(this,0);optionGubun();" data-depth="0" required msg="WBS레벨 1">
                                      <option value="">선택</option>
                                    </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId1" name="wbsPlanMngId1">
                                    <input type="text" id="wbsPlanMngNm1" name="wbsPlanMngNm1" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId1.value = ''};" readonly required msg="레벨1담당자">                                    
                                </div>
                            </td>
                            <th>시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt1" name="wbsPlansDt1" autocomplete="off" date>
                                </div>
                            </td>
                            <th>종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt1" name="wbsPlaneDt1" autocomplete="off" date>
                                </div>
                            </td>
                        </tr>
                        
                        
                        <tr id = "level2Area" style="display:none">
                            <th>Lv.2</th>
                            <td>
                                  <select class="division" id="wbsLevel2" name="wbsLevel2" onchange="selectCodeList(this,1);" data-depth="1" msg="WBS레벨 2">
                                    <option value="">선택</option>
                                  </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId2" name="wbsPlanMngId2">
                                    <input type="text" id="wbsPlanMngNm2" name="wbsPlanMngNm2"onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId2.value = ''};" readonly  msg="레벨2담당자">
                                </div>
                            </td>
                            <th>시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt2" name="wbsPlansDt2" autocomplete="off" date>
                                </div>
                            </td>
                            <th>종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt2" name="wbsPlaneDt2" autocomplete="off" date>
                                </div>
                            </td>
                        </tr>


                         <tr  id = "level3Area"  style="display:none">
                            <th>Lv.3</th>
                            <td>
                                 <select class="division" id="wbsLevel3" name="wbsLevel3" data-depth="2"  msg="WBS레벨 3">
                                    <option value="">선택</option>
                                 </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                 <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId3" name="wbsPlanMngId3">
                                    <input type="text" id="wbsPlanMngNm3" name="wbsPlanMngNm3"onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId3.value = ''};" readonly  msg="레벨3담당자">                                    
                                </div>
                            </td>
                            <th>시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt3" name="wbsPlansDt3" autocomplete="off" date>
                                </div>
                            </td>
                            <th>종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt3" name="wbsPlaneDt3" autocomplete="off" date>
                                </div>
                            </td>
                        </tr>
                         <tr>
                            <th>주요내용</th>
                            <td colspan=3>
                                   <input type="text" id="wbsPlanCnts" name="wbsPlanCnts"  required msg="주요내용">
                            </td>
                            <th>비고</th>
                            <td colspan=3>
                                    <input type="text" id="wbsPlanRmk" name="wbsPlanRmk">
                            </td>
                        </tr>
                         <tr  id = "level1Area"  style="display:none">
                            <th>설계난이도</th>
                            <td>
                              <select id="dsgnDifCodeId" name="dsgnDifCodeId" data-kind="DSGNDIF"> 
                              <option value="">선택</option>
                              </select>
                            </td>
                            <th>설계계획공수</th>
                            <td>
                                <input type="text" id="dsgnPlanHour" name="dsgnPlanHour" msg="설계계획공수">
                            </td>
                            <th>생산난이도</th>
                            <td>
                              <select id="prdctnDifCodeId" name="prdctnDifCodeId" data-kind="PRDCTNDIF">
                              <option value="">선택</option>
                              </select>
                            </td>
                            <th>생산계획공수</th>
                            <td>
                               <input type="text" id="prdctnPlanHour" name="prdctnPlanHour" msg="생산계획공수">  
                            </td>
                         </tr>

                         <tr>
                            <th>외주여부</th>
                            <td>
                                <input type=radio id="wbsPlanOsYn_Y" name="wbsPlanOsYn_Y" value="Y">Y &ensp; &ensp; &ensp; &ensp; 
                                <input type=radio id="wbsPlanOsYn_N" name="wbsPlanOsYn_N" value="N" checked>N <br>
                            </td>
                            <th>계획상태</th>
                            <td>
                                <select id="wbsPlanStsCodeId" name="wbsPlanStsCodeId" required data-kind="WBSPLANSTS">
                                    <option value="">선택</option>
                                </select>
                            </td>
                            <th>이슈번호</th>
                            <td>
                                  <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="issNo" name="issNo"  data-search="issNo"  readonly >
                                </div>
                            </td>
                            <th></th>
                            <td></td>
                         </tr>
                    </tbody>
                    
                    <thead>
                        <tr>
                           <td colspan="9" style="height:30px;text-align: left;">이슈정보</td>                                                
                        </tr>
                    </thead>
                    <tbody>
                            <tr>
                                <th class="hit">이슈상태</th>
                                <td><select id="issSts" name="issSts" required data-kind="ISSSTS" msg="이슈상태">
                                        <option value="">선택</option>
                                    </select>
                                </td>
                                <th class="hit">유형</th>
                                <td>
                                    <select id="issDiv" name="issDiv" required data-kind="ISSDIV" onchange="selectCodeList1(this,0);" msg="이슈유형">
                                        <option value="">선택</option>
                                    </select>
                                </td>
                                <th class="hit">세부유형</th>
                                <td>
                                    <select id="issDivDtl" name="issDivDtl" required msg="세부유형">
                                        <option value="">선택</option>
                                    </select>
                                </td>
                                <th class="hit">등급</th>
                                <td> 
                                    <select id="issGrd" name="issGrd" required data-kind="ISSGRD" msg="이슈등급">
                                        <option value="">선택</option>
                                    </select>
                                </td>
                             </tr>
                             <tr>
                                <th>조치필요여부</th>
                                <td> 
                                     <select id="actYn" name="actYn" required onchange="displayArea(1);" msg="조치필요여부">
                                        <option value="N">N</option>
                                        <option value="Y">Y</option>
                                    </select>
                                </td>
                                <th class="hit">이슈내용</th>
                                <td colspan="5">
                                    <input type="text" id="issCnts" name="issCnts" required msg="이슈내용">  
                                </td>                            
                             </tr> 
                             <tr>
                                <th class="hit">원인</th>
                                <td colspan="7">
                                    <input type="text" id="causeCnts" name="causeCnts" required msg="원인">  
                                </td>                            
                             </tr> 
                             
                             
                             
                             <tr id = "actArea1"  style="display:none">
                                <th class="hit">조치자</th>
                                <td>
                                    <div class="search_form">
                                    <input type="hidden" id="actId" name="actId">
                                    <input type="text" id="actNm" name="actNm"onkeyUp="if(window.event.keyCode == 8){actId.value = ''};" readonly required1 msg="조치자">
                                    <a onclick="openUserSearch(1);">
                                        <i class="i_search_w"></i>
                                    </a>
                                    </div>
                                </td>
                                <th class="hit">시작일자</th>
                                <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="actsDt" name="actsDt" autocomplete="off" date required1 msg="시작일자">
                                </div>
                                </td>
                                <th class="hit">종료일자</th>
                                <td>
                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="acteDt" name="acteDt" autocomplete="off" date required1 msg="종료일자">
                                </td>
                                
                             </tr>
                             <tr  id = "actArea2"  style="display:none">
                                <th class="hit">확인필요여부</th>
                                <td>
                                    <select id="cfYn" name="cfYn" onchange="displayArea(2);" required1 msg="확인필요여부">
                                        <option value="N">N</option>
                                        <option value="Y">Y</option>
                                    </select>
                                </td>
                                <th>투입시간</th>
                                <td> 
                                <input type="text"  id="actMh" name="actMh" msg="투입시간">
                                </td>
                                <th>투입비용</th>
                                <td> 
                                    <input type="text"  id="actAmt" name="actAmt" msg="투입비용">
                                </td>
                                                         
                             </tr> 
                             <tr  id = "actArea3"  style="display:none">
                                <th>조치내용</th>
                                <td colspan="7">
                                <input type="text" id="actCnts" name="actCnts" msg="조치내용"> 
                                </td>
                             </tr> 
                             
                             
                              <tr id = "cfArea1"  style="display:none">
                                <th class="hit">확인자</th>
                                <td>
                                    <div class="search_form">
                                    <input type="hidden" id="cfId" name="cfId">
                                    <input type="text" id="cfNm" name="cfNm"onkeyUp="if(window.event.keyCode == 8){actId.value = ''};" readonly required2  msg="확인자">
                                    <a onclick="openUserSearch(2);">
                                        <i class="i_search_w"></i>
                                    </a>
                                    </div>
                                </td>
                                <th class="hit">확인유형</th>
                                <td>
                                    <select id="cfDiv" name="cfDiv"  data-kind="ISSDIV" onchange="selectCodeList1(this,1);" msg="확인유형" required2>
                                        <option value="">선택</option>
                                    </select>
                                </td>
                                <th class="hit">확인세부유형</th>
                                <td>
                                    <select id="cfDivDtl" name="cfDivDtl" msg="확인세부유형" required2>
                                        <option value="">선택</option>
                                    </select>
                                </td>
                                <th class="hit">확인등급</th>
                                <td> 
                                    <select id="cfGrd" name="cfGrd"  data-kind="ISSGRD" msg="확인등급" required2>
                                        <option value="">선택</option>
                                    </select>
                                </td>
                             </tr> 
                             <tr  id = "cfArea2"  style="display:none">
                                <th class="hit">확인내용</th>
                                <td colspan="7">
                                    <input type="text" id="cfCnts" name="cfCnts" msg="확인내용" required2>  
                                </td>                            
                             </tr>                
                       </tbody> 
                </table>    
            </form>
        </div>
    </div>
    <div class="popup_table">               
        <table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※공유 대상자</td>
                <td style="text-align:right;">
                    <button type="button" class="btn btn-primary btn-sm"  id="shareBtn" onclick="opendModalSharngListList();">공유라인</button>
                    <div id="addrow" class="add_btn_small pdl10">
                        <a onclick="" data-grid-control="row-add" style="height: 30px; line-height: 28px;">+</a>
                        <a onclick="" data-grid-control="row-remove" style="height: 30px; line-height: 28px;">-</a>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    <div class="contents">
         <!-- 공유대상자 리스트 -->
            <div data-ax5grid="second-grid" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
            </div> 
         <!-- 공통 파일 영역 -->
         <div id="fileList_area"></div>   
    </div>
    <br>
    <div class="col-xs-2" style="height: 70px;">
    </div>

    <!-- 하단 버튼 -->
    <div class ="popup_bottom_btn">
        <button type="button" id="actionBtn" >등록</button>
        <button type="button" class="close_btn"
            onclick="modalStack.close();">닫기</button>
    </div>
    
<script type="text/javascript">
    var actionType = null;
    var wbsPlanFileTrgtKey = null;
    var fileTrgtKey = null;
    var coCd = null;
    var lvl = null;
    var idx = null;
    var salesCd = null;
    var issueIdx = null;
    //var ordrsNo = null;
    var codeKind = null;
    var codeId = null;
    
    var idx1 = null;
    var idx2 = null;
    var idx3 = null;
    
    
    
    var sGridView = {
            initView: function(){
                this.target = new ax5.ui.grid();
                this.target.setConfig({
                    showRowSelector: true,
                    multipleSelect: true,
                    sortable: true,
                    target: $('[data-ax5grid="second-grid"]'),
                    header: {
                      align: "center",
                      selector: false
                    },
                    body: {
                        onClick: function () {
                            this.self.select(this.dindex); 
                        },
                        onDBLClick: function () {
                            this.self.clearSelect();
                            this.self.select(this.dindex);
                        },
                   },
                   columns: [
                         {key: "rn",      label: "No.",      align: "center",   width: 60},
                         {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 130},
                         {key: "issueNo",      label: "이슈번호",      hidden: true},
                         {key: "issueCodeId",      label: "이슈항목코드",      hidden: true},
                         {key: "issueCodeNm",      label: "이슈항목",      hidden: true},
                         {key: "todoCfDt",      label: "확인일자",      align: "center",   width: 130},
                         {key: "todoCfOpn",      label: "확인의견",      align: "left",   width: 200},
                         {key: "issueCoCd",      label: "회사",          hidden: true},
                         {key: "issueCoNm",      label: "회사명",      align: "center",   width: 130},
                         {key: "wbsSharngUserId",      label: "ID",      align: "center",   width: 130},
                         {key: "empNo",      label: "사원번호",      align: "center",   width: 130},
                         {key: "name",      label: "성명",      align: "center",   width: 130},
                         {key: "telNo",      label: "H.P",      align: "center",   width: 130},
                         {key: "email",      label: "E-Mail",      align: "center",   width: 200}
                         ]
                });   
                return this;
              },
              setData: function() {
                  var targetObj = this.target;
                  /* var idx = null;
                  if (lvl == 1) { 
                      idx = idx1;
                  }
                  else if (lvl == 2) { 
                      idx = idx2;
                  }
                  else if (lvl == 3) { 
                      idx = idx3;
                  }
                  var row = gridView.target.getList()[idx];
                  var paramObj = {};
                  if (row != undefined) {
                      paramObj["coCd"] = coCd;
                      paramObj["salesCd"] = salesCd;
                      paramObj["codeKind"] = codeKind;
                      paramObj["codeId"] = codeId;
                  } */
                  
                  var paramObj = {"coCd":coCd,
                		  "salesCd":salesCd,
                		  "codeKind":codeKind,
                		  "codeId":codeId,
                  };
                  postAjax("/user/wb/wb03/selectIssueSharngList", paramObj, null, function(data){
                     var list = data.resultList;
                      targetObj.setData({
                           list : list,
                           page : {
                               totalElements : list.length
                           }
                       });
                      
                  }); 
             } 
         }
    
    $(document).ready(function() {
    	actionType = modalStack.last().paramObj.actionType;
        wbsPlanFileTrgtKey = modalStack.last().paramObj.wbsPlanFileTrgtKey;
        $("#popForm #wbsPlanFileTrgtKey").val(wbsPlanFileTrgtKey);
        fileTrgtKey = modalStack.last().paramObj.fileTrgtKey;
        $("#popForm #fileTrgtKey").val(fileTrgtKey);
        coCd = modalStack.last().paramObj.coCd;
        lvl = modalStack.last().paramObj.lvl;
        idx = modalStack.last().paramObj.idx;
        salesCd = modalStack.last().paramObj.salesCd;
        //ordrsNo = modalStack.last().paramObj.ordrsNo;
        codeKind = modalStack.last().paramObj.codeKind;
        codeId = modalStack.last().paramObj.codeId;
        issueIdx = modalStack.last().paramObj.issueIdx;
                
        if (lvl == 1) {
            $("#popForm #level1Area").show();
            $("#popForm #level2Area").hide();
            $("#popForm #level3Area").hide();
        }
        else if (lvl == 2) {
            $("#popForm #level1Area").show();
            $("#popForm #level2Area").show();
            $("#popForm #level3Area").hide();
        }
        else if (lvl == 3) {
            $("#popForm #level1Area").show();
            $("#popForm #level2Area").show();
            $("#popForm #level3Area").show();
        }
        
        setCommonSelect($(".popup_area select[data-kind]"));
        setByCoCd(coCd);
        $("#popForm #userId").val(jwt.userId);
        
        
        if (actionType == "C" || actionType == "U") {                  
            if (lvl == 1) {
                idx1 = idx;
            }
            else if (lvl == 2) {
                idx2 = idx;
                
                //1레벨 조회
                var list1 = gridView.target.getList();
                $.each(list1, function(idx, obj){
                    var row1 = gridView.target.getList()[obj.__index];
                    if (row1.coCd == coCd && row1.salesCd == salesCd && row1.codeId == codeKind) {
                        idx1 = obj.__index;                         
                    }
                });
            }
            else if (lvl == 3) {
                idx3 = idx;
                //2레벨 조회
                var list1 = gridView.target.getList();
                $.each(list1, function(idx, obj){
                    var row1 = gridView.target.getList()[obj.__index];
                    if (row1.coCd == coCd && row1.salesCd == salesCd && row1.codeId == codeKind) {
                        idx2 = obj.__index;                         
                    }
                });
    
                //1레벨 조회
                var row2 = gridView.target.getList()[idx2];                    
                var list2 = gridView.target.getList();
                $.each(list2, function(idx, obj){
                    var row3 = gridView.target.getList()[obj.__index];
                    if (row3.coCd == row2.coCd && row3.salesCd == row2.salesCd && row3.codeId == row2.codeKind) {
                        idx1 = obj.__index;                         
                    }
                });
            }   
        }
        else if (actionType == "T") {        	
            var list1 = gridView.target.getList();
            $.each(list1, function(idx, obj){
            	if (obj.coCd == coCd && obj.salesCd == salesCd && obj.todoFileTrgtKey == fileTrgtKey) {
                    idx1 = obj.__index;    
                    idx2 = obj.__index;
                    idx3 = obj.__index;
                    return false;
                }
            });
        }
        
        if (actionType == "C" || actionType == "U"){
        	if (lvl == 1) {
                var row = gridView.target.getList()[idx1];
                if (row != undefined) {
                    $("#popForm #wbsLevel1").val(row.codeId);
                    $('#popForm #wbsLevel1 option[value!="' + row.codeId + '"]').remove(); 
                    $("#popForm #wbsPlanCodeKind").val("WBSDIV");
                    $("#popForm #wbsPlanCodeId").val(row.codeId);
                    $("#popForm #userId").val(jwt.userId);
                    rowFill(row);
                }
            }
            else if (lvl == 2) {
    
                $("#popForm #wbsPlanMngId2").val(jwt.userId);
                $("#popForm #wbsPlanMngNm2").val(jwt.userNm);
                
                
                /////////////////////////////////////////////////////////////////////
                var row1 = gridView.target.getList()[idx1];
                $("#popForm #wbsLevel1").val(row1.codeId);
                $('#popForm #wbsLevel1 option[value!="' + row1.codeId + '"]').remove();
                
                $("#popForm #wbsPlanMngId1").val(row1.wbsPlanMngId);
                $("#popForm #wbsPlanMngNm1").val(row1.wbsPlanMngNm);
                $("#popForm #wbsPlansDt1").val(row1.wbsPlansDt);
                $("#popForm #wbsPlaneDt1").val(row1.wbsPlaneDt);        
                /////////////////////////////////////////////////////////////////////
                var row2 = gridView.target.getList()[idx2];
                if (row2 != undefined) {
                    selectCodeList("#wbsLevel1",0);
                    $("#popForm #wbsLevel2").val(row2.codeId);  
                    $('#popForm #wbsLevel2 option[value!="' + row2.codeId + '"]').remove();
                    $("#popForm #wbsPlanCodeKind").val(row1.codeId);
                    $("#popForm #wbsPlanCodeId").val(row2.codeId);
                    rowFill(row2);
                }
                /////////////////////////////////////////////////////////////////////
                              
            }
            else if (lvl == 3) {
    
                $("#popForm #wbsPlanMngId3").val(jwt.userId);
                $("#popForm #wbsPlanMngNm3").val(jwt.userNm);
                
                /////////////////////////////////////////////////////////////////////
                var row1 = gridView.target.getList()[idx1];
                $("#popForm #wbsLevel1").val(row1.codeId);
                $('#popForm #wbsLevel1 option[value!="' + row1.codeId + '"]').remove();
               
                $("#popForm #wbsPlanMngId1").val(row1.wbsPlanMngId);
                $("#popForm #wbsPlanMngNm1").val(row1.wbsPlanMngNm);
                $("#popForm #wbsPlansDt1").val(row1.wbsPlansDt);
                $("#popForm #wbsPlaneDt1").val(row1.wbsPlaneDt);    
                /////////////////////////////////////////////////////////////////////
    
                var row2 = gridView.target.getList()[idx2];
                selectCodeList("#wbsLevel1",0);
                $("#popForm #wbsLevel2").val(row2.codeId);  
                $('#popForm #wbsLevel2 option[value!="' + row2.codeId + '"]').remove();
                
                $("#popForm #wbsPlanMngId2").val(row2.wbsPlanMngId);
                $("#popForm #wbsPlanMngNm2").val(row2.wbsPlanMngNm);
                $("#popForm #wbsPlansDt2").val(row2.wbsPlansDt);
                $("#popForm #wbsPlaneDt2").val(row2.wbsPlaneDt); 
                
                /////////////////////////////////////////////////////////////////////
                
                var row3 = gridView.target.getList()[idx3];
                if (row3 != undefined) {
                    selectCodeList("#wbsLevel2",1);                
                    $("#popForm #wbsLevel3").val(row3.codeId);  
                    $('#popForm #wbsLevel3 option[value!="' + row3.codeId + '"]').remove();
                    $("#popForm #wbsPlanCodeKind").val(row2.codeId);
                    $("#popForm #wbsPlanCodeId").val(row3.codeId);
                    rowFill(row3);
                }
            }
        }
        else if (actionType == "T" || actionType == "S"){
        	var row = gridView.target.getList()[idx1];
        	if (lvl == 1) {
                if (row != undefined) {
                	$("#popForm #wbsLevel1").val(row.todoCodeId01);
                    $('#popForm #wbsLevel1 option[value!="' + row.todoCodeId01 + '"]').remove();
                    $("#popForm #wbsPlanMngId1").val(row.wbsPlanMngId01);
                    $("#popForm #wbsPlanMngNm1").val(row.wbsPlanMngNm01);
                    $("#popForm #wbsPlansDt1").val(row.wbsPlansDt01);
                    $("#popForm #wbsPlaneDt1").val(row.wbsPlaneDt01);
                    rowFill(row);
                }
            }
            else if (lvl == 2) {
            	$("#popForm #wbsLevel1").val(row.todoCodeId01);
                $('#popForm #wbsLevel1 option[value!="' + row.todoCodeId01 + '"]').remove();
                selectCodeList("#wbsLevel1",0);
                $("#popForm #wbsLevel2").val(row.row.todoCodeId01);  
                $('#popForm #wbsLevel2 option[value!="' + row.todoCodeId02 + '"]').remove();
                $("#popForm #wbsPlanMngId1").val(row.wbsPlanMngId01);
                $("#popForm #wbsPlanMngNm1").val(row.wbsPlanMngNm01);
                $("#popForm #wbsPlansDt1").val(row.wbsPlansDt01);
                $("#popForm #wbsPlaneDt1").val(row.wbsPlaneDt01);
                $("#popForm #wbsPlanMngId2").val(row.wbsPlanMngId02);
                $("#popForm #wbsPlanMngNm2").val(row.wbsPlanMngNm02);
                $("#popForm #wbsPlansDt2").val(row.wbsPlansDt02);
                $("#popForm #wbsPlaneDt2").val(row.wbsPlaneDt02);
                rowFill(row);                                
            }
            else if (lvl == 3) {
            	$("#popForm #wbsLevel1").val(row.todoCodeId01);
                $('#popForm #wbsLevel1 option[value!="' + row.todoCodeId01 + '"]').remove();
                selectCodeList("#wbsLevel1",0);
                $("#popForm #wbsLevel2").val(row.todoCodeId01);  
                $('#popForm #wbsLevel2 option[value!="' + row.todoCodeId02 + '"]').remove();
                selectCodeList("#wbsLevel2",1);                
                $("#popForm #wbsLevel3").val(row.todoCodeId03);  
                $('#popForm #wbsLevel3 option[value!="' + row.todoCodeId03 + '"]').remove();
                
                $("#popForm #wbsPlanMngId1").val(row.wbsPlanMngId01);
                $("#popForm #wbsPlanMngNm1").val(row.wbsPlanMngNm01);
                $("#popForm #wbsPlansDt1").val(row.wbsPlansDt01);
                $("#popForm #wbsPlaneDt1").val(row.wbsPlaneDt01);
                $("#popForm #wbsPlanMngId2").val(row.wbsPlanMngId02);
                $("#popForm #wbsPlanMngNm2").val(row.wbsPlanMngNm02);
                $("#popForm #wbsPlansDt2").val(row.wbsPlansDt02);
                $("#popForm #wbsPlaneDt2").val(row.wbsPlaneDt02);
                $("#popForm #wbsPlanMngId3").val(row.wbsPlanMngId03);
                $("#popForm #wbsPlanMngNm3").val(row.wbsPlanMngNm03);
                $("#popForm #wbsPlansDt3").val(row.wbsPlansDt03);
                $("#popForm #wbsPlaneDt3").val(row.wbsPlaneDt03);
                rowFill(row);  
            }
        } 
        else if (actionType == "G"){
        	$('.tit').text('WBS 이슈 보기')
            actionBtn.style.display = "none";
             
            
        	var planData = {
                    "fileTrgtKey" : fileTrgtKey,
                    "salesCd": salesCd,
                    "coCd" : coCd,
                    "lvl" : lvl,
                    "codeId" : codeId
                }; 
             postAjaxSync("/user/wb/wb04/selectGanttInfo", planData, null, function(data){
                 var row = data.fileList[0];
                 $.each(row, function (key, val) {
                     if (key.startsWith("iss") || key.startsWith("cause") || key.startsWith("act") || key.startsWith("cf")) {
                         $("#popForm #" + key).val(val);
                         if (key == "actYn" && val == "Y") {
                             displayArea(1);                     
                         }
                         else if (key == "cfYn" && val == "Y") {
                             displayArea(2);
                             
                         }
                         else if (key == "issDiv") {
                             selectCodeList1('#issDiv',0);
                         }
                         else if (key == "cfDiv") {
                             selectCodeList1('#cfDiv',1);
                         }
                     }
                 });  
	             if (lvl == 1) {
	                if (row != undefined) {
	                    $("#popForm #wbsLevel1").val(row.codeId01);
	                    $('#popForm #wbsLevel1 option[value!="' + row.codeId01 + '"]').remove();
	                    $("#popForm #wbsPlanMngId1").val(row.wbsPlanMngId01);
	                    $("#popForm #wbsPlanMngNm1").val(row.wbsPlanMngNm01);
	                    $("#popForm #wbsPlansDt1").val(row.wbsPlansDt01);
	                    $("#popForm #wbsPlaneDt1").val(row.wbsPlaneDt01);
	                    rowFill(row);
	                }
	             }
	             else if (lvl == 2) {
	                $("#popForm #wbsLevel1").val(row.codeId01);
	                $('#popForm #wbsLevel1 option[value!="' + row.codeId01 + '"]').remove();
	                selectCodeList("#wbsLevel1",0);
	                $("#popForm #wbsLevel2").val(row.codeId02);  
	                $('#popForm #wbsLevel2 option[value!="' + row.codeId02 + '"]').remove();
	                $("#popForm #wbsPlanMngId1").val(row.wbsPlanMngId01);
	                $("#popForm #wbsPlanMngNm1").val(row.wbsPlanMngNm01);
	                $("#popForm #wbsPlansDt1").val(row.wbsPlansDt01);
	                $("#popForm #wbsPlaneDt1").val(row.wbsPlaneDt01);
	                $("#popForm #wbsPlanMngId2").val(row.wbsPlanMngId02);
	                $("#popForm #wbsPlanMngNm2").val(row.wbsPlanMngNm02);
	                $("#popForm #wbsPlansDt2").val(row.wbsPlansDt02);
	                $("#popForm #wbsPlaneDt2").val(row.wbsPlaneDt02);
	                rowFill(row);                                
	             }
	             else if (lvl == 3) {
	                $("#popForm #wbsLevel1").val(row.codeId01);
	                $('#popForm #wbsLevel1 option[value!="' + row.codeId01 + '"]').remove();
	                selectCodeList("#wbsLevel1",0);
	                $("#popForm #wbsLevel2").val(row.codeId02);  
	                $('#popForm #wbsLevel2 option[value!="' + row.codeId02 + '"]').remove();
	                selectCodeList("#wbsLevel2",1);                
	                $("#popForm #wbsLevel3").val(row.codeId03);  
	                $('#popForm #wbsLevel3 option[value!="' + row.codeId03 + '"]').remove();
	                
	                $("#popForm #wbsPlanMngId1").val(row.wbsPlanMngId01);
	                $("#popForm #wbsPlanMngNm1").val(row.wbsPlanMngNm01);
	                $("#popForm #wbsPlansDt1").val(row.wbsPlansDt01);
	                $("#popForm #wbsPlaneDt1").val(row.wbsPlaneDt01);
	                $("#popForm #wbsPlanMngId2").val(row.wbsPlanMngId02);
	                $("#popForm #wbsPlanMngNm2").val(row.wbsPlanMngNm02);
	                $("#popForm #wbsPlansDt2").val(row.wbsPlansDt02);
	                $("#popForm #wbsPlaneDt2").val(row.wbsPlaneDt02);
	                $("#popForm #wbsPlanMngId3").val(row.wbsPlanMngId03);
	                $("#popForm #wbsPlanMngNm3").val(row.wbsPlanMngNm03);
	                $("#popForm #wbsPlansDt3").val(row.wbsPlansDt03);
	                $("#popForm #wbsPlaneDt3").val(row.wbsPlaneDt03);
	                rowFill(row);  
	             }
             }); 
        } 
        
        $("#popForm #actsDt").datepicker({
            format : "yyyy-mm-dd",
            language : "ko",
            autoclose : true
        }).datepicker("setDate", new Date())
        $("#popForm #acteDt").datepicker({
            format : "yyyy-mm-dd",
            language : "ko",
            autoclose : true
        }).datepicker("setDate", new Date()) 
        
        if (actionType == "C") {
        	$('.tit').text('WBS 이슈 등록')
            $('#actionBtn').text("등록");
            $('#actionBtn').on("click", function() {
            	insertWbsPlanIssue();
            });
            var strYear = new Date().toISOString().substring(2, 4);
            var planData = {
                    "coCd" : coCd,
                    "year" : "ISS" + strYear
                }; 
             postAjaxSync("/user/wb/wb03/selectMaxWbsIssueNo", planData, null, function(data){
            	 //alert(data.result[0].issNo);
                 $("#popForm #issNo").val(data.result[0].issNo); 
             }); 
             

             $("#popForm #actMh").val("0");
             $("#popForm #actAmt").val("0");
             
             
             // 조치 및 확인 여부를 기존 선택  -> 신규 등록 시 모두 보여줌
             //$("#popForm #actYn").val("Y");
             //displayArea(1);
             //$("#popForm #cfYn").val("Y");             
             //displayArea(2);
             

        }
        else if (actionType == "U") {        	
            $('.tit').text('WBS 이슈 수정')
            $('#actionBtn').text("수정");
            $('#actionBtn').on("click", function() {
            	updateWbsPlanIssue();
            });
            var row = gridView.target.getList()[issueIdx];
            $.each(row, function (key, val) {
                if (key.startsWith("iss") || key.startsWith("cause") || key.startsWith("act") || key.startsWith("cf")) {
                	$("#popForm #" + key).val(val);
                	if (key == "actYn" && val == "Y") {
                		displayArea(1);                		
                	}
                	else if (key == "cfYn" && val == "Y") {
                		displayArea(2);
                		
                	}
                	else if (key == "issDiv") {
                		selectCodeList1('#issDiv',0);
                    }
                	else if (key == "cfDiv") {
                        selectCodeList1('#cfDiv',1);
                    }
                }
            });         
        }
        
        else if (actionType == "T") {           
            $('.tit').text('WBS 이슈 보기')
            actionBtn.style.display = "none";
            var row = gridView.target.getList()[idx];
            $.each(row, function (key, val) {
                if (key.startsWith("iss") || key.startsWith("cause") || key.startsWith("act") || key.startsWith("cf")) {
                    $("#popForm #" + key).val(val);
                    if (key == "actYn" && val == "Y") {
                        displayArea(1);                     
                    }
                    else if (key == "cfYn" && val == "Y") {
                        displayArea(2);
                        
                    }
                    else if (key == "issDiv") {
                        selectCodeList1('#issDiv',0);
                    }
                    else if (key == "cfDiv") {
                        selectCodeList1('#cfDiv',1);
                    }
                }
            });         
        }

        sGridView.initView().setData();

        //---------------------------------------------------------------  
        
        //첨부 화일 처리 시작 
        //---------------------------------------------------------------
        //debugger;
        fileParam = {
                fileTrgtTyp : $("#popForm #pgmId").val(),
                fileTrgtKey     :fileTrgtKey
        }
        treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
        //---------------------------------------------------------------  
        //첨부 화일 처리 끝
        //---------------------------------------------------------------   
        
        authChk();
        
    });
    
    
    function setByCoCd(value) {
        $('#coCd option:not([value="'+value+'"])').remove();
    }
    
    function displayArea(idx) {
    	if (idx == 1)  {
    		if ($("#actYn option:checked").text() == "Y") {
    			$("#popForm #actArea1").show();
                $("#popForm #actArea2").show();
                $("#popForm #actArea3").show();
                $("#popForm #cfYn").val("N");
                $("#popForm #cfArea1").hide();
                $("#popForm #cfArea2").hide();
    		}
    		else {
    			$("#popForm #actArea1").hide();
                $("#popForm #actArea2").hide();
                $("#popForm #actArea3").hide();
                $("#popForm #cfArea1").hide();
                $("#popForm #cfArea2").hide();
                
                $("#popForm #actId").val("");
                $("#popForm #actsDt").val("");
                $("#popForm #acteDt").val("");
                $("#popForm #actMh").val("0");
                $("#popForm #actAmt").val("0");
                $("#popForm #actCnts").val("");
    		}
           
    	}
    	else {
    		if ($("#cfYn option:checked").text() == "Y") {
    			$("#popForm #cfArea1").show();
                $("#popForm #cfArea2").show();
            }
            else {
            	$("#popForm #cfArea1").hide();
                $("#popForm #cfArea2").hide();
                
                $("#popForm #cfId").val("");
                $("#popForm #cfDiv").val("");
                selectCodeList1('#cfDiv',1);
                $("#popForm #cfDtlDiv").val("");
                $("#popForm #cfGrd").val("");
                $("#popForm #cfCnts").val("");
                
            }
    	}
    }
    
    function rowFill(row) {
        $.each(row, function (key, val) {
            if (lvl == 1 && key == "wbsPlanMngId") {
                $("#popForm #wbsPlanMngId1").val(val);
            }
            else if (lvl == 1 && key == "wbsPlanMngNm") {
                $("#popForm #wbsPlanMngNm1").val(val);
            }
            else if (lvl == 1 && key == "wbsPlansDt") {
                $("#popForm #wbsPlansDt1").val(val);
            }  
            else if (lvl == 1 && key == "wbsPlaneDt") {
                $("#popForm #wbsPlaneDt1").val(val);
            }
            else if (lvl == 2 && key == "wbsPlanMngId") {
                $("#popForm #wbsPlanMngId2").val(val);
            }
            else if (lvl == 2 && key == "wbsPlanMngNm") {
                $("#popForm #wbsPlanMngNm2").val(val);
            }
            else if (lvl == 2 && key == "wbsPlansDt") {
                $("#popForm #wbsPlansDt2").val(val);
            }
            else if (lvl == 2 && key == "wbsPlaneDt") {
                $("#popForm #wbsPlaneDt2").val(val);
            }
            else if (lvl == 3 && key == "wbsPlanMngId") {
                $("#popForm #wbsPlanMngId3").val(val);
            }
            else if (lvl == 3 && key == "wbsPlanMngNm") {
                $("#popForm #wbsPlanMngNm3").val(val);
            }
            else if (lvl == 3 && key == "wbsPlansDt") {
                $("#popForm #wbsPlansDt3").val(val);
            }
            else if (lvl == 3 && key == "wbsPlaneDt") {
                $("#popForm #wbsPlaneDt3").val(val);
            }
            else if (key == "wbsPlanOsYn" && val == "Y"){ 
                $("#wbsPlanOsYn_Y").prop('checked',true);
                $("#wbsPlanOsYn_N").prop('checked',false);
            }
            else if (key == "wbsPlanOsYn" && val == "N"){  
                $("#wbsPlanOsYn_Y").prop('checked',false);
                $("#wbsPlanOsYn_N").prop('checked',true);
            }
            else if (key == "wbsPlanStsCodeId") {
                 $('#wbsPlanStsCodeId option[value!="' + val + '"]').remove();
            }
            else if (key == "ordrsClntCd") {
                $("#popForm #clntCd").val(val);
            }
            else if (key == "ordrsClntNm") {
                $("#popForm #clntNm").val(val);
            }
            else {
                $("#popForm #" + key).val(val);
            }
        });         
    }
    
    
    //작성자, 담당자  검색
    function openUserSearch(type) {
        var paramObj = {};
        paramObj["coCd"] = $('#coCd').val();
        if (type == 1) {
            paramObj["userId"] = $('#popForm #actId').val();
        }
        else if (type == 2) {
            paramObj["userId"] = $('#popForm #cfId').val();
        }
        paramObj["useYn"] =  "Y";
        openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "작성자 검색", paramObj, function (tree){
            var checkedId = tree.get_checked()[0];
            var checkedNode = tree.get_node(checkedId);
            if (type == 1) {
                $('#popForm #actId').val(checkedNode.id);
                $('#popForm #actNm').val(checkedNode.text);
            }
            else if (type == 2) {
                $('#popForm #cfId').val(checkedNode.id);
                $('#popForm #cfNm').val(checkedNode.text);
            }               
        });
    }
    
    function optionGubun() {
        if ($("#wbsLevel1 option:checked").text() == "설계") {
           $("#dsgnDifCodeId").prop('readonly',false);
           $("#dsgnPlanHour").prop('readonly',false);
           $("#prdctnDifCodeId").prop('readonly',true);
           $("#prdctnPlanHour").prop('readonly',true);
       }
       else if ($("#wbsLevel1 option:checked").text() == "생산") {
           $("#dsgnDifCodeId").prop('readonly',true);
           $("#dsgnPlanHour").prop('readonly',true);
           $("#prdctnDifCodeId").prop('readonly',false);
           $("#prdctnPlanHour").prop('readonly',false);
       }
       else {
           $("#dsgnDifCodeId").prop('readonly',true);
           $("#dsgnPlanHour").prop('readonly',true);
           $("#prdctnDifCodeId").prop('readonly',true);
           $("#prdctnPlanHour").prop('readonly',true);
       }
   }
   
   function selectCodeList(obj,idx) { 
        //debugger;
        var codeKind = $(obj).val();
        var target = $(obj).next('select.division');
        if(idx == 0){
            target = $("#wbsLevel2");
            $('#wbsLevel2 option[value!=""]').remove();
            $('#wbsLevel3 option[value!=""]').remove();
        }else{
            target = $("#wbsLevel3");
            $('#wbsLevel3 option[value!=""]').remove();
        }
        var paramObj = {"codeKind": codeKind};
        if (codeKind != '') {
            postAjaxSync("/admin/cm/cm05/selectChildCodeList", paramObj, null, function(data){
                var optionHtml = '';
                var childCodeList = data.childCodeList;
                $.each(childCodeList, function(index, item){
                    //debugger;
                    optionHtml += '<option value='+item.codeId+'>';
                    optionHtml += item.codeNm;
                    optionHtml += '</option>';
                    console.log(optionHtml);
                });
                $(target).append(optionHtml);
            });
        }
        
    }
    
   function selectCodeList1(obj,idx) { 
       var codeKind = $(obj).val();
       //var target = $(obj).next('selector');
       var paramObj = {"codeKind": codeKind};
       if (idx == 0) {
           $('#issDivDtl option[value!=""]').remove();
       }
       else {
           $('#cfDivDtl option[value!=""]').remove();
       }
       if (codeKind != '') {
           postAjaxSync("/admin/cm/cm05/selectChildCodeList", paramObj, null, function(data){
               var optionHtml = '';
               var childCodeList = data.childCodeList;
               $.each(childCodeList, function(index, item){
                   optionHtml += '<option value='+item.codeId+'>';
                   optionHtml += item.codeNm;
                   optionHtml += '</option>';
                   console.log(optionHtml);
               });
               if (idx == 0) {
            	   $('#issDivDtl option[value!=""]').remove();
            	   $('#issDivDtl').append(optionHtml);
            	   $("#issDivDtl option:eq(1)").prop("selected", true);
               }
               else {
            	   $('#cfDivDtl option[value!=""]').remove();
            	   $('#cfDivDtl').append(optionHtml);
            	   $("#cfDivDtl option:eq(1)").prop("selected", true);
               }
           });
       }
       
   }
   
   function inputValidationChk(inputList) {
	   var isValid = true;
	    $.each(inputList, function(idx, elem){
	        if($.trim(elem.value) == ""){
	            isValid = false;
	            var alertMsg = $(elem).attr("msg") || "필수값";
	            alert(alertMsg + "(을/를) 입력해주세요.");
	            $(elem).focus();
	            return isValid;
	        }
	    });
	    
	    if ($('#popForm #actYn').val() == "Y") {
	    	$.each($('.popup_area [required1]'), function(idx, elem){
	            if($.trim(elem.value) == ""){
	                isValid = false;
	                var alertMsg = $(elem).attr("msg") || "필수값";
	                alert(alertMsg + "(을/를) 입력해주세요.");
	                $(elem).focus();
	                return isValid;
	            }
	        });
	    }
	    if ($('#popForm #cfYn').val() == "Y") {
            $.each($('.popup_area [required2]'), function(idx, elem){
                if($.trim(elem.value) == ""){
                    isValid = false;
                    var alertMsg = $(elem).attr("msg") || "필수값";
                    alert(alertMsg + "(을/를) 입력해주세요.");
                    $(elem).focus();
                    return isValid;
                }
            });
        }
	    return isValid;
	}
   
   function insertWbsPlanIssue() {
	   if (inputValidationChk($('.popup_area [required]'))) {
		   
		   var formData = makeFormData();
		   
           filePostAjax("/user/wb/wb03/insertWbsPlanIssue", formData,             
               function(data) {
                   alert(data.resultMessage);                              
                   if (data.resultCode == 200) { 
                       gridView.setData(0, salesCd);
                       modalStack.close();                                 
                   }
               });
	   }
    }
    
    function updateWbsPlanIssue() {
         if (inputValidationChk($('.popup_area [required]'))) {                        
            var formData = makeFormData();
            filePutAjax("/user/wb/wb03/updateWbsPlanIssue", formData,             
	            function(data) {
	                alert(data.resultMessage);                              
	                if (data.resultCode == 200) {                          
	                	gridView.setData(0, salesCd);
	                    modalStack.close();                                 
	                }
	            });
        } 
    }
    
    function makeFormData() {
    	var formData = new FormData($("#popForm")[0]);
    	formData.append("S_todoDiv1CodeId", "TODODIV10");
        formData.append("S_todoDiv2CodeId", "TODODIV1030");
        formData.append("issueNo", $("#popForm #issNo").val());
        formData.append("creatId", jwt.userId);
        formData.append("creatPgm", $("#popForm #pgmId").val());
        formData.append("actionType", actionType);
        formData.append("lvl", lvl);
        formData.append("idx", idx);
        formData.append("issueIdx", issueIdx);
        formData.append("codeKind", codeKind);
        formData.append("codeId", codeId);
        
        var rowSharngList = sGridView.target.list;
        if(rowSharngList.length > 0) {
            var rowSharngListArr = [];
            $.each(rowSharngList, function(idx, elem){
                var rowSharngListObj = elem;
                rowSharngListObj["coCd"] = $("#coCd").val();
                rowSharngListObj["salesCd"] = $("#salesCd").val();
                rowSharngListObj["issueNo"] = $("#issNo").val();
                rowSharngListObj["wbsPlanCodeKind"] = $("#popForm #wbsPlanCodeKind").val();
                rowSharngListObj["wbsPlanCodeId"] = $("#popForm #wbsPlanCodeId").val();
                rowSharngListObj["todoCfDt"] = elem.todoCfDt;
                rowSharngListObj["todoCfOpn"] = elem.todoCfOpn;
                rowSharngListObj["issueCoCd"] = elem.issueCoCd;
                rowSharngListObj["issueCoNm"] = elem.issueCoNm;
                rowSharngListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
                rowSharngListObj["empNo"] = elem.empNo;
                rowSharngListObj["name"] = elem.name;
                rowSharngListObj["telNo"] = elem.telNo;
                rowSharngListObj["email"] = elem.email;   
                rowSharngListObj["pgPath"] = "/user/wb/wb03/WB0301P01.html";
                rowSharngListArr.push(rowSharngListObj);
            });
            formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));
        }       
        
        //-------itemarr  --첨부화일 처리를 위한 부분 시작
        formData.append("comonCd", treeModule.getFileNodeId()); //첨부화일용
        
        //---------------------------------------------------------------  
        
        //---------------------------------------------------------------  
        var fileUploadArr = [];
        var tempArr = [];
        
        tempArr = treeModule.getFileArr();
        $.each(tempArr, function(idx, obj) {
            if (obj.fileKey == 0) {
                formData.append("files", obj.file);
                obj.file = '';
                fileUploadArr.push(obj);
            }
        });

        formData.append("uploadFileArr", JSON.stringify(fileUploadArr));
        formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
        //---------------------------------------------------------------  
        //--첨부화일 처리를 위한 부분 끝
        //--------------------------------------------------------------- 
        return formData;
    }
    
    
    //공유대상자 팝업
    function opendModalSharngListList() { 
        //debugger;
        var formData = {};
        openSecondModal("/static/html/user/wb/wb02/WB0202P01.html", 1300, 780, "결재선 지정", formData, function (grid){
                var rowList = grid.target.getList("selected");
                if (rowList.length > 0) {
                    var chk = false;
                    $.each(rowList, function(idx, elem){ 
                        if (elem.check == "Y") { 
                            var userId = elem.appId;
                            var rowList1 = sGridView.target.getList();
                            $.each(rowList1, function(idx, elem){
                                 if (elem.wbsSharngUserId == userId) {
                                    chk = true;
                                }
                            });
                        }
                    });
                    if (chk == false) {
                        $.each(rowList, function(idx, elem){
                            if (elem.check == "Y") {
                                    var paramObj = {"coCd" : elem.coCd, "userId" : elem.appId};            
                                    postAjax("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
                                       
                                            sGridView.target.addRow($.extend({}, "last", false));
                                            var row = sGridView.target.getList().length - 1;
                                            sGridView.target.setValue(row, "salesCd", $("#salesCd").val());
                                            sGridView.target.setValue(row, "issueNo", $("#issNo").val());
                                            if (lvl == 1) {
                                               sGridView.target.setValue(row, "issueCodeId", $("#wbsLevel1").val());
                                               sGridView.target.setValue(row, "issueCodeNm", $("#wbsLevel1 option:checked").text());
                                            }
                                            else if (lvl == 2) {
                                               sGridView.target.setValue(row, "issueCodeId", $("#wbsLevel2").val());
                                               sGridView.target.setValue(row, "issueCodeNm", $("#wbsLevel2 option:checked").text());
                                            }
                                            else if (lvl == 3) {
                                               sGridView.target.setValue(row, "issueCodeId", $("#wbsLevel3").val());
                                               sGridView.target.setValue(row, "issueCodeNm", $("#wbsLevel3 option:checked").text());
                                            }
                                            
                                            sGridView.target.setValue(row, "issueCoCd", data.resultList[0].coCd);
                                            sGridView.target.setValue(row, "issueCoNm", data.resultList[0].coCdNm);
                                            sGridView.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
                                            sGridView.target.setValue(row, "empNo", data.resultList[0].empNo);
                                            sGridView.target.setValue(row, "name", data.resultList[0].name);
                                            sGridView.target.setValue(row, "telNo", data.resultList[0].telNo);
                                            sGridView.target.setValue(row, "email", data.resultList[0].email);                                        
                                    });
                              }
                        });
                   }
                   else {
                       alert("중복 공유를 지정할 수 없습니다.");
                       return;
                   }
                }
                
        });
    }
    
    $('[data-grid-control]').click(function () {

         switch (this.getAttribute("data-grid-control")) {    
             case "row-add":
                 var paramObj = {
                         "coCd" : $('#coCd').val(),
                         "userId": '',
                         "useYn": "Y"
                     };
                     openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
                        var checkedId = tree.get_checked()[0];
                        var checkedNode = tree.get_node(checkedId);   
                        
                        var paramObj = {"coCd" : $('#coCd').val(), "userId" : checkedId};
                        
                        postAjax("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
                                var chk = false;
                                var rowList = sGridView.target.getList();
                                $.each(rowList, function(idx, elem){
                                    if (elem.wbsSharngUserId == data.resultList[0].id) {
                                        chk = true;
                                    }
                                });
             
                                if (chk == false) {
                                    sGridView.target.addRow($.extend({}, "last", false));                             
                                    var row = sGridView.target.getList().length - 1;
                                    sGridView.target.setValue(row, "salesCd", $("#salesCd").val());
                                    sGridView.target.setValue(row, "issueNo", $("#issNo").val());
                                    if (lvl == 1) {
                                        sGridView.target.setValue(row, "issueCodeId", $("#wbsLevel1").val());
                                        sGridView.target.setValue(row, "issueCodeNm", $("#wbsLevel1 option:checked").text());
                                    }
                                    else if (lvl == 2) {
                                        sGridView.target.setValue(row, "issueCodeId", $("#wbsLevel2").val());
                                        sGridView.target.setValue(row, "issueCodeNm", $("#wbsLevel2 option:checked").text());
                                    }
                                    else if (lvl == 3) {
                                        sGridView.target.setValue(row, "issueCodeId", $("#wbsLevel3").val());
                                        sGridView.target.setValue(row, "issueCodeNm", $("#wbsLevel3 option:checked").text());
                                    }
                                    sGridView.target.setValue(row, "issueCoCd", data.resultList[0].coCd);
                                    sGridView.target.setValue(row, "issueCoNm", data.resultList[0].coCdNm);
                                    sGridView.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
                                    sGridView.target.setValue(row, "empNo", data.resultList[0].empNo);
                                    sGridView.target.setValue(row, "name", data.resultList[0].name);
                                    sGridView.target.setValue(row, "telNo", data.resultList[0].telNo);
                                    sGridView.target.setValue(row, "email", data.resultList[0].email);   
                                }
                                else {
                                    alert("중복 공유를 지정할 수 없습니다.");
                                    return;
                                }
                        });                 
                     });
               break;
             case "row-remove":
                 var row = sGridView.target.getList("selected");
                 if (row.todoDt == undefined && row.todoDt == null) {
                     sGridView.target.deleteRow("selected");
                 }              
                 else{
                     alert("공유 데이터가 확인되었으며 삭제할 수 없습니다.");
                 }           
               break;
         }
     });

    
    
   
</script>
