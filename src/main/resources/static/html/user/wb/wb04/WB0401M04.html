<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="/static/fontawesome/css/all.css">
<link rel="stylesheet" href="/static/css/ax5/ax5grid.css">
<link rel="stylesheet" href="/static/css/ax5/ax5mask.css">
<link rel="stylesheet" href="/static/css/ax5/ax5modal.css">
<link rel="stylesheet" href="/static/css/ax5/ax5toast.css">
<link rel="stylesheet" href="/static/css/jstree/style.min.css">
<link rel="stylesheet" href="/static/css/gnb.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/sub.css">
<link rel="stylesheet" href="/static/css/common.css">

<script src="/static/js/jquery-latest.min.js"></script>
<script src="/static/js/jquery.serializeObject.js"></script>
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
<script src="/static/js/moment/moment-with-locales.js"></script>
<script src="/static/js/ax5/ax5core.min.js"></script>
<script src="/static/js/ax5/ax5grid.min.js"></script>
<script src="/static/js/ax5/ax5mask.min.js"></script>
<script src="/static/js/ax5/ax5modal.min.js"></script>
<script src="/static/js/ax5/ax5toast.min.js"></script>
<script src="/static/js/jstree/jstree.min.js"></script>
<script type="text/javascript" src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="/static/js/global.js"></script>
<script src="/static/js/fileTree.js"></script>

<script src="dhtmlxgantt.js?v=8.0.3"></script>
    <link rel="stylesheet" href="dhtmlxgantt.css?v=8.0.3">
</head>

<body>
    <div id="head_area"></div>
    <div id="top_area"></div>
    
    <div id="main_area">
        <!-- 페이지 상단 -->
        <div class="contents no_bg">
            <ul class="btn_ul">
                <li class="btn_r">
                     <a onclick="initSearch();"><button class="bg_gray">초기화</button></a>
                     <a onclick="gridView.setData(0);//gantt();"><button class="bg_gray">검 색</button></a>
                </li>
            </ul>
        </div>
    
        <!-- 검색 콘텐츠 -->
        <div class="contents search">
            <div class="">
                <!-- 테이블 인풋 3분할 -->
                <table class="table_input type04">
                
                    <!-- 검색조건 1행 -->
                    <tr>
                        <th class= "hit">회사</th>
                        <td>
                            <select id="coCd_S" name="coCd_S" data-kind="CO" data-search="coCd" required msg="회사">
                              <option value="">전체</option>
                            </select>
                        </td>
                        
                        <th class= "hit">Sales Code</th>
                        <td>
                            <div class="search_form">
                                <input type="text" id="salesCd_S" name="salesCd_S" data-search="salesCd" onkeyup="event.keyCode == 13 ? gridView.setData(0) : ''" >
                                <a onclick="wbsSalesCodeSearch();"><i class="i_search_w"></i></a>
                            </div>
                            <input type="hidden" id="salesNm_S" name="salesNm_S" >
                        </td>
                        
                        <th>&nbsp;</th>
                        <td>&nbsp;</td>
                        
                        <th></th>
                        <td>
                        </td>
                    </tr>                    
                    <!-- 검색조건 END -->
                </table>
                <input type="hidden" id="userId"    name="userId">
                <input type="hidden" id="pgmId"     name="pgmId" value="WB0101M02">
            </div>
        </div>
        <!-- 콘텐츠 -->
        <div class="contents no_bg">
              <div class="contents_tit">
                <div class="add_btn_small pdl10">
                  <!-- <a onclick="insertWbsPlanModal('C', '1', );" style="height: 30px; line-height: 28px;" >1레벨</a>
                  <a onclick="insertWbsPlanModal('C', '2', );" style="height: 30px; line-height: 28px;" >2레벨</a>
                  <a onclick="insertWbsPlanModal('C', '3', );" style="height: 30px; line-height: 28px;" >3레벨</a>
                  <a onclick="deleteWbs();" style="height: 30px; line-height: 28px;" >-</a> 
                  <a onclick="excelDown();" style="height: 30px; line-height: 28px; width: 90px;"><i class="fas fa-file-excel"></i> 엑셀다운로드</a>
                </div>
                <select id="recordCnt" class="prae_select" onchange="gridView.setData(0);">
                  <option value="10">10</option>
                  <option value="20" selected>20</option>
                  <option value="50">50</option>
                  <option value="100">100</option>
                  <option value="9999999">전체</option>
                </select>-->
        </div>

        
        <!-- 콘텐츠 -->
        <div class="contents">
               <table style="border:0px;width: 100%;">
                    <tr>
                        <td style="text-align: LEFT; border-right: 0px;width: 800px;">
                           <div class="ax5_grid" data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 700px; width: 500px" ></div>
                        </td>
                         <td style="text-align: LEFT; border-right: 0px;vertical-align: top;">
                         <!-- <div class="gantt-target" style="height: 900px; width: 100%;overflow-y: scroll;"></div> -->
                          <div id="gantt_here" style="width:100%; height:700px;"></div>
						    <script>
						        gantt.init("gantt_here");
						
						        gantt.parse({
						            data: [
						                { id: 1, text: "Project #2", start_date: "01-04-2023", duration: 18, progress: 0.4, open: true },
						                { id: 2, text: "Task #1", start_date: "02-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 3, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 4, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 5, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 6, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 7, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 8, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 9, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 10, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 11, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 12, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 13, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 14, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 15, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 16, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 17, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 18, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 19, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 20, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 21, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 22, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 23, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 24, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 25, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 26, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 },
						                { id: 27, text: "Task #2", start_date: "11-04-2023", duration: 8, progress: 0.6, parent: 1 }
						                
						                
						            ],
						            links: [
						                {id: 1, source: 1, target: 2, type: "1"},
						                {id: 2, source: 2, target: 3, type: "0"}
						            ]
						        });
						    </script>

                        </td>                
                    </tr>
                </table>      
              </div>
        </div>
    </div>
                    
</body>
</html>

<script type="text/javascript">
    var isFirst = true;
    var tasks = [];
    
    ax5.ui.grid.formatter["chkYn"] = function () {
        var color = this.value == "Y" ? "color-circle_02.png" : "color-circle_01.png";
        return '<img src="/static/img/'+color+'" style="width: 10px;height: 10px;"></img>';
    };

    var gridView = {
            initView : function() {
                this.target = new ax5.ui.grid();
                this.target.setConfig({
                	showLineNumber: true,   
                    showRowSelector: false,
                    multipleSelect: false,
                    sortable: false,
                    target: $('[data-ax5grid="first-grid"]'),
                    header: {
                      align: "center",
                      selector: false
                    },
                   columns: [
                        {key: "rnum",  label: "NO.", hidden:true},
                        {key: "lvl",  label: "lvl", hidden:true},
                        {key: "codeId",  label: "codeId", align: "left", width: 200, hidden:true, treeControl: true},
                        {key: "codeKind",  label: "codeKind", hidden:true},
                        {key: "coCd",  label: "회사코드", hidden:true},
                        {key: "coCdNm",  label: "회사명", width: 80, hidden:true, align: "center"},
                        {key: "salesCd",  label: "SALES CD", width: 100, align: "center"},
                        {key: "codeNm",  label: "WBS 계획구분", align: "left", width: 200,  treeControl: true},

                        {key: "fileTreeKey",        label: "fileTreeKey", hidden:true},
                        {key: "wbsPlanNo",          label: "wbsPlanNo", hidden:true},
                        {key: "wbsPlanStsCodeId",   label: "계획상태코드",   hidden: true},
                        {key: "rsltsFileTrgtKey",   label: "rsltsFileTrgtKey", hidden:true},
                        {key: "rsltsWbsPlanNo",     label: "rsltsWbsPlanNo", hidden:true},
                        {key: "wbsPlanId",          label: "담당자",      hidden:true},
                        {key: "wbsPlanNm",            label: "담당자",      hidden:true},
                        {key: "wbsPlanDt",            label: "담당자",      hidden:true},
                        {key: "wbsPlanStsNm",       label: "계획상태",      hidden:true}, 
                        {key: "wbsPlanMngId",     label: "담당자",      hidden:true}, 
                        {key: "wbsPlanMngNm",     label: "담당자",      align: "center",   width: 80}, 
                        {key: "wbsPlanCnts",      label: "주요내용",      align: "left",   width: 100},
                        {key: "wbsPlanRmk",      label: "비고",      hidden:true},    
                        {label: "계획", columns: [  
                            {key: "wbsPlanChkYn",       label: "계획",      align: "center",   width: 40, formatter: "chkYn"},  
                            {key: "wbsPlansDt",         label: "시작일자",      align: "center",   width: 120, 
                            	editor: {type: "date"
                                    , config: {
                                                content: {
                                                            config: { mode: "day", selectMode: "day" }
                                                          }
                                                }
                                  }
                            },
                            {key: "wbsPlaneDt",         label: "종료일자",      align: "center",   width: 120, 
                            	editor: {type: "date"
                                    , config: {
                                                content: {
                                                            config: { mode: "day", selectMode: "day" }
                                                          }
                                                }
                                  }
                            },
                            {key: "lockYn",             label: "잠금",      align: "center",   width: 40, formatter: "chkYn"},
                            {key: "closeYn",            label: "마감",      align: "center",   width: 40, formatter: "chkYn"},
                            ]},
                        /* {label: "실적", columns: [ 
                            {key: "wbsRsltsChkYn",      label: "실적",      align: "center",   width: 40, formatter: "chkYn"},  
                            {key: "wbsRsltsRate",       label: "진행율",      align: "center",   width: 60},                   
                            {key: "wbsRsltssDt",        label: "시작일자",      align: "center",   width: 80},
                            {key: "wbsRsltseDt",        label: "종료일자",      align: "center",   width: 80},
                            {key: "rsltsLockYn",        label: "잠금",      align: "center",   width: 40, formatter: "chkYn"},
                            {key: "rsltsCloseYn",       label: "마감",      align: "center",   width: 40, formatter: "chkYn"},
                            {key: "wbsPlanMh",          label: "계획공수",      align: "center",   width: 80},                   
                            {key: "wbsRsltsMh",         label: "실적공수",      align: "center",   width: 80},
                            {key: "wbsRsltsCnts",      label: "주요내용",      align: "left",   width: 100},
                            {key: "wbsRsltsRmk",      label: "비고",      align: "left",   width: 100},    
                        ]},
                        {key: "wbsRsltsId",         label: "담당자",      align: "center",   width: 80},                   
                        {key: "wbsRsltsDt",         label: "실적일자",      align: "center",   width: 80},
                        {key: "ordrsClntCd",      label: "고객사",     hidden: true},
                        {key: "ordrsClntNm",      label: "고객사",      align: "center",   width: 130},
                        {key: "clntPjt",      label: "고객사PJT",      align: "center",   width: 100},
                        {key: "ordrsDtlDiv20",      label: "신작구분",      hidden: true},
                        {key: "ordrsDtlDiv20Nm",      label: "신작",      align: "center",   width: 40},
                        {key: "prdtCd",      label: "제품구분",      hidden: true},
                        {key: "prdtCdNm",      label: "제품",      align: "center",   width: 130},
                        {key: "itemDiv",      label: "ITEM구분",      hidden: true},
                        {key: "itemDivNm",      label: "ITEM",      align: "center",   width: 100},  
                        
                        {key: "creatId",      label: "생성자", align: "center",   width: 80},
                        {key: "creatPgm",      label: "생성프로그램ID",      hidden: true},
                        {key: "creatDttm",      label: "생성일시",      align: "center",   width: 80},                   
                        {key: "udtId",      label: "최종변경자",      align: "center",   width: 80},
                        {key: "udtPgm",      label: "최종수정프로그램ID",      hidden: true},
                        {key: "udtDttm",      label: "최종변경일자",      align: "center",   width: 80},
                        
                        {key: "dsgnDifCodeId",      label: "설계난이도코드",      hidden: true},
                        {key: "dsgnDifCodeNm",      label: "설계난이드명",      hidden: true},
                        {key: "dsgnPlanHour",      label: "설계계획공수",      hidden: true},                   
                        {key: "prdctnDifCodeId",      label: "생산난이도코드",      hidden: true},
                        {key: "prdctnDifCodeNm",      label: "생산난이도명",      hidden: true},
                        {key: "prdctnPlanHour",      label: "생산계획공수",      hidden: true},                   
                        {key: "wbsPlanOsYn",      label: "계획외주코드",      hidden: true},
                        {key: "wbsPlanOsNm",      label: "계획외주유무",      hidden: true},   
                        {key: "wbsPlanCodeKind",      label: "WBS 상위코드",    hidden: true},
                        {key: "wbsPlanCodeId",      label: "WBS 코드",      hidden: true},
                        {key: "wbsPlanNo",      label: "WBS NO",      hidden: true},
                        {key: "isLeaf", label: "isLeaf", align: "left", width: 60, hidden: true }, */
                   ],
                    body: {
                        mergeCells : ["coCdNm","salesCd"],
                        columnHeight: 26,
                        onClick: function () {
                             /* var list = gridView.target.getList("selected");
                             $.each(list, function(idx, obj){
                                 gridView.target.select(obj.__index, {selected: false});
                             }); */
                        },
                        
                        onDBLClick: function () {
                            if (beforeIndex) {
                                this.self.select(beforeIndex);
                            }
                            this.self.select(this.dindex);
                            //debugger;
                            if (
                                this.column.key=='wbsPlanChkYn' ||
                                this.column.key=='wbsPlansDt' || 
                                this.column.key=='wbsPlansDt' || 
                                this.column.key=='lockYn' || 
                                this.column.key=='closeYn') {
                                //계획 입력 또는 수정 작업
                                if (this.item.codeId.length > 6) {
                                    var insUpd = this.item.fileTrgtKey ? 'U' : 'C';
                                    insertWbsPlanModal(insUpd, this.item.lvl-1, this.dindex);
                                }
                            } else if (
                                    this.column.key=='wbsRsltsChkYn' ||
                                    this.column.key=='wbsRsltsRate' || 
                                    this.column.key=='wbsRsltssDt' || 
                                    this.column.key=='wbsRsltseDt' || 
                                    this.column.key=='rsltsLockYn' || 
                                    this.column.key=='rsltsCloseYn' || 
                                    this.column.key=='wbsPlanMh' || 
                                    this.column.key=='wbsRsltsMh') {
                                //실적 입력 또는 수정 작업
                                if (this.item.codeId.length > 6) {
                                        var insUpd = this.item.rsltsFileTrgtKey ? 'U' : 'C';
                                        insertWbsRsltsModal(insUpd, this.item.lvl-1, this.dindex);
                                }
                            }
                            
                            beforeIndex = this.dindex;
                        },
                        onDataChanged: function () {
                            if (this.key == 'isChecked') {
                                this.self.updateChildRows(this.dindex, {isChecked: this.item.isChecked});
                            }
                            else if(this.key == '__selected__'){
                                this.self.updateChildRows(this.dindex, {__selected__: this.item.__selected__});
                            }
                        }
                   },
                   page : {
                        navigationItemCount : 10,
                        height : 30,
                        use : true,
                        firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
                        prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
                        nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                        lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
                        onChange : function() {
                            gridView.setData(this.page.selectPage);
                        }
                    },
                    tree: {
                        use: true,
                        indentWidth: 15,
                        arrowWidth: 15,
                        iconWidth: 18,
                        icons: {
                            openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
                            collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                            groupIcon: '<i class="fa fa-folder-open" aria-hidden="true"></i>',
                            collapsedGroupIcon: '<i class="fa fa-folder" aria-hidden="true"></i>',
                            itemIcon: '<i class="fa fa-file" aria-hidden="true"></i>'
                        },
                       columnKeys: {
                           parentKey: "codeKind",
                           selfKey: "codeId",
                       }
                   }
                });
                return this;
            },
            setData : function(_pageNo) {
                if (isFirst) return;
                var targetObj = this.target;
                var paramObj = {"coCd": $('#coCd_S').val(),
                      "salesCd" : $('#salesCd_S').val(),
                      "pageNo" : _pageNo + 1,
                      "recordCnt" : $('#recordCnt').val()};
               // debugger;
                postAjax("/user/wb/wb04/selectWbsPlanTreeList", paramObj, null, function(data){
                    var list = data.fileList;
                        targetObj.setData({
                            list : list,
                            page : {
                                totalElements : list.length,
                            }
                        });
                        
                });
            } 
            
        }
    
        $(document).ready(function() {
            mainDefaultLoad("WBS", "일정조정관리");          // 페이지 타이틀 설정
            setCommonSelect($("#main_area select[data-kind]"));     // 공통코드 set
            $("#coCd_S").val(jwt.coCd);
            isFirst = false;    
            
            gridView.initView().setData(0);
            ////gantt();
            //권한체크
            authChk();
            
        });
        
        // 초기화 버튼용
        function initSearch() {
            $("#coCd_S").val(jwt.coCd);
            // 검색조건 이벤트 bind    
            gridView.initView().setData(0);
        }
     
        //Sales Code (수주마스터, 수주상세테이블 조인) 검색
        function wbsSalesCodeSearch() {
            var paramObj = {
               "coCd" : $('#coCd_S').val(),
               "salesCd": $('#salesCd_S').val()
            };
            openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 430, "SALES CODE 검색", paramObj, function (grid){
                var row = grid.target.getList("selected")[0];
                $('#salesCd_S').val(row.salesCd);
                gridView.setData(0);
                //gantt();
            });
        }
        
        function gantt() {
            var paramObj = {"coCd": $('#coCd_S').val(),"salesCd" : $('#salesCd_S').val()};
            postAjax("/user/wb/wb04/selectGanttList", paramObj, null, function(data){
                var list = data.fileList;
                var i = 0;
                var tasks = [];
                if (list.length > 0) {
                    var i = 0;
                    $.each(list, function(idx, elem){
                        //debugger;
                        if ((elem.lvl-1) == 1) {
                            let task = {
                                start: elem.wbsPlansDt,
                                end: elem.wbsPlaneDt,
                                name: elem.codeNm + "       " + elem.wbsRsltsRate + "%",
                                id: "Task " + idx,
                                progress: parseInt(elem.wbsRsltsRate)
                                
                            }
                            tasks.push(task);
                        }
                        else if ((elem.lvl-1) == 2) {  
                            let task = {
                                start: elem.wbsPlansDt,
                                end: elem.wbsPlaneDt,
                                name: elem.codeNm +  "       " + elem.wbsRsltsRate + "%",
                                id: "Task " + idx,
                                progress: elem.wbsRsltsRate,
                                dependencies: "Task " + (idx-1)
                            }
                            tasks.push(task);
                        }
                        else if ((elem.lvl-1) == 3) {  
                            let task = {
                                start: elem.wbsPlansDt,
                                end: elem.wbsPlaneDt,
                                name: elem.codeNm +  "       " + elem.wbsRsltsRate + "%",
                                id: "Task " + idx,
                                progress: elem.wbsRsltsRate,
                                dependencies: "Task " + (idx-2)
                            }
                            tasks.push(task);
                        }
                        i++;
                    });
                    if (tasks.length > 0) {
                        var gantt_chart = new Gantt(".gantt-target", tasks, {
                             on_click: task => {
                                 console.log(task);
                             },
                             on_date_change: (task, start, end) => {
                                 console.log(task, start, end);
                             },
                             on_progress_change: (task, progress) => {
                                 console.log(task, progress);
                             },
                             on_view_change: (mode) => {
                                 console.log(mode);
                             },
                             view_mode: 'Day',
                             language: 'en'
                          });
                          console.log(gantt_chart);
                    }
                }
            });
        }
</script>
