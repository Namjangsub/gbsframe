


<div id="wbsPopup" class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
        <h4 class="tit">WBS 일정계획 조정</h4>
    </div>
    
    <div class="popup_table">
        <div class="form-group">
            <form id="popForm">
            <input type="hidden" id="fileTrgtKey"    name="fileTrgtKey">
            <input type="hidden" id="userId"        name="userId">
            <input type="hidden" id="pgmId"         name="pgmId"    value="WB0101M02">
                <table class="popup_table">
                    <colgroup>
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="6%">
                    </colgroup>
                    
                    <thead>
                        <tr>
                           <td colspan="9" style="height:30px;text-align: left;">기본정보</td>                                                
                        </tr>
                    </thead>
                    
                    <tbody>
                        <!-- 1행 -->
                        <tr>
                            <th>회사</th>
                            <td>
                                <select id="coCd" name="coCd" data-kind="CO" required msg="회사">
                                </select>
                            </td>
                            <th>관리번호</th>
                            <td>
                                <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsPlanNo" name="wbsPlanNo"  data-search="wbsPlanNo"  readonly >
                                </div>
                            </td>
                            <th>작성일자</th>
                            <td>
                            <input id="wbsPlanDt" id="wbsPlanDt" name="wbsPlanDt" readonly>
                            </td>
                            <th>작성자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanId" name="wbsPlanId" msg="작성자" >
                                    <input type="text" id="wbsPlanNm" name="wbsPlanNm" onkeyUp="if(window.event.keyCode == 8){wbsPlanId.value = ''};" readonly required msg="작성자" >
                                </div>
                            </td>
                            <th rowspan="6" style="vertical-align:top;">
                            </th>
                        </tr>
                                     
                        <!-- 2행 -->
                         <tr>
                            <th>Sales Code</th>
                            <td>
                                <div class="search_form">
                                    <input type="text" id="salesCd" name="salesCd" required readonly msg="salesCd">
                                </div>
                            </td>
                            <th>고객사</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="clntCd" name="clntCd" msg="고객사">
                                    <input type="text" id="ordrsClntNm" data-search="ordrsClntNm" msg="고객사" readonly>
                                   
                                </div>
                            </td>
                            <th>고객사PJT</th>
                            <td>
                                 <input type="text" id="clntPjt" name="clntPjt" msg="고객사PJT" readonly>
                            </td>
                            <th>신작구분</th>
                            <td>
                                 <input type="hidden" id="ordrsDtlDiv20" name="ordrsDtlDiv20" msg="신작구분">
                                 <input type="text" id="ordrsDtlDiv20Nm" name="ordrsDtlDiv20Nm" readonly msg="신작구분">
                            </td>
                        </tr>
                         <tr>
                            <th>설계난이도</th>
                            <td>
                              <select id="dsgnDifCodeId" name="dsgnDifCodeId" data-kind="DSGNDIF" > 
                              <option value="">선택</option>
                              </select>
                            </td>
                            <th>설계계획공수</th>
                            <td>
                                <input type="text" id="dsgnPlanHour" name="dsgnPlanHour" msg="설계계획공수">
                            </td>
                            <th>생산난이도</th>
                            <td>
                              <select id="prdctnDifCodeId" name="prdctnDifCodeId" data-kind="PRDCTNDIF">
                              <option value="">선택</option>
                              </select>
                            </td>
                            <th>생산계획공수</th>
                            <td>
                               <input type="text" id="prdctnPlanHour" name="prdctnPlanHour" msg="생산계획공수">  
                            </td>
                         </tr>
                    </tbody>
                </table>    
            </form>
        </div>
    </div>
    <div class="popup_table">               
        <table style="border:0px;width: 100%;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">
                   <div data-ax5grid="first-grid1" data-ax5grid-config="{}" style="height: 600px; width: 100%"></div>
                </td>
                 <td style="text-align: LEFT; border-right: 0px;">
                  <div id="chart_div" style="height: 600px; width: 100%"></div>
                </td>                
            </tr>
        </table>      
    </div>

    <br>
    <div class="col-xs-2" style="height: 70px;">
    </div>

    <!-- 하단 버튼 -->
    <div class ="popup_bottom_btn">
        <button type="button" id="actionBtn" >등록</button>
        <button type="button" class="close_btn"
            onclick="modalStack.close();">닫기</button>
    </div>
</div>


<script>
google.charts.load('current', {'packages':['gantt']});
google.charts.setOnLoadCallback(drawChart);

function daysToMilliseconds(days) {
  return days * 24 * 60 * 60 * 1000;
}

function drawChart() {

  var data = new google.visualization.DataTable();
  data.addColumn('string', 'Task ID');
  data.addColumn('string', 'Task Name');
  data.addColumn('string', 'Resource');
  data.addColumn('date', 'Start Date');
  data.addColumn('date', 'End Date');
  data.addColumn('number', 'Duration');
  data.addColumn('number', 'Percent Complete');
  data.addColumn('string', 'Dependencies');

  data.addRows([
    ['Research', 'Find sources', null,
     new Date(2015, 0, 1), new Date(2015, 0, 5), null,  100,  null],
    ['Write', 'Write paper', 'write',
     null, new Date(2015, 0, 9), daysToMilliseconds(3), 25, 'Research,Outline'],
    ['Cite', 'Create bibliography', 'write',
     null, new Date(2015, 0, 7), daysToMilliseconds(1), 20, 'Research'],
    ['Complete', 'Hand in paper', 'complete',
     null, new Date(2015, 0, 10), daysToMilliseconds(1), 0, 'Cite,Write'],
    ['Outline', 'Outline paper', 'write',
     null, new Date(2015, 0, 6), daysToMilliseconds(1), 100, 'Research']
  ]);

  var options = {
    height: 275
  };

  var chart = new google.visualization.Gantt(document.getElementById('chart_div'));

  chart.draw(data, options);
}


    var idx = null;
    var gridView1 = {
            initView : function() {
                this.target = new ax5.ui.grid();
                this.target.setConfig({
                    showRowSelector: true,
                    multipleSelect: true,
                    sortable: false,
                    target: $('[data-ax5grid="first-grid1"]'),
                    header : {
                        align : "center",
                        selector : true
                    },
                   columns: [
                       {key: "rnum",  label: "NO.", hidden:true},
                       {key: "fileTreeKey",  label: "fileTreeKey", hidden:true},
                       {key: "lvl",  label: "lvl", hidden:true},
                       {key: "id",  label: "id", hidden:true},
                       {key: "pid",  label: "pid", hidden:true},
                       {key: "coCd",  label: "회사코드", hidden:true},
                       {key: "coCdNm",  label: "회사명",  hidden:true},
                       {key: "salesCd",  label: "SALES CD", width: 100, align: "center"},
                       {key: "codeNm",  label: "WBS 계획구분", align: "left", width: 130, enableFilter: true, treeControl: true},
                       {key: "wbsPlansDt",      label: "시작일자",      align: "center",   width: 100},
                       {key: "wbsPlaneDt",      label: "종료일자",      align: "center",   width: 100},
                       {key: "wbsPlanCnts",      label: "주요내용",      align: "left",   width: 200},
                       {key: "wbsPlanId",      label: "작성자",      hidden: true},
                       {key: "wbsPlanNm",      label: "작성자",      align: "center",   width: 80},
                       {key: "wbsPlanDt",      label: "작성일",   align: "center",   width: 80}, 
                       {key: "wbsPlanMngId",      label: "담당자",      hidden: true},
                       {key: "wbsPlanMngNm",      label: "담당자",      align: "center",   width: 80},  
                       {key: "wbsPlanOsNm",      label: "외주",   align: "center",   width: 40}, 
                       {key: "wbsPlanStsNm",      label: "상태",   align: "center",   width: 60}, 
                       {key: "creatId",      label: "생성자",      hidden: true},
                       {key: "creatNm",      label: "생성자",      align: "center",   width: 80},
                       {key: "creatPgm",      label: "생성프로그램ID",      hidden: true},
                       {key: "creatDttm",      label: "생성일시",      align: "center",   width: 80},                   
                       {key: "udtId",      label: "최종변경자",      hidden: true},
                       {key: "udtNm",      label: "최종변경자",      align: "center",   width: 80},
                       {key: "udtPgm",      label: "최종수정프로그램ID",      hidden: true},
                       {key: "udtDttm",      label: "최종변경일자",      align: "center",   width: 80},
                   ],
                    body: {
                        mergeCells : ["coCdNm","salesCd"],
                        columnHeight: 26,
                        onClick: function () {
                            var list = gridView.target.getList("selected");
                            $.each(list, function(idx, obj){
                                gridView.target.select(obj.__index, {selected: false});
                            });
                            this.self.select(this.dindex);
                            
                        },
                        onDBLClick: function () {
                            this.self.select(this.dindex);
                        },
                   },
                   tree: {
                       use: true,
                       indentWidth: 10,
                       arrowWidth: 15,
                       iconWidth: 18,
                       icons: {
                           openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
                           collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                           groupIcon: '<i class="fa fa-folder-open" aria-hidden="true"></i>',
                           collapsedGroupIcon: '<i class="fa fa-folder" aria-hidden="true"></i>',
                           itemIcon: '<i class="fa fa-file" aria-hidden="true"></i>'     
                       },
                       columnKeys: {
                           parentKey: "pid",
                           selfKey: "id"
                       }
                   }
                });
                return this;
            },
            setData: function() {
                var targetObj = this.target; 
                var row = gridView.target.getList()[idx];
                var formData = {
                        "coCd" : row.coCd,
                        "salesCd" : row.salesCd
                }
                postAjax("/user/wb/wb04/selectWbsPlanCloseYnNTreeListSub", formData, null, function(data){
                    var list = data.fileList;
                    if (list != undefined) {
                        targetObj.setData({
                             list : list,
                             page : {
                                 totalElements : list.length
                             }
                         });
                    }
                }); 
           } 
            
        }
    
    $(document).ready(function() {
        setCommonSelect($(".popup_area select[data-kind]"));
        setByCoCd(jwt.coCd);
        authChk();           
        idx = modalStack.last().paramObj.idx;
        var row = gridView.target.getList()[idx];
        $.each(row, function(key, value) {
            if ($('#popForm #' + key)[0]) {
                $('#popForm #' + key).val(value);
            }
            if (key == "dsgnDifCodeId") {
                $('#popForm #dsgnDifCodeId option[value!="' + value + '"]').remove();
            }
            else if (key == "prdctnDifCodeId") {
                $('#popForm #prdctnDifCodeId option[value!="' + value + '"]').remove();
            }
        });
        gridView1.initView().setData(0);
        
        
  
    });
    
    
    function setByCoCd(value) {
        $('#coCd option:not([value="'+value+'"])').remove();
    }
    
</script>
