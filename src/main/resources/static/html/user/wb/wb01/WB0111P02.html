<div id="wbsPopup" class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
        <h4 class="tit">WBS 실적 등록</h4>
    </div>
    
    <div class="popup_table">
        <div class="form-group">
            <form id="popForm">
            <input type="hidden" id="fileTrgtKey"    name="fileTrgtKey">
            <input type="hidden" id="userId"        name="userId">
            <input type="hidden" id="pgmId"         name="pgmId"    value="WB0111P02">
                <table class="popup_table">
                    <colgroup>
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="6%">
                    </colgroup>
                    
                    <thead>
                        <tr>
                           <td colspan="9" style="height:30px;text-align: left;">기본정보</td>                                                
                        </tr>
                    </thead>
                    
                    <tbody>
                        <!-- 1행 -->
                        <tr>
                            <th>회사</th>
                            <td>
                                <select id="coCd" name="coCd" data-kind="CO" required msg="회사">
                                </select>
                            </td>
                            <th>관리번호</th>
                            <td>
                                <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsPlanNo" name="wbsPlanNo"  data-search="wbsPlanNo"  readonly >
                                </div>
                            </td>
                            <th>작성일자</th>
                            <td>
                            <input id="wbsPlanDt" id="wbsPlanDt" name="wbsPlanDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" required readonly date>
                            </td>
                            <th>작성자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanId" name="wbsPlanId" msg="작성자" >
                                    <input type="text" id="wbsPlanNm" name="wbsPlanNm" onkeyUp="if(window.event.keyCode == 8){wbsPlanId.value = ''};" readonly required readonly msg="작성자" >
                                   <!--  <a onclick="openUserSearch(1);">
                                        <i class="i_search_w"></i>
                                    </a> -->
                                </div>
                            </td>
                            <th rowspan="6" style="vertical-align:top;">
                                <button type="button" class="btn btn-primary btn-sm" style="height: 25px; line-height: 15px;" onclick="" authchk>이슈등록</button>
                            </th>
                        </tr>
                                     
                        <!-- 2행 -->
                         <tr>
                            <th>Sales Code</th>
                            <td>
                                <div class="search_form">
                                    <input type="text" id="salesCd" name="salesCd" required readonly msg="salesCd">
                                    <!-- <a onclick="wbsSalesCodeSearch();"><i class="i_search_w" readonly></i></a> -->
                                </div>
                            </td>
                            <th>고객사</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="clntCd" name="clntCd" msg="고객사">
                                    <input type="text" id="clntNm" data-search="clntNm" msg="고객사" readonly>
                                   
                                </div>
                            </td>
                            <th>고객사PJT</th>
                            <td>
                                 <input type="text" id="clntPjt" name="clntPjt" msg="고객사PJT" readonly>
                            </td>
                            <th>신작구분</th>
                            <td>
                                 <input type="hidden" id="ordrsDtlDiv20" name="ordrsDtlDiv20" msg="신작구분">
                                 <input type="text" id="ordrsDtlDiv20Nm" name="ordrsDtlDiv20Nm" readonly msg="신작구분">
                            </td>
                        </tr>
                        
                         
                         <tr>
                            <th>Lv.1</th>
                            <td>
                                    <select id="wbsLevel1" name="wbsLevel1"  data-kind="WBSDIV" onchange="selectCodeList(this,0);" data-depth="0" required msg="WBS레벨 1">
                                      <option value="">선택</option>
                                    </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId1" name="wbsPlanMngId1">
                                    <input type="text" id="wbsPlanMngNm1" name="wbsPlanMngNm1" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId1.value = ''};" readonly required msg="레벨1담당자">
                                    <!-- <a onclick="openUserSearch(2);">
                                        <i class="i_search_w"></i>
                                     </a> -->
                                </div>
                            </td>
                            <th>시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt1" name="wbsPlansDt1" autocomplete="off" date readonly>
                                </div>
                            </td>
                            <th>종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt1" name="wbsPlaneDt1" autocomplete="off" date readonly>
                                </div>
                            </td>
                        </tr>
                        


                        <tr id = "level2Area" style="display:none">
                            <th>Lv.2</th>
                            <td>
                                  <select class="division" id="wbsLevel2" name="wbsLevel2" onchange="selectCodeList(this,1);" data-depth="1" msg="WBS레벨 2">
                                    <option value="">선택</option>
                                  </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId2" name="wbsPlanMngId2">
                                    <input type="text" id="wbsPlanMngNm2" name="wbsPlanMngNm2"onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId2.value = ''};" readonly  msg="레벨2담당자">
                                   <!--  <a onclick="openUserSearch(3);">
                                        <i class="i_search_w"></i>
                                    </a> -->
                                </div>
                            </td>
                            <th>시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt2" name="wbsPlansDt2" autocomplete="off" date readonly>
                                </div>
                            </td>
                            <th>종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt2" name="wbsPlaneDt2" autocomplete="off" date readonly>
                                </div>
                            </td>
                        </tr>


                         <tr  id = "level3Area"  style="display:none">
                            <th>Lv.3</th>
                            <td>
                                 <select class="division" id="wbsLevel3" name="wbsLevel3" data-depth="2"  msg="WBS레벨 3">
                                    <option value="">선택</option>
                                 </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                 <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId3" name="wbsPlanMngId3">
                                    <input type="text" id="wbsPlanMngNm3" name="wbsPlanMngNm3"onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId3.value = ''};" readonly  msg="레벨3담당자">
                                   <!--  <a onclick="openUserSearch(4);">
                                        <i class="i_search_w"></i>
                                    </a> -->
                                </div>
                            </td>
                            <th>시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt3" name="wbsPlansDt3" autocomplete="off" date readonly>
                                </div>
                            </td>
                            <th>종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt3" name="wbsPlaneDt3" autocomplete="off" date readonly>
                                </div>
                            </td>
                        </tr>
                         <tr>
                            <th>주요내용</th>
                            <td colspan=3>
                                   <input type="text" id="wbsPlanCnts" name="wbsPlanCnts"  required msg="주요내용" readonly>
                            </td>
                            <th>비고</th>
                            <td colspan=3>
                                    <input type="text" id="wbsPlanRmk" name="wbsPlanRmk" readonly>
                            </td>
                        </tr>

                         <tr  id = "level1Area"  style="display:none">
                            <th>설계난이도</th>
                            <td>
                              <select id="dsgnDifCodeId" name="dsgnDifCodeId" data-kind="DSGNDIF" readonly> 
                              <option value="">선택</option>
                              </select>
                            </td>
                            <th>설계계획공수</th>
                            <td>
                                <input type="text" id="dsgnPlanHour" name="dsgnPlanHour" msg="설계계획공수" readonly>
                            </td>
                            <th>생산난이도</th>
                            <td>
                              <select id="prdctnDifCodeId" name="prdctnDifCodeId" data-kind="PRDCTNDIF" readonly>
                              <option value="">선택</option>
                              </select>
                            </td>
                            <th>생산계획공수</th>
                            <td>
                               <input type="text" id="prdctnPlanHour" name="prdctnPlanHour" msg="생산계획공수" readonly>  
                            </td>
                         </tr>

                         <tr>
                            <th>외주여부</th>
                            <td>
                                <input type=radio id="wbsPlanOsYn_Y" name="wbsPlanOsYn_Y" value="Y">Y &ensp; &ensp; &ensp; &ensp; 
                                <input type=radio id="wbsPlanOsYn_N" name="wbsPlanOsYn_N" value="N" checked>N <br>
                            </td>
                            <th>계획상태</th>
                            <td>
                                <select id="wbsPlanStsCodeId" name="wbsPlanStsCodeId" required data-kind="WBSPLANSTS">
                                    <option value="">선택</option>
                                </select>
                            </td>
                            <th></th>
                            <td></td>
                            <th></th>
                            <td></td>
                         </tr>
                    </tbody>
                    
                   <thead>
                        <tr>
                           <td colspan="9" style="height:30px;text-align: left;">결과정보</td>                                                
                        </tr>
                    </thead>
                    
                    <tbody>
                          <!-- 1행 -->
                         <tr>
                            <th>실적번호</th>
                            <td>
                                <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsNo" name="wbsRsltsNo"  data-search="wbsRsltsNo" readonly>
                                </div>
                            </td>
                            <th>실적일자</th>
                            <td>
                                    <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsRsltsDt" name="wbsRsltsDt" autocomplete="off" date>
                                </div>
                            </td>
                            <th>작성자</th>
                            <td>
                            <div class="search_form">
                                    <input type="hidden" id="wbsRsltsId" name="wbsRsltsId">
                                    <input type="text" id="wbsRsltsNm" name="wbsRsltsNm" onkeyUp="if(window.event.keyCode == 8){wbsRsltsId.value = ''};" readonly>
                                    <a onclick="openUserSearch(5);">
                                        <i class="i_search_w"></i>
                                </a>
                                </div>
                            </td>
                            <th></th>
                            <td>
                              
                            </td>
                        </tr>
                        <!-- 2행 -->
                         <tr>
                            <th>시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsRsltssDt" name="wbsRsltssDt" autocomplete="off" date>
                                </div>
                            </td>
                            <th>종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsRsltseDt" name="wbsRsltseDt" autocomplete="off" date>
                                </div>
                            </td>
                            <th>진척율</th>
                            <td>
                               <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsRate" name="wbsRsltsRate" data-search="wbsRsltsRate" readonly>
                                </div>
                            </td>
                            <th>실투입공수</th>
                            <td>
                              <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsMh" name="wbsRsltsMh"  data-search="wbsRsltsMh" readonly>
                                   <input type="hidden"  id="wbsPlanMh" name="wbsPlanMh"  data-search="wbsPlanMh" readonly>
                                </div>
                            </td>
                        </tr>
                        <!-- 3행 -->
                       <tr> 
                            <th>주요내용</th>
                            <td colspan=3>
                                    <input type="text" id="wbsRsltsCnts" name="wbsRsltsCnts"> 
                            </td>
                            <th>비고</th>
                            <td colspan=3>
                                    <input type="text" id="wbsRsltsRmk" name="wbsRsltsRmk" data-search="wbsRsltsRmk">
                                    <input type="hidden" id="closeYn" name="closeYn">
                                    <input type="hidden" id="lockYn" id="lockYn">
                        </tr>   
                    </tbody>
                    
                </table>    
            </form>
        </div>
    </div>
    
    <div class="popup_table">               
        <table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※실적상세</td>
                <td >
                    <div id="addrow" class="add_btn_small pdl10">
                        <a onclick="" data-grid-control="row-add1" style="height: 30px; line-height: 28px;"  authchk>+</a>
                        <a onclick="" data-grid-control="row-remove1" style="height: 30px; line-height: 28px;"  authchk>-</a>
                    </div>
                </td>
            </tr>
        </table>
    </div> 
    
    <div class="contents">
        <!-- 실적상세 리스트 -->
        <div data-ax5grid="first-grid1" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
    </div>

    <div class="popup_table">               
        <table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※공유 대상자</td>
                <td style="text-align:right;">
                    <button type="button" class="btn btn-primary btn-sm"  onclick="opendModalSharngListList();">공유라인</button>
                    <div id="addrow" class="add_btn_small pdl10">
                        <a onclick="" data-grid-control="row-add2" style="height: 30px; line-height: 28px;">+</a>
                        <a onclick="" data-grid-control="row-remove2" style="height: 30px; line-height: 28px;">-</a>
                    </div>
                </td>
                <td style="text-align: LEFT; border-right: 0px;">※결재 대상자</td>
                <td style="text-align:right;">
                    <button type="button" class="btn btn-primary btn-sm"   onclick="opendModalApprovalList();"">결재라인</button>
                    <div id="addrow" class="add_btn_small pdl10">
                        <a onclick="" data-grid-control="row-add3" style="height: 30px; line-height: 28px;">+</a>
                        <a onclick="" data-grid-control="row-remove3" style="height: 30px; line-height: 28px;">-</a>
                    </div>
                </td>
                
            </tr>
            <tr>
                <td colspan="2" style="text-align: LEFT; border-right: 0px;">
                   <div data-ax5grid="second-grid1" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
                </td>
                 <td colspan="2" style="text-align: LEFT; border-right: 0px;">
                 <div data-ax5grid="second-grid2" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
                </td>                
            </tr>
        </table>      
    </div>
    
    <div class="contents"> 
    <!-- 공통 파일 영역 -->
         <div id="fileList_area"></div>       
    </div>
    <br>
    <div class="col-xs-2" style="height: 70px;">
    </div>

    <!-- 하단 버튼 -->
    <div class ="popup_bottom_btn">
        <button type="button" id="actionBtn" >등록</button>
        <button type="button" class="close_btn"
            onclick="modalStack.close();">닫기</button>
    </div>
    
<script type="text/javascript">

var actionType = null;
var fileTrgtKey = null;
var coCd = null;
var lvl = null;
var idx1 = null;
var idx2 = null;
var idx3 = null;
var salesCd = null;

    ax5.ui.grid.formatter["chkYn"] = function () {
        var color = this.value == "Y" ? "color-circle_02.png" : "color-circle_01.png";
        if (this.value == "E"){
            return 'E';
        } else {
            return '<img src="/static/img/'+color+'" style="width: 10px;height: 10px;"></img>';
        }
    };
    
  //실적상세테이블 그리드 초기화 영역
    var gridView1 = {
       initView: function(){
           this.target = new ax5.ui.grid();
           this.target.setConfig({
               showRowSelector: true,
               multipleSelect: false,
               sortable: true,
               target: $('[data-ax5grid="first-grid1"]'),
               header: {
                 align: "center",
                 selector: false
               },
               body: {
                   onClick: function () {
                       if ($("#closeYn").val() == "Y" || $("#lockYn").val() == "Y") {
                            alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                            return;
                        }
                       this.self.select(this.dindex); 
                   },
                   onDBLClick: function () {
                       if ($("#closeYn").val() == "Y" || $("#lockYn").val() == "Y") {
                            alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                            return;
                        }
                       this.self.clearSelect();
                       this.self.select(this.dindex);
                   },
                  
                   onDataChanged: function () {
                      if (this.item.wbsRsltsRate != undefined && this.item.wbsAssRate != undefined) {
                           this.self.setValue(this.dindex, "wbsAssRateVal", Math.round(parseInt(this.item.wbsRsltsRate) * (parseInt(this.item.wbsAssRate) / 100)));
                           umWbsAssRateVal();
                           
                       }
                    
                       if (this.item.wbsPlanMh != undefined) {
                           this.self.setValue(this.dindex, "wbsPlanMh", parseInt(this.item.wbsPlanMh));
                           umWbsAssRateVal();
                           
                       }
                       
                       if (this.item.wbsRsltsMh != undefined) {
                           this.self.setValue(this.dindex, "wbsRsltsMhVal", parseInt(this.item.wbsRsltsMh));
                           umWbsAssRateVal();
                           
                       }
                   },
              },
              columns: [
                    {key: "rn",      label: "No.",      align: "center",   width: 60},
                    {key: "wbsRsltsRate",      label: "진척율",  width: 80, align: "right", editor: {type: "text"}},
                    {key: "wbsAssRate",  label: "가중치(%)",    width: 80,  align: "right", editor:  {type: "text"} },  
                    {key: "wbsAssRateVal",      label: "가중치 합계(%)",    hidden: true},
                    {key: "wbsPlanMh",      label: "계획공수",   width: 80, align: "right", editor: {type: "text"}},
                    {key: "wbsRsltsMh",      label: "실투입공수",  width: 80, align: "right", editor: {type: "text"}},
                    {key: "wbsRsltsMhVal",      label: "공수합계",      hidden: true},
                    {key: "wbsRsltsCnts",      label: "실적내용", width: 250, align: "left", editor: {type: "text"}},
                    {key: "wbsRsltsRmk",      label: "비고", width: 250, align: "left", editor: {type: "text"}},
                    {key: "lockYn",      label: "잠금",      width: 60, align: "center" , formatter: "chkYn"},
                    {key: "closeYn",      label: "마감",      width: 60, align: "center" , formatter: "chkYn"},
                    {key: "creatId",      label: "생성자",      hidden: true},
                    {key: "creatNm",      label: "생성자",      align: "center",   width: 80},
                    {key: "creatDttm",      label: "생성일시",      align: "center",   width: 140},                   
                    {key: "udtId",      label: "최종변경자",      hidden: true},
                    {key: "udtNm",      label: "최종변경자",      align: "center",   width: 80},
                    {key: "udtDttm",      label: "최종변경일자",      align: "center",   width: 140},
                    ]
           });

           return this;
         },
         
         setData: function() {
             var targetObj = this.target;  
             /* if (actionType == "C") {
                 row = gridView.target.getList()[idx];
             }
             else {
                 row = gridView2.target.getList()[idx];
             } */
             var idx = null;
             if (lvl == 1) {
            	 idx = idx1;
             }
             else if (lvl == 2) {
                 idx = idx2;
             }
             else if (lvl == 3) {
                 idx = idx3;
             }
             var row = gridView.target.getList()[idx];
             var formData = {
                     "coCd" : row.coCd,
                     "salesCd" : row.salesCd,
                     "codeKind" : row.codeKind,
                     "codeId" : row.codeId
             }
             postAjax("/user/wb/wb02/selectWbsRsltsDetailList", formData, null, function(data){
            	 //debugger;                 
                 var list = data.resultList;
                 if (list != undefined) {
                     targetObj.setData({
                          list : list,
                          page : {
                              totalElements : list.length
                          }
                      });
                 }
             }); 
        } 
    }
  
    var secondGridView1 = {
            initView: function(){
                this.target = new ax5.ui.grid();
                this.target.setConfig({
                    showRowSelector: true,
                    multipleSelect: false,
                    sortable: true,
                    target: $('[data-ax5grid="second-grid1"]'),
                    header: {
                      align: "center",
                      selector: false
                    },
                    body: {
                        onClick: function () {
                            this.self.select(this.dindex); 
                        },
                        onDBLClick: function () {
                            this.self.clearSelect();
                            this.self.select(this.dindex);
                        },
                   },
                   columns: [
                       {key: "rn",      label: "No.",      align: "center",   width: 60},
                       {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 130},
                       {key: "wbsRsltsPlanNo",      label: "관리번호",      align: "center",   width: 130},
                       {key: "wbsRsltsPlanCodeId",      label: "계획항목코드",      hidden: true},
                       {key: "wbsRsltsPlanCodeNm",      label: "LEVEL",      align: "center",   width: 130},
                       {key: "todoCfDt",      label: "확인일자",      align: "center",   width: 130},
                       {key: "todoCfOpn",      label: "확인의견",      align: "left",   width: 200},
                       {key: "wbsRsltsCoCd",      label: "회사",          hidden: true},
                       {key: "wbsRsltsCoCdNm",      label: "회사명",      align: "center",   width: 130},
                       {key: "wbsSharngUserId",      label: "ID",      align: "center",   width: 130},
                       {key: "empNo",      label: "사원번호",      align: "center",   width: 130},
                       {key: "name",      label: "성명",      align: "center",   width: 130},
                       {key: "telNo",      label: "H.P",      align: "center",   width: 130},
                       {key: "email",      label: "E-Mail",      align: "center",   width: 200}
                         ]
                });
                return this;
              },
              setData: function() {
                  var targetObj = this.target;
                  var idx = null;
                  if (lvl == 1) {
                      idx = idx1;
                  }
                  else if (lvl == 2) {
                      idx = idx2;
                  }
                  else if (lvl == 3) {
                      idx = idx3;
                  }
                  var row = gridView.target.getList()[idx];
                  var formData = {
                          "coCd" : row.coCd,
                          "salesCd" : row.salesCd,
                          "codeKind" : row.codeKind,
                          "codeId" : row.codeId
                  }
                  postAjax("/user/wb/wb02/selectRsltsSharngList", formData, null, function(data){
                     var list = data.resultList;
                      targetObj.setData({
                           list : list,
                           page : {
                               totalElements : list.length
                           }
                       });
                      
                  }); 
             } 
         }
    
  //결재 테이블 그리드 초기화 영역
    var secondGridView2 = {
            initView: function(){
                this.target = new ax5.ui.grid();
                this.target.setConfig({
                    showRowSelector: true,
                    multipleSelect: false,
                    sortable: true,
                    target: $('[data-ax5grid="second-grid2"]'),
                    header: {
                      align: "center",
                      selector: false
                    },
                    body: {
                        onClick: function () {
                            this.self.select(this.dindex); 
                        },
                        onDBLClick: function () {
                            this.self.clearSelect();
                            this.self.select(this.dindex);
                        },
                   },
                   columns: [
                       {key: "rn",      label: "No.",      align: "center",   width: 60},
                       {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 130},
                       {key: "wbsRsltsPlanNo",      label: "관리번호",      align: "center",   width: 130}, 
                       {key: "wbsRsltsPlanCodeId",      label: "계획항목코드",      hidden: true},
                       {key: "wbsRsltsPlanCodeNm",      label: "LEVEL",      align: "center",   width: 130},
                       {key: "todoCfDt",      label: "확인일자",      align: "center",   width: 130},
                       {key: "todoCfOpn",      label: "확인의견",      align: "left",   width: 200},
                       {key: "wbsRsltsCoCd",      label: "회사",          hidden: true},
                       {key: "wbsRsltsCoCdNm",      label: "회사명",      align: "center",   width: 130},
                       {key: "wbsSharngUserId",      label: "ID",      align: "center",   width: 130},
                       {key: "empNo",      label: "사원번호",      align: "center",   width: 130},
                       {key: "name",      label: "성명",      align: "center",   width: 130},
                       {key: "telNo",      label: "H.P",      align: "center",   width: 130},
                       {key: "email",      label: "E-Mail",      align: "center",   width: 200}
                         ]
                });
                return this;
              },
              setData: function() {
                  var targetObj = this.target;
                  var idx = null;
                  if (lvl == 1) {
                      idx = idx1;
                  }
                  else if (lvl == 2) {
                      idx = idx2;
                  }
                  else if (lvl == 3) {
                      idx = idx3;
                  }
                  var row = gridView.target.getList()[idx];
                  var formData = {
                          "coCd" : row.coCd,
                          "salesCd" : row.salesCd,
                          "codeKind" : row.codeKind,
                          "codeId" : row.codeId
                  }
                  postAjax("/user/wb/wb02/selectRsltsApprovalList", formData, null, function(data){
                      var list = data.resultList;
                      
                      targetObj.setData({
                           list : list,
                           page : {
                               totalElements : list.length
                           }
                       });
                      
                  }); 
             } 
         }
    
    $('[data-grid-control]').click(function () {

        switch (this.getAttribute("data-grid-control")) {  
        
        
            case "row-add1":
                
                if ($("#closeYn").val() == "Y" || $("#lockYn").val() == "Y") {
                    alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                    return;
                }
                gridView1.target.addRow($.extend({}, gridView1.target.list.length, {__index: undefined})); 
                var row = gridView1.target.getList().length - 1;
                gridView1.target.setValue(row, "wbsRsltsRate", '0');
                gridView1.target.setValue(row, "wbsAssRate", '0');
                gridView1.target.setValue(row, "wbsAssRateVal", '0');
                gridView1.target.setValue(row, "wbsPlanMh", '0');
                gridView1.target.setValue(row, "wbsRsltsMh", '0');
                gridView1.target.setValue(row, "wbsRsltsMhVal", '0');            
                gridView1.target.setValue(row, "lockYn", 'N');
                gridView1.target.setValue(row, "closeYn", 'N');
                
                umWbsAssRateVal();
              break;
            case "row-remove1":
                if ($("#closeYn_S1").val() == "Y" || $("#lockYn_S1").val() == "Y") {
                    alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                    return;
                }
                var row = gridView1.target.getList("selected");
                if (row.lockYn != "Y" && row.closeYn != "Y") {
                    gridView1.target.deleteRow("selected");
                }              
                else{
                    alert("실적데이터가 잠금(Lock) 또는 마감 상태입니다.");
                }               
                umWbsAssRateVal();
              break;
              
              
            case "row-add2":
                if ($("#closeYn").val() == "Y" || $("#lockYn").val() == "Y") {
                    alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                    return;
                }
                var paramObj = {
                        "coCd" : $('#coCd').val(),
                        "userId": '',
                        "useYn": "Y"
                    };
                    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
                       var checkedId = tree.get_checked()[0];
                       var checkedNode = tree.get_node(checkedId);   
                       
                       var paramObj = {"coCd" : $('#coCd').val(), "userId" : checkedId};
                       
                       postAjaxSync("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
                               var chk = false;
                               var rowList = secondGridView1.target.getList();
                               $.each(rowList, function(idx, elem){
                                   if (elem.wbsSharngUserId == data.resultList[0].id) {
                                       chk = true;
                                   }
                               });
            
                               if (chk == false) {
                                   
                                   secondGridView1.target.addRow($.extend({}, "last", false));                             
                                   
                                   var row = secondGridView1.target.getList().length - 1;
                                   secondGridView1.target.setValue(row, "salesCd", $("#salesCd").val());
                                   secondGridView1.target.setValue(row, "wbsRsltsPlanNo", $("#wbsRsltsNo").val());
                                   if (lvl == 1) {
                                       secondGridView1.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel1").val());
                                       secondGridView1.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel1 option:checked").text());
                                   }
                                   else if (lvl == 2) {
                                       secondGridView1.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel2").val());
                                       secondGridView1.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel2 option:checked").text());
                                   }
                                   else if (lvl == 3) {
                                       secondGridView1.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel3").val());
                                       secondGridView1.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel3 option:checked").text());
                                   }
                                   
                                   secondGridView1.target.setValue(row, "wbsRsltsCoCd", data.resultList[0].coCd);
                                   secondGridView1.target.setValue(row, "wbsRsltsCoCdNm", data.resultList[0].coCdNm);
                                   secondGridView1.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
                                   secondGridView1.target.setValue(row, "empNo", data.resultList[0].empNo);
                                   secondGridView1.target.setValue(row, "name", data.resultList[0].name);
                                   secondGridView1.target.setValue(row, "telNo", data.resultList[0].telNo);
                                   secondGridView1.target.setValue(row, "email", data.resultList[0].email);  

                               }
                               else {
                                   alert("중복 공유를 지정할 수 없습니다.");
                                   return;
                               }
                       });                 
                    });
              break;
            case "row-remove2":
                if ($("#closeYn").val() == "Y" || $("#lockYn").val() == "Y") {
                    alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                    return;
                }
                var row = secondGridView1.target.getList("selected");
                if (row.todoDt == undefined && row.todoDt == null) {
                    secondGridView1.target.deleteRow("selected");
                }              
                else{
                    alert("공유 데이터가 확인되었으며 삭제할 수 없습니다.");
                }           
              break;   
              
              
            case "row-add3":
                if ($("#closeYn").val() == "Y" || $("#lockYn").val() == "Y") {
                    alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                    return;
                }
                var paramObj = {
                        "coCd" : $('#coCd').val(),
                        "userId": '',
                        "useYn": "Y"
                    };
                    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
                       var checkedId = tree.get_checked()[0];
                       var checkedNode = tree.get_node(checkedId);   
                       
                       var paramObj = {"coCd" : $('#coCd').val(), "userId" : checkedId};
                       
                       postAjaxSync("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
                               var chk = false;
                               var rowList = secondGridView2.target.getList();
                               $.each(rowList, function(idx, elem){
                                   if (elem.wbsSharngUserId == data.resultList[0].id) {
                                       chk = true;
                                   }
                               });
            
                               if (chk == false) {
                                   secondGridView2.target.addRow($.extend({}, "last", false));                             
                                   
                                   var row = secondGridView2.target.getList().length - 1;
                                   secondGridView2.target.setValue(row, "salesCd", $("#salesCd").val());
                                   secondGridView2.target.setValue(row, "wbsRsltsPlanNo", $("#wbsRsltsNo").val());
                                   if (lvl == 1) {
                                       secondGridView2.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel1").val());
                                       secondGridView2.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel1 option:checked").text());
                                   }
                                   else if (lvl == 2) {
                                       secondGridView2.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel2").val());
                                       secondGridView2.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel2 option:checked").text());
                                   }
                                   else if (lvl == 3) {
                                       secondGridView2.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel3").val());
                                       secondGridView2.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel3 option:checked").text());
                                   } 
                                   secondGridView2.target.setValue(row, "wbsRsltsCoCd", data.resultList[0].coCd);
                                   secondGridView2.target.setValue(row, "wbsRsltsCoCdNm", data.resultList[0].coCdNm);
                                   secondGridView2.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
                                   secondGridView2.target.setValue(row, "empNo", data.resultList[0].empNo);
                                   secondGridView2.target.setValue(row, "name", data.resultList[0].name);
                                   secondGridView2.target.setValue(row, "telNo", data.resultList[0].telNo);
                                   secondGridView2.target.setValue(row, "email", data.resultList[0].email);               
                                   
                               }
                               else {
                                   alert("중복 결재를 지정할 수 없습니다.");
                                   return;
                               }
                       });                 
                    });
              break;
            case "row-remove3":
                if ($("#closeYn").val() == "Y" || $("#lockYn").val() == "Y") {
                    alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                    return;
                }
                var row = secondGridView2.target.getList("selected");
                if (row.todoDt == undefined && row.todoDt == null) {
                    secondGridView2.target.deleteRow("selected");
                }              
                else{
                    alert("데이터가 결재 되었으며 삭제할 수 없습니다.");
                }           
              break;  
        }
    });

    $(document).ready(function() {
        actionType = modalStack.last().paramObj.actionType;
        fileTrgtKey = modalStack.last().paramObj.fileTrgtKey;
        coCd = modalStack.last().paramObj.coCd;
        lvl = modalStack.last().paramObj.lvl;
        idx1 = modalStack.last().paramObj.idx1;
        idx2 = modalStack.last().paramObj.idx2;
        idx3 = modalStack.last().paramObj.idx3;       
        salesCd = modalStack.last().paramObj.salesCd;
        
        
        if (lvl == 1) {
            $("#popForm #level1Area").show();
            $("#popForm #level2Area").hide();
            $("#popForm #level3Area").hide();
        }
        else if (lvl == 2) {
            $("#popForm #level1Area").show();
            $("#popForm #level2Area").show();
            $("#popForm #level3Area").hide();
        }
        else if (lvl == 3) {
            $("#popForm #level1Area").show();
            $("#popForm #level2Area").show();
            $("#popForm #level3Area").show();
        }
    	
        setCommonSelect($(".popup_area select[data-kind]"));
        setByCoCd(coCd);
        $("#popForm #userId").val(jwt.userId);
        authChk();
        
        if (lvl == 1) {
            $("#popForm #wbsPlansDt1").datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", "today")
            
            $("#popForm #wbsPlaneDt1").datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", "today")
            
            var row = gridView.target.getList()[idx1];
            if (row != undefined) {
                $("#popForm #wbsLevel1").val(row.codeId);
                $('#popForm #wbsLevel1 option[value!="' + row.codeId + '"]').remove();                                            
                rowFill(row);
            }
        }
        else if (lvl == 2) {
            $("#popForm #wbsPlansDt2").datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", "today")
            
            $("#popForm #wbsPlaneDt2").datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", "today")
            
            $("#popForm #wbsPlanMngId2").val(jwt.userId);
            $("#popForm #wbsPlanMngNm2").val(jwt.userNm);
            
            
            /////////////////////////////////////////////////////////////////////
            var row1 = gridView.target.getList()[idx1];
            $("#popForm #wbsLevel1").val(row1.codeId);
            $('#popForm #wbsLevel1 option[value!="' + row1.codeId + '"]').remove();
            
            $("#popForm #wbsPlanMngId1").val(row1.wbsPlanMngId);
            $("#popForm #wbsPlanMngNm1").val(row1.wbsPlanMngNm);
            $("#popForm #wbsPlansDt1").val(row1.wbsPlansDt);
            $("#popForm #wbsPlaneDt1").val(row1.wbsPlaneDt);        
            /////////////////////////////////////////////////////////////////////
            var row2 = gridView.target.getList()[idx2];
            if (row2 != undefined) {
                selectCodeList("#wbsLevel1",0);
                $("#popForm #wbsLevel2").val(row2.codeId);  
                $('#popForm #wbsLevel2 option[value!="' + row2.codeId + '"]').remove();
                rowFill(row2);
            }
            /////////////////////////////////////////////////////////////////////
                          
        }
        else if (lvl == 3) {
            $("#popForm #wbsPlansDt3").datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", "today")
            
            $("#popForm #wbsPlaneDt3").datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", "today")
            
            $("#popForm #wbsPlanMngId3").val(jwt.userId);
            $("#popForm #wbsPlanMngNm3").val(jwt.userNm);
            
            /////////////////////////////////////////////////////////////////////
            var row1 = gridView.target.getList()[idx1];
            $("#popForm #wbsLevel1").val(row1.codeId);
            $('#popForm #wbsLevel1 option[value!="' + row1.codeId + '"]').remove();
           
            $("#popForm #wbsPlanMngId1").val(row1.wbsPlanMngId);
            $("#popForm #wbsPlanMngNm1").val(row1.wbsPlanMngNm);
            $("#popForm #wbsPlansDt1").val(row1.wbsPlansDt);
            $("#popForm #wbsPlaneDt1").val(row1.wbsPlaneDt);    
            /////////////////////////////////////////////////////////////////////

            var row2 = gridView.target.getList()[idx2];
            selectCodeList("#wbsLevel1",0);
            $("#popForm #wbsLevel2").val(row2.codeId);  
            $('#popForm #wbsLevel2 option[value!="' + row2.codeId + '"]').remove();
            
            $("#popForm #wbsPlanMngId2").val(row2.wbsPlanMngId);
            $("#popForm #wbsPlanMngNm2").val(row2.wbsPlanMngNm);
            $("#popForm #wbsPlansDt2").val(row2.wbsPlansDt);
            $("#popForm #wbsPlaneDt2").val(row2.wbsPlaneDt); 
            
            /////////////////////////////////////////////////////////////////////
            
            var row3 = gridView.target.getList()[idx3];
            if (row3 != undefined) {
                selectCodeList("#wbsLevel2",1);
                
                $("#popForm #wbsLevel3").val(row3.codeId);  
                $('#popForm #wbsLevel3 option[value!="' + row3.codeId + '"]').remove();
                
                rowFill(row3);
            }
        }
        
       
        
        $('#wbsRsltssDt').datepicker({
            format : "yyyy-mm-dd",
            language : "ko",
            autoclose : true
        }).datepicker("setDate", "today")
        
        $('#wbsRsltseDt').datepicker({
            format : "yyyy-mm-dd",
            language : "ko",
            autoclose : true
        }).datepicker("setDate", "today")
        if (actionType == "C") {
            $('#actionBtn').text("등록");
            $('#actionBtn').on("click", function() {
            	insertWbsRslts();
            });
            
            $('#wbsRsltsDt').datepicker({
                format : "yyyy-mm-dd",
                language : "ko",
                autoclose : true
            }).datepicker("setDate", "today")
            
            
            
            $("#wbsRsltsNo").val($("#wbsPlanNo").val());
            $("#wbsRsltsId").val(jwt.userId);
            $("#wbsRsltsNm").val(jwt.userNm);
            $("#wbsRsltsRate").val(0);
            $("#wbsRsltsMh").val(0);
            $("#wbsPlanMh").val(0);
        }
        else {
            $('.tit').text('WBS 실적 수정')
            $('#actionBtn').text("수정");
            $('#actionBtn').on("click", function() {
            	updateWbsRslts();
            });
            var paramObj = {"fileTrgtKey" : fileTrgtKey};
            postAjaxSync("/user/wb/wb01/selectWbsRsltsInfo", paramObj, null, function(data) {
            	$.each(data.result, function(key, value) {
            		if ($("#popForm #" + key)[0]) {
                        $("#popForm #" + key).val(value);
                    }
            	});
            });
            
        }    
            

        gridView1.initView().setData();
        secondGridView1.initView().setData();
        secondGridView2.initView().setData();
        //---------------------------------------------------------------  
        //첨부 화일 처리 시작 
        //---------------------------------------------------------------
        //alert(fileTrgtKey);
        //alert($("#pgmId").val());
        fileParam = {
                fileTrgtTyp : $("#popForm #pgmId").val(),
                fileTrgtKey     :fileTrgtKey
        }
        treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
        //---------------------------------------------------------------  
        //첨부 화일 처리 끝
        //---------------------------------------------------------------  
    });
    
    function rowFill(row) {
        $("#popForm #coCd").val(row.coCd);
        $("#popForm #wbsPlanNo").val(row.wbsPlanNo);
        $("#popForm #wbsPlanDt").val(row.wbsPlanDt);
        $("#popForm #wbsPlanId").val(row.wbsPlanId);
        $("#popForm #wbsPlanNm").val(row.wbsPlanNm);
        
        $("#popForm #salesCd").val(row.salesCd);
        $("#popForm #clntCd").val(row.ordrsClntCd);
        $("#popForm #clntNm").val(row.ordrsClntNm);
        $("#popForm #clntPjt").val(row.clntPjt);
        $("#popForm #ordrsDtlDiv20").val(row.ordrsDtlDiv20);
        $("#popForm #ordrsDtlDiv20Nm").val(row.ordrsDtlDiv20Nm);    
        
        if (lvl == 1) {
            $("#popForm #wbsPlanMngId1").val(row.wbsPlanMngId);
            $("#popForm #wbsPlanMngNm1").val(row.wbsPlanMngNm);
            $("#popForm #wbsPlansDt1").val(row.wbsPlansDt);
            $("#popForm #wbsPlaneDt1").val(row.wbsPlaneDt);
        }
        else if (lvl == 2) {
            $("#popForm #wbsPlanMngId2").val(row.wbsPlanMngId);
            $("#popForm #wbsPlanMngNm2").val(row.wbsPlanMngNm);
            $("#popForm #wbsPlansDt2").val(row.wbsPlansDt);
            $("#popForm #wbsPlaneDt2").val(row.wbsPlaneDt);
        }
        else if (lvl == 3) {
            $("#popForm #wbsPlanMngId3").val(row.wbsPlanMngId);
            $("#popForm #wbsPlanMngNm3").val(row.wbsPlanMngNm);
            $("#popForm #wbsPlansDt3").val(row.wbsPlansDt);
            $("#popForm #wbsPlaneDt3").val(row.wbsPlaneDt);
        }
        
        $("#popForm #wbsPlanId").val(row.wbsPlanId);
        $("#popForm #wbsPlanNm").val(row.wbsPlanNm);
        if (row.wbsPlanOsYn == "Y"){ 
            $("#wbsPlanOsYn_Y").prop('checked',true);
            $("#wbsPlanOsYn_N").prop('checked',false);
        }
        else{ 
            $("#wbsPlanOsYn_Y").prop('checked',false);
            $("#wbsPlanOsYn_N").prop('checked',true);
        }
        $('#wbsPlanStsCodeId option[value!="' + row.wbsPlanStsCodeId + '"]').remove();
        $("#popForm #wbsPlanCnts").val(row.wbsPlanCnts);
        $("#popForm #wbsPlanRmk").val(row.wbsPlanRmk);
        $("#popForm #dsgnDifCodeId").val(row.dsgnDifCodeId);
        $("#popForm #dsgnPlanHour").val(row.dsgnPlanHour);
        $("#popForm #prdctnDifCodeId").val(row.prdctnDifCodeId);
        $("#popForm #prdctnPlanHour").val(row.prdctnPlanHour);
    }
    
    function umWbsAssRateVal() {
        
        var rowList = gridView1.target.getList();
        var sumWbsAssRate = 0;
        var sumWbsPlanMh = 0;
        var sumWbsRsltsMh = 0;
        $.each(rowList, function(idx, elem){
            
            sumWbsAssRate = parseInt(sumWbsAssRate) + parseInt(elem.wbsAssRateVal); 
            sumWbsPlanMh = parseInt(sumWbsPlanMh) + parseInt(elem.wbsPlanMh);
            sumWbsRsltsMh = parseInt(sumWbsRsltsMh) + parseInt(elem.wbsRsltsMh); 
        });
        $('#wbsRsltsRate').val(sumWbsAssRate);
        $('#wbsPlanMh').val(sumWbsPlanMh);
        $('#wbsRsltsMh').val(sumWbsRsltsMh);
    }
    
    
    
    function setByCoCd(value) {
        $('#coCd option:not([value="'+value+'"])').remove();
    }
    
    
    //작성자, 담당자  검색
    function openUserSearch(type) {
        var paramObj = {};
        paramObj["coCd"] = $('#coCd').val();
        if (type == 1) {
            paramObj["userId"] = $('#popForm #wbsPlanId').val();
        }
        else if (type == 2) {
            paramObj["userId"] = $('#popForm #wbsPlanMngId1').val();
        }
        else if (type == 3) {
            paramObj["userId"] = $('#popForm #wbsPlanMngId2').val();
        }
        else if (type == 4) {
            paramObj["userId"] = $('#popForm #wbsPlanMngId3').val();
        }
        else if (type == 5) {
            paramObj["userId"] = $('#popForm #wbsRsltsId').val();
        }
        paramObj["useYn"] =  "Y";
        
        openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "작성자 검색", paramObj, function (tree){
            var checkedId = tree.get_checked()[0];
            var checkedNode = tree.get_node(checkedId);
            if (type == 1) {
                $('#popForm #wbsPlanId').val(checkedNode.id);
                $('#popForm #wbsPlanNm').val(checkedNode.text);
            }
            else if (type == 2) {
                $('#popForm #wbsPlanMngId1').val(checkedNode.id);
                $('#popForm #wbsPlanMngNm1').val(checkedNode.text);
            }
            else if (type == 3) {
                $('#popForm #wbsPlanMngId2').val(checkedNode.id);
                $('#popForm #wbsPlanMngNm2').val(checkedNode.text);
            }
            else if (type == 4) {
                $('#popForm #wbsPlanMngId3').val(checkedNode.id);
                $('#popForm #wbsPlanMngNm3').val(checkedNode.text);
            }
            else if (type == 5) {
                $('#popForm #wbsRsltsId').val(checkedNode.id);
                $('#popForm #wbsRsltsNm').val(checkedNode.text);
            }
            
            
        });
    }
    
  //Sales Code (수주마스터, 수주상세테이블 조인) 검색
    function wbsSalesCodeSearch() {
      if (actionType == "U") {
          alert("정보 수정시 선택이 불가합니다.");
          return;
      }
        var paramObj = {
           "coCd" : $('#coCd').val(),
           "salesCd": $('#salesCd').val()
        };
        openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 430, "SALES CODE 검색", paramObj, function (grid){
            var row = grid.target.getList("selected")[0];
            $('#salesCd').val(row.salesCd); // Sales Code
            $('#clntPjt').val(row.clntPjt); // 고객사 PJT
            $('#clntCd').val(row.ordrsClntCd); // 고객사코드
            $('#clntNm').val(row.ordrsClntNm); // 고객사명
            $("#ordrsDtlDiv20").val(row.ordrsDtlDiv20); // 신작구분
            $("#ordrsDtlDiv20Nm").val(row.ordrsDtlDiv20Nm); // 신작구분
        });
    }
   
   function selectCodeList(obj,idx) { 
        var codeKind = $(obj).val();
        var target = $(obj).next('select.division');
        if(idx == 0){
            target = $("#wbsLevel2");
            $('#wbsLevel2 option[value!=""]').remove();
            $('#wbsLevel3 option[value!=""]').remove();
        }else{
            target = $("#wbsLevel3");
            $('#wbsLevel3 option[value!=""]').remove();
        }
        var paramObj = {"codeKind": codeKind};
        if (codeKind != '') {
            postAjaxSync("/admin/cm/cm05/selectChildCodeList", paramObj, null, function(data){
                var optionHtml = '';
                var childCodeList = data.childCodeList;
                $.each(childCodeList, function(index, item){
                    optionHtml += '<option value='+item.codeId+'>';
                    optionHtml += item.codeNm;
                    optionHtml += '</option>';
                });
                $(target).append(optionHtml);
            });
        }
        
    }
   

   
   //공유대상자 팝업
   function opendModalSharngListList() { 
       if ($("#closeYn").val() == "Y" || $("#lockYn").val() == "Y") {
            alert("실적데이터가 잠김 또는 마감된 상태입니다.");
            return;
        }
       var formData = {};
       openSecondModal("/static/html/user/wb/wb02/WB0202P01.html", 1300, 780, "결재선 지정", formData, function (grid){
               var rowList = grid.target.getList("selected");
               if (rowList.length > 0) {
                   var chk = false;
                   $.each(rowList, function(idx, elem){ 
                       if (elem.check == "Y") { 
                           var userId = elem.appId;
                           var rowList1 = secondGridView1.target.getList();
                           $.each(rowList1, function(idx, elem){
                                if (elem.wbsSharngUserId == userId) {
                                   chk = true;
                               }
                           });
                       }
                   });
                   if (chk == false) {
                       $.each(rowList, function(idx, elem){
                           if (elem.check == "Y") {
                                   var paramObj = {"coCd" : elem.coCd, "userId" : elem.appId};            
                                   postAjaxSync("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
                                       secondGridView1.target.addRow($.extend({}, "last", false));                                                 
                                       var row = secondGridView1.target.getList().length - 1;
                                       secondGridView1.target.setValue(row, "salesCd", $("#salesCd").val());
                                       secondGridView1.target.setValue(row, "wbsRsltsPlanNo", $("#wbsRsltsNo").val());
                                       if (lvl == 1) {
                                           secondGridView1.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel1").val());
                                           secondGridView1.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel1 option:checked").text());
                                        }
                                        else if (lvl == 2) {
                                           secondGridView1.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel2").val());
                                           secondGridView1.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel2 option:checked").text());
                                        }
                                        else if (lvl == 3) {
                                           secondGridView1.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel3").val());
                                           secondGridView1.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel3 option:checked").text());
                                        }
                                       secondGridView1.target.setValue(row, "wbsRsltsCoCd", data.resultList[0].coCd);
                                       secondGridView1.target.setValue(row, "wbsRsltsCoCdNm", data.resultList[0].coCdNm);
                                       secondGridView1.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
                                       secondGridView1.target.setValue(row, "empNo", data.resultList[0].empNo);
                                       secondGridView1.target.setValue(row, "name", data.resultList[0].name);
                                       secondGridView1.target.setValue(row, "telNo", data.resultList[0].telNo);
                                       secondGridView1.target.setValue(row, "email", data.resultList[0].email);                                        
                                   });
                             }
                       });
                  }
                  else {
                      alert("중복 공유를 지정할 수 없습니다.");
                      return;
                  }
               }
               
       });
   }

   
// 결재대상자 팝업
   function opendModalApprovalList() {
       if ($("#closeYn").val() == "Y" || $("#lockYn").val() == "Y") {
           alert("실적데이터가 잠김 또는 마감된 상태입니다.");
           return;
       }
       var formData = {};
       openSecondModal("/static/html/user/wb/wb02/WB0202P01.html", 1300, 780, "결재선 지정", formData, function (grid){
               var rowList = grid.target.getList("selected");
               if (rowList.length > 0) {
                   var chk = false;
                   $.each(rowList, function(idx, elem){ 
                       if (elem.check == "Y") { 
                           var userId = elem.appId;
                           var rowList1 = secondGridView2.target.getList();
                           $.each(rowList1, function(idx, elem){
                                if (elem.wbsSharngUserId == userId) {
                                   chk = true;
                               }
                           });
                       }
                   });
                   if (chk == false) {
                       $.each(rowList, function(idx, elem){
                           if (elem.check == "Y") {
                                   var paramObj = {"coCd" : elem.coCd, "userId" : elem.appId};  
                                   postAjaxSync("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
                                       secondGridView2.target.addRow($.extend({}, "last", false));                                                 
                                       var row = secondGridView2.target.getList().length - 1;
                                       secondGridView2.target.setValue(row, "salesCd", $("#salesCd").val());
                                       secondGridView2.target.setValue(row, "wbsRsltsPlanNo", $("#wbsRsltsNo").val());
                                       if (lvl == 1) {
                                           secondGridView2.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel1").val());
                                           secondGridView2.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel1 option:checked").text());
                                       }
                                       else if (lvl == 2) {
                                           secondGridView2.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel2").val());
                                           secondGridView2.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel2 option:checked").text());
                                       }
                                       else if (lvl == 3) {
                                           secondGridView2.target.setValue(row, "wbsRsltsPlanCodeId", $("#wbsLevel3").val());
                                           secondGridView2.target.setValue(row, "wbsRsltsPlanCodeNm", $("#wbsLevel3 option:checked").text());
                                       }
                                       secondGridView2.target.setValue(row, "wbsRsltsCoCd", data.resultList[0].coCd);
                                       secondGridView2.target.setValue(row, "wbsRsltsCoCdNm", data.resultList[0].coCdNm);
                                       secondGridView2.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
                                       secondGridView2.target.setValue(row, "empNo", data.resultList[0].empNo);
                                       secondGridView2.target.setValue(row, "name", data.resultList[0].name);
                                       secondGridView2.target.setValue(row, "telNo", data.resultList[0].telNo);
                                       secondGridView2.target.setValue(row, "email", data.resultList[0].email);                                        
                                   });
                             }
                       });
                  }
                  else {
                      alert("중복 공유를 지정할 수 없습니다.");
                      return;
                  }
               }
               
       });
   }


    function insertWbsRslts() {
    	
        if (inputValidation($('.popup_area [required]'))) { 
        	//debugger;
            var codeId = null;
            if (lvl == 1) {
                codeId = $('#wbsLevel1').val();
            }
            else if (lvl == 2) {
                codeId = $('#wbsLevel2').val();
            }
            else if (lvl == 3) {
                codeId = $('#wbsLevel3').val();
            }
            
            var formData = makeFormData();                                      
            filePostAjax("/user/wb/wb02/wbsLevel1RsltsInsert", formData,             
                    function(data) {
                        alert(data.resultMessage);                              
                        if (data.resultCode == 200) {                          
                        	gridView.setData(0, salesCd);
                            modalStack.close();                              
                        }
                    });
            
            filePutAjax("/user/wb/wb02/wbsPlanStsCodeUpdate", formData, function(data){            
                if(data.resultCode == 200){   
                	//gridView.setData(0, salesCd);
                    //modalStack.close();  
                }
            });                                    
        }
    }
    
    function updateWbsRslts() {
         if (inputValidation($('.popup_area [required]'))) {   
         var formData = makeFormData();                                      
            filePutAjax("/user/wb/wb02/wbsLevel1RsltsUpdate", formData,   
                    function(data) {
                        alert(data.resultMessage);                              
                        if (data.resultCode == 200) {   
                        	gridView.setData(0, salesCd);
                            modalStack.close();                              
                        }
                    });
            filePutAjax("/user/wb/wb02/wbsPlanStsCodeUpdate", formData, function(data){
                if(data.resultCode == 200){                                
                	//gridView.setData(0, salesCd);
                   // modalStack.close();  
                }
            });
        }
    }
    
    function makeFormData() {
        umWbsAssRateVal();
        /////////////////////////////////////////////////////////////////////////////////
        var e_date = $("#wbsPlaneDt").val(); 
        var today = new Date();
        var n_date = today.getFullYear()+"-"+('0'+(today.getMonth()+1)).slice(-2)+"-"+('0'+today.getDate()).slice(-2);
        if (n_date <= e_date && parseInt($("#wbsRsltsRate").val()) >= 100) {
            $("#wbsPlanStsCodeId").val("WBSPLANSTS50");             
        }
        else if (n_date > e_date  && parseInt($("#wbsRsltsRate").val()) >= 100 ) {
            $("#wbsPlanStsCodeId").val("WBSPLANSTS40");
        }
        /////////////////////////////////////////////////////////////////////////////////
        
        if (lvl ==1) {
            wbsPlanCodeKind = "WBSDIV";
            wbsPlanCodeId = $("#wbsLevel1").val();
        }
        else if (lvl ==2) {
            wbsPlanCodeKind = $("#wbsLevel1").val();
            wbsPlanCodeId = $("#wbsLevel2").val();
        }
        else if (lvl ==3) {
            wbsPlanCodeKind = $("#wbsLevel2").val();
            wbsPlanCodeId = $("#wbsLevel3").val();
        }
        $("#fileTrgtKey").val(fileTrgtKey);
        
       // 폼데이터 생성
       var formData = new FormData($("#popForm")[0]);
       formData.append("creatId", jwt.userId); 
       $("#popForm #userId").val(jwt.userId);
       formData.append("creatPgm", $("#popForm #pgmId").val());
       // 실적 공유테이블 TODO CODE_ID
       formData.append("S_todoDiv1CodeId", "TODODIV10");
       formData.append("S_todoDiv2CodeId", "TODODIV1020");
        // 실적 결재테이블 TODO CODE_ID
       formData.append("A_todoDiv1CodeId", "TODODIV20");
       formData.append("A_todoDiv2CodeId", "TODODIV2010");
       
       formData.append("wbsPlanCodeKind", wbsPlanCodeKind);
       formData.append("wbsPlanCodeId", wbsPlanCodeId);
      
       // 실적리스트 정리
       var rowRsltsList = gridView1.target.list;
       if(rowRsltsList.length > 0) {
           var rowRsltsListArr = [];
           
           $.each(rowRsltsList, function(idx, elem){
               var rowRsltsListObj = elem;
               //debugger;
               rowRsltsListObj["wbsRsltsRate"] = elem.wbsRsltsRate;
               rowRsltsListObj["wbsAssRate"] =  elem.wbsAssRate;
               //debugger;
               if (elem.wbsRsltsCnts == undefined) {
                   rowRsltsListObj["wbsRsltsCnts"] = " ";
               }
               else {
                   rowRsltsListObj["wbsRsltsCnts"] = elem.wbsRsltsCnts;
               }
               if (elem.wbsRsltsRmk == undefined) {
                   rowRsltsListObj["wbsRsltsRmk"] = " ";
               }
               else {
                   rowRsltsListObj["wbsRsltsRmk"] = elem.wbsRsltsRmk;
               }
               rowRsltsListObj["wbsPlanMh"] =  elem.wbsPlanMh;  
               rowRsltsListObj["wbsRsltsMh"] =  elem.wbsRsltsMh; 
               rowRsltsListObj["lockYn"] =  elem.lockYn; 
               rowRsltsListObj["closeYn"] =  elem.closeYn; 
               rowRsltsListArr.push(rowRsltsListObj);           
           });
           
           formData.append("rowRsltsListArr", JSON.stringify(rowRsltsListArr));
       }       
       
       // 공유대상자 리스트
       var rowSharngList = secondGridView1.target.list;
       if(rowSharngList.length > 0) {
           var rowSharngListArr = [];
           $.each(rowSharngList, function(idx, elem){
               var rowSharngListObj = elem;
               rowSharngListObj["coCd"] = $("#coCd").val();
               rowSharngListObj["salesCd"] = elem.salesCd;
               rowSharngListObj["wbsRsltsPlanNo"] = $("#wbsRsltsNo").val();
               rowSharngListObj["wbsRsltsPlanCodeId"] = elem.wbsRsltsPlanCodeId;
               rowSharngListObj["wbsRsltsPlanCodeNm"] = elem.wbsRsltsPlanCodeNm;
               rowSharngListObj["todoCfDt"] = elem.todoCfDt;
               rowSharngListObj["todoCfOpn"] = elem.todoCfOpn;
               rowSharngListObj["wbsRsltsCoCd"] = elem.wbsRsltsCoCd;
               rowSharngListObj["wbsRsltsCoCdNm"] = elem.wbsRsltsCoCdNm;
               rowSharngListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
               rowSharngListObj["empNo"] = elem.empNo;
               rowSharngListObj["name"] = elem.name;
               rowSharngListObj["telNo"] = elem.telNo;
               rowSharngListObj["email"] = elem.email;    
               rowSharngListObj["pgPath"] = "/user/wb/wb20/WB2001P02.html";
               rowSharngListArr.push(rowSharngListObj);
           });
           formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));
       }       
       
       
       // 결재대상자 리스트
       var rowApprovalList = secondGridView2.target.list;
       if(rowApprovalList.length > 0) {
           var rowApprovalListArr = [];
           $.each(rowApprovalList, function(idx, elem){
               var rowApprovalListObj = elem;
               rowApprovalListObj["salesCd"] = elem.salesCd;
               rowApprovalListObj["wbsRsltsPlanNo"] = $("#wbsRsltsNo").val();
               rowApprovalListObj["wbsRsltsPlanCodeId"] = elem.wbsRsltsPlanCodeId;
               rowApprovalListObj["wbsRsltsPlanCodeNm"] = elem.wbsRsltsPlanCodeNm;
               rowApprovalListObj["todoCfDt"] = elem.todoCfDt;
               rowApprovalListObj["todoCfOpn"] = elem.todoCfOpn;
               rowApprovalListObj["wbsRsltsCoCd"] = elem.wbsRsltsCoCd;
               rowApprovalListObj["wbsRsltsCoCdNm"] = elem.wbsRsltsCoCdNm;
               rowApprovalListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
               rowApprovalListObj["empNo"] = elem.empNo;
               rowApprovalListObj["name"] = elem.name;
               rowApprovalListObj["telNo"] = elem.telNo;
               rowApprovalListObj["email"] = elem.email;    
               rowApprovalListObj["pgPath"] = "/user/wb/wb20/WB2001P03.html";
               rowApprovalListArr.push(rowApprovalListObj);
               
           });
           formData.append("rowApprovalListArr", JSON.stringify(rowApprovalListArr));
       } 
       
       //---------------------------------------------------------------  
       //-------itemarr  --첨부화일 처리를 위한 부분 시작
       //---------------------------------------------------------------  
       // 유저아이디 추가
       /* formData.append("userId", jwt.userId);
       formData.append("clntCd", $('#vendCd').val());          //첨부화일용
       formData.append("prdtCd", $('#prdtCd').val());          //첨부화일용
       formData.append("itemCd", $('#itemDiv').val());         //첨부화일용
       formData.append("prjctCd", $('#clntPjt').val());        //첨부화일용
        */
       
       
       
       //-------itemarr  --첨부화일 처리를 위한 부분 시작
       formData.append("comonCd", treeModule.getFileNodeId()); //첨부화일용
       
       //---------------------------------------------------------------  
       
       //---------------------------------------------------------------  
       var fileUploadArr = [];
       var tempArr = [];
       
       tempArr = treeModule.getFileArr();
       $.each(tempArr, function(idx, obj) {
           if (obj.fileKey == 0) {
               formData.append("files", obj.file);
               obj.file = '';
               fileUploadArr.push(obj);
           }
       });

       formData.append("uploadFileArr", JSON.stringify(fileUploadArr));
       formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
       //---------------------------------------------------------------  
       //--첨부화일 처리를 위한 부분 끝
       //--------------------------------------------------------------- 

       
       return formData;
   }
   
</script>
