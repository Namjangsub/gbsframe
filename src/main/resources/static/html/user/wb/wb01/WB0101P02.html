<div id="wbsPopup2" class="popup_area of_a" style="width: 100%; height: 100%;">
	<div class="tit_contents">
	    <h4 class="tit">WBS Level 2 일정계획등록</h4>
	</div>
	
	<div class="popup_table">
		<div class="form-group">
			<form id="popForm2">
			<input type="hidden" name="creatPgm2" id="creatPgm2" data-search="creatPgm" value="WB0101P02">
            <input type="hidden" name="fileTrgtKey_S2" data-search="fileTrgtKey" id="fileTrgtKey_S2">
		        <table class="popup_table">
					<colgroup>
					     <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="6%">
					</colgroup>
					
					<thead>
						<tr>
						   <td colspan="9" style="height:30px;text-align: left;">기본정보(2레벨화면)</td>	                                              
						</tr>
					</thead>
					
					<tbody>
						<!-- 1행 -->
						<tr>
							<th class="hit">회사</th>
							<td>
								<select class="form-control input-sm" id="coCd_S2" data-kind="CO" data-search="coCd" required="required">
                                   <option value="">전체</option>
                                </select>
							</td>
							<th>관리번호</th>
							<td>
								<div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsPlanNo_S2" name="wbsPlanNo_S2"  data-search="wbsPlanNo" required="required">
                                   <a onclick="openSecondWbsPlanNoSearch();"><i class="i_search_w"></i></a>
                                </div>
							</td>
							<th class="hit">작성일자</th>
							<td>
	                            <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlanDt_S2" name="wbsPlanDt_S2" data-search="wbsPlanDt" autocomplete="off" msg="작성일자" date required>
                                </div>
							</td>
							<th class="hit">작성자</th>
							<td>
								<div class="search_form">
                                    <input type="hidden" id="wbsPlanId_S2" name="wbsPlanId_S2" data-search="wbsPlanId">
                                    <input type="text" id="wbsPlanNm_S2" name="wbsPlanNm_S2" data-search="wbsPlanNm"  msg="작성자" readonly required>
                                    <a onclick="openSecondWbsPlanUserSearch();">
                                        <i class="i_search_w"></i>
                                    </a>
                                </div>
							</td>
							<th rowspan="5" style="vertical-align:top;">
                                <button type="button" class="btn btn-primary btn-sm" style="height: 25px; line-height: 15px;" onclick="file.click();" authchk>이슈등록</button>
                            </th>
						</tr>
						             
						<!-- 2행 -->
						 <tr>
						    <th>Sales Code</th>
						    <td>
							    <div class="search_form" style="width: 100%;">
	                                <input type="text" class="form-control input-sm" id="salesCd_S2" data-search="salesCd">
	                                <a onclick="openSecondWbsSalesCodeSearch();"><i class="i_search_w"></i></a>
	                            </div>
						    </td>
						    <th  class="hit">고객사</th>
						    <td>
								<div class="search_form">
                                    <input type="hidden" id="clntCd_S2" name="clntCd_S2" msg="고객사" data-search="clntCd">
                                    <input type="text" class="form-control input-sm" id="clntNm_S2" data-search="clntNm" readonly msg="고객사" required>
                                    <a onclick="openSecondClntSearch();">
                                        <i class="i_search_w"></i>
                                    </a>
                                </div>
						    </td>
						    <th>고객사PJT</th>
						    <td>
						        <input type="text" class="form-control input-sm" id="wbsClntPjt_S2" data-search="clntPjt">
						    </td>
						    <th class="hit">신작구분</th>
						    <td>
								<select id="wbsPlanDiv_S2" name="wbsPlanDiv_S2" data-kind="wbsPlanDiv_S2" data-search="wbsPlanDiv">
								<option value="">선택</option>
								</select>
						    </td>
						</tr>
						
						 <!-- 3행 -->
						 <tr>
						    <th class="hit">Lv.1</th>
						    <td>
						          <select id="wbsLevel1_S2" name="wbsLevel1_S2" data-kind="wbsLevel1_S2" data-search="wbsPlanCodeId" onchange="openSecondWbsLevel2Change();">
						          <option value="">선택</option>
                                  </select>
						    </td>
						    <th>담당자</th>
						    <td>
						        <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId_S2_1" name="wbsPlanMngId_S2_1" data-search="wbsPlanMngId">
                                    <input type="text" id="wbsPlanMngNm_S2_1" name="wbsPlanMngNm_S2_1" msg="담당자" readonly required>
                                    <a onclick="openSecondWbsLevel1PlanMngUserSearch();">
                                        <i class="i_search_w"></i>
                                </a>
                                </div>
						    </td>
						    <th class="hit">시작일자</th>
						    <td>
							    <div class="date_input">
	                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt_S2_1" data-search="wbsPlansDt"   "autocomplete="off" date>
	                            </div>
						    </td>
						    <th class="hit">종료일자</th>
						    <td>
							    <div class="date_input">
	                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt_S2_1" data-search="wbsPlaneDt"  autocomplete="off" date>
	                            </div>
						    </td>
						</tr>
						<!-- 4행 -->
                         <tr>
                            <th class="hit">Lv.2</th>
                            <td>
                                <select id="wbsLevel2_S2" name="wbsLevel2_S2" data-kind="wbsLevel2_S2" data-search="wbsPlanCodeId2">
                                <option value="">선택</option>
                                  </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId_S2_2" name="wbsPlanMngId_S2_2" data-search="wbsPlanMngId2">
                                    <input type="text" id="wbsPlanMngNm_S2_2" name="wbsPlanMngNm_S2_2" msg="담당자" readonly required>
                                    <a onclick="openSecondWbsLevel2PlanMngUserSearch();">
                                        <i class="i_search_w"></i>
                                </a>
                                </div>
                            </td>
                            <th class="hit">시작일자</th>
                            <td>
	                            <div class="date_input">
	                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt_S2_2" data-search="wbsPlansDt2"  "autocomplete="off" date>
	                            </div>
                            </td>
                            <th class="hit">종료일자</th>
                            <td>
	                            <div class="date_input">
	                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt_S2_2" data-search="wbsPlaneDt2"  autocomplete="off" date>
	                            </div>
                            </td>
                        </tr>
						<!-- 5행 -->
						 <tr>
						    <th class="hit">주요내용</th>
						    <td colspan=3>
						            <input type="text" id="wbsPlanCnts_S2" data-search="wbsPlanCnts">
						    </td>
						    <th>비고</th>
						    <td colspan=3>
						            <input type="text" id="wbsPlanRmk_S2" data-search="wbsPlanRmk">
						    </td>
						</tr>
						
						<!-- 6행 -->
						 <tr>
                            <th>외주여부</th>
                            <td>
                                <input type=radio id="wbsPlanOsYn_Y_S2" name="wbsPlanOsYn_Y_S2" value="Y" data-search="wbsPlanOsYn_Y">Y &ensp; &ensp; &ensp; &ensp; 
                                <input type=radio id="wbsPlanOsYn_N_S2" name="wbsPlanOsYn_N_S2" value="N" data-search="wbsPlanOsYn_N" checked>N <br>
                            </td>
                            <th>계획상태</th>
                            <td>
                                <select id="wbsPlanStsCodeId_S2" name="wbsPlanStsCodeId_S2" data-kind="wbsPlanStsCodeId_S2" data-search="wbsPlanStsCodeId">
                                    <option value="">선택</option>
                                </select>
                            </td>
                            
                         </tr>
						    
				    </tbody>
		        </table>	
			</form>
		</div>
	</div>
	<div class="popup_table">               
		<table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※공유 대상자</td>
                <td >
                    <div class="add_btn_small pdl10">
                        <a onclick="openSecondWbsSharngUserInsert();" style="height: 30px; line-height: 28px;" authchk>+</a>
                        <a onclick="openSecondWbsSharngUserDelete();" style="height: 30px; line-height: 28px;" authchk>-</a>
                    </div>
                </td>
            </tr>
        </table>
	</div>	    
	<div class="contents">
	    <div data-ax5grid="second-grid" data-ax5grid-config="{}" style="height: 250px; width: 100%"></div>
	</div>	
	<div class="contents">
		<!-- 첨부파일 리스트 -->
          <div class="row" style="margin-top: 15px;margin-bottom:40px;">
              <div class="col-xs-2" style="padding-right: 5px;">
                  <div class="contents" style="margin: 0; padding: 0;width: 100%; min-width: 200px">
                      <h3 class="location">
                          <span class="page_tit" style="text-align: left;"> 파일트리</span>
                      </h3>
                      <div id="treeview" style="height: 150px;padding: 5px;overflow: scroll;">
                          <div id="wbsTreeLevel2"></div>
                      </div>
                  </div>
              </div>
              <div class="col-xs-10" style="padding-left: 0;">
                  <div class="contents" style="margin: 0; padding: 0;  width: 100%; min-width: 200px">
                      <h3 class="location">
                          <a class="file_tag" id="file_tag" style="font-weight: bold; color: blue; padding-left: 20px; padding-right: 10px;"></a>
                          <span class="page_tit" id="file_tit" style="text-align: right;"> 문서현황</span>
                      </h3>
                      <button disabled type="button" id="button_file" class="" style="  background-color: gray;height: 25px; line-height: 15px;" onclick="file.click();" authchk>첨부파일</button>
                      <div class="ax5_grid" data-ax5grid="wbsTreeLevel2-grid" data-ax5grid-config="{}" style="height: 150px; width: 100%"></div>
                      </div>
              </div>
          </div>
          <!-- 첨부파일 리스트 END -->
	</div>
	         
	<button type="button" class="btn btn-default btn-sm" style="display:block"  id="actionBtn2" onclick="wbsLevel2PlanInsert();" authchk>등록</button>
	<button type="button" class="btn btn-default btn-sm" onclick="modalStack.close();">닫기</button>
</div>
    
<script type="text/javascript">
var paramFlag = modalStack.last().paramObj.flag;
var paramRpw = modalStack.last().paramObj.row;
var paramTreeObj = {};
var fileTreeKey; // 파일생성TreeKey

var wbsInsPop02GridView = {
		   initView: function(){
		       this.target = new ax5.ui.grid();
		       this.target.setConfig({
		           showRowSelector: true,
		           multipleSelect: false,
		           sortable: true,
		           target: $('[data-ax5grid="second-grid"]'),
		           header: {
		             align: "center",
		             selector: false
		           },
		           body: {
		               onClick: function () {
		                   this.self.select(this.dindex); 
		               },
		               onDBLClick: function () {
		                   this.self.clearSelect();
		                   this.self.select(this.dindex);
		               },
		          },
		          columns: [
		                {key: "rn",      label: "No.",      align: "center",   width: 130},
		                {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 130},
		                {key: "wbsPlanNo",      label: "WBS계획번호",      align: "left",   width: 130},
		                {key: "wbsPlanCodeId",      label: "계획항목코드",      hidden: true},
		                {key: "wbsPlanCodeNm",      label: "LEVEL",      align: "left",   width: 130},
		                {key: "coCd",      label: "회사",          hidden: true},
	                    {key: "coCdNm",      label: "회사명",      align: "left",   width: 130},
		                {key: "id",      label: "ID",      align: "left",   width: 130},
		                {key: "empNo",      label: "사원번호",      align: "left",   width: 130},
		                {key: "name",      label: "성명",      align: "left",   width: 130},
		                {key: "telNo",      label: "H.P",      align: "left",   width: 130},
		                {key: "email",      label: "E-Mail",      align: "left",   width: 200},
		                ]
		       });
		       return this;
		     },
		     setData: function() {
		         var targetObj = this.target;
		         var formData = {
		             "coCd" : $("#coCd_S2").val(),
		             "codeKind" : $("#wbsLevel2_S2").val(),
		             "salesCd" : $("#salesCd_S2").val(), 
		             "wbsPlanNo" : $("#wbsPlanNo_S2").val()
		         }
		         postAjax("/user/wb/wb01/selectWbsPopupSharngList", formData, null, function(data){
		             var list = data.resultList;
		             targetObj.setData({
		                  list : list,
		                  page : {
		                      totalElements : list.length
		                  }
		              });
		         }); 
		    } 
		}


$(document).ready(function() {
	
	setCommonSelect($('#wbsPopup2 select[data-kind]'));

    $('#coCd_S2').val(jwt.coCd);
    $('#wbsPlanId_S2').val(jwt.userId);
    $('#wbsPlanNm_S2').val(jwt.userNm);

    
    
    var today = new Date();
    var strDate = today.getFullYear()+"-"+('0'+(today.getMonth()+1)).slice(-2)+"-"+('0'+today.getDate()).slice(-2);
    
    // 작성일자 초기화
    $('#wbsPopup2 #wbsPlanDt_S2').datepicker({
        format : "yyyy-mm-dd",
        language : "ko",
        autoclose : true
    })
    .datepicker("setDate", strDate)

    
    
    // Level1 시작일 (현재날짜의 월 첫일)
    $('#wbsPlansDt_S2_1').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S2_1').val() > $('#wbsPlaneDt_S2_1').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlansDt_S2_1').datepicker("setDate", new Date($('#wbsPlaneDt_S2_1').val()));
              }
    });
    
    // Level1  종료일 (현재날짜의 월 말일)
    $('#wbsPlaneDt_S2_1').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S2_1').val() > $('#wbsPlaneDt_S2_1').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlaneDt_S2_1').datepicker("setDate", new Date($('#wbsPlansDt_S2_1').val()));
              }
    });
    
    
    //  Level2 시작일 (현재날짜의 월 첫일)
    $('#wbsPlansDt_S2_2').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S2_2').val() > $('#wbsPlaneDt_S2_2').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlansDt_S2_2').datepicker("setDate", new Date($('#wbsPlaneDt_S2_2').val()));
              }
    });
    
    //  Level2 종료일 (현재날짜의 월 말일)
    $('#wbsPlaneDt_S2_2').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S2_2').val() > $('#wbsPlaneDt_S2_2').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlaneDt_S2_2').datepicker("setDate", new Date($('#wbsPlansDt_S2_2').val()));
              }
    });    
    
    $("#clntNm_S2").prop('disabled',true);
    $("#wbsClntPjt_S2").prop('disabled',true);
    $("#wbsPlanDiv_S2").prop('disabled',true);
 
    $("#wbsLevel1_S2").prop('disabled',true);
    $("#wbsPlanMngNm_S2_1").prop('disabled',true);
    $("#wbsPlansDt_S2_1").prop('disabled',true);
    $("#wbsPlaneDt_S2_1").prop('disabled',true);
    


    
   //debugger;
    openSecondWbsPlanDivChange();
    openSecondWbsLevel1Change();
    openSecondWbsLevel2Change();
    openSecondWbsPlanStsChange();
   // debugger;
    var row;
    var actionBtn = document.getElementById("actionBtn2");
    if (paramFlag == "M"){
    	//등록버튼 활성화
        actionBtn.style.display = "inline-block";
        row = wbsGridView.target.getList()[paramRpw];
        
    }
    else if (paramFlag == "P") {
    	//등록버튼 활성화
        actionBtn.style.display = "inline-block";
    	row = wbsInsPop01Lvl2GridView.target.getList()[paramRpw];
    }
    // To-Do 리스트에서 팝업창 호출 처리 
    else if (paramFlag == "D") {
    	//등록버튼 비활성화
        actionBtn.style.display = "none";
        row = toDoGridView.target.getList()[paramRpw];
        if (row != undefined) {
            var formData = {
                    "coCd" : row.coCd,
                    "codeKind" : row.wbsPlanCodeKind,
                    "codeId" : row.wbsPlanCodeId,   
                    "salesCd" : row.salesCd,
                    "wbsPlanNo" : row.wbsPlanNo 
                }
            
                postAjax("/user/wb/wb01/selectWbsPlanInfoSelect", formData, null, function(data){
                    
                    paramTreeObj = {"fileTrgtKey" : data.resultList[0].fileTrgtKey};
                    treeModule.initAll('wbsTreeLevel2', 'wbsTreeLevel2-grid','FITR09', paramTreeObj);

                    $("#fileTrgtKey_S2").val(data.resultList[0].fileTrgtKey); // 파일트리키
                    $("#coCd_S2").val(data.resultList[0].coCd); // 회사
                    $("#wbsPlanNo_S2").val(data.resultList[0].wbsPlanNo); // 관리번호
                    $("#wbsPlanDt_S2").val(data.resultList[0].wbsPlanDt); // 작성일자
                    $("#wbsPlanId_S2").val(data.resultList[0].wbsPlanId); // 작성자ID
                    $("#wbsPlanNm_S2").val(data.resultList[0].wbsPlanNm);// 작성자명
                    $("#salesCd_S2").val(data.resultList[0].salesCd); // Sales Code
                    
                    $("#clntCd_S2").val(data.resultList[0].ordrsClntCd); // 고겍사ID
                    $("#clntNm_S2").val(data.resultList[0].ordrsClntNm); // 고객사명
                    $("#wbsClntPjt_S2").val(data.resultList[0].clntPjt); // 고객사PJT
                    $("#wbsPlanDiv_S2").val(data.resultList[0].ordrsDtlDiv30); // 신작구분
                    $("#wbsLevel1_S2").val(data.resultList[0].codeId.substring(0,8)); // 1Level WBS 구분
                    $("#wbsLevel2_S2").val(data.resultList[0].codeId); // 2Level WBS 구분
                    $("#wbsPlanMngId_S2_2").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                    $("#wbsPlanMngNm_S2_2").val(data.resultList[0].wbsPlanMngNm); //담당자명
                    $("#wbsPlansDt_S2_2").val(data.resultList[0].wbsPlansDt);// 시작일자
                    $("#wbsPlaneDt_S2_2").val(data.resultList[0].wbsPlaneDt); // 종료일자
                    $("#wbsPlanCnts_S2").val(data.resultList[0].wbsPlanCnts);// 주요내용
                    $("#wbsPlanRmk_S2").val(data.resultList[0].wbsPlanRmk);// 비고
                    if (row.wbsPlanOsYn == "Y"){ // 외주유무
                        $("#wbsPlanOsYn_Y_S2").prop('checked',true);
                        $("#wbsPlanOsYn_N_S2").prop('checked',false);
                    }
                    else{
                        $("#wbsPlanOsYn_Y_S2").prop('checked',false);
                        $("#wbsPlanOsYn_N_S2").prop('checked',true);
                    }
                    
                    var formData = {
                            "coCd" : $("#coCd_S2").val(),
                            "salesCd" : $("#salesCd_S2").val(),
                            "wbsPlanCodeId" : $("#wbsLevel1_S2").val()
                        }
                    
                        postAjax("/user/wb/wb01/selectWbsInfoList", formData, null, function(data){
                            $("#wbsPlanMngId_S2_1").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                            $("#wbsPlanMngNm_S2_1").val(data.resultList[0].wbsPlanMngNm); //담당자명
                            $("#wbsPlansDt_S2_1").val(data.resultList[0].wbsPlansDt); // 시작일자
                            $("#wbsPlaneDt_S2_1").val(data.resultList[0].wbsPlaneDt); // 종료일자
                        });
                }); 
           }
    }
    else {
    	//등록버튼 활성화
    	actionBtn.style.display = "inline-block";
    }
    if (row != undefined) {
    	paramTreeObj = {"fileTrgtKey" : row.fileTrgtKey};
        treeModule.initAll('wbsTreeLevel2', 'wbsTreeLevel2-grid','FITR09', paramTreeObj);
        

    	$("#fileTrgtKey_S2").val(row.fileTrgtKey); // 파일트리키
        $("#coCd_S2").val(row.coCd); // 회사
        $("#wbsPlanNo_S2").val(row.wbsPlanNo); // 관리번호
        $("#wbsPlanDt_S2").val(row.wbsPlanDt); // 작성일자
        $("#wbsPlanId_S2").val(row.wbsPlanId); // 작성자ID
        $("#wbsPlanNm_S2").val(row.wbsPlanNm);// 작성자명
        $("#salesCd_S2").val(row.salesCd); // Sales Code
        
        $("#clntCd_S2").val(row.ordrsClntCd); // 고겍사ID
        $("#clntNm_S2").val(row.ordrsClntNm); // 고객사명
        $("#wbsClntPjt_S2").val(row.clntPjt); // 고객사PJT
        $("#wbsPlanDiv_S2").val(row.ordrsDtlDiv30); // 신작구분
        $("#wbsLevel1_S2").val(row.codeId.substring(0,8)); // 1Level WBS 구분
        $("#wbsLevel2_S2").val(row.codeId); // 2Level WBS 구분
        $("#wbsPlanMngId_S2_2").val(row.wbsPlanMngId); //담당자 ID
        $("#wbsPlanMngNm_S2_2").val(row.wbsPlanMngNm); //담당자명
        $("#wbsPlansDt_S2_2").val(row.wbsPlansDt);// 시작일자
        $("#wbsPlaneDt_S2_2").val(row.wbsPlaneDt); // 종료일자
        $("#wbsPlanCnts_S2").val(row.wbsPlanCnts);// 주요내용
        $("#wbsPlanRmk_S2").val(row.wbsPlanRmk);// 비고
        if (row.wbsPlanOsYn == "Y"){ // 외주유무
        	$("#wbsPlanOsYn_Y_S2").prop('checked',true);
        	$("#wbsPlanOsYn_N_S2").prop('checked',false);
        }
        else{
            $("#wbsPlanOsYn_Y_S2").prop('checked',false);
            $("#wbsPlanOsYn_N_S2").prop('checked',true);
        }
        
        var formData = {
                "coCd" : $("#coCd_S2").val(),
                "salesCd" : $("#salesCd_S2").val(),
                "wbsPlanCodeId" : $("#wbsLevel1_S2").val()
            }
        
            postAjax("/user/wb/wb01/selectWbsInfoList", formData, null, function(data){
            	$("#wbsPlanMngId_S2_1").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                $("#wbsPlanMngNm_S2_1").val(data.resultList[0].wbsPlanMngNm); //담당자명
                $("#wbsPlansDt_S2_1").val(data.resultList[0].wbsPlansDt); // 시작일자
                $("#wbsPlaneDt_S2_1").val(data.resultList[0].wbsPlaneDt); // 종료일자
                $("#wbsPlanMngId_S2_2").val(jwt.userId); //2레벨 담당자 ID
                $("#wbsPlanMngNm_S2_2").val(jwt.userNm); //2레벨 담당자명
                
                
            });
        
        $("#coCd_S2").prop('disabled',true);
        $("#salesCd_S2").prop('disabled',true);
        //$("#wbsLevel1_S2").prop('disabled',true);
        $("#wbsLevel2_S2").prop('disabled',true);
        $("#wbsPlanNo_S2").prop('disabled',true);
    }
    else {
    	
    	$("#coCd_S2").prop('disabled',false);
        $("#salesCd_S2").prop('disabled',false);
        //$("#wbsLevel1_S2").prop('disabled',false);
        $("#wbsLevel2_S2").prop('disabled',false);
        $("#wbsPlanNo_S2").prop('disabled',false);
        
        
    	$("#wbsLevel1_S2").val(modalStack.last().paramObj.codeKind); // 1 Level WBS 구분
    	openSecondWbsLevel2Change();
    	$("#wbsLevel2_S2").val(modalStack.last().paramObj.codeId); // 2 Level WBS 구분
    	treeModule.initAll('wbsTreeLevel2', 'wbsTreeLevel2-grid','FITR09', paramTreeObj);
    	$("#salesCd_S2").val(modalStack.last().paramObj.salesCd);
    	
    	//openSecondWbsSalesCodeSearch();
    	//debugger;
    	var formData = {
                "coCd" : $("#coCd_S2").val(),
                "salesCd": $("#salesCd_S2").val()
            }
		     postAjax("/user/wb/wb01/selectWbsSalesCodeList", formData, null, function(data) {
		    	 if (data.codeInfoList != null) {
		    		 $('#salesCd_S2').val(data.codeInfoList[0].salesCd); // Sales Code
	                 $('#wbsClntPjt_S2').val(data.codeInfoList[0].clntPjt); // 고객사 PJT
	                 $('#clntCd_S2').val(data.codeInfoList[0].ordrsClntCd); // 고객사코드
	                 $('#clntNm_S2').val(data.codeInfoList[0].ordrsClntNm); // 고객사명
	                 $("#wbsPlanDiv_S2").val(data.codeInfoList[0].ordrsDtlDiv30); // 신작구분
		    	 }
		    	 
		     });
    	
    	var formData1 = {
                "coCd" : $("#coCd_S1").val(),
                "salesCd" : $("#salesCd_S2").val(),
                "wbsPlanCodeId" : $("#wbsLevel1_S2").val()
            }
        
            postAjax("/user/wb/wb01/selectWbsInfoList", formData1, null, function(data){
                $("#wbsPlanMngId_S2_1").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                $("#wbsPlanMngNm_S2_1").val(data.resultList[0].wbsPlanMngNm); //담당자명
                $("#wbsPlansDt_S2_1").val(data.resultList[0].wbsPlansDt); // 시작일자
                $("#wbsPlaneDt_S2_1").val(data.resultList[0].wbsPlaneDt); // 종료일자
                $("#wbsPlanMngId_S2_2").val(jwt.userId); //2레벨 담당자 ID
                $("#wbsPlanMngNm_S2_2").val(jwt.userNm); //2레벨 담당자명
                
            });
    }

    wbsInsPop02GridView.initView().setData(); 
});   


//관리번호 (WbsPlanNo) 검색
function openSecondWbsPlanNoSearch() {	
	var paramObj = {
	       "coCd" : $('#coCd_S2').val(),
	       "salesCd": $('#salesCd_S2').val()
	    };
	    openSecondModal("/static/html/cmn/modal/wbsPlanNoSearch.html", 450, 270, "관리번호 검색", paramObj, function (grid){
	    	var row = grid.target.getList("selected")[0];
	        $('#wbsPlanNo_S2').val(row.wbsPlanNo);
	        /* var formData = {
	                "coCd" : $("#coCd_S2").val(),
	                "wbsPlanNo" : $("#wbsPlanNo_S2").val(),
	                "wbsPlanCodeId" : $("#wbsLevel1_S2").val()
	            }
	        
	            postAjax("/user/wb/wb01/selectWbsInfoList", formData, null, function(data){
	                alert(data.resultList[0].wbsPlanMngId);
	                $("#wbsPlanMngId_S2_1").val(data.resultList[0].wbsPlanMngId); //담당자 ID
	                $("#wbsPlanMngNm_S2_1").val(data.resultList[0].wbsPlanMngNm); //담당자명
	                $("#wbsPlansDt_S2_1").val(data.resultList[0].wbsPlansDt.format("yyyy-mm-dd"));// 시작일자
	                $("#wbsPlaneDt_S2_1").val(data.resultList[0].wbsPlaneDt.format("yyyy-mm-dd")); // 종료일자
	            }); */
	        
	    });
}


//작성자 검색
function openSecondWbsPlanUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S2').val(),
        "userId": $('#wbsPopup2 #wbsPlanId_S2').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "작성자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup2 #wbsPlanId_S2').val(checkedNode.id);
        $('#wbsPopup2 #wbsPlanNm_S2').val(checkedNode.text);
    });
}

//Level1 담당자 검색
function openSecondWbsLevel1PlanMngUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S2').val(),
        "userId": $('#wbsPopup2 #wbsPlanId_S2_1').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup2 #wbsPlanMngId_S2_1').val(checkedNode.id);
        $('#wbsPopup2 #wbsPlanMngNm_S2_1').val(checkedNode.text);
    });
}

//Level2 담당자 검색
function openSecondWbsLevel2PlanMngUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S2').val(),
        "userId": $('#wbsPopup2 #wbsPlanId_S2_2').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup2 #wbsPlanMngId_S2_2').val(checkedNode.id);
        $('#wbsPopup2 #wbsPlanMngNm_S2_2').val(checkedNode.text);
    });
}

//Sales Code (수주마스터, 수주상세테이블 조인) 검색
function openSecondWbsSalesCodeSearch() {
    var paramObj = {
       "coCd" : $('#coCd_S2').val(),
       "salesCd": $('#salesCd_S2').val()
    };
    openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 330, "SALES CODE 검색", paramObj, function (grid){
        var row = grid.target.getList("selected")[0];
        $('#salesCd_S2').val(row.salesCd); // Sales Code
        $('#wbsClntPjt_S2').val(row.clntPjt); // 고객사 PJT
        $('#clntCd_S2').val(row.ordrsClntCd); // 고객사코드
        $('#clntNm_S2').val(row.ordrsClntNm); // 고객사명
        $("#wbsPlanDiv_S2").val(row.ordrsDtlDiv30); // 신작구분
    });
}

// 고객사 검색
function openSecondClntSearch(type) {
    openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "고객사 검색", {}, function (grid) {
        var row = grid.target.getList("selected")[0];
        $('#wbsPopup2 #clntCd_S2').val(row.clntCd);
        $('#wbsPopup2 #clntNm_S2').val(row.clntNm);
    });
}

//신작구분
function openSecondWbsPlanDivChange() {
    var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsPlanDivList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="wbsPlanDiv"]').html(optionHtml);
    });
}

//WBS LEVEL 1 구분
function openSecondWbsLevel1Change() {
    var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsLevel1List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel1_S2"]').html(optionHtml);
    });
}

//WBS LEVEL 2 구분
function openSecondWbsLevel2Change() {
    var paramObj = {"codeKind" : $('#wbsLevel1_S2').val()};
   // alert($('#wbsLevel1_S2').val());
    postAjaxSync("/user/wb/wb01/selectWbsLevel2List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel2_S2"]').html(optionHtml);
       
    });
}

//WBS 계획상태  WBS_PLAN_STS_CODE_ID
function openSecondWbsPlanStsChange() {
    //DSGN_DIF_CODE_ID
    var paramObj = {"codeKind" : "WBSPLANSTS"};
    postAjaxSync("/user/wb/wb01/selectWbsPlanStsList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="wbsPlanStsCodeId"]').html(optionHtml);
        
    });
}


//공유대상자 삭제
function openSecondWbsSharngUserDelete() {
    var row = wbsInsPop02GridView.target.getList("selected")[0];
    if (row == null) {
        alert("삭제할 행을 선택하세요");
        return;
    }
    
    var formData = {
        "coCd" : row.coCd,
        "salesCd" : row.salesCd,
        "wbsPlanNo" : row.wbsPlanNo,
        "wbsPlanCodeId" : row.wbsPlanCodeId,
        "id" : row.id 
    }
    if(confirm("삭제하시겠습니까?")){
        deleteAjax("/user/wb/wb01/deleteWbsSharngUser", formData, null, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                wbsInsPop02GridView.initView().setData(); 
            }
        });
    }   
}

//공유대상자 등록
function openSecondWbsSharngUserInsert() {
    var wbsSharngUserId = "";
    if ($('#coCd_S2').val() == ""){
        alert("회사를 입력하세요");
        return;
    }
    
    if ($('#salesCd_S2').val() == ""){
        alert("Sales Code를 입력하세요");
        return;
    }
    if ($('#wbsPlanNo_S2').val() == ""){
        alert("관리번호를 입력하세요");
        return;
    }
    
    var paramObj = {
            "coCd" : $('#coCd_S2').val(),
            "userId": wbsSharngUserId,
            "useYn": "Y"
        };
    
    openThirdModal("/static/html/cmn/modal/userSearch.html", 300, 500, "공유대상자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        wbsSharngUserId = checkedNode.id;

        var formData = new FormData($('#wbsPopup #popForm2')[0]);
        formData.append("coCd", $('#coCd_S2').val());
        formData.append("salesCd", $('#salesCd_S2').val());
        formData.append("wbsPlanNo", $('#wbsPlanNo_S2').val());
        formData.append("wbsLevel", $('#wbsLevel2_S2').val().substring(0,8));
        formData.append("wbsLevel1", $('#wbsLevel2_S2').val());
        formData.append("wbsSharngUserId", wbsSharngUserId);
        formData.append("pgPath", "/user/wb/wb01/WB0101P02.html");
        formData.append("creatId", jwt.userId);
        formData.append("creatPgm", $('#creatPgm2').val());
        formData.append("toDoKey", 0);

        filePostAjax("/user/wb/wb01/insertWbsSharngUser", formData, function(data){
           alert(data.resultMessage);  
           if(data.resultCode == 200) {
               wbsInsPop02GridView.initView().setData(); 
           }
        });         
    });    
     
}

function wbsLevel2PlanInsert(){
    //debugger;
    //var wbsPlanOsYn = "";
    if (paramRpw == undefined){
        var strYear = new Date().toISOString().substring(2, 4);
        var planData = {
        		"coCd" : $('#coCd_S2').val(),
                "year" : "S" + strYear
            }; 
         postAjaxSync("/user/wb/wb01/selectMaxWbsPlanNo", planData, null, function(data){
        	 var strLen = String(data.result);
        	 
            if (data.result == undefined) {
                $('#wbsPlanNo_S2').val("S" + strYear + "0001");
            }
            else {
                if (strLen.length == 1) {
                    $('#wbsPlanNo_S2').val("S" + strYear + "000" + data.result); 
                    }
                else if (strLen.length == 2) {
                    $('#wbsPlanNo_S2').val("S" + strYear + "00" + data.result); 
                }
                else if (strLen.length == 3) {
                    $('#wbsPlanNo_S2').val("S" + strYear + "0" + data.result); 
                }
                else if (strLen.length == 4) {
                    $('#wbsPlanNo_S2').val("S" + strYear + data.result); 
                }
            }
            
        }); 
        if (wbsPlanOsYn_Y_S2.checked){
            wbsPlanOsYn = "Y";
        }
        else if (wbsPlanOsYn_N_S2.checked){
            wbsPlanOsYn = "N";
        }
        
        if ($('#coCd_S2').val() == "") {
            alert("회사를 선택하세요");
            return;
        }
        
        if ($('#wbsPlanId_S2').val() == "") {
            alert("작성자를 입력하세요");
            return;
        }
        
        if ($('#salesCd_S2').val() == "") {
            alert("Sales Code를 입력하세요");
            return;
        }
        
        if ($('#clntCd_S2').val() == "") {
            alert("고객사를 입력하세요");
            return;
        } 
        
        if ($('#wbsPlanCnts_S2').val() == "") {
            alert("주요내용를 입력하세요");
            return;
        } 
        
        //debugger;
/*         var formData = new FormData();
        $.each($('#wbsPopup2 [data-search]'), function(idx, elem){
            formData.append($(elem).data("search"), $(elem).val());
        });
        
        formData.append("creatId", jwt.userId);
        formData.append("wbsPlanOsYn", wbsPlanOsYn);
        formData.append("wbsPlanCodeKind2", $('#wbsLevel1_S2').val());
        formData.append("wbsPlanCodeId2", $('#wbsLevel2_S2').val());
         
         filePostAjax("/user/wb/wb01/wbsLevel2PlanInsert", formData, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                modalStack.close();
                wbsGridView.setData(0);
                if (paramFlag == "P") {
                	wbsInsPop01Lvl2GridView.setData(0);
                }
            }
        });   */
        
        
        /* WBS 데이터 중복 체크 조회 */
        var paramObj = {
                "coCd" : $('#coCd_S2').val(),
                "salesCd" : $('#salesCd_S2').val(),
                "codeId" : $('#wbsLevel2_S2').val()
          };  
        
        var chk;
        postAjaxSync("/user/wb/wb01/selectWbsPlanChk", paramObj, null, function(data){ 
            chk = data.result;
        });
        
        if (chk <= 0) {
            var formData;
            /* 파일업로드를 위한 FielTreeKey Max값 조회 */
            postAjaxSync("/user/wb/wb01/selectMaxTrgtKey", paramObj, null, function(data){    
                fileTreeKey = data.result;
                //alert(fileTreeKey);
                formData = makeFormData(fileTreeKey);
                
            }); 
            filePostAjax("/user/wb/wb01/wbsLevel2PlanInsert", formData, function(data){
                //debugger;
                if(data.resultCode == 200){
                    alert(data.resultMessage);
                    modalStack.close();
                    wbsGridView.setData(0); 
                }
            });  
            
        }
        else {
            alert("WBS 데이터가 존재합니다.");
            return;
            //modalStack.close();
        }
        
    }
    else {
        if (wbsPlanOsYn_Y_S2.checked){
            wbsPlanOsYn = "Y";
        }
        else if (wbsPlanOsYn_N_S2.checked){
            wbsPlanOsYn = "N";
        }
        
        if ($('#coCd_S2').val() == "") {
            alert("회사를 선택하세요");
            return;
        }
        
        if ($('#wbsPlanId_S2').val() == "") {
            alert("작성자를 입력하세요");
            return;
        }
        
         if ($('#salesCd_S2').val() == "") {
            alert("Sales Code를 입력하세요");
            return;
        }
        
        if ($('#clntCd_S2').val() == "") {
            alert("고객사를 입력하세요");
            return;
        } 
        
        if ($('#wbsPlanCnts_S2').val() == "") {
            alert("주요내용를 입력하세요");
            return;
        } 
        
/*         var formData = new FormData();
        $.each($('#wbsPopup2 [data-search]'), function(idx, elem){
            formData.append($(elem).data("search"), $(elem).val());
        });
        
        formData.append("creatId", jwt.userId);
        formData.append("wbsPlanOsYn", wbsPlanOsYn);
        formData.append("wbsPlanCodeKind2", $('#wbsLevel1_S2').val());
        formData.append("wbsPlanCodeId2", $('#wbsLevel2_S2').val());
        
        filePutAjax("/user/wb/wb01/wbsLevel2PlanUpdate", formData, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                modalStack.close();
                wbsGridView.setData(0); 
            }
        }); */
         
        formData = makeFormData($("#fileTrgtKey_S2").val());
        filePutAjax("/user/wb/wb01/wbsLevel2PlanUpdate", formData, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                modalStack.close();
                wbsGridView.setData(0); 
            }
        });
    }   
}

function makeFormData(fileTreeKey) {
    //debugger;
    $('#fileTrgtKey_S2').val(fileTreeKey);
   
    var formData = new FormData();
    $.each($('#wbsPopup2 [data-search]'), function(idx, elem){
        formData.append($(elem).data("search"), $(elem).val());
    });
    
    formData.append("creatId", jwt.userId);
    formData.append("wbsPlanOsYn", wbsPlanOsYn);
    
    // 유저아이디 추가
    formData.append("userId", jwt.userId);
    
     formData.append("fileTrgtKey", fileTreeKey);
    
    
    // 첨부파일 추가
    $.each(treeModule.getFileArr(), function (idx, obj) {
        // 신규파일만 추가
        if (obj.fileKey == 0) {
            formData.append("comonCd_" + idx, obj.nodeId);
            formData.append("files", obj.file);
        }
    });

    formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
    treeModule.initFileArrays(); 
    // 첨부파일 추가
    return formData;
}

</script>
