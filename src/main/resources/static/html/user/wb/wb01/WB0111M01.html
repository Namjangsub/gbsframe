<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="/static/fontawesome/css/all.css">
<link rel="stylesheet" href="/static/css/ax5/ax5grid.css">
<link rel="stylesheet" href="/static/css/ax5/ax5mask.css">
<link rel="stylesheet" href="/static/css/ax5/ax5modal.css">
<link rel="stylesheet" href="/static/css/ax5/ax5toast.css">
<link rel="stylesheet" href="/static/css/ax5/ax5menu.css">
<link rel="stylesheet" href="/static/css/ax5/ax5calendar.css">
<link rel="stylesheet" href="/static/css/jstree/style.min.css">
<link rel="stylesheet" href="/static/css/ax5/ax5combobox.css">
<link rel="stylesheet" href="/static/css/gnb.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/sub.css">
<link rel="stylesheet" href="/static/css/common.css">

<script src="/static/js/jquery-latest.min.js"></script>
<script src="/static/js/jquery.serializeObject.js"></script>
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
<script src="/static/js/moment/moment-with-locales.js"></script>
<script src="/static/js/jstree/jstree.min.js"></script>
<script src="/static/js/ax5/ax5core.min.js"></script>
<script src="/static/js/ax5/ax5grid.min.js"></script>
<script src="/static/js/ax5/ax5mask.min.js"></script>
<script src="/static/js/ax5/ax5modal.min.js"></script>
<script src="/static/js/ax5/ax5toast.min.js"></script>
<script src="/static/js/ax5/ax5calendar.min.js"></script>
<script src="/static/js/ax5/ax5picker.min.js"></script>
<script src="/static/js/ax5/ax5menu.min.js"></script>
<script src="/static/js/ax5/ax5formatter.min.js"></script>
<script src="/static/js/ax5/ax5combobox.min.js"></script>

<script src="/static/js/global.js"></script>
<script src="/static/js/fileTree.js"></script>

</head>

<body>
	<div id="head_area"></div>
	<div id="top_area"></div>
	
	<div id="main_area">
		<!-- 페이지 상단 -->
		<div class="contents no_bg">
			<ul class="btn_ul">
				<li class="btn_r">
					 <a onclick="initSearch();"><button class="bg_gray">초기화</button></a>
					 <a onclick="salesGridView.setData(0);"><button class="bg_gray">검 색</button></a>
	            </li>
            </ul>
        </div>
    
		<!-- 검색 콘텐츠 -->
		<div class="contents search">
			<div class="">
				<!-- 테이블 인풋 3분할 -->
				<table class="table_input type04">
				
					<!-- 검색조건 1행 -->
					<tr>
						<th class= "hit">회사</th>
						<td>
							<select id="coCd_S" name="coCd_S" data-kind="CO" data-search="coCd" required msg="회사">
						      <option value="">전체</option>
							</select>
						</td>
						
						<th class= "hit">Sales Code</th>
						<td>
	                         <div class="search_form">
                                <input type="text" id="salesCd_S" name="salesCd_S" data-search="salesCd" onkeyup="event.keyCode == 13 ? salesGridView.setData(0) : ''">
                                <a onclick="wbsSalesCodeSearchM();"><i class="i_search_w"></i></a>
                            </div>
                            <input type="hidden" id="salesNm_S" name="salesNm_S" >
						</td>
						
						<th>&nbsp;</th>
						<td>&nbsp;</td>
						
						<th></th>
						<td>
						   
						</td>
					</tr>
		            <!-- 검색조건 END -->
	            </table>
	            <input type="hidden" id="userId"    name="userId">
                <input type="hidden" id="pgmId"     name="pgmId" value="WB0111M01">
            </div>
        </div>
        <!-- 콘텐츠 -->
		<div class="contents no_bg">
		      <div class="contents_tit">
		        <div class="add_btn_small pdl10">
		          <a onclick="wbsPlanProcInsertModal();" style="height: 30px; line-height: 28px; width: 100px;">WBS계획공정(+)</a>
		          <a onclick="deleteWbsPlanList();" style="height: 30px; line-height: 28px; width: 100px;">WBS계획공정(-)</a>
                  <a onclick="lockYn();" style="height: 30px; line-height: 28px; width: 60px;">계획잠금</a>
                  <a onclick="unLockYn();" style="height: 30px; line-height: 28px; width: 70px;">계획잠금취소</a>
                  <a onclick="deleteWbsPlan();" style="height: 30px; line-height: 28px; width: 60px;">계획삭제</a>
                  <a onclick="closeYn();" style="height: 30px; line-height: 28px; width: 60px;">실적마감</a>
                  <a onclick="unCloseYn();" style="height: 30px; line-height: 28px; width: 70px;">실적마감취소</a>
                  <a onclick="deleteWbsRslts();" style="height: 30px; line-height: 28px; width: 60px;">실적삭제</a>
		          <a onclick="excelDown();" style="height: 30px; line-height: 28px; width: 90px;"><i class="fas fa-file-excel"></i> 엑셀다운로드</a>
		          
		        </div>
		        <select id="recordCnt" class="prae_select" onchange="salesGridView.setData(0);">
		          <option value="10">10</option>
		          <option value="20" >20</option>
		          <option value="50">50</option>
		          <option value="100">100</option>
		          <option value="9999999" selected>전체</option>
		        </select> 
        </div>

		
		<!-- 콘텐츠 -->

    <div class="row" style="margin-top: 15px;">
      <div class="col-xs-4" style="padding-right: 5px;">
        <div class="contents" style="margin: 0px; padding: 0px; height: 700px; width: 100%; min-width: 200px">
		      <div class="ax5_grid" data-ax5grid="sales-grid" data-ax5grid-config="{}" style="height: 700px; width: 100%" ></div>            
        </div>
      </div>
      <div class="col-xs-8" style="padding-left: 0;">
		<div class="contents">
		    <!-- 리스트 -->
		      <div class="ax5_grid" data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 700px; width: 100%" ></div>
		      <div data-ax5grid="excel-grid" data-ax5grid-config="{}" style="display: none;"></div>
		</div>
      </div>
    </div>		
		
		
		
		
    </div>
                    
</body>
</html>

<script type="text/javascript">
    var salesCd = null;
    var ordrsNo = null;
	var isFirst = true;
	var beforeIndex ='';
	var planCnt = null;
	
	ax5.ui.grid.formatter["chkYn"] = function () {
	    var color = this.value == "Y" ? "color-circle_02.png" : "color-circle_01.png";
	    if (this.value == "E"){
	        return ' ';
	    } else {
	        return '<img src="/static/img/'+color+'" style="width: 10px;height: 10px;"></img>';
	    }
	};
	var salesGridView = {
		    initView : function() {
		        this.target = new ax5.ui.grid();
		        this.target.setConfig({
			        showLineNumber: false,
					showRowSelector : true,
					multipleSelect : true,
					sortable : false,
		            target: $('[data-ax5grid="sales-grid"]'),
		            header : {
		                align : "center",
		                selector : true
		            },
		            body: {
		            	mergeCells : ["ordrsClntNm","ordrsNo","salesCd"],
		            	columnHeight: 26,
		                onClick: function () {
		                	var list = salesGridView.target.getList("selected");
                            $.each(list, function(idx, obj){
                            	salesGridView.target.select(obj.__origin_index__, {selected: false});
                            });		                	
		                    this.self.select(this.dindex);
		                    //if (this.item.dataGbn == 'D') {
		                    	salesCd = this.item.salesCd;
		                    	ordrsNo = this.item.ordrsNo;
		                    	planCnt = this.item.planCnt;
			                    gridView.setData(0, this.item.salesCd, this.item.ordrsNo);
		                    //}
		                    
		                },
		                onDBLClick: function () {
		                	var list = salesGridView.target.getList("selected");
                            $.each(list, function(idx, obj){
                            	salesGridView.target.select(obj.__origin_index__, {selected: false});
                            })		                	
		                    this.self.select(this.dindex);
		                    //if (this.item.dataGbn == 'D') {
		                    	salesCd = this.item.salesCd;
		                    	ordrsNo = this.item.ordrsNo;
			                    gridView.setData(0, this.item.salesCd, this.item.ordrsNo);
			                    planCnt = this.item.planCnt;
		                    //}
		                    
		                },
		                onDataChanged: function () {
		                	var list = salesGridView.target.getList("selected");
                            $.each(list, function(idx, obj){
                                salesGridView.target.select(obj.__origin_index__, {selected: false});
                            })                          
                            this.self.select(this.dindex);
                            //if (this.item.dataGbn == 'D') {
                                salesCd = this.item.salesCd;
                                ordrsNo = this.item.ordrsNo;
                                gridView.setData(0, this.item.salesCd, this.item.ordrsNo);
                                planCnt = this.item.planCnt;
                            //}
                        }
		                
		           },
		           columns: [
		        	   {key: "pid",  			label: "pid", 		hidden: true},
		               {key: "id",  			label: "id", 		width: 160, hidden: true},
		               {key: "coCd",            label: "회사",       hidden: true},                       
		               {key: "ordrsClntNm",		label: "고객사",		width: 100, align: "left"},
		               {key: "ordrsNo",  		label: "오더번호", 	width: 100, hidden: true, align: "left"},
		               {key: "salesCd",  		label: "SALES CD", 	width: 200, hidden: false, align: "left",  treeControl: true},
		               {key: "planCnt",  		label: "계획/실적", 	width: 60, hidden: false, align: "center", formatter: function () {
		            	   return this.item.dataGbn=='D' ? this.value + '/'+this.item.rsultCnt : ''}},
// 		               {key: "rsultCnt",  		label: "실적", 	width: 100, hidden: false, align: "center"},
					   {label: "계획", columns: [  
				               {key: "planLockYn",  		label: "잠금", 	width: 35, align: "center", formatter: "chkYn"},  
				               {key: "planCloseYn",  		label: "마감", 	width: 35, align: "center", formatter: "chkYn"},
				       ]},
					   {label: "실적", columns: [  
				               {key: "rsultLockYn",  		label: "잠금", 	width: 35, align: "center", formatter: "chkYn"},  
				               {key: "rsultCloseYn",  		label: "마감", 	width: 35, align: "center", formatter: "chkYn"},  
				       ]},
		               {key: "dataGbn",  		label: "원시구분", 	width: 80, hidden: false},
		           ],
		           page : {
	                    navigationItemCount : 10,
	                    height : 30,
	                    display : true,
	                    firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
	                    prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
	                    nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
	                    lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
	                    onChange : function() {
	                    	salesGridView.setData(this.page.selectPage);
	                    }
	                },
	                tree: {
	                    use: true,
	                    indentWidth: 15,
	                    arrowWidth: 15,
	                    iconWidth: 18,
	                    icons: {
	                        openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
	                        collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
	                        groupIcon: '<i class="fa fa-folder-open" aria-hidden="true"></i>',
	                        collapsedGroupIcon: '<i class="fa fa-folder" aria-hidden="true"></i>',
	                        itemIcon: '<i class="fa fa-file" aria-hidden="true"></i>'
	                    },
		               columnKeys: {
		                   parentKey: "pid",
		                   selfKey: "id",
		               }
		           }
		        });
		        return this;
		    },
		    setData : function(_pageNo) {
	            var targetObj = this.target;
    			var paramObj = {
    					"coCd": $('#coCd_S').val(),
    					"salesCd": $('#salesCd_S').val(),
    					"pageNo" : _pageNo + 1,
                        "recordCnt" : $('#recordCnt').val()};
	            postAjax("/user/wb/wb01/selectWbsLeftSalesCodeList", paramObj, null, function(data){
	            	 var list = data.fileList;
	                    targetObj.setData({
	                        list : list,
	                        page : {
	                        	currentPage : _pageNo,
                                pageSize : data.paginationInfo.pageSize,
                                totalElements : data.paginationInfo.totalRecordCount,
                                totalPages : data.paginationInfo.totalPageCount
	                        }
	                    });
	            });
	        } 
		    
		}
		var gridView = {
		    initView : function() {
		        this.target = new ax5.ui.grid();
		        this.target.setConfig({
		        	showRowSelector: true,
		            multipleSelect: true,
		            sortable: false,
		            target: $('[data-ax5grid="first-grid"]'),
		            header : {
		                align : "center",
		                selector : false
		            },
		           columns: [
						{key: "rnum",  label: "NO.", hidden:true},
						{key: "lvl",  label: "lvl", hidden:true},
						{key: "codeId",  label: "codeId", align: "left", width: 200, hidden:true, treeControl: true},
						{key: "codeKind",  label: "codeKind", hidden:true},
						{key: "coCd",  label: "회사코드", hidden:true},
						{key: "coCdNm",  label: "회사명", width: 80, hidden:true, align: "center"},
						{key: "salesCd",  label: "SALES CD", width: 100, hidden:true, align: "center"},
						{key: "codeNm",  label: "WBS 계획구분", align: "left", width: 200,  treeControl: true},

	        	   		{key: "fileTreeKey",  		label: "fileTreeKey", hidden:true},
	        	   		{key: "wbsPlanNo",  		label: "wbsPlanNo", hidden:true},
						{key: "wbsPlanStsCodeId",	label: "계획상태코드",   hidden: true},
	        	   		{key: "rsltsFileTrgtKey",  	label: "rsltsFileTrgtKey", hidden:true},
	        	   		{key: "rsltsWbsPlanNo",  	label: "rsltsWbsPlanNo", hidden:true},
						{key: "wbsPlanId",			label: "담당자",      hidden:true},
						{key: "wbsPlanNm",            label: "담당자",      hidden:true},
						{key: "wbsPlanDt",            label: "담당자",      hidden:true},
						{key: "wbsPlanStsNm",		label: "계획상태",      hidden:true}, 
						{key: "wbsPlanMngId",     label: "담당자",      hidden:true}, 
						{key: "wbsPlanMngNm",     label: "담당자",      align: "center",   width: 80}, 
						{key: "wbsPlanCnts",      label: "주요내용",      align: "left",   width: 100},
                        {key: "wbsPlanRmk",      label: "비고",      align: "left",   width: 100},    
						{label: "계획", columns: [  
							{key: "wbsPlanChkYn",		label: "계획",      align: "center",   width: 40, formatter: "chkYn"},  
							{key: "wbsPlansDt",			label: "시작일자",      align: "center",   width: 80},
							{key: "wbsPlaneDt",			label: "종료일자",      align: "center",   width: 80},
							{key: "lockYn",      		label: "잠금",      align: "center",   width: 40, formatter: "chkYn"},
							{key: "closeYn",      		label: "마감",      align: "center",   width: 40, formatter: "chkYn"},
							]},
						{label: "실적", columns: [ 
							{key: "wbsRsltsChkYn",      label: "실적",      align: "center",   width: 40, formatter: "chkYn"},  
							{key: "wbsRsltsRate",		label: "진행율",      align: "center",   width: 60},                   
							{key: "wbsRsltssDt",		label: "시작일자",      align: "center",   width: 80},
							{key: "wbsRsltseDt",		label: "종료일자",      align: "center",   width: 80},
							{key: "rsltsLockYn",      	label: "잠금",      align: "center",   width: 40, formatter: "chkYn"},
							{key: "rsltsCloseYn",      	label: "마감",      align: "center",   width: 40, formatter: "chkYn"},
							{key: "wbsPlanMh",			label: "계획공수",      align: "center",   width: 80},                   
							{key: "wbsRsltsMh",			label: "실적공수",      align: "center",   width: 80},
							{key: "wbsRsltsCnts",      label: "주요내용",      align: "left",   width: 100},
	                        {key: "wbsRsltsRmk",      label: "비고",      align: "left",   width: 100},    
						]},
						{key: "wbsRsltsId",			label: "담당자",      align: "center",   width: 80},                   
						{key: "wbsRsltsDt",			label: "실적일자",      align: "center",   width: 80},
						{key: "ordrsClntCd",      label: "고객사",     hidden: true},
						{key: "ordrsClntNm",      label: "고객사",      align: "center",   width: 130},
						{key: "clntPjt",      label: "고객사PJT",      align: "center",   width: 100},
						{key: "ordrsDtlDiv20",      label: "신작구분",      hidden: true},
						{key: "ordrsDtlDiv20Nm",      label: "신작",      align: "center",   width: 40},
						{key: "prdtCd",      label: "제품구분",      hidden: true},
						{key: "prdtCdNm",      label: "제품",      align: "center",   width: 130},
						{key: "itemDiv",      label: "ITEM구분",      hidden: true},
						{key: "itemDivNm",      label: "ITEM",      align: "center",   width: 100},	 
						
						{key: "creatId",      label: "생성자", align: "center",   width: 80},
                        {key: "creatPgm",      label: "생성프로그램ID",      hidden: true},
                        {key: "creatDttm",      label: "생성일시",      align: "center",   width: 80},                   
                        {key: "udtId",      label: "최종변경자",      align: "center",   width: 80},
                        {key: "udtPgm",      label: "최종수정프로그램ID",      hidden: true},
                        {key: "udtDttm",      label: "최종변경일자",      align: "center",   width: 80},
                        
                        {key: "pTodoCfDt",      label: "TODO계획",      align: "center",   width: 110},
                        {key: "rTodoCfDt",      label: "TODO실적",      align: "center",   width: 110},
                                                
                        {key: "dsgnDifCodeId",      label: "설계난이도코드",      hidden: true},
						{key: "dsgnDifCodeNm",      label: "설계난이드명",      hidden: true},
						{key: "dsgnPlanHour",      label: "설계계획공수",      hidden: true},                   
						{key: "prdctnDifCodeId",      label: "생산난이도코드",      hidden: true},
						{key: "prdctnDifCodeNm",      label: "생산난이도명",      hidden: true},
						{key: "prdctnPlanHour",      label: "생산계획공수",      hidden: true},                   
						{key: "wbsPlanOsYn",      label: "계획외주코드",      hidden: true},
						{key: "wbsPlanOsNm",      label: "계획외주유무",      hidden: true},   
						{key: "wbsPlanCodeKind",      label: "WBS 상위코드",    hidden: true},
						{key: "wbsPlanCodeId",      label: "WBS 코드",      hidden: true},
						{key: "wbsPlanNo",      label: "WBS NO",      hidden: true},
						{key: "isLeaf", label: "isLeaf", align: "left", width: 60, hidden: true },
		           ],
		            body: {
		            	mergeCells : ["coCdNm","salesCd"],
		                columnHeight: 26,
 		                onClick: function () {
 		                },
 		                
		                onDBLClick: function () {
		                	/* if (beforeIndex) {
		                		this.self.select(beforeIndex);
		                	}
		                    this.self.select(this.dindex); */
		                    //debugger;
		                    if (
		                        this.column.key=='coCdNm' ||
		                        this.column.key=='salesCd' ||
		                        this.column.key=='codeNm' ||
		                        this.column.key=='wbsPlanMngNm' ||
		                        this.column.key=='wbsPlanCnts' ||
		                        this.column.key=='wbsPlanRmk' ||
		                    	this.column.key=='wbsPlanChkYn' ||
		                    	this.column.key=='wbsPlansDt' || 
		                    	this.column.key=='wbsPlaneDt' || 
		                    	this.column.key=='lockYn' || 
		                    	this.column.key=='closeYn') {
		                    	//계획 입력 또는 수정 작업
		                    	if (this.item.codeId.length > 6) {
		                    	    var insUpd = this.item.fileTrgtKey ? 'U' : 'C';
		                    	    if (insUpd == "C") {
		                    	    	if (this.item.codeId.length > 8 && pChk(this.item.codeKind)) {
	                                        alert("상위레벨을 등록해 주세요");
	                                        return;
	                                    }
		                    	    }
		                    	    else if (insUpd == "U") {
		                    	    	if (this.item.lockYn == "Y" || this.item.closeYn == "Y" ) {
                                            alert("WBS 계획이 잠금 또는 마감 되었습니다.");
                                            return;
                                        }
		                    	    }
                                    insertWbsPlanModal(insUpd, this.item.lvl-1, this.dindex);
		                    	}
							} else if (
									this.column.key=='wbsRsltsChkYn' ||
			                    	this.column.key=='wbsRsltsRate' || 
			                    	this.column.key=='wbsRsltssDt' || 
			                    	this.column.key=='wbsRsltseDt' || 
			                    	this.column.key=='rsltsLockYn' || 
			                    	this.column.key=='rsltsCloseYn' || 
			                    	this.column.key=='wbsPlanMh' || 
			                    	this.column.key=='wbsRsltsMh') {
								//실적 입력 또는 수정 작업
								if (this.item.codeId.length > 6) {
					                    var insUpd = this.item.rsltsFileTrgtKey ? 'U' : 'C';
					                    if (insUpd == "C") {
					                    	if (this.item.wbsPlanChkYn == "N") {
                                                alert("WBS 계획 일정을 먼저 등록해 주세요");
                                                return;
                                            }
					                    	if (this.item.codeId.length > 8 && rChk(this.item.codeKind)) {
	                                            alert("상위레벨을 등록해 주세요");
	                                            return;
	                                        }	                                        
	                                    }
					                    else if (insUpd == "U") {
	                                        if (this.item.rsltsLockYn == "Y" || this.item.rsltsCloseYn == "Y" ) {
	                                            alert("WBS 실적이 잠금 또는 마감 되었습니다.");
	                                            return;
	                                        }
	                                    }
					                    insertWbsRsltsModal(insUpd, this.item.lvl-1, this.dindex);
								}
							}
		                    
		                    beforeIndex = this.dindex;
		                },
		                onDataChanged: function () {
		                	if (this.item.lvl == 1) {
                                //alert("0레벨은 선택할 수 없습니다.");
                                this.self.updateChildRows(this.dindex, {__selected__: false});
                                return;
                            }
                            else if (this.item.lvl == 4) {
                                //alert("4레벨은 선택할 수 없습니다.");
                                this.self.updateChildRows(this.dindex, {__selected__: false});
                                return;
                            }
                            
                            this.self.updateChildRows(this.dindex, {isChecked: this.item.__selected__});
                            this.self.updateChildRows(this.dindex, {__selected__: this.item.__selected__});
		                }
		           },
		           page : {
	                    navigationItemCount : 10,
	                    height : 30,
	                    use : true,
	                    firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
	                    prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
	                    nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
	                    lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
	                    onChange : function() {
	                        gridView.setData(this.page.selectPage, salesCd, ordrsNo);
	                    }
	                },
	                tree: {
	                    use: true,
	                    indentWidth: 15,
	                    arrowWidth: 15,
	                    iconWidth: 18,
	                    icons: {
	                        openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
	                        collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
	                        groupIcon: '<i class="fa fa-folder-open" aria-hidden="true"></i>',
	                        collapsedGroupIcon: '<i class="fa fa-folder" aria-hidden="true"></i>',
	                        itemIcon: '<i class="fa fa-file" aria-hidden="true"></i>'
	                    },
		               columnKeys: {
		                   parentKey: "codeKind",
		                   selfKey: "codeId",
		               }
		           }
		        });
		        return this;
		    },
		    setData : function(_pageNo, paramSalesCode, paramOrdrsNo) {
		    	if (isFirst) return;
	            var targetObj = this.target;
	            var paramObj = {"coCd": $('#coCd_S').val(),
                      "salesCd" : paramSalesCode,
                      "ordrsNo" : paramOrdrsNo,
                      "pageNo" : _pageNo + 1,
                      "recordCnt" : $('#recordCnt').val()};
	            var url = "";
	            //if (parseInt(planCnt) > 0) {
	            //	url = "/user/wb/wb01/selectNewWbsPlanTreeListSelect";
	            //}
	            //else {
	            	url = "/user/wb/wb01/selectNewWbsPlanTreeListSelect";
	            //}
	            postAjax(url, paramObj, null, function(data){
                    var list = data.fileList;
                        targetObj.setData({
                            list : list,
                            page : {
                                totalElements : list.length,
                            }
                        });
                });
	        } 
		    
		}
	
	var excelView = {
	        initView: function(){
	        this.target = new ax5.ui.grid();
	        this.target.setConfig({
	        target: $('[data-ax5grid="excel-grid"]'),
	        columns: [
	                {key: "rnum",  label: "NO.", hidden:true},
	                {key: "lvl",  label: "lvl", hidden:true},
	                {key: "codeId",  label: "codeId", align: "left", width: 200, hidden:true, treeControl: true},
	                {key: "codeKind",  label: "codeKind", hidden:true},
	                {key: "coCd",  label: "회사코드", hidden:true},
	                {key: "coCdNm",  label: "회사명", width: 80, hidden:true, align: "center"},
	                {key: "salesCd",  label: "SALES CD", width: 100, hidden:true, align: "center"},
	                {key: "codeNm",  label: "WBS 계획구분", align: "left", width: 200,  treeControl: true},
	
	                {key: "fileTreeKey",        label: "fileTreeKey", hidden:true},
	                {key: "wbsPlanNo",          label: "wbsPlanNo", hidden:true},
	                {key: "wbsPlanStsCodeId",   label: "계획상태코드",   hidden: true},
	                {key: "rsltsFileTrgtKey",   label: "rsltsFileTrgtKey", hidden:true},
	                {key: "rsltsWbsPlanNo",     label: "rsltsWbsPlanNo", hidden:true},
	                {key: "wbsPlanId",          label: "담당자",      hidden:true},
	                {key: "wbsPlanNm",            label: "담당자",      hidden:true},
	                {key: "wbsPlanDt",            label: "담당자",      hidden:true},
	                {key: "wbsPlanStsNm",       label: "계획상태",      hidden:true}, 
	                {key: "wbsPlanMngId",     label: "담당자",      hidden:true}, 
	                {key: "wbsPlanMngNm",     label: "담당자",      align: "center",   width: 80}, 
	                {key: "wbsPlanCnts",      label: "주요내용",      align: "left",   width: 100},
	                {key: "wbsPlanRmk",      label: "비고",      align: "left",   width: 100},    
	                {label: "계획", columns: [  
	                    {key: "wbsPlanChkYn",       label: "계획",      align: "center",   width: 40},  
	                    {key: "wbsPlansDt",         label: "시작일자",      align: "center",   width: 80},
	                    {key: "wbsPlaneDt",         label: "종료일자",      align: "center",   width: 80},
	                    {key: "lockYn",             label: "잠금",      align: "center",   width: 40},
	                    {key: "closeYn",            label: "마감",      align: "center",   width: 40},
	                    ]},
	                {label: "실적", columns: [ 
	                	{key: "wbsRsltsChkYn",      label: "실적",      align: "center",   width: 40},  
	                    {key: "wbsRsltsRate",       label: "진행율",      align: "center",   width: 60},                   
	                    {key: "wbsRsltssDt",        label: "시작일자",      align: "center",   width: 80},
	                    {key: "wbsRsltseDt",        label: "종료일자",      align: "center",   width: 80},
	                    {key: "rsltsLockYn",        label: "잠금",      align: "center",   width: 40},
	                    {key: "rsltsCloseYn",       label: "마감",      align: "center",   width: 40},
	                    {key: "wbsPlanMh",          label: "계획공수",      align: "center",   width: 80},                   
	                    {key: "wbsRsltsMh",         label: "실적공수",      align: "center",   width: 80},
	                    {key: "wbsRsltsCnts",      label: "주요내용",      align: "left",   width: 100},
	                    {key: "wbsRsltsRmk",      label: "비고",      align: "left",   width: 100},    
	                ]},
	                {key: "wbsRsltsId",         label: "담당자",      align: "center",   width: 80},                   
	                {key: "wbsRsltsDt",         label: "실적일자",      align: "center",   width: 80},
	                {key: "ordrsClntCd",      label: "고객사",     hidden: true},
	                {key: "ordrsClntNm",      label: "고객사",      align: "center",   width: 130},
	                {key: "clntPjt",      label: "고객사PJT",      align: "center",   width: 100},
	                {key: "ordrsDtlDiv20",      label: "신작구분",      hidden: true},
	                {key: "ordrsDtlDiv20Nm",      label: "신작",      align: "center",   width: 40},
	                {key: "prdtCd",      label: "제품구분",      hidden: true},
	                {key: "prdtCdNm",      label: "제품",      align: "center",   width: 130},
	                {key: "itemDiv",      label: "ITEM구분",      hidden: true},
	                {key: "itemDivNm",      label: "ITEM",      align: "center",   width: 100},  
	                
	                {key: "creatId",      label: "생성자", align: "center",   width: 80},
	                {key: "creatPgm",      label: "생성프로그램ID",      hidden: true},
	                {key: "creatDttm",      label: "생성일시",      align: "center",   width: 80},                   
	                {key: "udtId",      label: "최종변경자",      align: "center",   width: 80},
	                {key: "udtPgm",      label: "최종수정프로그램ID",      hidden: true},
	                {key: "udtDttm",      label: "최종변경일자",      align: "center",   width: 80},
	                	                
	                {key: "dsgnDifCodeId",      label: "설계난이도코드",      hidden: true},
	                {key: "dsgnDifCodeNm",      label: "설계난이드명",      hidden: true},
	                {key: "dsgnPlanHour",      label: "설계계획공수",      hidden: true},                   
	                {key: "prdctnDifCodeId",      label: "생산난이도코드",      hidden: true},
	                {key: "prdctnDifCodeNm",      label: "생산난이도명",      hidden: true},
	                {key: "prdctnPlanHour",      label: "생산계획공수",      hidden: true},                   
	                {key: "wbsPlanOsYn",      label: "계획외주코드",      hidden: true},
	                {key: "wbsPlanOsNm",      label: "계획외주유무",      hidden: true},   
	                {key: "wbsPlanCodeKind",      label: "WBS 상위코드",    hidden: true},
	                {key: "wbsPlanCodeId",      label: "WBS 코드",      hidden: true},
	                {key: "wbsPlanNo",      label: "WBS NO",      hidden: true},
	                {key: "isLeaf", label: "isLeaf", align: "left", width: 60, hidden: true }
	           ]
	        });
	        return this;
	    }
	}        
	
	    $(document).ready(function() {

	        mainDefaultLoad("WBS", "일정계획관리");          // 페이지 타이틀 설정
	        setCommonSelect($("#main_area select[data-kind]"));     // 공통코드 set

	        $("#coCd_S").val(jwt.coCd);
	        // 시작일 (현재날짜의 월 첫일)
	        $('#reqDtFrom_S').datepicker({
	            format : "yyyy-mm-dd",
	            language : "ko",
	            autoclose : true
	        })

	        .datepicker("setDate", moment(new Date()).startOf("month").toDate())
	        .on("changeDate", function(){
	            if($('#reqDtFrom_S').val() > $('#reqDtTo_S').val()){
	                alert("날짜를 확인해주세요");
	                $('#reqDtFrom_S').datepicker("setDate", new Date($('#reqDtTo_S').val()));
	            }
	        });

	        // 종료일 (현재날짜의 월 말일)
	        $('#reqDtTo_S').datepicker({
	            format : "yyyy-mm-dd",
	            language : "ko",
	            autoclose : true
	        })
	        .datepicker("setDate", moment(new Date()).endOf("month").toDate())
	        .on("changeDate", function(){
	            if($('#reqDtFrom_S').val() > $('#reqDtTo_S').val()){
	                alert("날짜를 확인해주세요");
	                $('#reqDtTo_S').datepicker("setDate", new Date($('#reqDtFrom_S').val()));
	            }
	        });


	        isFirst = false;    
	        salesGridView.initView().setData(0);
	        gridView.initView();
	        excelView.initView();
	          // 검색조건 이벤트 bind
	        $('[data-search]').on("change", function(){
	            gridView.setData(0, salesCd, ordrsNo);
	        });
	        
	        //권한체크
	        authChk();

	    });
	    
	    // 초기화 버튼용
	    function initSearch() {
	        $('[data-search]').off("change");   //바인딩기능 오프
	        $('.contents.search select, .contents.search input').val("");
	        $("#reqDtFrom_S").val(dateToStr(moment(new Date()).startOf("month").toDate()));
	        $("#reqDtTo_S").val(dateToStr(moment(new Date()).endOf("month").toDate()));
	        $("#coCd_S").val(jwt.coCd);

	        salesGridView.initView().setData(0);
	    }
	 
	    function pChk(codeKind) {
	    	var chk = false;
	    	var rowList = gridView.target.getList();
            $.each(rowList, function(idx, obj){
            	if (obj.codeId == codeKind && obj.wbsPlanChkYn == "N"){                	
                	chk = true;
                    return false;                       
                }
            }); 
            return chk;
	    }
	    
	    function rChk(codeKind) {
            var chk = false;
            var rowList = gridView.target.getList();
            $.each(rowList, function(idx, obj){
                if (obj.codeId == codeKind && obj.wbsRsltsChkYn == "N"){                  
                    chk = true;
                    return false;                       
                }
            }); 
            return chk;
        }
	    
	    // 고객사 검색
	    function openClntSearch(openType) {
	        var paramObj = {
	                "searchValue" :  $("#clntNm_S").val()
	        }       
	        openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색", paramObj, function (grid) {
	            var row = grid.target.getList("selected")[0];
	            if(openType == "P"){
	                $('#clntCd_S').val(row.clntCd);
	                $('#clntNm_S').val(row.clntNm);
	                gridView.setData(0, salesCd, ordrsNo);
	            }else if(openType == "V"){
	                $('#vendCd_S').val(row.clntCd);
	                $('#vendNm_S').val(row.clntNm);
	            }
	        });
	    }
	 
	    //제품코드 검색
	    function openPrdtSearch(){
	        var paramObj = {
	                "coCd": $('#coCd').val(),
	                "prdtCd": $('#prdtCd_S').val(),
	                "prdtNm": $('#prdtNm_S').val(),
	                "useYn" : "Y"
	        }
	        openSecondModal("/static/html/cmn/modal/prdtSearch.html", 800, 600, "제품 검색", paramObj, function (grid) {
	            var row = grid.target.getList("selected")[0];
	            $("#prdtCd_S").val(row.prdtCd);
	            $("#prdtNm_S").val(row.prdtNm);
	        });
	    }
	    
	    //Sales Code (수주마스터, 수주상세테이블 조인) 검색
	    function wbsSalesCodeSearchM() {
	        var paramObj = {
	           "coCd" : $('#coCd_S').val(),
	           "salesCd": $('#salesCd_S').val()
	        };
	        openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 430, "SALES CODE 검색", paramObj, function (grid){
	            var row = grid.target.getList("selected")[0];
	            $('#salesCd_S').val(row.salesCd);
	        });
	    }
	    
	    //관리번호 (WbsPlanNo) 검색
	    function wbsPlanNoSearch() {
	        var paramObj = {
	           "coCd" : $('#coCd_S').val(),
	           "wbsPlanNo": $('#wbsPlanNo_S').val()
	        };
	        openSecondModal("/static/html/cmn/modal/wbsPlanNoSearch.html", 450, 300, "관리번호 검색", paramObj, function (grid){
	            var row = grid.target.getList("selected")[0];
	            $('#wbsPlanNo_S').val(row.wbsPlanNo);
	        });
	    }
	    
	    //공유대상자 검색
	    function openUserTree() {
	        var paramObj = {
	            "coCd" : $('#coCd_S').val(),
	            "userId": $('#salesMngNm_S').val(),
	            "useYn": "Y"
	        };
	        openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "사용자 검색", paramObj, function (tree){
	            var checkedId = tree.get_checked()[0];
	            var checkedNode = tree.get_node(checkedId);
	            $('#salesMngId_S').val(checkedNode.id);
	            $('#salesMngNm_S').val(checkedNode.text);
	        });
	    }
	  
	    
	    function excelDown() {
	    	var paramObj = {"coCd": $('#coCd_S').val(),
                    "reqDtFrom" : $("#reqDtFrom_S").val().replace(/\-/g, ''),
                    "reqDtTo": $("#reqDtTo_S").val().replace(/\-/g, ''),
                    "clntCd" : $("#clntCd_S").val(),
                    "clntNm" : $("#clntNm_S").val(),
                    "salesCd" : salesCd,
                    "prdtCd" : $("#prdtCd_S").val(),
                    "prdtNm" : $("#prdtNm_S").val(),
                    "itemCd" : $("#itemCd_S").val(),
                    "clntPjt" : $("#clntPjt_S").val(),
                    "eqpNm" : $("#eqpNm_S").val(),
                    "salesMngId" : $("#salesMngId_S").val(),
                    "salesMngNm" : $("#salesMngNm_S").val(),
                    "wbsPlanNo" : $("#wbsPlanNo_S").val()
                    };
	        postAjax("/user/wb/wb01/selectNewWbsPlanExcelList", paramObj, null, function(data){
	            var list = data.fileList;
	            excelView.target.setData({
	               list : list,
	               page : {
	                         totalElements : list.length,
	               }
	            });
	            var todayDate = new Date().format('yyyyMMddHHmmss');
	            excelView.target.exportExcel("WBS_계획실적 리스트"+todayDate+".xls");
	         });   
	    }	    
	    
	  /*계획 수정 or 등록 버튼 클릭 시*/
	  function insertWbsPlanModal(type, lvl, idx) {	
		  var row = gridView.target.getList()[idx]; 

          if (row != undefined) {
        	  var actionType = type;
              var fileTrgtKey = row.fileTrgtKey;
              var coCd = row.coCd;
              var lvl = lvl;
              var idx = idx;
              var salesCd = row.salesCd;
              var codeKind = row.codeKind;
              var codeId = row.codeId;  
              if (type == 'U') {
                  var paramObj = {
                      "actionType" : actionType,
                      "fileTrgtKey" : fileTrgtKey,
                      "coCd" : coCd,
                      "lvl"      : lvl,
                      "idx"      : idx,
                      "salesCd" : salesCd,
                      "ordrsNo" : ordrsNo,
                      "codeKind" : codeKind,
                      "codeId" : codeId
                  };
              } else {
                  var paramObj = {
                          "actionType" : actionType,
                          "fileTrgtKey" : 0,
                          "coCd" : coCd,
                          "lvl"      : lvl,
                          "idx"      : idx,
                          "salesCd" : salesCd,
                          "ordrsNo" : ordrsNo,
                          "codeKind" : codeKind,
                          "codeId" : codeId
                  }
              }              
              openModal("/static/html/user/wb/wb01/WB0111P01.html", 1600, 850, "", paramObj, function(data) {
            	  gridView.setData(0, salesCd, ordrsNo);
              }); 
          }
	 }
	        
	  /*실적 수정 or 등록 버튼 클릭 시*/
	  function insertWbsRsltsModal(type, lvl, idx) {
		    var row = gridView.target.getList()[idx]; 
		    if (row != undefined) {
		    	  var actionType = type;
	              var fileTrgtKey = row.rsltsFileTrgtKey;
	              var coCd = row.coCd;
	              var lvl = lvl;
	              var idx = idx;
	              var salesCd = row.salesCd;
	              var codeKind = row.codeKind;
	              var codeId = row.codeId;  

	            if (type == 'U') {
	                var paramObj = {
	                		"actionType" : actionType,
	                        "fileTrgtKey" : fileTrgtKey,
	                        "coCd" : coCd,
	                        "lvl"      : lvl,
	                        "idx"      : idx,
	                        "salesCd" : salesCd,
	                        "ordrsNo" : ordrsNo,
	                        "codeKind" : codeKind,
	                        "codeId" : codeId
	                };
	            } else {
	                var paramObj = {
	                		"actionType" : actionType,
	                          "fileTrgtKey" : 0,
	                          "coCd" : coCd,
	                          "lvl"      : lvl,
	                          "idx"      : idx,
	                          "salesCd" : salesCd,
	                          "ordrsNo" : ordrsNo,
	                          "codeKind" : codeKind,
	                          "codeId" : codeId
	                }
	            }
	            openModal("/static/html/user/wb/wb01/WB0111P02.html", 1600, 850, "", paramObj, function(data) {
	            	gridView.setData(0, salesCd, ordrsNo);
	            });
		    }
	 }

	  
   // 계획 삭제
   function deleteWbsPlan() {
	   var list = gridView.target.getList("selected");
	   var chk = 0;
       $.each(list, function(idx, elem){
           if (elem.lockYn == "Y"
               || elem.closeYn == "Y"     
               || elem.wbsRsltsChkYn == "Y"       
               ) {
                   chk++; 
           }
       });
	   if (chk > 0) {
    	   alert("WBS계획을 삭제할 수 없습니다." + '\n' + "(계획유무, 잠금, 마감, 실적, 하위레벨 데이터 확인))");
    	   return;
       } 
        var rowListArr = [];
        if(list.length > 0) {
            if(confirm("계획을 삭제하시겠습니까?")){
                var formData = new FormData();
                $.each(list, function(idx, elem){
               	 var row = gridView.target.getList()[elem.__index];
                    if (row != undefined && row.fileTrgtKey != undefined) {
                        const obj = {coCd: row.coCd, salesCd: row.salesCd, wbsPlanNo:row.wbsPlanNo,codeKind:row.codeKind,codeId:row.codeId,S_todoDiv1CodeId:"TODODIV10",S_todoDiv2CodeId:"TODODIV1010"};
                        rowListArr.push(obj);
                    }               
                });
                formData.append("rowListArr", JSON.stringify(rowListArr));
                filePutAjax("/user/wb/wb01/deleteWbsPlanlist", formData, function(data){
                    if(data.resultCode == 200){
                        alert("계획 삭제 완료되었습니다.");       
                        gridView.setData(0, salesCd, ordrsNo);
                    }
                 }); 
            } 
	    }
   }
     
   // 실적 삭제	 
   function deleteWbsRslts() {	   
	   var chk = 0;
       var list = gridView.target.getList("selected");
       $.each(list, function(idx, elem){
           if (elem.wbsRsltsChkYn == "N"   
               || elem.rsltsCloseYn == "Y"       
               ) {
                   chk++;
           } 
       });
       if (chk > 0) {
           alert("WBS 실적 데이터를 삭제할 수 없습니다.");
           return;
       }
       var rowListArr = [];
       if(list.length > 0) {
           if(confirm("실적을 삭제하시겠습니까?")){
               var formData = new FormData();
               $.each(list, function(idx, elem){
            	   var row = gridView.target.getList()[elem.__index];
                   if (row != undefined && row.rsltsFileTrgtKey != undefined) {
                       const obj = {coCd:row.coCd, salesCd:row.salesCd, wbsPlanNo:row.rsltsWbsPlanNo, codeKind:row.codeKind, codeId:row.codeId, S_todoDiv1CodeId:"TODODIV10",S_todoDiv2CodeId:"TODODIV1020", A_todoDiv1CodeId:"TODODIV20", A_todoDiv2CodeId:"TODODIV2010"};
                       rowListArr.push(obj);
                   }               
               });
               formData.append("rowListArr", JSON.stringify(rowListArr));
               filePutAjax("/user/wb/wb01/deleteWbsRsltslist", formData, function(data){
                   if(data.resultCode == 200){
                       alert("실적 삭제 완료되었습니다.");       
                       gridView.setData(0, salesCd, ordrsNo);
                   }
                }); 
           } 
       }
   }
   
   
   function lockYn() { //잠금처리
	   var chk = 0;
       var list = gridView.target.getList("selected");
       $.each(list, function(idx, elem){
    	   if (elem.lockYn == "Y"    
               || elem.wbsPlanChkYn == "N"       
               ) {
                   chk++;
           } 
       });
       if (chk > 0) {
    	   alert("WBS 계획 잠금 처리할 수 없습니다." + '\n' + "(계획유무, 잠금, 마감 데이터 확인))");
           return;
       }
       
	   var rowListArr = [];
       if(list.length > 0) {
           if(confirm("잠금처리 하시겠습니까?")){
               var formData = new FormData();
               $.each(list, function(idx, elem){
                   var row = gridView.target.getList()[elem.__index];
                   if (row != undefined && row.fileTrgtKey != undefined) {
                       const obj = {coCd: row.coCd, codeId: row.codeId, salesCd:row.salesCd, state:"Y"};
                       rowListArr.push(obj);
                   }               
               });
               formData.append("rowListArr", JSON.stringify(rowListArr));
               filePutAjax("/user/wb/wb01/updateWbsPlanLockYn", formData, function(data){
                   if(data.resultCode == 200){
                       alert("잠금처리 완료되었습니다.");       
                       gridView.setData(0, salesCd, ordrsNo);
                   }
                }); 
           } 
       }
   }   
   
   function unLockYn() { //잠금해제
       var chk = 0;
       var list = gridView.target.getList("selected");
       $.each(list, function(idx, elem){
           if (elem.lockYn == "N"  
                    || elem.wbsPlanChkYn == "N"       
                   ) {
                   chk++;
           } 
       });
       if (chk > 0) {
    	   if (chk > 0) {
               alert("WBS 계획 잠금 해제할 수 없습니다." + '\n' + "(계획유무, 잠금, 마감 데이터 확인))");
               return;
           }
       }
       
       var rowListArr = [];
       if(list.length > 0) {
           if(confirm("잠금해제 하시겠습니까?")){
               var formData = new FormData();
               $.each(list, function(idx, elem){
                   var row = gridView.target.getList()[elem.__index];
                   if (row != undefined && row.fileTrgtKey != undefined) {
                       const obj = {coCd: row.coCd, codeId: row.codeId, salesCd:row.salesCd, state:"N"};
                       rowListArr.push(obj);
                   }               
               });
               formData.append("rowListArr", JSON.stringify(rowListArr));
               filePutAjax("/user/wb/wb01/updateWbsPlanLockYn", formData, function(data){
                   if(data.resultCode == 200){
                       alert("잠금해제 완료되었습니다.");       
                       gridView.setData(0, salesCd, ordrsNo);
                   }
                }); 
           } 
       }       
   }   
   
   function closeYn() { //마감처리
	   var chk = 0;
       var list = gridView.target.getList("selected");
       $.each(list, function(idx, elem){
           if (elem.wbsRsltsChkYn == "N"
        	   || elem.rsltsCloseYn == "Y") {
                   chk++;
           } 
       });
       if (chk > 0) {
           alert("WBS 실적 마감을 처리할 수 없습니다.");
           return;
       }
       var rowListArr = [];
       if(list.length > 0) {
           if(confirm("마감처리 하시겠습니까?")){
               var formData = new FormData();
               $.each(list, function(idx, elem){
                   var row = gridView.target.getList()[elem.__index];
                   if (row != undefined && row.rsltsFileTrgtKey != undefined) {
                       const obj = {coCd: row.coCd, codeId: row.codeId, salesCd:row.salesCd, state:"Y"};
                       rowListArr.push(obj);
                   }               
               });
               formData.append("rowListArr", JSON.stringify(rowListArr));
               filePutAjax("/user/wb/wb02/updateWbsRsltsCloseYn", formData, function(data){
                   if(data.resultCode == 200){
                       alert("마감처리 완료되었습니다.");       
                       gridView.setData(0, salesCd, ordrsNo);
                   }
                }); 
           } 
       }
   }   
   
   function unCloseYn() { //마감해제처리
	   var chk = 0;
       var list = gridView.target.getList("selected");
       $.each(list, function(idx, elem){
           if (elem.rsltsCloseYn == "N"
        	   || elem.wbsRsltsChkYn == "N") {
                   chk++;
           } 
       });
       if (chk > 0) {
           alert("WBS 실적 마감을 해제할 수 없습니다.");
           return;
       }
       var rowListArr = [];
       if(list.length > 0) {
           if(confirm("마감해제 하시겠습니까?")){
               var formData = new FormData();
               $.each(list, function(idx, elem){
                   var row = gridView.target.getList()[elem.__index];
                   if (row != undefined && row.rsltsFileTrgtKey != undefined) {
                       const obj = {coCd: row.coCd, codeId: row.codeId, salesCd:row.salesCd, state:"N"};
                       rowListArr.push(obj);
                   }               
               });
               formData.append("rowListArr", JSON.stringify(rowListArr));
               filePutAjax("/user/wb/wb02/updateWbsRsltsCloseYn", formData, function(data){
                   if(data.resultCode == 200){
                       alert("마감해제 완료되었습니다.");       
                       gridView.setData(0, salesCd, ordrsNo);
                   }
                }); 
           } 
       }
   }   

   
   function wbsPlanProcInsertModal() {
	   var row = salesGridView.target.getList("selected")[0];
	   var paramObj = {};
	   if (!row) {
		   alert("salesCode를 선택하세요");
		   return;
	   }
	   else {
		   paramObj["coCd"] = row.coCd;  
		   paramObj["salesCd"] = row.salesCd;  
		   paramObj["ordrsNo"] = row.ordrsNo;  
	   }
	   
	   openSecondModal("/static/html/user/wb/wb01/WB0111P04.html", 1300, 780, "WBS계획공정 추가", paramObj, function (grid){		   
		   var rowList = grid.target.getList("selected");
		   if (rowList) {
			   var rowListArr = [];
	           $.each(rowList, function(idx, elem){
	               if (elem.__selected__) {
	                   const obj = {coCd: elem.coCd, 
	                                codeKind: elem.codeKind, 
	                                codeId: elem.codeId, 
	                                salesCd: elem.salesCd,
	                                lvl:parseInt(elem.lvl),
	                                userId:jwt.userId, 
	                                creatPgm:"WB0111P04"};
	                   rowListArr.push(obj);
	                 }
	           });
	           var formData = new FormData();
	           formData.append("rowListArr", JSON.stringify(rowListArr));
	           filePostAjax("/user/wb/wb01/wbsPlanListInsert", formData,             
	              function(data) {
	                  //alert(data.resultMessage);                              
	                  if (data.resultCode == 200) {                          
	                      gridView.setData(0, salesCd, ordrsNo);
	                        
	                  }
	              });        
		   }		    
	   });
   }
   
   function deleteWbsPlanList() {
	   var list = gridView.target.getList("selected");
       var chk = 0;
       $.each(list, function(idx, elem){
           var codeKind = elem.codeId;
           var list1 = gridView.target.getList();                   
           if (list1) {
               $.each(list1, function(idx, elem){
                   if ((elem.codeKind == codeKind && 
                       (elem.lockYn == "Y"
                        || elem.closeYn == "Y"     
                        || elem.wbsRsltsChkYn == "Y"       
                       ))) {
                       chk++;
                   }
               });
           }     
       });
       
       if (chk > 0) {
    	   alert("WBS 계획 데이터가 존재합니다.");
           return;
       }
	   var rowListArr = [];
       if(list.length > 0) {
           if(confirm("WBS 계획 리스트를 삭제 하시겠습니까?")){
               var rowList = gridView.target.getList("selected");               
               var rowListArr = [];
               $.each(rowList, function(idx, elem){
                   if (elem.__selected__) {
                       const obj = {coCd: elem.coCd, 
                                    codeKind: elem.codeKind, 
                                    codeId: elem.codeId, 
                                    salesCd: elem.salesCd,
                                    lvl:parseInt(elem.lvl),
                                    userId:jwt.userId, 
                                    creatPgm:"WB0111P04"};
                       rowListArr.push(obj);
                     }
               });
               var formData = new FormData();
               formData.append("rowListArr", JSON.stringify(rowListArr));
               filePutAjax("/user/wb/wb01/deleteWbsPlanTempList", formData, function(data){
                   if(data.resultCode == 200){
                       alert("삭제되었습니다.");       
                       gridView.setData(0, salesCd, ordrsNo);
                   }
                }); 
           } 
       }       
   }   
  
</script>
