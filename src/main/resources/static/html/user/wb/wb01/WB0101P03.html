<div id="wbsPopup3" class="popup_area of_a" style="width: 100%; height: 100%;">
	<div class="tit_contents">
	    <h4 class="tit">WBS Level 3 일정계획등록</h4>
	</div>
	
	<div class="popup_table">
		<div class="form-group">
			<form id="popForm3">
			<input type="hidden" name="creatPgm3" id="creatPgm3" data-search="creatPgm" value="WB0101P03">
			<input type="hidden" name="fileTrgtKey_S3" data-search="fileTrgtKey" id="fileTrgtKey_S3">
			<input type="hidden" name="lockYn_S3" id="lockYn_S3">
            <input type="hidden" name="closeYn_S3" id="closeYn_S3">
		        <table class="popup_table">
					<colgroup>
					     <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="6%">
					</colgroup>
					
					<thead>
						<tr>
						   <td colspan="9" style="height:30px;text-align: left;">기본정보(3레벨화면)</td>	                                              
						</tr>
					</thead>
					
					<tbody>
						<!-- 1행 -->
						<tr>
							<th class="hit">회사</th>
							<td>
								<select class="form-control input-sm" id="coCd_S3" data-kind="CO" data-search="coCd"  required="required">
                                   <!-- <option value="">전체</option> -->
                                </select>
							</td>
							<th>관리번호</th>
							<td>
								<div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsPlanNo_S3" name="wbsPlanNo_S3"  data-search="wbsPlanNo" required="required" disabled>
                                </div>
							</td>
							<th class="hit">작성일자</th>
							<td>
	                            <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlanDt_S3" name="wbsPlanDt_S3" data-search="wbsPlanDt" autocomplete="off" msg="작성일자" date required>
                                </div>
							</td>
							<th class="hit">작성자</th>
							<td>
								<div class="search_form">
                                    <input type="hidden" id="wbsPlanId_S3" name="wbsPlanId_S3" data-search="wbsPlanId">
                                    <input type="text" id="wbsPlanNm_S3" name="wbsPlanNm_S3" data-search="wbsPlanNm" msg="작성자" onkeyUp="if(window.event.keyCode == 8){wbsPlanId_S3.value = ''};" readonly required>
                                    <a onclick="openThirdWbsPlanUserSearch();">
                                        <i class="i_search_w"></i>
                                    </a>
                                </div>
							</td>
							<th rowspan="6" style="vertical-align:top;">
                                <button type="button" class="btn btn-primary btn-sm" style="height: 25px; line-height: 15px;" onclick="file.click();" authchk>이슈등록</button>
                            </th>
						</tr>
						             
						<!-- 2행 -->
						 <tr>
						    <th>Sales Code</th>
						    <td>
							    <div class="search_form" style="width: 100%;">
                                    <input type="text" class="form-control input-sm" id="salesCd_S3" data-search="salesCd">
                                    <a onclick="openThirdWbsSalesCodeSearch();"><i class="i_search_w"></i></a>
                                </div>
						    </td>
						    <th  class="hit">고객사</th>
						    <td>
								<div class="search_form">
                                    <input type="hidden" id="clntCd_S3" name="clntCd_S3" msg="고객사" data-search="clntCd">
                                    <input type="text" class="form-control input-sm" id="clntNm_S3" data-search="clntNm" readonly msg="고객사" required>
                                   
                                </div>
						    </td>
						    <th>고객사PJT</th>
						    <td>
						         <input type="text" class="form-control input-sm" id="wbsClntPjt_S3"  data-search="clntPjt">
						    </td>
						    <th class="hit">신작구분</th>
						    <td>
						        <select id="wbsPlanDiv_S3" name="wbsPlanDiv_S3" data-kind="wbsPlanDiv_S3" data-search="wbsPlanDiv">
						        <option value="">선택</option>
                                </select>
						    </td>
						</tr>
						
						 <!-- 3행 -->
						 <tr>
						    <th class="hit">Lv.1</th>
						    <td>
						          <select id="wbsLevel1_S3" name="wbsLevel1_S3" data-kind="wbsLevel1_S3" data-search="wbsPlanMCodeId" onchange="openThirdWbsLevel2Change();openThirdWbsLevel3Change();">
                                     <option value="">선택</option>
                                  </select>
						    </td>
						    <th>담당자</th>
						    <td>
						        <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId_S3_1" name="wbsPlanMngId_S3_1" data-search="wbsPlanMngId">
                                    <input type="text" id="wbsPlanMngNm_S3_1" name="wbsPlanMngNm_S3_1" msg="담당자" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId_S3_1.value = ''};" readonly required>
                                    <a onclick="openThirdWbsLevel1PlanMngUserSearch();">
                                        <i class="i_search_w"></i>
                                </a>
                                </div>
						    </td>
						    <th class="hit">시작일자</th>
						    <td>
						        <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt_S3_1" data-search="wbsPlansDt"  "autocomplete="off" date>
                                </div>
						    </td>
						    <th class="hit">종료일자</th>
						    <td>
							    <div class="date_input">
	                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt_S3_1" data-search="wbsPlaneDt"  autocomplete="off" date>
	                            </div>
						    </td>
						</tr>
						<!-- 4행 -->
                         <tr>
                            <th class="hit">Lv.2</th>
                            <td>
                                <select id="wbsLevel2_S3" name="wbsLevel2_S3" data-kind="wbsLevel2_S3" data-search="wbsPlanCodeKind" onchange="openThirdWbsLevel3Change();">
                                   <option value="">선택</option>
                                </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId_S3_2" name="wbsPlanMngId_S3_2" data-search="wbsPlanMngId2">
                                    <input type="text" id="wbsPlanMngNm_S3_2" name="wbsPlanMngNm_S3_2" msg="담당자" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId_S3_2.value = ''};" readonly required>
                                    <a onclick="openThirdWbsLevel2PlanMngUserSearch();">
                                        <i class="i_search_w"></i>
                                </a>
                                </div>
                            </td>
                            <th class="hit">시작일자</th>
                            <td>
	                            <div class="date_input">
	                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt_S3_2" data-search="wbsPlansDt2"  "autocomplete="off" date>
	                            </div>
                            </td>
                            <th class="hit">종료일자</th>
                            <td>
	                            <div class="date_input">
	                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt_S3_2" data-search="wbsPlaneDt2"  autocomplete="off" date>
	                            </div>
                            </td>
                        </tr>
                        <!-- 5행 -->
                         <tr>
                            <th class="hit">Lv.3</th>
                            <td>
		                        <select id="wbsLevel3_S3" name="wbsLevel3_S3" data-kind="wbsLevel3_S3" data-search="wbsPlanCodeId">
                                    <option value="">선택</option>
                                </select>
                            </td>
                            <th>담당자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="wbsPlanMngId_S3_3" name="wbsPlanMngId_S3_3" data-search="wbsPlanMngId3">
                                    <input type="text" id="wbsPlanMngNm_S3_3" name="wbsPlanMngNm_S3_3" msg="담당자" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId_S3_3.value = ''};" readonly required>
                                    <a onclick="openThirdWbsLevel3PlanMngUserSearch();">
                                        <i class="i_search_w"></i>
                                </a>
                                </div>
                            </td>
                            <th class="hit">시작일자</th>
                            <td>
	                            <div class="date_input">
                                    <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt_S3_3" data-search="wbsPlansDt3"  "autocomplete="off" date>
	                            </div>
                            </td>
                            <th class="hit">종료일자</th>
                            <td>
	                            <div class="date_input">
	                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt_S3_3" data-search="wbsPlaneDt3"  autocomplete="off" date>
	                                </div>
                            </td>
                        </tr>
						
						<!-- 6행 -->
						 <tr>
						    <th class="hit">주요내용</th>
						    <td colspan=3>
						           <input type="text" id="wbsPlanCnts_S3" data-search="wbsPlanCnts">
						    </td>
						    <th>비고</th>
						    <td colspan=3>
						            <input type="text" id="wbsPlanRmk_S3" data-search="wbsPlanRmk">
						    </td>
						</tr>
						
						<!-- 7행 -->
						 <tr>
                            <th>외주여부</th>
                            <td>
                                <input type=radio id="wbsPlanOsYn_Y_S3" name="wbsPlanOsYn_Y_S3" value="Y" data-search="wbsPlanOsYn_Y">Y &ensp; &ensp; &ensp; &ensp; 
                                <input type=radio id="wbsPlanOsYn_N_S3" name="wbsPlanOsYn_N_S3" value="N" data-search="wbsPlanOsYn_N" checked>N <br>
                            </td>
                            <th>계획상태</th>
                            <td>
                                <select id="wbsPlanStsCodeId_S3" name="wbsPlanStsCodeId_S3" data-kind="wbsPlanStsCodeId_S3" data-search="wbsPlanStsCodeId">
                                    <option value="">선택</option>
                                </select>
                            </td>
                            
                         </tr>
				    </tbody>
		        </table>	
			</form>
		</div>
	</div>
	<div class="popup_table">               
        <table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※공유 대상자</td>
                <td style="text-align:right;">
                    <button type="button" class="btn btn-primary btn-sm"  id="shareBtn" onclick="opendModalSharngListList();" authchk>공유라인</button>
                    <div id="addrow" class="add_btn_small pdl10">
                        <a onclick="" data-grid-control="row-add2" style="height: 30px; line-height: 28px;"  authchk>+</a>
                        <a onclick="" data-grid-control="row-remove2" style="height: 30px; line-height: 28px;"  authchk>-</a>
                    </div>
                </td>
            </tr>
        </table>
    </div>
    
	<div class="contents">
	     <!-- 공유대상자 리스트 -->
            <div data-ax5grid="second-grid1_3" data-ax5grid-config="{}" style="height: 200px; width: 100%"></div>
            </div>  
         <!-- 첨부파일 리스트 -->
          <div class="row" style="margin-top: 15px;margin-bottom:40px;">
              <div class="col-xs-2" style="padding-right: 5px;">
                  <div class="contents" style="margin: 0; padding: 0;width: 100%; min-width: 200px">
                      <h3 class="location">
                          <span class="page_tit" style="text-align: left;"> 파일트리</span>
                      </h3>
                      <div id="treeview" style="height: 150px;padding: 5px;overflow: scroll;">
                          <div id="WB0101P03"></div>
                      </div>
                  </div>
              </div>
              <div class="col-xs-10" style="padding-left: 0;">
                  <div class="contents" style="margin: 0; padding: 0;  width: 100%; min-width: 200px">
                      <h3 class="location">
                          <a class="file_tag" id="file_tag" style="font-weight: bold; color: blue; padding-left: 20px; padding-right: 10px;"></a>
                          <span class="page_tit" id="file_tit" style="text-align: right;"> 문서현황</span>
                      </h3>
                      <button disabled type="button" id="button_file" class="" style="  background-color: gray;height: 25px; line-height: 15px;" onclick="file.click();" authchk>첨부파일</button>
                      <div class="ax5_grid" data-ax5grid="file-grid3" data-ax5grid-config="{}" style="height: 150px; width: 100%"></div>
                      </div>
              </div>
          </div>
          <!-- 첨부파일 리스트 END -->
	</div>
	<div class="popup_bottom_btn">              
	    <button type="button" style="display:block"  id="actionBtn3" onclick="wbsLevel3PlanInsert();" authchk>등록</button>
	    <button type="button" onclick="modalStack.close();">닫기</button>
     </div>
</div>
    
<script type="text/javascript">
var paramFlag = modalStack.last().paramObj.flag;
var paramRpw = modalStack.last().paramObj.row;
var paramTreeObj = {};
var fileTreeKey; // 파일생성TreeKey

var secondGridView3 = {
        initView: function(){
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: true,
                multipleSelect: false,
                sortable: true,
                target: $('[data-ax5grid="second-grid1_3"]'),
                header: {
                  align: "center",
                  selector: false
                },
                body: {
                    onClick: function () {
                        this.self.select(this.dindex); 
                    },
                    onDBLClick: function () {
                        this.self.clearSelect();
                        this.self.select(this.dindex);
                    },
               },
               columns: [
                     {key: "rn",      label: "No.",      align: "center",   width: 60},
                     {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 130},
                     {key: "wbsPlanNo",      label: "관리번호",      align: "center",   width: 130},
                     {key: "wbsPlanCodeId",      label: "계획항목코드",      hidden: true},
                     {key: "wbsPlanCodeNm",      label: "LEVEL",      align: "center",   width: 130},
                     {key: "todoCfDt",      label: "확인일자",      align: "center",   width: 130},
                     {key: "todoCfOpn",      label: "확인의견",      align: "left",   width: 200},
                     {key: "wbsPlancoCd",      label: "회사",          hidden: true},
                     {key: "wbsPlancoCdNm",      label: "회사명",      align: "center",   width: 130},
                     {key: "wbsSharngUserId",      label: "ID",      align: "center",   width: 130},
                     {key: "empNo",      label: "사원번호",      align: "center",   width: 130},
                     {key: "name",      label: "성명",      align: "center",   width: 130},
                     {key: "telNo",      label: "H.P",      align: "center",   width: 130},
                     {key: "email",      label: "E-Mail",      align: "center",   width: 200}
                     ]
            });
            return this;
          },
          setData: function() {
              var targetObj = this.target;
              var formData = {
                  "coCd" : $("#coCd_S3").val(),
                  "codeKind" : $("#wbsLevel2_S3").val(),
                  "codeId" : $("#wbsLevel3_S3").val(),
                  "salesCd" : $("#salesCd_S3").val()
              }
              postAjax("/user/wb/wb01/selectPlanSharngList", formData, null, function(data){
                  var list = data.resultList;
                  targetObj.setData({
                       list : list,
                       page : {
                           totalElements : list.length
                       }
                   });
                  
              }); 
         } 
     }
     
$(document).ready(function() {

    setCommonSelect($('#wbsPopup3 select[data-kind]'));
    
    $('#coCd_S3').val(jwt.coCd);
    $('#wbsPlanId_S3').val(jwt.userId);
    $('#wbsPlanNm_S3').val(jwt.userNm);
    $('#wbsPlanMngId_S3_1').val(jwt.userId);
    $('#wbsPlanMngNm_S3_1').val(jwt.userNm);
    $('#wbsPlanMngId_S3_2').val(jwt.userId);
    $('#wbsPlanMngNm_S3_2').val(jwt.userNm);
    $('#wbsPlanMngId_S3_3').val(jwt.userId);
    $('#wbsPlanMngNm_S3_3').val(jwt.userNm);
    
    var today = new Date();
    var strDate = today.getFullYear()+"-"+('0'+(today.getMonth()+1)).slice(-2)+"-"+('0'+today.getDate()).slice(-2);
    
    // 작성일자 초기화
    $('#wbsPlanDt_S3').datepicker({
        format : "yyyy-mm-dd",
        language : "ko",
        autoclose : true
    })
    .datepicker("setDate", strDate)

    
    
    //  Level1  시작일 (현재날짜의 월 첫일)
    $('#wbsPlansDt_S3_1').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_1').val() > $('#wbsPlaneDt_S3_1').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlansDt_S3_1').datepicker("setDate", new Date($('#wbsPlaneDt_S3_1').val()));
              }
    });
    
    //  Level1  종료일 (현재날짜의 월 말일)
    $('#wbsPlaneDt_S3_1').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_1').val() > $('#wbsPlaneDt_S3_1').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlaneDt_S3_1').datepicker("setDate", new Date($('#wbsPlansDt_S3_1').val()));
              }
    });
    
    
    //  Level2 시작일 (현재날짜의 월 첫일)
    $('#wbsPlansDt_S3_2').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_2').val() > $('#wbsPlaneDt_S3_2').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlansDt_S3_2').datepicker("setDate", new Date($('#wbsPlaneDt_S3_2').val()));
              }
    });
    
    //  Level2 종료일 (현재날짜의 월 말일)
    $('#wbsPlaneDt_S3_2').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_2').val() > $('#wbsPlaneDt_S3_2').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlaneDt_S3_2').datepicker("setDate", new Date($('#wbsPlansDt_S3_2').val()));
              }
    });    
    

    //  Level3 시작일 (현재날짜의 월 첫일)
    $('#wbsPlansDt_S3_3').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_3').val() > $('#wbsPlaneDt_S3_3').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlansDt_S2_2').datepicker("setDate", new Date($('#wbsPlaneDt_S2_2').val()));
              }
    });
    
    //  Level3 종료일 (현재날짜의 월 말일)
    $('#wbsPlaneDt_S3_3').datepicker({
              format : "yyyy-mm-dd",
              language : "ko",
              autoclose : true
    })
    .datepicker("setDate", strDate)
    .on("changeDate", function(){
              if($('#wbsPlansDt_S3_3').val() > $('#wbsPlaneDt_S3_3').val()){
                        alert("날짜를 확인해주세요");
                        $('#wbsPlaneDt_S3_3').datepicker("setDate", new Date($('#wbsPlansDt_S3_3').val()));
              }
    });    
 
    $("#clntNm_S3").prop('disabled',true);
    $("#wbsClntPjt_S3").prop('disabled',true);
    $("#wbsPlanDiv_S3").prop('disabled',true);
    
    $("#wbsLevel1_S3").prop('disabled',true);
    $("#wbsPlanMngNm_S3_1").prop('disabled',true);
    $("#wbsPlansDt_S3_1").prop('disabled',true);
    $("#wbsPlaneDt_S3_1").prop('disabled',true);
    
    $("#wbsLevel2_S3").prop('disabled',true);
    $("#wbsPlanMngNm_S3_2").prop('disabled',true);
    $("#wbsPlansDt_S3_2").prop('disabled',true);
    $("#wbsPlaneDt_S3_2").prop('disabled',true);
    $("#wbsPlanNo_S3").prop('disabled',true);
    
    openThirdWbsPlanDivChange();
    openThirdWbsLevel1Change();
    openThirdWbsLevel2Change();	
    openThirdWbsLevel3Change();
    openThirdWbsPlanStsChange();
    
    //debugger;
    var row;
    var actionBtn = document.getElementById("actionBtn3");
    if (paramFlag == "M"){ // 수정
    	//등록버튼 활성화
         actionBtn.style.display = "inline-block";
         row = wbsGridView.target.getList()[paramRpw];       
    }
    else  if (paramFlag == "P") { // 등록
    	//등록버튼 활성화
        actionBtn.style.display = "inline-block";
        row = wbsInsPop01Lvl3GridView.target.getList()[paramRpw];
    }
    // To-Do 리스트에서 팝업창 호출 처리 
    else if (paramFlag == "D") {
    	//등록버튼 비활성화
    	//debugger;
        actionBtn.style.display = "none";
        addrow.style.display="none";
        shareBtn.style.display = "none";
        row = toDoGridView.target.getList()[paramRpw];
        if (row != undefined) {
            var formData = {
                    "coCd" : row.coCd,
                    "codeKind" : row.wbsPlanCodeKind,
                    "codeId" : row.wbsPlanCodeId,   
                    "salesCd" : row.salesCd,
                    "wbsPlanNo" : row.wbsPlanNo 
                }
            
                postAjax("/user/wb/wb01/selectWbsPlanInfoSelect", formData, null, function(data){
                    
                    //paramTreeObj = {"fileTrgtKey" : data.resultList[0].fileTrgtKey};
                   // treeModule.initAll('WB0101P03', 'file-grid3', 'FITR09', paramTreeObj);
                    
                    //$("#fileTrgtKey_S3").val(data.resultList[0].fileTrgtKey); // 파일트리키
                    
                    $("#coCd_S3").val(data.resultList[0].coCd); // 회사
                    $("#coCd_S3").prop('disabled',true);
                    $("#wbsPlanNo_S3").val(data.resultList[0].wbsPlanNo); // 관리번호
                    $("#wbsPlanNo_S3").prop('disabled',true);
                    $("#wbsPlanDt_S3").val(data.resultList[0].wbsPlanDt); // 작성일자
                    $("#wbsPlanDt_S3").prop('disabled',true);
                    $("#wbsPlanId_S3").val(data.resultList[0].wbsPlanId); // 작성자ID
                    $("#wbsPlanId_S3").prop('disabled',true);
                    $("#wbsPlanNm_S3").val(data.resultList[0].wbsPlanNm);// 작성자명
                    $("#wbsPlanNm_S3").prop('disabled',true);
                    $("#salesCd_S3").val(data.resultList[0].salesCd); // Sales Code
                    $("#salesCd_S3").prop('disabled',true);
                    $("#clntCd_S3").val(data.resultList[0].ordrsClntCd); // 고겍사ID
                    $("#clntCd_S3").prop('disabled',true);
                    $("#clntNm_S3").val(data.resultList[0].ordrsClntNm); // 고객사명
                    $("#clntNm_S3").prop('disabled',true);

                    $("#wbsClntPjt_S3").val(data.resultList[0].clntPjt); // 고객사PJT
                    $("#wbsClntPjt_S3").prop('disabled',true);
                    $("#wbsPlanDiv_S3").val(data.resultList[0].ordrsDtlDiv20); // 신작구분
                    $("#wbsPlanDiv_S3").prop('disabled',true);
                    
                    $("#wbsLevel1_S3").val(data.resultList[0].codeId.substring(0,8)); // 1 Level WBS 구분
                    $("#wbsLevel1_S3").prop('disabled',true);
                    openThirdWbsLevel2Change();
                    $("#wbsLevel2_S3").val(data.resultList[0].codeId.substring(0,10)); // 2 Level WBS 구분
                    $("#wbsLevel2_S3").prop('disabled',true);
                    openThirdWbsLevel3Change();                 
                    $("#wbsLevel3_S3").val(data.resultList[0].codeId); // 3 Level WBS 구분
                    $("#wbsLevel3_S3").prop('disabled',true);
                    $("#wbsPlanMngId_S3_3").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                    $("#wbsPlanMngId_S3_3").prop('disabled',true);
                    $("#wbsPlanMngNm_S3_3").val(data.resultList[0].wbsPlanMngNm); //담당자명
                    $("#wbsPlanMngNm_S3_3").prop('disabled',true);
                    $("#wbsPlansDt_S3_3").val(data.resultList[0].wbsPlansDt);// 시작일자
                    $("#wbsPlansDt_S3_3").prop('disabled',true);
                    $("#wbsPlaneDt_S3_3").val(data.resultList[0].wbsPlaneDt); // 종료일자
                    $("#wbsPlaneDt_S3_3").prop('disabled',true);
                    $("#wbsPlanCnts_S3").val(data.resultList[0].wbsPlanCnts);// 주요내용
                    $("#wbsPlanCnts_S3").prop('disabled',true);
                    $("#wbsPlanRmk_S3").val(data.resultList[0].wbsPlanRmk);// 비고
                    $("#wbsPlanRmk_S3").prop('disabled',true);
                    if (row.wbsPlanOsYn == "Y"){ // 외주유무
                        $("#wbsPlanOsYn_Y_S3").prop('checked',true);
                        $("#wbsPlanOsYn_N_S3").prop('checked',false);
                    }
                    else{
                        $("#wbsPlanOsYn_Y_S3").prop('checked',false);
                        $("#wbsPlanOsYn_N_S3").prop('checked',true);
                    }
                    
                    $("#wbsPlanOsYn_Y_S3").prop('disabled',true);
                    $("#wbsPlanOsYn_N_S3").prop('disabled',true);
                    // 1레벨 정보 조회
                    var formData = {
                            "coCd" : $("#coCd_S3").val(),
                            "salesCd" : $("#salesCd_S3").val(),
                            "wbsPlanCodeId" : $("#wbsLevel1_S3").val().substring(0,8)
                        }
                    
                        postAjax("/user/wb/wb01/selectWbsInfoList", formData, null, function(data){
                            $("#wbsPlanMngId_S3_1").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                            $("#wbsPlanMngId_S3_1").prop('disabled',true);
                            $("#wbsPlanMngNm_S3_1").val(data.resultList[0].wbsPlanMngNm); //담당자명
                            $("#wbsPlanMngNm_S3_1").prop('disabled',true);
                            $("#wbsPlansDt_S3_1").val(data.resultList[0].wbsPlansDt);// 시작일자
                            $("#wbsPlansDt_S3_1").prop('disabled',true);
                            $("#wbsPlaneDt_S3_1").val(data.resultList[0].wbsPlaneDt); // 종료일자
                            $("#wbsPlaneDt_S3_1").prop('disabled',true);
                        });
                    
                    // 2레벨 정보 조회
                    var formData1 = {
                            "coCd" : $("#coCd_S3").val(),
                            "salesCd" : $("#salesCd_S3").val(),
                            "wbsPlanCodeId" : $("#wbsLevel2_S3").val().substring(0,8)
                        }
                    
                        postAjax("/user/wb/wb01/selectWbsInfoList", formData1, null, function(data){
                            $("#wbsPlanMngId_S3_2").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                            $("#wbsPlanMngId_S3_2").prop('disabled',true);
                            $("#wbsPlanMngNm_S3_2").val(data.resultList[0].wbsPlanMngNm); //담당자명
                            $("#wbsPlanMngNm_S3_2").prop('disabled',true);
                            $("#wbsPlansDt_S3_2").val(data.resultList[0].wbsPlansDt);// 시작일자
                            $("#wbsPlansDt_S3_2").prop('disabled',true);
                            $("#wbsPlaneDt_S3_2").val(data.resultList[0].wbsPlaneDt); // 종료일자
                            $("#wbsPlaneDt_S3_2").prop('disabled',true);
                        });
                    
                    // 3레벨 정보 조회
                    var formData2 = {
                            "coCd" : $("#coCd_S3").val(),
                            "salesCd" : $("#salesCd_S3").val(),
                            "wbsPlanCodeId" : $("#wbsLevel3_S3").val().substring(0,10)
                        }
                    
                        postAjax("/user/wb/wb01/selectWbsInfoList", formData2, null, function(data){
                            $("#wbsPlanMngId_S3_3").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                            $("#wbsPlanMngId_S3_3").prop('disabled',true);
                            $("#wbsPlanMngNm_S3_3").val(data.resultList[0].wbsPlanMngNm); //담당자명
                            $("#wbsPlanMngNm_S3_3").prop('disabled',true);
                            $("#wbsPlansDt_S3_3").val(data.resultList[0].wbsPlansDt);// 시작일자
                            $("#wbsPlansDt_S3_3").prop('disabled',true);
                            $("#wbsPlaneDt_S3_3").val(data.resultList[0].wbsPlaneDt); // 종료일자
                            $("#wbsPlaneDt_S3_3").prop('disabled',true);
                        });
                    
                   secondGridView3.initView().setData(); 
                }); 
           }
    }
    else {
    	//등록버튼 활성화
    	actionBtn.style.display = "inline-block";
    }
    if (row != undefined && paramFlag == "M") {
    	paramTreeObj = {"fileTrgtKey" : row.fileTrgtKey};
    	//treeModule.initAll('WB0101P03', 'file-grid3', 'FITR09', paramTreeObj);

        $("#fileTrgtKey_S3").val(row.fileTrgtKey); // 파일트리키
        
        $("#coCd_S3").val(row.coCd); // 회사
        $("#wbsPlanNo_S3").val(row.wbsPlanNo); // 관리번호
        $("#wbsPlanDt_S3").val(row.wbsPlanDt); // 작성일자
        $("#wbsPlanId_S3").val(row.wbsPlanId); // 작성자ID
        $("#wbsPlanNm_S3").val(row.wbsPlanNm);// 작성자명
        $("#salesCd_S3").val(row.salesCd); // Sales Code
        
        $("#clntCd_S3").val(row.ordrsClntCd); // 고겍사ID
        $("#clntNm_S3").val(row.ordrsClntNm); // 고객사명
        $("#wbsClntPjt_S3").val(row.clntPjt); // 고객사PJT
        $("#wbsPlanDiv_S3").val(row.ordrsDtlDiv20); // 신작구분
        
        $("#wbsLevel1_S3").val(row.codeId.substring(0,8)); // 1 Level WBS 구분
        openThirdWbsLevel2Change();
        $("#wbsLevel2_S3").val(row.codeId.substring(0,10)); // 2 Level WBS 구분
        openThirdWbsLevel3Change();
        $("#wbsLevel3_S3").val(row.codeId); // 3 Level WBS 구분
        
        $("#wbsPlanMngId_S3_3").val(row.wbsPlanMngId); //담당자 ID
        $("#wbsPlanMngNm_S3_3").val(row.wbsPlanMngNm); //담당자명
        $("#wbsPlansDt_S3_3").val(row.wbsPlansDt);// 시작일자
        $("#wbsPlaneDt_S3_3").val(row.wbsPlaneDt); // 종료일자
        $("#wbsPlanCnts_S3").val(row.wbsPlanCnts);// 주요내용
        $("#wbsPlanRmk_S3").val(row.wbsPlanRmk);// 비고
        if (row.wbsPlanOsYn == "Y"){ // 외주유무
        	$("#wbsPlanOsYn_Y_S3").prop('checked',true);
        	$("#wbsPlanOsYn_N_S3").prop('checked',false);
        }
        else{
        	$("#wbsPlanOsYn_Y_S3").prop('checked',false);
            $("#wbsPlanOsYn_N_S3").prop('checked',true);
        }
        
        
        // 1레벨 정보조회
        var formData = {
                "coCd" : $("#coCd_S3").val(),
                "salesCd" : $("#salesCd_S3").val(),
                "wbsPlanCodeId" : $("#wbsLevel1_S3").val().substring(0,8)
            }
        
            postAjax("/user/wb/wb01/selectWbsInfoList", formData, null, function(data){
               // alert(data.resultList[0].wbsPlanMngId);
                $("#wbsPlanMngId_S3_1").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                $("#wbsPlanMngNm_S3_1").val(data.resultList[0].wbsPlanMngNm); //담당자명
                $("#wbsPlansDt_S3_1").val(data.resultList[0].wbsPlansDt);// 시작일자
                $("#wbsPlaneDt_S3_1").val(data.resultList[0].wbsPlaneDt); // 종료일자
            });
        // 2레벨 정보조회
        var formData1 = {
                "coCd" : $("#coCd_S3").val(),
                "salesCd" : $("#salesCd_S3").val(),
                "wbsPlanCodeId" : $("#wbsLevel2_S3").val().substring(0,8)
            }
        
            postAjax("/user/wb/wb01/selectWbsInfoList", formData1, null, function(data){
               // alert(data.resultList[0].wbsPlanMngId);
                $("#wbsPlanMngId_S3_2").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                $("#wbsPlanMngNm_S3_2").val(data.resultList[0].wbsPlanMngNm); //담당자명
                $("#wbsPlansDt_S3_2").val(data.resultList[0].wbsPlansDt);// 시작일자
                $("#wbsPlaneDt_S3_2").val(data.resultList[0].wbsPlaneDt); // 종료일자
            });
        // 3레벨 정보조회
        var formData2 = {
                "coCd" : $("#coCd_S3").val(),
                "salesCd" : $("#salesCd_S3").val(),
                "wbsPlanCodeId" : $("#wbsLevel3_S3").val().substring(0,10)
            }
        
            postAjax("/user/wb/wb01/selectWbsInfoList", formData2, null, function(data){
                //alert(data.resultList[0].wbsPlanMngId);
                $("#wbsPlanMngId_S3_3").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                $("#wbsPlanMngNm_S3_3").val(data.resultList[0].wbsPlanMngNm); //담당자명
                $("#wbsPlansDt_S3_3").val(data.resultList[0].wbsPlansDt);// 시작일자
                $("#wbsPlaneDt_S3_3").val(data.resultList[0].wbsPlaneDt); // 종료일자
            });
        
        $("#lockYn_S3").val(row.lockYn); // 잠금여부
        $("#closeYn_S3").val(row.closeYn); // 마감여부
        
        $("#coCd_S3").prop('disabled',true);
        $("#salesCd_S3").prop('disabled',true);
        //$("#wbsLevel1_S3").prop('disabled',true);
        //$("#wbsLevel2_S3").prop('disabled',true);
        $("#wbsLevel3_S3").prop('disabled',true);
        /* $("#clntNm_S3").prop('disabled',true);
        $("#wbsClntPjt_S3").prop('disabled',true);
        $("#wbsPlanDiv_S3").prop('disabled',true); */
        //$("#wbsPlanNo_S3").prop('disabled',true);
    }  
    else if (row == undefined && (paramFlag == "P" || paramFlag ==undefined)) {
    	//debugger;
    	$("#coCd_S3").prop('disabled',false);
        $("#salesCd_S3").prop('disabled',false);
       // $("#wbsLevel1_S3").prop('disabled',false);
        //$("#wbsLevel2_S3").prop('disabled',false);
        $("#wbsLevel3_S3").prop('disabled',false);
        /* $("#clntNm_S3").prop('disabled',false);
        $("#wbsClntPjt_S3").prop('disabled',false);
        $("#wbsPlanDiv_S3").prop('disabled',false); */
        //$("#wbsPlanNo_S3").prop('disabled',false);
        
    	$("#wbsLevel1_S3").val(modalStack.last().paramObj.codeKind);
    	openThirdWbsLevel2Change();
        $("#wbsLevel2_S3").val(modalStack.last().paramObj.codeId);
        openThirdWbsLevel3Change();
        $("#wbsLevel3_S3").val(modalStack.last().paramObj.codeId + "10");
        
      //  treeModule.initAll('WB0101P03', 'file-grid3', 'FITR09', paramTreeObj);
        $("#salesCd_S3").val(modalStack.last().paramObj.salesCd);
        
        var formData = {
                "coCd" : $("#coCd_S3").val(),
                "salesCd": $("#salesCd_S3").val()
            }
             postAjax("/user/wb/wb01/selectWbsSalesCodeList", formData, null, function(data) {
                 if (data.codeInfoList != null) {
                     $('#salesCd_S3').val(data.codeInfoList[0].salesCd); // Sales Code
                     $('#wbsClntPjt_S3').val(data.codeInfoList[0].clntPjt); // 고객사 PJT
                     $('#clntCd_S3').val(data.codeInfoList[0].ordrsClntCd); // 고객사코드
                     $('#clntNm_S3').val(data.codeInfoList[0].ordrsClntNm); // 고객사명
                     $("#wbsPlanDiv_S3").val(data.codeInfoList[0].ordrsDtlDiv20); // 신작구분
                 }
                 
             });
        
     // 1레벨 정보조회
        var formData1 = {
                "coCd" : $("#coCd_S3").val(),
                "salesCd" : $("#salesCd_S3").val(),
                "wbsPlanCodeId" : $("#wbsLevel1_S3").val().substring(0,8)
            }
        
            postAjax("/user/wb/wb01/selectWbsInfoList", formData1, null, function(data){
               // alert(data.resultList[0].wbsPlanMngId);
                $("#wbsPlanMngId_S3_1").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                $("#wbsPlanMngNm_S3_1").val(data.resultList[0].wbsPlanMngNm); //담당자명
                $("#wbsPlansDt_S3_1").val(data.resultList[0].wbsPlansDt);// 시작일자
                $("#wbsPlaneDt_S3_1").val(data.resultList[0].wbsPlaneDt); // 종료일자
            });
        // 2레벨 정보조회
        var formData2 = {
                "coCd" : $("#coCd_S3").val(),
                "salesCd" : $("#salesCd_S3").val(),
                "wbsPlanCodeId" : $("#wbsLevel2_S3").val().substring(0,8)
            }
        
            postAjax("/user/wb/wb01/selectWbsInfoList", formData2, null, function(data){
               // alert(data.resultList[0].wbsPlanMngId);
                $("#wbsPlanMngId_S3_2").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                $("#wbsPlanMngNm_S3_2").val(data.resultList[0].wbsPlanMngNm); //담당자명
                $("#wbsPlansDt_S3_2").val(data.resultList[0].wbsPlansDt);// 시작일자
                $("#wbsPlaneDt_S3_2").val(data.resultList[0].wbsPlaneDt); // 종료일자
            });
        
    }
    secondGridView3.initView().setData(); 
    
});   

//관리번호 (WbsPlanNo) 검색
function openThirdWbsPlanNoSearch() {
    var paramObj = {
       "coCd" : $('#coCd_S3').val(),
       "salesCd": $('#salesCd_S3').val()
    };
    openSecondModal("/static/html/cmn/modal/wbsPlanNoSearch.html", 450, 270, "관리번호 검색", paramObj, function (grid){
        var row = grid.target.getList("selected")[0];
        $('#wbsPlanNo_S3').val(row.wbsPlanNo);
    });
}


//작성자 검색
function openThirdWbsPlanUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S3').val(),
        "userId": $('#wbsPopup3 #wbsPlanId_S3').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "작성자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup3 #wbsPlanId_S3').val(checkedNode.id);
        $('#wbsPopup3 #wbsPlanNm_S3').val(checkedNode.text);
    });
}

//Level1 담당자 검색
function openThirdWbsLevel1PlanMngUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S3').val(),
        "userId": $('#wbsPopup3 #wbsPlanId_S3_1').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup3 #wbsPlanMngId_S3_1').val(checkedNode.id);
        $('#wbsPopup3 #wbsPlanMngNm_S3_1').val(checkedNode.text);
    });
}

//Level2 담당자 검색
function openThirdWbsLevel2PlanMngUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S3').val(),
        "userId": $('#wbsPopup3 #wbsPlanId_S3_2').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup3 #wbsPlanMngId_S3_2').val(checkedNode.id);
        $('#wbsPopup3 #wbsPlanMngNm_S3_2').val(checkedNode.text);
    });
}


//Level3 담당자 검색
function openThirdWbsLevel3PlanMngUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S3').val(),
        "userId": $('#wbsPopup3 #wbsPlanId_S3_3').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup3 #wbsPlanMngId_S3_3').val(checkedNode.id);
        $('#wbsPopup3 #wbsPlanMngNm_S3_3').val(checkedNode.text);
    });
}


//Sales Code (수주마스터, 수주상세테이블 조인) 검색
function openThirdWbsSalesCodeSearch() {
    var paramObj = {
       "coCd" : $('#coCd_S3').val(),
       "salesCd": $('#salesCd_S3').val()
    };
    openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 330, "SALES CODE 검색", paramObj, function (grid){
        var row = grid.target.getList("selected")[0];
        $('#salesCd_S3').val(row.salesCd); // Sales Code
        $('#wbsClntPjt_S3').val(row.clntPjt); // 고객사 PJT
        $('#clntCd_S3').val(row.ordrsClntCd); // 고객사코드
        $('#clntNm_S3').val(row.ordrsClntNm); // 고객사명
        $("#wbsPlanDiv_S3").val(row.ordrsDtlDiv20); // 신작구분
    });
}

// 고객사 검색
function openThirdClntSearch(type) {
    openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "고객사 검색", {}, function (grid) {
        var row = grid.target.getList("selected")[0];
        $('#wbsPopup3 #clntCd_S3').val(row.clntCd);
        $('#wbsPopup3 #clntNm_S3').val(row.clntNm);
    });
}

//신작구분
function openThirdWbsPlanDivChange() {
    var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsPlanDivList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="wbsPlanDiv"]').html(optionHtml);
    });
}

//WBS LEVEL 1 구분
function openThirdWbsLevel1Change() {
    var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsLevel1List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel1_S3"]').html(optionHtml);
    });
}

//WBS LEVEL 2 구분
function openThirdWbsLevel2Change() {
	//debugger;
    var paramObj = {"codeKind" : $('#wbsLevel1_S3').val()};
   // alert($('#wbsLevel1_S2').val());
    postAjaxSync("/user/wb/wb01/selectWbsLevel2List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel2_S3"]').html(optionHtml);
    });
}

//WBS LEVEL 3 구분
function openThirdWbsLevel3Change() {
	
    var paramObj = {"codeKind" : $('#wbsLevel2_S3').val()};
   // alert($('#wbsLevel1_S2').val());
    postAjaxSync("/user/wb/wb01/selectWbsLevel3List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel3_S3"]').html(optionHtml);
    });
}


//WBS 계획상태  WBS_PLAN_STS_CODE_ID
function openThirdWbsPlanStsChange() {
    //DSGN_DIF_CODE_ID
    var paramObj = {"codeKind" : "WBSPLANSTS"};
    postAjaxSync("/user/wb/wb01/selectWbsPlanStsList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="wbsPlanStsCodeId"]').html(optionHtml);
    });
}

function wbsLevel3PlanInsert(){
    //debugger;
    //var wbsPlanOsYn = "";
    if (paramRpw == undefined){
        var strYear = new Date().toISOString().substring(2, 4);
        var planData = {
        		"coCd" : $('#coCd_S3').val(),
                "year" : "W" + strYear
            }; 
         postAjaxSync("/user/wb/wb01/selectMaxWbsPlanNo", planData, null, function(data){
             var strLen = String(data.result);
             
            if (data.result == undefined) {
                $('#wbsPlanNo_S3').val("W" + strYear + "0001");
            }
            else {
                if (strLen.length == 1) {
                    $('#wbsPlanNo_S3').val("W" + strYear + "000" + data.result); 
                    }
                else if (strLen.length == 2) {
                    $('#wbsPlanNo_S3').val("W" + strYear + "00" + data.result); 
                }
                else if (strLen.length == 3) {
                    $('#wbsPlanNo_S3').val("W" + strYear + "0" + data.result); 
                }
                else if (strLen.length == 4) {
                    $('#wbsPlanNo_S3').val("W" + strYear + data.result); 
                }
            }
            
        }); 
        if (wbsPlanOsYn_Y_S3.checked){
            wbsPlanOsYn = "Y";
        }
        else if (wbsPlanOsYn_N_S3.checked){
            wbsPlanOsYn = "N";
        }
        
        if ($('#coCd_S3').val() == "") {
            alert("회사를 선택하세요");
            return;
        }
        
        if ($('#wbsPlanId_S3').val() == "") {
            alert("작성자를 입력하세요");
            return;
        }
        
         if ($('#salesCd_S3').val() == "") {
            alert("Sales Code를 입력하세요");
            return;
        }
        
        if ($('#clntCd_S3').val() == "") {
            alert("고객사를 입력하세요");
            return;
        } 
        
        if ($('#wbsPlanCnts_S3').val() == "") {
            alert("주요내용를 입력하세요");
            return;
        } 
        
        //debugger;
        /* var formData = new FormData();
        $.each($('#wbsPopup3 [data-search]'), function(idx, elem){
            formData.append($(elem).data("search"), $(elem).val());
        });
        
        formData.append("creatId", jwt.userId);
        formData.append("wbsPlanOsYn", wbsPlanOsYn);
        formData.append("wbsPlanCodeKind3", $('#wbsLevel2_S3').val());
        formData.append("wbsPlanCodeId3", $('#wbsLevel3_S3').val());
         
         filePostAjax("/user/wb/wb01/wbsLevel3PlanInsert", formData, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                modalStack.close();
                wbsGridView.setData(0);
                if (paramFlag == "P") {
                	wbsInsPop01Lvl2GridView.setData(0);
                }
            }
        });   */
        
        /* WBS 데이터 중복 체크 조회 */
        var paramObj = {
                "coCd" : $('#coCd_S3').val(),
                "salesCd" : $('#salesCd_S3').val(),
                "codeId" : $('#wbsLevel3_S3').val()
          };  
        
        var chk;
        postAjaxSync("/user/wb/wb01/selectWbsPlanChk", paramObj, null, function(data){ 
            chk = data.result;
        });
        
        if (chk <= 0) {
            var formData;
            /* 파일업로드를 위한 FielTreeKey Max값 조회 */
            postAjaxSync("/user/wb/wb01/selectMaxTrgtKey", paramObj, null, function(data){    
                fileTreeKey = data.result;
                //alert(fileTreeKey);
                formData = makeFormData(fileTreeKey);
                
            }); 
            filePostAjax("/user/wb/wb01/wbsLevel3PlanInsert", formData, function(data){
                //debugger;
                if(data.resultCode == 200){
                    alert(data.resultMessage);
                    modalStack.close();
                    wbsGridView.setData(0); 
                }
            });  
            
        }
        else {
            alert("WBS 데이터가 존재합니다.");
            return;
            //modalStack.close();
        }
        
    }
    else {
        if (wbsPlanOsYn_Y_S3.checked){
            wbsPlanOsYn = "Y";
        }
        else if (wbsPlanOsYn_N_S3.checked){
            wbsPlanOsYn = "N";
        }
        
        if ($('#coCd_S3').val() == "") {
            alert("회사를 선택하세요");
            return;
        }
        
        if ($('#wbsPlanId_S3').val() == "") {
            alert("작성자를 입력하세요");
            return;
        }
        
         if ($('#salesCd_S3').val() == "") {
            alert("Sales Code를 입력하세요");
            return;
        }
        
        if ($('#clntCd_S3').val() == "") {
            alert("고객사를 입력하세요");
            return;
        } 
        
        if ($('#wbsPlanCnts_S3').val() == "") {
            alert("주요내용를 입력하세요");
            return;
        } 
        
        /* var formData = new FormData();
        $.each($('#wbsPopup3 [data-search]'), function(idx, elem){
            formData.append($(elem).data("search"), $(elem).val());
        });
        
        formData.append("creatId", jwt.userId);
        formData.append("wbsPlanOsYn", wbsPlanOsYn);
        formData.append("wbsPlanCodeKind3", $('#wbsLevel2_S3').val());
        formData.append("wbsPlanCodeId3", $('#wbsLevel3_S3').val());
        
        filePutAjax("/user/wb/wb01/wbsLevel3PlanUpdate", formData, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                modalStack.close();
                wbsGridView.setData(0); 
            }
        }); */
        
        formData = makeFormData($("#fileTrgtKey_S3").val());
        filePutAjax("/user/wb/wb01/wbsLevel3PlanUpdate", formData, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                modalStack.close();
                wbsGridView.setData(0); 
            }
        });
         
    }   
}

function makeFormData(fileTreeKey) {
    //debugger;
    $('#fileTrgtKey_S3').val(fileTreeKey);
   
    var formData = new FormData();
    $.each($('#wbsPopup3 [data-search]'), function(idx, elem){
        formData.append($(elem).data("search"), $(elem).val());
    });
    
    formData.append("creatId", jwt.userId);
    formData.append("wbsPlanOsYn", wbsPlanOsYn);
    
    // 유저아이디 추가
    formData.append("userId", jwt.userId);
    
    formData.append("fileTrgtKey", fileTreeKey);
    
    formData.append("S_todoDiv1CodeId", "TODODIV10");
    formData.append("S_todoDiv2CodeId", "TODODIV1010");
    
    var rowSharngList = secondGridView3.target.list;
    if(rowSharngList.length > 0) {
        var rowSharngListArr = [];
        $.each(rowSharngList, function(idx, elem){
            var rowSharngListObj = elem;
            rowSharngListObj["coCd"] = $("#coCd_S3").val();
            rowSharngListObj["salesCd"] = elem.salesCd;
            rowSharngListObj["wbsPlanNo"] = $("#wbsPlanNo_S3").val();
            rowSharngListObj["wbsPlanCodeId"] = elem.wbsPlanCodeId;
            rowSharngListObj["wbsPlanCodeNm"] = elem.wbsPlanCodeNm;
            rowSharngListObj["todoCfDt"] = elem.todoCfDt;
            rowSharngListObj["todoCfOpn"] = elem.todoCfOpn;
            rowSharngListObj["wbsPlancoCd"] = elem.wbsPlancoCd;
            rowSharngListObj["wbsPlancoCdNm"] = elem.wbsPlancoCdNm;
            rowSharngListObj["wbsSharngUserId"] = elem.wbsSharngUserId;
            rowSharngListObj["empNo"] = elem.empNo;
            rowSharngListObj["name"] = elem.name;
            rowSharngListObj["telNo"] = elem.telNo;
            rowSharngListObj["email"] = elem.email;    
            rowSharngListObj["pgPath"] = "/user/wb/wb01/WB0101P03.html";
            rowSharngListArr.push(rowSharngListObj);
        });
        formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));
    }       
    
    // 첨부파일 추가
/*     $.each(treeModule.getFileArr(), function (idx, obj) {
        // 신규파일만 추가
        if (obj.fileKey == 0) {
            formData.append("comonCd_" + idx, obj.nodeId);
            formData.append("files", obj.file);
        }
    }); */

    formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
    //treeModule.initFileArrays(); 
    // 첨부파일 추가
    return formData;
}

//공유대상자 팝업
function opendModalSharngListList() { 
/*     if ($("#closeYn_S1").val() == "Y" || $("#lockYn_S1").val() == "Y") {
        alert("실적데이터가 잠김 또는 마감된 상태입니다.");
        return;
    } */
    var formData = {};
    openSecondModal("/static/html/user/wb/wb02/WB0202P01.html", 1300, 780, "결재선 지정", formData, function (grid){
        var rowList = grid.target.getList();
        $.each(rowList, function(idx, elem){
            if (elem.check == "Y") {
                var paramObj = {"coCd" : elem.coCd, "userId" : elem.appId};            
                postAjax("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
                    secondGridView3.target.addRow($.extend({}, "last", false));
                       // debugger;
                        var row = secondGridView3.target.getList().length - 1;
                        secondGridView3.target.setValue(row, "salesCd", $("#salesCd_S3").val());
                        secondGridView3.target.setValue(row, "wbsPlanNo", $("#wbsPlanNo_S3").val());
                        secondGridView3.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel3_S3").val());
                        secondGridView3.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel3_S3 option:checked").text());
                        secondGridView3.target.setValue(row, "wbsPlancoCd", data.resultList[0].coCd);
                        secondGridView3.target.setValue(row, "wbsPlancoCdNm", data.resultList[0].coCdNm);
                        secondGridView3.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
                        secondGridView3.target.setValue(row, "empNo", data.resultList[0].empNo);
                        secondGridView3.target.setValue(row, "name", data.resultList[0].name);
                        secondGridView3.target.setValue(row, "telNo", data.resultList[0].telNo);
                        secondGridView3.target.setValue(row, "email", data.resultList[0].email);                                        
                });
            }
        });
    });
}


$('[data-grid-control]').click(function () {

    switch (this.getAttribute("data-grid-control")) {    
        case "row-add2":
/*             if ($("#closeYn_S1").val() == "Y" || $("#lockYn_S1").val() == "Y") {
                alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                return;
            } */
            var paramObj = {
                    "coCd" : $('#coCd_S3').val(),
                    "userId": $('#wbsPopup #wbsPlanId_S3').val(),
                    "useYn": "Y"
                };
                openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
                   var checkedId = tree.get_checked()[0];
                   var checkedNode = tree.get_node(checkedId);   
                   
                   var paramObj = {"coCd" : $('#coCd_S3').val(), "userId" : checkedId};
                   
                   postAjax("/user/wb/wb02/selectRsltsMemberList", paramObj, null, function(data){
                	   secondGridView3.target.addRow($.extend({}, "last", false));                             
                          
                           var row = secondGridView3.target.getList().length - 1;
                           secondGridView3.target.setValue(row, "salesCd", $("#salesCd_S3").val());
                           secondGridView3.target.setValue(row, "wbsPlanNo", $("#wbsPlanNo_S3").val());
                           secondGridView3.target.setValue(row, "wbsPlanCodeId", $("#wbsLevel3_S3").val());
                           secondGridView3.target.setValue(row, "wbsPlanCodeNm", $("#wbsLevel3_S3 option:checked").text());
                           secondGridView3.target.setValue(row, "wbsPlancoCd", data.resultList[0].coCd);
                           secondGridView3.target.setValue(row, "wbsPlancoCdNm", data.resultList[0].coCdNm);
                           secondGridView3.target.setValue(row, "wbsSharngUserId", data.resultList[0].id);
                           secondGridView3.target.setValue(row, "empNo", data.resultList[0].empNo);
                           secondGridView3.target.setValue(row, "name", data.resultList[0].name);
                           secondGridView3.target.setValue(row, "telNo", data.resultList[0].telNo);
                           secondGridView3.target.setValue(row, "email", data.resultList[0].email);                                        
                   });                 
                });
          break;
        case "row-remove2":
            /* if ($("#closeYn_S1").val() == "Y" || $("#lockYn_S1").val() == "Y") {
                alert("실적데이터가 잠김 또는 마감된 상태입니다.");
                return;
            } */
            var row = secondGridView3.target.getList("selected");
            if (row.todoDt == undefined && row.todoDt == null) {
            	secondGridView3.target.deleteRow("selected");
            }              
            else{
                alert("공유 데이터가 확인되었으며 삭제할 수 없습니다.");
            }           
          break;
    }
});
</script>
