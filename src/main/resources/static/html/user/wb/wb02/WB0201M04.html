<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="/static/fontawesome/css/all.css">
<link rel="stylesheet" href="/static/css/ax5/ax5grid.css">
<link rel="stylesheet" href="/static/css/ax5/ax5mask.css">
<link rel="stylesheet" href="/static/css/ax5/ax5modal.css">
<link rel="stylesheet" href="/static/css/ax5/ax5toast.css">
<link rel="stylesheet" href="/static/css/jstree/style.min.css">
<link rel="stylesheet" href="/static/css/gnb.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/sub.css">
<link rel="stylesheet" href="/static/css/common.css">

<script src="/static/js/jquery-latest.min.js"></script>
<script src="/static/js/jquery.serializeObject.js"></script>
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
<script src="/static/js/moment/moment-with-locales.js"></script>
<script src="/static/js/ax5/ax5core.min.js"></script>
<script src="/static/js/ax5/ax5grid.min.js"></script>
<script src="/static/js/ax5/ax5mask.min.js"></script>
<script src="/static/js/ax5/ax5modal.min.js"></script>
<script src="/static/js/ax5/ax5toast.min.js"></script>
<script src="/static/js/jstree/jstree.min.js"></script>
<script type="text/javascript" src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="/static/js/global.js"></script>
<script src="/static/js/fileTree.js"></script>
</head>

<body>
	<div id="head_area"></div>
	<div id="top_area"></div>
	
	<div id="main_area">
		<!-- 페이지 상단 -->
		<div class="contents no_bg">
			<ul class="btn_ul">
				<li class="btn_r">
					 <a onclick="initSearch();"><button class="bg_gray">초기화</button></a>
					 <a onclick="gridView.setData(0);"><button class="bg_gray">검 색</button></a>
	            </li>
            </ul>
        </div>
    
		<!-- 검색 콘텐츠 -->
		<div class="contents search">
			<div class="">
				<!-- 테이블 인풋 3분할 -->
				<table class="table_input type04">
				
					<!-- 검색조건 1행 -->
					<tr>
						<th class= "hit">회사</th>
						<td>
							<select id="coCd_S" name="coCd_S" data-kind="CO" data-search="coCd" required msg="회사">
						      <option value="">전체</option>
							</select>
						</td>
						
						<th class= "hit">작성일자</th>
						<td>
							<div class="date_input">
			                    <input id="reqDtFrom_S" name="reqDtFrom"  class="input_calendar" autocomplete="off"
			                      msg="시작일자" data-search="reqDtFrom" onchange="gridView.setData(0);">
			                    <span>~</span>
			                    <input id="reqDtTo_S" name="reqDtTo"  class="input_calendar" autocomplete="off"
			                      msg="종료일자" data-search="reqDtTo" onchange="gridView.setData(0);">
			                  </div>
						</td>
						
						<th>&nbsp;</th>
						<td>&nbsp;</td>
						
						<th>고객사</th>
						<td>
						    <input type="hidden" id="clntCd_S" name="clntCd_S"  data-search="clntCd" msg="고객사">
		                    <div class="search_form" >
		                    <input type="text" id="clntNm_S" name="clntNm_S"  data-search="clntNm" onkeyup="event.keyCode == 8 ? vendCd_S.value='' : event.keyCode == 13 ? openClntSearch('P') : '' "> 
		                    <a onclick="openClntSearch('P');"><i class="i_search_w"></i></a>
		                    </div>
						</td>
					</tr>
					  
					<!-- 검색조건 2행 -->                    
					<tr>
					  <th>Sales Code</th>
		                <td>
							<div class="search_form">
		                        <input type="text" id="salesCd_S" name="salesCd_S" data-search="salesCd" onkeyup="event.keyCode == 13 ? gridView.setData(0) : ''">
		                        <a onclick="wbsSalesCodeSearch();"><i class="i_search_w"></i></a>
		                    </div>
		                    <input type="hidden" id="salesNm_S" name="salesNm_S" >
						</td>
		
						<th>제품 구분</th>
						<td>
						    <input type="hidden" id="prdtCd_S" name="prdtCd_S" data-search="prdtCd" >
		                    <div class="search_form">
		                      <input type="text" id="prdtNm_S" name="prdtNm_S" data-search="prdtNm"  onkeyup="event.keyCode == 8 ? prdtCd_S.value='' : event.keyCode == 13 ? openPrdtSearch() : '' ">
		                        <a onclick="openPrdtSearch();"><i class="i_search_w"></i></a>
		                    </div>
						</td>
						
						<th>아이템 구분</th>
						<td>
							<select id="itemCd_S" name="itemCd_S" data-kind="ITEMLIST" data-search="itemCd" >
		                        <option value="">전체</option>
		                    </select>   
						</td>
		
						<th>공유대상자</th>
						<td>
								<input type="hidden" id="salesMngId_S" name="salesMngId_S" data-search="mngId">
		                            <div class="search_form">
		                             <input type="text" id="salesMngNm_S" name="salesMngNm_S" data-search="mngNm" 
		                             onkeyUp="if(window.event.keyCode == 8){salesMngId_S.value = ''}  else if(window.event.keyCode == 13){gridView.setData(0);};">
		                                <a onclick="openUserTree();"><i class="i_search_w"></i></a>
		                            </div>
						</td>           
		            </tr>
		
		            <!-- 검색조건 3행 -->   
					<tr>
					
						<th>고객사 PJT</th>
						<td>
						    <input type="text"  id="clntPjt_S" name="clntPjt_S"  data-search="clntPjt">
						</td>
					 
						<th>설비명</th>
						<td>
						    <input type="text"  id="eqpNm_S" name="eqpNm_S"  data-search="eqpNm">
						</td>
					 
						<th>관리번호</th>
						<td>
							<div class="search_form"  style="width: 100%;">
								<input type="text"  id="wbsPlanNo_S" name="wbsPlanNo_S" onkeyUp="if(event.keyCode == 13){gridView.setData(0);};">
								<a onclick="wbsPlanNoSearch();"><i class="i_search_w"></i></a>
							</div>
						</td>        
					
						<th></th>
						<td>
						</td>  
					                  
					</tr>
					      
		            <!-- 검색조건 END -->
	            </table>
	            <input type="hidden" id="userId"    name="userId">
                <input type="hidden" id="pgmId"     name="pgmId" value="WB0201M03">
            </div>
        </div>
        <!-- 콘텐츠 -->
		<div class="contents no_bg">
		      <div class="contents_tit">
		         <span  style="height: 30px; line-height: 30px;font-size: 15px;">WBS 계획 리스트 </span>
		        <div class="add_btn_small pdl10">
		        <!--  
		          <a onclick="insertWbsPlanModal('C', '1', 0);" style="height: 30px; line-height: 28px;" >1레벨</a>
		          <a onclick="insertWbsPlanModal('C', '2', 0);" style="height: 30px; line-height: 28px;" >2레벨</a>
                  <a onclick="insertWbsPlanModal('C', '3', 0);" style="height: 30px; line-height: 28px;" >3레벨</a>
                  <a onclick="deleteWbs();" style="height: 30px; line-height: 28px;" >-</a>-->
		          <a onclick="excelDown();" style="height: 30px; line-height: 28px; width: 90px;"><i class="fas fa-file-excel"></i> 엑셀다운로드</a>
		          
		        </div>
		        <select id="recordCnt" class="prae_select" onchange="gridView.setData(0);">
		          <option value="10">10</option>
		          <option value="20" selected>20</option>
		          <option value="50">50</option>
		          <option value="100">100</option>
		          <option value="9999999">전체</option>
		        </select>
        </div>

		
		<!-- 콘텐츠 -->
		<div class="contents">
		    <!-- 리스트 -->
		      <div class="ax5_grid" data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 330px; width: 100%" ></div>
		      <div data-ax5grid="excel-grid" data-ax5grid-config="{}" style="display: none;"></div>
		</div>
		
		
		<!-- 콘텐츠 -->
        <div class="contents no_bg">
        <!-- 콘텐츠 타이틀 -->
        <div class="contents_tit">
            <span  style="height: 30px; line-height: 30px;font-size: 15px;">WBS 실적 리스트 </span>
            <div class="add_btn_small pdl10">
                <!-- <a onclick="deleteWbs();" style="height: 30px; line-height: 28px;" >-</a> -->
                <a onclick="excelDown2();" style="height: 30px; line-height: 28px; width: 90px;"><i class="fas fa-file-excel"></i> 엑셀다운로드</a>
                </div>
                <select id="recordCnt2" class="prae_select" data-search="recordCnt" onchange="gridView2.setData(0);">
                    <option value="10">10</option>
                    <option value="20" selected>20</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                    <option value="9999999"  >전체</option>
                </select>
            </div>
        </div>
        
        <!-- 콘텐츠 -->
        <div class="contents">
            <!-- 리스트 -->
              <div class="ax5_grid" data-ax5grid="second-grid" data-ax5grid-config="{}" style="height: 330px; width: 100%" ></div>
              <div data-ax5grid="excel-grid2" data-ax5grid-config="{}" style="display: none;"></div>
        </div>
    </div>
                    
</body>
</html>

<script type="text/javascript">
	var isFirst = true;
	ax5.ui.grid.formatter["chkYn"] = function () {
	    var color = this.value == "Y" ? "color-circle_02.png" : "color-circle_01.png";
	    if (this.value == "E"){
	        return 'E';
	    } else {
	        return '<img src="/static/img/'+color+'" style="width: 10px;height: 10px;"></img>';
	    }
	};
	var gridView = {
		    initView : function() {
		        this.target = new ax5.ui.grid();
		        this.target.setConfig({
		        	showRowSelector: true,
		            multipleSelect: true,
		            sortable: false,
		            target: $('[data-ax5grid="first-grid"]'),
		            header : {
		                align : "center",
		                selector : true
		            },
		           columns: [
		        	   {key: "rnum",  label: "NO.", hidden:true},
		        	   {key: "fileTreeKey",  label: "fileTreeKey", hidden:true},
		        	   {key: "lvl",  label: "lvl", hidden:true},
		               {key: "id",  label: "id", hidden:true},
		               {key: "pid",  label: "pid", hidden:true},
		               {key: "coCd",  label: "회사코드", hidden:true},
		               {key: "coCdNm",  label: "회사명", width: 80, align: "center"},
		               {key: "salesCd",  label: "SALES CD", width: 100, align: "center"},
		               {
		                   label: "잠금", columns: [
		                       {key: "",      label: "잠금취소",      align: "center",   width: 100, formatter:function() {
		                           if (this.item.lockYn == "Y") {
		                               return '<button type="button" onclick="unlockYn(' + this.dindex + ')" authchk>UNLOCK</button>';
		                           }
		                           else {
		                               return '○';
		                           } 
		                       }},
		                       {key: "",      label: "잠금",      align: "center",   width: 100, formatter:function() {
		                           if (this.item.lockYn != "Y") {
		                               return '<button type="button" onclick="lockYn(' + this.dindex + ')" authchk>LOCK</button>';
		                           }
		                           else {
		                               return '○';
		                           } 
		                       }}
		                   ]
		               },
		               {key: "codeNm",  label: "WBS 계획구분", align: "left", width: 130, enableFilter: true, treeControl: true},
		               {key: "wbsPlanStsCodeId",      label: "계획상태코드",      hidden: true},
	                   {key: "wbsPlanStsNm",      label: "계획상태",      align: "center",   width: 70}, 
	                   {key: "wbsPlansDt",      label: "시작일자",      align: "center",   width: 100},
	                   {key: "wbsPlaneDt",      label: "종료일자",      align: "center",   width: 100},
	                   {key: "wbsPlanMngId",      label: "담당자",      hidden: true},
	                   {key: "wbsPlanMngNm",      label: "담당자",      align: "center",   width: 80},                   
		               {key: "lockYn",      label: "잠금",      align: "center",   width: 50, formatter: "chkYn"},
		               {key: "closeYn",      label: "마감",      align: "center",   width: 50, formatter: "chkYn"},
		               {key: "wbsRsltsDt",      label: "실적",      align: "center",   width: 50, formatter: "chkYn"},  
		               {key: "ordrsClntCd",      label: "고객사",     hidden: true},
		               {key: "ordrsClntNm",      label: "고객사",      align: "center",   width: 130},
		               {key: "clntPjt",      label: "고객사PJT",      align: "center",   width: 100},
		               {key: "ordrsDtlDiv20",      label: "신작구분",      hidden: true},
		               {key: "ordrsDtlDiv20Nm",      label: "신작",      align: "center",   width: 40},
		               {key: "prdtCd",      label: "제품구분",      hidden: true},
		               {key: "prdtCdNm",      label: "제품",      align: "center",   width: 130},
		               {key: "itemDiv",      label: "ITEM구분",      hidden: true},
		               {key: "itemDivNm",      label: "ITEM",      align: "center",   width: 100},	   
		               {key: "wbsPlanCnts",      label: "주요내용",      align: "left",   width: 200},
		               {key: "wbsPlanRmk",      label: "비고",      align: "left",   width: 100},                   
		               {key: "wbsPlanId",      label: "작성자",      hidden: true},
		               {key: "wbsPlanNm",      label: "작성자",      align: "center",   width: 80},
		               {key: "wbsPlanDt",      label: "작성일",   align: "center",   width: 80}, 
		               {key: "creatId",      label: "생성자",      hidden: true},
	                   {key: "creatNm",      label: "생성자",      align: "center",   width: 80},
	                   {key: "creatPgm",      label: "생성프로그램ID",      hidden: true},
	                   {key: "creatDttm",      label: "생성일시",      align: "center",   width: 80},                   
	                   {key: "udtId",      label: "최종변경자",      hidden: true},
	                   {key: "udtNm",      label: "최종변경자",      align: "center",   width: 80},
	                   {key: "udtPgm",      label: "최종수정프로그램ID",      hidden: true},
	                   {key: "udtDttm",      label: "최종변경일자",      align: "center",   width: 80},
		               {key: "dsgnDifCodeId",      label: "설계난이도코드",      hidden: true},
		               {key: "dsgnDifCodeNm",      label: "설계난이드명",      hidden: true},
		               {key: "dsgnPlanHour",      label: "설계계획공수",      hidden: true},                   
		               {key: "prdctnDifCodeId",      label: "생산난이도코드",      hidden: true},
		               {key: "prdctnDifCodeNm",      label: "생산난이도명",      hidden: true},
		               {key: "prdctnPlanHour",      label: "생산계획공수",      hidden: true},                   
		               {key: "wbsPlanOsYn",      label: "계획외주코드",      hidden: true},
		               {key: "wbsPlanOsNm",      label: "계획외주유무",      hidden: true},   
		               {key: "wbsPlanCodeKind",      label: "WBS 상위코드",    hidden: true},
	                   {key: "wbsPlanCodeId",      label: "WBS 코드",      hidden: true},
		               {key: "wbsPlanNo",      label: "WBS NO",      hidden: true}
		               
		           ],
		            body: {
		            	mergeCells : ["coCdNm","salesCd"],
		                columnHeight: 26,
		                onClick: function () {
		                    var list = gridView.target.getList("selected");
                            $.each(list, function(idx, obj){
                            	gridView.target.select(obj.__index, {selected: false});
                            });
                            
                            this.self.select(this.dindex);  
		                    gridView2.setData(0);
		                    
		                },
		                onDBLClick: function () {
		                	gridView2.setData(0);
		                    this.self.select(this.dindex);
		                    
		                },
		           },
		           page : {
	                    navigationItemCount : 10,
	                    height : 30,
	                    display : true,
	                    firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
	                    prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
	                    nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
	                    lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
	                    onChange : function() {
	                        gridView.setData(this.page.selectPage);
	                    }
	                },
		           tree: {
		               use: true,
		               indentWidth: 10,
		               arrowWidth: 15,
		               iconWidth: 18,
		               icons: {
		                   openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
		                   collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
		                   groupIcon: '<i class="fa fa-folder-open" aria-hidden="true"></i>',
		                   collapsedGroupIcon: '<i class="fa fa-folder" aria-hidden="true"></i>',
		                   itemIcon: '<i class="fa fa-file" aria-hidden="true"></i>'     
		               },
		               columnKeys: {
		                   parentKey: "pid",
		                   selfKey: "id"
		               }
		           }
		        });
		        return this;
		    },
		    setData : function(_pageNo) {
		    	if (isFirst) return;
	            var targetObj = this.target;
	            if (inputValidation($('input[required]'))) {
		            var paramObj = {"coCd": $('#coCd_S').val(),
		            	  "reqDtFrom" : $("#reqDtFrom_S").val().replace(/\-/g, ''),
		                  "reqDtTo": $("#reqDtTo_S").val().replace(/\-/g, ''),
	                      "clntCd" : $("#clntCd_S").val(),
	                      "clntNm" : $("#clntNm_S").val(),
	                      "salesCd" : $("#salesCd_S").val(),
	                      "prdtCd" : $("#prdtCd_S").val(),
	                      "prdtNm" : $("#prdtNm_S").val(),
	                      "itemCd" : $("#itemCd_S").val(),
	                      "clntPjt" : $("#clntPjt_S").val(),
	                      "eqpNm" : $("#eqpNm_S").val(),
	                      "salesMngId" : $("#salesMngId_S").val(),
	                      "salesMngNm" : $("#salesMngNm_S").val(),
	                      "wbsPlanNo" : $("#wbsPlanNo_S").val(),
	                      "pageNo" : _pageNo + 1,
	                      "recordCnt" : $('#recordCnt').val()};
		            postAjax("/user/wb/wb01/selectWbsPlanTreeList", paramObj, null, function(data){
		                var list = data.fileList;
		                    targetObj.setData({
		                        list : list,
		                        page : {
		                            currentPage : _pageNo,
		                            pageSize : data.paginationInfo.pageSize,
		                            totalElements : data.paginationInfo.totalRecordCount,
		                            totalPages : data.paginationInfo.totalPageCount
		                        }
		                    });
		                    targetObj.select(0); 
		                    
		                    gridView2.setData(0);
		            });
	            }
	        } 
		    
		}
	
	var excelView = {
	        initView: function(){
	        this.target = new ax5.ui.grid();
	        this.target.setConfig({
	        target: $('[data-ax5grid="excel-grid"]'),
	        columns: [
	        	 {key: "rnum",  label: "NO.", hidden:true},
	        	 {key: "fileTreeKey",  label: "fileTreeKey", hidden:true},
                 {key: "id",  label: "id", hidden:true},
                 {key: "pid",  label: "pid", hidden:true},
                 {key: "coCd",  label: "회사코드", hidden:true},
                 {key: "coCdNm",  label: "회사명", width: 80, align: "center"},
                 {key: "salesCd",  label: "SALES CD", width: 100, align: "center"},
                 {key: "codeNm",  label: "WBS 계획구분", align: "left", width: 130, enableFilter: true, treeControl: true},
                 {key: "wbsPlanStsCodeId",      label: "계획상태코드",      hidden: true},
                 {key: "wbsPlanStsNm",      label: "계획상태",      align: "center",   width: 70}, 
                 {key: "wbsPlansDt",      label: "시작일자",      align: "center",   width: 100},
                 {key: "wbsPlaneDt",      label: "종료일자",      align: "center",   width: 100},
                 {key: "wbsPlanMngId",      label: "담당자",      hidden: true},
                 {key: "wbsPlanMngNm",      label: "담당자",      align: "center",   width: 80},                   
                 {key: "lockYn",      label: "잠금",      align: "center",   width: 40},
                 {key: "closeYn",      label: "마감",      align: "center",   width: 40},
                 {key: "wbsRsltsDt",      label: "실적",      align: "center",   width: 40},  
                 {key: "ordrsClntCd",      label: "고객사",     hidden: true},
                 {key: "ordrsClntNm",      label: "고객사",      align: "center",   width: 130},
                 {key: "clntPjt",      label: "고객사PJT",      align: "center",   width: 100},
                 {key: "ordrsDtlDiv20",      label: "신작구분",      hidden: true},
                 {key: "ordrsDtlDiv20Nm",      label: "신작",      align: "center",   width: 40},
                 {key: "prdtCd",      label: "제품구분",      hidden: true},
                 {key: "prdtCdNm",      label: "제품",      align: "center",   width: 130},
                 {key: "itemDiv",      label: "ITEM구분",      hidden: true},
                 {key: "itemDivNm",      label: "ITEM",      align: "center",   width: 100},     
                 {key: "wbsPlanCnts",      label: "주요내용",      align: "left",   width: 200},
                 {key: "wbsPlanRmk",      label: "비고",      align: "left",   width: 100},                   
                 {key: "wbsPlanId",      label: "작성자",      hidden: true},
                 {key: "wbsPlanNm",      label: "작성자",      align: "center",   width: 80},
                 {key: "wbsPlanDt",      label: "작성일",   align: "center",   width: 80}, 
                 {key: "creatId",      label: "생성자",      hidden: true},
                 {key: "creatNm",      label: "생성자",      align: "center",   width: 80},
                 {key: "creatPgm",      label: "생성프로그램ID",      hidden: true},
                 {key: "creatDttm",      label: "생성일시",      align: "center",   width: 80},                   
                 {key: "udtId",      label: "최종변경자",      hidden: true},
                 {key: "udtNm",      label: "최종변경자",      align: "center",   width: 80},
                 {key: "udtPgm",      label: "최종수정프로그램ID",      hidden: true},
                 {key: "udtDttm",      label: "최종변경일자",      align: "center",   width: 80},
                 {key: "dsgnDifCodeId",      label: "설계난이도코드",      hidden: true},
                 {key: "dsgnDifCodeNm",      label: "설계난이드명",      hidden: true},
                 {key: "dsgnPlanHour",      label: "설계계획공수",      hidden: true},                   
                 {key: "prdctnDifCodeId",      label: "생산난이도코드",      hidden: true},
                 {key: "prdctnDifCodeNm",      label: "생산난이도명",      hidden: true},
                 {key: "prdctnPlanHour",      label: "생산계획공수",      hidden: true},                   
                 {key: "wbsPlanOsYn",      label: "계획외주코드",      hidden: true},
                 {key: "wbsPlanOsNm",      label: "계획외주유무",      hidden: true},   
                 {key: "wbsPlanCodeKind",      label: "WBS 상위코드",      hidden: true},
                 {key: "wbsPlanCodeId",      label: "WBS 코드",      hidden: true},
                 {key: "wbsPlanNo",      label: "WBS NO",      hidden: true}
	                 ]
	        });
	           return this;
	    }
	}        

	
	var gridView2 = {
		    initView: function(){
		    this.target = new ax5.ui.grid();
		    this.target.setConfig({
		        showRowSelector: true,
		        multipleSelect: false,
		        sortable: true,
		        target: $('[data-ax5grid="second-grid"]'),
		        header: {
		             align: "center",
		             selector: false
		           },
		           body: {
		        	mergeCells : ["coCdNm","salesCd", "wbsPlanNo", "wbsPlanCodeKindNm", "wbsPlanCodeNm"],
		            onClick: function () {
		                this.self.select(this.dindex); 
		                
		            },
		            onDBLClick: function () {
		                      this.self.clearSelect();
		                      this.self.select(this.dindex);
		            },
		       },
		          page: {
		            navigationItemCount: 9,
		            height: 30,
		            display: true,
		            firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
		            prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
		            nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
		            lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
		            onChange: function () {
		                gridView2.setData(this.page.selectPage); 
		            }
		          },
		          columns: [
		              {key: "rnum",      label: "No.",          align: "center",   width: 60},
		              {key: "fileTrgtKey",      label: "첨부파일키",       hidden: true},
		              {key: "coCd",      label: "회사",          hidden: true},
		              {key: "coNm",      label: "회사명",      width: 80, align: "center"},
		              {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 100},  
		              {
		                  label: "마감", columns: [
		                      {key: "",      label: "마감취소",      align: "center",   width: 100, formatter:function() {
		                          if (this.item.closeYn == "Y") {
		                              return '<button type="button" onclick="unCloseYn(' + this.dindex + ')" authchk>UNCLOSE</button>';
		                          }
		                          else {
		                              return '○';
		                          }                           
		                      }},
		                      {key: "",      label: "마감",      align: "center",   width: 100, formatter:function() {
		                          if (this.item.closeYn != "Y") {
		                              return '<button type="button" onclick="closeYn(' + this.dindex + ')" authchk>CLOSE</button>';
		                          }
		                          else {
		                              return '○';
		                          } 
		                      }}
		                  ]
		              },
		              {key: "wbsPlanNo",      label: "관리번호",      align: "center",   width: 130},
		              {key: "wbsPlanCodeKind",      label: "상위레벨",      hidden: true},
		              {key: "wbsPlanCodeKindNm",      label: "상위레벨",      align: "center",   width: 130},
		              {key: "wbsPlanCodeId",      label: "레벨",      hidden: true},
		              {key: "wbsPlanCodeNm",      label: "레벨",      align: "center",   width: 130},
		              {key: "lockYn",      label: "잠금",      align: "center",   width: 50, formatter: "chkYn"},             
                      {key: "closeYn",      label: "마감",      align: "center",   width: 50, formatter: "chkYn"},                                  
		              {key: "wbsRsltsCntsM",      label: "메인 주요내용",      align: "center",   width: 130},
		              {key: "wbsRsltsRmkM",      label: "메인 비고",      align: "center",   width: 130},             
		              {key: "wbsRsltsDt",      label: "실적일",      align: "center",   width: 80},             
		              {key: "wbsRsltsSeq",      label: "순번",      align: "center",   width: 50},             
		              {key: "wbsRsltssDt",      label: "시작일자",      align: "center",   width: 80},             
                      {key: "wbsRsltseDt",      label: "종료일자",      align: "center",   width: 80},             
                      {key: "wbsRsltsId",      label: "작성자",      hidden: true},             
                      {key: "wbsRsltsNm",      label: "작성자명",      align: "center",   width: 100},
                      {key: "wbsPlanMhTot",      label: "메인 계획공수",      align: "right",   width: 100},             
                      {key: "wbsPlanMh",      label: "상세 계획공수",      align: "right",   width: 100},                                
		              {key: "wbsRsltsRateTot",      label: "진척율",      align: "right",   width: 80},             
		              {key: "wbsRsltsRate",      label: "단위 진척율",      align: "right",   width: 80},             
		              {key: "wbsAssRate",      label: "배부율",      align: "right",   width: 80},             
		              {key: "wbsRsltsMhTot",      label: "메인 실적공수",      align: "right",   width: 100},             
		              {key: "wbsRsltsMh",      label: "상세 실적공수",      align: "right",   width: 100},  
		              {key: "wbsRsltsCntsD",      label: "주요내용",      align: "center",   width: 130},   
		              {key: "wbsRsltsRmkD",      label: "상세 주요내용",      align: "center",   width: 130},             
		              {key: "creatId",      label: "생성자",      hidden: true},
		              {key: "creatNm",      label: "생성자",      align: "center",   width: 80},
		              {key: "creatPgm",      label: "생성프로그램ID",      hidden: true},
		              {key: "creatDttm",      label: "생성일시",      align: "center",   width: 130},                   
		              {key: "udtId",      label: "최종변경자",      hidden: true},
		              {key: "udtNm",      label: "최종변경자",      align: "center",   width: 80},
		              {key: "udtPgm",      label: "최종수정프로그램ID",      hidden: true},
		              {key: "udtDttm",      label: "최종변경일자",      align: "center",   width: 130},
		              {key: "wbsPlanIdx",      label: "WBS PLAN IDX",        align: "center",   width: 60},
		             ]
		       });
		       return this;

		     },
		       setData: function(_pageNo) {
		    	        if (isFirst) return;
		                var targetObj = this.target;
		                var row = gridView.target.getList("selected")[0];
		                //alert(row);
		                ////debugger;
		                if (row == undefined) {
		                	//alert("행을 선택하세요");
		                	return;
		                }
		                //alert(row.coCd);
		                var formData = {
		                           "coCd" : row.coCd,
		                           "wbsPlanCodeKind" : row.wbsPlanCodeKind,
		                           "wbsPlanCodeId" : row.wbsPlanCodeId,
		                           "wbsPlanNo" : row.wbsPlanNo,
		                           "salesCd" : row.salesCd,
		                           "pageNo" : _pageNo + 1, 
		                           "recordCnt" : $("#recordCnt2").val()
		                       }
		                         postAjax("/user/wb/wb02/selectWbsRsltsList", formData, null, function(data){
		                        	    var list = data.fileList;
		                               // //debugger;
		                                targetObj.setData({
		                                    list : list,
		                                    page : {
		                                           currentPage : _pageNo,
		                                           pageSize : data.paginationInfo.pageSize,
		                                           totalElements : data.paginationInfo.totalRecordCount,
		                                           totalPages : data.paginationInfo.totalPageCount
		                                    } 
		                                });
		                                targetObj.select(0); 
		                         });
		        } 
		}
	
	    $(document).ready(function() {

	        mainDefaultLoad("WBS", "일정 마감관리");          // 페이지 타이틀 설정
	        setCommonSelect($("#main_area select[data-kind]"));     // 공통코드 set

	        $("#coCd_S").val(jwt.coCd);
	        // 시작일 (현재날짜의 월 첫일)
	        $('#reqDtFrom_S').datepicker({
	            format : "yyyy-mm-dd",
	            language : "ko",
	            autoclose : true
	        })

	        .datepicker("setDate", moment(new Date()).startOf("month").toDate())
	        .on("changeDate", function(){
	            if($('#reqDtFrom_S').val() > $('#reqDtTo_S').val()){
	                alert("날짜를 확인해주세요");
	                $('#reqDtFrom_S').datepicker("setDate", new Date($('#reqDtTo_S').val()));
	            }
	        });

	        // 종료일 (현재날짜의 월 말일)
	        $('#reqDtTo_S').datepicker({
	            format : "yyyy-mm-dd",
	            language : "ko",
	            autoclose : true
	        })
	        .datepicker("setDate", moment(new Date()).endOf("month").toDate())
	        .on("changeDate", function(){
	            if($('#reqDtFrom_S').val() > $('#reqDtTo_S').val()){
	                alert("날짜를 확인해주세요");
	                $('#reqDtTo_S').datepicker("setDate", new Date($('#reqDtFrom_S').val()));
	            }
	        });


	        isFirst = false;    
	        gridView2.initView();
	        gridView.initView().setData(0);
	        
	        
	        excelView.initView();
	          // 검색조건 이벤트 bind
	        $('[data-search]').on("change", function(){
	            gridView.setData(0);
	        });
	        
	        //권한체크
	        authChk();
	        

	    });
	    
	    // 초기화 버튼용
	    function initSearch() {
	        $('[data-search]').off("change");   //바인딩기능 오프
	        $('.contents.search select, .contents.search input').val("");
	        $("#reqDtFrom_S").val(dateToStr(moment(new Date()).startOf("month").toDate()));
	        $("#reqDtTo_S").val(dateToStr(moment(new Date()).endOf("month").toDate()));
	        $("#coCd_S").val(jwt.coCd);
	        // 검색조건 이벤트 bind
	        $('[data-search]').on("change", function(){
	            gridView.setData(0);
	        });     
	        gridView.initView().setData(0);
	    }
	 
	    // 고객사 검색
	    function openClntSearch(openType) {
	        var paramObj = {
	                "searchValue" :  $("#clntNm_S").val()
	        }       
	        openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색", paramObj, function (grid) {
	            var row = grid.target.getList("selected")[0];
	            if(openType == "P"){
	                $('#clntCd_S').val(row.clntCd);
	                $('#clntNm_S').val(row.clntNm);
	                gridView.setData(0);
	            }else if(openType == "V"){
	                $('#vendCd_S').val(row.clntCd);
	                $('#vendNm_S').val(row.clntNm);
	            }
	        });
	    }
	 
	    //제품코드 검색
	    function openPrdtSearch(){
	        var paramObj = {
	                "coCd": $('#coCd').val(),
	                "prdtCd": $('#prdtCd_S').val(),
	                "prdtNm": $('#prdtNm_S').val(),
	                "useYn" : "Y"
	        }
	        openSecondModal("/static/html/cmn/modal/prdtSearch.html", 800, 600, "제품 검색", paramObj, function (grid) {
	            var row = grid.target.getList("selected")[0];
	            $("#prdtCd_S").val(row.prdtCd);
	            $("#prdtNm_S").val(row.prdtNm);
	        });
	    }
	    
	    //Sales Code (수주마스터, 수주상세테이블 조인) 검색
	    function wbsSalesCodeSearch() {
	        var paramObj = {
	           "coCd" : $('#coCd_S').val(),
	           "salesCd": $('#salesCd_S').val()
	        };
	        openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 430, "SALES CODE 검색", paramObj, function (grid){
	            var row = grid.target.getList("selected")[0];
	            $('#salesCd_S').val(row.salesCd);
	        });
	    }
	    
	    //관리번호 (WbsPlanNo) 검색
	    function wbsPlanNoSearch() {
	        var paramObj = {
	           "coCd" : $('#coCd_S').val(),
	           "wbsPlanNo": $('#wbsPlanNo_S').val()
	        };
	        openSecondModal("/static/html/cmn/modal/wbsPlanNoSearch.html", 450, 300, "관리번호 검색", paramObj, function (grid){
	            var row = grid.target.getList("selected")[0];
	            $('#wbsPlanNo_S').val(row.wbsPlanNo);
	        });
	    }
	    
	    //공유대상자 검색
	    function openUserTree() {
	        var paramObj = {
	            "coCd" : $('#coCd_S').val(),
	            "userId": $('#salesMngNm_S').val(),
	            "useYn": "Y"
	        };
	        openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "사용자 검색", paramObj, function (tree){
	            var checkedId = tree.get_checked()[0];
	            var checkedNode = tree.get_node(checkedId);
	            $('#salesMngId_S').val(checkedNode.id);
	            $('#salesMngNm_S').val(checkedNode.text);
	        });
	    }
	  
	    
	    function excelDown() {
	    	var paramObj = {"coCd": $('#coCd_S').val(),
                    "reqDtFrom" : $("#reqDtFrom_S").val().replace(/\-/g, ''),
                    "reqDtTo": $("#reqDtTo_S").val().replace(/\-/g, ''),
                    "clntCd" : $("#clntCd_S").val(),
                    "clntNm" : $("#clntNm_S").val(),
                    "salesCd" : $("#salesCd_S").val(),
                    "prdtCd" : $("#prdtCd_S").val(),
                    "prdtNm" : $("#prdtNm_S").val(),
                    "itemCd" : $("#itemCd_S").val(),
                    "clntPjt" : $("#clntPjt_S").val(),
                    "eqpNm" : $("#eqpNm_S").val(),
                    "salesMngId" : $("#salesMngId_S").val(),
                    "salesMngNm" : $("#salesMngNm_S").val(),
                    "wbsPlanNo" : $("#wbsPlanNo_S").val()
                    };
	        postAjax("/user/wb/wb01/selectWbsPlanExcelList", paramObj, null, function(data){
	            var list = data.resultList;
	            excelView.target.setData({
	               list : list,
	               page : {
	                         totalElements : list.length,
	               }
	            });
	            var todayDate = new Date().format('yyyyMMddHHmmss');
	            excelView.target.exportExcel("일정계획등록_"+todayDate+".xls");
	         });   
	    }
	    
	    function deleteWbs() {
	        var row = gridView2.target.getList("selected")[0];
	        // 실적은 미잠금, 미마감상태에서 삭제 가능, 결재 가 없는 경우 삭제 시 해당 SALES코드와 같은 실적마스터, 상세 , TODO-LIST 실적 공유, 실적 결재 삭제 
	        if (row != undefined) {
	            if (row.closeYn == "Y" || row.lockYn == "Y") {
	              alert("선택된 WBS 실적은 잠금 또는 마감된 상태입니다. 삭제할  수 없습니다.");  
	              return;
	        }
	        
	        var S_todoDiv1CodeId = "TODODIV10";
	        var S_todoDiv2CodeId = "TODODIV1020";
	        var A_todoDiv1CodeId = "TODODIV20";
	        var A_todoDiv2CodeId = "TODODIV2010"; 
	        
	        var formData = {
	            "coCd" : row.coCd,
	            "salesCd" : row.salesCd,
	            "wbsPlanNo" : row.wbsPlanNo,
	            "codeKind" : row.codeKind,
	            "codeId" : row.codeId,
	            "S_todoDiv1CodeId" : S_todoDiv1CodeId,
	            "S_todoDiv2CodeId" : S_todoDiv2CodeId,
	            "A_todoDiv1CodeId" : A_todoDiv1CodeId,
	            "A_todoDiv2CodeId" : A_todoDiv2CodeId   
	        };
	        postAjax("/user/wb/wb02/selectWbsPlanDeleteConfirmCount", formData, null, function(data){
	            if(data.result == 0) {
	                if(confirm("삭제하시겠습니까?")){
	                    deleteAjax("/user/wb/wb02/deleteWbsPlanlist", formData, null, function(data){
	                        if(data.resultCode == 200){
	                            alert(data.resultMessage);
	                            gridView2.setData(0);
	                        }
	                    });
	                }
	            } else {
	                alert("하위 레벨 데이터가 존재합니다."); 
	            }
	        });          
	    }
	  }
	    
	  
	  function WbsRsltsModal(type, lvl, idx) {
		    var paramObj = {
                    "actionType" : type,
                    "coCd" : jwt.coCd,
                    "lvl"      : lvl,
                    "idx"      : idx
            }
	        openModal("/static/html/user/wb/wb02/WB0201P012.html", 1600, 850, "", paramObj, function(data) {
	        });
	 }

	  function lockYn(rowIdx) { //잠금처리
		    row = gridView.target.getList()[rowIdx];
		    if (row != undefined) {     
		            var lvl = "";
		            var codeId = "";
		            if (row.wbsPlanCodeId.length == 8){ // 1레벨
		                lvl = "1";
		                codeId = row.wbsPlanCodeId;
		                
		                var formData = new FormData();
		                formData.append("coCd", row.coCd); 
		                formData.append("lvl", lvl);
		                formData.append("codeId", codeId);
		                formData.append("salesCd", row.salesCd);
		                formData.append("state", "Y");
		                
		                filePutAjax("/user/wb/wb02/updateWbsPlanLockYnLvl1", formData, function(data){                 
		                   if(data.resultCode == 200){
		                       alert(data.resultMessage);
		                       gridView.setData(0);
		                       gridView2.setData(0); 
		                   }
		                });    
		            }
		            else if (row.codeId.length == 10){ // 2레벨
		                lvl = "2";
		                codeId = row.wbsPlanCodeId.substring(0,8);
		                
		                var formData = new FormData();
		                formData.append("coCd", row.coCd); 
		                formData.append("lvl", lvl);
		                formData.append("codeId", codeId);
		                formData.append("salesCd", row.salesCd);
		                formData.append("state", "Y");
		               
		                filePutAjax("/user/wb/wb02/updateWbsPlanLockYnLvl2", formData, function(data){
		                  if(data.resultCode == 200){
		                      alert(data.resultMessage);
		                      gridView.setData(0);
                              gridView2.setData(0); 
		                  }
		               });    
		            }
		            else if (row.codeId.length == 12){ // 3레벨
		                lvl = "3";
		                codeId = row.wbsPlanCodeId.substring(0,10);
		                
		                var formData = new FormData();
		                formData.append("coCd", row.coCd); 
		                formData.append("lvl", lvl);
		                formData.append("codeId", codeId);
		                formData.append("salesCd", row.salesCd);
		                formData.append("state", "Y");
		               
		                filePutAjax("/user/wb/wb02/updateWbsPlanLockYnLvl3", formData, function(data){
		                  if(data.resultCode == 200){
		                      alert(data.resultMessage);
		                      gridView.setData(0);
                              gridView2.setData(0);  
		                  }
		               });    
		            }                   
		    }
		}

		function unlockYn(rowIdx) { //잠금해제처리
		    row = gridView.target.getList()[rowIdx];
		    if (row != undefined) {     
		            var lvl = "";
		            var codeId = "";
		            if (row.wbsPlanCodeId.length == 8){ // 1레벨
		                lvl = "1";
		                codeId = row.wbsPlanCodeId;
		                
		                var formData = new FormData();
		                formData.append("coCd", row.coCd); 
		                formData.append("lvl", lvl);
		                formData.append("codeId", codeId);
		                formData.append("salesCd", row.salesCd);
		                formData.append("state", "N");
		                
		                filePutAjax("/user/wb/wb02/updateWbsPlanLockYnLvl1", formData, function(data){
		                   if(data.resultCode == 200){
		                       alert(data.resultMessage);
		                       gridView.setData(0);
                               gridView2.setData(0);  
		                   }
		                });    
		            }
		            else if (row.wbsPlanCodeId.length == 10){ // 2레벨
		                lvl = "2";
		                codeId = row.wbsPlanCodeId.substring(0,8);
		                
		                var formData = new FormData();
		                formData.append("coCd", row.coCd); 
		                formData.append("lvl", lvl);
		                formData.append("codeId", codeId);
		                formData.append("salesCd", row.salesCd);
		                formData.append("state", "N");
		                
		               filePutAjax("/user/wb/wb02/updateWbsPlanLockYnLvl2", formData, function(data){
		                  if(data.resultCode == 200){
		                      alert(data.resultMessage);
		                      gridView.setData(0);
                              gridView2.setData(0); 
		                  }
		               });    
		            }
		            else if (row.wbsPlanCodeId.length == 12){ // 3레벨
		                lvl = "3";
		                codeId = row.wbsPlanCodeId.substring(0,10);
		               
		                var formData = new FormData();
		                formData.append("coCd", row.coCd); 
		                formData.append("lvl", lvl);
		                formData.append("codeId", codeId);
		                formData.append("salesCd", row.salesCd);
		                formData.append("state", "N");
		                
		               filePutAjax("/user/wb/wb02/updateWbsPlanLockYnLvl3", formData, function(data){
		                  if(data.resultCode == 200){
		                      alert(data.resultMessage);
		                      gridView.setData(0);
                              gridView2.setData(0); 
		                  }
		               });    
		            }                           
		    }
		}



		function closeYn(rowIdx) { //마감처리
		    //debugger;
		    row = gridView2.target.getList()[rowIdx];
		    if (row != undefined) {     
		        var formData = new FormData();
		        formData.append("coCd", row.coCd); 
		        formData.append("salesCd", row.salesCd);
		        formData.append("state", "Y");
		       
		        filePutAjax("/user/wb/wb02/updateWbsPlanCloseYn", formData, function(data){
		            if(data.resultCode == 200){
		                //debugger;
		                alert(data.resultMessage);
		                gridView.setData(0);
		                gridView2.setData(0); 
		            }
		        });
		    }
		}

		function unCloseYn(rowIdx) { //마감해제처리
		    //debugger;
		    row = gridView2.target.getList()[rowIdx];
		    if (row != undefined) {     
		        var formData = new FormData();
		        formData.append("coCd", row.coCd); 
		        formData.append("salesCd", row.salesCd);
		        formData.append("state", "N");
		        filePutAjax("/user/wb/wb02/updateWbsPlanCloseYn", formData, function(data){
		            if(data.resultCode == 200){
		               // debugger;
		                alert(data.resultMessage);
		                gridView.setData(0);
		                gridView2.setData(0); 
		            }
		        });
		    }
		}

</script>
