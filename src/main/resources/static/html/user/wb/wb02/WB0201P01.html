<div id="wbsPopup" class="popup_area of_a" style="width: 100%; height: 100%;">
	<div class="tit_contents">
	    <h4 class="tit">WBS Level 1 일정계획등록</h4>
	</div>
	
	<div class="popup_table">
		<div class="form-group">
			<form id="popForm">
			<input type="hidden" name="wbsPlanCodeKind_S1" id="wbsPlanCodeKind_S1" data-search="wbsPlanCodeKind" value="WBSDIV">
			<input type="hidden" name="creatPgm" id="creatPgm" data-search="creatPgm" value="WB0101P01">
			<input type="hidden" name="fileTrgtKey_S1" data-search="fileTrgtKey" id="fileTrgtKey_S1">
		        <table class="popup_table">
					<colgroup>
					     <col width="8%">
					     <col width="11%">
					     <col width="8%">
					     <col width="11%">
					     <col width="8%">
					     <col width="11%">
					     <col width="8%">
					     <col width="11%">
					     <col width="6%">
					</colgroup>
					
					<thead>
						<tr>
						   <td colspan="9" style="height:30px;text-align: left;">기본정보</td>	                                              
						</tr>
					</thead>
					
					<tbody>
						<!-- 1행 -->
						<tr>
							<th class="hit">회사</th>
							<td>
								<select  id="coCd_S1" data-kind="CO" data-search="coCd" required="required">
                                   <option value="">전체</option>
                                </select>
							</td>
							<th>관리번호</th>
							<td>
								<div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsPlanNo_S1" name="wbsPlanNo_S1"  required="required" data-search="wbsPlanNo">
                                </div>
							</td>
							<th class="hit">작성일자</th>
							<td>
	                            <div class="date_input">
	                                <input type="text" class="input_calendar" data-search="wbsPlanDt" style="width: 100% !important; display: inline-block !important;" id="wbsPlanDt_S1" name="wbsPlanDt_S1" autocomplete="off" msg="작성일자" date required>
	                            </div>
							</td>
							<th class="hit">작성자</th>
							<td>
								<div class="search_form">
	                                <input type="hidden" id="wbsPlanId_S1" name="wbsPlanId_S1" data-search="wbsPlanId">
	                                <input type="text" id="wbsPlanNm_S1" name="wbsPlanNm_S1" msg="작성자" data-search="wbsPlanNm" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId_S1.value = ''};" readonly required>
	                                <a onclick="openFirstWbsPlanUserSearch();">
	                                    <i class="i_search_w"></i>
	                                </a>
                                </div>
							</td>
							<th rowspan="5" style="vertical-align:top;">
							    <button type="button" class="btn btn-primary btn-sm" style="height: 25px; line-height: 15px;" onclick="" authchk>이슈등록</button>
							    </th>
						</tr>
						             
						<!-- 2행 -->
						 <tr>
						    <th  class="hit">Sales Code</th>
						    <td>
							    <div class="search_form" style="width: 100%;">
                                    <input type="text" class="form-control input-sm" id="salesCd_S1" data-search="salesCd">
                                    <a onclick="openFirstWbsSalesCodeSearch();"><i class="i_search_w"></i></a>
                                </div>
						    </td>
						    <th  class="hit">고객사</th>
						    <td>
		                            <input type="hidden" id="clntCd_S1" name="clntCd_S1"  data-search="clntCd">
		                            <div class="search_form">
		                                <input type="text" id="clntNm_S1" name="clntNm_S1"  data-search="clntNm" onkeyup="if(event.keyCode == 13){openClntSearch('P')};"> 
		                               <!--  <a onclick="openFirstClntSearch('P');"><i class="i_search_w"></i></a> -->
		                            </div>   
						    </td>
						    <th>고객사PJT</th>
						    <td>
						        <input type="text" class="form-control input-sm" id="wbsClntPjt_S1" data-search="clntPjt">
						    </td>
						    <th class="hit">신작구분</th>
						    <td>
						      <select id="wbsPlanDiv_S1" name="wbsPlanDiv_S1" data-kind="wbsPlanDiv_S1" data-search="wbsPlanDiv">
						      <option value="">선택</option>
                              </select>
						    </td>
						</tr>
						
						 <!-- 3행 -->
						 <tr>
						    <th class="hit">Lv.1</th>
						    <td>
                                  <select id="wbsLevel1_S1" name="wbsLevel1_S1" data-kind="wbsLevel1_S1" data-search="wbsPlanCodeId" onchange="openFirstWbsLevel2Change();$('#wbsLevel2_S1').val($('#wbsLevel1_S1').val());">
                                     <option value="">선택</option>
                                  </select>
						    </td>
						    <th>담당자</th>
						    <td>
						        <div class="search_form">
	                                <input type="hidden" id="wbsPlanMngId_S1" name="wbsPlanMngId_S1" data-search="wbsPlanMngId">
	                                <input type="text" id="wbsPlanMngNm_S1" name="wbsPlanMngNm_S1" msg="담당자" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId_S1.value = ''};" required>
	                                <a onclick="openFirstWbsPlanMngUserSearch();">
	                                    <i class="i_search_w"></i>
                                </a>
                                </div>
						    </td>
						    <th class="hit">시작일자</th>
						    <td>
						    <div class="date_input">
                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlansDt_S1" data-search="wbsPlansDt"  "autocomplete="off" date>
                            </div>
						    </td>
						    <th class="hit">종료일자</th>
						    <td>
						    <div class="date_input">
                                <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="wbsPlaneDt_S1" data-search="wbsPlaneDt"  autocomplete="off" date>
                            </div>
						    </td>
						</tr>
						
						<!-- 4행 -->
						 <tr>
						    <th class="hit">주요내용</th>
						    <td colspan=3>
						            <input type="text" id="wbsPlanCnts_S1" data-search="wbsPlanCnts">
						    </td>
						    <th>비고</th>
						    <td colspan=3>
						            <input type="text" id="wbsPlanRmk_S1" data-search="wbsPlanRmk">
						    </td>
						</tr>
						
						<!-- 5행 -->
						 <tr>
					        <th>설계난이도</th>
					        <td>
					          <select id="dsgnDifCodeId_S1" name="dsgnDifCodeId_S1" data-kind="dsgnDifCodeId_S1" data-search="dsgnDifCodeId">
					          <option value="">선택</option>
                              </select>
					        </td>
					        <th>설계계획공수</th>
					        <td>
					            <input type="text" id="dsgnPlanHour_S1" data-search="dsgnPlanHour">
					        </td>
					        <th>생산난이도</th>
					        <td>
					          <select id="prdctnDifCodeId_S1" name="prdctnDifCodeId_S1" data-kind="prdctnDifCodeId_S1" data-search="prdctnDifCodeId">
					          <option value="">선택</option>
                              </select>
					        </td>
					        <th>생산계획공수</th>
					        <td>
					           <input type="text" id="prdctnPlanHour_S1" data-search="prdctnPlanHour">  
					        </td>
						 </tr>

                        <!-- 6행 -->
                         <tr>
                            <th>외주여부</th>
                            <td>
								<input type=radio id="wbsPlanOsYn_Y_S1" name="wbsPlanOsYn_Y_S1" value="Y" data-search="wbsPlanOsYn_Y">Y &ensp; &ensp; &ensp; &ensp; 
								<input type=radio id="wbsPlanOsYn_N_S1" name="wbsPlanOsYn_N_S1" value="N" data-search="wbsPlanOsYn_N" checked>N<br>
                            </td>
                            <th>계획상태</th>
                            <td>
                                <select id="wbsPlanStsCodeId_S1" name="wbsPlanStsCodeId_S1" data-kind="wbsPlanStsCodeId_S1" data-search="wbsPlanStsCodeId">
                                    <option value="">선택</option>
                                </select>
                            </td>
                            
                         </tr>

						    
				    </tbody>
				    
				    <thead>
                        <tr>
                           <td colspan="9" style="height:30px;text-align: left;">결과정보</td>                                                
                        </tr>
                    </thead>
                    
                    <tbody>
                          <!-- 1행 -->
                         <tr>
                            <th>실적번호</th>
                            <td>
                                <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsRsltsNo_S1" name="wbsRsltsNo_S1"  required="required" data-search="wbsRsltsNo">
                                </div>
                            </td>
                            <th>실적일자</th>
                            <td>
                                    <div class="date_input">
                                    <input type="text" class="input_calendar" data-search="wbsRsltsDt" style="width: 100% !important; display: inline-block !important;" id="wbsPlanDt_S1" name="wbsPlanDt_S1" autocomplete="off" msg="작성일자" date required>
                                </div>
                            </td>
                            <th>작성자</th>
                            <td>
                               <div class="search_form">
                                    <input type="hidden" id="wbsPlanId_S1" name="wbsPlanId_S1" data-search="wbsPlanId">
                                    <input type="text" id="wbsPlanNm_S1" name="wbsPlanNm_S1" msg="작성자" data-search="wbsPlanNm" onkeyUp="if(window.event.keyCode == 8){wbsPlanMngId_S1.value = ''};" readonly required>
                                    <a onclick="openFirstWbsPlanUserSearch();">
                                        <i class="i_search_w"></i>
                                    </a>
                                </div>
                            </td>
                            <th></th>
                            <td>
                              
                            </td>
                        </tr>
                        <!-- 2행 -->
                         <tr>
                            <th>시작일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" data-search="wbsPlanDt" style="width: 100% !important; display: inline-block !important;" id="wbsPlanDt_S1" name="wbsPlanDt_S1" autocomplete="off" msg="작성일자" date required>
                                </div>
                            </td>
                            <th>종료일자</th>
                            <td>
                                <div class="date_input">
                                    <input type="text" class="input_calendar" data-search="wbsPlanDt" style="width: 100% !important; display: inline-block !important;" id="wbsPlanDt_S1" name="wbsPlanDt_S1" autocomplete="off" msg="작성일자" date required>
                                </div>
                            </td>
                            <th>진척율</th>
                            <td>
                               <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsPlanNo_S1" name="wbsPlanNo_S1"  required="required" data-search="wbsPlanNo">
                                </div>
                            </td>
                            <th>실투입공수</th>
                            <td>
                              <div class="search_form"  style="width: 100%;">
                                   <input type="text"  id="wbsPlanNo_S1" name="wbsPlanNo_S1"  required="required" data-search="wbsPlanNo">
                                </div>
                            </td>
                        </tr>
                        <!-- 3행 -->
                       <tr>
                            <th>주요내용</th>
                            <td colspan=3>
                                    <input type="text" id="wbsPlanCnts_S1" data-search="wbsPlanCnts">
                            </td>
                            <th>비고</th>
                            <td colspan=3>
                                    <input type="text" id="wbsPlanRmk_S1" data-search="wbsPlanRmk">
                            </td>
                        </tr>   
                    </tbody>
				    
		        </table>	
			</form>
		</div>
	</div>
	<div class="popup_table">               
        <table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※실적상세</td>
            </tr>
        </table>
    </div> 
    
    <div class="contents">
        <!-- 실적상새 리스트 -->
        <div data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 150px; width: 100%"></div>
    </div>

    <div class="popup_table">               
        <table style="border:0px;">
            <tr>
                <td style="text-align: LEFT; border-right: 0px;">※공유 대상자</td>
                <td >
                    <div id="addrow" class="add_btn_small pdl10">
                        <a onclick="openFirstWbsSharngUserInsert();" style="height: 30px; line-height: 28px;"  authchk>+</a>
                        <a onclick="openFirstWbsSharngUserDelete();" style="height: 30px; line-height: 28px;" authchk>-</a>
                    </div>
                </td>
                <td style="text-align: LEFT; border-right: 0px;">※공유 대상자</td>
                <td >
                    <div id="addrow" class="add_btn_small pdl10">
                        <a onclick="openFirstWbsSharngUserInsert();" style="height: 30px; line-height: 28px;"  authchk>+</a>
                        <a onclick="openFirstWbsSharngUserDelete();" style="height: 30px; line-height: 28px;" authchk>-</a>
                    </div>
                </td>
                
            </tr>
            <tr>
                <td colspan="2" style="text-align: LEFT; border-right: 0px;">
                <div data-ax5grid="second-grid" data-ax5grid-config="{}" style="height: 150px; width: 100%"></div>
            </td>
                 <td colspan="2" style="text-align: LEFT; border-right: 0px;">
                 <div data-ax5grid="second-grid" data-ax5grid-config="{}" style="height: 150px; width: 100%"></div>
            </td>
                
                
            </tr>
        </table>
                    <!-- 공유대상자 리스트 -->
              
    </div>

    <div class="contents">
                <!-- 첨부파일 리스트 -->
                <div class="row" style="margin-top: 15px;margin-bottom:40px;">
                    <div class="col-xs-2" style="padding-right: 5px;">
                        <div class="contents" style="margin: 0; padding: 0;width: 100%; min-width: 200px">
                            <h3 class="location">
                                <span class="page_tit" style="text-align: left;"> 파일트리</span>
                            </h3>
                            <div id="treeview" style="height: 150px;padding: 5px;overflow: scroll;">
                                <div id="WB0201P01"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-10" style="padding-left: 0;">
                        <div class="contents" style="margin: 0; padding: 0;  width: 100%; min-width: 200px">
                            <h3 class="location">
                                <a class="file_tag" id="file_tag" style="font-weight: bold; color: blue; padding-left: 20px; padding-right: 10px;"></a>
                                <span class="page_tit" id="file_tit" style="text-align: right;"> 문서현황</span>
                            </h3>
                            <button disabled type="button" id="button_file" class="" style="  background-color: gray;height: 25px; line-height: 15px;" onclick="file.click();" authchk>첨부파일</button>
                            <div class="ax5_grid" data-ax5grid="file-grid" data-ax5grid-config="{}" style="height: 150px; width: 100%"></div>
                            </div>
                    </div>
                </div>
                 <!-- 첨부파일 리스트 END -->                
         </div>  

    <button type="button" class="btn btn-default btn-sm"  id="actionBtn" onclick="wbsLevel1PlanInsert();" authchk>등록</button>
     <button type="button" class="btn btn-default btn-sm" onclick="modalStack.close();">닫기</button>
</div>   
    
<script type="text/javascript">
var paramFlag = modalStack.last().paramObj.flag;
var paramRpw = modalStack.last().paramObj.row;
var paramTreeObj = {};
var fileTreeKey; // 파일생성TreeKey

var wbsInsPop01GridView = {
   initView: function(){
       this.target = new ax5.ui.grid();
       this.target.setConfig({
           showRowSelector: true,
           multipleSelect: false,
           sortable: true,
           target: $('[data-ax5grid="second-grid"]'),
           header: {
             align: "center",
             selector: false
           },
           body: {
               onClick: function () {
                   this.self.select(this.dindex); 
               },
               onDBLClick: function () {
                   this.self.clearSelect();
                   this.self.select(this.dindex);
               },
          },
          columns: [
                {key: "rn",      label: "No.",      align: "center",   width: 130},
                {key: "salesCd",      label: "SALES CODE",      align: "center",   width: 130},
                {key: "wbsPlanNo",      label: "관리번호",      align: "left",   width: 130},
                {key: "wbsPlanCodeId",      label: "계획항목코드",      hidden: true},
                {key: "wbsPlanCodeNm",      label: "LEVEL",      align: "left",   width: 130},
                {key: "coCd",      label: "회사",          hidden: true},
                {key: "coCdNm",      label: "회사명",      align: "left",   width: 130},
                {key: "id",      label: "ID",      align: "left",   width: 130},
                {key: "empNo",      label: "사원번호",      align: "left",   width: 130},
                {key: "name",      label: "성명",      align: "left",   width: 130},
                {key: "telNo",      label: "H.P",      align: "left",   width: 130},
                {key: "email",      label: "E-Mail",      align: "left",   width: 200},
                ]
       });
       return this;
     },
     setData: function() {
    	 var targetObj = this.target;
         var formData = {
             "coCd" : $("#coCd_S1").val(),
             "codeKind" : $("#wbsLevel1_S1").val(),
             "salesCd" : $("#salesCd_S1").val(),
             "wbsPlanNo" : $("#wbsPlanNo_S1").val()
         }
         postAjax("/user/wb/wb01/selectWbsPopupSharngList", formData, null, function(data){
             var list = data.resultList;
             targetObj.setData({
                  list : list,
                  page : {
                      totalElements : list.length
                  }
              });
             
         }); 
    } 
}


$(document).ready(function() {  
	setCommonSelect($('#wbsPopup select[data-kind]'));

	$('#coCd_S1').val(jwt.coCd);
	$('#wbsPlanId_S1').val(jwt.userId);
	$('#wbsPlanNm_S1').val(jwt.userNm);
	$('#wbsPlanMngId_S1').val(jwt.userId);
    $('#wbsPlanMngNm_S1').val(jwt.userNm);
		
	var today = new Date();
    var strDate = today.getFullYear()+"-"+('0'+(today.getMonth()+1)).slice(-2)+"-"+('0'+today.getDate()).slice(-2);
    
	// 작성일 초기화
	$('#wbsPopup #wbsPlanDt_S1').datepicker({
        format : "yyyy-mm-dd",
        language : "ko",
        autoclose : true
	})
	.datepicker("setDate", strDate)

	 // 시작일자 (현재날짜의 월 첫일)
	$('#wbsPlansDt_S1').datepicker({
	          format : "yyyy-mm-dd",
	          language : "ko",
	          autoclose : true
	})
	.datepicker("setDate", strDate)
	.on("changeDate", function(){
	          if($('#wbsPlansDt_S1').val() > $('#wbsPlaneDt_S1').val()){
	                    alert("날짜를 확인해주세요");
	                    $('#wbsPlansDt_S1').datepicker("setDate", new Date($('#wbsPlaneDt_S1').val()));
	          }
	});
	
	// 종료일자 (현재날짜의 월 말일)
	$('#wbsPlaneDt_S1').datepicker({
	          format : "yyyy-mm-dd",
	          language : "ko",
	          autoclose : true
	})
	.datepicker("setDate", strDate)
	.on("changeDate", function(){
	          if($('#wbsPlansDt_S1').val() > $('#wbsPlaneDt_S1').val()){
	                    alert("날짜를 확인해주세요");
	                    $('#wbsPlaneDt_S1').datepicker("setDate", new Date($('#wbsPlansDt_S1').val()));
	          }
	});
	

	 $("#wbsLevel2_S1").prop('disabled',true);
	 $("#wbsLevel3_S1").prop('disabled',true);
	 $("#clntNm_S1").prop('disabled',true);
     $("#wbsClntPjt_S1").prop('disabled',true);
     $("#wbsPlanDiv_S1").prop('disabled',true)
	    
	openFirstWbsLevel1Change();
    openFirstWbsLevel2Change();
    openFirstWbsLevel3Change();

    openFirstWbsPlanDivChange();
    openFirstWbsDsgnDifChange();
	openFirstWbsPrdctnDifChange();
	openFirstWbsPlanStsChange();
	    
	//wbsInsPop01Lvl2GridView.initView().setData();  
	//wbsInsPop01Lvl3GridView.initView().setData(); 
	

	
	//debugger;
	//var actionBtn = document.getElementById("actionBtn");
	var row;
	
	if (paramFlag == "M"){ // 수정
		// 등록버튼 활성화
		 //actionBtn.style.display = "inline-block";
		 row = wbsGridView.target.getList()[paramRpw];
		 if (row != undefined) {
			    paramTreeObj = {"fileTrgtKey" : row.fileTrgtKey};
			    var paramObj = {"codeId" : $("#wbsLevel1_S1").val()};
			    var fileTreeCode;
			    postAjax("/user/wb/wb01/selectFileCodeSelect", paramObj, null, function(data){
			    	fileTreeCode = data.result[0].codeId;
			    }); 
			    treeModule.initAll('WB0101P01', 'file-grid', fileTreeCode, paramTreeObj);
			    
			    
		        $("#fileTrgtKey_S1").val(row.fileTrgtKey); // 파일트리키
		        $("#coCd_S1").val(row.coCd); // 회사
		        $("#wbsPlanNo_S1").val(row.wbsPlanNo); // 관리번호
		        $("#wbsPlanDt_S1").val(row.wbsPlanDt); // 작성일자
		        $("#wbsPlanId_S1").val(row.wbsPlanId); // 작성자ID
		        $("#wbsPlanNm_S1").val(row.wbsPlanNm);// 작성자명
		        $("#salesCd_S1").val(row.salesCd); // Sales Code
		        $("#clntCd_S1").val(row.ordrsClntCd); // 고겍사ID
		        $("#clntNm_S1").val(row.ordrsClntNm); // 고객사명
		        $("#wbsClntPjt_S1").val(row.clntPjt); // 고객사PJT
		        $("#wbsPlanDiv_S1").val(row.ordrsDtlDiv30); // 신작구분
		        $("#wbsLevel1_S1").val(row.codeId); // 1Level WBS 구분
		        $("#wbsPlanMngId_S1").val(row.wbsPlanMngId); //담당자 ID
		        $("#wbsPlanMngNm_S1").val(row.wbsPlanMngNm); //담당자명
		        $("#wbsPlansDt_S1").val(row.wbsPlansDt);// 시작일자
		        $("#wbsPlaneDt_S1").val(row.wbsPlaneDt); // 종료일자
		        $("#wbsPlanCnts_S1").val(row.wbsPlanCnts);// 주요내용
		        $("#wbsPlanRmk_S1").val(row.wbsPlanRmk);// 비고
		        $("#wbsPlanStsCodeId_S1").val(row.wbsPlanStsCodeId); //계획상태코드
		        $("#dsgnDifCodeId_S1").val(row.dsgnDifCodeId); // 설계난이도코드
		        $("#dsgnPlanHour_S1").val(row.dsgnPlanHour); // 설계계획공수
		        $("#prdctnDifCodeId_S1").val(row.prdctnDifCodeId); // 생산난이도코드
		        $("#prdctnPlanHour_S1").val(row.prdctnPlanHour); // 생산계획공수
		        if (row.wbsPlanOsYn == "Y"){ // 외주유무
		            $("#wbsPlanOsYn_Y_S1").prop('checked',true);
		            $("#wbsPlanOsYn_N_S1").prop('checked',false);
		        }
		        else{            
		            $("#wbsPlanOsYn_Y_S1").prop('checked',false);
		            $("#wbsPlanOsYn_N_S1").prop('checked',true);
		        }
		    }
			 $("#coCd_S1").prop('disabled',true);
			 $("#salesCd_S1").prop('disabled',true);
			 $("#wbsLevel1_S1").prop('disabled',true);
			 $("#wbsPlanNo_S1").prop('disabled',true);
			 
			 wbsInsPop01GridView.initView().setData();
		 
	}
	// To-Do 리스트에서 팝업창 호출 처리 
	else if (paramFlag == "D") {
		
		$("#wbsLevel1_S1").prop('disabled',true);
		addrow.style.display="none";
		addrow1.style.display="none";
		addrow2.style.display="none";
		//actionBtn.style.display = "none";
		row = toDoGridView.target.getList()[paramRpw];
        if (row != undefined) {
        	var formData = {
                    "coCd" : row.coCd,
                    "codeKind" : row.wbsPlanCodeKind,
                    "codeId" : row.wbsPlanCodeId,	
                    "salesCd" : row.salesCd,
                    "wbsPlanNo" : row.wbsPlanNo 
                }
               
                postAjax("/user/wb/wb01/selectWbsPlanInfoSelect", formData, null, function(data){
                	paramTreeObj = {"fileTrgtKey" : data.resultList[0].fileTrgtKey};
                	var paramObj = {"codeId" : $("#wbsLevel1_S1").val()};
                    var fileTreeCode;
                    postAjax("/user/wb/wb01/selectFileCodeSelect", paramObj, null, function(data){
                        fileTreeCode = data.result[0].codeId;
                    }); 
                    treeModule.initAll('WB0101P01', 'file-grid', fileTreeCode, paramTreeObj);
                    
                    $("#fileTrgtKey_S1").val(data.resultList[0].fileTrgtKey); // 파일트리키
                    $("#coCd_S1").val(data.resultList[0].coCd); // 회사
                    $("#wbsPlanNo_S1").val(data.resultList[0].wbsPlanNo); // 관리번호
                    $("#wbsPlanDt_S1").val(data.resultList[0].wbsPlanDt); // 작성일자
                    $("#wbsPlanId_S1").val(data.resultList[0].wbsPlanId); // 작성자ID
                    $("#wbsPlanNm_S1").val(data.resultList[0].wbsPlanNm);// 작성자명
                    $("#salesCd_S1").val(data.resultList[0].salesCd); // Sales Code
                    $("#clntCd_S1").val(data.resultList[0].ordrsClntCd); // 고겍사ID
                    $("#clntNm_S1").val(data.resultList[0].ordrsClntNm); // 고객사명
                    $("#wbsClntPjt_S1").val(data.resultList[0].clntPjt); // 고객사PJT
                    $("#wbsPlanDiv_S1").val(data.resultList[0].ordrsDtlDiv30); // 신작구분
                    $("#wbsLevel1_S1").val(data.resultList[0].codeId); // 1Level WBS 구분
                    $("#wbsPlanMngId_S1").val(data.resultList[0].wbsPlanMngId); //담당자 ID
                    $("#wbsPlanMngNm_S1").val(data.resultList[0].wbsPlanMngNm); //담당자명
                    $("#wbsPlansDt_S1").val(data.resultList[0].wbsPlansDt);// 시작일자
                    $("#wbsPlaneDt_S1").val(data.resultList[0].wbsPlaneDt); // 종료일자
                    $("#wbsPlanCnts_S1").val(data.resultList[0].wbsPlanCnts);// 주요내용
                    $("#wbsPlanRmk_S1").val(data.resultList[0].wbsPlanRmk);// 비고
                    $("#wbsPlanStsCodeId_S1").val(data.resultList[0].wbsPlanStsCodeId); //계획상태코드
                    $("#dsgnDifCodeId_S1").val(data.resultList[0].dsgnDifCodeId); // 설계난이도코드
                    $("#dsgnPlanHour_S1").val(data.resultList[0].dsgnPlanHour); // 설계계획공수
                    $("#prdctnDifCodeId_S1").val(data.resultList[0].prdctnDifCodeId); // 생산난이도코드
                    $("#prdctnPlanHour_S1").val(data.resultList[0].prdctnPlanHour); // 생산계획공수
                    if (data.resultList[0].wbsPlanOsYn == "Y"){ // 외주유무
                        $("#wbsPlanOsYn_Y_S1").prop('checked',true);
                        $("#wbsPlanOsYn_N_S1").prop('checked',false);
                    }
                    else{            
                        $("#wbsPlanOsYn_Y_S1").prop('checked',false);
                        $("#wbsPlanOsYn_N_S1").prop('checked',true);
                    } 
                    
                    wbsInsPop01GridView.initView().setData();
                }); 
        	
        	
           }
	}
	else{
		// 등록버튼 활성화
		//actionBtn.style.display = "inline-block";
		var paramObj = {"codeId" : $("#wbsLevel1_S1").val()};
        var fileTreeCode;
        postAjax("/user/wb/wb01/selectFileCodeSelect", paramObj, null, function(data){
        	 fileTreeCode = data.result[0].codeId;
        	 //alert(fileTreeCode);
             treeModule.initAll('WB0101P01', 'file-grid', 'FITR0901', "");
        }); 

		$("#coCd_S1").prop('disabled',false);
        $("#salesCd_S1").prop('disabled',false);
        $("#wbsLevel1_S1").prop('disabled',false);
        $("#wbsPlanNo_S1").prop('disabled',false);
       
	}
	// wbsInsPop01Lvl3GridView.initView().setData();
    
});   

//WBS LEVEL 1 구분
function openFirstWbsLevel1Change() {
	var paramObj = {"codeKind" :""};
    postAjaxSync("/user/wb/wb01/selectWbsLevel1List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel1_S1"]').html(optionHtml);
    });
}

//WBS LEVEL 1-1 구분
function openFirstWbsLevel2Change() {
    var paramObj = {"codeKind" : $('#wbsLevel1_S1').val()};
   // alert($('#wbsLevel1_S2').val());
    postAjaxSync("/user/wb/wb01/selectWbsLevel1List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel2_S1"]').html(optionHtml);
    });
}

//WBS LEVEL 2 구분
function openFirstWbsLevel3Change() {
    var paramObj = {"codeKind" : $('#wbsLevel2_S1').val()};
    //alert($('#wbsLevel2_S1').val());
    postAjaxSync("/user/wb/wb01/selectWbsLevel2List", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-kind="wbsLevel3_S1"]').html(optionHtml);
    });
}


//관리번호 (WbsPlanNo) 검색
function openFirstWbsPlanNoSearch() {
    var paramObj = {
       "coCd" : $('#coCd_S1').val(),
       "salesCd": $('#salesCd_S1').val()
    };
    openThirdModal("/static/html/cmn/modal/wbsPlanNoSearch.html", 450, 270, "관리번호 검색", paramObj, function (grid){
        var row = grid.target.getList("selected")[0];
        $('#wbsPlanNo_S1').val(row.wbsPlanNo);
    });
}


//작성자 검색
function openFirstWbsPlanUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S1').val(),
        "userId": $('#wbsPopup #wbsPlanId_S1').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "작성자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup #wbsPlanId_S1').val(checkedNode.id);
        $('#wbsPopup #wbsPlanNm_S1').val(checkedNode.text);
    });
}


//담당자 검색
function openFirstWbsPlanMngUserSearch() {
    var paramObj = {
        "coCd" : $('#coCd_S1').val(),
        "userId": $('#wbsPopup #wbsPlanId_S1').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#wbsPopup #wbsPlanMngId_S1').val(checkedNode.id);
        $('#wbsPopup #wbsPlanMngNm_S1').val(checkedNode.text);
    });
}


//Sales Code (수주마스터, 수주상세테이블 조인) 검색
function openFirstWbsSalesCodeSearch() {
    var paramObj = {
       "coCd" : $('#coCd_S1').val(),
       "salesCd": $('#salesCd_S1').val()
    };

    openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 330, "SALES CODE 검색", paramObj, function (grid){
        var row = grid.target.getList("selected")[0];
        $('#salesCd_S1').val(row.salesCd); // Sales Code
        $('#wbsClntPjt_S1').val(row.clntPjt); // 고객사 PJT
        $('#clntCd_S1').val(row.ordrsClntCd); // 고객사코드
        $('#clntNm_S1').val(row.ordrsClntNm); // 고객사명
        $("#wbsPlanDiv_S1").val(row.ordrsDtlDiv30); // 신작구분

    });
    
}


// 고객사 검색
function openFirstClntSearch(type) {
    openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "고객사 검색", {}, function (grid) {
        var row = grid.target.getList("selected")[0];
        $('#wbsPopup #clntCd_S1').val(row.clntCd);
        $('#wbsPopup #clntNm_S1').val(row.clntNm);
    });
}

//신작구분
function openFirstWbsPlanDivChange() {
	var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsPlanDivList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="wbsPlanDiv"]').html(optionHtml);
    });
}

//설계난이도 구분//DSGN_DIF_CODE_ID
function openFirstWbsDsgnDifChange() {
    var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsDsgnDifList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="dsgnDifCodeId"]').html(optionHtml);
    });
}

//생산난이도 구분 PRDCTN_DIF_CODE_ID
function openFirstWbsPrdctnDifChange() {
    //DSGN_DIF_CODE_ID
    var paramObj = {"codeKind" : ""};
    postAjaxSync("/user/wb/wb01/selectWbsPrdctnDifList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="prdctnDifCodeId"]').html(optionHtml);
    });
}


// WBS 계획상태  WBS_PLAN_STS_CODE_ID
function openFirstWbsPlanStsChange() {
    //DSGN_DIF_CODE_ID
    var paramObj = {"codeKind" : "WBSPLANSTS"};
    postAjaxSync("/user/wb/wb01/selectWbsPlanStsList", paramObj, null, function(data){
        var optionHtml = '';
        var childCodeList = data.codeInfoList;
        $.each(childCodeList, function(index, obj){
            optionHtml += '<option value='+obj.codeId+'>';
            optionHtml += obj.codeNm;
            optionHtml += '</option>';
        });
        $('.popup_area [data-search="wbsPlanStsCodeId"]').html(optionHtml);
    });
}


function insertWBSModal(idx){
	
	if ($('#coCd_S1').val() == ""){
        alert("회사를 입력하세요");
        return;
    }
    if ($('#salesCd_S1').val() == ""){
        alert("Sales Code를 입력하세요");
        return;
    }
	var wbsPlanOsYn = "";
	if ($("#wbsPlanOsYn_Y_S1").checked){
        wbsPlanOsYn = "Y";
    }
    else{
        wbsPlanOsYn = "N";
    }
    if (idx == 2) {
    	var formData = {
    	        "coCd" : $("#coCd_S1").val(), // 회사
    	        "salesCd" : $('#salesCd_S1').val(),
                "codeId" : $("#wbsLevel2_S1").val() // 1Level WBS구분코드
    	    };
    	    
    	    postAjax("/user/wb/wb01/selectWbsPlanConfirmCount", formData, null, function(data){
    	    	
    	        if(data.result == 0) {
    	            alert("Level1 데이터 등록이 필요합니다"); 
    	            return;
    	        }
    	        else{
    	        	var formData1 = {
    	                    "coCd" : $("#coCd_S1").val(),
    	                    "salesCd" : $('#salesCd_S1').val(),
    	                    "codeKind" : $("#wbsLevel2_S1").val(), 
    	                    "codeId" : $("#wbsLevel3_S1").val()
    	                };
    	        	openThirdModal("/static/html/user/wb/wb01/WB0101P02.html", 1300, 780, "", formData1);
    	        }
    	    });
    	    
    }
    else {
    	var formData = {
    			"coCd" : $("#coCd_S1").val(), // 회사
                "salesCd" : $('#salesCd_S1').val(),
                "codeId" : $("#wbsLevel3_S1").val() // 1Level WBS구분코드
            };
            postAjax("/user/wb/wb01/selectWbsPlanConfirmCount", formData, null, function(data){
            	//debugger;
                if(data.result == 0) {
                    alert("Level2 데이터 등록이 필요합니다"); 
                    return;
                }
                else {
                	var formData1 = {
                            "coCd" : $("#coCd_S1").val(), 
                            "salesCd" : $('#salesCd_S1').val(),
                            "codeKind" : $("#wbsLevel2_S1").val(),
                            "codeId" : $("#wbsLevel3_S1").val() 
                        };
                	openThirdModal("/static/html/user/wb/wb01/WB0101P03.html", 1300, 780, "", formData1);
                }
            });
    }
    
}

//공유대상자 삭제
function openFirstWbsSharngUserDelete() {
	var row = wbsInsPop01GridView.target.getList("selected")[0];
	if (row == null) {
		alert("삭제할 행을 선택하세요");
		return;
	}
	
    var formData = {
        "coCd" : row.coCd,
        "salesCd" : row.salesCd,
        "wbsPlanNo" : row.wbsPlanNo,
        "wbsPlanCodeId" : row.wbsPlanCodeId,
        "id" : row.id 
    }
    if(confirm("삭제하시겠습니까?")){
        deleteAjax("/user/wb/wb01/deleteWbsSharngUser", formData, null, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                wbsInsPop01GridView.initView().setData(); 
            }
        });
    }   
}



//공유대상자 등록
function openFirstWbsSharngUserInsert() {
    var wbsSharngUserId = "";
    if ($('#coCd_S1').val() == ""){
        alert("회사를 입력하세요");
        return;
    }
	if ($('#salesCd_S1').val() == ""){
		alert("Sales Code를 입력하세요");
		return;
	}
	if ($('#wbsPlanNo_S1').val() == ""){
        alert("관리번호를 입력하세요");
        return;
    }
    
	var paramObj = {
	        "coCd" : $('#coCd_S1').val(),
	        "userId": wbsSharngUserId,
	        "useYn": "Y"
	    };
	
	openThirdModal("/static/html/cmn/modal/userSearch.html", 300, 500, "공유대상자 검색", paramObj, function (tree){
    	var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
    	wbsSharngUserId = checkedNode.id;

	    var formData = new FormData($('#wbsPopup #popForm')[0]);
	    formData.append("coCd", $('#coCd_S1').val());
	    formData.append("salesCd", $('#salesCd_S1').val());
	    formData.append("wbsPlanNo", $('#wbsPlanNo_S1').val());
	    formData.append("wbsLevel", $('#wbsLevel1_S1').val().substring(0,6));
	    formData.append("wbsLevel1", $('#wbsLevel1_S1').val());
	    formData.append("wbsSharngUserId", wbsSharngUserId);
	    formData.append("pgPath", "/user/wb/wb01/WB0101P01.html");
	    formData.append("creatId", jwt.userId);
	    formData.append("creatPgm", $('#creatPgm').val());
	    formData.append("toDoKey", 0);
	    
	    filePostAjax("/user/wb/wb01/insertWbsSharngUser", formData, function(data){
           alert(data.resultMessage);  
           if(data.resultCode == 200) {
        	   wbsInsPop01GridView.initView().setData(); 
           }
        });         
    });     
}

function wbsLevel1PlanInsert(){
	//debugger;
	//var wbsPlanOsYn = "";
	if (paramRpw == undefined){
	    var strYear = new Date().toISOString().substring(2, 4);
	    var planData = {
	    		"coCd" : $('#coCd_S1').val(),
	            "year" : "S" + strYear
	        }; 
	     postAjaxSync("/user/wb/wb01/selectMaxWbsPlanNo", planData, null, function(data){
	    	 var strLen = String(data.result);
	        if (data.result == undefined) {
	            $('#wbsPlanNo_S1').val("S" + strYear + "0001");
	        }
	        else {
	            if (strLen.length == 1) {
	                $('#wbsPlanNo_S1').val("S" + strYear + "000" + data.result); 
	                }
	            else if (strLen.length == 2) {
	                $('#wbsPlanNo_S1').val("S" + strYear + "00" + data.result); 
	            }
	            else if (strLen.length == 3) {
	                $('#wbsPlanNo_S1').val("S" + strYear + "0" + data.result); 
	            }
	            else if (strLen.length == 4) {
	                $('#wbsPlanNo_S1').val("S" + strYear + data.result); 
	            }
	        }
	        
	    }); 
	    
	    if (wbsPlanOsYn_Y_S1.checked){
	        wbsPlanOsYn = "Y";
	    }
	    else if (wbsPlanOsYn_N_S1.checked){
	        wbsPlanOsYn = "N";
	    }
	    
	    if ($('#coCd_S1').val() == "") {
	        alert("회사를 선택하세요");
	        return;
	    }
	    
	    if ($('#wbsPlanId_S1').val() == "") {
	        alert("작성자를 입력하세요");
	        return;
	    }
	    
	    if ($('#salesCd_S1').val() == "") {
	        alert("Sales Code를 입력하세요");
	        return;
	    }
	    
	    if ($('#clntCd_S1').val() == "") {
	        alert("고객사를 입력하세요");
	        return;
	    }
	    
	    if ($('#wbsPlanCnts_S1').val() == "") {
	        alert("주요내용를 입력하세요");
	        return;
	    } 

	    var paramObj = {
        		"coCd" : $('#coCd_S1').val(),
	            "salesCd" : $('#salesCd_S1').val(),
	            "codeId" : $('#wbsLevel1_S1').val()
          };    
	    /* WBS 데이터 중복 체크 조회 */
	    var chk;
	    postAjaxSync("/user/wb/wb01/selectWbsPlanChk", paramObj, null, function(data){ 
	    	chk = data.result;
	    });
	    
	    if (chk <= 0) {
	    	var formData;
	    	/* 파일업로드를 위한 FielTreeKey Max값 조회 */
            postAjaxSync("/user/wb/wb01/selectMaxTrgtKey", paramObj, null, function(data){    
                fileTreeKey = data.result;
                //alert(fileTreeKey);
                formData = makeFormData(fileTreeKey);
                
            }); 
            filePostAjax("/user/wb/wb01/wbsLevel1PlanInsert", formData, function(data){
            	//debugger;
                if(data.resultCode == 200){
                    alert(data.resultMessage);
                    modalStack.close();
                    wbsGridView.setData(0); 
                }
            });  
            
        }
        else {
            alert("WBS 데이터가 존재합니다.");
            return;
            //modalStack.close();
        }
	}
	else {
		if (wbsPlanOsYn_Y_S1.checked){
            wbsPlanOsYn = "Y";
        }
        else if (wbsPlanOsYn_N_S1.checked){
            wbsPlanOsYn = "N";
        }
        
        if ($('#coCd_S1').val() == "") {
            alert("회사를 선택하세요");
            return;
        }
        
        if ($('#wbsPlanId_S1').val() == "") {
            alert("작성자를 입력하세요");
            return;
        }
        
        if ($('#salesCd_S1').val() == "") {
            alert("Sales Code를 입력하세요");
            return;
        } 
        
        if ($('#clntCd_S1').val() == "") {
            alert("고객사를 입력하세요");
            return;
        } 
        
        if ($('#wbsPlanCnts_S1').val() == "") {
            alert("주요내용를 입력하세요");
            return;
        } 
        
        formData = makeFormData($("#fileTrgtKey_S1").val());
        filePutAjax("/user/wb/wb01/wbsLevel1PlanUpdate", formData, function(data){
            if(data.resultCode == 200){
                alert(data.resultMessage);
                modalStack.close();
                wbsGridView.setData(0); 
            }
        });
		 
	}		
}

function makeFormData(fileTreeKey) {
	//debugger;
	$('#fileTrgtKey_S1').val(fileTreeKey);
   
    var formData = new FormData();
    $.each($('#wbsPopup [data-search]'), function(idx, elem){
        formData.append($(elem).data("search"), $(elem).val());
    });
    
    formData.append("creatId", jwt.userId);
    formData.append("wbsPlanOsYn", wbsPlanOsYn);
    
    // 유저아이디 추가
    formData.append("userId", jwt.userId);
    
     formData.append("fileTrgtKey", fileTreeKey);
    
    
    // 첨부파일 추가
    $.each(treeModule.getFileArr(), function (idx, obj) {
        // 신규파일만 추가
        if (obj.fileKey == 0) {
            formData.append("comonCd_" + idx, obj.nodeId);
            formData.append("files", obj.file);
        }
    });

    formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
    treeModule.initFileArrays(); 
    // 첨부파일 추가
    return formData;
}

function updateSecondWBSModal(idx, paramObj){     
/*     if (idx == 2){
    	var row = wbsInsPop01Lvl2GridView.target.getList()[paramObj.row];
    	//alert(row.codeId);
        $("#wbsLevel3_S1").val(row.codeId); 
        wbsInsPop01Lvl3GridView.initView().setData(); 
        
        //openSecondModal("/static/html/user/wb/wb01/WB0101P02.html", 1300, 780, "", paramObj);
    }
    else if (idx == 3){
    	openSecondModal("/static/html/user/wb/wb01/WB0101P03.html", 1300, 780, "", paramObj);
    }   */
}


</script>
