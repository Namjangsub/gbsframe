<div id="wbsPopup1" class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
        <h4 class="tit">공유/결재라인 팝업</h4>
    </div>
    
    <div class="popup_table">
        <div class="form-group">
            <form id="popForm">
                <table class="popup_table">
                    <colgroup>
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="8%">
                         <col width="11%">
                         <col width="6%">
                    </colgroup>
                    
                    <thead>
                        <tr>
                           <td colspan="9" style="height:30px;text-align: left;">기본정보</td>                                                
                        </tr>
                    </thead>
                    
                    <tbody>
                        <!-- 1행 -->
                        <tr>
                            <th class="hit">회사</th>
                            <td>
                                <select  id="coCd" data-kind="CO" data-search="coCd" required="required">
                                   <option value="">전체</option>
                                </select>
                            </td>
                             <th class="hit">작성자</th>
                            <td>
                                <div class="search_form">
                                    <input type="hidden" id="appId" name="appId">
                                    <input type="text" id="appNm" name="appNm" msg="작성자"  onkeyUp="if(window.event.keyCode == 8){appId.value = ''};" readonly required>
                                    <a onclick="openFirstWbsPlanUserSearch2();">
                                        <i class="i_search_w"></i>
                                    </a>
                                </div>
                            </td>
                            <th>결재선 구분</th>
                            <td>
                                <select  id="appDiv" name="appDiv" data-kind="APPDIV" style="width: 100%;">
                                  <option value="">선택</option>
                                </select>
                            </td>
                            <th class="hit">사용여부</th>
                            <td>
                                <select  id="useYn" name="useYn"  style="width: 100%;">
                                  <option value="Y" checked>Y</option>
                                  <option value="">N</option>
                                </select>
                            </td>
                            <th rowspan="5" style="vertical-align:top;">
                          </th>
                        </tr>
                   </tbody>   
                </table>    
            </form>
        </div>
    </div>
    
    <div class="contents">
        <!-- 결재선 리스트 -->
        <div data-ax5grid="approval-grid" data-ax5grid-config="{}" style="height: 600px; width: 100%"></div>
    </div>
     <button type="button" id="actionBtn" onclick="executeCallback();" authchk>등록</button>
     <button type="button" onclick="modalStack.close();">닫기</button>
</div>   
    
<script type="text/javascript">

var ApprovalGridView1 = {
        initView: function(){
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: false,
                multipleSelect: false,
                sortable: true,
                target: $('[data-ax5grid="approval-grid"]'),
                header: {
                  align: "center",
                  selector: false
                },
                body: {
                    onClick: function () {
                        
                        this.self.select(this.dindex); 
                        var rowList = this.self.list;
                        if(rowList.length == 0) {
                            return;
                        }
                        var row = this.self.getList("selected")[0];
                        this.self.clearSelect();
                        //alert(row.appLineNm);
                        //debugger;
                        $.each(rowList, function(idx, elem){
                            //alert(row.appLineNm + "/" + elem.appLineNm);
                            if (this.dindex != idx && row.appLineNm == elem.appLineNm){
                                ApprovalGridView1.target.setValue(idx, 'check', 'Y')
                                ApprovalGridView1.target.select(idx); 
                            };
                        });
                        
                    },
                    onDBLClick: function () {
                        this.self.clearSelect();
                        this.self.select(this.dindex);
                    },
               },
               columns: [
                     {key: "rn",      label: "No.",      align: "center",   width: 60},
                     {key: "check",      label: "",      align: "center",   width: 60, editor: {
                         type: "checkbox", config: {height: 17, trueValue: "Y", falseValue: "N"}}},
                     {key: "appDiv",      label: "결재선구분",      align: "center",   width: 130,      hidden: true},
                     {key: "appDivNm",      label: "결재선구분",      align: "center",   width: 100},
                     {key: "appLineNm",      label: "결재선명",      align: "left",   width: 150},
                     {key: "appId",      label: "결재자",      hidden: true},
                     {key: "appNm",      label: "결재자명",      align: "center",   width: 130},
                     {key: "appSeq",      label: "순번",      align: "center",   width: 50},
                     {key: "useYn",      label: "사용여부",      align: "center",   width: 50},
                     {key: "coCd",      label: "회사",          hidden: true},
                     {key: "coCdNm",      label: "회사명",      align: "left",   width: 130},
                     {key: "deptId",      label: "부서",      hidden: true},
                     {key: "deptNm",      label: "부서명",      align: "left",   width: 130},
                     {key: "levelCd",      label: "직급",      align: "left",   width: 130,      hidden: true},
                     {key: "levelNm",      label: "직급",      align: "left",   width: 90},                     
                     {key: "telNo",      label: "전화번호",      align: "left",   width: 130},
                     {key: "offTelNo",      label: "회사번호",      align: "left",   width: 130},
                     {key: "faxNo",      label: "FAX번호",      align: "left",   width: 130},
                     {key: "creatId",      label: "생성자",      hidden: true},
                     {key: "creatNm",      label: "생성자명",      align: "left",   width: 130},
                     {key: "creatDttm",      label: "생성일시",      align: "left",   width: 130,      hidden: true},
                     {key: "udtId",      label: "변경자",      hidden: true},
                     {key: "udtNm",      label: "변경자명",      align: "left",   width: 130,      hidden: true},
                     {key: "udtDttm",      label: "변경일시",      align: "left",   width: 130,      hidden: true},
                     ]
            });
            return this;
          },
          setData: function() {   
	              var targetObj = this.target;
	              var formData = {
	            		  "coCd" : $("#coCd").val()
	            		  , "appDiv" : $("#appDiv").val()
	              }
	              postAjax("/user/wb/wb02/selectApprovalList", formData, null, function(data){
	                  var list = data.resultList;
	                  targetObj.setData({
	                       list : list,
	                       page : {
	                           totalElements : list.length
	                       }
	                   });
	                  
	              }); 
         } 
     }
     

$(document).ready(function() {
    setCommonSelect($("#wbsPopup1 select[data-kind]"));
    	
    // 접속자 회사 set
    $("#coCd").val(jwt.coCd);
    
	//공통결재시 SELECT SEL
	appDiv = modalStack.last().paramObj.appDiv;
	if( appDiv ) {
		$("#appDiv").val(appDiv);
	}
	
    ApprovalGridView1.initView().setData();
    
});


//작성자 검색
function openFirstWbsPlanUserSearch2() {
    var paramObj = {
        "coCd" : $('#coCd').val(),
        "userId": $('#appId').val(),
        "useYn": "Y"
    };
    
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "작성자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#appId').val(checkedNode.id);
        $('#appNm').val(checkedNode.text);
    });
}


function executeCallback(){
    //if(selectGridValidation(ApprovalGridView1.target)) return;
    modalStack.last().callback(ApprovalGridView1);
    modalStack.close();
}

</script>
