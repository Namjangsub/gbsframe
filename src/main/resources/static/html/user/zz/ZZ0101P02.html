<style>
.highlight {
  color: red;
}
</style>
<body>
  <div class="container-fluid">
      <div class="row">
        <div class="popup_area">
          <form  id="popForm" onSubmit="return false;">
            <div  class="form-group popup_table">
		      <input type="hidden" id="coCd"  		name="coCd">
		      <input type="hidden" id="pgmId"     	name="pgmId" value="ZZ0101M01">
		      <input type="hidden" id="userId"     	name="userId" >
              <table>
		        <colgroup>
		          <col width="10%">
		          <col width="20%">
		          <col width="10%">
		          <col width="20%">
		        </colgroup>

                <tbody>
                  <tr>
						<th colspan= "1">SalesCode</th>
						<td>
							<input type="text" id="salesCd" name="salesCd" style="text-align: center;" readonly>
							</select>
						</td>
						<th colspan= "1">fileTrgtKey</th>
						<td>
							<input type="text" id="fileTrgtKey" name="fileTrgtKey" style="text-align: center;" readonly>
						</td>
                  </tr>
                  <tr>
						<th colspan= "1">상위 BOM 코드</th>
						<td colspan= "1">
					   		<div class="search_form">
					    	  <input type="text" id="upperCd" name="upperCd" style="text-align: center;"  readonly>
							</div>
						</td>
						<th colspan= "1">상위 BOM 도면번호</th>
						<td colspan= "1">
					   		<div class="search_form">
					    	  <input type="text" id="upperDsgnNo" name="upperDsgnNo" style="text-align: center;"  readonly>
							</div>
						</td>

				  </tr>
                  <tr>
						<th rowspan="1" class="hit">하위 BOM 종류</th>
						<td >
							<div style="width: 50%; margin-left:20px; text-align:center; " >
								<INPUT type=radio name="matrYn" value="N" checked> 도면 　　　　
								<INPUT type=radio name="matrYn" value="Y"> 자재품번
							</div>
						</td>
						<th colspan= "1">상위 BOM 품명</th>
						<td colspan= "1">
					   		<div class="search_form">
					    	  <input type="text" id="upperNm" name="upperNm" style="text-align: center;"  readonly>
							</div>
						</td>
				  </tr>
                  <tr>
						<th colspan= "4" style="height:30px;">BOM 하위레벨  </th>
				  </tr>
                  <tr>
                  		<th colspan= "1">하위 BOM 코드</th>
						<td>
							<input type="text" id="lowerCd" name="lowerCd" class="form-control" style="text-align: center;" onkeyup="creatDsgnNo("H");" >
						</td>
						<th colspan= "1">하위 BOM 도면번호</th>
						<td colspan= "1">
					   		<div class="search_form">
					    	  <input type="text" id="lowerDsgnNo" name="lowerDsgnNo" style="text-align: center;" >
							</div>
						</td>

                  </tr>
                  <tr>
						<th colspan= "1">수량</th>
						<td>
							<input type="text" id="lowerQty" name="lowerQty" class="form-control"  style="text-align: center;" comma>
						</td>
						<th colspan= "1">하위 BOM 품명</th>
						<td colspan= "1">
					   		<div class="search_form">
					    	  <input type="text" id="lowerNm" name="lowerNm" style="text-align: center;"  >
							</div>
						</td>
				  </tr>
                </tbody>

              </table>
            </div>

          </form>

		<!-- 콘텐츠 -->
			<div class="contents">
			    <!-- 리스트 -->
			    <div class="ax5_grid">
			              <div class="table_list_tit">
			                  <h5 class="tit">BOM 하위 내용</h5>
			                  <div class="add_btn_small">
			                      <a onclick= "insertChildList()" style="width: 50px;" authchk><i class="fas fa-folder-plus"></i> 추가</a>
			                      <a onclick= "openMatListSearch();" style="width: 50px;" authchk><i class="fas fa-money-check"></i> 자재 </a>
			                      <a onclick= "deleteChildList()" style="width: 50px;" authchk><i class="fas fa-trash"></i> 삭제 </a>
			                  </div>
			              </div>
			              <div>
			              <div data-ax5grid="parents-grid" data-ax5grid-config="{}" style="height:550px; width: 100%" ></div>
			              </div>
			  </div>
			</div>



        <div class ="popup_bottom_btn">
          <!--  <button id="checkBtn" type="button" class="bg_g fs-5" onclick="checkOverLap()">중복체크</button> -->
          <button type="button"  onclick="executeCallbackLast();" id ="actionBtn3" authchk></button>
          <button type="button"  onclick="modalStack.close();">닫기</button>

        </div>
        </div>
      </div>
    </div>
</body>
<script type="text/javascript">
	// 등록시 부서 아이디 중복체크 여부
	var isChecked = false;
	var paramActionType = modalStack.last().paramObj.actionType;
    var thisGridRow = "";
    var thisGridCol = "";
    
	var childGridView = {
			initView: function(){
				this.target = new ax5.ui.grid();
				this.target.setConfig({
			    	 showRowSelector: true,
			    	 multipleSelect: false,
			    	 sortable: false,
			         target: $('[data-ax5grid="parents-grid"]'),
			         header: {
			        		 align: "center",
			        		 selector: false
			         },
			         body: {
				        	 onClick: function (columnIndex, rowData) {
				                this.self.select(this.dindex);
				                prdtIdx = this.dindex;

				                var clickedRowIndex = this.dindex;
				                var clickedRowElement = this.self.bodyRowTable;

				                // 모든 행의 글자색을 기본값으로 설정
// 				                this.self.bodyRowTable.forEach(function (rowElement) {
// 				                  $(rowElement).removeClass("highlight");
// 				                });

				                // 선택된 행의 글자색을 변경
				                $(clickedRowElement).addClass("highlight");
				        	 },
				        	 onDBLClick: function () {
				        		 if (this.item.matrYn == 'Y')  {
// 					        		 if (this.column.key == 'matrCd' && this.column.key == 'matrMat') {
					        			 openMatListSearch(this.dindex);
// 					                 }	 
				        		 }
							 },
				             onDataChanged: function () {
				            	 if (this.item.__selected__ == true) {
				                		prdtIdx = this.dindex;
				                }
				             },
		             },
			        columns : [
			            {key : "lowerCd",  		label : "하위코드",   		width : 80,		hidden: false,  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "matrNm",  		label : "품명",    		width : 200,	hidden: false,align: "left",  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "matrYn",  		label : "자재",   		width : 50,		hidden: false,  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "dsgnNo",  		label : "도면번호",     	width : 210,	hidden: false,align: "left",  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "matrUnit",  	label : "단위",    		width : 50,		hidden: false,  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "lowerQty",  	label : "수량",    		width : 50,		hidden: false,  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "matrCd",  		label : "자재코드",   		width : 100,	hidden: false, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "matrMat",  		label : "소재",   		width : 180,	hidden: false,  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "matrMakrNm",  	label : "제조사(Maker)",  width : 100,	hidden: false,  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "matrMno",  		label : "형번(Model No)",width : 100,		hidden: false,  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "matrSpec",  	label : "규격",    		width : 100,	hidden: false,  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "matrRmk", 		label : "비고",   		width : 160,  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "avlbStrtDt", 	label : "유효시작",   		width : 100,	hidden: true,  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "avlbEndDt", 	label : "유효종료",   		width : 100,	hidden: true,  editor: {type: "text"}, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "updChk", 		label : "수정구분",   		width : 100,	hidden: true, 	styleClass: function () {
		                   return (this.item.updChk === "D") ? "grid-font-red" : "";}}
			           ,{key : "fileTrgtKey",  	label : "키값",   		width : 30,		hidden: true}
			           ,{key : "lowerKey",  	label : "하위코드",   		width : 30,		hidden: true}
				     ],
			       contextMenu: {
			          iconWidth: 20,
			          acceleratorWidth: 100,
			          itemClickAndClose: false,
			          icons: {
			              'arrow': '<i class="fa fa-caret-right"></i>'
			          },
			          items: [
			              {type: 1, label: "붙여넣기"},
			              {divide: true},
			              {type: 2, label: "줄추가"},
// 			              {type: 3, label: "내용 삭제"},
			              {type: 4, label: "줄삭제"},
			          ],
			          popupFilter: function (item, param) {
			              //console.log(item, param);
			              if(param.element) {
			                  return true;
			              }else{
			                  return item.type == 1;
			              }
			          },
			          onClick: function (item, param) {
							console.log(item, param);
							thisGridRow = param.dindex;
							thisGridCol = param.colIndex;
					           
							if (item.label == "붙여넣기") {
								gridPaste(thisGridRow,thisGridCol);
							} else if (item.label == "줄추가") {
								console.log('추가 인덱스 :', param.dindex);
							 	//.addRow(추가할 내용, 삽인할위치(생략시 마지막),갯수)
							  	childGridView.target.addRow($.extend({}, childGridView.target.list[param.dindex], {__index: undefined}),param.dindex+1,);		
							  	childGridView.target.setValue(param.dindex+1, 'updChk', "I");
							  	childGridView.target.setValue(param.dindex+1, 'fileTrgtKey', 0);
							  	childGridView.target.setValue(param.dindex+1, 'lowerKey', "");
							
// 							} else if (item.label == "내용 삭제") {
// 								console.log('내용삭제 인덱스 :', param.dindex);
							
// 								childGridView.target.config.columns.forEach((column) => {
// 									childGridView.target.setValue(param.dindex, column.key, '');
// 									console.log('내용삭제 :', param.dindex, column.key);
// 								});
// 								childGridView.target.setValue(param.dindex, 'updcheck', "D");
							
							} else if (item.label == "줄삭제") {
								console.log('삭제 인덱스 :', param.dindex);
// 								var list = childGridView.target.getList("selected");
// 								$.each(list, function(idx, obj){
// 									childGridView.target.select(obj.__index);  //선택된 모든 row 선택 해제
// 								});
								childGridView.target.clearSelect();	//선택된 모든 row 선택 해제
								childGridView.target.select(param.dindex);	//현재 클릭한 row 선택
								//삭제시에는 그리드에서 사라지므로 별도 처리 필요함  메모리에 담았다가 최종 DB단 삭제 로직 처리 해야함.
// 								childGridView.target.removeRow(param.dindex);
								deleteChildList();
							}
					        
					            
					       childGridView.target.contextMenu.close();
					       //또는 return true;
					   	}
					},        // contextMenu 				     
				     
			    });
				return this;
			},

	        setData: function(chk){
					var target = this.target;
					var formData = {
						"userId" 	: jwt.userId,
						"coCd" 		: $("#coCd").val(),
						"salesCd" 	: $("#salesCd").val(),
						"upperKey"	: $("#fileTrgtKey").val()
					}
		    		postAjax("/user/zz/zz01/selectBomlevelList", formData, null, function(data) {
						var list = data.result;
						if (list.some(obj => obj.matrYn == "Y")) {  // 하위 BOM list 에서 matrYn의 값중에 "Y"가 하나라도 있으면 자재로 설정
							$('[name="matrYn"]').filter('[value="Y"]').prop("checked", true);
						}
						target.setData({
		            		list : list,
		            		page : {
		            			totalElements : list.length
		            		}
		       			 });
		    	 	});
	     	} //setData
	     }


	$(document).ready(function() {
		$("#userId").val(jwt.userId);
		$("#coCd").val(modalStack.last().paramObj.coCd);
		
		if(paramActionType == 'U'){
			$('#actionBtn3').text("수정");
		}else if(paramActionType == 'C'){
			$('#actionBtn3').text("등록");
		}
		newPartInfo(modalStack.last().paramObj.node);
		childGridView.initView().setData();
// 		childGridView.initView();
		
	    // 그리드 내용 붙여넣기 이벤트 처리-->간헐적 실행으로 오작동~~~ 원인을 모르겠음 아래이벤트로 대체
	    // Ctrl + V 단축키 이벤트 처리
debugger;
		childGridView.target.$target.on("paste", function (e) {
			console.log("paste :", e);
			gridPaste(thisGridRow, thisGridCol);
		});
	});
	
	function newPartInfo(parentNode){
// 		var $deptTree = $("#deptTree").jstree(true);
// 		var parentNode = $deptTree.get_node(node.id);
		
		$('#salesCd').val(parentNode.original.salesCd);
		$('#upperCd').val(parentNode.original.lowerCd);
		$('#upperNm').val(parentNode.original.matrNm);
		$('#upperDsgnNo').val(parentNode.original.dsgnNo);
		$('#fileTrgtKey').val(parentNode.original.fileTrgtKey);
		$('#path').val(parentNode.original.path);
		$('#text').val(parentNode.original.text);
		$('#lowerCd').val('');
		$('#lowerNm').val('');
		$('#lowerQty').val(1);
		$('#lowerDsgnNo').val('');
	}

	function executeCallbackLast() {
		if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사
			
			var noErr = true;
// 			var modifyRow = childGridView.target.getList("modified");
// 			$.each(modifyRow,function(rowIdx, list) {
// 				if ((list.lowerCd == "") || (list.dsgnNo == "") || (list.lowerQty < 1)) {
// 					alert("하위코드, 도번, 수량은 필수 입력입니다.");
// 					 childGridView.target.select(list.__index);
// 					noErr = false;
// 					return false;
// 				}
// 			});
			
			var allRow = childGridView.target.getList();

// 			if (isDuplicateValueExists(allRow, 'lowerCd')) {
// 				alert("하위코드가 값이 중복됩니다.  확인 바랍니다.");
// 				noErr = false;
// 			}
			var duplicateValues = getDuplicateValues(allRow, 'lowerCd');
			if (duplicateValues.length > 0) {
				alert("하위코드가 값이 중복됩니다. \n\n" + duplicateValues);
				noErr = false;
			}
			if (noErr) {
				var formData = makeFormData();										// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
				filePostAjax("/user/zz/zz01/insertBomTree", formData ,function(data) {			// 파일을 포함한 데이터를 서버로 전송하는 비동기적인 AJAX 요청을 수행
					alert(data.resultMessage);								// 결과 메시지를 alert으로 출력
					if (data.resultCode == 200) {							//  요청이 성공(200)한 경우, gridView.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
						modalStack.last().callback(formData);
						modalStack.close();									// 모달을 닫음
					}
				});
			}
		}
	}
	
	function makeFormData() {
		debugger;
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
// 		$.each($('.popup_area input[date]'), function(idx, elem) {
// 			deleteHyphen(elem);
// 		});
		
		// 폼데이터 생성
		var formData = new FormData($("#popForm")[0]);
		
		//하위레벨 자료 수정된 자료만 arr 담기
		var modifyRow = childGridView.target.getList("modified");
		var updateRow = [];
		$.each(modifyRow,function(rowIdx, list) {
			
			if ((list.lowerCd == "") || (list.dsgnNo == "")) {
			} else {
			
// 				list.lowerQty = list.lowerQty.match(/[0-9]/g).join('');
// 				list.lowerQty = list.lowerQty < 1 ? 1 : list.lowerQty;
				
				if (!list.updChk) {
					list.updChk = "U";
				}
				
				if (list.updChk == "D"  && list.fileTrgtKey == 0) {
					console.log(list.updChk, list.fileTrgtKey)
				} else {
				
					list.dsgnNo = creatDsgnNo("D", list);
					var dsgnNoDtl = dsgnNoSeparation(list.dsgnNo);	
					list.partNo =  dsgnNoDtl.parts;
					list.unitNo =  dsgnNoDtl.unitNo;
					list.revNo =  dsgnNoDtl.revNo;
					updateRow.push(list);
				}
			}
		});
		
		formData.append("updateRowArr", JSON.stringify(updateRow));
		
		var dsgnNo = dsgnNoSeparation($("#lowerDsgnNo").val());		
		formData.append("userId"		, jwt.userId);
		formData.append("coCd" 			, $("#coCd").val());
		formData.append("salesCd" 		, $("#salesCd").val());
		formData.append("partNo" 		, dsgnNo.parts);
		formData.append("unitNo" 		, dsgnNo.unitNo);
		formData.append("revNo" 		, dsgnNo.revNo);
		formData.append("dsgnNo" 		, $("#lowerDsgnNo").val());
		formData.append("matrNm" 		, $("#lowerNm").val());
		formData.append("upperCd" 		, $("#upperCd").val());
		formData.append("lowerCd" 		, $("#lowerCd").val());
		formData.append("lowerQty" 		, $("#lowerQty").val());
		formData.append("userId" 		, $("#userId").val());
		formData.append("pgmId" 		, $("#pgmId").val());
		formData.append("useYn" 		, "Y");
		formData.append("matrYn" 		, $('[name="matrYn"]:checked').val());
		formData.append("upperKey" 		, $("#fileTrgtKey").val());
		return 	formData;
		
	}
	


	function insertChildList() {
		debugger;
		var newRow = childGridView.target.getList("selected")[0];
		if (!newRow) {
			newRow = childGridView.target.getList()[childGridView.target.list.length - 1];
		}
		if (!newRow) {
			newRow = {
			    "coCd"		: $("#coCd").val(),
			    "salesCd"	: $("#salesCd").val(),
			    "upperKey"	: $("#upperKey").val(),
			    "upperCd"	: $("#upperCd").val(),
			    "lowerCd"	: "000",
			    "dsgnNo"	: $("#upperDsgnNo").val(),
			    "partNo"	: "",
			    "unitNo"	: "",
			    "matrNm"	: "",
			    "useYn"		: "Y",
			    "matrYn"	: "N",
			    "creatId"	: $("#userId").val(),
			    "creatPgm"	: $("#pgmId").val(),
			    "lowerQty"	: 1,
			    "matrUnit"	: "EA",
			    "__original_index": 0
			}
		}
		newRow.updChk		= "I";
		newRow.fileTrgtKey 	= 0;
		newRow.lowerKey 	= "";
		if (newRow.lowerCd.length == 3) {
			newRow.lowerCd	= (parseInt(newRow.lowerCd, 10) + 1).toString().padStart(newRow.lowerCd.length, '0');
		} else {
			newRow.lowerCd	= (parseInt(newRow.lowerCd, 10) + 1000).toString().padStart(newRow.lowerCd.length, '0');
		}
		newRow.__index 		= "";
		newRow.dsgnNo = creatDsgnNo("D", newRow);
		var dsgnNoDtl = dsgnNoSeparation(newRow.dsgnNo);	
		newRow.partNo = dsgnNoDtl.parts;
		newRow.unitNo = dsgnNoDtl.unitNo;
		newRow.revNo  = dsgnNoDtl.revNo;
		
		childGridView.target.addRow($.extend({}, newRow), "last", {focus: "END"}); //focus 안먹힘??
		childGridView.target.focus("END");
		if ($('[name="matrYn"]:checked').val() == "Y") {
			openMatListSearch();
		}
	}	
	
	function deleteChildList() {
		var delRow = childGridView.target.getList("selected");
		$.each(delRow,function(rowIdx, list) {
			if (list.fileTrgtKey) {
				childGridView.target.setValue(list.__index, "updChk", "D");
			} else {
				childGridView.target.removeRow(list.__index);
			}
		});
		childGridView.target.repaint();   //수정내용 적용하기
	}	

	
	
	//자재품번 검색
	function openMatListSearch(row) {
		
		if (!row) {  // 해당 인데스가 없으면 선택된 행의 인덱스 적용
			var gridRow = childGridView.target.getList("selected")[0];
			if (!gridRow) {
				return false;
			}
			row = gridRow.__index;
		}
// 		if(gridDataValidation(bomGridView.target)) return;

		var paramObj = {
			"coCd" : $('#coCd_S').val(),
			"searchValue" : $("#matrCd_S").val()
		}
		
		openThirdModal("/static/html/cmn/modal/matListSearch.html", 1200, 700, "자재 검색", paramObj, function (grid) {
			var newRow = grid.target.getList("selected")[0];

			// childGridView.target.setValue(0, "a", "A-1");
			childGridView.target.setValue(row, "matrNm", newRow.matrNm);
			childGridView.target.setValue(row, "matrCd", newRow.matrCd);
			childGridView.target.setValue(row, "matrUnit", newRow.matrUnit);
			childGridView.target.setValue(row, "matrMat", newRow.matrMat);
			childGridView.target.setValue(row, "matrMakrNm", newRow.matrMakrNm);
			childGridView.target.setValue(row, "matrMno", newRow.matrMno);
			childGridView.target.setValue(row, "matrSpec", newRow.matrSpec);
			childGridView.target.setValue(row, "matrYn", "Y");
			if ($('[name="matrYn"]:checked').val() == "Y") {
				childGridView.target.setValue(row, "lowerCd", newRow.matrCd);
			}
			
		});
	}	
	
	//도면번호 자동 생성
	function creatDsgnNo(str, list) {
		if (str == "H") {
			var dsgnNo = ($('[name="matrYn"]:checked').val() == "N") ? "-" + $("#lowerCd").val() : "";
			$("#lowerDsgnNo").val($("#upperDsgnNo").val() + dsgnNo);
			if ($("#lowerNm").val() == "") $("#lowerNm").val($("#upperNm").val());
		} else {
			var dsgnNo = (list.matrYn == "N") ? "-" + list.lowerCd : "";
			return $("#upperDsgnNo").val() + dsgnNo;
		}
	}	
		
	//도면번호 분리
	function dsgnNoSeparation(str) {
		//ex) 23010-99TVFTE-1000-1100-1101, 
		//    23010-99TVFTE-1000-1100-1101-R1, 
		//    23010-99TVFTE-1000-1100-1101-501-R1
		var parts = str.split("-");
		var unitNo = parts[parts.length-1];
		var revNo = '';
		if (unitNo.includes('R')) {
			unitNo = parts[parts.length-2];
			revNo = parts[parts.length-1];
		}
		if (unitNo.length>3){
			unitNo = '';
		}
		
		return {
			parts 	: parts[2],
			unitNo	: unitNo,
			revNo	: revNo
		}
	}

	function  gridPaste(thisGridRow,thisGridCol ) {
		var pasteData = "";
		
		navigator.clipboard.readText().then(pasteData => {
		    console.log('클립보드에 저장된 값:', pasteData);
				if (pasteData==undefined ||pasteData=="" || thisGridRow===undefined) {
						return;
				}
	
			  // 붙여넣기할 데이터를 배열로 변환한다.
			  pasteData = (pasteData.charAt(pasteData.length - 1) === "\n") ? pasteData : pasteData + "\n";
			  var pasteRows = pasteData.split("\n").map(function(row) {
			    	return row.split("\t");
			  });
			
			  // 붙여넣기를 시작할 셀의 인덱스를 구한다.
			  var startRowIndex = thisGridRow;
			  var startColIndex = thisGridCol;
				
			  // 붙여넣을 데이터의 행과 열 개수를 구한다.
			  var numRows = pasteRows.length;
			  var numCols = pasteRows[0].length;
			
			  // 붙여넣을 데이터가 그리드의 범위를 벗어나면 에러 메시지를 출력한다.
			//   if (startRowIndex + numRows > childGridView.target.getList().length || startColIndex + numCols > childGridView.target.config.columns.length) {
			//     alert("The pasted data is out of the grid's range.");
			//     return;
			//   }
			
			  // 붙여넣기할 셀을 한 개씩 돌면서 값을 설정한다.
			  for (var i = 0; i < numRows-1; i++) {
			    for (var j = 0; j < numCols; j++) {
			    	//carriage return 문자 삭제
			      var cellData = pasteRows[i][j].replace(new RegExp('\r', 'ig'), '');
			
			      calRow = startRowIndex + i;
			      calCol = startColIndex + j;
			      
		        if (calRow >= childGridView.target.getList().length) {
		        	childGridView.target.addRow($.extend({}, childGridView.target.list[thisGridRow], {__index: undefined}));
		        }
		        
		        if (calCol >= childGridView.target.config.columns.length) {
		        	childGridView.target.addColumn();
		        }
		        
		        childGridView.target.setValue(calRow, childGridView.target.columns[calCol].key, cellData);
			    }
// 			    childGridView.target.setValue(calRow, 'updChk', 'U');
			  }
			  childGridView.target.repaint();
// 			  childGridView.target.setData(childGridView.list);
	
		});	  
	};	
	
	function isDuplicateValueExists(arr, key) {
		  const values = arr.map(item => item[key]);
		  const uniqueValues = [...new Set(values)];
		  
		  return values.length !== uniqueValues.length;
		}	
	
	function getDuplicateValues(arr, key) {
		  const countMap = {};
		  const duplicates = [];

		  for (let i = 0; i < arr.length; i++) {
		    const value = arr[i][key];

		    if (countMap[value]) {
		      countMap[value]++;
		      if (countMap[value] === 2) {
		        duplicates.push(value);
		      }
		    } else {
		      countMap[value] = 1;
		    }
		  }

		  return duplicates;
		}	
</script>