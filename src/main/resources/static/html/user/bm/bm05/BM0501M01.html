<!DOCTYPE html>
<html lang="ko">
<style>
	.add_btn_small{
	    display: inline-block;
	    padding: 0px;
	}
                
	.add_btn_small a {
	    display: inline-block;
	    width: 33px;
	    height: 20px;
	    line-height: 20px;
	    text-align: center;
	    color: #444;
	    background: #ffffff;
	    box-shadow: 1px 1px rgba(0,0,0,0.15);
	}
</style>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
	<link rel="stylesheet" href="/static/fontawesome/css/all.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5grid.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5mask.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5modal.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5toast.css">
	<link rel="stylesheet" href="/static/css/jstree/style.min.css">
	<link rel="stylesheet" href="/static/css/gnb.css">
	<link rel="stylesheet" href="/static/css/main.css">
	<link rel="stylesheet" href="/static/css/sub.css">
	<link rel="stylesheet" href="/static/css/common.css">
          
	<script src="/static/js/jquery-latest.min.js"></script>
	<script src="/static/js/jquery.serializeObject.js"></script>
	<script src="/static/bootstrap/js/bootstrap.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
	<script src="/static/js/moment/moment-with-locales.js"></script>
	<script src="/static/js/ax5/ax5core.min.js"></script>
	<script src="/static/js/ax5/ax5grid.min.js"></script>
	<script src="/static/js/ax5/ax5mask.min.js"></script>
	<script src="/static/js/ax5/ax5modal.min.js"></script>
	<script src="/static/js/ax5/ax5toast.min.js"></script>
	<script src="/static/js/jstree/jstree.min.js"></script>
	<script type="text/javascript" src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" ></script>
	<script src="/static/js/global.js"></script>
</head>

<body>
	<div id="head_area"></div>
	<div id="top_area"></div>
	<div id="main_area">
		<!-- 페이지 상단 -->
		<div class="contents no_bg">
			<ul class="btn_ul">
				<li class="btn_r">
					<a onclick="initSearch();">
						<button class="bg_gray">초기화</button>
					</a>
					<a onclick="bmMstrGridView.setData(0);">
						<button class="bg_gray">검 색</button>
					</a>
	        	</li>
			</ul>
        </div>
		<!-- 검색 콘텐츠 -->
		<div class="contents search">
			<div class="">
				<!-- 테이블 인풋 2분할 -->
				<table class="table_input type04">
					<!-- 검색조건 1행 -->
					<tr>
						<th class= "hit">회사</th>
						<td>
							<select id="coCd_S" data-kind="CO" required="required" onchange="bmMstrGridView.setData(0);">
						    	<option value="">전체</option>
							</select>
						</td>
						<th>품목구분</th>
			            <td>
							<select id="goodsDiv_S" data-kind="GOODSDIV" onchange="getGrid();">
								<option value="">선택</option>
							</select>
						</td>
						<th>자재유형</th>
						<td>
							<select id="matrDiv_S" data-kind="MATRDIV">
								<option value="">선택</option>
							</select>
						</td>
						<th>자재그룹</th>
						<td>
							<select id="matrGrp_S" data-kind="MATRGRP">
								<option value="">선택</option>
							</select>
						</td>
			        </tr>
		            <!-- 검색조건 2행 -->   
					<tr>
					<!--  품번 : 거래처구분(자재거래처분류)의 부모ID값 + 순번5자리 ex) 200-00001  -->
						<th>품번</th>
						<td>
							<input type="hidden" id="matrCd_S" data-kind="matrCd_S" data-search="matrCd_S" required="required" >
							<div class="search_form"  style="width: 100%;">
								<input type="text" id="matrCdNm_S" data-kind="matrCdNm_S" data-search="matrCdNm_S" required="required" onkeyup="if(window.event.keyCode == 13){bmMstrGridView.setData(0)};">
								<a onclick="openMatListSearch('P');"><i class="i_search_w"></i></a>
							</div>
						</td>
						<th>품명</th>
						<td>
						    <input type="text" id="matrNm_S" data-kind="matrNm_S" onkeyup="if(window.event.keyCode == 13){bmMstrGridView.setData(0)};">
						</td>
						<th>형번</th>
						<td>
							<input type="text" id="matrMno_S" data-kind="matrMno_S" onkeyup="if(window.event.keyCode == 13){bmMstrGridView.setData(0)};">
						</td>        
						<th>규격</th>
						<td>
							<input type="text" id="matrSpec_S" data-kind="matrSpec_S" onkeyup="if(window.event.keyCode == 13){bmMstrGridView.setData(0)};">
						</td>  
					</tr>
		            <!-- 검색조건 END -->
	            </table>
            </div>
        </div>
		<!-- // 콘텐츠 -->

		<!-- 콘텐츠 -->
		<div class="contents no_bg">
		<!-- 콘텐츠 타이틀 -->
		<div class="contents_tit">
			<span style="height: 30px; line-height: 30px;font-size: 15px;"></span>
			<div class="add_btn_small pdl10">
				<a onclick="" data-grid-control="row-add" style="height: 30px; line-height: 28px;"authchk>+</a>
				<a onclick="" data-grid-control="row-remove" style="height: 30px; line-height: 28px;" authchk>-</a>
				<a onclick="excelDown();" style="height: 30px; line-height: 28px; width: 90px;"><i class="fas fa-file-excel"></i> 엑셀다운로드</a>
			</div>
				<select id="recordCnt" class="prae_select" data-search="recordCnt" onchange="changeRecordCnt();">
					<option value="10">10</option>
					<option value="20" selected>20</option>
					<option value="50">50</option>
					<option value="100">100</option>
					<option value="9999999">전체</option>
		        </select>
			</div>
		</div>
		<!-- 콘텐츠 -->
		<div class="contents">
			<table>
				<!-- 1행 -->
				<tr>
					<td>
					<!-- 그리드의 행추가 -->
						<div class="ax5_grid" data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 650px; width: 100%" ></div>
						<div data-ax5grid="excel-grid" data-ax5grid-config="{}" style="display: none;"></div>
					</td>
					<td>
						<div class="popup_area">
							<form id="inputForm">
								<table class="popup_table" style="height: 620px; width: 100%;">
									<thead></thead>
									<tbody>
										<tr>
											<th class="hit">회사</th>
											<td>
												<input type="hidden" id="fileTrgtKey">
												<select id="coCd" name="coCd" data-kind="CO" data-search="coCd" required="required">
													<option value="">선택</option>
												</select>
											</td>	
										</tr>
										<tr>
											<th>품번</th>
											<td>
												<input type="text" id="matrCd" name="matrCd" data-kind="matrCd" data-search="matrCd" disabled="disabled">
											</td>
											<th class="hit">품명</th>
											<td>
												<input type="text" id="matrNm" name="matrNm" data-kind="matrNm" data-search="matrNm" required="required">
											</td>
										</tr>
										<tr>
											<th class="hit">품목구분</th>
											<td>
												<div>
													<select id="goodsDiv" name="goodsDiv" data-kind="GOODSDIV" data-search="goodsDiv" required="required">
														<option value="">선택</option>
													</select>
												</div>
											</td>
											<th class="hit">거래처분류</th>
											<td>	
												<div>
													<select id="matrClntDiv" name="matrClntDiv" data-kind="MATRCLNTDIV" data-search="matrClntDiv" required="required" onchange="getMatrCd();">
														<option value="">선택</option>
													</select>
												</div>
											</td>
										</tr>
										<tr>
											<th>자재유형</th>
											<td>
												<div>
													<select id="matrDiv"  name="matrDiv" data-kind="MATRDIV" data-search="matrDiv">
														<option value="">선택</option>
													</select>
												</div>
											</td>
											<th>자재그룹</th>
											<td>
												<div>
													<select id="matrGrp" name="matrGrp" data-kind="MATRGRP" data-search="matrGrp">
														<option value="">선택</option>
													</select>
												</div>
											</td>
										</tr>
										<tr>
											<th>소재</th>
											<td>
												<input type="text" id="matrMat" name="matrMat" data-kind="matrMat" data-search="matrMat">
											</td>
											<th>사이즈</th>
											<td>
												<input type="text" id="matrSize" name="matrSize" data-kind="matrSize" data-search="matrSize">
											</td>
										</tr>
										<tr>
											<th>규격</th>
											<td>
												<input type="text" id="matrSpec" name="matrSpec" data-kind="matrSpec" data-search="matrSpec">
											</td>
											<td colspan="2">
												<div>
													<button type="button" id="nrm_btn1" class="btn btn-default btn-sm" onclick="NrmBtn(this.id);">∅</button>
													<button type="button" id="nrm_btn2" class="btn btn-default btn-sm" onclick="NrmBtn(this.id);">X</button>
													<button type="button" id="nrm_btn3" class="btn btn-default btn-sm" onclick="NrmBtn(this.id);">T</button>
													<button type="button" id="nrm_btn4" class="btn btn-default btn-sm" onclick="NrmBtn(this.id);">/</button>
													<button type="button" id="nrm_btn5" class="btn btn-default btn-sm" onclick="NrmBtn(this.id);">-</button>
												</div>
											</td>
										</tr>
										<tr>
											<th>Maker</th>
											<td>
												<input type="text" id="matrMakrNm" name="matrMakrNm" data-kind="matrMakrNm" data-search="matrMakrNm">
											</td>
											<th>형번</th>
											<td>
												<input type="text" id="matrMno" name="matrMno" data-kind="matrMno" data-search="matrMno">
											</td>
										</tr>
										<tr>
											<th>중량</th>
											<td>
												<input type="text" id="matrWt" name="matrWt" data-kind="matrWt" data-search="matrWt">
											</td>
											<th>관리단위</th>
											<td>
												<div>
													<select id="matrUnit" name="matrUnit" data-kind="UNITDIV" data-search="matrUnit">
														<option value="">선택</option>
														<option value="EA" hidden="">EA</option>
													</select>
												</div>
											</td>
										</tr>
										<tr>
											<th>원산지</th>
											<td>
												<input type="text" id="originNm" name="originNm" value="" data-kind="originNm" data-search="originNm">
											</td>
											<th>대표도번</th>
											<td>
												<input type="text" id="matrDrwNo" name="matrDrwNo" value="" data-kind="matrDrwNo" data-search="matrDrwNo">
											</td>
										</tr>
										<tr>
											<th>입고검사구분</th>
											<td>
												<div>
													<select id="matrTestDiv" name="matrTestDiv" data-kind="MATRTESTDIV" data-search="matrTestDiv">
														<option value="">선택</option>
														<option value="무검사" hidden="">무검사</option>
													</select>
												</div>
											</td>
											<th>리드타임</th>
											<td>
												<div>
													<input type="text" id="dlvrRqmDay" name="dlvrRqmDay" data-kind="dlvrRqmDay" data-search="dlvrRqmDay">
												</div>
											</td>
										</tr>
										<tr>
											<th>구매/외주</th>
											<td>
												<div>
													<select id="matrPurcDiv" name="matrPurcDiv" data-kind="MATRPURCDIV" data-search="matrPurcDiv">
														<option value="">선택</option>
														<option value="구매" hidden="">구매</option>
													</select>
												</div>
											</td>
											<th>최소발주량</th>
											<td>
												<div>
													<input type="text" id="minOrdrgQty" name="minOrdrgQty" data-kind="minOrdrgQty" data-search="matrSaftQty">
												</div>
											</td>
										</tr>
										<tr>
											<th>안전재고</th>
											<td>
												<div>
													<input type="text" id="matrSaftQty" name="matrSaftQty" data-kind="matrSaftQty" data-search="matrSaftQty">
												</div>
											</td>
											<th>재고관리여부</th>
											<td>
												<div>
													<select id="matrStockCd" name="matrStockCd" data-kind="matrStockCd" data-search="matrStockCd">
														<option value="">선택</option>
														<option value="Y">Y</option>
														<option value="N">N</option>
													</select>
												</div>
											</td>
										</tr>
										<tr>
											<th>2D설계소요일</th>
											<td>
												<div>
													<input type="text" id="dsgn2dMd" name="dsgn2dMd" data-kind="dsgn2dMd" data-search="dsgn2dMd">
												</div>
											</td>
											<th>3D설계소요일</th>
											<td>
												<div>
													<input type="text" id="dsgn3dMd" name="dsgn3dMd" data-kind="dsgn3dMd" data-search="dsgn3dMd">
												</div>
											</td>
										</tr>
										<tr>
											<th>2D평균소요일</th>
											<td>
												<div>
													<input type="text" id="avrg2dMd" name="avrg2dMd" value="" data-kind="avrg2dMd" data-search="avrg2dMd">
												</div>
											</td>
											<th>3D평균소요일</th>
											<td>
												<div>
													<input type="text" id="avrg3dMd" name="avrg3dMd" value="" data-kind="avrg3dMd" data-search="avrg3dMd">
												</div>
											</td>
										</tr>
										<tr>
											<th>최종생산소요일</th>
											<td>
												<div>
													<input type="text" id="prdctnRqmMd" name="prdctnRqmMd" data-kind="prdctnRqmMd" data-search="prdctnRqmMd">
												</div>
											</td>
											<th>평균생산소요일</th>
											<td>
												<div>
													<input type="text" id="prdctnAvrgMd" name="prdctnAvrgMd" data-kind="prdctnAvrgMd" data-search="prdctnAvrgMd">
												</div>
											</td>
										</tr>
										<tr>
											<th>구매업체1</th>
											<td>
										   		<input type="hidden" id="pchsClntCd1" name="pchsClntCd1" data-kind="pchsClntCd1" data-search="pchsClntCd1">
					                            <div class="search_form" style="width: 100%;">
					                                <input type="text" id="pchsClntNm1" name="pchsClntNm1" data-kind="pchsClntNm1" data-search="pchsClntNm1" onkeyup="if(event.keyCode == 13){openClntSearch('P', 1)};"> 
					                                <a onclick="openClntSearch('P', 1);"><i class="i_search_w"></i></a>
					                            </div>
											</td>
											<th>발주비율1</th>
											<td>
												<div>
													<input type="text" id="pchsClntPct1" name="pchsClntPct1" data-kind="pchsClntPct1" data-search="pchsClntPct1">
												</div>
											</td>
										</tr>
										<tr>
											<th>구매업체2</th>
											<td>
												<input type="hidden" id="pchsClntCd2" name="pchsClntCd2" data-kind="pchsClntCd2" data-search="pchsClntCd2">
					                            <div class="search_form" style="width: 100%;">
					                            	<input type="text" id="pchsClntNm2" name="pchsClntNm2" data-kind="pchsClntNm2" data-search="pchsClntNm2" onkeyup="if(window.event.keyCode == 13){openClntSearch('P', 2)};"> 
					                                <a onclick="openClntSearch('P', 2);"><i class="i_search_w"></i></a>
					                            </div>
											</td>
											<th>발주비율2</th>
											<td>
												<input type="text" id="pchsClntPct2" name="pchsClntPct2" data-kind="pchsClntPct2" data-search="pchsClntPct2">
											</td>
										</tr>
										<tr>
											<th>구매업체3</th>
											<td>
											<input type="hidden" id="pchsClntCd3" name="pchsClntCd3" data-kind="pchsClntCd3" data-search="pchsClntCd3">
					                            <div class="search_form" style="width: 100%;">
					                            	<input type="text" id="pchsClntNm3" name="pchsClntNm3" data-kind="pchsClntNm3" data-search="pchsClntNm3" onkeyup="if(event.keyCode == 13){openClntSearch('P', 3)};"> 
					                                <a onclick="openClntSearch('P', 3);"><i class="i_search_w"></i></a>
					                            </div>
											</td>
											<th>발주비율3</th>
											<td>
												<input type="text" id="pchsClntPct3" name="pchsClntPct3" data-kind="pchsClntPct3" data-search="pchsClntPct3">
											</td>
										</tr>
										<tr>
											<th>최종구매단가</th>
											<td>
												<input type="text" id="matrUpr" name="matrUpr" data-kind="matrUpr" data-search="matrUpr" readonly="readonly">
											</td>
											<th>평균구매단가</th>
											<td>
												<input type="text" id="matrAvrgUpr" name="matrAvrgUpr" data-kind="matrAvrgUpr" data-search="matrAvrgUpr" readonly="readonly">
											</td>
										</tr>
										<tr>
											<th>최종거래일자</th>
											<td>
												<input type="text" id="matrLastTrstDt" name="matrLastTrstDt" data-kind="matrLastTrstDt" data-search="matrLastTrstDt" readonly="readonly">
											</td>
											<th>설계대상구분</th>
											<td>
												<input type="text" id="dsgnTrgtYn" name="dsgnTrgtYn" data-kind="dsgnTrgtYn" data-search="dsgnTrgtYn">
											</td>
										</tr>
									</tbody>
								</table>
							</form>
						</div>
						<div>
							<button id="actionBtn" onclick="insertBmMstrDetail();" authchk>등록</button>
							<button class="close_btn" onclick="modalStack.close();">닫기</button>
						</div>	
					</td>
				</tr>
			</table>
		</div>
	</div>
</body>

<script type="text/javascript">
    var bmMstrGridView = {
    	initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
				// 체크박스
				showRowSelector: true,
				multipleSelect: false,
				sortable: true,
				target: $('[data-ax5grid="first-grid"]'),
				header: {
	              align: "center",
	              selector: false
	            },
	            body: {
					onClick: function() {
					    this.self.select(this.dindex);
					    var row = this.dindex;
                        var paramObj = {"row" : row};
                        // 그리드값 가져오기 호출
                        getGrid();
					},
					onDBLClick: function() {
						this.self.clearSelect();
                        this.self.select(this.dindex);
					},
			   },
	           page: {
					navigationItemCount: 9,
					height: 30,
					display: true,
					firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
					prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
					nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
					lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
					onChange: function() {
						bmMstrGridView.setData(this.page.selectPage); 
					}
	           },
	           columns: [
//	        	   {key: "coCd", 		label: "회사",		hidden: true},
//	        	   {key: "fileTrgtKey", label: "파일타켓키",	hidden: true},
	        	   {key: "rn",			label: "No.",		align: "center",	width: 60},
	               {key: "matrCd",		label: "품번",		align: "center",   	width: 130},
	               {key: "matrNm",		label: "품명",   		align: "center",   	width: 130},
	               {key: "goodsDivNm",	label: "품목구분",		align: "center",   	width: 130},
	               {key: "matrDivNm",	label: "자재유형",    	align: "left",   	width: 130},
	               {key: "matrGrpNm",   label: "자재그룹",    	align: "left",   	width: 130},
//	               {key: "rn",			label: "No.",      	align: "center",   	width: 60},
	               {key: "matrMat",     label: "재질",      	align: "left",   	width: 130},
	               {key: "matrMakrNm",  label: "Maker",     align: "left",   	width: 130},
	               {key: "matrMno",     label: "형번",      	align: "left",   	width: 130},
	               {key: "matrSpec",	label: "규격",      	align: "left",   	width: 130},
	               {key: "matrGrpNm",	label: "자재그룹",    	align: "left",   	width: 120},
	               {key: "matrTestDivNm",	label: "입고검사구분",	align: "left",  width: 120}, 
	               {key: "matrUnitNm",	label: "관리단위",    	align: "left",   	width: 100},
	               {key: "dlvrRqmDay",  label: "리드타임",    	align: "right",   	width: 100},
	               {key: "minOrdrgQty", label: "최소발주량",   align: "right",   	width: 100},
	               {key: "matrSaftQty", label: "안전재고",    	align: "right",  	width: 100},
	               {key: "creatDttm",   label: "등록일시",    	align: "center",   	width: 120},
	               {key: "creatId",     label: "등록자",		align: "center",   	width: 100},
	               {key: "udtDttm",     label: "수정일시",    	align: "center",   	width: 120},
	               {key: "udtId",      	label: "수정자",		align: "center",   	width: 100}
	              ]
	        });
			return this;
    	},
		setData: function(_pageNo) {
		var targetObj = this.target;
        	var formData = new FormData();
        	var formData = {
				// 조회조건 수정하기
				"coCd" : $("#coCd_S").val(), 
               	"goodsDiv" : $("#goodsDiv_S").val(),
               	"matrDiv" : $("#matrDiv_S").val(),
               	"matrGrp" : $("#matrGrp_S").val(),
               	//"matrCd" : $("#matrCd_S").val(),
               	"matrCd" : $("#matrCdNm_S").val(),
               	"matrNm" : $("#matrNm_S").val(),
               	"matrMno" : $("#matrMno_S").val(),
               	"matrSpec" : $("#matrSpec_S").val(),
               	"pageNo" : _pageNo + 1, 
               	"recordCnt" : $("#recordCnt").val()
			}
			postAjax("/user/bm/bm05/selectBmMstrList", formData, null, function(data){
			var list = data.resultList;
			targetObj.setData({
				list : list,
			    page : {
                	currentPage : _pageNo,
                    pageSize : data.paginationInfo.pageSize,
                    totalElements : data.paginationInfo.totalRecordCount,
                    totalPages : data.paginationInfo.totalPageCount
			    } 
			});
			setBmMstr(list);
            });
      	    // this.target.select(0);
		} 
	}

	var excelView = {
		initView: function() {
		this.target = new ax5.ui.grid();
		this.target.setConfig({
		target: $('[data-ax5grid="excel-grid"]'),
		columns: [
     	   	{key: "rn",			label: "No.",		align: "center",	width: 60},
            {key: "matrCd",		label: "품번",		align: "center",   	width: 130},
            {key: "matrNm",		label: "품명",   		align: "left",   	width: 130},
            {key: "goodsDivNm",	label: "품목구분",		align: "left",   	width: 130},
            {key: "matrDivNm",	label: "자재유형",    	align: "left",   	width: 130},
            {key: "matrGrpNm",   label: "자재그룹",    	align: "left",   	width: 130},
            {key: "rn",			label: "No.",      	align: "center",   	width: 60},
            {key: "matrMat",     label: "재질",      	align: "left",   	width: 130},
            {key: "matrMakrNm",  label: "Maker",     align: "left",   	width: 130},
            {key: "matrMno",     label: "형번",      	align: "left",   	width: 130},
            {key: "matrSpec",	label: "규격",      	align: "left",   	width: 130},
            {key: "matrGrpNm",	label: "자재그룹",    	align: "left",   	width: 120},
            {key: "matrTestDivNm",	label: "입고검사구분",	align: "left",  width: 120}, 
            {key: "matrUnitNm",	label: "관리단위",    	align: "left",   	width: 100},
            {key: "dlvrRqmDay",  label: "리드타임",    	align: "right",   	width: 100},
            {key: "minOrdrgQty", label: "최소발주량",   align: "right",   	width: 100},
            {key: "matrSaftQty", label: "안전재고",    	align: "right",  	width: 100},
            {key: "creatDttm",   label: "등록일시",    	align: "left",   	width: 120},
            {key: "creatId",     label: "등록자",		align: "left",   	width: 100},
            {key: "udtDttm",     label: "수정일시",    	align: "center",   	width: 120},
            {key: "udtId",      	label: "수정자",		align: "left",   	width: 100}
           ]
		});
	    return this;
      }
    }
    
    // 그리드 추가, 삭제
	$('[data-grid-control]').click(function() {
    	switch (this.getAttribute("data-grid-control")) {
        	case "row-add":
            	bmMstrGridView.target.addRow($.extend({}, bmMstrGridView.target.list.length, {__index: undefined}));
            	// 초기화
            	initSearch();
            	// 기본값 넣기
            	setDefaultVal();
                break;
            case "row-remove":
            	bmMstrGridView.target.removeRow();
                break;
        }
    });
    
    // 초기화
    function initSearch() {
        // select, input 값 모두 초기화
		$(".contents.search select").val("");
        $(".contents.search input[type='text']").val("");
        
        // 회사 초기화
        $("#coCd_S").val(jwt.coCd);
        
       	// 상세정보 초기화
		$.each($('#main_area [data-kind]'), function(idx, elem) {
			$(elem).val("");
        });
		 
		// 재검색
		// 주석 처리해야 문제 없음
		//bmMstrGridView.setData();
	}
    
    // 상세 입력 기본값 넣기
    function setDefaultVal() {
    	// 관리단위
    	$('#matrUnit').val("UNITDIV007"); //UNITDIV007 - EA
    	// 입고검사구분
    	$('#matrTestDiv').val("MATRTESTDIV01"); // MATRTESTDIV01 - 무검사
    	// 구매/외주
    	$('#matrPurcDiv').val("MATRPURCDIV01"); // MATRPURCDIV01 - 구매
    	// 중량 0
    	$('#matrWt').val("0");
    	// 재고관리여부 N
    	$('#matrStockCd').val("N");
    	// 리드타임 0
    	$('#dlvrRqmDay').val("0");
    	// 최소발주량 0
    	$('#minOrdrQty').val("0");
    	// 소요일 0
    	$('#dsgn2dMd').val("0");
    	$('#avrg2dMd').val("0");
    	$('#dsgn3dMd').val("0");
    	$('#avrg3dMd').val("0");
    	$('#prdctnRqmMd').val("0");
    	$('#prdctnAvrgMd').val("0");
    	// 안전재고0
    	$('#matrSaftQty').val("0");
    	// 발주비율 0
    	$('#pchsClntPct1').val("0");
    	$('#pchsClntPct2').val("0");
    	$('#pchsClntPct3').val("0");
    }
    
	// 페이지 로드
	$(document).ready(function() {
		mainDefaultLoad("기준관리", "자재마스터관리");
		setCommonSelect($("#main_area select[data-kind]"));
		// 접속자 회사 set
		$("#coCd_S").val(jwt.coCd); // user.getCoCd() -> 건양 ITT
		
		// 페이지 가져오기
		bmMstrGridView.initView().setData(0);
		// bmMstrGridView.target.select(0);
		excelView.initView();
		// 선택한 그리드값 가져오기 호출
		getGrid();
	});

	function excelDown() {
		var formData = {
			"coCd" : $("#coCd_S").val(),
			"pageNo" : 1,
			"recordCnt" : 99999999
		}
		postAjax("/user/bm/bm05/selectBmMstrList", formData, null, function(
				data) {
			var list = data.resultList;
			excelView.target.setData({
				list : list,
				page : {
					totalElements : list.length,
				}
			});
			var todayDate = new Date().format('yyyyMMddHHmmss');
			excelView.target.exportExcel("자재마스터관리_" + todayDate + ".xls");
		});
	}
	
	function changeRecordCnt() {
		//alert($("#recordCnt").val());
		//bmMstrGridView.initView();
		bmMstrGridView.setData(0);
	}

	// 선택한 행의 그리드 값 가져오기
	function getGrid() {
		// 선택한 행 가져오기
		var row = bmMstrGridView.target.getList("selected")[0]; // Object
		if (row !== undefined) {
			// 파일타켓키
			$('#fileTrgtKey').val(row.fileTrgtKey);
			// 회사
			$('#coCd').val(row.coCd);
			// 품번
			$('#matrCd').val(row.matrCd).prop('disabled',true);
			// 품명
			$('#matrNm').val(row.matrNm);
			// 품목구분
			$('#goodsDiv').val(row.goodsDiv);
			// 자재유형
			$('#matrDiv').val(row.matrDiv);
			// 자재그룹
			$('#matrGrp').val(row.matrGrp);
			// 소재
			$('#matrMat').val(row.matrMat);
			// 규격
			$('#matrSpec').val(row.matrSpec);
			// 사이즈
			$('#matrSize').val(row.matrSize);
			// Maker
			$('#matrMakrNm').val(row.matrMakrNm);
			// 형번
			$('#matrMno').val(row.matrMno);
			// 입고검사구분
			$('#matrTestDiv').val(row.matrTestDiv);
			// 관리단위
			$('#matrUnit').val(row.matrUnit);
			// 안전재고
			$('#matrSaftQty').val(row.matrSaftQty);
			// 최소발주량
			$('#minOrdrgQty').val(row.minOrdrgQty);
			// 거래처 구분
			$('#matrClntDiv').val(row.matrClntDiv);
			// 구매/외주구분
			$('#matrPurcDiv').val(row.matrPurcDiv);
			// 중량 
			$('#matrWt').val(row.matrWt);
			// 원산지
			$('#originNm').val(row.originNm);
			// 대표도번
			$('#matrDrwNo').val(row.matrDrwNo);
			// 재고관리여부
			$('#matrStockCd').val(row.matrStockCd);
			// 2D설계소요일
			$('#dsgn2dMd').val(row.dsgn2dMd);
			// 2D평균소요일
			$('#avrg2dMd').val(row.avrg2dMd);
			// 3D설계소요일
			$('#dsgn3dMd').val(row.dsgn3dMd);
			// 3D평균소요일 -> 화면설계서 상 2D평균소요일로 되어 있음(고칠 예정?)
			$('#avrg3dMd').val(row.avrg3dMd);
			// 최종생산소요일
			$('#prdctnRqmMd').val(row.prdctnRqmMd);
			// 평균생산소요일
			$('#prdctnAvrgMd').val(row.prdctnAvrgMd);
			// 최종구매단가
			$('#matrUpr').val(row.matrUpr);
			// 평균구매단가
			$('#matrAvrgUpr').val(row.matrAvrgUpr);
			// 최종거래일자
			$('#matrLastTrstDt').val(row.matrLastTrstDt);
			// 발주비율1
			$('#pchsClntPct1').val(row.pchsClntPct1);
			// 발주비율2
			$('#pchsClntPct2').val(row.pchsClntPct2);
			// 발주비율3
			$('#pchsClntPct3').val(row.pchsClntPct3);
			// 설계대상구분 
			$('#dsgnTrgtYn').val(row.dsgnTrgtYn);
			// 리드타임
			$('#dlvrRqmDay').val(row.dlvrRqmDay);
			// 구매업체1
			$('#pchsClntNm1').val(row.pchsClntCd1Nm);
			// 구매업체2
			$('#pchsClntNm2').val(row.pchsClntCd2Nm);
			// 구매업체3
			$('#pchsClntNm3').val(row.pchsClntCd3Nm);
		}
	}

	// 구매업체 1,2,3 검색
	function openClntSearch(openType, flag) {
		//debugger;
		//console.log(flag);
		var paramObj;
		if (flag == 1) {
			paramObj = {"searchValue" : $("#pchsClntNm1").val()}
		} else if (flag == 2) {
			paramObj = {"searchValue" : $("#pchsClntNm2").val()}

		} else if (flag == 3) {
			paramObj = {"searchValue" : $("#pchsClntNm3").val()}
		}
		openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420,
			"구매업체 검색", paramObj, function(grid) {
			var row = grid.target.getList("selected")[0];
			if (openType == "P" && flag == 1) {
				$('#pchsClntCd1').val(row.clntCd);
				$('#pchsClntNm1').val(row.clntNm);
			} else if (openType == "P" && flag == 2) {
				$('#pchsClntCd2').val(row.clntCd);
				$('#pchsClntNm2').val(row.clntNm);
			} else if (openType == "P" && flag == 3) {
				$('#pchsClntCd3').val(row.clntCd);
				$('#pchsClntNm3').val(row.clntNm);
			}
		});
	}
	
	// 페이지 로드 시 상세입력 속성 값넣기(첫번째 행 데이터)
	function setBmMstr(list) {
		// list -> grid
		var lst = list;
		if (lst.length !== undefined) {
			$('#fileTrgtKey').val(lst[0].fileTrgtKey);
			$('#coCd').val(lst[0].coCd);
			$('#matrCd').val(lst[0].matrCd).prop('disabled',true);
			$('#matrNm').val(lst[0].matrNm);
			$('#goodsDiv').val(lst[0].goodsDiv);
			$('#matrDiv').val(lst[0].matrDiv);
			$('#matrGrp').val(lst[0].matrGrp);
			$('#matrMat').val(lst[0].matrMat);
			$('#matrSpec').val(lst[0].matrSpec);
			$('#matrSize').val(lst[0].matrSize);
			$('#matrMakrNm').val(lst[0].matrMakrNm);
			$('#matrMno').val(lst[0].matrMno);
			$('#matrTestDiv').val(lst[0].matrTestDiv);
			$('#matrUnit').val(lst[0].matrUnit);
			$('#matrSaftQty').val(lst[0].matrSaftQty);
			$('#minOrdrgQty').val(lst[0].minOrdrgQty);
			$('#matrClntDiv').val(lst[0].matrClntDiv);
			$('#matrPurcDiv').val(lst[0].matrPurcDiv);
			$('#matrWt').val(lst[0].matrWt);
			$('#originNm').val(lst[0].originNm);
			$('#matrDrwNo').val(lst[0].matrDrwNo);
			$('#matrStockCd').val(lst[0].matrStockCd);
			$('#dsgn2dMd').val(lst[0].dsgn2dMd);
			$('#avrg2dMd').val(lst[0].avrg2dMd);
			$('#dsgn3dMd').val(lst[0].dsgn3dMd);
			$('#avrg3dMd').val(lst[0].avrg3dMd);
			$('#prdctnRqmMd').val(lst[0].prdctnRqmMd);
			$('#prdctnAvrgMd').val(lst[0].prdctnAvrgMd);
			$('#matrUpr').val(lst[0].matrUpr);
			$('#matrAvrgUpr').val(lst[0].matrAvrgUpr);
			$('#matrLastTrstDt').val(lst[0].matrLastTrstDt);
			$('#pchsClntPct1').val(lst[0].pchsClntPct1);
			$('#pchsClntPct2').val(lst[0].pchsClntPct2);
			$('#pchsClntPct3').val(lst[0].pchsClntPct3);
			$('#dsgnTrgtYn').val(lst[0].dsgnTrgtYn);
			$('#dlvrRqmDay').val(lst[0].dlvrRqmDay);
			$('#pchsClntNm1').val(lst[0].pchsClntCd1Nm);
			$('#pchsClntNm2').val(lst[0].pchsClntCd2Nm);
			$('#pchsClntNm3').val(lst[0].pchsClntCd3Nm);
		}
	}
	
	function insertBmMstrDetail() {
		// 선택한 행이 없으면 입력
		var row = bmMstrGridView.target.getList("selected")[0];
		if(row === undefined) {
			if ($('#coCd').val() == "") {
		        alert("회사를 입력하세요");
		        return;
		    }
		    if ($('#matrNm').val() == "") {
		        alert("품명을 입력하세요");
		        return;
		    }
		    if ($('#goodsDiv').val() == "") {
		        alert("품목구분을 입력하세요");
		        return;
		    }
		    if ($('#matrClntDiv').val() == "") {
		        alert("거래처분류를 입력하세요");
		        return;
		    }
		    /* 자재마스터 중복체크 조회 */
		    // 품명, 소재품명, 메이커품명, 형번품명, 규격품명, 사이즈
		    var paramObj = {
		        "IMatrNm" : $('#matrNm').val(),
		        "IMatrMat" : $('#matrMat').val(),
		        "IMatrMakrNm" : $('#matrMakrNm').val(),
		        "IMatrMno" : $('#matrMno').val(),
		        "IMatrSpec" : $('#matrSpec').val(),
		        "IMatrSize" : $('#matrSize').val()
		    }
		    const matrCd = $('#matrCd').val();
			postAjaxSync("/user/bm/bm05/selectMatrCdChk", paramObj, null, function(data) {
				// 중복 체크할 품번값
		    	var chk = data.result;
			    //console.log("체크 " + chk);
		    });
		    var formData = new FormData($('#inputForm')[0]);
		    
		    $.each($('#inputForm [data-search]'), function(idx, elem) {
		        formData.append($(elem).data("search"), $(elem).val());
		    });
		    // 생성자
		    formData.append("creatId", jwt.userId);
		    // 생성프로그램ID
		    formData.append("creatPgm", "BM0501M01");
			
		    filePostAjax("/user/bm/bm05/insertBmMstr", formData, function(data) {
			    // 상세정보 넣기
				if(data.resultCode == 200) {
					alert(data.resultMessage);
		            bmMstrGridView.setData(0);
		            // bmMstrGridView.initView().setData(); // 페이징이 안나옴
				}
		    });
    		// 선택한 행이 있을 때 수정
		} else if(row !== undefined) {
			//console.log("선택한 행은 " + row.rn + "행");
			var formData = new FormData($('#inputForm')[0]);
			//debugger;
			$.each($('#inputForm [data-search]'), function(idx, elem) {
				formData.append($(elem).data("search"), $(elem).val());
			});
			// 생성자
			formData.append("creatId", jwt.userId);
			// 생성프로그램ID
			formData.append("creatPgm", "BM0501M01");
			// 파일타겟키
			formData.append("fileTrgtKey", $('#fileTrgtKey').val());
			
			filePutAjax("/user/bm/bm05/updateBmMstr", formData, function(data) {
				if (data.resultCode == 200) {
					alert(data.resultMessage);
					//modalStack.close();
					bmMstrGridView.setData(0);
				}
			});
		} // 여기가 if-else문 끝
	} 
			
	// 자재 품번 팝업
	function openMatListSearch(openType) {
		// setBmMstr()에서 강제로 맨위에 있는 행을 선택하고 있기 때문에 값을 초기화 해줘야한다. 230601
		/* 수정해야함 그리드 컬럼을 전부 초기화해야하는 듯 */
		/* 품번, 품명만 초기화 해두기 */
		//debugger;
		// $('#coCd').val(""); // 회사 초기화
		$('#matrCd').val("");
		$('#matrNm').val("");
		//alert("searchValue : " + $("#matrCdNm_S").val());
		var paramObj = {
			"searchValue" : $("#matrCdNm_S").val()
		}	
		openSecondModal("/static/html/cmn/modal/matListSearch.html", 600, 420, "자재 품번 검색", paramObj, function(grid) {
			var row = grid.target.getList("selected")[0];
			//console.log(row.matrCd);
			if (openType == "P") {
				$('#matrCd_S').val(row.matrCd);		// 	품번 값 가져오기
				$('#matrCdNm_S').val(row.matrCd);	//	품번 값 가져오기
			} 
		}); 
	}
				
	// 버튼 클릭 시 규격값 + 처리
	// 규격 버튼
	function NrmBtn(buttonId) {
		var row = bmMstrGridView.target.getList("selected")[0];
		const matrSpec = $('#matrSpec').val();
		// console.log(matrSpec);
		// var buttonId = this.id;
		// console.log(buttonId);
		if (buttonId === "nrm_btn1") {
			// ∅ 파이 : &#8709;
			//$('#matrSpec').val(matrSpec + '∅'); // ?로 들어감
			$('#matrSpec').val(matrSpec + "&#8709;");
		} else if(buttonId === "nrm_btn2") {
			// X
			$('#matrSpec').val(matrSpec + "X");
		} else if(buttonId === "nrm_btn3") {
			// T
			$('#matrSpec').val(matrSpec + "T");
		} else if(buttonId === "nrm_btn4") {
			// /
			$('#matrSpec').val(matrSpec + "/");
		} else if(buttonId === "nrm_btn5") {
			// -
			$('#matrSpec').val(matrSpec + "-");
		} 		
	}

	// 품번 만드는 함수 부모 코드 + "-" 00001(채번)
	// 거래처 분류(구분)를 선택하면 품번 불러오게 만들기
	//	중복 시 'N' 리턴하며 미중복 시 신규 생성가능품번 리턴
 	function getMatrCd() {
 		var matrCdData = {
  			"matrClntDiv" : $('#matrClntDiv').val()
  		}
 		postAjaxSync("/user/bm/bm05/selectMatrCd", matrCdData, null, function(data){
			var val1 = data.result[0].codeRprc;		// 부모코드
			var val2 = data.result[0].matrCdMax; 	// 최대값
			if(data.result == undefined) {
				$('#matrCd').val(val1 + "-" + "00001");
			}
			if(data.result !== undefined) {
				if (val2.length == 1) {
					$('#matrCd').val(val1 + "-" + "0000" + val2);
				} else if (val2.length == 2) {
					$('#matrCd').val(val1 + "-" + "000" + val2);
				} else if (val2.length == 3) {
					$('#matrCd').val(val1 + "-" + "00" + val2);
				} else if (val2.length == 4) {
					$('#matrCd').val(val1 + "-" + "0" + val2);
				} else if (val2.length == 5) {
					$('#matrCd').val(val1 + "-" + val2);
				}
			}
		});
	}
</script>
</html>