<!DOCTYPE html>
<html lang="ko">
<style>
	.add_btn_small{
	    display: inline-block;
	    padding: 0px;
	}
                
	.add_btn_small a {
	    display: inline-block;
	    width: 33px;
	    height: 20px;
	    line-height: 20px;
	    text-align: center;
	    color: #444;
	    background: #ffffff;
	    box-shadow: 1px 1px rgba(0,0,0,0.15);
	}
</style>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
	<link rel="stylesheet" href="/static/fontawesome/css/all.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5grid.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5mask.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5modal.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5toast.css">
	<link rel="stylesheet" href="/static/css/jstree/style.min.css">
	<link rel="stylesheet" href="/static/css/gnb.css">
	<link rel="stylesheet" href="/static/css/main.css">
	<link rel="stylesheet" href="/static/css/sub.css">
	<link rel="stylesheet" href="/static/css/common.css">
          
	<script src="/static/js/jquery-latest.min.js"></script>
	<script src="/static/js/jquery.serializeObject.js"></script>
	<script src="/static/bootstrap/js/bootstrap.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
	<script src="/static/js/moment/moment-with-locales.js"></script>
	<script src="/static/js/ax5/ax5core.min.js"></script>
	<script src="/static/js/ax5/ax5grid.min.js"></script>
	<script src="/static/js/ax5/ax5mask.min.js"></script>
	<script src="/static/js/ax5/ax5modal.min.js"></script>
	<script src="/static/js/ax5/ax5toast.min.js"></script>
	<script src="/static/js/jstree/jstree.min.js"></script>
	<script type="text/javascript" src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js" ></script>
	<script src="/static/js/global.js"></script>
</head>

<body>
	<div id="head_area"></div>
	<div id="top_area"></div>
	
	<div id="main_area">
		<!-- 페이지 상단 -->
		<div class="contents no_bg">
			<ul class="btn_ul">
				<li class="btn_r">
					 <a onclick="initSearch(0);">
					 <button class="bg_gray">초기화</button>
					 </a>
					 <a onclick="bmUprMstrGridView.setData(0);">
					 	<button class="bg_gray">검 색</button>
					 </a>
	            </li>
            </ul>
        </div>
		<!-- 검색 콘텐츠 -->
		<div class="contents search">
			<div class="">
				<!-- 테이블 인풋 3분할 -->
				<table class="table_input type04">
					<!-- 검색조건 1행 -->                  
					<tr>
						<th class= "hit">회사</th>
						<td>
							<select  id="coCd_S1"  data-kind="CO" required="required" onchange="selectBmUprMstrGridView.setData(0);">
						      <option value="">전체</option>
							</select>
						</td>
						
						<th>품목구분</th>
			            <td>
							<select id="goodsDiv1" data-kind="GOODSDIV" onchange="getGrid();">
								<option value="">선택</option>
							</select>
						</td>
			
						<th>자재유형</th>
						<td>
							<select id="matrDiv1" data-kind="MATRDIV" onkeyup="event.keyCode == 8 ? salesCd_S.value = '' : event.keyCode == 13 ? gridView.setData(0) : ''">
							   <option value="">선택</option>
							</select>
						</td>
						
						<th>자재그룹</th>
						<td>
							<select id="matrGrp1" data-kind="MATRGRP">
								<option value="">선택</option>
							</select>
						</td>
			        </tr>
			
		            <!-- 검색조건 2행 -->   
					<tr>
						<th>품번</th>
						<td>
							<div class="search_form"  style="width: 100%;">
								<input type="text" id="matrCd1" required="required">
								<a onclick="wbsPlanNoSearch(1);"><i class="i_search_w"></i></a>
							</div>
						</td>
					 
						<th>품명</th>
						<td>
						    <input type="text" class="matrNm1" id="matrNm1"  onkeyup="if(event.keyCode == 13){bmUprMstrGridView.setData(0)};">
						</td>
					 
						<th>형번</th>
						<td>
							<input type="text" class="matrMno1" id="matrMno1" >
						</td>        
					
						<th>규격</th>
						<td>
							<input type="text" class="matrSpec1" id="matrSpec1" >
						</td>  
					</tr>
						     
		            <!-- 검색조건 3행 -->   
					<tr>
						<th>구매업체</th>
						<td>
							<input type="hidden" id="clntCd_S">
							<div class="search_form"  style="width: 100%;">
								<input type="text" id="clntNm_S" required="required">
								<a onclick="openClntSearch(1);"><i class="i_search_w"></i></a>
							</div>
						</td>
					 
						<th>통화단위</th>
						<td>
							<select id="currCd1" data-kind="CURR" >
								<option value="">선택</option>
							</select>
						</td>
					 
						<th>사용여부</th>
						<td>
							<select id="useYn1" >
								<option value="">선택</option>
							</select>
						</td>   
					 
					</tr> 
		            <!-- 검색조건 END -->
	            </table>
            </div>
        </div>
        <!-- // 콘텐츠 -->

		<!-- 콘텐츠 -->
		<div class="contents no_bg">
		<!-- 콘텐츠 타이틀 -->
		<div class="contents_tit">
			<span  style="height: 30px; line-height: 30px;font-size: 15px;"> </span>
			<div class="add_btn_small pdl10">
<!-- 				<a onclick="insertWBSModal();" style="height: 30px; line-height: 28px;" authchk>+</a> -->
				<a onclick="" data-grid-control="row-add" style="height: 30px; line-height: 28px;"authchk>+</a>
				<a onclick="" data-grid-control="row-remove" style="height: 30px; line-height: 28px;" authchk>-</a>
				<a onclick="excelDown();" style="height: 30px; line-height: 28px; width: 90px;"><i class="fas fa-file-excel"></i> 엑셀다운로드</a>
			    </div>
				<select id="recordCnt" class="prae_select" data-search="recordCnt" onchange="changeRecordCnt();">
					<option value="10">10</option>
					<option value="20" selected>20</option>
					<option value="50">50</option>
					<option value="100">100</option>
					<option value="9999999"  >전체</option>
		        </select>
			</div>
		</div>

		<!-- 콘텐츠 -->
		<div class="contents">
			<table>
				<!-- 1행 -->
				<tr>
					<td>
					<!-- 그리드의 행추가 -->
						<div class="ax5_grid" data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 650px; width: 100%" ></div>
						<button id="btn1" onclick="gridAddRow();">+</button>
						<button class="btn btn-default" data-grid-control="row-add">row add</button>
						<button class="btn btn-default" data-grid-control="row-remove" onclick="gridAddRow();">row remove</button>
    					<button class="btn btn-default" data-grid-control="row-update" onclick="gridAddRow();">row update</button>
					</td>
					<td>
						<form id="BmUprHsMstrForm">
							<table style="height: 650px; width: 100%;" class="table_input type03">
							
								<thead></thead>
								<tbody>
									<tr>
										<th class="hit">회사</th>
										<td>
											<input type="hidden" id="fileTrgtKey" data-search="fileTrgtKey" data-kind="fileTrgtKey"  >
											<select id="coCd" name="coCd" data-kind="CO" >
												<option data-search="coCd" value="">선택</option>
											</select>
										</td>	
										<th class="hit">구매업체</th>
										<td>
										
											<div class="search_form" style="width: 100%;">
											     <input type="hidden" id="clntCd" data-search="clntCd">
												<input type="text" id="clntNm" name="clntNm" data-kind="clntNm" data-search="clntNm" required="required"> 
												<a onclick="openClntSearch(2);"> <i class="i_search_w"></i>
												</a>
											</div>
										</td>	
									</tr>
									<tr>
										<th class="hit">품번</th>
										<td>
											<div>
												<div class="search_form"  style="width: 100%;">
													<input type="text" id="matrCd" required="required" data-kind="matrCd" data-search="matrCd">
													<a onclick="wbsPlanNoSearch(2);"><i class="i_search_w"></i></a>
												</div>
											
												<!-- <input type="text" id="matrCd" name="matrCd" data-kind="matrCd" data-search="matrCd"> -->
											</div>
											<div>
												<input type="hidden" name="fileTrgtKey_S1" data-search="fileTrgtKey" id="fileTrgtKey_S1">
											</div>
										</td>
										<th>품명</th>
										<td>
											<div>
												<input type="text" id="matrNm" name="matrNm" data-kind="matrNm" data-search="matrNm">
											</div>
										</td>
									</tr>
									<tr>
										<th>품목구분</th>
										<td>
											<div>
												<select id="goodsDiv" name="goodsDiv" data-kind="GOODSDIV" data-search="goodsDiv" required="required">
													<option value="" selected>선택</option>
												</select>
											</div>
										</td>
										<th>소재</th>
										<td>
											<div>
												<input type="text" id="matrMat" name="matrMat" data-kind="matrMat" data-search="matrMat">
											</div>
										</td>
									</tr>
									<tr>
									
										<th>거래처분류</th>
										<td>	
											<div>
												<select id="matrClntDiv" name="matrClntDiv" data-kind="MATRCLNTDIV" data-search="matrClntDiv" required="required">
													<option value="">선택</option>
												</select>
											</div>
										</td>
										<th>Maker</th>
										<td>	
											<div>
												<input type="text" id="matrMakrNm" name=matrMakrNm data-kind="matrMakrNm" data-search="matrMakrNm" value="">
											</div>
										</td>
									</tr>
									<tr>
										<th>자재유형</th>
										<td>
											<div>
												<select id="matrDiv"  name="matrDiv" data-kind="MATRDIV" data-search="matrDiv" required="required">
													<option value="">선택</option>
												</select>
											</div>
										</td>
										<th>형번</th>
										<td>
											<div>
												<input type="text" id="matrMno" name="matrMno" data-kind="matrMno" data-search="matrMno" value="">
											</div>
										</td>
									</tr>
									<tr>
										<th>자재그룹</th>
										<td>
											<div>
												<select id="matrGrp" name="matrGrp" data-kind="MATRGRP" data-search="matrGrp" required="required">
													<option value="">선택</option>
												</select>
											</div>
										</td>
										<th>규격</th>
										<td>
											<div>
												<input type="text" id="matrSpec" name="matrSpec" data-kind="matrSpec" data-search="matrSpec" value="">
											</div>
										</td>
									</tr>
									<tr>
										<th class="hit">통화단위</th>
										<td>
											<div>		
												<select id="currCd" name="currCd" data-kind="CURR" data-search="currCd" >
													<option value="">선택</option>
												</select>
											</div>
										</td>
										<th class="hit">적용일자</th>		
										<td>									
										    <div class="date_input">
												<input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="adptDt" name="adptDt" date> 
					                           <!-- <input type="text" class="input_calendar" style="width: 100% !important; display: inline-block !important;" id="adptDt" autocomplete="off" date> -->
					                        </div>
										
										</td>												
									</tr>
									<tr>
										<th class="hit">단가구분</th>
										<td>		
											<div>		
												<select id="uprDiv" name="uprDiv" data-kind="UPRDIV" data-search="uprDiv" >
													<option value="">선택</option>
												</select>
											</div>
										</td>
										<th class="hit">단가</th>
										<td>
											<div>
												<input type="text" id="matrUpr" name="matrUpr" data-kind="matrUpr" data-search="matrUpr" value="">
											</div>
										</td>
									</tr>
									<tr>
										<th>공제단가</th>
										<td>
											<div>
												<input type="text" id="deductUpr" name="deductUpr" data-kind="deductUpr" data-search="deductUpr" value="">
											</div>
										</td>
										<th class="hit">사용여부</th>
										<td>
											<div>
											
												<select id="useYn" name="useYn" data-kind="USEYN" data-search="useYn" required="required">
													<option value="">선택</option>
												</select>
											</div>
										</td>
									</tr>
									<tr>
										<th>특이사항</th>
										<td>
											<div>
												<input type="text" id="matrUprRmk" name="matrUprRmk" data-kind="matrUprRmk" data-search="matrUprRmk">
											</div>
										</td>
									</tr>
								
								</tbody>
							</table>
							<div>
								<button type="button"  onclick="insertbmUprMstr()"  >등록</button>
								<button>닫기</button>
							<!-- 	<button type="button" class="btn btn-default btn-sm" id="actionBtn" authchk>등록</button>
								<button type="button" class="btn btn-default btn-sm" onclick="modalStack.close();">닫기</button> -->
							</div>
						</form>
					</td>
				</tr>
			</table>
			<DIV DATA-AX5GRID="excel-grid" DATA-AX5GRID-CONFIG="{}" STYLE="DISPLAY: NONE;"></DIV>
		</div>
		
		<div class="contents">
			<table class="popup_table" style="height:80px;">
				<colgroup>
	           		<col width="30%">
	                <col width="70%">
	           	</colgroup>
	           	<tr style="height:100px;vertical-align:top;">
	               	<td style="border:0px;vertical-align:top;">
	                    <table>
	                    <tr>
	                    <td style="text-align: LEFT;height:20px;border:0px;">*파일폴더</td>
	                    </tr>
	                    <tr>
	                    <td style="height:100px;vertical-align:top;border:0px;" colspan="2"><!-- 파일 리스트 트리 추가 --></td>
	                    </tr>
	                    <tr>
	                    	<th colspan="2">목록</th>
	                    </tr>
	                    <tr>
	                    	<td>영업</td>
	                    	<td></td>
	                    </tr>
	                    <tr>
	                    	<td></td>
	                    	<td>사업계획</td>
	                    </tr>
	                    <tr>
	                    	<td></td>
	                    	<td>사전영업</td>
	                    </tr>
	                    <tr>
	                    	<td></td>
	                    	<td>견적</td>
	                    </tr>
	                    </table>
	               </td>
	               <td style="border:0px;vertical-align:top;">
	                    <table>
	                    <tr>
	                    <td style="text-align: LEFT;height:20px;border:0px;">*첨부파일</td>
	                    </tr>
	                    <tr>
	                    <td style="height:100px;vertical-align:top;border:0px;"><!-- 첨부파일 리스트 그리드 추가 --></td>
	                    </tr>
	                    </table>
	               </td>
	           </tr>
	      </table>
		</div>
			<div data-ax5grid="second-grid" data-ax5grid-config="{}" style="height: 300px; width: 100%" ></div>
		
		
		
    </div>
    	
		
                    
</body>
</html>

<script type="text/javascript">
	//debugger;
    //var openFrom = null;
    var bmUprMstrGridView = {
    	initView: function(){
    		//debugger;
			this.target = new ax5.ui.grid();
			this.target.setConfig({
				// 체크박스
				showRowSelector: true,
				multipleSelect: false,
				sortable: true,
				target: $('[data-ax5grid="first-grid"]'),
				header: {
	              align: "center",
	              selector: false
	            },
	            body: {
					onClick: function () {
					    this.self.select(this.dindex);
					    var row = this.dindex;
                        // 그리드값 가져오기 호출
                        getGrid();
                        bmUprHsMstrGridView.initView().setData(0);
                        
					},
					onDBLClick: function () {
						this.self.clearSelect();
                        this.self.select(this.dindex);
						// updateWBSModal(1);
						/* var cKey = this.column.key;
                        if(cKey == "lvl1"){
                        	var paramObj = {
                                    "actionType": "C",
                                    "coCd": $('#coCd_S').val()
                            };
                        	openModal("/static/html/user/wb/wb01/WB0101P01.html", 1300, 780, "", paramObj);   */
                        //}  
					    //this.self.clearSelect();
					    //this.self.select(this.dindex);
					    /* Grid에서 lvl1, 2, 3 클릭 시 일정 계획 등록 팝업 창 실행 */
                        /* if (this.column.key == "lvl1"){
                            updateWBSModal(1);
                        }
                        else if (this.column.key == "lvl2"){
                            updateWBSModal(2);
                        }
                        else if (this.column.key == "lvl3"){
                            updateWBSModal(3);
                        } */
                        /* 일정계획등록 팝업창 END */
					},
			   },
	           page: {
					navigationItemCount: 9,
					height: 30,
					display: true,
					firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
					prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
					nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
					lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
					onChange: function () {
						bmUprMstrGridView.setData(this.page.selectPage); 
					}
	           },
	           columns: [
                   {key: "fileTrgtKey",      label: "첨부파일키",          align: "center",   width: 130, hidden: true},
	        	   {key: "coCd", 		label: "회사",		hidden: true},
	         	   {key: "coCdNm", 		label: "회사명",		hidden: true},
	        	   /* {key: "rn",      label: "No.",          align: "center",   width: 60}, */
	               {key: "clntNm",      label: "구매업체명",	align: "center",   width: 130, hidden: true},
	               {key: "clntCd",      label: "구매업체",	align: "center",   width: 130},
	               {key: "matrCd",      label: "품번",	align: "center",   width: 130},
	               {key: "matrNm",      label: "품명",      align: "center",   width: 130},
	               {key: "adptDt",      label: "적용일자",      align: "center",   width: 130},
	               {key: "currNm",      label: "통화단위",      align: "center",   width: 130},
	               {key: "currCd",      label: "통화단위",      align: "center",   width: 130,  hidden: true},
	               {key: "uprDivNm",      label: "단가구분",      align: "center",   width: 130},
	               {key: "uprDiv",      label: "단가구분",      align: "center",   width: 130, hidden: true},
	               {key: "matrUpr",      label: "단가",      align: "center",   width: 130},
	               {key: "deductUpr",      label: "공제단가",      align: "center",   width: 130},
	               {key: "useYn",      label: "사용여부",      align: "center",   width: 130},
	               {key: "goodsDiv",      label: "품목구분",	 align: "center",   width: 130},
	               {key: "matrClntDivNm",      label: "거래처분류",	align: "center",   width: 130},
	               {key: "matrClntDiv",      label: "거래처분류",	align: "center",   width: 130, hidden: true},
	               {key: "matrDivNm",      label: "자재유형",      align: "center",   width: 130},
	               {key: "matrDiv",      label: "자재유형",      align: "center",   width: 130, hidden: true},
	               {key: "matrGrpNm",      label: "자재그룹",      align: "center",   width: 100},
	               {key: "matrGrp",      label: "자재그룹",      align: "center",   width: 100, hidden: true},
	               {key: "matrMat",      label: "소재",      align: "left",   width: 130},
	               {key: "matrMakrNm",      label: "Maker",      align: "left",   width: 130},
	               {key: "matrMno",      label: "형번",      align: "left",   width: 200},
	               {key: "matrSpec",      label: "규격",      align: "left",   width: 100},
	               {key: "createId",      label: "생성자",   align: "center",   width: 100}, 
	               {key: "createDttm",      label: "생성일시",      align: "left",   width: 100},
	               {key: "udpId",      label: "변경자",      align: "right",   width: 100},
	               {key: "udpDttm",      label: "변경일시",      align: "right",   width: 120},
	               {key: "matrUprRmk",      label: "특이사항",      align: "center",   width: 130}
	               
		        		/* formatter: function(){
		        			if(this.item.adptDt == undefined){return '-';}
			        		return this.item.adptDt;
			        }} */
	              ]
	        });
	        return this;
		
	      },
          setData: function(_pageNo) {

      			//debugger;
        	    var targetObj = this.target;
        	    var formData = {
        	    		// 조회조건 수정하기
        	               "coCd" : $("#coCd_S1").val(),
        	               "pageNo" : _pageNo + 1, 
        	               "recordCnt" : $("#recordCnt").val(),
          
        	           }
        	    // 여기를 바꿔야함 "/user/bm/bm02/selectBmMstrList"
                postAjax("/user/bm/bm11/selectBmUprMstrList", formData, null, function(data){
                    var list = data.resultList;
                   
/* 	박부장님 230519  */
//                     bmUprMstrGridView.initView().setData(0);	
//                     bmUprMstrGridView.target.select(0);
//                     var row = bmUprMstrGridView.getList("selected"); // Object
					targetObj.setData({
					    list : list,
					    page : {
		                    currentPage : _pageNo,
		                    pageSize : data.paginationInfo.pageSize,
		                    totalElements : data.paginationInfo.totalRecordCount,
		                    totalPages : data.paginationInfo.totalPageCount
					    } 
					});
					setBmUprMstr(list);
                });
        	    // this.target.select(0);

           } 
     }

    var excelView = {
    		initView: function(){
    		this.target = new ax5.ui.grid();
    		this.target.setConfig({
    		target: $('[data-ax5grid="excel-grid"]'),
    		columns: [
                {key: "fileTrgtKey",      label: "첨부파일키",          align: "center",   width: 130, hidden: true},
         	   {key: "coCd", 		label: "회사",		hidden: true},
         	   {key: "coCdNm", 		label: "회사명",		hidden: true},
        	   {key: "rn",      label: "No.",          align: "center",   width: 60},
               {key: "clntNm",      label: "구매업체명",	align: "center",   width: 130, hidden: true},
               {key: "clntCd",      label: "구매업체",	align: "center",   width: 130},
               {key: "matrCd",      label: "품번",	align: "center",   width: 130},
               {key: "matrNm",      label: "품명",      align: "center",   width: 130},
               {key: "adptDt",      label: "적용일자",      align: "center",   width: 130},
               {key: "currNm",      label: "통화단위",      align: "center",   width: 130},
               {key: "currCd",      label: "통화단위",      align: "center",   width: 130, hidden: true},
               {key: "uprDivNm",      label: "단가구분",      align: "center",   width: 130},
               {key: "uprDiv",      label: "단가구분",      align: "center",   width: 130, hidden: true},
               {key: "matrUpr",      label: "단가",      align: "center",   width: 130},
               {key: "deductUpr",      label: "공제단가",      align: "center",   width: 130},
               {key: "useYn",      label: "사용여부",      align: "center",   width: 130},
               {key: "goodsDiv",      label: "품목구분",	 align: "center",   width: 130},
               {key: "matrClntDivNm",      label: "거래처분류",	align: "center",   width: 130},
               {key: "matrClntDiv",      label: "거래처분류",	align: "center",   width: 130, hidden: true},
               {key: "matrDivNm",      label: "자재유형",      align: "center",   width: 130},
               {key: "matrDiv",      label: "자재유형",      align: "center",   width: 130, hidden: true},
               {key: "matrGrpNm",      label: "자재그룹",      align: "center",   width: 100},
               {key: "matrGrp",      label: "자재그룹",      align: "center",   width: 100, hidden: true},
               {key: "matrMat",      label: "소재",      align: "left",   width: 130},
               {key: "matrMakrNm",      label: "Maker",      align: "left",   width: 130},
               {key: "matrMno",      label: "형번",      align: "left",   width: 200},
               {key: "matrSpec",      label: "규격",      align: "left",   width: 100},
               {key: "createId",      label: "생성자",   align: "center",   width: 100}, 
               {key: "createDttm",      label: "생성일시",      align: "left",   width: 100},
               {key: "udpId",      label: "변경자",      align: "right",   width: 100},
               {key: "udpDttm",      label: "변경일시",      align: "right",   width: 120},
               {key: "matrUprRmk",      label: "특이사항",      align: "center",   width: 130}
               ]
    		});
    	    return this;
          }
        }
    
    var bmUprHsMstrGridView = {
        	initView : function(){
        		//debugger;
    			this.target = new ax5.ui.grid();
    			this.target.setConfig({
    				// 체크박스
    				showRowSelector: true,
    				multipleSelect: false,
    				sortable: true,
    				target: $('[data-ax5grid="second-grid"]'),
    				header: {
    	              align: "center",
    	              selector: false
    	            },
    	            body: {
    					onClick: function () {
    					    this.self.select(this.dindex);
    					    //var row = this.dindex;
                            //var paramObj = {"row":row};
                            // 그리드값 가져오기 호출
                            //getGrid();
    					},
    					onDBLClick: function () {
    						this.self.clearSelect();
                            this.self.select(this.dindex);
    						// updateWBSModal(1);
    						/* var cKey = this.column.key;
                            if(cKey == "lvl1"){
                            	var paramObj = {
                                        "actionType": "C",
                                        "coCd": $('#coCd_S').val()
                                };
                            	openModal("/static/html/user/wb/wb01/WB0101P01.html", 1300, 780, "", paramObj);   */
                            //}  
    					    //this.self.clearSelect();
    					    //this.self.select(this.dindex);
    					    /* Grid에서 lvl1, 2, 3 클릭 시 일정 계획 등록 팝업 창 실행 */
                            /* if (this.column.key == "lvl1"){
                                updateWBSModal(1);
                            }
                            else if (this.column.key == "lvl2"){
                                updateWBSModal(2);
                            }
                            else if (this.column.key == "lvl3"){
                                updateWBSModal(3);
                            } */
                            /* 일정계획등록 팝업창 END */
    					},
    			   },
    	           page: {
    					navigationItemCount: 9,
    					height: 30,
    					display: true,
    					firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
    					prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
    					nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
    					lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
    					onChange: function () {
    						bmUprHsMstrGridView.setData(this.page.selectPage); 
    					}
    	           },
    	           columns: [
                       {key: "fileTrgtKey",      label: "첨부파일키",          align: "center",   width: 130, hidden: true},
    	        	   {key: "coCd", 		label: "회사",		hidden: true},
    	         	   {key: "coCdNm", 		label: "회사명",		hidden: true},
    	        	   {key: "rn",      label: "No.",          align: "center",   width: 60},
    	               {key: "clntNm",      label: "구매업체명",	align: "center",   width: 130, hidden: true},
    	               {key: "clntCd",      label: "구매업체",	align: "center",   width: 130},
    	               {key: "matrCd",      label: "품번",	align: "center",   width: 130},
    	               {key: "matrNm",      label: "품명",      align: "center",   width: 130},
    	               {key: "adptDt",      label: "적용일자",      align: "center",   width: 130},
    	               {key: "currNm",      label: "통화단위",      align: "center",   width: 130},
    	               {key: "currCd",      label: "통화단위",      align: "center",   width: 130, hidden: true},
    	               {key: "uprDivNm",      label: "단가구분",      align: "center",   width: 130},
    	               {key: "uprDiv",      label: "단가구분",      align: "center",   width: 130, hidden: true},
    	               {key: "matrUpr",      label: "단가",      align: "center",   width: 130},
    	               {key: "deductUpr",      label: "공제단가",      align: "center",   width: 130},
    	               {key: "useYn",      label: "사용여부",      align: "center",   width: 130},
    	               {key: "goodsDiv",      label: "품목구분",	 align: "center",   width: 130},
    	               {key: "matrClntDivNm",      label: "거래처분류",	align: "center",   width: 130},
    	               {key: "matrClntDiv",      label: "거래처분류",	align: "center",   width: 130, hidden: true},
    	               {key: "matrDivNm",      label: "자재유형",      align: "center",   width: 130},
    	               {key: "matrDiv",      label: "자재유형",      align: "center",   width: 130, hidden: true},
    	               {key: "matrGrpNm",      label: "자재그룹",      align: "center",   width: 100},
    	               {key: "matrGrp",      label: "자재그룹",      align: "center",   width: 100, hidden: true},
    	               {key: "matrMat",      label: "소재",      align: "left",   width: 130},
    	               {key: "matrMakrNm",      label: "Maker",      align: "left",   width: 130},
    	               {key: "matrMno",      label: "형번",      align: "left",   width: 200},
    	               {key: "matrSpec",      label: "규격",      align: "left",   width: 100},
    	               {key: "createId",      label: "생성자",   align: "center",   width: 100}, 
    	               {key: "createDttm",      label: "생성일시",      align: "left",   width: 100},
    	               {key: "udpId",      label: "변경자",      align: "right",   width: 100},
    	               {key: "udpDttm",      label: "변경일시",      align: "right",   width: 120},
    	               {key: "matrUprRmk",      label: "특이사항",      align: "center",   width: 130}
    	              ]
    	        });
    	        return this;
    		
    	      },
              setData: function(_pageNo) {
          			//debugger;
            	    var targetObj1 = this.target;
            	    var formData1 = {
            	    		// 조회조건 수정하기
            	               "coCd" : "GUN",  //$("#coCd_S1").val(),
            	               "matrCd" : "200-00001", //$("#coCd_S1").val(),
            	               "clntCd" :  "599", //$("#coCd_S1").val(),
            	               "currCd" :  "CURR01", //$("#coCd_S1").val(),
            	               "pageNo" : _pageNo + 1, 
            	               "recordCnt" : $("#recordCnt").val(),
              
            	           }
            	    // 여기를 바꿔야함 "/user/bm/bm02/selectBmMstrList"
                    postAjax("/user/bm/bm11/selectUprHsMstrList", formData1, null, function(data1){
                        var Hslist = data1.hsresultList;
                        console.log("하단");
                        console.log(Hslist);
                       
    /* 	박부장님 230519  */
//                         bmUprMstrGridView.initView().setData(0);	
//                         bmUprMstrGridView.target.select(0);
//                         var row = bmUprMstrGridView.getList("selected"); // Object
    					targetObj1.setData({
    					    list : Hslist,
    					    page : {
    		                    currentPage : _pageNo,
    		                    pageSize : data1.paginationInfo.pageSize,
    		                    totalElements : data1.paginationInfo.totalRecordCount,
    		                    totalPages : data1.paginationInfo.totalPageCount
    					    } 
    					});		
                    });
            	    // this.target.select(0);

               } 
         }
    
    
    // 그리드 추가, 삭제
    $('[data-grid-control]').click(function () {
        switch (this.getAttribute("data-grid-control")) {
            case "row-add":
            	bmUprMstrGridView.target.addRow($.extend({}, bmUprMstrGridView.target.list.length, {__index: undefined}, { __selected__: true} ));
            	initSearch(1);
                break;
            case "row-remove":
            	bmUprMstrGridView.target.removeRow();
            	
                break;
        }
    });
     
    function initSearch(idx) {   	
    	
        // datepicker를 제외한 select, input 값 모두 초기화
        $(".contents.search select").val("");
        $(".contents.search input[type='text']:not(.input_calendar)").val("");
        
        // 회사 초기화
        $("#coCd").val(jwt.coCd);
        
        // 날짜 초기화
        //$('#adptDt').datepicker("setDate", moment(new Date()).startOf("month").toDate());// 작성일 초기화
    	$('#BmUprHsMstrForm #adptDt').datepicker({
            format : "yyyy-mm-dd",
            language : "ko",
            autoclose : true
    	}).datepicker("setDate", moment().format('YYYY-MM-DD'));        
        
		$.each($('#main_area [data-kind]'), function(idx, elem) {
            // 상세정보 초기화
			$(elem).val("");
        });	

    	if(idx == 1)
  		{
           $("#coCd").val(jwt.coCd);
           $("#currCd").val("CURR01");
           $("#uprDiv").val("UPRDIV01");
           $("#matrUpr").val("0");
           $("#useYn").val("Y");   	
   		}
		
		
		 
	}
    

	// 페이지 로드
	$(document).ready(function() {
		mainDefaultLoad("WBS", "단가마스터관리");
		setCommonSelect($("#main_area select[data-kind]"));
		//debugger;
		// 접속자 회사 set
		//debugger;
		$("#coCd").val(jwt.coCd);
		$("#coCd_S1").val(jwt.coCd);
		
		//$('#adptDt').datepicker("setDate", moment(new Date()).startOf("month").toDate());
		
		/* 		
		 // 시작일 (현재날짜의 월 첫일)
		 $('#wbsPlansDt').datepicker({
		 format : "yyyy-mm-dd",
		 language : "ko",
		 autoclose : true
		 })
		 .datepicker("setDate", moment(new Date()).startOf("month").toDate())
		 .on("changeDate", function(){
		 if($('#wbsPlansDt').val() > $('#wbsPlaneDt').val()){
		 alert("날짜를 확인해주세요");
		 $('#wbsPlansDt').datepicker("setDate", new Date($('#wbsPlaneDt').val()));
		 }
		 });
		
		 // 종료일 (현재날짜의 월 말일)
		 $('#wbsPlaneDt').datepicker({
		 format : "yyyy-mm-dd",
		 language : "ko",
		 autoclose : true
		 })
		 .datepicker("setDate", moment(new Date()).endOf("month").toDate())
		 .on("changeDate", function(){
		 if($('#wbsPlansDt').val() > $('#wbsPlaneDt').val()){
		 alert("날짜를 확인해주세요");
		 $('#wbsPlaneDt').datepicker("setDate", new Date($('#wbsPlansDt').val()));
		 }
		 }); 
		 */
		// 페이지 가져오기
		//debugger;  bmUprHsMstrGridView
		bmUprMstrGridView.initView().setData(0);
		bmUprHsMstrGridView.initView().setData(0);
		bmUprMstrGridView.target.select(0);
		bmUprHsMstrGridView.target.select(0);
		var row = bmUprMstrGridView.target.getList()[0]; // Object
		//var row1 = bmUprHsMstrGridView.target.getList()[0]; // Object
		//var row = bmUprHsMstrGridView.target.getList()[0]; // Object
		//  alert(row);
		excelView.initView();
		//excelView1.initView();
		// 그리드값 가져오기 호출
		getGrid();
		//getGrid();

	})

	/* 	 
	 // 그리드 값 가져오기
	 function getGrid() {
	 var row = grid.target.getList("selected")[0];
	 "goodsDiv" : $("#goodsDiv").val(row.goodsDiv);
	 "matrDiv" : $("#matrDiv").val(row.matrDiv);
	 "matrGrp" : $("#matrGrp").val(row.matrGrp);
	
	 } */

	// 거래처 검색
	function openClntSearch(idx) {
		openModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색",
				{}, function(grid) {
					var row = grid.target.getList("selected")[0];
					
					if (idx == 1){
						$('#clntCd_S').val(row.clntCd);
						$('#clntNm_S').val(row.clntNm);
					}
					else {
						$('#clntCd').val(row.clntCd);
						$('#clntNm').val(row.clntNm);
					}
					
				});
	}
	 
	 
	//품번 (WbsPlanNo) 검색
	function wbsPlanNoSearch(idx) {
		console.log($('#coCd_S1').val(), )
		var paramObj = {
			"coCd" : $('#coCd').val(),
			"salesCd" : $('#salesCd_S').val()
		};
		openSecondModal("/static/html/cmn/modal/wbsPlanNoSearch.html", 450,
				270, "관리번호 검색", paramObj, function(grid) {
					var row = grid.target.getList("selected")[0];
					console.log(row);
					console.log(row.wbsPlanNo);
					if (idx == 1){
						$('#matrCd1').val(row.wbsPlanNo);
					}
					else {
						$('#matrCd').val(row.wbsPlanNo);
					}
				});
	}


	//사용자 검색
	function openUserTree2() {
		var paramObj = {
			"coCd" : "GUN", // $('#coCd').val(),
			"userId" : $('#salesMng_S').val(),
			"useYn" : "Y"
		};
		openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500,
				"사용자 검색", paramObj, function(tree) {
					var checkedId = tree.get_checked()[0];
					var checkedNode = tree.get_node(checkedId);
					$('#salesMngId').val(checkedNode.id);
					$('#salesMngNm').val(checkedNode.text);
					$("#deptNm").val(checkedNode.original.deptNm);
					$("#deptId").val(checkedNode.parent);
				});
	}

	

	//Sales Code (수주마스터, 수주상세테이블 조인) 검색
	function wbsSalesCodeSearch() {
		var paramObj = {
			"coCdNm" : $('#coCd_S').val(),
			"salesCd" : $('#salesCd_S').val()
		};
		openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000,
				330, "SALES CODE 검색", paramObj, function(grid) {
					var row = grid.target.getList("selected")[0];
					$('#salesCd').val(row.salesCd);
					$('#wbsClntPjt').val(row.clntPjt);
					$('#eqp_nm').val(row.eqNm);
				});
	}

	function excelDown() {
		var formData = {
			"coCd" : $("#coCd").val(),
			"pageNo" : 1,
			"recordCnt" : 99999999
		}
		postAjax("/user/wb/wb01/selectWbsPlanList", formData, null, function(
				data) {
			var list = data.resultList;
			excelView.target.setData({
				list : list,
				page : {
					totalElements : list.length,
				}
			});
			var todayDate = new Date().format('yyyyMMddHHmmss');
			excelView.target.exportExcel("자재마스터관리_" + todayDate + ".xls");
		});
	}
	
	
	function insertbmUprMstr() {
		
	/* 	 if ($('#coCd_S').val() == ""){
	        alert("회사를 입력하세요");
	        return;
	    }
	    if ($('#clntCd').val() == ""){
	        alert("구매 업체를 입력하세요");
	        return;
	    }
	    if ($('#matrCd').val() == ""){
	        alert("품번을 입력하세요");
	        return;
	    }
	    if ($('#currCd').val() == ""){
	        alert("통화단위를 입력하세요");
	        return;
	    }
	//	    if ($('#').val() == ""){
	//	        alert("적용 일자를 입력하세요");
	//	        return;
	//	    }
	
	    if ($('#adptDt').val() == ""){
	        alert("단가를 입력하세요");
	        return;
	    } */
	    /* if ($('#useYn').val() == ""){
	        alert("사용 여부를 입력하세요");
	        return;
	    }  */
	    
   
	   
		var FileKey = $('#fileTrgtKey').val();
	    debugger;
	    if(FileKey != null || FileKey != "") {
	    	
	    	var formData = new FormData();
	        $.each($('#BmUprHsMstrForm [data-search]'), function(idx, elem){
	            formData.append($(elem).data("search"), $(elem).val());
	        });
	        filePutAjax("/user/bm/bm11/UpdateBmUprMstr", formData, function(data){
	            if(data.resultCode == 200){
	                alert(data.resultMessage);
	                modalStack.close();
	                bmUprMstrGridView.setData(0); 
	            } 
	        });	  
	        

	    	/* var formUpdateData = {
	    			
	    			"fileTrgtKey" : $("#fileTrgtKey").val(), // Key
	    			"uprDiv" : $("#uprDiv").val(), // 단가구분
	                "matrUpr" : $('#matrUpr').val(), // 단가
	                "deductUpr" : $("#deductUpr").val(), // 공제단가
	                "useYn" : $("#useYn").val(), // 사용여부
	                "matrUprRmk" : $("#matrUprRmk").val(), // 특이사항
	                "udtId" : jwt.userId, // 생성자
	                "udtPgm" : "BM1101M01" // 사용여부
	                
	            }; */
	    	
	    	
	    	  	
	    	
	    
	    } else {
	    	
	    	
	    	 var formData = new FormData($('#BmUprHsMstrForm')[0]);
	         console.log(formData + "폼데이터");
	         $.each($('#BmUprHsMstrForm [data-search]'), function(idx, elem) {
	                formData.append($(elem).data("search"), $(elem).val());
	         });
	
	      	// 생성자
	         formData.append("creatId", jwt.userId);
	         // 생성일시
	         formData.append("creatPgm", "BM1101M01"); 
	
	         
	         filePostAjax("/user/bm/bm11/insertBmUprMstr", formData, null, function(data) {
	                // 상세정보 넣기
	                if (data.resultCode == 200) {
	                       alert(data.resultMessage);
	                       bmUprMstrGridView.setData(0);
	                       //bmMstrGridView.initView().setData();
	                }
	         });	    	
	    	
	    }
	    
	   


       
	    
	}
	
	function makeFormData(fileTreeKey) {
		
		$('#fileTrgtKey_S1').val(fileTreeKey);
		   
	    var formData = new FormData();
	    $.each($('#BmUprHsMstrForm [data-search]'), function(idx, elem){
	        formData.append($(elem).data("search"), $(elem).val());
	    });
	    

	    
	    
	    
	}
	
	
	

	function updateWBSModal(idx) {
		var paramObj = {
			"actionType" : "C",
			"coCd" : $('#coCd_S').val()
		};
		if (idx == 1) {
			openModal("/static/html/user/wb/wb01/WB0101P01.html", 1300, 780,
					"", paramObj);
		} else if (idx == 2) {
			openModal("/static/html/user/wb/wb01/WB0101P02.html", 1300, 780,
					"", paramObj);
		} else if (idx == 3) {
			openModal("/static/html/user/wb/wb01/WB0101P03.html", 1300, 780,
					"", paramObj);
		}
	}


	function deleteWbs() {
		var paramObj = {
			"actionType" : "C",
			"coCd" : $('#coCd_S').val()
		};
		openModal("/static/html/user/wb/wb01/WB0101P08.html", 1300, 780, "",
				paramObj);
		var row = wbsGridView.target.getList("selected")[0];
		var formData = {
			"shipSeq" : row.shipSeq,
			"reqDt" : row.reqDt.replace(/\-/g, '')
		}
		postAjax("/user/ar/ar01/selectConfirmCount", formData, null, function(
				data) {
			if (data.result == 0) {
				if (confirm("삭제하시겠습니까?")) {
					deleteAjax("/user/ar/ar01/deleteShip", formData, null,
							function(data) {
								if (data.resultCode == 200) {
									alert(data.resultMessage);
									shipGridView.setData(0);
								}
							});
				}
			} else {
				alert("삭제할 수 없는 데이터 입니다.");
			}
		});
	}

	function changeRecordCnt() {
		//alert($("#recordCnt").val());
		//wbsGridView.initView();
		bmUprMstrGridView.setData(0);
	}

	// Grid값 가져오기
	function getGrid() {
		// debugger;
		// ready 시 바로 조회되게 바꿔보기 -> 230515 보류 중 
		// bmUprMstrGridView.SelectRow(row, true);
		// var row = bmUprMstrGridView.target.getList(); //전체 행 -> 배열 Object
		// 첫번째 행을 가져온다.
		// var row = bmUprMstrGridView.target.getList()[0]; // Object
		// 선택한 행 가져오기
		var row = bmUprMstrGridView.target.getList("selected")[0]; // Object
		 //console.log(row); // Object
		// console.log(row.__index); // 인덱스
		// console.log(typeof row);
		// row 객체를 배열로 변경
		// let rowArr = Object.keys(row)
		// console.log(Object.keys(row));
		// 배열의 길이		
		// console.log(rowArr.length);
		// console.log(row.length);
		// 값 가져오는 함수 만들기
		
		 //console.log(row.deductUpr);
		if (row != undefined) {
			
			// 구매업체
			$('#fileTrgtKey').val(row.fileTrgtKey);
			// 구매업체
			$('#clntNm').val(row.clntNm);
			// 품번
			$('#matrCd').val(row.matrCd);
			// 품명
			$('#matrNm').val(row.matrNm);
			// 품목구분
			$('#goodsDiv').val(row.goodsDiv);
			// 소재
			$('#matrMat').val(row.matrMat);
			// 거래처분류
			$('#matrClntDiv').val(row.matrClntDiv);
			//$('#matrClntDivNm').val(row.matrClntDivNm);
			// maker
			$('#matrMakrNm').val(row.matrMakrNm);
			// 자재유형
			$('#matrDiv').val(row.matrDiv);
			// 형번
			$('#matrMno').val(row.matrMno);
			// 자재그룹
			$('#matrGrp').val(row.matrGrp);
			// 규격
			$('#matrSpec').val(row.matrSpec);
			// 통화단위
			$('#currCd').val(row.currCd);
			//적용일자
			$('#adptDt').val(row.adptDt);
			// 단가구분
			$('#uprDiv').val(row.uprDiv);
			// 단가
			$('#matrUpr').val(row.matrUpr);
			// 공제단가
			$('#deductUpr').val(row.deductUpr);
			// 사용여부
			$('#useYn').val(row.useYn); 
			// 특이사항
			$('#matrUprRmk').val(row.matrUprRmk); 
		}
	}

	//거래처
	function clntSearch(type) {
		openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420,
				"거래처 검색", {}, function(grid) {
					var row = grid.target.getList("selected")[0];
					if (type == 'LINK') {
						$('#linkGrpClntCd_S').val(row.clntCd);
						$('#linkGrpClntNm_S').val(row.clntNm);

					} else {

						$('#clntCd_S').val(row.clntCd);
						$('#clntNm_S').val(row.clntNm);
					}
				});
	}

	// 행추가 기능
	function gridAddRow() {
		// index
		// + 누르면 행추가
		// 그리드 기준으로 행추가
		// 첫번째 행 -> 객체
		var grid = bmUprMstrGridView.target.getList()[0];
		console.log(grid);
		// 전체행	-> 배열 객체
		var gridList = bmUprMstrGridView.target.list;
		console.log(bmUprMstrGridView.target.list);
		console.log(gridList[0]);
		console.log(gridList[1]);
		console.log(gridList[2]);
		// 그리드 객체 생성 안에서만 사용할 수 있나...?
		// 함수만들어서 쓰면 파라미터로 인덱스 받아와서 쓰는 듯?	
		//.addRow(추가할 내용, 삽인할위치(생략시 마지막),갯수)
		/*  bmUprMstrGridView.target.addRow -> ★target을 넣어야함! */
		// 인덱스 0을 기준으로 행 추가(행 복사됨)
		//  	bmUprMstrGridView.target.addRow($.extend({}, gridList[0], {__index : undefined })); 
		// 		bmUprMstrGridView.addRow($.extend({}, gridList[Math.floor(Math.random() * gridList.length)], {__index : undefined })); 
		//		bmUprMstrGridView.setValue(gridList);
		// 빈 행 추가
		bmUprMstrGridView.target.addRow($.extend({},
				bmUprMstrGridView.target.list.length, {
					__index : undefined
				}));
	}

	// 페이지 로드 시 속성에 값넣기, 값 초기화
	function setBmUprMstr(list) {
		// list -> grid
		var lst = list;
		 console.log(list);
		// console.log(list.length);
		
		if (lst.length !== undefined) {

			// 키
			$('#fileTrgtKey').val(lst[0].fileTrgtKey); 
			// 구매업체
			$('#clntNm').val(lst[0].clntNm);
			// 품번
			$('#matrCd').val(lst[0].matrCd);
			// 품명
			$('#matrNm').val(lst[0].matrNm);
			// 품목구분
			$('#goodsDiv').val(lst[0].goodsDiv);
			// 소재
			$('#matrMat').val(lst[0].matrMat);
			// 거래처분류
			$('#matrClntDiv').val(lst[0].matrClntDiv);
			//$('#matrClntDivNm').val(lst[0].matrClntDivNm);
			// maker
			$('#matrMakrNm').val(lst[0].matrMakrNm);
			// 자재유형
			$('#matrDiv').val(lst[0].matrDiv);
			// 형번
			$('#matrMno').val(lst[0].matrMno);
			// 자재그룹
			$('#matrGrp').val(lst[0].matrGrp);
			// 규격
			$('#matrSpec').val(lst[0].matrSpec);
			// 통화단위
			$('#currCd').val(lst[0].currCd);
			//적용일자
			$('#adptDt').val(lst[0].adptDt);
			// 단가구분
			$('#uprDiv').val(lst[0].uprDiv);
			// 단가
			$('#matrUpr').val(lst[0].matrUpr);
			// 공제단가
			$('#deductUpr').val(lst[0].deductUpr);
			// 사용여부
			$('#useYn').val(lst[0].useYn);
			// 특이사항
			$('#matrUprRmk').val(lst[0].matrUprRmk); 
			

		}
		
		/* $.each($('.contents tbody td'), function(index, item) {
            // 상세정보 초기화
			$('.contents select').val("");
			$('.contents input[type="text"]').val("");
        }); */
	}
</script>
