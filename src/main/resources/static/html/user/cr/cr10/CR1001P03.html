<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">물류진행요청</h4>
    </div>
 <div class="popup_table" id="appViewArea">
 </div>
 <div class="form-group popup_table">
  <form id="popForm" onSubmit="return false;">
		<input type="hidden" id="userId" name="userId">
		<input type="hidden" id="pgmId" name="pgmId" value="CR1001P03">
		<input type="hidden" id="fileTrgtKey" name="fileTrgtKey">
 		<table>
        <colgroup>
          <col width="12%">
          <col width="13%">
          <col width="12%">
          <col width="13%">
          <col width="12%">
          <col width="13%">
          <col width="12%">
          <col width="13%">
        </colgroup>

        <tr>
			<th>회사</th>
			<td>
				<input type="hidden" id="coCd" name="coCd">
				<input type="text" id="coNm" name="coNm">
			</td>
			<th>수주번호</th>
			<td>
				<input type="text" id="ordrsNo" name="ordrsNo">
			</td>
			<th>고객사</th>
			<td>
				<input type="text" id="ordrsClntNm" name="ordrsClntNm">
			</td>
			<th>고객사PJT</th>
			<td>
				<input type="hidden" id="clntPjt" name="clntPjt">
				<input type="text" id="clntPjtNm" name="clntPjtNm">
			</td>
        </tr>

        <tr>
			<th>요청자</th>
			<td>
	             <input type="text" id="reqIdNm" name="reqIdNm">
			</td>
			<th>PART NO</th>
			<td>
				<input type="text" id="partNo" name="partNo">
			</td>
			<th>발행일자</th>
			<td>
				<input id="pblicteDt" name="pblicteDt" date>
			</td>
			<th>요구일정일자</th>
			<td>
				<input id="reqFxDt" name="reqFxDt" date>
			</td>
        </tr>

        <tr>
			<th>분류구분</th>
			<td>
				<input type="text" id="clasDivNm" name="clasDivNm">
			</td>
			<th>물류번호</th>
			<td colspan="5">
				<input type="text" id="lgistNo" name="lgistNo">
			</td>
        </tr>

        <tr>
			<th>Sales Code</th>
			<td colspan="7" valign="top">
				<div style="width: 100%; height: 240px;margin-left:5px;" id="salescd-grid-height">
					<div class="add_btn pdl10" style="width: 100%;">
					</div>
	                <div data-ax5grid="salescd-grid" data-ax5grid-config="{}" style="height:230px; width: 99%;">
	                </div>
				</div>
			</td>
        </tr>

        <tr>
			<th>운송구분</th>
			<td>
				<input type="text" id="trnsDivNm" name="trnsDivNm">
			</td>
			<th>운송지역</th>
			<td>
				<input type="text" id="trnsAreaDivNm" name="trnsAreaDivNm">
			</td>
			<th>발송조건</th>
			<td>
				<input type="text" id="sendCndDivNm" name="sendCndDivNm">
			</td>
			<th>포장종류</th>
			<td>
				<input type="text" id="packKindDivNm" name="packKindDivNm">
			</td>
        </tr>

        <tr>
			<th colspan="4" style="text-align:center;height:30px">출발지 정보</th>
			<th colspan="4" style="text-align:center;height:30px">도착지 정보</th>
        </tr>
        <tr>
			<th>업체명</th>
			<td colspan="3">
				<input type="text" id="staPlace" name="staPlace">
			</td>
			<th>업체명</th>
			<td colspan="3">
				<input type="text" id="arvlPlace" name="arvlPlace">
			</td>
        </tr>
        <tr>
			<th>담당자/연락처</th>
			<td colspan="3">
<!--                  <input type="text" id="staChrgIdNm" name="staChrgIdNm" style="width:50px;float:left;"> -->
<!-- 	             <span style="width:30px;float:left;margin-top:3px;">/</span> -->
<!-- 	             <input type="text" id="staChrgIdTelNo" name="staChrgIdTelNo" style="width:100px;float:left;" readonly="readonly"> -->
	             <input data-maxlength="300" type="text" id="staChrgCont" name="staChrgCont" msg="담당자/연락처" class="form-control">
			</td>
			<th>담당자/연락처</th>
			<td colspan="3">
	             <input type="text" id="arvlChrgCont" name="arvlChrgCont">
			</td>
        </tr>
        <tr>
			<th>주소</th>
			<td colspan="3">
				<textarea rows="2" id="staAddr" name="staAddr"></textarea>
			</td>
			<th>주소</th>
			<td colspan="3">
	             <textarea rows="2" id="arvlAddr" name="arvlAddr"></textarea>
			</td>
        </tr>
        <tr>
			<th>품목내용</th>
			<td colspan="7">
				<textarea rows="2" id="prdlstCont" name="prdlstCont"></textarea>
			</td>
        </tr>
        <tr>
			<th>제품금액</th>
			<td>
				<input data-money type="text" id="prdAmt" name="prdAmt">
			</td>
			<th>가로사이즈</th>
			<td>
				<input data-positive comma type="text" id="widthSize" name="widthSize" maxlength="10" msg="가로사이즈"
				 style="float:left;width:80%;"><span style="float:right;width:20%;margin-top:3px;">mm</span>
			</td>
			<th>세로사이즈</th>
			<td>
				<input data-positive comma type="text" id="vrticlSize" name="vrticlSize" maxlength="10" msg="세로사이즈"
				 style="float:left;width:80%;"><span style="float:right;width:20%;margin-top:3px;">mm</span>
			</td>
			<th>높이사이즈</th>
			<td>
				<input data-positive comma type="text" id="heightSize" name="heightSize" maxlength="10" msg="높이사이즈"
				 style="float:left;width:80%;"><span style="float:right;width:20%;margin-top:3px;">mm</span>
			</td>
        </tr>
        <tr>
			<th>포장전무게</th>
			<td>
				<input data-positive comma type="text" id="frmlcBeforeWt" name="frmlcBeforeWt" msg="포장전무게"
				style="float:left;width:80%;"><span style="float:right;width:20%;margin-top:3px;">kg</span>
			</td>
			<th>포장후무게</th>
			<td>
				<input data-positive comma type="text" id="frmlcAfterWt" name="frmlcAfterWt" msg="포장후무게"
				style="float:left;width:80%;"><span style="float:right;width:20%;margin-top:3px;">kg</span>
			</td>
			<th>출하계획일</th>
			<td>
				<input id="shipmntDt" name="shipmntDt" msg="출하계획일" date>
			</td>
			<th>희망도착일</th>
			<td>
				<input id="hopeArvlDt" name="hopeArvlDt" msg="희망도착일" date>
			</td>
        </tr>

        <tr>
			<th>비고</th>
			<td colspan="7">
				<textarea rows="3" id="lgistRmk" name="lgistRmk" msg="비고"></textarea>
			</td>
        </tr>

      </table>
	<table style="border: 0px;">
		<tr style="height: 30px;">
			<td style="text-align: LEFT; border-right: 0px;; font-size: 13px; font-weight: bold;">※ 공유 및 결재</td>
		</tr>
		<tr>
			<td colspan="2">
				<div>
					<div class="ax5_grid" data-ax5grid="first-grid-modal" data-ax5grid-config="{}" style="height: 150px; width: 100%;"></div>
				</div>
			</td>
		</tr>
	</table>
    </form>
	</div>

	<div style="height:15px" class="fileList_height">
	</div>
	<!-- 공통 파일 영역-->
	<div id="fileList_area" style="margin-bottom: 50px;"></div>
	 

</div>
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>
<script type="text/javascript">
	var fileTrgtKey = null;
	var ordrsNo = null;

	var salescdGridView = {
			initView: function(){
				this.target = new ax5.ui.grid();
				this.target.setConfig({
			        showLineNumber: true,
					showRowSelector : false,
					multipleSelect : false,
					sortable : false,
		            target: $('[data-ax5grid="salescd-grid"]'),
		            header : {
		                align : "center",
		                selector : true
		            },
			        body: {
			        	  //mergeCells : ["coCd","salesCd", "dsgnNo", "upperCd","lowerCd","ordrgDiv10"],
			              onClick: function () {
				          },
				          onDBLClick: function () {
				          },
				          onDataChanged: function () {
				          },
			        },
			        columns : [
						{key: "dtaChk",				label: " ", 			width: 30, 	styleClass: "grid-font-blue-bold" ,hidden:true},
			 	 	 	{key: "coCd", 				label: "CO", 			width: 50,	align: "center",hidden:true},
			 	 	 	{key: "ordrsNo", 			label: "ORDRS_NO", 		width: 50,	align: "center",hidden:true},
			 	 	 	{key: "ordrsSeq", 			label: "ORDRS_SEQ", 	width: 50,	align: "center",hidden:true},
						{key: "chkYn",         		label: "chk", 			width: 50 , align: "center", sortable: false  ,hidden:true
							,editor: {
								type   : "checkbox", config : { trueValue: "Y", falseValue: "N" }
							}
						},
						{key: "salesCd", 			label: "Sales Code", 	width: 120,		align: "center"},
						{key: "eqpNm", 				label: "설비명", 		width: 300,		align: "left"},
						{key: "mctypeNm", 			label: "기계구분", 		width: 70,		align: "center"},
						{key: "ordrsDtlDiv20Nm", 	label: "신작구분", 		width: 70,		align: "center"},
						{key: "ordrsDtlDiv30Nm", 	label: "자체구분", 		width: 70,		align: "center"},
						{key: "useYn", 				label: "출하유무", 		width: 60,		align: "center", formatter: "chkYn"},
						{key: "dudtIntendDt", 		label: "납기예정일", 	width: 80,		align: "center"},
						{key: "ordrsQty", 			label: "수주대수", 		width: 60,		align: "center", formatter: "money"},
						{key: "lgistQty", 			label: "물류요청대수", 	width: 80,		align: "center", editor: {type: "number"}, formatter: "money"},
						{key: "lgistRemark", 		label: "비고", 			width: 260,		align: "left", editor: {type: "textarea"}},
//							{key: "prdtCd", 			label: "제품구분", 		width: 90,		align: "center"},
//							{key: "prdtCdNm", 			label: "제품명", 		width: 180,		align: "left"},
//							{key: "itemDivNm", 			label: "아이템구분", 	width: 130,		align: "left"},
		         	]
			    });
				return this;
			},

			setData: function(_page){
				var target = this.target;
				var formData = {
						"coCd" 		 : $("#coCd").val(),
						"ordrsNo" 	 : ordrsNo,
						"fileTrgtKey": fileTrgtKey,
					}
				
	    		postAjax("/user/cr/cr10/selectSelesCdList", formData, null, function(data) {
					var list = data.resultList;
					target.setData({
	            		list : list,
	            		page : {
	            			totalElements : list.length
	            		}
	       			});

					if(list.length > 2) {
						var gridHeight = 66+(list.length * 26);
						salescdGridView.target.setHeight(gridHeight);
						//width: 100%; height: 240px;margin-left:5px;
						var _height = (gridHeight+20)+"px";
						$("#salescd-grid-height").css({"width":"100%", "height": _height, "margin-left": "5px"});
					}
					else {
						salescdGridView.target.setHeight(150);
						$("#salescd-grid-height").css({"width":"100%", "height": 170, "margin-left": "5px"});
					}
	    	 	});
			}
		};
	
	var gridViewPop2 = {
	        initView : function() {
	            this.target = new ax5.ui.grid();
	            this.target.setConfig({
	                showRowSelector: true,
	                multipleSelect: false,
	                sortable: false,
	                target: $('[data-ax5grid="first-grid-modal"]'),
	                header: {
	                    align: "center",
	                    selector: true
	                },
	                body: {
	                     onClick: function () {
	                        this.self.select(this.dindex);
	                    },
	                    onDBLClick: function () {
	                    },
	                    mergeCells : ["gb"],
	                },
	                page : {
	                    navigationItemCount : 10,
	                    height : 30,
	                    display : true,
	                    firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
	                    prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
	                    nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
	                    lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
	                    onChange : function() {
	                        gridView.setData(this.page.selectPage);
	                    }
	                },
	                columns : [
	                        {key: "gb",                 label: "구분",        align: "center",   width: 40},
	                        {key: "wbsPlancoCdNm",      label: "회사명",      align: "center",   width: 130, hidden: true},
	                        //{key: "wbsSharngUserId",  label: "ID",        align: "center",   width: 130, hidden: false},
	                        {key: "usrNm",              label: "ID",        align: "center",   width: 130, hidden: true},
	                        {key: "empNo",              label: "사원번호",  align: "center",   width: 130, hidden: true},
	                        {key: "name",               label: "성명",        align: "center",   width: 80},
	                        {key: "jik",                label: "직위",        align: "center",   width: 60},
	                        {key: "reqDate",            label: "요청일자",  align: "center",   width: 90},
	                        {key: "todoCfDt",           label: "확인일자",      align: "center",   width: 130},
	                        {key: "todoCfOpn",          label: "확인의견",  align: "left",     width: 200},
	                        {key: "telNo",              label: "H.P",       align: "center",   width: 130},
	                        {key: "sanctnSttus",        label: "sanctnSttus",  align: "center",   width: 130, hidden: true},
	                      ]
	                    });
	                    return this;
	                },

	                setData : function(_pageNo) {
	                	
	                    var targetObj = this.target;
	                    var formData = {
	                            "fileTrgtKey" : fileTrgtKey,
	                            "reqNo" :  lgistNo, 
	                            "flag" :  "Y3",
	                            "pageNo" : _pageNo + 1
	                    }
	                    postAjaxSync("/user/qm/qm01/selectShareUserlst", formData, null, function(data){
// 	                    	console.log("selectShareUserlst");
	                        if (data.result.length > 0) {
	                            var list = data.result;
	                            targetObj.setData({
	                                list : list,
	                                page : {
	                                      totalElements :  data.paginationInfo.totalRecordCount,
	                                } 
	                            });                            
	                        }
	                    });
	                },
	                setData2 : function(_list) {
	                    this.target.setData({
	                            list : _list,
	                            page : {
	                                        totalElements :  _list.length,
	                            } 
	                        });
	                }

	    };


	$(document).ready(function() {
		setComboOptions($(".popup_area select[data-kind]"));
		
		$('#coCd').val(modalStack.last().paramObj.coCd);
		fileTrgtKey = modalStack.last().paramObj.fileTrgtKey;
		// 회사구분 변경에 따른 적용
		$('#coCd').on('change', function () {
			//---------------------------------------------------------------
			//첨부 화일 처리 시작
			//---------------------------------------------------------------
			$('#fileList_area').empty();
			fileParam = {
					fileTrgtTyp	: $("#popForm #pgmId").val(),
					fileTrgtKey	:fileTrgtKey
			}
	  		treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
			//---------------------------------------------------------------
			//첨부 화일 처리 끝
			//---------------------------------------------------------------
// 			$(".fileList_height").hide();//없으면 버튼 안나옴.
		});
		
		/**
		 * grid 초기화
		*/
		salescdGridView.initView();
		selectLgistMastInfo();
		
	});

	function selectLgistMastInfo() {						//그리드에 뿌리는 데이터
		var formData = {
			"fileTrgtKey" : fileTrgtKey,
		}
		postAjax("/user/cr/cr10/selectLgistMastInfo", formData, null, function(data) {
// 			console.log("selectLgistMastInfo");
			loadFormData("#popForm", data.result, function(data){
				setDisabledInput("#popForm" , true);
			});

			fileTrgtKey = data.result.fileTrgtKey;
			ordrsNo = data.result.ordrsNo;
			lgistNo = data.result.lgistNo;
			
			gridViewPop2.initView().setData(0);
			$('#coCd').trigger('change'); //파일트리 새로 그리기
		});
	}

</script>