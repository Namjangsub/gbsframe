<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">물류진행요청 등록</h4>
    </div>

 <div class="form-group popup_table">
  <form id="popForm" onSubmit="return false;">
		<input type="hidden" id="userId" name="userId">
		<input type="hidden" id="pgmId" name="pgmId" value="CR1001M01">
		<input type="hidden" id="fileTrgtKey" name="fileTrgtKey">
		<input type="hidden" id="ordrsClntCd" name="ordrsClntCd">
	  	<input type="hidden" id="todoDiv1CodeId" name="todoDiv1CodeId">
	  	<input type="hidden" id="todoDiv2CodeId" name="todoDiv2CodeId">
 		<table>

        <colgroup>
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
        </colgroup>

        <tr>
			<th class="hit">회사</th>
			<td>
				<select id="coCd" name="coCd" data-kind="CO" required msg="회사" class="form-control" readonly="readonly" required>
				</select>
			</td>
			<th class="hit">수주번호</th>
			<td>
				<input type="text" id="ordrsNo" name="ordrsNo" msg="수주번호" class="form-control" readonly="readonly" required>
			</td>
			<th class="hit">고객사</th>
			<td>
				<input type="text" id="ordrsClntNm" name="ordrsClntNm" msg="고객사" class="form-control" readonly="readonly" required>
			</td>
			<th class="hit">고객사PJT</th>
			<td>
				<input type="text" id="clntPjt" name="clntPjt" msg="고객사PJT" class="form-control" readonly="readonly" required>
			</td>
        </tr>

        <tr>
			<th class="hit">요청자</th>
			<td>
	             <input type="hidden" id="reqId" name="reqId" msg="요청자">
	             <div class="search_form">
	                 <input type="text" id="reqIdNm" name="reqIdNm" msg="요청자" class="form-control" required>
	                 <a onclick="openUserTree('reqId');">
	                 <i class="i_search_w"></i></a>
	              </div>
			</td>
			<th>PART NO</th>
			<td>
				<input data-positive comma type="text" id="partNo" name="partNo" msg="PART NO">
			</td>
			<th class="hit">발행일자</th>
			<td>
				<input id="pblicteDt" name="pblicteDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" required msg="발행일자" date="today">
			</td>
			<th class="hit">요구일정일자</th>
			<td>
				<input id="reqFxDt" name="reqFxDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" required msg="요구일정일자" date="today">
			</td>
        </tr>
        <tr>
			<th class="hit">분류구분</th>
			<td>
				<select id="clasDiv" name="clasDiv" onchange="salescdGridView.setData(0);" data-kind="LGISTDIV01" msg="분류구분" class="form-control" required>
				   <option value="">선택</option>
				</select>
			</td>
			<th>물류번호</th>
			<td>
				<input type="text" id="lgistNo" name="lgistNo" msg="물류번호" class="form-control" readonly="readonly">
			</td>
 			<td colspan="4">
 				<div style="float:left;margin-top:5px;">
 				</div>
				<div class="add_btn pdl10" style="float:right">
				    <a onclick="initSalesCode();" style="width: 60px;">초기화</a>
				</div>
 			</td>
        </tr>

        <tr>
			<th>Sales Code 선택</th>
			<td colspan="7" valign="top">
				<div style="width: 100%; height:300px;margin-left:5px;margin-top:7px;">
	                <div data-ax5grid="salescd-grid" data-ax5grid-config="{}" style="height:290px; width: 99%;">
	                </div>
				</div>
			</td>
        </tr>

        <tr>
			<th class="hit">운송구분</th>
			<td>
				<select id="trnsDiv" name="trnsDiv" data-kind="LGISTDIV03" onchange="changeTrnsDiv(this.value)" msg="운송구분" class="form-control" required>
				   <option value="">선택</option>
				</select>
			</td>
 			<th colspan="6"></th>
        </tr>

        <tr id="dmsTran">
			<th class="dmsClass">국내운송지역</th>
			<td>
				<select id="dmsTrnsAreaDiv" name="dmsTrnsAreaDiv" data-kind="LGISTDIV0201" msg="국내운송지역" class="form-control">
				   <option value="">선택</option>
				</select>
			</td>
			<th class="dmsClass">국내발송조건</th>
			<td>
				<select id="dmsSendCndDiv" name="dmsSendCndDiv" data-kind="LGISTDIV0202" onchange="changeSetEtc(this.value,this.name)" msg="국내발송조건">
				   <option value="">선택</option>
				</select>
			</td>
			<td colspan="2">
				<input data-maxlength="300" type="text" id="dmsSendCndDivEtc" name="dmsSendCndDivEtc" msg="국내발송조건 -기타" readonly="readonly">
			</td>
			<th class="dmsClass">국내포장종류</th>
			<td>
				<select id="dmsPackKindDiv" name="dmsPackKindDiv" data-kind="LGISTDIV0203" msg="국내포장종류" class="form-control">
				   <option value="">선택</option>
				</select>
			</td>
        </tr>

        <tr id="ovsTran">
			<th class="ovsClass">해외운송지역</th>
			<td>
				<select id="ovsTrnsAreaDiv" name="ovsTrnsAreaDiv" data-kind="LGISTDIV0204" msg="해외운송지역" class="form-control">
				   <option value="">선택</option>
				</select>
			</td>
			<th class="ovsClass">해외발송조건</th>
			<td>
				<select id="ovsSendCndDiv" name="ovsSendCndDiv" data-kind="LGISTDIV0205" onchange="changeSetEtc(this.value,this.name)" msg="해외발송조건">
				   <option value="">선택</option>
				</select>
			</td>
			<td colspan="2">
				<input data-maxlength="300" type="text" id="ovsSendCndDivEtc" name="ovsSendCndDivEtc" msg="해외발송조건 -기타" readonly="readonly">
			</td>
			<th class="ovsClass">해외포장종류</th>
			<td>
				<select id="ovsPackKindDiv" name="ovsPackKindDiv" data-kind="LGISTDIV0206" msg="해외포장종류" class="form-control">
				   <option value="">선택</option>
				</select>
			</td>
        </tr>

        <tr>
			<th colspan="4" style="text-align:center;height:30px">출발지 정보</th>
			<th colspan="4" style="text-align:center;height:30px">도착지 정보</th>
        </tr>
        <tr>
			<th>업체명</th>
			<td colspan="3">
				<input data-maxlength="300" type="text" id="staPlace" name="staPlace" msg="업체명" class="form-control">
			</td>
			<th>업체명</th>
			<td colspan="3">
				<input data-maxlength="300" type="text" id="arvlPlace" name="arvlPlace" msg="업체명" class="form-control">
			</td>
        </tr>
        <tr>
			<th>담당자/연락처</th>
			<td colspan="3">
	             <input type="hidden" id="staChrgId" name="staChrgId" msg="담당자/연락처">
	             <div class="search_form" style="width:150px;float:left;">
	                 <input type="text" id="staChrgIdNm" name="staChrgIdNm" class="form-control" msg="담당자/연락처">
	                 <a onclick="openUserTree('staChrgId');"><i class="i_search_w"></i></a>
	              </div>
	              <span style="width:30px;float:left;margin-top:3px;">/</span>
	              <input type="text" id="staChrgIdTelNo" name="staChrgIdTelNo" msg="담당자-전화번호" class="form-control" style="width:100px;float:left;" readonly="readonly">
			</td>
			<th>담당자/연락처</th>
			<td colspan="3">
	             <input data-maxlength="300" type="text" id="arvlChrgCont" name="arvlChrgCont" msg="담당자/연락처" class="form-control">
			</td>
        </tr>
        <tr>
			<th>주소</th>
			<td colspan="3">
				<textarea data-maxlength="300" rows="2" id="staAddr" name="staAddr" class="form-control" msg="주소"></textarea>
			</td>
			<th>주소</th>
			<td colspan="3">
	             <textarea data-maxlength="300" rows="2" id="arvlAddr" name="arvlAddr" class="form-control"  msg="주소"></textarea>
			</td>
        </tr>
        <tr>
			<th>품목내용</th>
			<td colspan="7">
				<textarea data-maxlength="300" rows="2" id="prdlstCont" name="prdlstCont" class="form-control"  msg="비고"></textarea>
			</td>
        </tr>
        <tr>
			<th>제품금액</th>
			<td>
				<input data-money type="text" id="prdAmt" name="prdAmt" maxlength="16" class="form-control" msg="제품금액">
			</td>
			<th>가로사이즈</th>
			<td>
				<input data-positive comma type="text" id="widthSize" name="widthSize" maxlength="10" class="form-control" msg="가로사이즈"
				 style="float:left;width:80%;"><span style="float:right;width:20%;margin-top:3px;">mm</span>
			</td>
			<th>세로사이즈</th>
			<td>
				<input data-positive comma type="text" id="vrticlSize" name="vrticlSize" maxlength="10" class="form-control" msg="세로사이즈"
				 style="float:left;width:80%;"><span style="float:right;width:20%;margin-top:3px;">mm</span>
			</td>
			<th>높이사이즈</th>
			<td>
				<input data-positive comma type="text" id="heightSize" name="heightSize" maxlength="10" class="form-control" msg="높이사이즈"
				 style="float:left;width:80%;"><span style="float:right;width:20%;margin-top:3px;">mm</span>
			</td>
        </tr>
        <tr>
			<th>포장전무게</th>
			<td>
				<input data-positive comma type="text" id="frmlcBeforeWt" name="frmlcBeforeWt" maxlength="10" class="form-control" msg="포장전무게"
				style="float:left;width:80%;"><span style="float:right;width:20%;margin-top:3px;">kg</span>
			</td>
			<th>포장후무게</th>
			<td>
				<input data-positive comma type="text" id="frmlcAfterWt" name="frmlcAfterWt" maxlength="10" class="form-control" msg="포장후무게"
				style="float:left;width:80%;"><span style="float:right;width:20%;margin-top:3px;">kg</span>
			</td>
			<th>출하일정일</th>
			<td>
				<input id="shipmntDt" name="shipmntDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" msg="출하일정일" date>
			</td>
			<th>희망도착일</th>
			<td>
				<input id="hopeArvlDt" name="hopeArvlDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" msg="희망도착일" date>
			</td>
        </tr>

        <tr>
			<th>비고</th>
			<td colspan="7">
				<textarea data-maxlength="500" rows="3" id="lgistRmk" name="lgistRmk" class="form-control"  msg="비고"></textarea>
			</td>
        </tr>

      </table>

    </form>
	</div>

	<div style="height:200px" class="fileList_height">
	</div>
	<!-- 공통 파일 영역 -->
	<div id="fileList_area"></div>

</div>
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtn" authChk>등록</button>
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>

<script type="text/javascript">
	var actionType = null;
	var fileTrgtKey = null;

	var appStatus = "APP0";// 결재상태
	var grid_onDataChanged = true;
	let appList = {};

	var salescdGridView = {
			initView: function(){
				this.target = new ax5.ui.grid();
				this.target.setConfig({
			        showLineNumber: false,
					showRowSelector : true,
					multipleSelect : true,
					sortable : false,
		            target: $('[data-ax5grid="salescd-grid"]'),
		            header : {
		                align : "center",
		                selector : true
		            },
			        body: {
			        	  //mergeCells : ["coCd","salesCd", "dsgnNo", "upperCd","lowerCd","ordrgDiv10"],
			              onClick: function () {
			            	  if(appStatus == "APP0"){
	  			              	this.self.select(this.dindex);
	  			              	//useYn: 현재물류의 선택유무  , oldUseYn: 데이타사용유무
	  			              	grid_onDataChanged = false;
	  			              	if(this.item.chkYn == "Y" || this.item.oldUseYn == "N") {
		  			              	if(this.item.useYn == "N") {
		  			              		salescdGridView.target.setValue(this.dindex, "useYn", "Y");
		  			              	}
		  			              	else if(this.item.anoUseYn == "N") {
		  			              		salescdGridView.target.setValue(this.dindex, "useYn", "N");
		  			              	}
	  			              	}
	  			              	grid_onDataChanged = true;
			            	  }
				          },
				          onDBLClick: function () {
				          },
				          onDataChanged: function () {
				        	  if(grid_onDataChanged == false) return;
			            	  if(appStatus == "APP0"){
				        	  	  grid_onDataChanged = false;
			            		  if(this.item.chkYn == "Y" || this.item.oldUseYn == "N") {
			  			              	if(this.item.useYn == "N") {
			  			              		salescdGridView.target.setValue(this.dindex, "useYn", "Y");
			  			              	}
			  			              	else if(this.item.anoUseYn == "N") {
			  			              		salescdGridView.target.setValue(this.dindex, "useYn", "N");
			  			              	}
			            		  }
				        	  	  grid_onDataChanged = true;
				              }
				          },
			        },
			        columns : [
							{key: "dtaChk",			label: " ", 			width: 30, 	styleClass: "grid-font-blue-bold" ,hidden:true},
				 	 	 	{key: "coCd", 			label: "CO", 			width: 50,	align: "center",hidden:true},
							{key: "chkYn",         	label: "chk", 			width: 50 , align: "center", sortable: false  ,hidden:true
								,editor: {
									type   : "checkbox", config : { trueValue: "Y", falseValue: "N" }
								}
							},
							{key: "salesCd", 			label: "Sales Code", 	width: 120,		align: "center"},
							{key: "prdtCd", 			label: "제품구분", 		width: 90,		align: "center"},
							{key: "ordrsDtlDiv20Nm", 	label: "신작구분", 		width: 90,		align: "center"},
							{key: "ordrsDtlDiv30Nm", 	label: "자체구분", 		width: 90,		align: "center"},
							{key: "useYn", 				label: "사용유무", 		width: 60,		align: "center", formatter: "chkYn"},
							{key: "dudtIntendDt", 		label: "납기예정일", 		width: 80,		align: "center"},
							{key: "prdtCdNm", 			label: "제품명", 			width: 180,		align: "left"},
							{key: "itemDivNm", 			label: "아이템구분", 		width: 130,		align: "left"},
							{key: "eqpNm", 				label: "설비명", 			width: 320,		align: "left"},
			         	]
			    });
				return this;
			},

			setData: function(_page){
				var target = this.target;
				/*
				var formData = {
					"coCd" 		 : $("#coCd").val(),
					"ordrsNo" 	 : $("#ordrsNo").val(),
					"fileTrgtKey": $("#fileTrgtKey").val(),
				}
				*/

				var formData = getSearchParam("#popForm");
	    		postAjax("/user/cr/cr10/selectSelesCdList", formData, null, function(data) {
					var list = data.resultList;
					target.setData({
	            		list : list,
	            		page : {
	            			totalElements : list.length
	            		}
	       			});
					$.each($.extend({}, list), function (idx, elem) {
						if(elem.chkYn == "Y" && elem.useYn == "Y") {
							var select_idx = Number(idx);
							salescdGridView.target.select(select_idx);
						}
					});
	    	 	});
			}
		}

	function gridAllCheck(){
		if(appStatus != "APP0"){return;}
		var header_col0_check_box = $('[data-ax5grid="salescd-grid"] [data-ax5grid-container="header"] table tr td[data-ax5grid-column-attr="rowSelector"][data-ax5grid-column-row="0"][data-ax5grid-column-col="0"][data-ax5grid-column-key="__checkbox_header__"]');
		var is_selected = header_col0_check_box.attr("data-ax5grid-selected");
		var grid_all_check = true;
		if(is_selected == "true"){
			grid_all_check = false;
		}

		if(grid_all_check) {
			grid_onDataChanged = false;
			$.each($.extend({}, salescdGridView.target.list), function (idx, elem) {
				if(elem.useYn == "N"||elem.anoUseYn == "N") {
					salescdGridView.target.setValue(Number(idx), "useYn", "Y");
				}
			});
			grid_onDataChanged = true;
		} else {
			salescdGridView.setData(0);
		}

	}

	$(document).ready(function() {
		setCommonSelect($(".popup_area select[data-kind]"));
		setByCoCd(modalStack.last().paramObj.coCd);
		$("#popForm #userId").val(jwt.userId);

		authChk();						// 권한체크

		actionType = modalStack.last().paramObj.actionType;
		fileTrgtKey = modalStack.last().paramObj.fileTrgtKey;

		//loadFormData("#popForm", modalStack.last().paramObj);

		if (actionType == "C") {
			$("#staPlace").val(modalStack.last().paramObj.staPlace);
			$("#arvlPlace").val(modalStack.last().paramObj.ordrsClntNm);
			$("#staAddr").val(modalStack.last().paramObj.coAddr);
			$("#arvlAddr").val(modalStack.last().paramObj.clntAddr);

			$("#actionBtn").text("등록");
			$('#actionBtn').on("click", function() {
				insertLgistMast();
			});

			$('#trnsDiv').trigger('change');

			//initLoadForm("#popForm");
			//initLoadForm(".popup_area");//input,select,textarea 기능활성화

			let loadData = {
					"fileTrgtKey" : modalStack.last().paramObj.fileTrgtKey,
					"coCd" : modalStack.last().paramObj.coCd,
					"ordrsNo" : modalStack.last().paramObj.ordrsNo,
					"clntPjt" : modalStack.last().paramObj.clntPjt,
					"reqId" : modalStack.last().paramObj.reqId,
					"reqIdNm" : modalStack.last().paramObj.reqIdNm,
					"ordrsClntNm" : modalStack.last().paramObj.ordrsClntNm,
					"ordrsClntCd" : modalStack.last().paramObj.ordrsClntCd,
					"clasDiv" : "LGISTDIV0101", //출고를 기본으로 한다. 출고(LGISTDIV0101),입고(LGISTDIV0102)
			};
			loadFormData("#popForm", loadData , function(){
				/**
				 * grid 초기화
				*/
				salescdGridView.initView().setData(0);
			});
		} else if (actionType == "U") {
			if(isEmpty($("#staAddr").val())) $("#staAddr").val(modalStack.last().paramObj.coAddr);
			if(isEmpty($("#arvlAddr").val())) $("#arvlAddr").val(modalStack.last().paramObj.clntAddr);

			$('.tit').text('물류진행요청 수정');

			selectLgistMastInfo();

			$('#actionBtn').text("수정");
			$('#actionBtn').on("click", function() {
				updateLgistMast();
			});

			salescdGridView.initView();
		}

		var header_col0_check_box = $('[data-ax5grid="salescd-grid"] [data-ax5grid-container="header"] table tr td[data-ax5grid-column-attr="rowSelector"][data-ax5grid-column-row="0"][data-ax5grid-column-col="0"][data-ax5grid-column-key="__checkbox_header__"]');
		header_col0_check_box.on("click", function() {
			gridAllCheck();
		});
		//---------------------------------------------------------------
		//첨부 화일 처리 시작
		//---------------------------------------------------------------
		fileParam = {
				fileTrgtTyp	: $("#pgmId").val(),
				fileTrgtKey		:fileTrgtKey
		}
  		treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
		//---------------------------------------------------------------
		//첨부 화일 처리 끝
		//---------------------------------------------------------------
		$(".fileList_height").hide();//없으면 버튼 안나옴.
	});

	function changeTrnsDivSetValue(){
		var trnsDiv_value = $("#trnsDiv").val();
		if(trnsDiv_value == "LGISTDIV0301"){
			$("select[name=ovsTrnsAreaDiv]").val("");
			$("select[name=ovsSendCndDiv]").val("");
			$("input[name=ovsSendCndDivEtc]").val("");
			$("select[name=ovsPackKindDiv]").val("");
		}
		else {
			$("select[name=dmsTrnsAreaDiv]").val("");
			$("select[name=dmsSendCndDiv]").val("");
			$("input[name=dmsSendCndDivEtc]").val("");
			$("select[name=dmsPackKindDiv]").val("");
		}
	}

	//운송구분이 바뀔때 값셋팅
	function changeTrnsDiv(_value) {
		if(_value == "LGISTDIV0301") { //국내
			$('#dmsTran').show();
			$('#ovsTran').hide();

			$(".dmsClass").addClass('hit');
			$("select[name=dmsTrnsAreaDiv]").attr('required', 'required');
			$("select[name=dmsSendCndDiv]").attr('required', 'required');
			$("select[name=dmsPackKindDiv]").attr('required', 'required');

			$(".ovsClass").removeClass('hit');
			$("select[name=ovsTrnsAreaDiv]").removeAttr('required');
			$("select[name=ovsSendCndDiv]").removeAttr('required');
			$("select[name=ovsPackKindDiv]").removeAttr('required');
		}
		else if(_value == "LGISTDIV0302") { //해외
			$('#dmsTran').hide();
			$('#ovsTran').show();

			$(".dmsClass").removeClass('hit');
			$("select[name=dmsTrnsAreaDiv]").removeAttr('required');
			$("select[name=dmsSendCndDiv]").removeAttr('required');
			$("select[name=dmsPackKindDiv]").removeAttr('required');
			$(".ovsClass").addClass('hit');
			$("select[name=ovsTrnsAreaDiv]").attr('required', 'required');
			$("select[name=ovsSendCndDiv]").attr('required', 'required');
			$("select[name=ovsPackKindDiv]").attr('required', 'required');
		}
		else {
			$('#dmsTran').hide();
			$('#ovsTran').hide();
			changeSetEtc("x","dmsSendCndDiv");
			changeSetEtc("x","ovsSendCndDiv");

			$(".dmsClass").removeClass('hit');
			$("select[name=dmsTrnsAreaDiv]").removeAttr('required');
			$("select[name=dmsSendCndDiv]").removeAttr('required');
			$("select[name=dmsPackKindDiv]").removeAttr('required');
			$(".ovsClass").removeClass('hit');
			$("select[name=ovsTrnsAreaDiv]").removeAttr('required');
			$("select[name=ovsSendCndDiv]").removeAttr('required');
			$("select[name=ovsPackKindDiv]").removeAttr('required');
		}
	}

	//기타입력
	function changeSetEtc(_value,_name){
		if(!isEmpty(_value) && _value.indexOf("99") != -1){//기타
			$("input[name="+_name+"Etc"+"]").attr('required', 'required');
			$("input[name="+_name+"Etc"+"]").prop("readonly", false);
			//$('#popForm .'+_name).addClass('hit');
		}
		else {//기타아닐때
			$("input[name="+_name+"Etc"+"]").val("");
			$("input[name="+_name+"Etc"+"]").removeAttr('required');
			$("input[name="+_name+"Etc"+"]").prop("readonly", true);
			//$('#popForm .'+_name).removeClass('hit');
		}
	}

	//Sales Code 필수 변경
	function selectSalesCodeSet() {
		if ($('#workRptS').find('option:selected').data('etc') === 'Y') {
			$('#popForm .Sales_Code').addClass('hit');
			$('#popForm input#salesCd').attr('required', 'required');
		} else {
			$('#popForm .Sales_Code').removeClass('hit');
			$('#popForm input#salesCd').removeAttr('required');
		}
	}

	function selectLgistMastInfo() {						//그리드에 뿌리는 데이터
		var formData = {
			"fileTrgtKey" : fileTrgtKey,
		}
		postAjax("/user/cr/cr10/selectLgistMastInfo", formData, null, function(data) {
			loadFormData("#popForm", data.result, function(data){
				salescdGridView.setData(0);//입고,출고 에 따라 그리드 데이타 변경

				$('#trnsDiv').trigger('change');
				//발송조건구분기타 활성/비활성
				changeSetEtc(data.dmsSendCndDiv,"dmsSendCndDiv");
				changeSetEtc(data.ovsSendCndDiv,"ovsSendCndDiv");

				appStatus = data.appStatus;
				if(isEmpty(appStatus)) appStatus = "APP0";
				if(appStatus != "APP0"){
					//결재중 일때 화면잠금.
					setDisplayLock();
				}
			});
		});
	}

	// 등록
	function insertLgistMast() {
		if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사
			var formData = makeFormData();										// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
			filePostAjax("/user/cr/cr10/insertLgistMast", formData,				// 파일을 포함한 데이터를 서버로 전송하는 비동기적인 AJAX 요청을 수행
					function(data) {
						alert(data.resultMessage);								// 결과 메시지를 alert으로 출력
						if (data.resultCode == 200) {							//  요청이 성공(200)한 경우, gridView.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
							gridView.setData(0);
							modalStack.close();									// 모달을 닫음
						}
					});
		}
	}

	// 수정
	function updateLgistMast() {
		if(appStatus != "APP0"){
			alert("결재진행중 입니다. 결재진행중인 내역은 수정 할 수 없습니다.");
			return;
		}

		if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사
			var formData = makeFormData();										// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성\
	      	filePostAjax("/user/cr/cr10/updateLgistMast", formData,function(data) {
						alert(data.resultMessage);
						if (data.resultCode == 200) {
							gridView.setData(0);
							modalStack.close();
						}
					});
		}
	}

	//----------------------------------------------//

	function makeFormData() {
		// 금액 콤마 제거
		/*
		$.each($('.popup_area input'), function(idx, elem) {
			if($(elem).is('[comma]')||$(elem).is('[data-money]')||$(elem).is('[money]')){
				deleteComma(elem);
			}
		});
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		*/

		//formData 생성전 운송구분에 따라 필요없는값제거
		changeTrnsDivSetValue();

		// 폼데이터 생성
		var formData = getFormData("#popForm");
		//var formData = new FormData($("#popForm")[0]);
		//---------------------------------------------------------------
		//  disabled 처리시 값 전송안됨 아래에서 폼데이터 추가
		//---------------------------------------------------------------
		formData.append("coCd", $('#coCd').val());
		//formData.append("workRptNo", $('#workRptNo').val());
		//formData.append("reqIdNm", $('#reqIdNm').val());
		//formData.append("pblicteDt", $('#pblicteDt').val());
		//---------------------------------------------------------------
		//-------itemarr  --첨부화일 처리를 위한 부분 시작
		//---------------------------------------------------------------
		var ordrsClntCd = $("input[name=ordrsClntCd]").val();
		// 유저아이디 추가
		formData.append("userId", jwt.userId);
		formData.append("clntCd", ordrsClntCd);	//첨부화일용
		formData.append("prdtCd", "");			//첨부화일용
		formData.append("itemCd", "");			//첨부화일용
		formData.append("prjctCd","");			//첨부화일용

		//-------itemarr  --첨부화일 처리를 위한 부분 시작
		formData.append("comonCd", treeModule.getFileNodeId());	//첨부화일용

		//---------------------------------------------------------------

        //---------------------------------------------------------------
		var fileUploadArr = [];
		var tempArr = [];

		tempArr = treeModule.getFileArr();
		$.each(tempArr, function(idx, obj) {
			if (obj.fileKey == 0) {
                formData.append("files", obj.file);
                obj.file = '';
                fileUploadArr.push(obj);
			}
		});

		formData.append("uploadFileArr", JSON.stringify(fileUploadArr));
		formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
		//---------------------------------------------------------------
		//--첨부화일 처리를 위한 부분 끝
		//---------------------------------------------------------------

		let selected_list = salescdGridView.target.getList("selected"); //선택항목을 가져온다.
		//let selected_list = JSON.parse(JSON.stringify(salescdGridView.target.list));

		//체크 항목을 chkYn = Y 로 셋팅
 		$.each($.extend({}, selected_list), function (idx, elem) {
			elem.chkYn = "Y";
			elem.dtaChk = "I";
		});

		formData.append("salesCdArr", JSON.stringify(selected_list));

		//---------------------------------------------------------------
		//--결재 처리를 위한 부분 시작
		//---------------------------------------------------------------
		let popData = getSearchParam("#popForm");
		let paramData = {
				"fileTrgtKey" : popData.fileTrgtKey,
				"coCd" : popData.coCd,
				"ordrsNo" : popData.ordrsNo,
				"clntPjt" : popData.clntPjt,
				"reqId" : popData.reqId,
				"reqIdNm" : popData.reqIdNm,
				"ordrsClntNm" : popData.ordrsClntNm,
				"ordrsClntCd" : popData.ordrsClntCd,
				"clasDiv" : popData.clasDiv,
		};
		formData.append("appDiv", "APPDIV03");
		formData.append("pgPath", "/user/cr/cr10/CR1001P02.html");
		formData.append("pgParam", JSON.stringify(paramData));
		//---------------------------------------------------------------
		//--결재 처리를 위한 부분 끝
		//---------------------------------------------------------------

		return formData;
	}

	//그리드초기화
	function initSalesCode(){
		if(appStatus != "APP0"){
			return;
		}

		salescdGridView.setData(0);
	}

	function setDisplayLock(){
		setDisabledInput("#popForm" , true);
		$('.tit').text('물류진행요청 수정 (결재진행중)');

		//$("#actionBtn").prop("disabled", true);
	}

	//  업체명 검색 //
	function clntSearch() {
		openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420,
				"업체명 검색", {}, function(grid) {
					var row = grid.target.getList("selected")[0];
					$('#pchsClntCd').val(row.clntCd);
					$('#pchsClntNm').val(row.clntNm);
// 					$('#mngId').val(row.salesEmpId);
// 					$('#mngNm').val(row.salesEmpNm);

// 					var paramObj = {
// 						"coCd" : $('#coCd').val(),
// 						"clntCd" : row.clntCd
// 					}
// 					setMngInfo(paramObj);
				});
	}

	function openUserTree(_id) {
		if($('#reqIdNm').prop("disabled")) return false;

		var paramObj = {
			"coCd" : $('#coCd').val(),
			"userId": $('#'+_id).val(),
			"useYn": "Y"
		};
		openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "사용자 검색", paramObj, function (tree){
			var checkedId = tree.get_checked()[0];
			var checkedNode = tree.get_node(checkedId);
			$('#'+_id).val(checkedNode.id);
			$('#'+_id+'Nm').val(checkedNode.text);
// 			$("#deptNm_S").val(checkedNode.original.deptNm);
// 			$("#deptId_S").val(checkedNode.parent);
		});
	}

	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();
	}
</script>