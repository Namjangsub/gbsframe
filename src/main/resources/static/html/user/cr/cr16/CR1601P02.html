<div id="wbsSPopup" class="popup_area of_a" style="width: 100%; height: 100%;">
     <div class="tit_contents">
        <h4 class="tit">년간 사업계획 이력</h4>
    </div>
    <table class="popup_table">
        <colgroup>
             <col width="4%">
             <col width="7%">
             <col width="4%">
             <col width="5%">
             <col width="4%">
             <col width="7%">
             <col width="5%">
             <col width="7%">
             <col width="4%">
             <col width="7%">
             <col width="4%">
        </colgroup>
        <tbody>
           <tr>
           <th>회사</th>
              <td>
                  <select id="coCd_P" name="coCd_P" data-kind="CO">
                   <option value="">전체</option>
                  </select>
              </td>
              <th>계획년도</th>
              <td>
              <input type="text" class="input_calendar" id="salesPlanYy_P" name="salesPlanYy_P" autocomplete="off" date onchange="preGridView.setData(0);">                   
              </td>
              <th>고객사</th>
              <td> 
              <input type="hidden" id="salesPlanClntCd_P" name="salesPlanClntCd_P" >
              <div class="search_form" style="width: 100%;">
                  <input type="text" id="salesPlanClntNm_P" name="salesPlanClntNm_P" onkeyup="if(window.event.keyCode == 8){salesPlanClntCd_P.value = ''};" onchange="preGridView.setData(0);"> 
                  <a onclick="openClntSearchP1('P');"><i class="i_search_w"></i></a>
              </div>
              </td>
              <th>영업 담당자</th>
              <td>
              <input type="hidden" id="salesPlanId_P" name="salesPlanId_P" style="width: 100%;">
                      <div class="search_form">
                       <input type="text" id="salesPlanNm_P" name="salesPlanNm_P" data-search="salesPlanNm" onkeyUp="if(window.event.keyCode == 8){salesPlanId_P.value = ''};" onchange="preGridView.setData(0);">
                          <a onclick="openUserTreeP1();"><i class="i_search_w"></i></a>
                      </div>
              </td>
              <th>계획구분</th>
              <td>
	              <select id="salesPlanDiv_P" name="salesPlanDiv_P" data-kind="SALESPLANDIV" onchange="preGridView.setData(0);">
	                <option value="">선택</option>
	                </select>
              </td>
              <td>
                  <a onclick="preGridView.setData(0);"  style="height: 20px; line-height: 28px; width: 60px;">검색</a>
              </td>
           </tr>
        </tbody>
      </table>                
	<div class="contents">
	    <!-- 리스트 -->
	      <div class="ax5_grid" data-ax5grid="third-grid" data-ax5grid-config="{}" style="height: 610px; width: 100%" ></div>
	</div>
</div>
<script type="text/javascript">
var coCd = null;
var salesPlanYy = null;
var salesPlanClntCd = null;
var salesPlanClntNm = null;
var salesPlanId = null;
var salesPlanNm = null;
var salesPlanDiv = null;

  var preGridView = {
  	initView: function(){
	this.target = new ax5.ui.grid();
	this.target.setConfig({
		showRowSelector: false,
		multipleSelect: false,
		sortable: true,
		target: $('[data-ax5grid="third-grid"]'),
		header: {
             align: "center",
             selector: false
           },
           body: {
			onClick: function () {
			    this.self.select(this.dindex); 
			},
	   },
          page: {
        	  navigationItemCount: 9,
              height: 30,
              display: true,
          },
          columns: [
       	      {key: "rn",      label: "No.",          align: "center",   width: 60},
              {key: "coCd",      label: "회사",          hidden: true},
              {key: "coCdNm",      label: "회사명",      align: "center",   width: 60},
              {key: "salesPlanYy",      label: "계획년도",      align: "center",   width: 80},
              {key: "salesPlanCloseSeq", label: "차수",      align: "center",   width: 60},
              {key: "salesPlanClntCd",      label: "고객사",      hidden: true},
              {key: "salesPlanClntNm",      label: "고객사명",      align: "center",   width: 130},
              {key: "salesPlanId",      label: "영업담당자ID",      hidden: true},
              {key: "salesPlanNm",      label: "영업담당자명",      align: "center",   width: 130},
              {key: "salesPlanDiv",      label: "계획구분ID",     hidden: true},
              {key: "salesPlanDivNm",      label: "계획구분",      align: "center",   width: 80},
              {key: "salesPlanAmt01",      label: "01월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt02",      label: "02월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt03",      label: "03월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt04",      label: "04월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt05",      label: "05월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt06",      label: "06월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt07",      label: "07월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt08",      label: "08월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt09",      label: "09월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt10",      label: "10월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt11",      label: "11월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt12",      label: "12월",     align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanTotAmt",      label: "합계",     align: "right",   width: 100, formatter: "money"}
             ],
             footSum: [
                 [
                     {label: "합계", colspan:6, align: "center"},
                     {key: "salesPlanAmt01", collector: "sum", formatter: "money", align: "right"}, 
                     {key: "salesPlanAmt02", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt03", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt04", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt05", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt06", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt07", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt08", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt09", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt10", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt11", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt12", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanTotAmt", collector: "sum", formatter: "money", align: "right"}
                 ]]
       });
       return this;

     },
     setData : function(_pageNo) {
         var targetObj = this.target;
         var paramObj = {
        		 "coCd": coCd,
        		 "salesPlanYy":$('#salesPlanYy_P').val(),
        		 "salesPlanClntCd":$('#salesPlanClntCd_P').val(),
        		 "salesPlanClntNm": $('#salesPlanClntNm_P').val(),
        		 "salesPlanId": $('#salesPlanId_P').val(),
        		 "salesPlanNm": $('#salesPlanNm_P').val(),
        		 "salesPlanDiv": $('#salesPlanDiv_P').val()
                 };
         postAjax("/user/cr/cr16/selectSalesYearPlanListHist", paramObj, null, function(data){
             var list = data.fileList;
             if(targetObj){
                 targetObj.setData({
                     list : list,
                     page : {
                    	 totalElements : list.length,
                     }
                 });
         	 }
         });
     } 
}
     
$(document).ready(function() {
	coCd = modalStack.last().paramObj.coCd;
	salesPlanYy = modalStack.last().paramObj.salesPlanYy;
	salesPlanClntCd = modalStack.last().paramObj.salesPlanClntCd;
	salesPlanClntNm = modalStack.last().paramObj.salesPlanClntNm;
	salesPlanId = modalStack.last().paramObj.salesPlanId;
	salesPlanNm = modalStack.last().paramObj.salesPlanNm;
	salesPlanDiv = modalStack.last().paramObj.salesPlanDiv;
	
	setCommonSelect($("#wbsSPopup select[data-kind]"));
    setByCoCd(jwt.coCd);
	$('#salesPlanYy_P').datepicker({
        format : "yyyy",
        language : "ko",
        autoclose : true,
        minViewMode : "years"
      })
     .datepicker("setDate", "today") 
   
    $('#salesPlanYy_P').val(salesPlanYy);
	$('#salesPlanClntCd_P').val(salesPlanClntCd);
	$('#salesPlanClntNm_P').val(salesPlanClntNm);
	$('#salesPlanId_P').val(salesPlanId);
	$('#salesPlanNm_P').val(salesPlanNm);
	$('#salesPlanDiv_P').val(salesPlanDiv);
	preGridView.initView().setData(0);
	
})

function setByCoCd(value) {
    $('#coCd_P option:not([value="'+value+'"])').remove();
}

function openClntSearchP1(openType) {
    var paramObj = {
            "searchValue" :  $("#salesPlanClntNm_P").val()
    }       
    openSecondModal("/static/html/cmn/modal/clntSearch.html", 650, 650, "거래처 검색", paramObj, function (grid) {
        var row = grid.target.getList("selected")[0];
        if(openType == "P" && actionType=="C"){
            $('#salesPlanClntCd_P').val(row.clntCd);
            $('#salesPlanClntNm_P').val(row.clntNm); 
            preGridView.setData(0);
        }
    });
}  

function openUserTreeP1() {
    var paramObj = {
        "coCd" : $('#coCd_P').val(),
        "userId": $('#salesPlanId_P').val(),
        "userNm": $('#salesPlanNm_P').val(),
        "useYn": "Y"
    };
    openSecondModal("/static/html/cmn/modal/userSearch.html", 450, 650, "영업 담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#salesPlanId_P').val(checkedNode.id);
        $('#salesPlanNm_P').val(checkedNode.text);
        preGridView.setData(0);
    });
}
	
</script>
