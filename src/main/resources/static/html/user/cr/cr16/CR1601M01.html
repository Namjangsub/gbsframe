<!DOCTYPE html>
<html lang="ko">
<style>
	.add_btn_small{
	    display: inline-block;
	    padding: 0px;
	}
                
	.add_btn_small a {
	    display: inline-block;
	    width: 33px;
	    height: 20px;
	    line-height: 20px;
	    text-align: center;
	    color: #444;
	    background: #ffffff;
	    box-shadow: 1px 1px rgba(0,0,0,0.15);
	}
</style>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="/static/fontawesome/css/all.css">
<link rel="stylesheet" href="/static/css/ax5/ax5grid.css">
<link rel="stylesheet" href="/static/css/ax5/ax5mask.css">
<link rel="stylesheet" href="/static/css/ax5/ax5modal.css">
<link rel="stylesheet" href="/static/css/ax5/ax5toast.css">
<link rel="stylesheet" href="/static/css/ax5/ax5menu.css">
<link rel="stylesheet" href="/static/css/ax5/ax5calendar.css">
<link rel="stylesheet" href="/static/css/jstree/style.min.css">
<link rel="stylesheet" href="/static/css/ax5/ax5combobox.css">
<link rel="stylesheet" href="/static/css/gnb.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/sub.css">
<link rel="stylesheet" href="/static/css/common.css">

<script src="/static/js/jquery-latest.min.js"></script>
<script src="/static/js/jquery.serializeObject.js"></script>
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
<script src="/static/js/moment/moment-with-locales.js"></script>
<script src="/static/js/jstree/jstree.min.js"></script>
<script src="/static/js/ax5/ax5core.min.js"></script>
<script src="/static/js/ax5/ax5grid.min.js"></script>
<script src="/static/js/ax5/ax5mask.min.js"></script>
<script src="/static/js/ax5/ax5modal.min.js"></script>
<script src="/static/js/ax5/ax5toast.min.js"></script>
<script src="/static/js/ax5/ax5calendar.min.js"></script>
<script src="/static/js/ax5/ax5picker.min.js"></script>
<script src="/static/js/ax5/ax5menu.min.js"></script>
<script src="/static/js/ax5/ax5formatter.min.js"></script>
<script src="/static/js/ax5/ax5combobox.min.js"></script>

<script src="/static/js/global.js"></script>
<script src="/static/js/fileTree.js"></script>
<!-- 도움말 팝업 -->
<script src="/static/js/manualPopup.js"></script>

</head>

<body>
	<div id="head_area"></div>
	<div id="top_area"></div>
	
	<div id="main_area">
		<!-- 페이지 상단 -->
        <div class="contents no_bg">
            <ul class="btn_ul">
                <li class="btn_r">
                    <input type="hidden" id="pgmId" name="pgmId">
                    <a onclick="manualPopup();"><button type="button" class="bg_gray" onclick="manualPopup();">도움말</button></a>
                    <a onclick="initSearch();"><button class="bg_gray">초기화</button></a>
                    <a onclick="gridView.setData(0);"><button class="bg_gray">검 색</button></a>
	            </li>
            </ul>
        </div>
    
		<!-- 검색 콘텐츠 -->
		<div class="contents search">
			<div class="">
				<!-- 테이블 인풋 3분할 -->
				<table class="table_input type05">
				
					<!-- 검색조건 1행 -->
					<tr>
						<th class= "hit">회사</th>
						<td>
							<select id="coCd_S" name="coCd_S" data-kind="CO" data-search="coCd" onchange="setSalesPlanDeptCd();">
						    	<option value="">전체</option>
							</select>
						</td>
						<th class= "hit">계획년도</th>
						<td>
						<input type="text" class="input_calendar" id="salesPlanYy_S" name="salesPlanYy_S" data-search="salesPlanYy_S"  "autocomplete="off" date onchange="setSalesPlanHist();">                                
						</td>
						<th>부서</th>
						<td>
						    <select id="salesPlanDeptCd_S" name="salesPlanDeptCd_S" onchange="gridView.setData(0);">
                            	<option value="">전체</option>
                            </select>
						</td>
					</tr>
					  
					<!-- 검색조건 2행 -->                    
					<tr>
						<th>영업담당자</th>
                        <td>
                                <input type="hidden" id="salesPlanId_S" name="salesPlanId_S" data-search="salesPlanId" style="width: 100%;">
                                <div class="search_form">
                                 <input type="text" id="salesPlanNm_S" name="salesPlanNm_S" data-search="salesPlanNm" onkeyUp="if(window.event.keyCode == 13){gridView.setData(0);}" onkeyUp="if(window.event.keyCode == 8){salesPlanId_S.value = ''};">
                                    <a onclick="openUserTree();"><i class="i_search_w"></i></a>
                                </div>
                        </td>   
						<th>고객사</th>
						<td>
						    <input type="hidden" id="salesPlanClntCd_S" name="salesPlanClntCd_S"  data-search="salesPlanClntCd">
                            <div class="search_form" style="width: 100%;">
                                <input type="text" id="salesPlanClntNm_S" name="salesPlanClntNm_S"  data-search="salesPlanClntNm" onkeyup="if(window.event.keyCode == 8){salesPlanClntCd_S.value = ''}  else if(window.event.keyCode == 13){gridView.setData(0);};"> 
                                <a onclick="openClntSearch('P');"><i class="i_search_w"></i></a>
                            </div>
						</td>
						<th>계획 구분</th>
						<td>
						    <select id="salesPlanDiv_S" name="salesPlanDiv_S" data-kind="SALESPLANDIV" onchange="gridView.setData(0);">
                            <option value="">선택</option>
                            </select>
						</td>
						<th>계획 이력</th>
						<td>
						    <select id="salesPlanHist_S" name="salesPlanHist_S" onchange="gridView.setData(0);">
                            	<option value="0">년간사업계획</option>
                            </select>
						</td>
                        <th></th><td></td>
		            </tr>
		            <!-- 검색조건 END -->
	            </table>
            </div>
        </div>
        <!-- 콘텐츠 -->

		<!-- 콘텐츠 -->
		<div class="contents no_bg">
		<!-- 콘텐츠 타이틀 -->
		<div class="contents_tit">
			<span  style="height: 30px; line-height: 30px;font-size: 15px;">등록된 사업계획 리스트 </span>
			<div class="add_btn_small pdl10">
<!-- 				<a onclick="insertSalesYearPlanM();" style="height: 30px; line-height: 28px;" authchk>+</a> -->
<!-- 				<a onclick="deleteSalesYearPlan();" style="height: 30px; line-height: 28px;" authchk>-</a> -->
			    <a onclick="callPlanClose();" style="height: 30px; line-height: 28px; width: 80px;"><i class="fas fa-check-square"></i> 계획확정</a>
				<a onclick="excelDown();" style="height: 30px; line-height: 28px; width: 90px;"><i class="fas fa-file-excel"></i> 엑셀다운로드</a>
			    </div>
				<select id="recordCnt" class="prae_select" data-search="recordCnt" onchange="gridView.setData(0);">
					<option value="10">10</option>
					<option value="25" selected>25</option>
					<option value="50">50</option>
					<option value="100">100</option>
					<option value="9999999">전체</option>
		        </select>
			</div>
		</div>
		
		<!-- 콘텐츠 -->
		<div class="contents">
		    <!-- 리스트 -->
		      <div class="ax5_grid" data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 650px; width: 100%" ></div>
		      <div data-ax5grid="excel-grid" data-ax5grid-config="{}" style="display: none;"></div>
		</div>
    </div>
                    
</body>
</html>

<script type="text/javascript">
var isFirst = true;
var pageNo = 0;
  var gridView = {
  	initView: function(){
	this.target = new ax5.ui.grid();
	this.target.setConfig({
		showRowSelector: false,
		multipleSelect: false,
		sortable: true,
		target: $('[data-ax5grid="first-grid"]'),
		header: {
             align: "center",
             selector: false
           },
           body: {
			onClick: function () {
			    this.self.select(this.dindex); 
			},
			onDBLClick: function () {
				      this.self.clearSelect();
                      this.self.select(this.dindex);
//                       updateSalesYearPlanM(this.dindex);
			},
	   },
          page: {
			navigationItemCount: 9,
			height: 30,
			display: true,
			firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
			prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
			nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
			lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
			onChange: function () {
				gridView.setData(this.page.selectPage); 
				pageNo = this.page.selectPage; 
			}
          },
          columns: [
              {key: "rn",               label: "No.",                          align: "center",   width: 60},
              {key: "salesPlanYy",      label: "계획년도",                        align: "center",   width: 80},
              {key: "coCd",             label: "회사",           hidden: true},
              {key: "coCdNm",           label: "회사명",                         align: "center",   width: 70},
              {key: "salesPlanId",      label: "영업담당자ID",     hidden: true},
              {key: "salesPlanNm",      label: "영업담당자명",                     align: "center",   width: 90},
              {key: "salesPlanClntCd",  label: "고객사",          hidden: true},
              {key: "salesPlanClntNm",  label: "고객사명",                        align: "center",   width: 130},
              {key: "salesPlanDiv",     label: "계획구분ID",      hidden: true},
              {key: "salesPlanDivNm",   label: "계획구분",                        align: "center",   width: 80},
              {key: "salesPlanAmt01",   label: "01월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt02",   label: "02월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt03",   label: "03월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt04",   label: "04월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt05",   label: "05월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt06",   label: "06월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt07",   label: "07월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt08",   label: "08월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt09",   label: "09월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt10",   label: "10월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt11",   label: "11월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanAmt12",   label: "12월",           align: "right",   width: 100, formatter: "money"},
              {key: "salesPlanTotAmt",  label: "합계",            align: "right",   width: 100, formatter: "money"},
              {key: "creatId",          label: "최종변경자",         hidden: true},
              {key: "creatNm",          label: "생성자명",         align: "center",   width: 120,      hidden: true},
              {key: "creatPgm",         label: "생성프로그램ID",      hidden: true},
              {key: "creatDttm",        label: "생성일시",      align: "center",   width: 140,      hidden: true},                   
              {key: "udtId",            label: "최종변경자",      hidden: true},
              {key: "udtNm",            label: "최종변경자명",      align: "center",   width: 120,      hidden: true},
              {key: "udtPgm",           label: "최종수정프로그램ID",      hidden: true},
              {key: "udtDttm",          label: "최종변경일자",      align: "center",   width: 140,      hidden: true}
             ],
             footSum: [
                 [
                     {label: "합계", colspan:6, align: "center"},
                     {key: "salesPlanAmt01", collector: "sum", formatter: "money", align: "right"}, 
                     {key: "salesPlanAmt02", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt03", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt04", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt05", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt06", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt07", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt08", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt09", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt10", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt11", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanAmt12", collector: "sum", formatter: "money", align: "right"},
                     {key: "salesPlanTotAmt", collector: "sum", formatter: "money", align: "right"}
                 ]]
       });
       return this;

     },
     setData : function(_pageNo) {
         if (isFirst) return;
         var targetObj = this.target;
         var paramObj = {
        		 "coCd": $('#coCd_S').val(),
        		 "salesPlanYy": $('#salesPlanYy_S').val(),
        		 "salesPlanDeptCd": $('#salesPlanDeptCd_S').val(),
        		 "salesPlanClntNm": $('#salesPlanClntNm_S').val(),
        		 "salesPlanId": $('#salesPlanId_S').val(),
        		 "salesPlanNm": $('#salesPlanNm_S').val(),
        		 "salesPlanDiv": $('#salesPlanDiv_S').val(),
        		 "salesPlanHist": $('#salesPlanHist_S').val(),
                 "pageNo" : _pageNo + 1,
                 "recordCnt" : $('#recordCnt').val()
                 };
         postAjax("/user/cr/cr16/selectSalesYearPlanList", paramObj, null, function(data){
             var list = data.fileList;
                 targetObj.setData({
                     list : list,
                     page : {
                    	 currentPage : _pageNo,
                         pageSize : data.paginationInfo.pageSize,
                         totalElements : data.paginationInfo.totalRecordCount,
                         totalPages : data.paginationInfo.totalPageCount
                     }
                 });
         });
     } 
}
        
var excelView = {
		initView: function(){
		this.target = new ax5.ui.grid();
		this.target.setConfig({
		target: $('[data-ax5grid="excel-grid"]'),
		columns: [
            {key: "rn",      			 label: "No.",          align: "center",   width: 60},
            {key: "salesPlanYy",      	 label: "계획년도",      align: "center",   width: 80},
            {key: "coCd",      			 label: "회사",          hidden: true},
            {key: "coCdNm",      		 label: "회사명",      align: "center",   width: 60},
            {key: "salesPlanId",      	 label: "영업담당자ID",      hidden: true},
            {key: "salesPlanNm",      	 label: "영업담당자명",      align: "center",   width: 130},
            {key: "salesPlanClntCd",     label: "고객사",      hidden: true},
            {key: "salesPlanClntNm",     label: "고객사명",      align: "center",   width: 130},
            {key: "salesPlanDiv",      	 label: "계획구분ID",     hidden: true},
            {key: "salesPlanDivNm",      label: "계획구분",      align: "center",   width: 80},
            {key: "salesPlanAmt01",      label: "01월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanAmt02",      label: "02월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanAmt03",      label: "03월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanAmt04",      label: "04월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanAmt05",      label: "05월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanAmt06",      label: "06월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanAmt07",      label: "07월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanAmt08",      label: "08월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanAmt09",      label: "09월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanAmt10",      label: "10월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanAmt11",      label: "11월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanAmt12",      label: "12월",     align: "right",   width: 100, formatter: "money"},
            {key: "salesPlanTotAmt",      label: "합계",     align: "right",   width: 100, formatter: "money"},
            {key: "creatId",      label: "최종변경자",      hidden: true},
            {key: "creatNm",      label: "생성자명",      align: "center",   width: 120},
            {key: "creatPgm",      label: "생성프로그램ID",      hidden: true},
            {key: "creatDttm",      label: "생성일시",      align: "center",   width: 140},                   
            {key: "udtId",      label: "최종변경자",      hidden: true},
            {key: "udtNm",      label: "최종변경자명",      align: "center",   width: 120},
            {key: "udtPgm",      label: "최종수정프로그램ID",      hidden: true},
            {key: "udtDttm",      label: "최종변경일자",      align: "center",   width: 140}
           ],
           footSum: [
               [
                   {label: "합계", colspan:6, align: "center"},
                   {key: "salesPlanAmt01", collector: "sum", formatter: "money", align: "right"}, 
                   {key: "salesPlanAmt02", collector: "sum", formatter: "money", align: "right"},
                   {key: "salesPlanAmt03", collector: "sum", formatter: "money", align: "right"},
                   {key: "salesPlanAmt04", collector: "sum", formatter: "money", align: "right"},
                   {key: "salesPlanAmt05", collector: "sum", formatter: "money", align: "right"},
                   {key: "salesPlanAmt06", collector: "sum", formatter: "money", align: "right"},
                   {key: "salesPlanAmt07", collector: "sum", formatter: "money", align: "right"},
                   {key: "salesPlanAmt08", collector: "sum", formatter: "money", align: "right"},
                   {key: "salesPlanAmt09", collector: "sum", formatter: "money", align: "right"},
                   {key: "salesPlanAmt10", collector: "sum", formatter: "money", align: "right"},
                   {key: "salesPlanAmt11", collector: "sum", formatter: "money", align: "right"},
                   {key: "salesPlanAmt12", collector: "sum", formatter: "money", align: "right"},
                   {key: "salesPlanTotAmt", collector: "sum", formatter: "money", align: "right"}
               ]]
		});
		   return this;
    }
}        

function excelDown() {
    var paramObj = {"coCd": $('#coCd_S').val(),
            "salesPlanYy": $('#salesPlanYy_S').val(),
            "salesPlanClntCd": $('#salesPlanClntCd_S').val(),
            "salesPlanClntNm": $('#salesPlanClntNm_S').val(),
            "salesPlanId": $('#salesPlanId_S').val(),
            "salesPlanNm": $('#salesPlanNm_S').val(),
            "salesPlanDiv": $('#salesPlanDiv_S').val(),
            "salesPlanHist": $('#salesPlanHist_S').val(),
            "firstIndex": 1,
            "lastIndex": 9999999
            };
	    postAjax("/user/cr/cr16/selectSalesYearPlanListExcel", paramObj, null, function(data){
	        var list = data.fileList;
            excelView.target.setData({
               list : list,
               page : {
                         totalElements : list.length
               }
            });
	    });
        var todayDate = new Date().format('yyyyMMdd');
        if($('#salesPlanHist_S').val() == "0"){
	        excelView.target.exportExcel("년간 사업계획 리스트"+todayDate+".xls"); 
        }else{
        	excelView.target.exportExcel("년간 사업계획 리스트 "+$('#salesPlanHist_S').val()+"차.xls");
        }
}       
  
$(document).ready(function() {
	isFirst = false;  
	
	mainDefaultLoad("사업계획", "년간사업계획조회 및 확정");            // 페이지 타이틀 설정
	$('#pgmId').val("CR1601M01");                        // 프로그램 ID 설정
    setCommonSelect($("#main_area select[data-kind]"));  // 공통코드 set

    $("#coCd_S").val(jwt.coCd);
	setByCoCd($("#coCd_S").val());
    
	$('#salesPlanYy_S').datepicker({
              format : "yyyy",
              language : "ko",
              autoclose : true,
              minViewMode : "years"
    })
    .datepicker("setDate", "today")
    
    var initialYear = new Date().getFullYear();
    $('#salesPlanYy_S').val(initialYear);
    
    setSalesPlanDeptCd();
    
    setSalesPlanHist();
    
	gridView.initView().setData(0);
	excelView.initView();
	
	// 검색조건 이벤트 bind
	$('[data-search]').on("change", function(){
		gridView.setData(0);
	});
})

function insertSalesYearPlanM() {
	  var paramObj = {
              "actionType" : "C",
              "coCd" :  $('#coCd_S').val(),
              "salesPlanYy" : $('#salesPlanYy_S').val(),
              "salesPlanClntCd" : "",
              "salesPlanClntNm" : "",
              "salesPlanId" : "",
              "salesPlanNm" : "",
              "salesPlanDiv" : ""
              };             
	  openModal("/static/html/user/cr/cr16/CR1601P01.html", 1300, 810, "", paramObj, function(data) {
	     
	  });   
}  

function updateSalesYearPlanM(idx) {
	  var row = gridView.target.getList("selected")[0];
	  if (row != undefined) {
		  var paramObj = {
	              "actionType" : "U",
	              "coCd" : row.coCd,
	              "salesPlanYy" : row.salesPlanYy,
	              "salesPlanClntCd" : row.salesPlanClntCd,
	              "salesPlanClntNm" : row.salesPlanClntNm,
	              "salesPlanId" : row.salesPlanId,
	              "salesPlanNm" : row.salesPlanNm,
	              "salesPlanDiv" : row.salesPlanDiv
	              };  
		  
	      openModal("/static/html/user/cr/cr16/CR1601P01.html", 1300, 810, "", paramObj, function(data) {
	          gridView.setData(0);
	      });  
	  }         
}  
  
function openClntSearch(openType) {
    var paramObj = {
            "searchValue" :  $("#salesPlanClntNm_S").val()
			, "clntDivCd" : "CLNTDIV12"		/*거래처 검색 기본값 고객사로 세팅 */
			, "pchsClntCd" : "CLNTDIV12"	/*구매처 팝업일 경우 구분자 고객사 제외하고 세팅 */	
    }       
    openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색", paramObj, function (grid) {
        var row = grid.target.getList("selected")[0];
        if(openType == "P"){
            $('#salesPlanClntCd_S').val(row.clntCd);
            $('#salesPlanClntNm_S').val(row.clntNm);
            gridView.setData(0);
        }
    });
}  

function openUserTree() {
    var paramObj = {
        "coCd" : $('#coCd_S').val(),
        "userId": $('#salesPlanId_S').val(),
        "userNm": $('#salesPlanNm_S').val(),
        "useYn": "Y"
    };
    openSecondModal("/static/html/cmn/modal/userSearch.html", 300, 500, "영업 담당자 검색", paramObj, function (tree){
        var checkedId = tree.get_checked()[0];
        var checkedNode = tree.get_node(checkedId);
        $('#salesPlanId_S').val(checkedNode.id);
        $('#salesPlanNm_S').val(checkedNode.text);
        gridView.setData(0);
    });
}

//초기화 버튼용
function initSearch() {
    $('[data-search]').off("change");   //바인딩기능 오프
    $('.contents.search select, .contents.search input').val("");
    var initialYear = new Date().getFullYear();
    $('#salesPlanYy_S').val(initialYear);
    $("#coCd_S").val(jwt.coCd);
    $("#salesPlanDeptCd_S").val("");
    $("#salesPlanClntNm_S").val("");
    $("#salesPlanId_S").val("");
    $("#salesPlanNm_S").val("");
    $("#salesPlanDiv_S").val("");    
    $("#salesPlanHist_S").val("0");
    gridView.initView().setData(0);
}


function deleteSalesYearPlan() {
    var list = gridView.target.getList("selected");
     var rowListArr = [];
     if(list.length > 0) {
         if(confirm("년간 사업 계획을 삭제하시겠습니까?")){
             var formData = new FormData();
             $.each(list, function(idx, elem){
              var row = gridView.target.getList()[elem.__index];
                 if (row != undefined) {
                     const obj = {coCd: row.coCd, salesPlanYy: row.salesPlanYy, salesPlanClntCd : row.salesPlanClntCd, salesPlanId : row.salesPlanId, salesPlanDiv : row.salesPlanDiv};
                     rowListArr.push(obj);
                 }               
             });
             formData.append("rowListArr", JSON.stringify(rowListArr));
             filePutAjax("/user/cr/cr16/deleteSalesYearPlanList", formData, function(data){
                 if(data.resultCode == 200){
                     alert("삭제 완료되었습니다.");       
                     gridView.setData(0);
                 }
              }); 
         } 
     }
}

function setSalesPlanDeptCd() {
	
	var paramObj = {
			"coCd": $('#coCd_S').val()
            };
    postAjax("/user/cr/cr16/selectSalesDeptList", paramObj, null, function(data){
		//회사에 맞는 영업부서 세팅        
        if(data.list){
            $('#salesPlanDeptCd_S').empty(); // 기존 옵션을 제거합니다.
            $('#salesPlanDeptCd_S').append($('<option>', { value: '', text: '전체' }));
            
	        for (var i = 0; i < data.list.length; i++) {
	            $('#salesPlanDeptCd_S').append($('<option>', {
	                value: data.list[i].codeId, // 각 옵션의 값
	                text: data.list[i].codeNm // 각 옵션의 표시 텍스트
	            }));
	        }
        }else{
        	$('#salesPlanDeptCd_S').empty(); // 기존 옵션을 제거합니다.
            $('#salesPlanDeptCd_S').append($('<option>', { value: '', text: '전체' }));
        }
        
        gridView.setData(0);
    });
}

function callPlanClose() {
	var paramObj = {
			"salesPlanYy": $('#salesPlanYy_S').val(),
			"userId": jwt.userId,
			"pgmId": $('#pgmId').val()
            };
	
	if(confirm("년간 사업 계획을 확정하시겠습니까?")){
	    postAjax("/user/cr/cr16/callPlanClose", paramObj, null, function(data){
// 	    	console.log(data);
	    	alert("년간 사업 계획을 확정하였습니다.");
	    	setSalesPlanHist();
	        gridView.setData(0);
	    });
	}
}

function setSalesPlanHist() {
	
	var paramObj = {
			"salesPlanYy": $('#salesPlanYy_S').val()
            };
    postAjax("/user/cr/cr16/selectSalesPlanHistList", paramObj, null, function(data){
    	
		//년도에 맞는 계획이력        
        if(data.list){
            $('#salesPlanHist_S').empty(); // 기존 옵션을 제거합니다.
            $('#salesPlanHist_S').append($('<option>', { value: '0', text: '년간사업계획' }));
            
	        for (var i = 0; i < data.list.length; i++) {
	            $('#salesPlanHist_S').append($('<option>', {
	                value: data.list[i].codeId, // 각 옵션의 값
	                text: data.list[i].codeNm // 각 옵션의 표시 텍스트
	            }));
	        }
        }else{
        	$('#salesPlanHist_S').empty(); // 기존 옵션을 제거합니다.
            $('#salesPlanHist_S').append($('<option>', { value: '0', text: '년간사업계획' }));
        }
		
        gridView.setData(0);
    });
}

//판매법인 set
function setByCoCd(value) {
	$('#coCd_S option:not([value="'+value+'"])').remove();
}
</script>
