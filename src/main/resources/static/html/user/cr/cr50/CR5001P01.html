<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

	<script type="text/javascript" src="/static/js/tinymce/tinymce.min.js"></script>

 
    <style>
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; }
        body, div, ul, li { margin: 0; padding: 0; }
        ul, li { list-style: none; }

        .modal-body {
            padding: 10px;
            height: calc(100% - 40px); /* 헤더 높이만큼 뺀 값 */
            overflow-y: auto; /* 세로 스크롤바 생성 */
        }
		
		/*tab css*/
		.tab{float:left; width:100%; height:290px; margin-bottom: 20px; /* 탭과 아래 컨텐츠 사이 여백 */}
		.tabnav{font-size:0; width:100%; border:1px solid #ddd;margin-bottom: -1px; 
            position: -webkit-sticky;
            position: sticky;
            top: 0;
            background: #fff;
            z-index: 10;/* 중복 경계 제거 */}
		.tabnav li{display: inline-block;  height:30px; text-align:center; border-right:1px solid #ddd;}
		.tabnav li a:before{content:""; position:absolute; left:0; top:0px; width:100%; height:3px; }
		.tabnav li a.active:before{background: blue;}
		.tabnav li a.active{border-bottom:1px solid #fff;}
		.tabnav li a{ position:relative; display:block; background: #f8f8f8; color: #000; padding:0 10px; line-height:30px; text-decoration:none; font-size:16px;}
		.tabnav li a:hover,
		.tabnav li a.active{background:lightcyan; color:blue; }
		.tabcontent{padding: 2px; height:auto; border:1px solid #ddd; border-top:none; }
		
        .tabcontainer {
            margin-top: 20px; /* 탭 컨텐츠와 상단 사이의 여백 */
        }
        .mce-content-body {
            max-height: 700px;
            overflow-y: auto;
        }
        .table_list_tit {
		    background-color: lightsteelblue;
		}
		
        .field_disabled {
             /* pointer-events: none; 		클릭 이벤트 비활성화 */
            /* background-color: white; 	 읽기 전용 느낌을 주기 위한 배경색 */
             /* color: blue;				 텍스트 색상을 회색으로 변경 */
        }
         select.field_disabled {
            /* pointer-events: none; 		 클릭 이벤트 비활성화 */
        }
        /* /<input> 요소에 대한 스타일 */
        /* input.field_disabled { */
          /* pointer-events: none;         클릭 이벤트 활성화
             user-select: text; 
         } */

    </style>
</head>


<body>

<!-- 모달 폼 -->
<div class="modal-body">
	<form id="popForm" onSubmit="return false;">
	<input type="hidden" id="pgmId"     	name="pgmId"	value="CR5001P01">
	<input type="hidden" id="ordrgMngNm"	name="creatNm" value="">		<!-- 알림톡발송용 생성자명(발주담당자) -->
	<input type="hidden" id="ordrgMngTelNo"	name="ordrgMngTelNo" value="">		<!-- 알림톡발송용 생성자전화번호 -->		
	
   	<div class="popup_area of_a" style="width: 100%; height: 820px;">
	    <div class="tit_contents">
	      <h4 class="tit" id="pfuPopTit">PFU 설비 기본정보</h4>
	    </div>
	    <div class="form-group popup_table">
	 		<table>
	
		        <colgroup>
		          <col width="10%">
		          <col width="23%">
		          <col width="11%">
		          <col width="23%">
		          <col width="10%">
		          <col width="23%">
		          <col width="10%">
		          <col width="23%">
		        </colgroup>
		        <tr>
					<th>회사</th>
					<td>
						<select id="coCd" name="coCd" data-kind="CO" class="form-control" required msg="회사" readonly>
						</select>
					</td>
					<th>고객사</th>
					<td><input type="hidden" id="clntCd" name="clntCd" msg="고객사">
						<input type="text" id="clntNm" name="clntNm" msg="고객사" readonly>
					</td>
					<th>PFU등록번호</th>
					<td>
						<input type="text" id="fileTrgtKey" name="fileTrgtKey" msg="등록번호" readonly>
					</td>
					<th>Version No</th>
					<td>
						<div style="display: flex; align-items: center;">
							<input type="text" id="verNo" name="verNo" msg="버젼번호" readonly> 
							<div  class="add_btn_small">
								<a id="createHistory" onclick="createHistory();" style="height: 24px; line-height: 24px; width: 100px;background-color: blanchedalmond; display:none;" authchk>Ver.Up</a>
							</div>
						</div>
					</td>
		        </tr>
		        
		        <tr>
					<th>수주번호</th>
					<td>
						<div class="search_form" >
							<input type="text"  id="ordrsNo" name="ordrsNo" readonly="readonly" required msg="수주번호" readonly>
							<a onclick="pfuSalesCodeSearch();"><i class="i_search_w" ></i></a>
						</div>
					</td>
					<th>고객사PJT</th>
					<td><input type="hidden" id="clntPjt" name="clntPjt" msg="고객사PJT">
						<input type="text" id="clntPjtNm" name="clntPjtNm" msg="고객사PJT" readonly> 
					</td>
					<th  rowspan=4 class="hit">Sales Code</th>
					<td colspan=3 rowspan=4>
							<input type="hidden" id="salesCd" name="salesCd" msg="Sales Code" class="form-control" required> 
				              <div overflow-y: auto;">
				              	<div data-ax5grid="salesCd-grid" data-ax5grid-config="{}" style="height:130px;" ></div>
				              </div>
					</td>
		        </tr>
		        
		        <tr>
					<th>장비명</th>
					<td colspan=3>
						<input type="text" id="ctrtNm" name="ctrtNm" msg="장비명" class="form-control" required readonly> 
					</td>
		        </tr>
		        <tr>
					<th class="">제품군</th>
					<td colspan=1>
						<input type="hidden"  id="prdtDivOrigin" name="prdtDivOrigin"  readonly="readonly">
                       	<select id="prdtDiv" name="prdtDiv" class="form-control" msg="제품군">
                       	</select>
					</td>
					<th class="hit">계약일자</th>
					<td>
						<input id="ctrtDt" name="ctrtDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" required date>
					</td>
		        </tr>
		        <tr>
					<th class="">장비Type</th>
					<td colspan=1>
                       	<select id="prdtTyp" name="prdtTyp" data-kind="PFU01" class="form-control" msg="장비Type">
                       	</select>
					</td>
					<th class="hit">조립완료일자</th>
					<td>
						<input id="prdctnDt" name="prdctnDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" required date>
					</td>
		        </tr>
		        
		        <tr>
<!-- 					<th class="hit">작동방식</th> -->
<!-- 					<td colspan=1> -->
<!--                        	<select id="prdtCav" name="prdtCav" data-kind="PFUCAV" class="form-control" required msg="장비Type"> -->
<!--                        	</select> -->
<!-- 					</td> -->
					<th></th><td></td>
					<th class="hit">T/O완료일자</th>
					<td>
						<input id="acptncDt" name="acptncDt" class="input_calendar form-control" autocomplete="off" onkeyup="dateMask(this);" required date>
					</td>
		            <th title="운송조건을 확인합니다">운송조건</th>
		            <td>
						<input type="text" id="transOpt" name="transOpt" msg="운송조건" class="form-control" > 
		            </td>
					<th>포장/물류정보</th>
					<td>
						<input type="text" id="transInfo" name="transInfo" msg="포장/물류정보" class="form-control" > 
		            </td>
		        </tr>
		        
		        <tr>
<!-- 					<th class="hit">STEP수</th> -->
<!-- 					<td> -->
<!--                        	<select id="prdtStep" name="prdtStep" data-kind="PFUSTEP" class="form-control" required msg="STEP수"> -->
<!--                        	</select> -->
<!-- 					</td> -->
					<th></th><td></td>
		            <th class="hit" title="담당자 정보를 확인합니다">영업담당자</th>
		            <td>
		                <div class="search_form">
		                    <input type="text" id="mngIdNm" name="mngIdNm" onkeydown="if(event.keyCode==13)openUserTree( this.value);" required readonly>
		                    <input type="hidden" id="mngId" name="mngId" required msg="영업담당자" readonly>
		                    <!--  <a onclick="openUserTree( document.getElementById('mngIdNm').value);"><i class="i_search_w"></i></a> -->
		                </div>
		            </td>
					<th title="고객담당 정보를 확인합니다">고객담당</th>
					<td>
						<input type="text" id="clntMngNm" name="clntMngNm" msg="고객담당" class="form-control" > 
					</td>
					<th>설치주소</th>
					<td>
						<input type="text" id="installAddr" name="installAddr" msg="설치주소" class="form-control" > 
		            </td>
		        </tr>
		        
		        <tr>
					<th class="hit" rowspan=2 style="color: blue; font-weight: bold;">기준설비 도면번호</th>
		            <td style="color: blue; font-weight: bold;">
						<div class="search_form">
							<input type="hidden" id="fromCoCd" name="fromCoCd"> 
							<input type="hidden" id="fromClnt" name="fromClnt"> 
							<input type="hidden" id="fromOrdrsNo" name="fromOrdrsNo"> 
							<input type="hidden" id="fromPfuVerNo" name="fromPfuVerNo"> 
							<input type="hidden" id="fromPfuPrdtDiv" name="fromPfuPrdtDiv"> 
							<input type="hidden" id="fromPrdtCd" name="fromPrdtCd"> 
							<input type="hidden" id="fromPrdtTyp" name="fromPrdtTyp"> 
							<input type="hidden" id="fromPrdtCav" name="fromPrdtCav"> 
							<input type="hidden" id="fromPrdtStep" name="fromPrdtStep"> 
							<input type="text" id="fromSalesCd" name="fromSalesCd" msg="참조SalesCd" class="form-control" required  style="color: blue; font-weight: bold;"> 
							<a onclick="modalPfuCopySearch();"><i class="i_search_w"></i></a>
						</div>
		            </td>
					<th style="color: blue; font-weight: bold;">참조PFU번호</th>
					<td style="color: blue; font-weight: bold;">
						<input type="text" id="fromPfuNo" name="fromPfuNo" msg="참조PFU번호" readonly> 
		            </td>
		            <th title="고객 E-Mail을 확인합니다">고객 E-Mail</th>
		            <td>
						<input type="text" id="clntMngEmail" name="clntMngEmail" msg="고객 E-Mail" class="form-control" > 
		            </td>
					<th>입구Spec</th>
					<td>
		                <div style="display: flex; align-items: center;">
						폭 :　 <input type="text" id="gateWidth" name="gateWidth" msg="입구Spec 폭" class="form-control" style="width:50px;" >M　　
						높이 :　 <input type="text" id="gateHeight" name="gateHeight" msg="입구Spec 높이" class="form-control"  style="width:50px;" > M
		                </div>
		            </td>
		        </tr>
		        
		        <tr>
<!-- 					<th>연구소접수일</th> -->
<!-- 					<td> -->
<!-- 						<input type="text" id="rndAcceptDt" name="rndAcceptDt" msg="연구소접수일" readonly>  -->
<!-- 					</td> -->
					<td colspan=3 style="color: blue; font-weight: bold;">
						<input type="text" id="fromEqpNm" name="fromEqpNm" msg="참조설비명" readonly > 
		            </td>
		            <th title="고객전화번호를 확인합니다">고객전화번호</th>
		            <td>
						<input type="text" class="form-control" id="clntMngHp" name="clntMngHp" > 
<!-- 						<input type="text" class="form-control" id="clntMngHp" name="clntMngHp" onkeyup="telNumberFormatter(this);" maxlength="13">  -->
		            </td>
					<th>이동장치</th>
					<td>
						<input type="text" id="transVehicle" name="transVehicle" msg="이동장치" class="form-control" > 
		            </td>
		        </tr>
		        
			</table>
		</div>
		
	
  <div class="tab">
    <ul class="tabnav">
<!--       <li><a href="#tab01">1.제품정보</a></li> -->
<!--       <li><a href="#tab02">2.설비 기본 Check 사양</a></li> -->
      <li><a href="#tab03">1.기본사항+고객요청사항</a></li>
<!--       <li><a href="#tab04">4.세부 Check 사항</a></li> -->
<!--       <li><a href="#tab05">5.사용 부품 Maker</a></li> -->
      <li><a href="#tab06">2.개선 제안 사항</a></li>
      <li><a href="#tab08">3.문제 발생 현황</a></li>
      <li><a href="#tab09">4.첨부파일</a></li>
      <li><a href="#tab10">5.공유 및 결재</a></li>
    </ul>
    
<!-- 	Tab 컨텐츠 -->
    <div class="tabcontent">
      <div id="tab01">
<!-- 		    <div class="tit_contents"> -->
<!-- 		      <h4 class="tit">1.설비 기본정보</h4> -->
<!-- 		    </div> -->
<!-- 				        <div> -->
<!-- 				        	<th class="table_list_tit"> -->
<!-- 							      <h4 class="tit">[ 제품정보 ]</h4> -->
<!-- 							</th> -->
<!-- 				        </div> -->
				        <div  style="width: 50%;">
							<textarea id="ctrtRmk" name="ctrtRmk"  msg="제품 정보(작업포인트)">제품 정보(작업포인트)</textarea>
				        </div>
				        <div id="pfuChanged" style="display: none;">
							<div class="contents" style="margin-bottom: 0px; padding-bottom: 0px;">
							    <!-- 리스트 -->
							    <div class="ax5_grid">
					              <div class="table_list_tit">
					                  <h5 class="tit">설비 기본정보 (변경 현황)</h5>
<!-- 					                  <div class="add_btn_small plus-minus"> -->
<!-- 					                      <a onclick= "insertList('AREA01GridView');" style="width: 90px;" authchk><i class="fas fa-folder-plus"></i> 정보추가</a> -->
<!-- 					                      <a onclick= "deleteList('AREA01GridView')" style="width: 90px;" authchk><i class="fas fa-trash"></i> 선택정보삭제 </a> -->
<!-- 					                  </div> -->
					              </div>
					            </div>
				              <div>
				              	<div data-ax5grid="AREA01-grid" data-ax5grid-config="{}" style="height:780px;" ></div>
				              </div>
						    </div>
				        </div>
      </div><!-- tab01 -->
      
      <div id="tab02">
<!-- 		    <div class="tit_contents"> -->
<!-- 		      <h4 class="tit">2.설비 기본 Check 사양</h4> -->
<!-- 		    </div> -->
		
				<!-- 콘텐츠 -->
				<div class="contents" style="margin-bottom: 0px; padding-bottom: 0px;">
				<!--   리스트 -->
				    <div class="ax5_grid">
		              <div class="table_list_tit">
		                  <h5 class="tit">2.설비 기본 Check 사양</h5>
		                  <div class="add_btn_small plus-minus">
		                      <a onclick= "insertList('AREA02GridView');" style="width: 90px;" authchk><i class="fas fa-folder-plus"></i> 부품추가</a>
		                      <a onclick= "deleteList('AREA02GridView')" style="width: 90px;" authchk><i class="fas fa-trash"></i> 선택부품삭제 </a>
		                  </div>
		              </div>
		              <div>
		              	<div data-ax5grid="AREA02-grid" data-ax5grid-config="{}" style="height:780px;" ></div>
		              </div>
				    </div>
				</div>
		</div>
      
      <div id="tab03">
<!-- 		    <div class="tit_contents"> -->
<!-- 		      <h4 class="tit">3.고객요청사항</h4> -->
<!-- 		    </div> -->
		
		 		<table style="width: 50%; margin: 0 auto;" border="1">
<!-- 		        <colgroup> -->
<!-- 		          <col width="25%"> -->
<!-- 		          <col width="50%"> -->
<!-- 		          <col width="25%"> -->
<!-- 		        </colgroup> -->
		
		        <tr>
		        	<th  colspan="1"  style="background-color: lightsteelblue;">
					      <h4 class="tit">[ 기본사항 ] ※별도기록사항 (ex:부대창치, 고객사 사급품, 연계장비 등)</h4>
					</th>
		        </tr>
		        
		        <tr>
					<td colspan="1"  style="background-color: aqua;">
						<textarea id="pfuEtc" name="pfuEtc"  msg="특기사항">특기사항<br><br><br><br></textarea>
					</td>		
		        </tr>
		
		        <tr>
		        	<th  colspan="1" style="background-color: lightsteelblue;">
					      <h4 class="tit">[ 고객 요청 사항 ]</h4>
					</th>
		        </tr>
		        
		        <tr>
					<td colspan="1" style="background-color: aqua;">
						<textarea id="custReq" name="custReq"  msg="고객 요청 사항">고객 요청 사항<br><br></textarea>
					</td>	
		        </tr>
		
		        <tr>
		        	<th  colspan="1" style="background-color: lightsteelblue;">
					      <h4 class="tit">[ SPARE LIST ]</h4>
					</th>
		        </tr>
		        
		        <tr>
					<td colspan="1"  style="background-color: aqua;">
						<textarea id="spareList" name="spareList"  msg="SPARE LIST">SPARE LIST<br><br></textarea>
					</td>	
		        </tr>
		        
		      </table>
		</div><!-- tab03 -->
      
        <div id="tab04">
<!-- 		    <div class="tit_contents"> -->
<!-- 		      <h4 class="tit">4.세부 Check 사항</h4> -->
<!-- 		    </div> -->
		
				<!-- 콘텐츠 -->
				<div class="contents" style="margin-bottom: 0px; padding-bottom: 0px;">
				    <!-- 리스트 -->
				    <div class="ax5_grid">
		              <div class="table_list_tit">
		                  <h5 class="tit">4.세부 Check 사항</h5>
		                  <div class="add_btn_small plus-minus">
		                      <a onclick= "insertList('AREA04GridView');" style="width: 90px;" authchk><i class="fas fa-folder-plus"></i> 사양추가</a>
		                      <a onclick= "deleteList('AREA04GridView')" style="width: 90px;" authchk><i class="fas fa-trash"></i> 선택사양삭제 </a>
		                  </div>
		              </div>
		              <div>
		              	<div data-ax5grid="AREA04-grid" data-ax5grid-config="{}" style="height:780px;" ></div>
		              </div>
				    </div>
				</div>
        </div><!-- tab04 -->
      
        <div id="tab05">
<!-- 		    <div class="tit_contents"> -->
<!-- 		      <h4 class="tit">5.사용 부품 Maker</h4> -->
<!-- 		    </div> -->
		
				<!-- 콘텐츠 -->
				<div class="contents" style="margin-bottom: 0px; padding-bottom: 0px;">
				    <!-- 리스트 -->
				    <div class="ax5_grid">
		              <div class="table_list_tit">
		                  <h5 class="tit">5.사용 부품 Maker</h5>
		                  <div class="add_btn_small plus-minus">
		                      <a onclick= "insertList('AREA05GridView');" style="width: 90px;" authchk><i class="fas fa-folder-plus"></i> 사양추가</a>
		                      <a onclick= "deleteList('AREA05GridView')" style="width: 90px;" authchk><i class="fas fa-trash"></i> 선택사양삭제 </a>
		                  </div>
		              </div>
		              <div>
		              	<div data-ax5grid="AREA05-grid" data-ax5grid-config="{}" style="height:780px;" ></div>
		              </div>
				    </div>
				</div>
        </div><!-- tab05 -->
      
        <div id="tab06">
<!-- 		    <div class="tit_contents"> -->
<!-- 		      <h4 class="tit">1-1.제품정보-필수정보</h4> -->
<!-- 		    </div> -->
		
				<!-- 콘텐츠 -->
				<div class="contents" style="margin-bottom: 0px; padding-bottom: 0px;">
				    <!-- 리스트 -->
				    <div class="ax5_grid">
		              <div class="table_list_tit">
		                  <h5 class="tit">2.개선 제안 사항</h5>
<!-- 		                  <div class="add_btn_small plus-minus"> -->
<!-- 		                      <a onclick= "insertList('AREA06GridView');" style="width: 90px;" authchk><i class="fas fa-folder-plus"></i> 사양추가</a> -->
<!-- 		                      <a onclick= "deleteList('AREA06GridView')" style="width: 90px;" authchk><i class="fas fa-trash"></i> 선택사양삭제 </a> -->
<!-- 		                  </div> -->
		              </div>
		              <div>
		              	<div data-ax5grid="AREA06-grid" data-ax5grid-config="{}" style="height:780px;" ></div>
		              </div>
				    </div>
				</div>
        </div><!-- tab06 -->
      
        <div id="tab08">
<!-- 		    <div class="tit_contents"> -->
<!-- 		      <h4 class="tit">4.Machine Part-3)구매품 Part</h4> -->
<!-- 		    </div> -->
		
				<!-- 콘텐츠 -->
				<div class="contents" style="margin-bottom: 0px; padding-bottom: 0px;">
				    <!-- 리스트 -->
				    <div class="ax5_grid">
		              <div class="table_list_tit">
		                  <h5 class="tit">3. 문제등록현황</h5>
		              </div>
		              <div>
		              	<div data-ax5grid="AREA08-grid" data-ax5grid-config="{}" style="height:780px;" ></div>
		              </div>
				    </div>
				</div>
        </div><!-- tab08 -->
      
      
	    <div id="tab09">
			    <div class="table_list_tit">
			      <h4 class="tit">※  PFU 첨부파일</h4>
			    </div>
				<!-- 공통 파일 영역 -->
				<div id="fileList_area_CR50" style="margin-top: 1px;"></div>
	    </div><!-- tab09 -->
      
	    <div id="tab10" style="place-items: center;">
                    <table style="border:1px;width: 900px;">
                        <tr style="height:30px;">
                        	<td>
							    <div class="table_list_tit">
							      <h4 class="tit">※ 공유 및 결재</h4>
							    </div>
                            </td>
                        </tr>
                        
                        <tr>
                        	<td>
								<!-- 공유 및 결재 -->
				                 <div class="add_btn_small pdl10 plus-minus" id="plus-minus">
				                     <a onclick="insertShareUserModal1();" style="height: 30px; line-height: 28px;" authchk>+</a>
				                     <a onclick="deleteShareUser1();" class="insDel" style="height: 30px; line-height: 28px;" authchk>-</a>
				                 </div>
				            </td>
                        </tr>
                        <tr>
                        	<td style="align:center;">
				                 <div class="ax5_grid" data-ax5grid="third-grid-modal" data-ax5grid-config="{}" style="whdth:1000px;height: 300px;align:center;" ></div>
				            </td>
                        </tr>
		            </table>
	    </div><!-- tab10 -->
      </div><!--tabcontent-->
  </div><!--tab-->
	</form>
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtn" authChk>등록</button>
		<button type="button" class="close_btn" onclick="modalStack.close();">닫기</button>
		<button type="button" onclick="setReportMain();"><i class="fas fa-envelope"></i> PFU 출력</button>
<!-- 		<button type="button" id="mailSendBtn" onclick="sendMailCall();" authChk><i class="fas fa-envelope"></i> 기타발주서메일</a></button> -->
	</div>

</div>
<script>
	var tabArrInit = {tab01:true, tab02:true, tab03:true, tab04:true, tab05:true, tab06:true, tab07:true, tab08:true, tab09:true, tab10:true};
	var thisGridRow=0; // 선택된 행 정보 저장할 변수
	var thisGridCol=0; // 선택된 열 정보 저장할 변수
	var paramActionType = modalStack.last().paramObj.actionType
// 	var AREA01GridView;  //제품정보
// 	var AREA02GridView;	 //설비기본정보
// 	var AREA04GridView;	 //세부check사항
// 	var AREA05GridView;	 //사용부품
	var AREA06GridView;	 //제품필수정보
	var AREA08GridView;	 //문제등록
	var salesCdGridView;
	var currentTabName = '';
	var pfuDetailChangeFlag = false;	//PFU내용 변경했는제 체크하는 Flag
	var pfuLoadComplete = false;	//PFU조회 완료 확인 Flag --> textarea가 여러개여서 로딩 완료후 수정되는지 확인하기 위함. 수정시 필수 선택옵션이 선택하지 않고 수정 못하게 하기위하여
	
 	// 카톡 정상알림 카운터 변수
    var kakaoCnt = 0;
    var kakaoErr = [];
    
    $('#tab01, #tab02, #tab04, #tab05').hide();
    
	ax5.ui.grid.formatter["changeYn"] = function () {
		var color = this.value == "N" ? "color-circle_02.png" : "color-circle_01.png";
		if (this.value == "E") {
			return 'E';
		} else {
			return '<img src="/static/img/'+color+'" style="width: 10px;height: 10px;"></img>';
		}
	};
	ax5.ui.grid.formatter["bilgYn"] = function () {
// 		var color = (this.value == "ISSSTS03" || this.value == "REQST03" ) ? "color-circle_02.png" : "color-circle_01.png";
//빨강:접수, 회색:문제처리진행중, 녹색:요인별 발주요청 진행중, 파랑:조치완료
		if (this.value == "E") {
			return 'E';
		} else if (this.value == "ISSSTS03" || this.value == "REQST03" ) {
			return '<span style="font-size:11px;color:blue">●</span>';
		} else if (this.value == "ISSSTS01" || this.value == "REQST01" ) {
			return '<span style="font-size:11px;color:red">●</span>';
		} else if (this.value == "ISSSTS02" || this.value == "REQST02" ) {
			if (this.item.reqNo == undefined || this.item.reqNo == "") {
				return '<span style="font-size:11px;color:silver">●</span>';
			} else {
				return '<span style="font-size:11px;color:green">●</span>';
			}
		}
	};

	ax5.ui.grid.formatter["imprvYn"] = function () {
		if (this.value == "E") {
			return 'E';
		} else if (this.value == "IMPRSTS01") {
			return '<span style="font-size:11px;color:red">●</span>';
		} else if (this.value == "IMPRSTS02") {
			return '<span style="font-size:11px;color:silver">●</span>';
		} else if (this.value == "IMPRSTS03") {
			return '<span style="font-size:11px;color:green">●</span>';
		} else if (this.value == "IMPRSTS04") {
			return '<span style="font-size:11px;color:blue">●</span>';
		} else if (this.value == "IMPRSTS09") {
			return '<span style="font-size:11px;color:blue">●</span>';
		}
	};
	function gridStyle(row) {
		if (!row) return "";
// 		if (row.item.indChk === "D")  return "grid-cell-orange";
		if (row.column.editor != undefined) {
			if (row.item.changeYn == 'Y' && (row.key == 'partNm' || row.key == 'partStd' || row.key == 'partEtc')) {
				if (row.item.indChk == "D") {
					 return "grid-font-red";
				} else { 
					return "grid-cell-orange";   //grid-cell-blue";
				}
			}
		}
		if (row.item.indChk === "D")  return "grid-font-red";
// 		if (row.matrError === "E")  return "grid-no-msg-font-blue-bold";
// 		if (pasFloatChk(row.item.lowerQty) == 0)  return "grid-no-msg-font-blue-bold";
// 		if (pasFloatChk(row.item.pchsBomCnt) > 0)  return "grid-font-red";
		return "";
	}


	var gridColumnsalesCd =
		[
// 			{key : "chkSaveCd" ,	  label : "선택여부",		align: "center",	width: 60, align: "center", formatter: function () { return this.value =="Y" ? "대상":""; }},
			{key : "salesCd", 		  label : "Sales Code",   align : "left", 	width : 110},
			{key : "mctypeNm", 		  label : "구분",        align : "left", width : 45},
			{key : "ordrsDtlDiv20Nm", label : "신작구분",      align : "center", width : 45},
			{key : "prdtGrpNm", 	  label : "제품유형",        align : "left", width : 130},
			{key : "itemDivNm", 	  label : "아이템",    align : "left", width: 120},
			{key : "eqpNm", 		  label : "설비명",        align : "left", width : "*" },
			{key : "orgnSalesCd", 	  label : "원 Sales Code", align : "left", width : 140, hidden : true},
			{key : "ordrsCoCd", 	  label : "회사",          hidden : true},
			{key : "ordrsCoCdNm", 	  label : "회사명",        align : "center", 	width : 80, hidden : true},
			{key : "ordrsNo", 		  label : "수주번호",      align : "center", 	width : 60, hidden : true},
			{key : "clntPjtNm", 	  label : "프로젝트",    	align : "center", width : 80, hidden : true},
			{key : "ordrsClntCd", 	  label : "고객사",        hidden : true},
			{key : "ordrsClntNm", 	  label : "고객사명",      align : "left", width : 100, hidden : true},
			{key : "clntPjt", 		  label : "고객사 PJT",    align : "center", width : 100, hidden : true},
			{key : "ordrsDtlDiv20",   label : "신작구분",      hidden : true},
			{key : "prdtCd", 		  label : "제품구분",      hidden : true},
			{key : "creatId", 		  label : "user",    align : "center", width: 80, hidden : true},
			{key : "creatPgm", 		  label : "pgm",    align : "center", width: 80, hidden : true},
			{key : "creatDttm", 	  label : "date",    align : "center", width: 100, hidden : true},
			{key : "udtId", 		  label : "user",    align : "center", width: 80, hidden : true},
			{key : "udtPgm", 		  label : "pgm",    align : "center", width: 80, hidden : true},
			{key : "udtDttm", 	  label : "date",    align : "center", width: 100, hidden : true},
		];
	
	var gridColumn01 =
		[
	        {key : "areaDivNm", label : "설비영역", 			width : 100,	align: "left",  styleClass: function () { return gridStyle(this); } }, 
	        {key : "strChkNm", 	label : "표준PFU", 			width : 60,		align: "center", formatter: function() { return this.item.stdChk === "Y" ? "표준" : "ADD";}, styleClass: function () { return gridStyle(this); } }, 
	        {key : "indChkNm", 	label : "수정/삭제", 			width : 60,		align: "center", formatter: function() { if (this.item.indChk === "U") { return "수정"; } else if (this.item.indChk === "D") { return "삭제"; } }, styleClass: function () { return gridStyle(this); } },  
			{key : "partNm", 	label : "설비구분", 			width : 160,	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.changeYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "partStd", 	label : "건양표준", 			width : 300, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.changeYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "partEtc", 	label : "옵션사항", 			width : 300, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.changeYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "partCust", 	label : "고객요청", 			width : 200, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.finalYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px; overflow-y: auto;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "partConf", 	label : "확정", 				width : 200, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.finalYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px; overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "creatIdNm", label : "등록담당", 			width : 60,	 hidden: false, styleClass: function () { return gridStyle(this); }, 	editor: { type: "text", disabled: function () { return this.item.changeYn == "Y"; } },},
			{key : "creatDttm", label : "등록일시", 			width : 90,  hidden: false, styleClass: function () { return gridStyle(this); }},
			{key : "udtIdNm", 	label : "수정담당", 			width : 60,	 hidden: false, styleClass: function () { return gridStyle(this); }},
			{key : "udtDttm", 	label : "수정일시", 			width : 90,  hidden: false, styleClass: function () { return gridStyle(this); }},
			{key : "changeYn", 	label : "표준", 				width : 80,  hidden: true, 	editor: { type: "text"} },
			{key : "finalYn", 	label : "수정", 				width : 80,  hidden: true, 	editor: { type: "text"} },
	        {key : "updChk", 	label : "updChk", 			width : 80,  hidden: true},
	        {key : "prdtDiv", 	label : "제품분류", 			width : 80,  hidden: true},
	        {key : "PfuPrdtDiv",label : "PFU제품분류", 		width : 80,  hidden: true},
	        {key : "areaDiv", 	label : "영역구분", 			width : 80,  hidden: true},
	        {key : "partDiv", 	label : "PART구분", 			width : 80,  hidden: true},
	        {key : "partId", 	label : "코드ID", 			width : 100, hidden: true},
	        {key : "partId", 	label : "코드ID", 			width : 100, hidden: true},
			{key : "stdChk", 	label : "stdChk", 			width : 80,	 hidden: true},
			{key : "indChk", 	label : "indChk", 			width : 80,	 hidden: true},
			{key : "orgPartId", label : "orgPartId", 		width : 80,	 hidden: true},
			{key : "creatId", 	label : "등록담당", 			width : 80,	 hidden: true},
			{key : "creatPgm", 	label : "creatPgm", 		width : 80,	 hidden: true},
			{key : "udtId", 	label : "수정담당", 			width : 80,	 hidden: true},
			{key : "udtPgm", 	label : "udtPgm", 			width : 80,	 hidden: true},
			{key : "orginData", label : "orginData", 		width : 80,	 hidden: true},
		];
	
	var gridColumn03 =
		[
	        {key : "areaDivNm", label : "설비영역", 			width : 180,	align: "left",  styleClass: function () { return gridStyle(this); } }, 
	        {key : "strChkNm", 	label : "표준PFU", 			width : 60,		align: "center", formatter: function() { return this.item.stdChk === "Y" ? "표준" : "ADD";}, styleClass: function () { return gridStyle(this); } }, 
	        {key : "indChkNm", 	label : "수정/삭제", 			width : 60,		align: "center", formatter: function() { if (this.item.indChk === "U") { return "수정"; } else if (this.item.indChk === "D") { return "삭제"; } }, styleClass: function () { return gridStyle(this); } },  
			{key : "partNm", 	label : "설비구분", 			width : 500,	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.changeYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
// 			{key : "partStd", 	label : "건양표준", 			width : 300, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.changeYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
// 				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
// 			{key : "partEtc", 	label : "옵션사항", 			width : 300, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.changeYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
// 				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
// 			{key : "partCust", 	label : "고객요청", 			width : 200, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.finalYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
// 				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px; overflow-y: auto;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "partConf", 	label : "확정", 				width : 500, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.finalYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px; overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "creatIdNm", label : "등록담당", 			width : 60,	 hidden: false, styleClass: function () { return gridStyle(this); }, 	editor: { type: "text", disabled: function () { return this.item.changeYn == "Y"; } },},
			{key : "creatDttm", label : "등록일시", 			width : 90,  hidden: false, styleClass: function () { return gridStyle(this); }},
			{key : "udtIdNm", 	label : "수정담당", 			width : 60,	 hidden: false, styleClass: function () { return gridStyle(this); }},
			{key : "udtDttm", 	label : "수정일시", 			width : 90,  hidden: false, styleClass: function () { return gridStyle(this); }},
			{key : "changeYn", 	label : "표준", 				width : 80,  hidden: true, 	editor: { type: "text"} },
			{key : "finalYn", 	label : "수정", 				width : 80,  hidden: true, 	editor: { type: "text"} },
	        {key : "updChk", 	label : "updChk", 			width : 80,  hidden: true},
	        {key : "prdtDiv", 	label : "제품분류", 			width : 80,  hidden: true},
	        {key : "PfuPrdtDiv",label : "PFU제품분류", 		width : 80,  hidden: true},
	        {key : "areaDiv", 	label : "영역구분", 			width : 80,  hidden: true},
	        {key : "partDiv", 	label : "PART구분", 			width : 80,  hidden: true},
	        {key : "partId", 	label : "코드ID", 			width : 100, hidden: true},
	        {key : "partId", 	label : "코드ID", 			width : 100, hidden: true},
			{key : "stdChk", 	label : "stdChk", 			width : 80,	 hidden: true},
			{key : "indChk", 	label : "indChk", 			width : 80,	 hidden: true},
			{key : "orgPartId", label : "orgPartId", 		width : 80,	 hidden: true},
			{key : "creatId", 	label : "등록담당", 			width : 80,	 hidden: true},
			{key : "creatPgm", 	label : "creatPgm", 		width : 80,	 hidden: true},
			{key : "udtId", 	label : "수정담당", 			width : 80,	 hidden: true},
			{key : "udtPgm", 	label : "udtPgm", 			width : 80,	 hidden: true},
			{key : "orginData", label : "orginData", 		width : 80,	 hidden: true},
		];

	var gridColumn02 = 
		[
	        {key : "strChkNm", 	label : "표준PFU", 			width : 60,		align: "center", formatter: function() { return this.item.stdChk === "Y" ? "표준" : "ADD";}, styleClass: function () { return gridStyle(this); } }, 
	        {key : "indChkNm", 	label : "수정/삭제", 			width : 60,		align: "center", formatter: function() { if (this.item.indChk === "U") { return "수정"; } else if (this.item.indChk === "D") { return "삭제"; } }, styleClass: function () { return gridStyle(this); } }, 
			{key : "partNm", 	label : "설비구분", 			width : 160,	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.changeYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "partStd", 	label : "건양표준", 			width : 300, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.changeYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "partEtc", 	label : "옵션사항", 			width : 300, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.changeYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "partCust", 	label : "고객요청", 			width : 200, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.finalYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px; overflow-y: auto;  overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "partConf", 	label : "확정", 				width : 200, 	align: "left", 	editor: { type: "textarea", disabled: function () { return this.item.finalYn == "Y"; } }, styleClass: function () { return gridStyle(this); },  
				formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; height: 40px; overflow-y: auto; overflow-x: hidden;">'+this.value+'</span>' : '' }},
			{key : "creatIdNm", label : "등록담당", 			width : 60,	 hidden: false, styleClass: function () { return gridStyle(this); }, 	editor: { type: "text", disabled: function () { return this.item.changeYn == "Y"; } },},
			{key : "creatDttm", label : "등록일시", 			width : 90,  hidden: false, styleClass: function () { return gridStyle(this); }},
			{key : "udtIdNm", 	label : "수정담당", 			width : 60,	 hidden: false, styleClass: function () { return gridStyle(this); }},
			{key : "udtDttm", 	label : "수정일시", 			width : 90,  hidden: false, styleClass: function () { return gridStyle(this); }},
			{key : "changeYn", 	label : "표준", 				width : 80,  hidden: true, 	editor: { type: "text"} },
			{key : "finalYn", 	label : "수정", 				width : 80,  hidden: true, 	editor: { type: "text"} },
	        {key : "updChk", 	label : "updChk", 			width : 80,  hidden: true},
	        {key : "prdtDiv", 	label : "제품분류", 			width : 80,  hidden: true},
	        {key : "PfuPrdtDiv",label : "PFU제품분류", 		width : 80,  hidden: true},
	        {key : "areaDiv", 	label : "영역구분", 			width : 80,  hidden: true},
	        {key : "partDiv", 	label : "PART구분", 			width : 80,  hidden: true},
	        {key : "partId", 	label : "코드ID", 			width : 100, hidden: true},
	        {key : "partId", 	label : "코드ID", 			width : 100, hidden: true},
			{key : "stdChk", 	label : "stdChk", 			width : 80,	 hidden: true},
			{key : "indChk", 	label : "indChk", 			width : 80,	 hidden: true},
			{key : "orgPartId", label : "orgPartId", 		width : 80,	 hidden: true},
			{key : "creatId", 	label : "등록담당", 			width : 80,	 hidden: true},
			{key : "creatPgm", 	label : "creatPgm", 		width : 80,	 hidden: true},
			{key : "udtId", 	label : "수정담당", 			width : 80,	 hidden: true},
			{key : "udtPgm", 	label : "udtPgm", 			width : 80,	 hidden: true},
			{key : "orginData", label : "orginData", 		width : 80,	 hidden: true},
		];


	var gridColumn06 =  [
		 {key: "imprvmDt", 		label: "제안일자", 		width: 75,		align: "center"}
			,{key: "imprvmIdNm", 	label: "제안자", 			width: 60,		align: "center"}
			,{key: "imprvmTypeNm", 	label: "분류", 			width: 100,		align: "left"}
			,{key: "imprvmStsCd", 	label: "상태", 			width: 50,		align: "center", formatter: "imprvYn"}
	        , {key: undefined, label: "제안 내용", columns: [
				 {key: "salesCd", 		label: "SalesCd", 		width: 120,		align: "center"}
				,{key: "unitNo", 		label: "제안장비", 		width: 160,		align: "left"}
				,{key: "imprvmTxt", 	label: "내용", 			width: 300,		align: "left",
					formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; max-height: 92px; overflow: hidden;">'+this.value+'</span>' : '' }}
			]}
	        ,{key: undefined, label: "검토부서 초치 현황", columns: [
				 {key: "execActDeptNm", label: "검토부서", 		width: 80,		align: "center"}
				,{key: "execActTxt", 	label: "검토결과", 		width: 300,		align: "left",
					formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; max-height: 92px; overflow: hidden;">'+this.value+'</span>' : '' }}
			]}
	        ,{key: undefined, label: "평가", columns: [
				 {key: "imprvmApprGrade",label: "등급", 			width: 50,		align: "center"}
				,{key: "imprvmApprPoint",label: "점수", 			width: 50,		align: "center"}
				,{key: "imprvmApprTxt", label: "의견", 			width: 240,		align: "center",
					formatter: function () { return (this.value) ? '<span style="display: block; white-space: pre; max-height: 92px; overflow: hidden;">'+this.value+'</span>' : '' }}
			]}	
	        ,{key: undefined, label: "분류", columns: [
				{key: "mcPartCdNm", 	label: "기계분류", 		width: 70,		align: "center"}
				,{key: "importantCdNm",	label: "중요도", 			width: 60,		align: "center"}
				,{key: "impactCdNm", 	label: "영향도", 			width: 90,		align: "center"}
			]}
			,{key: "imprvmApprDttm", label: "평가일자", 		width: 80,		align: "center"}
			,{key: "imprvmNo", 		label: "제안번호", 		width: 80,		align: "center", 	hidden: false}
	];
	

	var gridColumn08 =  [
		 {key: "fileTrgtKey",	label: "파일대상KEY",		width: 50,		align: "center", 	hidden:true}
		,{key: "coCd",	    	label: "회사코드",			width: 100,		align: "center", 	hidden:true}
		,{key: "workRptId",	    label: "작성자ID",		width: 100,		align: "center", 	hidden:true}
		,{key: "coNm",	    	label: "회사",			width: 70,		align: "center", 	hidden:true}
		,{key: "workRptLNm", 	label: "대분류", 			width: 140,		align: "left", 	hidden:true}
		,{key: "workRptDt", 	label: "발생일자", 		width: 80,		align: "center"}
		,{key: "workRptDeptNm",	label: "작성부서",			width: 80,		align: "left"}
		,{key: "workRptIdNm",	label: "작성자",			width: 55,		align: "center", 	hidden:true}
		,{key: "actDeptNm",		label: "조치부서",			width: 80,		align: "left"}
		,{key: "actIdNm",		label: "조치자",			width: 55,		align: "center"}
		,{key: "issDivNm",		label: "유형",			width: 60,		align: "center"}
		,{key: "subCdNm", 		label: "등록사유", 		width: 100,		align: "left"}
		,{key: "reqNo", 		label: "발주요청", 		width: 90,		align: "center", 	hidden:false}
		,{key: "issSts", 	    label: "상태", 			width: 50,		align: "center", formatter: "bilgYn"}
		,{key: "issStsNm", 	    label: "상태", 			width: 50,		align: "center", 	hidden:true}
		,{key: "acteDt", 		label: "완료일자", 		width: 80,		align: "center"}
		,{key: "prdtDivNm", 	label: "제품군", 			width: 130,		align: "left", 	hidden:true}
		,{key: "clntNm", 		label: "고객사", 			width: 120,		align: "left", 	hidden:true}
		,{key: "clntPjtNm",		label: "고객사PJT", 		width: 80,		align: "left", 	hidden:true}
		,{key: "salesCd", 		label: "Sales Code", 	width: 110,		align: "left", 	hidden:false}
		,{key: "issueTitle",  	label: "문제제목",			width: 250,		align: "left",      styleClass: function () {
			return (this.item.issSts != "ISSSTS03" && this.item.issSts != "REQST03") ? "grid-font-red" : "";},}
		,{key: "workRptRmk", 	label: "내용", 			width: 350,		align: "left"}
		,{key: "eqpNm", 		label: "설비명", 			width: 160,		align: "left"}
		,{key: "actMh", 		label: "투입공수", 		width: 70,		align: "center", formatter: "money"}
		,{key: "reqAmt", 		label: "투입비용", 		width: 70,		align: "right", formatter: "money"}
//		,{key: "actDngNm", 		label: "담당평가위험", 		width: 80,		align: "center"}
//		,{key: "actDngEvalNm", 	label: "팀장평가위험", 		width: 80,		align: "center"}
//		,{key: "actAmtStsNm", 	label: "비용유형", 		width: 80,		align: "center"}
// 		,{key: "jobDiv", 		label: "발생업무", 		width: 70,		align: "center"}
// 		,{key: "ordrsNo", 		label: "수주번호", 		width: 70,		align: "center", 	hidden:true}
//		,{key: "prdtCd", 		label: "제품", 			width: 60,		align: "center", 	hidden:true}
// 		,{key: "prdtCdNm", 		label: "제품구분", 		width: 150,		align: "left", 	hidden:true}
// 		,{key: "itemDivNm", 	label: "아이템구분", 		width: 150,		align: "left", 	hidden:true}
		,{key: "workRptNo", 	label: "문제등록번호", 		width: 90,		align: "center"}
	];
	
	function createGridView(gridName, gridTarget, gridColumn, prdtDiv, areaDiv, header, columnHeight) {
	    return {
	        initView: function() {
	            this.target = new ax5.ui.grid();
	            this.target.setConfig({
	            	rowHeight: 'auto', // 자동 높이 조정
	                showLineNumber    : true,
	                showRowSelector   : false,
	                multipleSelect    : false,
	                sortable: true,
	                target: $(gridTarget),
	                header: {
	                    align: "center",
	                    selector: true,
	                    columnHeight: header // 헤더의 높이를 0으로 설정하여 숨김
	                },
	                body: {
	                    onClick: function (columnIndex, rowData) {
	                        this.self.clearSelect();
	                        this.self.select(this.dindex);
	                        thisGridRow = this.dindex;   // 선택된 행 정보 가져오기
	                        thisGridCol = this.colIndex; // 선택된 열 정보 가져오기
	                    },
	                    onDBLClick: function () {
	                        this.self.clearSelect();
	                        this.self.select(this.dindex);
	                        
	                        if (gridName == "AREA08GridView") {
	                			
		 						  if (this.column.key == "reqNo" ){    //reqNo = 발주요청번호 필드 선택시
									  if (this.item.issSts == 'ISSSTS03') {	//문제에서 완료처리된것
										  wbsIssModal(this.item);			//이슈조회요청서 조회
									  } else if (!this.item.acteDt) {	//문제에서 완료처리된것
									  	  insertQualityReqModal(); 	//발주요청서 수정으로 진입
									  } else {
											   insertQualityResultModal(this.item);
									  }
								  } else if (this.column.key == "acteDt" ){    //acteDt = 완료일자
									   if (!this.item.reqNo) {
											wbsIssModal(this.item);			//이슈수정모드
										   return false;	//발주요청 조치결과 번호가 없으면 패스함.
									   } else if (this.item.sameTimeResult == 'Y'){
										   insertQualityReqModal();
									   } else {
										   insertQualityResultModal(this.item);
									   }
								  } else{
										 wbsIssModal(this.item);			//이슈수정모드
								  }
	                        } else if (gridName == "AREA06GridView") { //개선제안 관리
								insertImprovementModal(this.item, 1, 'U');
	                        }

	                    },
	                    onDataChanged: function (e, i) {
	                    	if (gridName == "AREA08GridView" || gridName == "AREA06GridView") return false; //개선제안 및 문제관리는 편집대상이 아님.
	                    	if (prdtOptionSelectCheck()) {
		                    	const newData = `${this.item.partNm || ''}${this.item.partStd || ''}${this.item.partCust || ''}${this.item.partConf || ''}${this.item.partEtc || ''}${this.item.stdChk || ''}${this.item.indChk || ''}${this.item.orgPartId || ''}`;
		                    	if (this.item.originData != newData) {
			                    	if (this.item.updChk != "I") { 
			                    		this.item.updChk = "U";
			                    		this.item.indChk = "U";
			                    		window[gridName].target.repaint();
			                    		pfuDetailChangeFlag = true; //PFU내용 변경했는제 체크하는 Flag
			                    	}
		                    	}
	                    	}
	                    },
	                    columnHeight: columnHeight,
	                },
					page : {
						height : 25,
						display : true,
						},
	                columns :  gridColumn,
	                contextMenu: {
	                    iconWidth: 20,
	                    acceleratorWidth: 100,
	                    itemClickAndClose: false,
	                    icons: {
	                        'arrow': '<i class="fa fa-caret-right"></i>'
	                    },
	                    items: [
	                        {type: 1, label: "붙여넣기"},
	                        {divide: true},
	                        {type: 2, label: "줄추가"},
	                        // {type: 3, label: "내용 삭제"},
	                        {type: 4, label: "줄삭제"},
	                    ],
	                    popupFilter: function (item, param) {
	                        if(param.element) {
	                            return true;
	                        } else {
	                            return item.type == 1;
	                        }
	                    },
	                    onClick: function (item, param) {
	                        thisGridRow = param.dindex;
	                        thisGridCol = param.colIndex;
	                        
	                        if (item.label == "붙여넣기") {
	                            gridPaste(gridName, thisGridRow, thisGridCol);
	                        } else if (item.label == "줄추가") {
// 	                            let tempRow = JSON.parse(JSON.stringify(window[gridName].target.list[param.dindex]));
// 	                            tempRow.updChk = "I";	//추가 등록 자료임.
// 	                            tempRow.indChk = "I";	//추가 등록 자료임.
// 	                            tempRow.stdChk = "N";	//추가시 표준  PFU항목 아님
// 	                            tempRow.orginData = "";	//추가시 표준  PFU항목 아님
// 	                            tempRow.orgPartId = "";	//원본 코드는 clear 처리
// 	                            window[gridName].target.addRow(tempRow, param.dindex+1);
	                            insertList(gridName, true, param.dindex+1)
	                        } else if (item.label == "줄삭제") {
	                        	window[gridName].target.clearSelect();
	                        	window[gridName].target.select(param.dindex);
// 	                            console.log( $('#'+currentTabName.replace('#', '')+' div[data-ax5grid-page="status"] span').text().match(/(\d+)/)[0]);	
								//마지막 수정위치의 Row Position 유지를 위한 변수 저장
	                            const currTopPosition = $('#'+currentTabName.replace('#', '')+' div[data-ax5grid-page="status"] span').text().match(/(\d+)/)[0] - 1;
	                            const currRowPosition = $('#'+currentTabName.replace('#', '')+' div[data-ax5grid-page="status"] span').text().match(/-\s*(\d+)\s*of/)[1];
	                            deleteList(gridName);
	                            
	                            //마지막 저장위치로 이동하기 위함 그리드의  Top Row로 이동후 해당Row에 포커스를 이동 함.
	                            window[gridName].target.focus(currTopPosition);
	                            window[gridName].target.focus(param.dindex);	//마지막 수정한 위치로 이동하기 위함
	                        }
	                        window[gridName].target.contextMenu.close();
	                    }
	                },
	            });
	            return this;
	        },
	        setData: function(chk) {
	            var target = this.target;

	    		let tempPfuPrdtDiv 	= $('#prdtDiv option:selected').data('rprc'); 	//PFU 유형을 가져옴 PFU02, PFU03...
	    		let tempType 		= $('#prdtTyp option:selected').data('rprc');	//PFU Type 코드 PFU0301, PFU0302...
	    		let tempEtc			= $('#prdtTyp option:selected').data('etc');	//data-etc 값이 N인경우 표준PFU 없음 기본 PFU PFU00을 가져오기
	    		let tempClntCd		= $('#prdtCav').val();
	    		
	    		tempType = '0'; //default는 0 임
	    		tempClntCd = '0';
	    		
	            var formData = {
	                "userId" 	: jwt.userId,
	                "clntCd" 	: tempClntCd, 			//default = 0
	                "ordrsNo" 	: $("#ordrsNo").val(),
	                "salesCd" 	: $("#salesCd").val(),
	                "pfuPrdtDiv": tempPfuPrdtDiv,
	                "prdtTyp" 	: tempType,
	                "areaDiv" 	: areaDiv,
	                "fileTrgtKey" : $("#fileTrgtKey").val(),	//PFU번호를 저장함.
	            }
	    		
	            //PFU등록 작업이면 선택 Option의 PFU가 없은 전체 표준PFU를 불러오게 함
	            if (paramActionType=="C") {
	            	//해당Option의 PFU가 등록되어 있는지 확인하기~~~ 등록된 내역이 없으면 표준PFU로 설정합니다.
	            	postAjaxSync("/user/cr/cr50/selectPfuIsThereListCount", formData, null, function(data) {
	            		if (data.resultList == 0) {
	            			formData.pfuPrdtDiv = 'PFU00';
	            			formData.prdtTyp = '0';
	            			formData.clntCd = '0';
	            		}
	            	});
	            } 
	            let callAjax = "";
	            //(areaDiv == 'PFUAREA01') --> 첫번째 그리드에는 해당 PFU의 변동내역 전체 보여줌
	            if (gridName === 'AREA01GridView') {
	                callAjax = "/user/cr/cr50/selectPFUChangedList";
	                
	            } else if (gridName === 'AREA06GridView') {
	                //개선제안서 내역 조회 처리용
	                formData.coCd =  $("#coCd").val();
	                formData.pfuNo = $("#fileTrgtKey").val();
	            	callAjax = "/user/cr/cr50/selectImprovementReferenceList";
	                
	            } else if (gridName === 'AREA08GridView') {
	                //문제관리 내역 조회 처리용
	                let rows = salesCdGridView.target.list;
	                if (rows.length == 0) return false;
	                
	                formData.coCd =  $("#coCd").val();
	                formData.salesCd = $("#fromSalesCd").val();
	            	callAjax = "/user/cr/cr50/selectIssueReferenceList";
	                
	            } else if (gridName === 'salesCdGridView') {
	            	if (paramActionType === "C") { //PFU 신규 등록시 이전화면에서 가져온 SalesCD 자동 등록처리함
	            		callAjax =  "/user/cr/cr50/selectTagetSalesCodeList";
	            		formData.coCd = modalStack.last().paramObj.coCd;
	            		formData.ordrsNo = modalStack.last().paramObj.ordrsNo;
	            		formData.salesCd = modalStack.last().paramObj.salesCd;
	            		formData.pfuNo = 0;
	            	} else {
	            		callAjax=  "/user/cr/cr50/selectPfuInfoSalesCdList";
	            	}
	                
	            } else {
	                callAjax = paramActionType === "C" 
	                    ? "/user/cr/cr50/selectPFUAreaItemList" 
	                    : "/user/cr/cr50/selectPFUAreaRetriveList";
	            }
	            postAjax(callAjax, formData, null, function(data) {
					try {
						var list = data.result;
						if (gridName != 'AREA08GridView') {
							list = $.map(list, function(obj) {
								obj.originData = `${obj.partNm || ''}${obj.partStd || ''}${obj.partCust || ''}${obj.partConf || ''}${obj.partEtc || ''}${obj.stdChk || ''}${obj.indChk || ''}${obj.orgPartId || ''}`;
								return obj;
							});
						}
						target.setData({
							list : list,
							page : {
								totalElements : list.length
							}
						});
						
	// 	                if (gridName === 'salesCdGridView') {
	// 	                	AREA08GridView.setData();
	// 	                }
						//변경된 사양이 있으면 Tab01 에있는 그리드 화면에서 보이기
						if (gridName === 'AREA01GridView') {
							if (AREA01GridView.target.list.length > 0 ) {
								$('#pfuChanged').css('display', 'block');
				// 	        	$('a[href="#tab01"]').trigger('click');
								AREA01GridView.target.setData(AREA01GridView.target.list);
								//최소 150, 최대 790 ==한줄일때
								let tempHeight = 840 - (AREA01GridView.target.list.length * 50);
								if (tempHeight > 840) tempHeight = 840;
								if (tempHeight < 100) tempHeight = 100;
								gridHeightResize(AREA01GridView, tempHeight); //  화면 Body 높이
							}
						}
					} catch (error) {
						alert("오류 발생!! 전산실 연락 바랍니다", error.message);
						return null; // 오류 발생 시 null 반환
					} finally {
						// console.log("함수 실행 완료.");
					}
	            });
	        }
	    };
	}
	
    
    //공유 결재 그리드
 	var gridViewPop7 = {
		initView : function() {
  			this.target = new ax5.ui.grid();
  			this.target.setConfig({
  		    	showRowSelector: true,
  		    	multipleSelect: false,
  		    	sortable: false,
  		        target: $('[data-ax5grid="third-grid-modal"]'),
  		        header: {
  		        	align: "center",
  		        	selector: true
  		        },
  		        body: {
  		        	 onClick: function () {
  		                this.self.select(this.dindex);
  		            },
  		            onDBLClick: function () {
  		            },
					mergeCells : ["gb"],
  		        },
				page : {
					navigationItemCount : 10,
					height : 25,
					display : true,
					firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
					prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
					nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
					lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
					onChange : function() {
						gridView7.setData(this.page.selectPage);
					}
				},
		    	columns : [
		    		{key: "gb",      			label: "구분",      	align: "center",   width: 40},
			    	{key: "sanctnSn", 			label: "순번", 		align: "center",   width: 50},
			    	{key: "coCd",      			label: "coCd",		align: "center",   width: 50, hidden: true},
                    {key: "wbsPlancoCdNm",      label: "회사명",      align: "center",   width: 130, hidden: true},
                    //{key: "wbsSharngUserId",	label: "ID",      	align: "center",   width: 130, hidden: false},
                    {key: "usrNm",				label: "ID",      	align: "center",   width: 130, hidden: true},
                    {key: "empNo",      		label: "사원번호", 	align: "center",   width: 130, hidden: true},
                    {key: "name",       		label: "성명",      	align: "center",   width: 80},
                    {key: "jik",       			label: "직위",      	align: "center",   width: 60},
                    {key: "creatDttm",      	label: "요청일자", 	align: "center",   width: 90},
                    {key: "todoCfDt",      		label: "확인일자",		align: "center",   width: 130},
                    {key: "todoCfOpn",      	label: "확인의견", 	align: "left",     width: 200},
                    {key: "telNo",      		label: "H.P",		align: "center",   width: 130},
                    {key: "todoKey",      		label: "todoKey",		align: "center",   width: 130, hidden: true},
                    {key: "sanctnSttus",      	label: "sanctnSttus",		align: "center",   width: 130, hidden: true},                   
                    {key: "todoId",      		label: "todoId",		align: "center",   width: 130, hidden: true},
                    {key: "flag",      			label: "flag",		align: "center",   width: 130, hidden: true}
    	              ]
					});
        			return this;
        		},

        		setData : function(_pageNo) {
        			let fileTrgtKey = $("#fileTrgtKey").val();
        			if (!fileTrgtKey) return false;
        			
                    var targetObj = this.target;
                    var formData = {
                        "fileTrgtKey" 	: fileTrgtKey,
                        "reqNo" 		: fileTrgtKey,
                        "etcField2" 	: $("#verNo").val(),
                        "pageNo" 		: _pageNo + 1
                    }
                    postAjax("/user/wb/wb20/selectSignResUserlst", formData, null, function(data){
						try {
							
							var list = data.result;
							if( list.length > 0 ) {
								var inCnt = 0;
								var inGb = 0; //해당 결재개수 변수
								let processChk = false;	//결재 진행여부 체크 (결재가 하나라도  진행되면 true)
								$.each(list, function (idx, elem) {
									if (elem.gb == "결재") {	//결재와 공유 중 결재 갯수 파악
										if (elem.sanctnSttus == "Y") processChk = true;
									
										inGb++;
										if( elem.sanctnSttus == "Y" ) inCnt++;
									}
								})
								
								//PFU 결재올렸을때 ver.up 버튼 하이드 처리
								if (processChk && (inCnt == inGb)){	//결재자가있고 결재가 완료되면 버젼업버튼 활성화 및 수정버튼 숨김
									$('#createHistory').show();
									$('#actionBtn').hide();
									$('.plus-minus').hide();
								} else if (list.length == 0 || inCnt == 0){	//결재자가 없으면 버젼업 버튼 숨김
									//아무도 결재가 이뤄지지 않았을 경우의 조건
									$('#createHistory').hide();
								} else {								//결재 진행중이면 버젼업, 수정 버튼 숨김처리
									$('#createHistory').hide();
									$('#actionBtn').hide();
									$('.plus-minus').hide();
								}
							}
							targetObj.setData({
								list : list,
								page : {
									totalElements : list.length
								}
							});
						} catch (error) {
							alert("오류 발생!! 전산실 연락 바랍니다", error.message);
							return null; // 오류 발생 시 null 반환
						} finally {
							// console.log("함수 실행 완료.");
						}
                    });
                },

        		setData2 : function(_list) {
        			this.target.setData({
   	  						list : _list,
	   	  					page : {
				                    	totalElements :  _list.length,
						    } 
   	  					});
          		}
                ,
                setData3 : function(_pageNo) {
                   var targetObj = this.target;
                   var paramObj = { "userId": jwt.userId
                               , "appDiv": 'APPDIV10'		//수주원가관리 결재라인
                   };
                    postAjax("/user/wb/wb20/selectSignResUserlstInit", paramObj, null, function(data){
						try {
							var list = data.result;
							targetObj.setData({
									list : list,
									page : { totalElements : list.length } 
							});
						} catch (error) {
							alert("오류 발생!! 전산실 연락 바랍니다", error.message);
							return null; // 오류 발생 시 null 반환
						} finally {
							// console.log("함수 실행 완료.");
						}
					});
                  }
  	}
	
    //PFU수정하기전에 필수 Option 설정 확인하기
    function prdtOptionSelectCheck () {

    	//1. 제품군 제품군을 선택하면 data-rprc에 PFU유형 선택됨
    	//2. 장비Type은 제품군을 선택하면 data-rprc의 PFU유형에 따라 선택Option 생성됨
    	//3. PFU유형에 다라 작동방식이 필수인 경우 작동방식 선택하였는지 체크 
    	if (paramActionType=="C") {

    		if (salesCdGridView.target.list.length == 0) {
    			alert("PFU작업대상 SalesCd를 먼전 선택하고 작업하시기 바랍니다.");
    			return false;
    		}
    		
	    	if ($('#prdtTyp').val()=="0" ) {	//장비Type을 세부 선택하지 않은 상태임
				alert("장비Type을 선택하고 PFU 수정하시기 바랍니다.");
	    		return false;
	    	} 
			let tempType = $('#prdtTyp option:selected').data('rprc');
	    	if (tempType != "" && $('#prdtCav').val() == "PFUCAV00") {	//PFUCAV일경우 작동방식에 따라 PFU가 달라짐
				alert("작동방식을 선택하고 PFU 수정하시기 바랍니다.");
	    		return false;
	    	}
    	
    		//PFU 사양에 해당하는 조건은 변경 금지처리
			//화면 수정 금지 필드 지정 (disabled로 처리하면 FormData에 해당필드값 저장안됨)
// 			$('a:has(i.i_search_w):not(#ordrsNo)').remove();	//<i class="i_search_w"></i> 태그를 포함하고 있는 A태그 삭제

			$('select').addClass('field_disabled');
			$('#salesCd, #ctrtNm, #mngIdNm').addClass('field_disabled');
    	}
    	return true;
    }
	
    $(document).ready(function () {
    	$('#fileTrgtKey').val(modalStack.last().paramObj.fileTrgtKey);
    	$('#salesCd').val(modalStack.last().paramObj.salesCd)
    	$('#verNo').val(modalStack.last().paramObj.verNo)
    	paramActionType = modalStack.last().paramObj.actionType;
    	
    	//조회모드 (결재, 공유) 이면 그리드 편집 못하게 수정
    	if (paramActionType=="T" || paramActionType =="S") { 
	    	// 인덱스 배열을 반복하여 'editor' 속성을 삭제합니다.
	    	
			//editor 속성이 있는 목록입니다.
			let gridind01 = [2, 3, 4, 5];
			let gridind02 = [2, 3, 4, 5, 6];
	    	gridind01.forEach(function(index) {
	    		if (gridColumn01[index]) delete gridColumn01[index].editor;
	    	});
	
	    	gridind02.forEach(function(index) {
	    		if (gridColumn02[index])delete gridColumn02[index].editor;
	    	});
	    	
// 	    	$('.plus-minus').hide();	//추가 삭제버튼 숨김
// 	    	$('#actionBtn').hide();	//등록버튼 숨김
    	}

        setCommonSelect($("select[data-kind]"));
        setPrdt2PfuSelect();
        
        //계약일자
        $('#ctrtDt').datepicker({ format: "yyyy-mm-dd",  language: "ko",  autoclose: true });
        // 조립완료일자
        $('#prdctnDt').datepicker({ format: "yyyy-mm-dd",  language: "ko",  autoclose: true });
        // T/O완료일자
        $('#acptncDt').datepicker({ format: "yyyy-mm-dd",  language: "ko",  autoclose: true });

	    // AREA01 GridView 인스턴스 생성 --> 1.제품정보
// 	    AREA01GridView = createGridView("AREA01GridView", '[data-ax5grid="AREA01-grid"]', gridColumn01, 'PFU01', 'PFUAREA00', 28, 60);
	    // AREA02 GridView 인스턴스 생성 --> 2.설비 기본 Check 사양
// 	    AREA02GridView = createGridView("AREA02GridView", '[data-ax5grid="AREA02-grid"]', gridColumn03, 'PFU01', 'PFUAREA02', 28, 60);
	    // AREA04 GridView 인스턴스 생성--> 4.세부 Check 사항
// 		AREA04GridView = createGridView("AREA04GridView", '[data-ax5grid="AREA04-grid"]', gridColumn02, 'PFU01', 'PFUAREA03', 28, 60);
	    // AREA05 GridView 인스턴스 생성 --> 5.사용 부품 Make
// 		AREA05GridView = createGridView("AREA05GridView", '[data-ax5grid="AREA05-grid"]', gridColumn02, 'PFU01', 'PFUAREA04', 28, 60);
	    // AREA06 GridView 인스턴스 생성 --> 2.개선 제안 사항
		AREA06GridView = createGridView("AREA06GridView", '[data-ax5grid="AREA06-grid"]', gridColumn06, 'PFU01', 'PFUAREA01', 28, 100);
	    // AREA08 GridView 인스턴스 생성 --> 3.문제 발생 현황
		AREA08GridView = createGridView("AREA08GridView", '[data-ax5grid="AREA08-grid"]', gridColumn08, 'PFU01', 'PFUAREA99', 28, 50);
	    // AREA08 GridView 인스턴스 생성
		salesCdGridView = createGridView("salesCdGridView", '[data-ax5grid="salesCd-grid"]', gridColumnsalesCd, 'PFU01', 'PFUAREA08', 28, 28);

// 		AREA01GridView.initView();
// 		AREA02GridView.initView();
// 		AREA04GridView.initView();
// 		AREA05GridView.initView();
		AREA06GridView.initView();
		AREA08GridView.initView();
		salesCdGridView.initView();
		//결재그리드 활성화및 초기화
        gridViewPop7.initView();
		
		//AREA01GridView의 contextMenu 기능 제거하기
// 	    AREA01GridView.target.config.contextMenu = null;
	    salesCdGridView.target.config.contextMenu = null;
		
		//TAB Menu Control Start-----------------
		$('.tabcontent > div').hide();
		$('.tabnav a').click(function () {
			$('.tabcontent > div').hide().filter(this.hash).fadeIn();
// 			$('.tabcontent > div').hide().filter(this.hash).show();
			$('.tabnav a').removeClass('active');
			$(this).addClass('active');
			
			const tabMappings = {
// 				    "#tab01": { gridView: AREA01GridView, initFlag: 'tab01' },
// 				    "#tab02": { gridView: AREA02GridView, initFlag: 'tab02' },
// 				    "#tab04": { gridView: AREA04GridView, initFlag: 'tab04' },
// 				    "#tab05": { gridView: AREA05GridView, initFlag: 'tab05' },
				    "#tab06": { gridView: AREA06GridView, initFlag: 'tab06' },
				    "#tab08": { gridView: AREA08GridView, initFlag: 'tab08' },
				    "#tab09": { gridView: 'fileTreeGridView', initFlag: 'tab09', customMethod: 'reqSetData' },
				    "#tab10": { gridView: gridViewPop7, initFlag: 'tab10', customMethod: 'setData2' }
			};
	
			const href = $(this).attr('href');
			currentTabName = href;
			const tabInfo = tabMappings[href];
	    	if (currentTabName == '#tab01' || currentTabName == '#tab03') return false; //제품정보, 고객요청사항은 제외 처리함
	    	if (currentTabName == '#tab09' && tabArrInit[tabInfo.initFlag]) {
	    		tabArrInit[tabInfo.initFlag] = false;
	    		$('#FILETREE_anchor').trigger('click');
	    		return false; //첨부파일 오류 체크 필요
	    	}
	    	
			if (tabInfo && tabArrInit[tabInfo.initFlag]) {
		    	const list = tabInfo.gridView.target.list;
			    if (tabInfo.customMethod) {
			        tabInfo.gridView[tabInfo.customMethod](list);
			    } else {
			        tabInfo.gridView.setData(list);
			    }
				tabArrInit[tabInfo.initFlag] = false;
			}
			
			
			return false;
		}).filter(':eq(0)').click();
		//TAB Menu Control End-----------------
		

		//textarea WYSIWYGHTML 설정하기
// 		WYSIWYGHTML();

// 	    $("#save").on("click", function(){
// 	        var content = tinymce.activeEditor.getContent();
// 	        console.log(content);
// 	    });
	    

		// 초기화가 완료될 때까지 대기하고 후속 작업 수행
        Promise.all([
    		WYSIWYGHTML('#ctrtRmk', 785),
    		WYSIWYGHTML('#custReq', 700),
    		WYSIWYGHTML('#spareList', 700),
    		WYSIWYGHTML('#pfuEtc', 700),
        ]).then((editors) => {

        	editors.forEach(ed => enableBlobImageCopyToClipboard(ed));
        	
               	if (paramActionType == "U" || paramActionType == "T" || paramActionType == "S") {
       				selectPFUInfo();				//PFU 정보 호출
               	} else if (paramActionType == "C") {
               		selectSalesCdInfo();			//신규 생성시 salesCd의 자료 가져오기

                   	//하단 Tab 연역 정보 설정하기
                   	setTabList();
               	}
               	
               	
        }).catch((error) => {
            console.error('Error initializing TinyMCE:', error);
        });
		
	    // tinymce html 편집기 end ----------------------------------------------------------

		//변수 actionType을 선언하고, modalStack.last().paramObj.actionType의 값을 할당
		if (paramActionType == "C") {
			$("#actionBtn").text("등록");
			$('#actionBtn').on("click", function() {
				insertPFU();
			});

		} else if (paramActionType == "U") {
			$('#pfuPopTit').text('설비 기본정보 수정');
// 			selectPFUInfo();				//PFU 정보 호출 (WYSIWYGHTML 초기화가 끝나면 자료를 가져와서 화면에 뿌려줍니다.)

			$('#actionBtn').text("수정");
			$('#actionBtn').on("click", function() {
				updatePFU();
			});

			//화면 수정 금지 필드 지정 (disabled로 처리하면 FormData에 해당필드값 저장안됨)
			//disabled 처리시 formData에서는 제외되므로 별도 저장해야 함.
// 			$('a:has(i.i_search_w):not(#ordrsNo)').remove();	//<i class="i_search_w"></i> 태그를 포함하고 있는 A태그 삭제
// 			$('.popup_area  select').prop('disabled', true);	//SELECT 태그 수정 금지처리
			$('.popup_area  input').removeClass('input_calendar'); // 특정 태그에서 input_calendar 클래스 삭제
// 			$('#ctrtDt, #prdctnDt, #acptncDt').prop('disabled', true);

			$('select').addClass('field_disabled');
			$('#ctrtNm, #mngIdNm').addClass('field_disabled');
			$('#ctrtDt, #prdctnDt, #acptncDt').addClass('field_disabled');

		}



	    // 그리드 내용 붙여넣기 이벤트 처리-->간헐적 실행으로 오작동~~~ 원인을 모르겠음 아래이벤트로 대체
	    // Ctrl + V 단축키 이벤트 처리
// 		AREA01GridView.target.$target.on("paste", function (e, a) { gridPaste("AREA01GridView", thisGridRow, thisGridCol); });
// 		AREA02GridView.target.$target.on("paste", function (e, a) { gridPaste("AREA02GridView", thisGridRow, thisGridCol); });
// 		AREA04GridView.target.$target.on("paste", function (e, a) { gridPaste("AREA04GridView", thisGridRow, thisGridCol); });
// 		AREA05GridView.target.$target.on("paste", function (e, a) { gridPaste("AREA05GridView", thisGridRow, thisGridCol); });
// 		AREA06GridView.target.$target.on("paste", function (e, a) { gridPaste("AREA06GridView", thisGridRow, thisGridCol); });
		
		// 그리드의 onClick 이벤트 핸들러
		$('[data-ax5grid="salesCd-grid"]').on('click', function(event) {
// 		    console.log("그리드의 아무 영역이 클릭되었습니다.");
		    // 원하는 동작 추가
		    pfuSalesCodeSearch();
		});
// 		$('[data-ax5grid="salesCd-grid"]').on('mousedown', function(event) {
// 		    console.log("그리드의 아무 영역이 mousedown 되었습니다.");
// 		    // 원하는 동작 추가
// 		});
		//---------------------------------------------------------------  
		//첨부 화일 처리 시작 
		//---------------------------------------------------------------  
		fileParam = {
				fileTrgtTyp	: $("#popForm #pgmId").val(),
				fileTrgtKey	: $("#fileTrgtKey").val()
		}
  		treeModule.initAll('deptTreeOrdarsCR50', 'file-grid-CR50', 'FILETREE', fileParam, 'fileList_area_CR50');
		//---------------------------------------------------------------  
		//첨부 화일 처리 끝
		//--------------------------------------------------------------- 
		$("#fileAttachTxt").click(); //파일첨부내역 기본 활성화로 변경하기 
		button_zoomUp_Size (640);	//파일첨부내역 기본 크기 600으로 변경
		
		//제품군, 장비type 작동방식에 따른 option 설정 하기
		$('#prdtTyp, #prdtCav').on('change', function () { setTabList(); });
		$('#prdtDiv').on('change', function () { setPrdtDiv(this, 'main');setTabList(); });
		
		authChk();						// 권한체크
		
	});
    
    
    
	function gridPaste(targetGrid, thisGridRow, thisGridCol) {
	    navigator.clipboard.readText().then(pasteData => {
	        if (pasteData === undefined || pasteData === "" || thisGridRow === undefined) {
	            return;
	        }

	        // 붙여넣기할 데이터를 배열로 변환한다.
	        pasteData = (pasteData.charAt(pasteData.length - 1) === "\n") ? pasteData : pasteData + "\n";
	        var pasteRows = pasteData.split("\n").map(function (row) {
	            return row.split("\t");
	        });

	     	// 붙여넣기할 데이터를 배열로 변환한다.
	        pasteData = (pasteData.charAt(pasteData.length - 1) === "\n") ? pasteData : pasteData + "\n";

	        // 각 셀에서 줄바꿈을 처리하기 위해 정규 표현식을 사용하여
	        // 줄바꿈 문자를 다른 구분자로 변환
	        var pasteRows = pasteData.split("\n").map(function (row) {
	            return row.split("\t").map(function(cell) {
	                // 특정 셀의 줄바꿈을 처리 (예: '\n'을 다른 구분자로 대체)
	                return cell.replace(/\n/g, ' '); // 줄바꿈을 공백으로 대체
	            });
	        });
	        
	        // 붙여넣기를 시작할 셀의 인덱스를 구한다.
	        var startRowIndex = thisGridRow;
	        var startColIndex = thisGridCol;

	        // 붙여넣을 데이터의 행과 열 개수를 구한다.
	        var numRows = pasteRows.length;
	        var numCols = pasteRows[0].length;

	        // 붙여넣기할 셀을 한 개씩 돌면서 값을 설정한다.
	        let gridView = window[targetGrid];
	        var gridLength = gridView.target.getList().length;
	        var gridColumns = gridView.target.config.columns;
			
	        let newRow = {updChk: "I", stdChk:"N", indChk:"I", orgPartId:"", orginData:""};
	        for (var i = 0; i < numRows - 1; i++) {
	            if (startRowIndex + i >= gridLength) {
	            	
	                gridView.target.addRow($.extend(newRow, gridView.target.list[thisGridRow], {__index: undefined}));
// 	                gridView.target.setValue(startRowIndex + i, 'stdChk', 'N');
// 	                gridView.target.setValue(startRowIndex + i, 'indChk', 'I');
	                gridLength = gridView.target.getList().length;
	            }

	            for (var j = 0; j < numCols; j++) {
	                var calRow = startRowIndex + i;
	                var calCol = startColIndex + j;
	                // carriage return 문자 삭제
// 	                var cellData = pasteRows[i][j].replace(new RegExp('\r', 'ig'), '');

	                if (calCol >= gridColumns.length) {
	                    gridView.target.addColumn();
	                }
					
	                //옵션사항 이전 column 이면 수정 못하게 처리함, 해당 필드에 편집기능이 있어야 수정가능함.
	                
	                if ((calCol <= 4 && gridView.target.list[thisGridRow].changeYn !="Y" && gridColumns[calCol].editor != undefined ) ||
	                    (calCol >  4 && gridView.target.list[thisGridRow].finalYn  !="Y" && gridColumns[calCol].editor != undefined ))
	                		{
		                gridView.target.setValue(calRow, gridColumns[calCol].key, cellData);
		                let chkUpdChk = gridView.target.list[calRow].updChk;
		                if (chkUpdChk != "I" && chkUpdChk != "D" ) {  //기존값이 수정이나, 삭제인경우에는 Update 안함.
			                gridView.target.setValue(calRow, 'updChk', 'U');
			                gridView.target.setValue(calRow, 'indChk', 'U');
		                }
	                }
	            }
	        }
	        gridView.target.repaint();
	    });
	}
	

    function pasFloatChk (ivalue) {
		let value = ivalue +' ';    	
		const cvtValue = parseFloat(value.replace(/[^0-9.-]/g, '')); //숫자(0-9), 빼기 기호(-)가 아닌 모든 문자를 바꿉니다. 
		return isNaN(cvtValue) ? 0 : cvtValue; //NaN이면 0로 대체 --> minus기호만 있는경우
	}

    
    function insertList(gridView, isInsert= false, dindex) {
        var newRow = window[gridView].target.getList("selected")[0];
        if (!newRow) {
            newRow = window[gridView].target.getList()[window[gridView].target.list.length - 1];
        } 
        
        if (!newRow) {
        	const areaMapping = {
        		    "AREA01GridView": "PFUAREA01",
        		    "AREA02GridView": "PFUAREA02",
        		    "AREA04GridView": "PFUAREA04",
        		    "AREA05GridView": "PFUAREA05",
        		    "AREA06GridView": "PFUAREA06",
        		    "AREA08GridView": "PFUAREA08",
        		};

        	let tempArea = areaMapping[gridView] || "";

            newRow = {
                useYn		:  "Y",
                reaDiv 		:  tempArea,
                fileTrgtKey :  $('#fileTrgtKey ').val(),
                orgPartId  	:  tempArea + "0101",
                originData  :  "",
                partDiv  	:  tempArea + "01",
                prdtDiv		:  $('#prdtDiv').val(),
                pfuPrdtDiv	:  $('#prdtDiv option:selected').data('rprc'),
            };
        }

        newRow.changeYn = "N";	//추가 등록 자료임.
        newRow.finalYn = "I";	//추가 등록 자료임.
        newRow.updChk = "I";
        newRow.stdChk = "I";
        newRow.indChk = "I";
        newRow.orgPartId = "";
        newRow.originData = "";
        newRow.creatId = "";
        newRow.creatIdNm = "";
        newRow.creatDttm = "";
        newRow.creatPgm = "";
        newRow.udtId = "";
        newRow.udtIdNm = "";
        newRow.udtDttm = "";
        newRow.udtPgm = "";
        newRow.__index = "";

//         gridView.target.addRow($.extend({}, newRow), "last", {focus: "END"});

        if (isInsert) {
            let tempRow = JSON.parse(JSON.stringify(newRow));
            window[gridView].target.addRow(tempRow,dindex);
        } else {
        	 window[gridView].target.addRow($.extend({}, newRow), "last", { focus: "END" });
             setTimeout(function() {
            	 window[gridView].target.focus("END");
            }, 100);
        }
        
    }

	function deleteList(gridView) {
	    var delRow = window[gridView].target.getList("selected");
	    
	    for (var i = delRow.length - 1; i >= 0; i--) {
	        var list = delRow[i];
		    if (list.stdChk == 'Y') {
		    	if (list.indChk == "D") {
			    	list.indChk = "U";	//수정됨
		    	} else {
			    	list.indChk = "D";	//삭제 자료임.
		    	}
		    	window[gridView].target.updateRow(list, list.__index);
		    } else {
	        	window[gridView].target.removeRow(list.__index);
		    }
	    }
	    window[gridView].target.repaint(); // 수정 내용 적용하기
	}


    
	function WYSIWYGHTML(selector, maxHeight) {
	    return new Promise((resolve, reject) => {
		    // tinymce html 편집기 start ----------------------------------------------------------
		    var plugins = [
		        "advlist", "autolink", "lists", "link", "image", "charmap", "print", "preview", "anchor",
		        "searchreplace", "visualblocks", "code", "fullscreen", "insertdatetime", "media", "table",
		        "code", "help", "wordcount", "save", 'autoresize'
		    ];
		    var edit_toolbar = 'formatselect fontselect fontsizeselect |'
		               + ' forecolor backcolor |'
		               + ' bold italic underline strikethrough |'
		               + ' alignjustify alignleft aligncenter alignright |'
		               + ' bullist numlist |'
		               + ' table tabledelete |'
		               + ' link image';
	
		    tinymce.init({
		     	language: 'ko_KR' ,//한글판으로 변경
		    	license_key: 'gpl',
		        selector: selector,
	            autoresize_bottom_margin: 0,
	            max_height: maxHeight,
	            setup: function (editor) {
	            	enableBlobImageCopyToClipboard(editor);
	                editor.on('init', function () {
	                    editor.getDoc().body.style.maxHeight = '700px';
	                    editor.getDoc().body.style.overflowY = 'auto';
	                    editor.getBody().style.fontSize = '10pt';
	                    resolve(editor); // 초기화가 완료되면 Promise를 해결합니다.
	                }),
	                editor.on('change', function () {
	                    // 내용이 변경될 때 실행할 코드
// 	                    console.log('내용이 변경되었습니다.');
	                    if (pfuLoadComplete) {
	                    	if (!prdtOptionSelectCheck()) return false;
		            		pfuDetailChangeFlag = true; //PFU내용 변경했는제 체크하는 Flag
	                    }
	                }),
	                editor.on('keyup', function (aa) {
                    	if (!prdtOptionSelectCheck()) return false;
	            		pfuDetailChangeFlag = true; //PFU내용 변경했는제 체크하는 Flag
	                }),
	                editor.on('SetContent', function (aa) {
	                });
	            },
		        height: 300,
		        menubar: false,
// 		        statusbar: false,  // 상태 바 숨기기
		        plugins: plugins,
		        toolbar: edit_toolbar,
		        
		        /*** image upload ***/
		        image_title: true,
		        /* enable automatic uploads of images represented by blob or data URIs*/
		        automatic_uploads: true,
		        /*
		            URL of our upload handler (for more details check: https://www.tiny.cloud/docs/configure/file-image-upload/#images_upload_url)
		            images_upload_url: 'postAcceptor.php',
		            here we add custom filepicker only to Image dialog
		        */
		        file_picker_types: 'image',
		        /* and here's our custom image picker*/
		        file_picker_callback: function (cb, value, meta) {
		            var input = document.createElement('input');
		            input.setAttribute('type', 'file');
		            input.setAttribute('accept', 'image/*');
	
		            /*
		            Note: In modern browsers input[type="file"] is functional without
		            even adding it to the DOM, but that might not be the case in some older
		            or quirky browsers like IE, so you might want to add it to the DOM
		            just in case, and visually hide it. And do not forget do remove it
		            once you do not need it anymore.
		            */
		            input.onchange = function () {
		                var file = this.files[0];
	
		                var reader = new FileReader();
		                reader.onload = function () {
		                    /*
		                    Note: Now we need to register the blob in TinyMCEs image blob
		                    registry. In the next release this part hopefully won't be
		                    necessary, as we are looking to handle it internally.
		                    */
		                    var id = 'blobid' + (new Date()).getTime();
		                    var blobCache =  tinymce.activeEditor.editorUpload.blobCache;
		                    var base64 = reader.result.split(',')[1];
		                    var blobInfo = blobCache.create(id, file, base64);
		                    blobCache.add(blobInfo);
	
		                    /* call the callback and populate the Title field with the file name */
		                    cb(blobInfo.blobUri(), { title: file.name });
		                };
		                reader.readAsDataURL(file);
		            };
		            input.click();
		        },
		        /*** image upload ***/
		        
		        content_style: 'body { font-family:Helvetica,Arial,sans-serif; } p {margin: 0;  font-size:10pt}'
		    });
	    });
	}
	
	function enableBlobImageCopyToClipboard(editor) {
		  editor.on('copy', async (e) => {
		    try {
		      // 1) 현재 선택 노드에서 IMG를 최대한 안정적으로 찾기
		      let node = editor.selection && editor.selection.getNode ? editor.selection.getNode() : null;

		      // IMG가 직접 선택되지 않은 경우(figure/a/span 등) 대비
		      let img = null;
		      if (node) {
		        if (node.nodeName === 'IMG') img = node;
		        else if (node.querySelector) img = node.querySelector('img');
		        if (!img && node.closest) img = node.closest('img');
		      }

		      // 그래도 없으면 종료(텍스트 복사 등은 기본 동작 유지)
		      if (!img) return;

		      const src = img.getAttribute('src') || '';
		      if (!src.startsWith('blob:')) return; // blob 아닌 이미지는 기본복사로 놔둠

		      // 2) 여기서만 기본복사 막고, 실제 이미지로 클립보드에 쓰기 시도
		      e.preventDefault();

		      const blob = await fetch(src).then(r => r.blob());
		      const mime = blob.type || 'image/png';

		      await navigator.clipboard.write([
		        new ClipboardItem({ [mime]: blob })
		      ]);

		    } catch (err) {
		      // 실패하면 사용자는 "복사가 안됨"으로 느끼므로,
		      // 최소한 로깅으로 원인 파악 가능하게 남김
		      console.error('Blob image copy failed:', err);

		      // 필요하면 여기서 preventDefault를 하지 않도록 구조를 바꾸면
		      // "기본 HTML 복사"는 유지되는데, PPT에는 여전히 안 붙을 가능성이 큽니다.
		    }
		  });
		}
	
	function insertPFU() {
		if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사
			var formData = makeFormData();
			filePostAjax("/user/cr/cr50/insertPfu", formData ,function(data) {
				// alert(data.resultMessage);	
				if (data.resultCode == 200) {
                    kakaoTodo();
					modalStack.last().callback(formData);
					modalStack.close();
				} else {
					alert(data.resultMessage);
				}
			});
		}
	}


	// 수정
	function updatePFU() {
		if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사
			var formData = makeFormData();
			if (formData) {
	      		filePostAjax("/user/cr/cr50/updatePfu", formData,function(data) {
						alert(data.resultMessage);
						if (data.resultCode == 200) {
	                        kakaoTodo();
							gridView.setData(0);
							modalStack.close();
						}
					});
			}
		}
	}
	
	function makeFormData() {
		if ($('#prdtTyp option:selected').data('rprc') != "" && $('#prdtCav').val() == 'PFUCAV00') {
			alert("해당 장비는 작동방식이 선택되어야 합니다.")
			return false;
		}

		if ($('#prdtTyp option:selected').data('rprc') != "" && $('#prdtCav').val() == 'PFUCAV00') {
			alert("해당 장비는 작동방식이 선택되어야 합니다.")
			return false;
		}
		
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		
		if ($('#verNo').val() == "") $('#verNo').val(1);		//최초 등록이면 버젼 1로 자동 설정함.
		
		// 폼데이터 생성
		var formData = new FormData($("#popForm")[0]);

// 		//하위레벨 자료 수정된 자료만 arr 담기
// 		var a01ListRow = updateOriginData(AREA01GridView);
// 		var a02ListRow = updateOriginData(AREA02GridView);
// 		var a03ListRow = updateOriginData(AREA03GridView);
// 		var a04ListRow = updateOriginData(AREA04GridView);
// 		var a05ListRow = updateOriginData(AREA05GridView);
// 		var a06ListRow = updateOriginData(AREA06GridView);
// 		var a01ListRow = AREA01GridView.target.list;
		var a01ListRow = [];	//변경된 정보 조회용으로 수정안됨
// 		var a02ListRow = AREA02GridView.target.list;
// 		var a04ListRow = AREA04GridView.target.list;
// 		var a05ListRow = AREA05GridView.target.list;
// 		var a06ListRow = AREA06GridView.target.list;
		var salesCdListRow = salesCdGridView.target.list;
		

// 		formData.append("a01ListRow", JSON.stringify(a01ListRow));
// 		formData.append("a02ListRow", JSON.stringify(a02ListRow));
// 		formData.append("a04ListRow", JSON.stringify(a04ListRow));
// 		formData.append("a05ListRow", JSON.stringify(a05ListRow));
// 		formData.append("a06ListRow", JSON.stringify(a06ListRow));
		formData.append("salesCdListRow", JSON.stringify(salesCdListRow));

		formData.append("pgmId" 		, $("#pgmId").val());
		formData.append("useYn" 		, "Y");	
		

		
		//---------------------------------------------------------------  
		//-------itemarr  --첨부화일 처리를 위한 부분 시작
		//---------------------------------------------------------------  
		// 유저아이디 추가
		formData.append("userId", jwt.userId);
		formData.append("clntCd", $('#clntCd').val());			//첨부화일용
		formData.append("prdtCd", $('#prdtDiv').val());			//첨부화일용
		formData.append("itemCd", $('#itemDiv').val());			//첨부화일용
		formData.append("prjctCd", $('#clntPjt').val());		//첨부화일용
		
		//-------itemarr  --첨부화일 처리를 위한 부분 시작
		formData.append("comonCd", treeModule.getFileNodeId());	//첨부화일용
		
		//---------------------------------------------------------------  
        
        //---------------------------------------------------------------  
		var fileUploadArr = [];
		var tempArr = [];
		
		tempArr = treeModule.getFileArr();
		$.each(tempArr, function(idx, obj) {
			if (obj.fileKey == 0) {
                formData.append("files", obj.file);
                obj.file = '';
                fileUploadArr.push(obj);
			}
		});

		formData.append("uploadFileArr", JSON.stringify(fileUploadArr));
		formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
		//---------------------------------------------------------------  
		//--첨부화일 처리를 위한 부분 끝
		//--------------------------------------------------------------- 
		
		
		formData.set("ctrtRmk" 		, tinymce.get('ctrtRmk').getContent());
		formData.set("custReq" 		, tinymce.get('custReq').getContent());
		formData.set("spareList" 	, tinymce.get('spareList').getContent());
		formData.set("pfuEtc" 		, tinymce.get('pfuEtc').getContent());
		
		
        formData.append("pfuPrdtDiv", $('#prdtDiv option:selected').data('rprc'));
		
		
		

        // 공유대상자 리스트  TODO LIST에 등록하기 위한 모듈 추가
        // 공유 : TODODIV10, TODODIV1040  결재 :TODODIV20, TODODIV2020
        var rowSharngList = gridViewPop7.target.list;
        var ParamObj = modalStack.last().paramObj.ParamObj;

        if(rowSharngList.length > 0) {
            var rowSharngListArr = []; //공유정보
            var rowApprovalListArr = []; //결재정보

            function createListItem(elem, type) {
                return {
                    gb: type,
                    coCd: $('#coCd').val(),
                    todoDiv1CodeId: type === '공유' ? "TODODIV10" : "TODODIV20",
                    todoDiv2CodeId: type === '공유' ? "TODODIV1120" : "TODODIV2120",
                    todoId: elem.usrNm,
                    todoCoCd: elem.coCd,
                    empNo: elem.empNo,
                    name: elem.name,
                    telNo: elem.telNo,
                    email: elem.eMail,
                    pgPath: "/user/cr/cr50/CR5001P01.html",
                    todoTitle: `${$("#popForm #clntNm").val()} ${$("#clntPjtNm").val()} ${type}`

                };
            }

            $.each(rowSharngList, function(idx, elem) {
                var listItem = createListItem(elem, elem.gb);
                if (elem.gb === '공유') {
                    rowSharngListArr.push(listItem);
                } else if (elem.gb === '결재') {
                    rowApprovalListArr.push(listItem);
                }
            });

            formData.append("rowSharngListArr", JSON.stringify(rowSharngListArr));
            formData.append("rowApprovalListArr", JSON.stringify(rowApprovalListArr));
            formData.append("S_todoDiv1CodeId", "TODODIV10");
            formData.append("S_todoDiv2CodeId", "TODODIV1120");
        }
		
		return 	formData;
		
	}
	
	function updateOriginData(areaGridView) {
	    var listRow = areaGridView.target.list;
	    return $.map(listRow, function(obj) {
	        obj.checkData = `${obj.partNm||''}${obj.partStd||''}${obj.partCust||''}${obj.partConf||''}${obj.partEtc||''}${obj.stdChk||''}${obj.indChk||''}${obj.orgPartId||''}`;
	        obj.modifyedChk = obj.originData == obj.checkData ? "N" : "Y";
	        return obj;
	    });
	}

	
	//PFU 신규 생성시 salesCd 정보와 표준 PFU 내용을 불러와서 화면에 표시하기
	function selectSalesCdInfo() {						//그리드에 뿌리는 데이터

		var formData = {
			"coCd" 			: $('#coCd').val(),
			"salesCd" 		: $('#salesCd').val(),
// 			"pfuPrdtDiv" 	: $('#prdtDiv option:selected').data('rprc'),   //'PFU01', //백단에서 salesCd를 검색하여 설정한다.
// 			"prdtDiv" 		: $('#prdtDiv').val(), 
// 			"prdtTyp" 		: '0',  //Default = 0
// 			"clntCd" 		: 'PFUCAV00',  //Default = PFUCAV00
// 			"partId" 		: 'PFUAREA010101',  //특정 영역만 가져올경우 처리
		}

		postAjaxSync("/user/cr/cr50/selectSalesCdInfo", formData, null, function(data) {
			//--------- data 구조 -----------------------------
			//  data 
			//    ㄴ--- result :일반필드 data
			//           ㄴ----- resultClob   : CLOB data
			//-----------------------------------------------
			$('#popForm #dudtPlanDt').val('');  //기본 오늘날자이므로 clear
			$('#popForm #ordrsPlanDt').val(''); //기본 오늘날자이므로 clear
			$.each(data.result, function(key, value) {
				if ($('#popForm #' + key)[0]) {
					$('#popForm #' + key).val(value);
					if ($('#popForm #' + key).is('[comma]')) {
						onlyNumber($('#popForm #' + key)[0]);
					} else 
					if ($('#popForm #' + key).is('[date]')) {
						$('#popForm #' + key).datepicker('setDate', value);
					}
				}
			});

			//제품군에 따라 장비 Type재설정 하고 해당 아이템 설정함.
			$('#popForm #prdtDivOrigin').val(data.result.prdtDiv);
			setPrdtDiv($('#popForm #prdtDiv'), "main");
			
// 			setContentInEditor('ctrtRmk',  data.resultImg[0].partImg);
// 			setContentInEditor('pfuEtc',  data.resultImg[1].partImg);
			
			//결재정보 불러오기
// 	        gridViewPop7.initView().setData(0);
// 	        gridViewPop7.target.setHeight((gridViewPop7.target.list.length+1) * 27 + 123 );//그리드 높이 조정
			
		});
	}
	

	function selectPFUInfo() {						//그리드에 뿌리는 데이터
		var formData = {
			"coCd" 			: $('#coCd').val(),
			"salesCd" 		: $('#salesCd').val(),
			"fileTrgtKey" 	: $('#fileTrgtKey').val(),
			"verNo" 		: $('#verNo').val(),
// 			"prdtDiv" 		: $('#prdtDiv').val(),  //'PRDTDIV01',
// 			"prdtTyp" 		: $('#prdtTyp').val(),  //'PFU0201',
// 			"pfuPrdtDiv" 	: $('#prdtDiv option:selected').data('rprc'),  //'PFU01',
		}
		postAjax("/user/cr/cr50/selectPfuInfo", formData, null, function(data) {
			//--------- data 구조 -----------------------------
			//  data 
			//    ㄴ--- result :일반필드 data
			//           ㄴ----- resultClob   : CLOB data
			//-----------------------------------------------
			$('#popForm #dudtPlanDt').val('');  //기본 오늘날자이므로 clear
			$('#popForm #ordrsPlanDt').val(''); //기본 오늘날자이므로 clear
			$.each(data.result, function(key, value) {
				if ($('#popForm #' + key)[0]) {
					$('#popForm #' + key).val(value);
					if ($('#popForm #' + key).is('[comma]')) {
						onlyNumber($('#popForm #' + key)[0]);
					} else 
					if ($('#popForm #' + key).is('[date]')) {
						$('#popForm #' + key).datepicker('setDate', value);
					}
				}
			});
			
			var clobList = data.result.resultClob[0];
			
			if (data.result.resultClob.length) {
				setContentInEditor('ctrtRmk', clobList.ctrtRmk);
				setContentInEditor('custReq', clobList.custReq);
				setContentInEditor('spareList', clobList.spareList);
				setContentInEditor('pfuEtc', clobList.pfuEtc);
			}
			
			//결재정보 불러오기
	        gridViewPop7.initView().setData(0);
	        gridViewPop7.target.setHeight((gridViewPop7.target.list.length+1) * 27 + 123 );//그리드 높이 조정
	        
			//제품군에 따라 장비 Type재설정 하고 해당 아이템 설정함.
			setPrdtDiv($('#popForm #prdtDiv'), "main");
// 			$("#popForm #prdtDiv").trigger("change");  //제품군 변경 내용 적용(위의 문장으로 대체 가능함)
			$('#popForm #prdtTyp').val(data.result.prdtTyp);

			//approvalChkeck == "Y"이면 한명이상 결재 진행중이므로 수정 삭제는 못하게 처리해야함.
			if (data.result.approvalChkeck == "Y") {
				//추가수정 버튼 없애기
				$('.plus-minus').hide();	//추가 삭제버튼 숨김
				//수정 버튼 없애기
				$('#actionBtn').hide();	//등록버튼 숨김
				//입력필드 모두 막기
				$('.popup_area input').prop('disabled', true);	//input 태그 수정 금지처리
				
				//HTML Editor 편집 금지
		        toggleEdit('ctrtRmk', 'readonly');  // editor.setMode(isReadOnly ? 'design' : 'readonly'); // 모드 토글
		        toggleEdit('custReq', 'readonly');
		        toggleEdit('spareList', 'readonly');
		        toggleEdit('pfuEtc', 'readonly');
			}
			
// 			AREA01GridView.setData();
// 			AREA02GridView.setData();
// 			AREA04GridView.setData();
// 			AREA05GridView.setData();
			AREA06GridView.setData();
			AREA08GridView.setData();

			salesCdGridView.setData();
			//결재그리드 활성화및 초기화
	        gridViewPop7.setData(0);
		});
	}
	
	function setContentInEditor(editorId, content) {
        var editor = tinymce.get(editorId);
        if (editor) {
            editor.setContent(content);
            editor.save(); // 에디터 내용을 저장하여 화면에 즉시 반영
        } else {
            console.error('Editor not found: ' + editorId);
        }
    }

	function toggleEdit(editorId, mode) {
        var editor = tinymce.get(editorId);
        if (editor) {
        	editor.setMode(mode); // 모드 토글
        }
    }
	
	
	//하단 Tab영역 정보 불러오기
	function setTabList() {
		//신규등록이 아니면  pass
		if (paramActionType != "C") return false;
		pfuLoadComplete=false;

// 		AREA01GridView.setData();
// 		AREA02GridView.setData();
// 		AREA04GridView.setData();
// 		AREA05GridView.setData();
		AREA06GridView.setData();
		AREA08GridView.setData();
		salesCdGridView.setData();
		//결재그리드 활성화및 초기화
        gridViewPop7.setData3(0);
		
		//이미지 자료등록은 현재 2개만 적용함.
		//PFUAREA010101 == ctrtRmk, PFUAREA070301 == pfuEtc
		let tempPfuPrdtDiv 	= $('#prdtDiv option:selected').data('rprc'); 	//PFU 유형을 가져옴 PFU02, PFU03...
		let tempType 		= $('#prdtTyp option:selected').data('rprc');	//PFU Type 코드 PFU0301, PFU0302...
		let tempEtc			= $('#prdtTyp option:selected').data('etc');	//data-etc 값이 N인경우 표준PFU 없음 기본 PFU PFU00을 가져오기
		let tempClntCd		= $('#prdtCav').val();
		
		if (tempType == '')  tempType = '0'; //default는 0 임
		if (tempEtc == 'N') {
			tempPfuPrdtDiv = 'PFU00'; //default는 0 임
			tempType = '0'; //default는 0 임
			tempClntCd = '0';
		}
		
        var formData = {
                "clntCd" 		: tempClntCd, 			//default = 0
                "pfuPrdtDiv" 	: tempPfuPrdtDiv,
                "prdtTyp" 		: tempType,
                "partId"		: "",
            }
        postAjaxSync("/user/cr/cr50/selectStdPfuClobInfo", formData, null, function(data) {
            var list = data.resultImg;
            if (list.length != 0) {
            	$.each(list, function (idx, elem) {   
                    if (elem.partId ==  "PFUAREA010101") setContentInEditor('ctrtRmk',  elem.partImg);
                    if (elem.partId ==  "PFUAREA070301") setContentInEditor('pfuEtc',  elem.partImg);
                 })
            } else {	//해당 이미지 자료가 없을때
                setContentInEditor('ctrtRmk',  '설비기본 정보 확인<br><br>');
                setContentInEditor('pfuEtc',   `<p><strong>1. 기준기계와의 상이점</strong></p>
                		<ul>
                		<li><span style="font-size: 10pt;">11111</span></li>
                		<li><span style="font-size: 10pt;">22222</span></li>
                		<li><span style="font-size: 10pt;">33333</span></li>
                		</ul>
                		<p>&nbsp;</p>
                		<p><strong>2. 고객요청사항</strong></p>
                		<ul style="font-size: 13.3333px;">
                		<li><span style="font-size: 10pt;">11111</span></li>
                		<li><span style="font-size: 10pt;">22222</span></li>
                		</ul>
                		<p>&nbsp;</p>
                		<p><strong>3. 제품정보</strong></p>
                		<ul style="font-size: 13.3333px;">
                		<li>11111</li>
                		<li>22222</li>
                		</ul>
                		<p><strong>4. 기본정보</strong><strong style="font-size: 10pt;">&nbsp;~~~~~ 표양식</strong><span style="font-size: 10pt;"> 필</span><span style="font-size: 10pt;">요</span></p>
                		<table style="border-collapse: collapse; width: 65.9806%; height: 55.9686px; float: left;" border="1" cellspacing="0" cellpadding="0">
                		<tbody>
                		<tr style="height: 18.6562px;">
                		<td style="width: 25.1845%; height: 18.6562px; text-align: center;"><strong>구분</strong></td>
                		<td style="width: 26.1321%; height: 18.6562px; text-align: center;"><strong>내용</strong></td>
                		<td style="width: 48.5024%; height: 18.6562px; text-align: center;">&nbsp;</td>
                		</tr>
                		<tr style="height: 18.6562px;">
                		<td style="width: 25.1845%; height: 18.6562px; text-align: center;"><span style="font-size: 13.3333px; text-align: start;">장</span><span style="font-size: 13.3333px; text-align: start;">비대수</span></td>
                		<td style="width: 26.1321%; height: 18.6562px; text-align: center;">&nbsp;</td>
                		<td style="width: 48.5024%; height: 18.6562px; text-align: center;">&nbsp;</td>
                		</tr>
                		<tr style="height: 18.6562px;">
                		<td style="width: 25.1845%; height: 18.6562px; text-align: center;">&nbsp;</td>
                		<td style="width: 26.1321%; height: 18.6562px; text-align: center;">&nbsp;</td>
                		<td style="width: 48.5024%; height: 18.6562px; text-align: center;">&nbsp;</td>
                		</tr>
                		</tbody>
                		</table>
                		<p>&nbsp;</p>
                		<p>&nbsp;</p>
                		<p>&nbsp;</p>
                		<p>&nbsp;</p>
                		<p>&nbsp;</p>
                		<p><strong>5. 사용환경 </strong><strong>&nbsp;~~~~</strong><strong style="font-size: 13.3333px;">표양식 필요</strong></p>
                		<table style="font-size: 13.3333px; width: 544.984px; height: 93.281px; float: left;" border="1" cellspacing="0" cellpadding="0">
                		<tbody>
                		<tr style="height: 18.6562px;">
                		<td style="width: 136.25px; height: 18.6562px; text-align: center;"><strong>구분</strong></td>
                		<td style="width: 141.391px; height: 18.6562px; text-align: center;"><strong>내용</strong></td>
                		<td style="width: 263.344px; height: 18.6562px; text-align: center;">&nbsp;</td>
                		</tr>
                		<tr style="height: 18.6562px;">
                		<td style="width: 136.25px; height: 18.6562px; text-align: center;"><span style="font-size: 13.3333px; text-align: start;">전기</span></td>
                		<td style="width: 141.391px; height: 18.6562px; text-align: center;">&nbsp;</td>
                		<td style="width: 263.344px; height: 18.6562px; text-align: center;">&nbsp;</td>
                		</tr>
                		<tr style="height: 18.6562px;">
                		<td style="width: 136.25px; height: 18.6562px; text-align: center;"><span style="font-size: 13.3333px; text-align: start;">사양외</span></td>
                		<td style="width: 141.391px; height: 18.6562px; text-align: center;">&nbsp;</td>
                		<td style="width: 263.344px; height: 18.6562px; text-align: center;">&nbsp;</td>
                		</tr>
                		<tr style="height: 18.6562px;">
                		<td style="width: 136.25px; text-align: center; height: 18.6562px;"><span style="font-size: 13.3333px; text-align: start;">장비 기본정보</span></td>
                		<td style="width: 141.391px; text-align: center; height: 18.6562px;">&nbsp;</td>
                		<td style="width: 263.344px; text-align: center; height: 18.6562px;">&nbsp;</td>
                		</tr>
                		<tr style="height: 18.6562px;">
                		<td style="width: 136.25px; text-align: center; height: 18.6562px;"><span style="font-size: 13.3333px; text-align: start;">공장 정보</span></td>
                		<td style="width: 141.391px; text-align: center; height: 18.6562px;">&nbsp;</td>
                		<td style="width: 263.344px; text-align: center; height: 18.6562px;">&nbsp;</td>
                		</tr>
                		</tbody>
                		</table>
                		<p style="font-size: 13.3333px;">&nbsp;</p>
                		<p style="font-size: 13.3333px;">&nbsp;</p>
                		<p style="font-size: 13.3333px;">&nbsp;</p>
                		<p style="font-size: 13.3333px;">&nbsp;</p>
                		<p><strong>&nbsp; &nbsp;</strong></p>
                		<p>&nbsp;</p>
                		<p>&nbsp;</p>
                		<p><strong>6. 특기사항</strong></p>
                		<ul style="font-size: 13.3333px;">
                		<li>11111</li>
                		<li>22222</li>
                		</ul>`);
            }

        });
		
        pfuDetailChangeFlag = false; //PFU내용 변경했는제 체크하는 Flag
        pfuLoadComplete = true;
	}
    
    // 공유대상자 추가//  
    function insertShareUserModal1() {
		
    	if( approvalYn() ) {
			alert("결재가 이미 진행중입니다.");
			return;
		}


        const paramObj = {
            coCd: $('#coCd').val(),
            useYn: "Y",
            userId: $('#ordrgId').val(),
            userNm: $('#ordrgNm').val(),
            approvalGrid: [],
            shareGrid: []
        };

        const  appshaList = gridViewPop7.target.list;

        // 결재와 공유 정보를 필터링 및 매핑
        function mapItemsByType(type) {
            return $.grep(appshaList, function(item) {
                return item.gb === type;
            }).map(function(item) {
                return {
                    gb: type,
                    id: item.usrNm,
                    text: item.name,
                    parent: item.jik,
                    deptNm: item.dtNm,
                    telNo: item.telNo,
                    offTelNo: item.offTelNo,
                    email: item.email,
                    todoId: item.id,
                    todoKey: item.todoKey,
                    sanctnSn: item.sanctnSn,
                    sanctnSttus: item.sanctnSttus,
                    todoCfDt: item.todoCfDt,
                    todoCfOpn: item.todoCfOpn,
                    flag: item.flag
                };
            });
        }

        paramObj.approvalGrid = mapItemsByType("결재");
        paramObj.shareGrid = mapItemsByType("공유");
        
        openSecondModal("/static/html/cmn/modal/userLstSearch.html", 900, 500, "작성자 검색", paramObj, function (approvalGrid, shareGrid){
    		// console.log('결재라인 : ', approvalGrid.target.list);
    		// console.log('공유라인 : ', shareGrid.target.list);
    		
			// 결재와 공유 리스트 변환
	        function convertList(list, type) {
	            return list.map(function(item) {
	                return {
	                    gb: type,
	                    usrNm: item.id,
	                    name: item.text,
	                    jik: item.parent,
	                    dtNm: item.deptNm,
	                    telNo: item.telNo,
	                    offTelNo: item.offTelNo,
	                    email: item.email,
	                    todoId: item.id,
	                    todoKey: item.todoKey,
	                    sanctnSn: item.sanctnSn,
	                    sanctnSttus: item.sanctnSttus,
	                    todoCfDt: item.todoCfDt,
	                    todoCfOpn: item.todoCfOpn,
	                    flag: item.flag
	                };
	            });
	        }
	
	        var appArray = convertList(approvalGrid.target.list, "결재");
	        var shaArray = convertList(shareGrid.target.list, "공유");
        	
  			gridViewPop7.setData2(appArray.concat(shaArray));
  			
        });
		
    } 
 	
    //결재 여부
    function approvalYn() {
       var gridList = gridViewPop7.target.getList();
       var inCnt = 0;
       if( gridList.length > 0 ) {
            var msgArr = [];         
            $.each(gridList, function (idx, elem) {   
               //결재자가 본인이 아니면서 상태가 Y인 경우
               if( elem.todoId != jwt.userId && elem.sanctnSttus == "Y" ) inCnt++;
            })
       }
       return inCnt;
    }
    
    function deleteShareUser1(){
        
        if( approvalYn() ) {
          alert("결재가 이미 진행중입니다.");
          return;
       }
        
        var selRow = parseInt(gridViewPop7.target.selectedDataIndexs);    
        if( isNaN(selRow) ) {
           alert("선택된 행이 없습니다.");
           return;
        } else {         
              if( selRow > -1 ) {
                 var todoKey = gridViewPop7.target.getList()[selRow].todoKey;
                 var gridList = gridViewPop7.target.getList("selected")[0];
             if( typeof(todoKey) == "undefined" ) {
                gridViewPop7.target.removeRow(selRow);
                $.gridNoSet(gridViewPop7, "sanctnSn");
             } else {
                var paramObj = {
                      todoNo: $("#popForm #fileTrgtKey").val(),
                      todoKey: gridList.todoKey,
                      sanctnSn: gridList.sanctnSn,
                      todoDiv1CodeId: gridList.todoDiv1CodeId,
                      todoDiv2CodeId: gridList.todoDiv2CodeId
                	}
                 deleteAjax("/user/wb/wb20/deleteTodoMaster", paramObj, null, function(data) {
                    if (data.resultCode == 200) {
                       alert(data.resultMessage);
                       gridViewPop7.setData(0);
                    } else {
                       alert("삭제중 오류가 발생했습니다");                                
                    }
                 });                   
             }
           }
        }
     }


                
    /*
    #   TODO 알림톡발송 시작
    #
    */
    // $("#approvalReqTodoBtn").on("click", function () {
    //    kakaoTodo();
    // });

        
    function kakaoTodo() {
        
        //message load
        if (kakaoErr.length == 0) {
	        var paramObj = {
	            "userId" : jwt.userId
	            , "codeKind" : "KAKAOMSG"
	        };
	        postAjaxSync("/user/sm/sm02/selectCurrToday", paramObj, null, function(data) {
	            if(data.resultList.length > 0 ) {
	                kakaoErr = data.resultList;
	            }
	        });   
        }
    	
        let clntNm = (jwt.coCd=="GUN") ? "(주)건양ITT" : "트루넷";
        // Kakao 알림톡 보내는사람(userID) 연락처 조회 값 세팅
        var paramObj1 = {
            "coCd" : $("#coCd").val(),
            "userId" : $("#mngId").val()
        };
        postAjaxSync("/user/wb/wb24/selectMemberTelNo", paramObj1, null, function(data) {
        	teleNo = (data.result[0] && data.result[0].telNo) ? data.result[0].telNo : "051-312-2400";
        });

//         var chgNm = $("#popForm #clntNm").val() + "(" + $("#popForm #clntPjtNm").val() + " - " + $("#popForm #salesCd").val() + ") PFU" + $("#popForm #verNo").val() + "차 ";   
        const chgNm = `${$("#popForm #clntNm").val()}(${$("#popForm #clntPjtNm").val()}:${$("#popForm #salesCd").val()}) PFU ${$("#popForm #verNo").val()}차`;

        
        //---------------------------------------
        
	    // 파라미터 생성 함수
	    function createTodoParam(todoDiv1CodeId, todoDiv2CodeId, todoDiv1CodeNm, sanctnDiv2) {
	        return {
	            "tmplatDiv": "TMPLATDIV02",
	            "coCd": $("#popForm #coCd").val(),
	            "todoDiv1CodeId": todoDiv1CodeId,
	            "todoDiv2CodeId": todoDiv2CodeId,
	            "todoDiv1CodeNm": todoDiv1CodeNm,
	            "title": chgNm,
	            "sanctnDiv2": sanctnDiv2,
	            "todoNo": $("#popForm #salesCd").val(),
	            "histNo": $("#popForm #verNo").val(),
	            "clntCd": "1", // 발신회사는 로그인사용자 회사
	            "clntNm": clntNm, // 로그의 수신거래처명
	            "ordrgMngNm": $("#popForm #mngIdNm").val(), // 수주작성자(담당자)
	            "ordrgMngTelNo": teleNo, // 담당자 전화번호
	            "creatPgm": "CR5001P01"
	        };
	    }

	    // 알림톡 전송 함수
	    function sendKakaoTodo(todoDiv1CodeId, todoDiv2CodeId, todoDiv1CodeNm, sanctnDiv2) {
	        const param = createTodoParam(todoDiv1CodeId, todoDiv2CodeId, todoDiv1CodeNm, sanctnDiv2);
	        commKaKaoSendTodo(param);
	    }
        
        
        // PFU 결재 및 공유 알림톡 전송
        sendKakaoTodo("TODODIV20", "TODODIV2120", "결재", "결재");
        sendKakaoTodo("TODODIV10", "TODODIV1120", "공유", "공유");
     
       
        if (kakaoCnt > 0) {
            kakaoCnt = 0;
            // alert("알림톡이 정상 발송되었습니다.");
        }
    }
    
    //to-do결재요청 알림톡
    function commKaKaoSendTodo(param) {
        // console.log('---카카오 발주및출장요청서 알림톡발송시작 --' + param);
        //알림톡수신번호 채번
        var maxMessageId = null;         //message id(unique key)
        var talkMessage = null             //발송될 내용 template
        var mobile = null               //수신인 휴대전화번호
        var title = null               //todo title
        var todoDiv2CodeNm = null               //todo title
        var sendList = [];
        let talkParam = {};
        let talkBody = {};
        let sendCnt = 0;
        postAjaxSync("/user/bm/bm18/selectMaxMessageIdTodo", param, null, function(data) {
            if(data.resultList.length > 0 ) {
                if( data.resultList[0].maxMessageId != "" ) {
                    sendList = data.resultList;
                } else {
                    alert("알림톡 발송을 위한 messageId 생성에 실패 했습니다.");
                    return;
                }
            }
        });
        //user search ajax end
        
        //대상 loop
        $.each(sendList, function (key, sendObj) {
            maxMessageId = sendObj.maxMessageId;
            talkMessage = sendObj.messageDesc;
            mobile =  sendObj.telNo;
            //로그용
            param.rcvId = sendObj.todoId;         //todo 수신id
            param.rcvNm = sendObj.name;            //todo 수신자명
            param.nameTo = sendObj.name;            //todo 수신자명
            //title      = sendObj.todoTitl;
            todoDiv2CodeNm =   sendObj.todoTitl;
            param.todoDiv2CodeNm = todoDiv2CodeNm;
            //param.title = title;                        //요청내용제목
            param.sendDt = sendObj.sendDt;
            
            if(mobile == "" || mobile == null) {
                alert('수신전화번호가 없습니다.\r\n['+clntNm+'] 거래처관리의 사업부 첫번째 항목을 확인해 주십시오.');
                return;
            }
            
            if(talkMessage == "" || talkMessage == null) {
                alert('발송할 내용이 없습니다.\r\n알림톡템플릿관리를 확인해 주십시오.');
                return;
            }
            //message 치환
            let message = talkMessage;
            let splitStr = Array.from(message.matchAll('\\{(.*?)\\}'), match => `${match[0]}`);
            //loop
            $.each(splitStr, function (key, val) {
                let compKey = val.substring(1, val.length-1);
                if( compKey != "" && compKey != "undefined" ) {
                    if( typeof(param[compKey]) != "undefined" ) {
                        let val2 = '#'+val;
                        message = message.replaceAll(val2, param[compKey]);
                    }
                }
            });
            
            talkParam.authToken = "e/eDfZOFCsrBqadaECQ0+g==";
            talkParam.serverName = "gyitt2400";
            talkParam.paymentType = "P";
            talkBody.service = "2310086157";            //서비스번호(1000000000 - 예시  real : 2310086157
            talkBody.messageId = maxMessageId;         //고객사에서 관리하는 메시지No - 40byte (unique 값);
            talkBody.title = param.title;               //알림톡 타이틀 -
            talkBody.message = message;            //알림톡 메시지 (1000 byte)
            talkBody.mobile = mobile;            //휴대전화번호
            talkBody.template = "10003";         //템플릿관리화면 템플릿ID   - 발주서 V2
            let talkJson = JSON.stringify(talkBody);
            sendCnt = kakaoSendReal(talkJson, talkParam, param);
        });
        //대상 loop end
        
        if( sendCnt > 0 ) {
            //alert("알림톡 정상 발송되었습니다.");
            kakaoCnt++;
        }
    }  //user search ajax end
    
    //입력그리드 No. 재정립
    $.gridNoSet = function(gridObj, key) {
        // console.log('---gridNoset run ---');
        var gridList = gridObj.target.getList();
		if( gridList.length > 0 ) {
			gridList.forEach((elem, idx) => {
	            gridObj.target.setValue(idx, key, idx + 1);
	        });
			gridObj.target.repaint();
		}		
	}
	function button_zoomUp_Size( minmaxValue ) {
		//parseInt(문자열, 진법);
		var heightValue = parseInt($(".ax5_grid[data-ax5grid='file-grid']").css("height"), 10);
		minmaxValue = (minmaxValue < 100) ? 100 : (minmaxValue > 1200) ? 1200 : minmaxValue;
		if (heightValue!=minmaxValue) {
			$("#treeview").css("height", minmaxValue);
			$('[data-ax5grid="file-grid"]').css("height", minmaxValue);
			$('[data-ax5grid="file-grid"] [data-ax5grid-container="root"] ').css("height", minmaxValue);
// 			fileTreeGridView.reqSetData(fileTreeGridView.target.list)
		}
	}
	
	
	//제품군 설정하는 검색 함수
	function setPrdt2PfuSelect(){
        const param = { "codeKind" : 'PRDTDIV' };
			postAjaxSync("/admin/cm/cm05/selectChildCodeList", param , null,  function(data){
				var optionHtml = '';
				const childCodeList = data.childCodeList;
		            // childCodeList가 존재할 때만 옵션 추가
	            optionHtml += childCodeList.map(obj => 
	                `<option style="${obj.codeRprc == undefined ? 'color:red;font-weight:bold;' : ''}"  value="${obj.codeId}" data-rprc="${obj.codeRprc}" data-etc="${obj.codeEtc}" data-desc="${obj.codeDesc}" data-dz-code="${obj.dzCode}">${obj.codeNm}</option>`
	            ).join('');
		            
				$('#prdtDiv').append(optionHtml);
			})
	}
	
	function setPrdtDiv(elem, target) {
// 		if ($('#popForm #prdtDivOrigin').val() != $('#popForm #prdtDiv').val()) {
// 			if (confirm("salesCode에 등록된 제품군과 다릅니다. 진행하시겠습니까?")) {
// 				//변경된 제품군으로 PFU 생성됩니다.
// 			} else {
// 				$('#popForm #prdtDiv').val($('#popForm #prdtDivOrigin').val());
// 				return false;
// 			}
// 		}
	    const elemValue = $(elem).val();
// 	    const elemRprcValue = $(elem).data('rprc');
	    let elemRprcValue =$('#prdtDiv option:selected').data('rprc');
	    
	    
	    
		//PFU 유형별 작동방식이 필수정인지 확인하기 위함 --> PFUCAV
		/*
				PFU01	진공성형기	
				PFU02	열풍융착기		    --------------------------> PFUCAV
				PFU03	EDGE FOLDING         ---------------------> PFUCAV
				PFU04	D/TRIM 조립 LINE	--------------------------> PFUCAV
				PFU05	H_LINER EDFE FOLDING & BRACKET 취부기	------>	
				PFU07	초음파 융착기	    --------------------------> PFUCAV
				PFU08	OVEN	        --------------------------> PFUCAV
				PFU10	펀칭 & 피어싱	    -------------------------->	PFUCAV
				PFU14	금형교환대차 & 작업대	
		*/
		let tempPfuCav = "";
		if (elemRprcValue != "undefined") {
			var paramObj = {"codeId": elemRprcValue};
			postAjaxSync("/admin/cm/cm05/selectCodeInfo", paramObj, null, function(data){
				tempPfuCav = data.codeInfo?.codeRprc || '';
			});
		} else {
			elemRprcValue = 'PFU00';
		}

	    // 기본 옵션 HTML
	    let notOption = 'style="color:red;font-weight:bold;";'
	    let optionHtml = `<option value="0" data-rprc="0" data-etc="N" data-pfucav="${tempPfuCav}" data-desc="" data-dz-code="" ${notOption} selected>선택</option>`;
	    if (elemValue) {
	        const paramObj = { "codeKind": elemRprcValue };
	        
	        postAjaxSync("/admin/cm/cm05/selectChildCodeList", paramObj, null, function(data) {
	            const childCodeList = data.childCodeList;

	            // childCodeList가 존재할 때만 옵션 추가
	            optionHtml += childCodeList.map(obj => 
	                `<option style="${obj.codeEtc === "N" ? 'color:red;font-weight:bold;' : ''}"  value="${obj.codeId}" data-rprc="${obj.codeRprc}" data-etc="${obj.codeEtc}" data-pfucav="${tempPfuCav}" data-desc="${obj.codeDesc}" data-dz-code="${obj.dzCode}">${obj.codeNm}</option>`
	            ).join('');

	            // 선택된 타겟에 따라 HTML 업데이트
	            const targetSelector = target === "main" ? '#prdtTyp' : '[data-search="prdtTyp"]';
	            $(targetSelector).html(optionHtml);
	        });
	    } else {
	        // 기본 옵션만 설정
	        $('[data-search="prdtTyp"]').html(optionHtml);
	    }
	    
	    //-----------------------------------------
	    //수정사항이 없으면 표준 PFU를 다시 불러와야함.
	    //-----------------------------------------
	}
	
	
	//참조SalesCd
	//Sales Code (수주마스터, 수주상세테이블 조인) 검색
    function modalPfuCopySearch() {
//     	if (!prdtOptionSelectCheck()) return false; //필수선택 사항 입력되었는지 확인하기
		
// 		if (paramActionType == "C") {
// 			if (confirm("참조SalesCd 선택은 해당 PFU를 복사 후 변경하는 작업입니다.\n진행하시겠습니까?")) {
// 				//salesCd 선택하여 복사 버튼 클릭시에 수정중인 자료 삭제하고 PFU 복사처리진행합니다.				
// 			} else {
// 				return false;
// 			}
// 		} else {
// 			alert("수정작업시에는 참조할 수 없습니다.  PFU삭제후 작업바랍니다.");
// 			return false;
// 		}
		let tempSalesCd = $("#popForm #fromSalesCd").val();
		if (tempSalesCd == "") tempSalesCd = $("#popForm #ordrsNo").val();
    	const paramObj = {
    			coCd 			: $("#popForm #coCd").val(),
    			ordrsNo 		: tempSalesCd,
    			pgmId 			: "CR5001P01",
    	};
    	openSecondModal("/static/html/user/cr/cr50/CR5001P02.html", 1400, 650, ` 선택된 SalesCode의 PFU를 참조 합니다.`, paramObj, function (grid){
        	//dataGbn이 "D"==SALES CODE자료만 검색
            const row = grid.target.getList("selected")[0];
        	if (row) {
	            $('#fromCoCd').val(row.coCd);
	            $('#fromClnt').val(row.ordrsClntCd);
	            $('#fromOrdrsNo').val(row.ordrsNo);
	            $('#fromPfuNo').val(row.pfuNo);		//추가적용 필요
	            $('#fromPfuVerNo').val(row.pfuVerNo);	//추가적용 필요
	            $('#fromPfuPrdtDiv').val(row.pfuPrdtDiv);
	            $('#fromPrdtCd').val(row.prdtCd);
	            $('#fromPrdtTyp').val(row.prdtTyp);	//추가적용 필요
	            $('#fromPrdtCav').val(row.prdtCav);	//추가적용 필요
	            $('#fromPrdtStep').val(row.prdtStep);	//추가적용 필요
	            $('#fromSalesCd').val(row.salesCd);
	            $('#fromEqpNm').val(row.eqpNm);

	            //선택된 salesCd의 문제현황 불러오기
	            AREA08GridView.setData();
	        	
        	}
        });
    }


	//Sales Code (수주마스터, 수주상세테이블 조인) 검색
    function pfuSalesCodeSearch(inputValue, coCd) {
		let tempSalesCd = $('#salesCd').val();  //sample 자료 --> 24046-01URFUP
        var paramObj = {
           "coCd" 		: $('#coCd').val(),
           "pfuNo" 		: $('#fileTrgtKey').val(),
           "ordrsNo"	: $('#ordrsNo').val(),
           "salesCdS"	:   salesCdGridView.target.list.map(item => item.salesCd).join(","), //여러건 출력
        };
        openSecondModal("/static/html/user/cr/cr50/CR5001P03.html", 1300, 700, "SALES CODE 검색", paramObj, function (grid){
            var rows = grid.target.getList("selected");
            rows.forEach((item, idx) => {
                item.__index = idx; // idx는 0부터 시작하는 인덱스
                item._original_index = idx; // idx는 0부터 시작하는 인덱스
            });
			
            salesCdGridView.target.setData(rows);
			
        });
    }
	
	

	/*수정 or 등록 버튼 클릭 시*/
	function insertQualityReqModal(row) { 
	    	if (row.reqNo) {
	    		//발주요청번호가 존재하면 발주요청서 수정 업무 시작
				var paramObj = {
					"actionType" : "U",
//	 				"fileTrgtKey" : 0,		//정보 없음
					"reqNo"    : row.reqNo,
					"coCd" 	   : row.coCd,
			       	"userId"   : jwt.userId, 
			       	"deptId"   : jwt.deptId,
			       	"issNo"    : row.workRptNo,
			       	"pgmId"    : "QM0101M01"
				};
				openSecondModal("/static/html/user/qm/qm01/QM0101P01.html", 1600, 850, "", paramObj, function(data) {
				});
	    	}
	}


    // WBS 계획 문제 수정 방법은 문제 관리 화면(구분자:U3) 에서 등록 (1가지 방법), 기존 WBS 일정계획 (구분자:U1)은 사용하지 않고 문제관리 화면으로 이동    
    // WBS 실적 문제 수정 방법은 문제 관리 화면(구분자:U4) 에서 등록 (1가지 방법), 기존 WBS 일정계획 (구분자:U2)은 사용하지 않고 문제관리 화면으로 이동
    function wbsIssModal(row) {
    	if (row == undefined) {
            return;
    	} else if (row.jobDiv == "작업일보") {
			var paramObj = {
				"actionType" : "I",
				"fileTrgtKey" : row.fileTrgtKey,
				"coCd" 	   : row.coCd,
				"userId"   : jwt.userId,
				"pgmId"    : "PM0101M01"
			};
			openSecondModal("/static/html/user/pm/pm01/PM0101P01.html", 1100, 750, "", paramObj, function(data) {});
        } else {
            // 문제관리에서 계획 문제 수정 구분자는 "U3"
            if (row.gubun == "계획") {
                var paramObj = {
                    "actionType"     : "I",
//                     "actionType"     : "U3",
                    "coCd"           : row.coCd,
                    "salesCd"        : row.salesCd,
                    "issFileTrgtKey" : row.fileTrgtKey
                };
                openSecondModal("/static/html/user/wb/wb24/WB2401P01.html", 1200, 870, "WBS 계획문제수정", paramObj, function (){
                    
                });
            }
    		else if (row.gubun == "실적") {
                // 문제관리에서 등록 문제 수정 구분자는 "U4"
                var paramObj = {
                    "actionType"     : "I",
//                     "actionType"     : "U4",
                    "coCd"           : row.coCd,
                    "salesCd"        : row.salesCd,
                    "issFileTrgtKey" : row.fileTrgtKey
                };
                openSecondModal("/static/html/user/wb/wb24/WB2401P11.html", 1200, 870, "WBS 실적문제수정", paramObj, function (){
                    
                });
            }
        }
    }
	


	/*발주요청 결과 등록/조회*/
	function insertQualityResultModal(row) {
		paramObj = {
			fileTrgtKey  : row.resFileTrgtKey,
			actionType   : (row.acteDt) ? "U" : "C",
			coCd		 : row.coCd,
			reqNo		 : row.reqNo,
			rsltNo		 : row.rsltNo,
			userId		 : row.userId,
			userName	 : row.userName,
			deptId	 	 : row.deptId,
			issNo	 	 : row.workRptNo,
		}
		openSecondModal("/static/html/user/qm/qm01/QM0101P03.html", 1600, 870, "", paramObj, function(data) {
			//gridView.setData(0);
		});
	}
	
    

	/*개선제안확인시*/
	function insertImprovementModal(row, type, job = 'U') {
// 		var row = gridView.target.getList("selected")[0];

		// 평가완료된 내용에 대해 2. 부서지정, 3.검토결과등록 버튼으로 들어갈때 조회화면으로
		type = 1;
		//type 1:등록, 수정, 2:부서지정, 3:검토내용, 4:평가등록	
		var paramObj = {
			"actionType" : job,
			"jobLevel" : type,
			"imprvmNo" : (job == 'C') ? 0 : row.imprvmNo,
			"coCd" 	   : $("#coCd_S").val(),
			"userId"   : jwt.userId,
			"pgmId"    : "IM0101M01"
		};
		openSecondModal("/static/html/user/im/im01/IM0101P01.html", 1600, 860, "", paramObj, function(data) {
// 			gridView.setData(0);
		});
	}
	
	
 	// 출력 버튼용
	function setReportMain() {
		let fileName = "CR5001M01.jrf";
		let arg = "coCd#" + $("#coCd").val() 
		        + "#partNo#" + "B"
		        + "#pfuNo#" + $("#fileTrgtKey").val() 
		        + "#fromSalesCd#" + $("#fromSalesCd").val()
		        + "#ordrsNo#" + $("#ordrsNo").val()
		        + "#userId#" + jwt.userId 
             	+ "#";
		callReport(fileName, arg, "1050", "700", "PFU출력" + "B");
	}
    
 	//Ver.Up 클릭시 실행될 함수
 	function createHistory() {
 		//버젼업 작업 진행 내역
 		// 1. TB_CR50M01의 자료를 TB_CR50M01_HIST에 복사
 		// 2. TB_CR50D01의 자료를 TB_CR50D01_HIST에 복사 TB_CR50M01의 VER_NO 적용
 		// 3. TB_CR50D02의 자료를 TB_CR50D02_HIST에 복사 TB_CR50M01의 VER_NO 적용
 		// 4. TB_CR50M01의 VER_NO + 1 로 변경함.
 		// 5. 결재정보는 버젼별로 관리됨으로 조회 안됨.
 		let pfuNo = $('#fileTrgtKey').val();
		var formData = {
			"pfuNo" 		: pfuNo,
			"verNo" 		: $('#verNo').val(),
			"coCd"        	: $('#coCd').val(),
			"todoNo" 		: pfuNo,
			"userId"      	: jwt.userId,
			"pgmId" 		: "CR5001P01"
		}
	    
		if (confirm(pfuNo +"의 결재정보가 무시됩니다. 버젼업 하시겠습니까?")) {
			putAjax("/user/cr/cr50/updatePfuVersionUpProcess", formData, null, function(data) {
				alert(data.resultMessage);
				if (data.resultCode == 200) {
				}
			});
		}
 	}
</script>

</body>
</html>