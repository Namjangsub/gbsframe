<!DOCTYPE html>
<html lang="ko">
<style>
    #ax5ui-detail td[data-ax5grid-column-colindex="12"][data-ax5grid-column-row="1"],
    div[data-ax5grid="ordrs-detail"] td[data-ax5grid-column-colindex="12"][data-ax5grid-column-row="1"],
    
    #ax5ui-detail td[data-ax5grid-column-colindex="17"][data-ax5grid-column-row="1"],
    div[data-ax5grid="ordrs-detail"] td[data-ax5grid-column-colindex="17"][data-ax5grid-column-row="1"]
    {
        background-color: #FFB16D!important;
        background-image: none !important;
    }
    
    #ax5ui-detail td[data-ax5grid-column-colindex="15"][data-ax5grid-column-row="1"],
    
    div[data-ax5grid="ordrs-detail"] td[data-ax5grid-column-colindex="15"][data-ax5grid-column-row="1"]
    {
        background-color: #98FB98!important;
        background-image: none !important;
    }
    
    td[data-ax5grid-column-key="estEpctMatPrc"] {
        background-color: #D8BFD8!important;
        background-image:none!important;
    }
    
    .ordar, .file {
        background-color: white;
        visibility: hidden;
    }

    .grid-cell-blue {
        background: #dcf0f8;
    }

    .file, .ordar {
        min-height: 800px;
        float: left;
    }
    
    .grid-cell-yellow{
			background-color: #f5f7ad!important;
			background-image: none !important;
	}
    
    ul.ul_list.type03-est li {
        width: calc(100% - 6px);
        float: left;
    }

    ul.ul_list.type03-est li:nth-child(odd) {
        clear: left;
    }

    /* ul.ul_list.type03-est li + li {
    } */

    @media only screen and (max-width: 767px) {
        .file, .ordar {
            width: 100%;
        }
    }

    @media only screen and (min-width: 768px) {
        .file, .ordar {
            width: 50%;
        }
    }
</style>

<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="/static/fontawesome/css/all.css">
<link rel="stylesheet" href="/static/css/ax5/ax5grid.css">
<link rel="stylesheet" href="/static/css/ax5/ax5mask.css">
<link rel="stylesheet" href="/static/css/ax5/ax5modal.css">
<link rel="stylesheet" href="/static/css/ax5/ax5toast.css">
<link rel="stylesheet" href="/static/css/ax5/ax5menu.css">
<link rel="stylesheet" href="/static/css/ax5/ax5calendar.css">
<link rel="stylesheet" href="/static/css/ax5/ax5picker.css">
<link rel="stylesheet" href="/static/css/jstree/style.min.css">
<link rel="stylesheet" href="/static/css/ax5/ax5combobox.css">
<link rel="stylesheet" href="/static/css/ax5/ax5select.css">
<link rel="stylesheet" href="/static/css/gnb.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/sub.css">
<link rel="stylesheet" href="/static/css/common.css">

<script src="/static/js/jquery-latest.min.js"></script>
<script src="/static/js/jquery.serializeObject.js"></script>
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
<script src="/static/js/moment/moment-with-locales.js"></script>
<script src="/static/js/jstree/jstree.min.js"></script>
<script src="/static/js/ax5/ax5core.min.js"></script>
<script src="/static/js/ax5/ax5grid.min.js"></script>
<script src="/static/js/ax5/ax5mask.min.js"></script>
<script src="/static/js/ax5/ax5modal.min.js"></script>
<script src="/static/js/ax5/ax5toast.min.js"></script>
<script src="/static/js/ax5/ax5calendar.min.js"></script>
<script src="/static/js/ax5/ax5picker.min.js"></script>
<script src="/static/js/ax5/ax5menu.min.js"></script>
<script src="/static/js/ax5/ax5formatter.min.js"></script>
<script src="/static/js/ax5/ax5combobox.min.js"></script>
<script src="/static/js/ax5/ax5select.min.js"></script>

<script type="text/javascript" src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="/static/js/global.js"></script>
<script src="/static/js/fileTree.js"></script>
<script src="/static/js/jquery.blockUI.js"></script>
<!-- 도움말 팝업 -->
<script src="/static/js/manualPopup.js"></script>
</head>

<body>
	<div id="head_area"></div>
	<div id="top_area"></div>
	<div id="main_area">
        <input type="hidden" id="pgmId"  name="pgmId" value="CR0201M01">
		<input type="hidden" id="userId" name="userId">
		<!-- 페이지 상단 -->
        <div class="contents no_bg">
            <ul class="btn_ul">
                <li class="btn_r">
                    <a onclick="manualPopup();"> <button type="button" class="bg_gray" onclick="manualPopup();">도움말</button> </a>
                    <a onclick="initSearch();"><button class="bg_gray">초기화</button></a>
					<a onclick="gridView.setData(0);"><button class="bg_gray">검 색</button></a>
                </li>
            </ul>
        </div>
        

        <!-- 검색조건 -->
		<div class="contents search">
			<div class="">
				<!-- 테이블 인풋 3분할 -->
				<table class="table_input type03">
					<!-- 검색조건 1행 -->
					<tr>
						<th class="hit">회사</th>
						<td>
							<select id="coCd_S" name="coCd_S" data-kind="CO" data-search="coCd" required msg="회사" onchange="gridView.setData(0);">
							</select>
						</td>
					
						<th class="hit">수주일자</th>
						<td>
							<div class="date_input">
								<input type="text" id="strtDt_S" name="strtDt_S" class="input_calendar" autocomplete="off" onchange="gridView.setData(0);"
								required="required" msg="수주일자From" data-search="strtDt">
								<span>~</span>
								<input type="text" id="endDt_S" name="endDt_S" class="input_calendar" autocomplete="off" onchange="gridView.setData(0);"
								required="required" msg="수주일자To"data-search="endDt">
							</div>
						</td>
					
						<th class="">고객사</th>
						<td>
							<input type="hidden" id="ordrsClntCd_S" name="ordrsClntCd_S" data-search="ordrsClntCd">
							<div class="search_form">
								<input type="text" id="ordrsClntNm_S" name="ordrsClntNm_S" data-search="ordrsClntNm"
								onkeyup="event.keyCode == 8 ? ordrsClntCd_S.value = '' : event.keyCode == 13 ? gridView.setData(0) : ''">
								<a onclick="opendClntSearch($('#ordrsClntNm_S').val());"><i class="i_search_w"></i></a>
							</div>
						</td>
					</tr>

					<!-- 검색조건 2행 -->
					<tr>
						<th>수주번호</th>
						<td>
							<div class="search_form" >
								<input type="text"  id="ordrsNo_S" name="ordrsNo_S" data-search="ordrsNo"
								onkeyup="event.keyCode == 13 ? gridView.setData(0) : ''">
								<a onclick="opendOrdrsSearch($('#ordrsNo_S').val(), $('#coCd_S').val());"><i class="i_search_w" ></i></a>
							</div>
						</td>
					
						<th>고객사PJT</th>
						<td>
                            <select id="clntPjt_S" name="clntPjt_S" data-kind="PRJCTCD" data-search="clntPjt" onchange="gridView.setData(0);">
								<option value="">전체</option>
							</select>
						</td>
						
						<th>계약명</th>
						<td>
							<input type="text" id="ctrtNm_S" name="ctrtNm_S" data-search="ctrtNm"
							 onkeyup="event.keyCode == 13 ? gridView.setData(0) : '' ">
						</td>
					</tr>

					<!-- 검색조건 3행 -->
					<tr>
						<th>수주구분</th>
						<td>
							<select id="ordrsDiv_S" name="ordrsDiv_S" data-kind="ORDRSDIV" data-search="ordrsDiv" onchange="gridView.setData(0);">
								<option value="">전체</option>
							</select>
						</td>
					</tr>
				</table>
			</div>
		</div>
		<!-- 검색조건 END -->

        <div class="contents no_bg">
            <!-- 콘텐츠 타이틀 -->
            <div class="contents_tit">
                <div class="add_btn_small pdl10">
                    <a onclick="insertProjectModal('C')" style="height: 30px; line-height: 28px;" authchk>+</a>
                    <a onclick="deleteEst()" style="height: 30px; line-height: 28px;" authchk>-</a>
                    <!-- 엑셀다운로드 버튼 -->
					<a onclick="excelDown();" style="height: 30px; line-height: 28px; width: 90px;"><i class="fas fa-file-excel"></i> 엑셀다운로드</a>
                </div>
                <!-- 검색되는 ROW수 -->
				<select id="recordCnt" class="prae_select" onchange="gridView.setData(0);">
					<option value="10">10</option>
					<option value="25" selected>25</option>
					<option value="50">50</option>
					<option value="100">100</option>
					<option value="9999999">전체</option>
				</select>
                
            </div>
        </div>
    
        <div class="contents">
            <div class="ax5_grid">
                <ul class="ul_list type03-est">
                    <li>
                        <div>
                            <div data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 730px; width: 100%"></div>
                            <div data-ax5grid="grid1_excel" data-ax5grid-config="{}" style="display: none;"></div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</body>

<script type="text/javascript">
    var isFirst = true;
    let select_index = null;
    
    var gridView = {
        initView: function () {
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                frozenColumnIndex : 7,
				showLineNumber    : false,
				showRowSelector   : true,
	//			multipleSelect    : true,
				sortable          : false,
                target: $('[data-ax5grid="first-grid"]'),
                header: {
                    align: "center",
                    selector: false
                },
                body: {
                	mergeCells : ["rrn", "fileTrgtKey", "coCd", "coNm", "ordrsNo", "ioDt", "clntCd", "clntNm", "clntPjt", "clntPjtNm", "ctrtNm", "ordrsAmt"
                                ,"estNo", "estDeg"],
                    onClick: function () {
                         var list = gridView.target.getList("selected");
                        
                          $.each(list, function(idx, obj){
                              gridView.target.select(obj.__index, {selected: false});
                          });
                         if(this.item.lvl == '2' || this.item.lvl == '1'){
                             this.self.select(this.dindex);
                         }
                         select_index = this.doindex;
                    },
                    onDBLClick: function () {
                        insertProjectModal("U", this.doindex);
                    },
                },
                page: {
                    navigationItemCount: 10,
                    height: 30,
                    display: true,
                    firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
                    prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
                    nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                    lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
                    
                    onChange: function () {
                        gridView.setData(this.page.selectPage);
                    }
                },

                /*
                * TB_CR02M01
                * */
                columns: [
                    {key: "fileTrgtKey", label: "파일대상KEY", align: "center", width: 50 , hidden: true},
                    {key: "coCd"       , label: "회사코드"   , align: "center", width: 100, enableFilter: true, hidden: true},
                    {key: "coNm"       , label: "회사명"     , align: "center", width: 100, enableFilter: true, hidden: true},
                    {key: "clntCd"     , label: "고객사코드" , align: "center", width: 100, hidden: true},
                    //{key: "ordrsClntNm", label: "고객사명", align: "center", width: 100},
                    {key: "lvl", label: "레벨", align: "center", width: 30, hidden: true},
                    {key: "ioSeq", label: "SEQ", align: "center", width: 40, hidden: true},
                    {key: "clntNm"     , label: "고객사명"   , align: "left"  , width: 100,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    	},
                    {key: "clntPjt"    , label: "고객사PJT"  , align: "left"  , width: 80, hidden: true},
                    {key: "clntPjtNm"    , label: "고객사PJT"  , align: "left"  , width: 80,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "ordrsNo"    , label: "수주번호"   , align: "center", width: 70, hidden: true},
                    {key: "rrn"     , label: "No."   , align: "center"  , width: 40,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "ctrtNm"     , label: "계약명"     , align: "left", width: 150,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    //{key: "currNm", label: "통화단위", align: "center", width: 100},f
                    {key: "ordrsAmt"   , label: "수주금액<br>(단위:천원)"   , align: "right" , width: 90, formatter: "money",
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "ioDt"       , label: "수주일자"   , align: "center", width: 80,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    //{key: "fwdExchJoinDt", label: "선물환가입일", align: "center", width: 100},
                    //{key: "fwdExchChkList", label: "선물환 Check List", align: "center", width: 100},
                    //{key: "ordrger", label: "발주자", align: "center", width: 100},
                    // {key: "mngId", label: "담당자", align: "center", width: 100},
                    // {key: "ctrtDoc", label: "계약문서", align: "center", width: 100},
                    // {key: "pmntMtdNm", label: "결재방법", align: "center", width: 100},
                    {key: "pid"        , label: "PID"      , align: "center", width: 150, hidden: true},
					{key: "id"         , label: "ID"       , align: "center", width: 150, hidden: true},
					{key: "mngNm"     , label: "담당자"     , align: "center" , width: 100 ,
						styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
					},
					{key: "salesCd"     , label: "수주번호/salesCd"     , align: "left"  , width: 165 , hidden: false, treeControl: true,
						styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
					},
					{key: "lvl"        , label: "lvl"      , align: "center", width: 80 , hidden: true},
                    //TB_CR02D02테이블 컬럼
         //           {key: "ioSeq"          , label: "수주seq"       , align: "right" , width: 60, hidden: true},
                    {key: "ordrsDtlDiv10Nm", label: "입력구분"      , align: "center", width: 60,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "prdtCd"         , label: "제품구분코드"  , align: "center", width: 80, hidden: true},
                    {key: "prdtNm"         , label: "제품구분"      , align: "center", width: 150,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "itemDiv"        , label: "아이템구분코드", align: "center", width: 80, hidden: true},
                    {key: "itemDivNm"      , label: "아이템구분"    , align: "center", width: 80,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "ordrsDtlDiv20Nm", label: "작업구분"      , align: "center", width: 60,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "ordrsDtlDiv30Nm", label: "자체구분"      , align: "center", width: 60,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "mctypeNm"	   , label: "기계구분"      , align: "center", width: 60,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "eqpNm"          , label: "설비명"        , align: "left", width: 150,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "dudtIntendDt"   , label: "납기예정일"        , align: "center", width: 100,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: undefined, 		 label: "수주가(단위:천원)", 
						columns: [
		                    {key: "ordrsPrcMach"   , label: "기계Part<br>(단위:천원)"      , align: "right", formatter: "money", width: 80,
		                    	styleClass: function () {
									if (this.item.collapse === "2") {
										styleClass = "grid-cell-yellow";
									} else if (this.item.collapse === "3"){
										styleClass = "grid-cell-red";
									} else {
										styleClass = "";
									}
									return styleClass;
								}
		                    },
		                    {key: "ordrsPrcElcty"  , label: "전기Part<br>(단위:천원)"      , align: "right", formatter: "money", width: 80,
		                    	styleClass: function () {
									if (this.item.collapse === "2") {
										styleClass = "grid-cell-yellow";
									} else if (this.item.collapse === "3"){
										styleClass = "grid-cell-red";
									} else {
										styleClass = "";
									}
									return styleClass;
								}
		                    },
		                    {
		                        key: "ordrsPrc", label: "합계<br>(단위:천원)", align: "right", width: 80,
				                        styleClass: function () {
											if (this.item.collapse === "2") {
												styleClass = "grid-cell-yellow";
											} else if (this.item.collapse === "3"){
												styleClass = "grid-cell-red";
											} else {
												styleClass = "";
											}
											return styleClass;
										},
		                        formatter: function () {
		                            color = '#0000FF';
		                            const ordrsPrcMach = isNaN(parseFloat(this.item.ordrsPrcMach)) ? 0 : parseFloat(this.item.ordrsPrcMach);
		                            const ordrsPrcElcty = isNaN(parseFloat(this.item.ordrsPrcElcty)) ? 0 : parseFloat(this.item.ordrsPrcElcty);
		                            const sum = ordrsPrcMach + ordrsPrcElcty;
		                            return '<div style="color: ' + color + '">' + sum.toLocaleString() + '</div>';
		                        }
		                    }
		                    ]
                    },
                    
                    {key: "ordrsQty", label: "수량", align: "right", width: 60,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "estEpctMatPrc", label: "견적 예상 재료비 <br> (단위:천원)",  formatter: "money", align: "right", width: 100,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: undefined, label: "목표구매원가(단위:천원)",
						columns: [
							{key: undefined, label: "목표구매원가",
								columns: [
						                    {key: "trgtPchsPcostMach", label: "기계",  formatter: "money", align: "right", width: 80,
						                    	styleClass: function () {
													if (this.item.collapse === "2") {
														styleClass = "grid-cell-yellow";
													} else if (this.item.collapse === "3"){
														styleClass = "grid-cell-red";
													} else {
														styleClass = "";
													}
													return styleClass;
												}
						                    },
						                    {key: "trgtPchsPcostElcty", label: "전기", formatter: "money", align: "right", width: 80,
						                    	styleClass: function () {
													if (this.item.collapse === "2") {
														styleClass = "grid-cell-yellow";
													} else if (this.item.collapse === "3"){
														styleClass = "grid-cell-red";
													} else {
														styleClass = "";
													}
													return styleClass;
												}
						                    },
						                    {
						                        key: "sum",
						                        label: "합계",
						                        align: "right",
						                        width: 80,
							                        styleClass: function () {
														if (this.item.collapse === "2") {
															styleClass = "grid-cell-yellow";
														} else if (this.item.collapse === "3"){
															styleClass = "grid-cell-red";
														} else {
															styleClass = "";
														}
														return styleClass;
													},
						                        formatter: function () {
						                            color = '#0000FF';
						                            const trgtPchsPcostMach = isNaN(parseFloat(this.item.trgtPchsPcostMach)) ? 0 : parseFloat(this.item.trgtPchsPcostMach);
						                            const trgtPchsPcostElcty = isNaN(parseFloat(this.item.trgtPchsPcostElcty)) ? 0 : parseFloat(this.item.trgtPchsPcostElcty);
						                            const sum = trgtPchsPcostMach + trgtPchsPcostElcty;
						                            return '<div style="color: ' + color + '">' + sum.toLocaleString() + '</div>';
						                        }
						                    },
						                  ]
							},
							{key: undefined, label: "자체가공 투입시<br>기계부문 목표원가",
								columns: [
						                    {key: "trgtPchsPcostInHousePrcsn", label: "자체가공",  formatter: "money", align: "right", width: 80,
						                    	styleClass: function () {
													if (this.item.collapse === "2") {
														styleClass = "grid-cell-yellow";
													} else if (this.item.collapse === "3"){
														styleClass = "grid-cell-red";
													} else {
														styleClass = "";
													}
													return styleClass;
												}
						                    },
						                    {
						                        key: "machineValueAfterDeduction",
						                        label: "차감 후 기계값",
						                        align: "right",
						                        width: 100,
							                        styleClass: function () {
														if (this.item.collapse === "2") {
															styleClass = "grid-cell-yellow";
														} else if (this.item.collapse === "3"){
															styleClass = "grid-cell-red";
														} else {
															styleClass = "";
														}
														return styleClass;
													},
						                        formatter: function () {
						                            color = '#0000FF';
						                            const trgtPchsPcostMach = isNaN(parseFloat(this.item.trgtPchsPcostMach)) ? 0 : parseFloat(this.item.trgtPchsPcostMach);
						                            const trgtPchsPcostInHousePrcsn = isNaN(parseFloat(this.item.trgtPchsPcostInHousePrcsn)) ? 0 : parseFloat(this.item.trgtPchsPcostInHousePrcsn);
						                            const sum = trgtPchsPcostMach - trgtPchsPcostInHousePrcsn;
						                            return '<div style="color: ' + color + '">' + sum.toLocaleString() + '</div>';
						                        }
						                    },
						                  ]
							},
				              ]
                    },
                    {key: undefined, label: "실집행원가",
						columns: [
									{key: undefined, label: "노무비 및 제조경비 <br> (판관비 제외)",
										columns: [
		                    						{key: "laborCostMfgCost", label: "금액",  formatter: "money", align: "right", width: 100,
		                    							styleClass: function () {
		                    								if (this.item.collapse === "2") {
		                    									styleClass = "grid-cell-yellow";
		                    								} else if (this.item.collapse === "3"){
		                    									styleClass = "grid-cell-red";
		                    								} else {
		                    									styleClass = "";
		                    								}
		                    								return styleClass;
		                    							}
		                    						},
		                    					 ]
									},
                    			]
                    },
                    {key: "estNo"      , label: "견적번호"   , align: "center", width: 100, enableFilter: true,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "estDeg"     , label: "차수"       , align: "center", width: 40, enableFilter: true,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    
                    {key: "creatId"  , label: "생성자"  , align: "center", width: 80, hidden: true},
                    {key: "creatIdNm", label: "생성자"  , align: "center", width: 80,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "creatDttm", label: "생성일시", align: "center", width: 80,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "udtId"    , label: "수정자"  , align: "center", width: 80, hidden: true},
                    {key: "udtIdNm"  , label: "수정자"  , align: "center", width: 80,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    },
                    {key: "udtDttm"  , label: "수정일시", align: "center", width: 80,
                    	styleClass: function () {
							if (this.item.collapse === "2") {
								styleClass = "grid-cell-yellow";
							} else if (this.item.collapse === "3"){
								styleClass = "grid-cell-red";
							} else {
								styleClass = "";
							}
							return styleClass;
						}
                    }
                ],
                tree : {
					use         : true,
					indentWidth : 15,
					arrowWidth  : 15,
					iconWidth   : 18,
					icons: {
						openedArrow        : '<i class="fa fa-caret-down"  aria-hidden="true"></i>',
						collapsedArrow     : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
						groupIcon          : '<i class="fa fa-folder-open" aria-hidden="true"></i>',
						collapsedGroupIcon : '<i class="fa fa-folder"      aria-hidden="true"></i>',
						itemIcon           : '<i class="fa fa-file"        aria-hidden="true"></i>'
					},
					columnKeys : {
						parentKey : "pid",
						selfKey   : "id"
					}
				}
            });
            return this;
        },
        setData: function (_pageNo) {
            if (isFirst) return;
            var formData = {};
            var gridViewIn = this.target;
            if (inputValidation($('input[required]'))) {
                $.each($('[data-search]'), function(idx, elem){
					formData[$(elem).data("search")] = $(elem).val();
				});

				formData["strtDt"] = $("#strtDt_S").val().replace(/\-/g, '');
				formData["endDt"] = $("#endDt_S").val().replace(/\-/g, '');
				formData["pageNo"] = _pageNo + 1;
				formData["recordCnt"] = $("#recordCnt").val();
 
                postAjax("/user/cr/cr02/selectOrdrsList", formData, null, function (data) {
                    var list = data.ordrsList;
                    gridViewIn.setData({
                        list: list,
                        page: {
                            currentPage: _pageNo,
                            pageSize: data.paginationInfo.pageSize,
                            totalElements: data.paginationInfo.totalRecordCount,
                            totalPages: data.paginationInfo.totalPageCount
                        }
                    });
                });
            }
        }
    }
    
    
    var excelView = {
    		initView: function(){
    			this.target = new ax5.ui.grid();
    			this.target.setConfig({
    				target: $('[data-ax5grid="grid1_excel"]'),
    				columns: [
    					 	{key: "fileTrgtKey", label: "파일대상KEY", align: "center", width: 50 , hidden: true},
    	                    {key: "coCd"       , label: "회사코드"   , align: "center", width: 100, enableFilter: true, hidden: true},
    	                    {key: "coNm"       , label: "회사명"     , align: "center", width: 100, enableFilter: true, hidden: true},
    	                    {key: "clntCd"     , label: "고객사코드" , align: "center", width: 100, hidden: true},
    	                    //{key: "ordrsClntNm", label: "고객사명", align: "center", width: 100},
    	                    {key: "clntNm"     , label: "고객사명"   , align: "left"  , width: 100,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    	},
    	                    {key: "clntPjt"    , label: "고객사PJT"  , align: "left"  , width: 80, hidden: true},
    	                    {key: "clntPjtNm"    , label: "고객사PJT"  , align: "left"  , width: 80,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "ordrsNo"    , label: "수주번호"   , align: "center", width: 70, hidden: true},
    	                    {key: "rrn"     , label: "No."   , align: "center"  , width: 40,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "ctrtNm"     , label: "계약명"     , align: "left", width: 150,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "ordrsAmt"   , label: "수주금액<br>(단위:천원)"   , align: "right" , width: 90, formatter: "money",
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "ioDt"       , label: "수주일자"   , align: "center", width: 80,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "pid"        , label: "PID"      , align: "center", width: 150, hidden: true},
    						{key: "id"         , label: "ID"       , align: "center", width: 150, hidden: true},
    						{key: "mngNm"     , label: "담당자"     , align: "center" , width: 100 ,
    							styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    						},
    						{key: "salesCd"     , label: "수주번호/salesCd"     , align: "left"  , width: 165 , hidden: false, treeControl: true,
    							styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    						},
    						{key: "lvl"        , label: "lvl"      , align: "center", width: 80 , hidden: true},
    	                    //TB_CR02D02테이블 컬럼
    	                    {key: "ioSeq"          , label: "수주seq"       , align: "right" , width: 60, hidden: true},
    	                    {key: "ordrsDtlDiv10Nm", label: "입력구분"      , align: "center", width: 60, hidden: true},
    	                    {key: "prdtCd"         , label: "제품구분코드"  , align: "center", width: 80, hidden: true},
    	                    {key: "prdtNm"         , label: "제품구분"      , align: "center", width: 150,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "itemDiv"        , label: "아이템구분코드", align: "center", width: 80, hidden: true},
    	                    {key: "itemDivNm"      , label: "아이템구분"    , align: "center", width: 80,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "ordrsDtlDiv20Nm", label: "작업구분"      , align: "center", width: 60,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "ordrsDtlDiv30Nm", label: "자체구분"      , align: "center", width: 60,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "mctypeNm"	   , label: "기계구분"      , align: "center", width: 60,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "eqpNm"          , label: "설비명"        , align: "left", width: 150,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "dudtIntendDt"   , label: "납기예정일"        , align: "center", width: 100,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: undefined, 		 label: "수주가(단위:천원)", 
    							columns: [
    			                    {key: "ordrsPrcMach"   , label: "기계Part<br>(단위:천원)"      , align: "right", formatter: "money", width: 80,
    			                    	styleClass: function () {
    										if (this.item.collapse === "2") {
    											styleClass = "grid-cell-yellow";
    										} else if (this.item.collapse === "3"){
    											styleClass = "grid-cell-red";
    										} else {
    											styleClass = "";
    										}
    										return styleClass;
    									}
    			                    },
    			                    {key: "ordrsPrcElcty"  , label: "전기Part<br>(단위:천원)"      , align: "right", formatter: "money", width: 80,
    			                    	styleClass: function () {
    										if (this.item.collapse === "2") {
    											styleClass = "grid-cell-yellow";
    										} else if (this.item.collapse === "3"){
    											styleClass = "grid-cell-red";
    										} else {
    											styleClass = "";
    										}
    										return styleClass;
    									}
    			                    },
    			                    {
    			                        key: "ordrsPrc", label: "합계<br>(단위:천원)", align: "right", width: 80,
    					                        styleClass: function () {
    												if (this.item.collapse === "2") {
    													styleClass = "grid-cell-yellow";
    												} else if (this.item.collapse === "3"){
    													styleClass = "grid-cell-red";
    												} else {
    													styleClass = "";
    												}
    												return styleClass;
    											},
    			                    }
    			                    ]
    	                    },
    	                    
    	                    {key: "ordrsQty", label: "수량", align: "right", width: 60,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "estEpctMatPrc", label: "견적 예상 재료비 <br> (단위:천원)",  formatter: "money", align: "right", width: 100,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: undefined, label: "목표구매원가(단위:천원)",
    							columns: [
    								{key: undefined, label: "목표구매원가",
    									columns: [
    							                    {key: "trgtPchsPcostMach", label: "기계",  formatter: "money", align: "right", width: 80,
    							                    	styleClass: function () {
    														if (this.item.collapse === "2") {
    															styleClass = "grid-cell-yellow";
    														} else if (this.item.collapse === "3"){
    															styleClass = "grid-cell-red";
    														} else {
    															styleClass = "";
    														}
    														return styleClass;
    													}
    							                    },
    							                    {key: "trgtPchsPcostElcty", label: "전기", formatter: "money", align: "right", width: 80,
    							                    	styleClass: function () {
    														if (this.item.collapse === "2") {
    															styleClass = "grid-cell-yellow";
    														} else if (this.item.collapse === "3"){
    															styleClass = "grid-cell-red";
    														} else {
    															styleClass = "";
    														}
    														return styleClass;
    													}
    							                    },
    							                    {
    							                        key: "sum",
    							                        label: "합계",
    							                        align: "right",
    							                        width: 80,
    								                        styleClass: function () {
    															if (this.item.collapse === "2") {
    																styleClass = "grid-cell-yellow";
    															} else if (this.item.collapse === "3"){
    																styleClass = "grid-cell-red";
    															} else {
    																styleClass = "";
    															}
    															return styleClass;
    														},
    							                    },
    							                  ]
    								},
    								{key: undefined, label: "자체가공 투입시<br>기계부문 목표원가",
    									columns: [
    							                    {key: "trgtPchsPcostInHousePrcsn", label: "자체가공",  formatter: "money", align: "right", width: 80,
    							                    	styleClass: function () {
    														if (this.item.collapse === "2") {
    															styleClass = "grid-cell-yellow";
    														} else if (this.item.collapse === "3"){
    															styleClass = "grid-cell-red";
    														} else {
    															styleClass = "";
    														}
    														return styleClass;
    													}
    							                    },
    							                    {
    							                        key: "machineValueAfterDeduction",
    							                        label: "차감 후 기계값",
    							                        align: "right",
    							                        width: 100,
    								                        styleClass: function () {
    															if (this.item.collapse === "2") {
    																styleClass = "grid-cell-yellow";
    															} else if (this.item.collapse === "3"){
    																styleClass = "grid-cell-red";
    															} else {
    																styleClass = "";
    															}
    															return styleClass;
    														}
    							                    },
    							                  ]
    								},
    					              ]
    	                    },
    	                    {key: undefined, label: "실집행원가",
    							columns: [
    										{key: undefined, label: "노무비 및 제조경비 <br> (판관비 제외)",
    											columns: [
    			                    						{key: "laborCostMfgCost", label: "금액",  formatter: "money", align: "right", width: 100,
    			                    							styleClass: function () {
    			                    								if (this.item.collapse === "2") {
    			                    									styleClass = "grid-cell-yellow";
    			                    								} else if (this.item.collapse === "3"){
    			                    									styleClass = "grid-cell-red";
    			                    								} else {
    			                    									styleClass = "";
    			                    								}
    			                    								return styleClass;
    			                    							}
    			                    						},
    			                    					 ]
    										},
    	                    			]
    	                    },
    	                    {key: "estNo"      , label: "견적번호"   , align: "center", width: 100, enableFilter: true,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "estDeg"     , label: "차수"       , align: "center", width: 40, enableFilter: true,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    
    	                    {key: "creatId"  , label: "생성자"  , align: "center", width: 80, hidden: true},
    	                    {key: "creatIdNm", label: "생성자"  , align: "center", width: 80,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "creatDttm", label: "생성일시", align: "center", width: 80,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "udtId"    , label: "수정자"  , align: "center", width: 80, hidden: true},
    	                    {key: "udtIdNm"  , label: "수정자"  , align: "center", width: 80,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    },
    	                    {key: "udtDttm"  , label: "수정일시", align: "center", width: 80,
    	                    	styleClass: function () {
    								if (this.item.collapse === "2") {
    									styleClass = "grid-cell-yellow";
    								} else if (this.item.collapse === "3"){
    									styleClass = "grid-cell-red";
    								} else {
    									styleClass = "";
    								}
    								return styleClass;
    							}
    	                    }
    				],
    			});
    			return this;
    		}
    	}
    
    //화면로드시
    $(document).ready(function () {
        $("td").off("mouseover");
        mainDefaultLoad("영업관리", "수주 관리");
        setCommonSelect($("select[data-kind]"));
        
        $("#coCd_S").val(jwt.coCd);
        setByCoCd($("#coCd_S").val());

        // 시작일 (현재날짜의 월 첫일)
        $('#strtDt_S').datepicker({
            format: "yyyy-mm-dd",
            language: "ko",
            autoclose: true
        })
        .datepicker("setDate", moment(new Date()).startOf("month").toDate())
        .on("changeDate", function () {
            // gridView.setData(0);
            if ($('#strtDt_S').val() > $('#endDt_S').val()) {
                alert("날짜를 확인해주세요");
                $('#strtDt_S').datepicker("setDate", new Date($('#endDt_S').val()));
            }
        });

        // 종료일 (현재날짜의 월 말일)
        $('#endDt_S').datepicker({
            format: "yyyy-mm-dd",
            language: "ko",
            autoclose: true
        })
        .datepicker("setDate", moment(new Date()).endOf("month").toDate())
        .on("changeDate", function () {
            // gridView.setData(0);
            if ($('#strtDt_S').val() > $('#endDt_S').val()) {
                alert("날짜를 확인해주세요");
                $('#endDt_S').datepicker("setDate", new Date($('#strtDt_S').val()));
            }
        });

        // 검색조건 이벤트 bind
  		$('[data-search]').on("change", function(){
  			gridView.setData(0);
  		});

        isFirst = false;
        gridView.initView().setData(0);
        excelView.initView();
        
        //권한체크
  		authChk();
    })

    function initSearch() {
        $(".contents.search input[type='text']").val("");
        $("#searchValue_S option").eq(0).prop("selected", true);
        $("#coCd_S").val(jwt.coCd);
        $("#strtDt_S").val(dateToStr(moment(new Date()).startOf("month").toDate()));
        $("#endDt_S").val(dateToStr(moment(new Date()).endOf("month").toDate()));
        gridView.initView().setData(0);
    }

    function deleteEst() {
    	if (selectGridValidation(gridView.target)) return;
 //       var row = gridView.target.getList("selected")[0];
        var row = gridView.target.getList()[select_index];

        var formData = {
        	"fileTrgtKey" : row.fileTrgtKey,
        	"estNo" : row.estNo,
            "coCd": row.coCd,
            "lvl" : row.lvl,
            "ordrsNo": row.ordrsNo,
            "ordrsSeq": row.ioSeq,
            "ioDt" : row.ioDt,
            "userId" : jwt.userId,
            "fileTrgtTyp" : "CR0201M01"
        }
        if(row.ioDt == undefined){
        	alert('수주일자가 없습니다.');
        	return;
        }else{
            if(!monthCloseChk(row.ioDt, 'D')) return;  //마감일통제
        }
       	if (confirm("수주정보 전부를 삭제합니다. 삭제하시겠습니까?")) {
               deleteAjax("/user/cr/cr02/deleteOrdrs", formData, null, function (data) {
                   if (data.resultCode == 200) {
                       alert(data.resultMessage);
                   } else {
                       alert(data.resultMessage);
                   }
                   gridView.setData(0);
               });
         }    
    }

    function setReportMain() {
        var row = gridView.target.getList("selected")[0];
        var iChk;
        var rptName;
        if (row == undefined) {
            alert("출력할 견적자료를 선택하세요!");
            return;
        }
        var paramObj = {
            "iChk": iChk
        }
        openSecondModal("/static/html/user/cr/cr01/CR0303P01.html", 600, 300, "견적서 출력 선택", paramObj, function (rptName, iChk, imgPrt) {
            var arg = "i_est_no#" + row.estNo + "#"
                + "iChk#" + iChk + "#"
                + "imgPrt#" + imgPrt + "#";
            callReport(rptName, arg, 750, 900);
        });
    }

    // 판매법인 set
    function setByCoCd(value) {
        $('#main_area #taxivcCoprt').data("rprc", value);
        $('#main_area #taxivcCoprt option:not([value=""])').remove()
        setCommonSelect($('#main_area #taxivcCoprt'));
    }
    
    function insertProjectModal(type, __index = 0) {
    	if (type == 'U'){ //수정일때
    		var row = gridView.target.list[__index];

    		var paramObj = {
    			"actionType"  : type,
    			"fileTrgtKey" : row.fileTrgtKey,
    			"coCd"        : row.coCd,
    			"userId"      : jwt.userId,
    			"pgmId"       : "CR0201M01"
    		};
    	}
    	else {//신규등록일때
    		var paramObj = {
                "actionType"  : type,
                "fileTrgtKey" : 0,
                "coCd"        : $("#coCd_S").val(),
                "userId"      : jwt.userId,
                "pgmId"       : "CR0201M01"
            };
    	}

        openModal("/static/html/user/cr/cr02/CR0202P01.html", 1600, 835, "", paramObj,  function(data) {
        	DataSearch();
        });
    }

    function updateProjectModal(item) {
        var paramObj = {"actionType": "U", "coCd": item.coCd, "ordrsNo": item.ordrsNo, "fileTrgtKey": item.fileTrgtKey};
        openModal("/static/html/user/cr/cr02/CR0202P01.html", 1600, 835, "", paramObj);
    }

    function opendClntSearch(inputValue) {
		var paramObj = {
            "searchValue" : inputValue,
            "clntDivCd"   : "CLNTDIV12"
        };
        openModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색", paramObj, function (grid) {
            var row = grid.target.getList("selected")[0];
            $('#ordrsClntCd_S').val(row.clntCd);
            $('#ordrsClntNm_S').val(row.clntNm);
            gridView.setData(0);
        });
    }

    function opendOrdrsSearch(inputValue, coCd) {
        var paramObj = {
            "searchValue" : inputValue,
            "coCd" : coCd
        };
    	
        openModal("/static/html/cmn/modal/ordrsSearch.html", 1200, 420, "수주번호 검색", paramObj, function (grid) {
            var row = grid.target.getList("selected")[0];
            $('#ordrsNo_S').val(row.ordrsNo);
            gridView.setData(0);
        });
    }
    
    function excelDown() {
		var paramObj = {"pageNo": 1};
		$.each($('#main_area [data-search]'), function(idx, elem){
			paramObj[$(elem).data('search')] = elem.value;
		});
		paramObj.recordCnt = 99999999;
		paramObj["strtDt"] = $("#strtDt_S").val().replace(/\-/g, '');
		paramObj["endDt"]  = $("#endDt_S").val().replace(/\-/g, '');
		
        postAjax("/user/cr/cr02/selectOrdrsList", paramObj, null, function (data) {
			//var list = data.result;
			var list = data.ordrsList;
			excelView.target.setData({
				list : list,
				page : {
					totalElements : list.length,
				}
			});
			var todayDate = new Date().format('yyyyMMddHHmmss');
			excelView.target.exportExcel("수주관리_"+todayDate+".xls");
		});
	}

</script>
</html>
