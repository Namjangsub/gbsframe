<style>
* input[comma] {
  text-align: right;
 }
/* 인풋 테이블 2분할 */
.table_input.type08 tr td:nth-of-type(1) {
    width: 39%;
}

.table_input.type08 tr td:nth-of-type(2) {
    width: 59%;
}
.title_m_td {text-align:left; height:25px; background:#fff; font-weight:bold; color:blue; padding:5px;
}
</style>

<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">발주 등록</h4>
    </div>

  <form id="popForm" onSubmit="return false;">
    <div class="form-group popup_table">
      <input type="hidden" id="prjctInfo" style="display: none" multiple="multiple" onchange="setPrjct(this);">
      <input type="hidden" id="prjctSeq"  name="prjctSeq">
      <input type="hidden" id="pgmId"     name="pgmId" value="SM0101M01">
      <table>

        <colgroup>
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
        </colgroup>
        <tr>
        	<td colspan="8" class="title_m_td">기본정보</td>
        </tr>
        <tr>
			<th class="hit">회사</th>
			<td>
			  <select id="coCd_P" name="coCd_P" data-kind="CO" date-search="coCd"required="required" msg="회사">
			  </select>
			</td>
			<th class="hit">Sales Code</th>
			<td>
				<div class="search_form">
				    <input type="text" id="salesCd_P" name="salesCd_P" date-search="salesCd" required="required" msg="Sales Code">
				   	<a onclick="wbsSalesCodeSearch();"><i class="i_search_w"></i></a>
			    </div>
			</td>
			<th>고객사</th>
			<td>
				<input type="hidden" id="clntCd_P" name="clntCd_P"  data-search="clntCd">
				<div class="search_form">
					<input type="text" id="clntNm_P" name="clntNm_P" data-search="clntNm"> 
					<a onclick="openClntSearchP('P');"><i class="i_search_w"></i></a>
				</div>			
			</td>
			<th>고객사PJT</th>
			<td>
				<input type="text" id="clntPjt_P" name="clntPjt_P" date-search="clntPjt" msg="고객사PJT"> 
			</td>			
        </tr>
        <tr>
			<th>제품구분</th>
			<td>
				<input type="hidden" id="prdtCd_P" name="prdtCd_P" msg="제품구분">
				<input type="text" id="prdtCdNm_P" name="prdtCdNm_P" msg="제품구분">
			</td>
			<th>아이템구분</th>
			<td>
				<select id="itemDiv_S" name="itemDiv_S" data-kind="ITEMLIST" date-search="itemDiv" onchange="gridView.setData(0);">
			      <option value="">전체</option>
				</select>	
			</td>
			<th>설비명</th>
			<td colspan="0">
				<input type="text" id="eqpNm_P" name="eqpNm_P" date-search="reqNo" msg="설비명">
			</td>
			<th>요인별요청번호</th>
			<td>
				<input type="text" id="reqNo_P" name="reqNo_P" date-search="reqNo" msg="설비명">
			</td>			
        </tr>
        
        <tr>
        	<td colspan="8" class="title_m_td" style="">발주정보</td>
        </tr>     
        <tr>
			<th>발주번호</th>
			<td>
			  <input type="text" id="ordrgNo_P" name="ordrgNo_P" msg="">
			</td>
			<th class="hit">구매처</th>
			<td>
				<input type="hidden" id="pchsClntCd_P" name="pchsClntCd_P"  data-search="pchsClntCd">
				<div class="search_form">
					<input type="text" id="pchsClntNm_P" name="pchsClntNm_P"  data-search="pchsClntNm" onkeyup=""> 
					<a onclick="openClntSearchP('S');"><i class="i_search_w"></i></a>
				</div>
			</td>
			<th>발주일자</th>
			<td>
			              <div class="date_input">
			                <input id="ordrgDtFrom_P" name="ordrgDtFrom_P"  class="input_calendar" autocomplete="off"
			                  msg="발주 시작일자" data-search="ordrgDtFrom">
			              </div>			
			</td>
			<th>납기요청일자</th>
			<td>
			              <div class="date_input">
			                <input id="ordrgDtFrom_P" name="ordrgDtFrom_P"  class="input_calendar" autocomplete="off"
			                  msg="발주 시작일자" data-search="ordrgDtFrom">
			              </div>			
			</td>
        </tr>            
        <tr>
			<th class="hit">발주구분</th>
			<td>
				<select id="ordrgdiv10_P" name="ordrgdiv10_P" data-kind="ORDRGDIV10" data-search="ordrgdiv10">
			      <option value="">전체</option>
				</select>									  
			</td>
			<th class="hit">용도구분</th>
			<td>

			</td>
			<th class="hit">특성구분</th>
			<td>
			
			</td>
			<th>환율</th>
			<td>
			<input type="text" id="exrate_P" name="exrate_P"  data-search="exrate" onkeyup="">
			</td>
        </tr>
        <tr>    
			<th class="hit">통화단위</th>
			<td>
			  
			</td>
			<th class="hit">발주금액</th>
			<td>

			</td>
			<th>비고</th>
			<td colspan="3">
			
			</td>
        </tr>    
       
      </table>
    </form>

<!-- 하단 디테일그리드 -->
    <div class="popup_table" style="">
        <div class="toggle-div" style="padding-left: 0;">
            <div class="" style="padding-left: 0;">
                <div id="est_grid" class="contents"
                     style="margin:0px; padding:0px; height: 380px; width: 100%; min-width: 200px;border-radius:0;">
                    <div style="float:right" style="" class="add_btn pdl10">
                        <a id="addDetailButton" style="margin-top:8px">+</a>
                        <a id="deleteDetailButton" style="margin-top:8px;margin-right:8px;">-</a>
                    </div>

                    <h3 class="location">
                        <a class="file_tag" id="file_tag"
                           style="font-weight:bold ; color: blue; padding-left: 20px;padding-right: 10px;"></a>
                        <span class="page_tit" style="text-align: right;"></span>
                    </h3>
                    <div class="contents" style="margin:0px;padding:0 5px;height:80%; width:100%; min-width:300px">
                        <div data-ax5grid="approval-grid-modal" data-ax5grid-config="{}" style="height: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- 하단 디테일그리드 end -->
</div>
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtn" authChk>등록</button>
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>

<script type="text/javascript">
  
//전역초기화  
var actionType = null;
var paramPrjctSeq = null;

var firstGrid = null;
var secondGrid = null;

// 권한체크    
authChk();		
	
//구매 BOM
//gridViewPop.initView();	 	

//등록/수정 버튼
actionType = modalStack.last().paramObj.actionType;
if (actionType == "C") {
	$("#actionBtn").text("등록");
	$('#actionBtn').on("click", function() {
		insertOrder();
	});

} else if (actionType == "U") {
	$('.tit').text('발주 수정')
	
	//그리드 load
	gridViewPop.initView().setData(0);

	$('#actionBtn').text("수정");
	$('#actionBtn').on("click", function() {
		updateOrder();
	});
}	

// 등록 - done
function insertOrder() {
	if (inputValidation($('.popup_area [required]'))) {					// 필수 필드의 유효성 검사
		var formData = makeFormData();									// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
		var makeArr = {};
        //저장용 배열 push
		//makeArr = $.gridInsertArr(gridViewPop);	
        alert('작업중');
        return;
        
		filePostAjax("/user/sm/sm02/insertOrderMaster", formData,		// 파일을 포함한 데이터를 서버로 전송하는 비동기적인 AJAX 요청을 수행		
			function(data) {
				alert(data.resultMessage);								// 결과 메시지를 alert으로 출력
				if (data.resultCode == 200) {							//  요청이 성공(200)한 경우, gridViewPop.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
					gridView.setData(0);
					modalStack.close();									// 모달을 닫음
				}
		});
	}
}


// 거래처 검색
function openClntSearchP(openType) {
	var searchValueM = null;
	// P:고객사, S:구매처
	if(openType == "P") {
		searchValueM = $("#clntNm_P").val();
	} else if(openType == "S") {
		searchValueM = $("#pchsClntNm_P").val();
	}	
	var paramObj = {
			"searchValue" :  searchValueM
			, "clntDivCd" : "CLNTDIV12"		/*거래처 검색 기본값 고객사로 세팅 */
			, "pchsClntCd" : "CLNTDIV12"		/*구매처 팝업일 경우 구분자 고객사 제외하고 세팅 */				
	}		
	if(openType == "S") {
		paramObj.clntDivCd = null;
	}
	//발주관리에서 호출 플래그 추가
	paramObj.orderFlag = "Y";		
	openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색", paramObj, function (grid) {
		var row = grid.target.getList("selected")[0];
		//고객사 콤보 세팅
		if(openType == "P"){
			$('#clntCd_P').val(row.clntCd);
			$('#clntNm_P').val(row.clntNm);
		//구매처 콤보세팅
		} else if(openType == "S"){
			$('#pchsClntCd_P').val(row.clntCd);
			$('#pchsClntNm_P').val(row.clntNm);
		}
	});
} 

</script>