<div class="popup_area of_a" style="width: 100%; height: 100%;">
	<div class="tit_contents">
		<h4 class="tit">BOM 자재 수정</h4>
	</div>

	<div class="form-group popup_table">
		<form id="pop02Form" onSubmit="return false;">
			<input type="hidden" id="ordrsNo"     name="ordrsNo">
			<input type="hidden" id="upperCd"     name="upperCd">
			<input type="hidden" id="lowerCd"     name="lowerCd">
			<input type="hidden" id="matrSeq"     name="matrSeq">
			<input type="hidden" id="userId"      name="userId">
			<input type="hidden" id="pgmId"       name="pgmId" value="SM0101M01">
			<table>
				<colgroup>
					<col width="11%">
					<col width="14%">
					<col width="11%">
					<col width="14%">
					<col width="11%">
					<col width="14%">
					<col width="11%">
					<col width="14%">
				</colgroup>
				<!-- 1행 -->
				<tr>
					<th class="hit coCd">회사</th>
					<td>
						<select id="coCd" name="coCd" data-kind="CO" class="form-control input-sm" required msg="회사"></select>
					</td>

					<th>품번</th>
					<td>
						<input data-maxlength="20" type="text" id="matrCd" name="matrCd" class="form-control" readonly="readonly">
					</td>

					<th class="hit">품명</th>
					<td>
						<!--  한글입력일때는 byte ByteLength 필요없음 -->
						<!--  oninput="this.value=dataMaxLength(this.value,300)" onkeyup="this.value=this.value.replace(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/g,'');" -->
						<!--  onkeyup="this.value=this.value.replace(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/g,'');" onkeyup="this.value=this.value.replace(/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/g,'');" -->
						<input maxlength="300" type="text" id="matrNm" name="matrNm" class="form-control" required msg="품명">
					</td>

					<th>Sales Code</th>
					<td>
						<input type="text" id="salesCd" name="salesCd" class="form-control" readonly="readonly">
					</td>
				</tr>

				<!-- 2행 -->
				<tr>
					<th>발주용도</th>
					<td>
						<select id="ordrgDiv20" name="ordrgDiv20" data-kind="ORDRGDIV20" class="form-control input-sm" required msg="발주용도">
						</select>
					</td>

					<th>발주구분</th>
					<td>
						<select id="ordrgDiv10" name="ordrgDiv10" data-kind="ORDRGDIV10" class="form-control input-sm" required msg="발주구분"></select>
					</td>

					<th>BOM 수량</th>
					<td>
						<input data-positive comma type="text" id="bomQty" name="bomQty" class="form-control">
					</td>
					<th>소유량</th>
					<td>
						<input data-positive comma type="text" id="posQty" name="posQty" class="form-control">
					</td>
				</tr>

				<tr>
					<th>후행업체</th>
					<td colspan="3">
						<textarea data-maxlength="300" rows="1" id="nextPrcsnNm" name="nextPrcsnNm" class="form-control"  msg="후행업체"></textarea>
					</td>
					<th>배송처</th>
					<td colspan="3">
						<textarea data-maxlength="300" rows="1" id="dlvplcNm" name="dlvplcNm" class="form-control"  msg="배송처"></textarea>
					</td>
				</tr>

				<!-- 2행 -->
				<tr>
					<th class="hit">품목구분</th>
					<td>
						<select id="goodsDiv" name="goodsDiv" data-kind="GOODSDIV" class="form-control input-sm" required msg="품목구분">

						</select>
					</td>

					<th class="hit">거래처분류</th>
					<td>
						<select id="matrClntDiv" name="matrClntDiv" data-kind="MATRCLNTDIV" class="form-control input-sm" required msg="거래처분류"></select>
					</td>

					<th>자재유형</th>
					<td>
						<select id="matrDiv" name="matrDiv" data-kind="MATRDIV" class="form-control input-sm"></select>
					</td>

					<th>자재그룹</th>
					<td>
						<select id="matrGrp" name="matrGrp" data-kind="MATRGRP" class="form-control input-sm"></select>
					</td>
				</tr>

				<!-- 3행 -->
				<tr>
					<th>소재</th>
					<td>
						<input data-maxlength="50" type="text" id="matrMat" name="matrMat" class="form-control">
					</td>

					<th>Maker</th>
					<td>
						<input data-maxlength="300" type="text" id="matrMakrNm" name="matrMakrNm" class="form-control">
					</td>

					<th>규격</th>
					<td>
						<input onkeyup="this.value=this.value.replace(/[^0-9ØXxT/-]/g,'');" maxlength="50" type="text" id="matrSpec" name="matrSpec" class="form-control">
					</td>

					<!-- 기능버튼 -->
					<td colspan="2">
						<div>
							<button type="button" id="nrm_btn1" class="btn btn-default btn-sm" style="height: 25px; line-height: 15px;" onclick="NrmBtn(this.id);">Ø</button>
							<button type="button" id="nrm_btn2" class="btn btn-default btn-sm" style="height: 25px; line-height: 15px;" onclick="NrmBtn(this.id);">X</button>
							<button type="button" id="nrm_btn3" class="btn btn-default btn-sm" style="height: 25px; line-height: 15px;" onclick="NrmBtn(this.id);">T</button>
							<button type="button" id="nrm_btn4" class="btn btn-default btn-sm" style="height: 25px; line-height: 15px;" onclick="NrmBtn(this.id);">/</button>
							<button type="button" id="nrm_btn5" class="btn btn-default btn-sm" style="height: 25px; line-height: 15px;" onclick="NrmBtn(this.id);">-</button>
						</div>
					</td>
				</tr>

				<!-- 4행 -->
				<tr>
					<th>형번</th>
					<td>
						<input data-maxlength="100" type="text" id="matrMno" name="matrMno" class="form-control">
					</td>

					<th>관리단위</th>
					<td>
						<select id="matrUnit" name="matrUnit" data-kind="UNITDIV" class="form-control input-sm"></select>
					</td>

					<th>사이즈</th>
					<td>
						<input type="text" id="matrSize" name="matrSize" class="form-control">
					</td>

					<th>중량</th>
					<td>
						<input data-number comma type="text" id="matrWt" name="matrWt" class="form-control">
					</td>
				</tr>

				<!-- 5행 -->
				<tr>
					<th>구매업체1</th>
					<td><input type="hidden" id="pchsClntCd1" name="pchsClntCd1" msg="구매업체1">
						<div class="search_form" style="width: 100%;">
							<input type="text" id="pchsClntNm1" name="pchsClntNm1"
							 onkeyup="event.keyCode == 8 ? pchsClntCd1.value='' : event.keyCode == 13 ? ClntSearch('P', '1') : '' ">
							<a onclick="ClntSearch('P', '1');"><i class="i_search_w"></i></a>
						</div>
					</td>

					<th>구매/외주</th>
					<td>
						<select id="matrPurcDiv" name="matrPurcDiv" data-kind="MATRPURCDIV" class="form-control input-sm"></select>
					</td>

					<th>대표도번</th>
					<td>
						<input data-maxlength="20" type="text" id="matrDrwNo" name="matrDrwNo" class="form-control">
					</td>

					<th>2D설계소요일</th>
					<td>
						<input data-positive comma maxlength="5" type="text" id="dsgn2dMd" name="dsgn2dMd" class="form-control">
					</td>
				</tr>

				<!-- 6행 -->
				<tr>
					<th></th>
					<td>
						<input data-positive maxlength="3" type="text" id="pchsClntPct1" name="pchsClntPct1" class="form-control" style="display: none;">
					</td>

					<th>재고관리여부</th>
					<td>
						<select id="matrStockCd" name="matrStockCd" class="form-control input-sm">
							<option value="Y">관리</option>
							<option value="N">미관리</option>
						</select>
					</td>

					<th>원산지</th>
					<td>
						<input data-maxlength="300" type="text" id="originNm" name="originNm" class="form-control">
					</td>

					<th>2D평균소요일</th>
					<td>
						<input data-positive comma maxlength="5" type="text" id="avrg2dMd" name="avrg2dMd" class="form-control">
					</td>
				</tr>

				<!-- 7행 -->
				<tr>
					<th>구매업체2</th>
					<td><input type="hidden" id="pchsClntCd2" name="pchsClntCd2" msg="구매업체2">
						<div class="search_form" style="width: 100%;">
							<input type="text" id="pchsClntNm2" name="pchsClntNm2"
							 onkeyup="event.keyCode == 8 ? pchsClntCd2.value='' : event.keyCode == 13 ? ClntSearch('P', '2') : '' ">
							<a onclick="ClntSearch('P', '2');"><i class="i_search_w"></i></a>
						</div>
					</td>

					<th>입고검사구분</th>
					<td>
						<select id="matrTestDiv" name="matrTestDiv" data-kind="MATRTESTDIV" class="form-control input-sm"></select>
					</td>

					<th>최소발주량</th>
					<td>
						<input data-positive comma maxlength="13" type="text" id="minOrdrgQty" name="minOrdrgQty" class="form-control">
					</td>

					<th>3D설계소요일</th>
					<td>
						<input data-positive comma maxlength="5" type="text" id="dsgn3dMd" name="dsgn3dMd" class="form-control">
					</td>
				</tr>

				<!-- 8행 -->
				<tr>
					<th></th>
					<td>
						<input data-positive maxlength="3" type="text" id="pchsClntPct2" name="pchsClntPct2" class="form-control" style="display: none;">
					</td>

					<th>설계대상구분</th>
					<td>
						<select id="dsgnTrgtYn" name="dsgnTrgtYn" class="form-control input-sm">
							<option value="Y">대상</option>
							<option value="N">미대상</option>
						</select>
					</td>
					<th>안전재고</th>
					<td>
						<input data-positive comma maxlength="13" type="text" id="matrSaftQty" name="matrSaftQty" class="form-control">
					</td>

					<th>3D평균소요일</th>
					<td>
						<input data-positive comma maxlength="5" type="text" id="avrg3dMd" name="avrg3dMd" class="form-control">
					</td>
				</tr>

				<!-- 9행 -->
				<tr>
					<th>구매업체3</th>
					<td><input type="hidden" id="pchsClntCd3" name="pchsClntCd3" msg="구매업체3">
						<div class="search_form" style="width: 100%;">
							<input type="text" id="pchsClntNm3" name="pchsClntNm3"
							 onkeyup="event.keyCode == 8 ? pchsClntCd1.value='' : event.keyCode == 13 ? ClntSearch('P', '3') : '' ">
							<a onclick="ClntSearch('P', '3');"><i class="i_search_w"></i></a>
						</div>
					</td>

					<th class="hit">사용여부</th>
					<td>
						<select id="useYn" name="useYn" class="form-control input-sm" required msg="사용여부">
							<option value="Y">사용</option>
							<option value="N">미사용</option>
						</select>
					</td>

					<th>리드타임</th>
					<td>
						<input data-positive comma maxlength="5" type="text" id="dlvrRqmDay" name="dlvrRqmDay" class="form-control">
					</td>

					<th>최종생산소요일</th>
					<td>
						<input data-positive comma maxlength="5" type="text" id="prdctnRqmMd" name="prdctnRqmMd" class="form-control">
					</td>
				</tr>

				<!-- 10행 -->
				<tr>
					<th></th>
					<td>
						<input data-positive maxlength="3" type="text" id="pchsClntPct3" name="pchsClntPct3" class="form-control" style="display: none;">
					</td>

					<th>최종구매단가</th>
					<td>
						<input data-money type="text" id="matrUpr" name="matrUpr" class="form-control" readonly="readonly">
					</td>

					<th>최종거래일자</th>
					<td>
						<input type="text" id="matrLastTrstDt" name="matrLastTrstDt" class="input_calendar form-control" autocomplete="off" date>
					</td>

					<th>평균생산소요일</th>
					<td>
						<input data-positive comma maxlength="5" type="text" id="prdctnAvrgMd" name="prdctnAvrgMd" class="form-control">
					</td>
				</tr>
				<!-- 11행 -->
				<tr>
					<th>비고</th>
					<td colspan="7">
						<textarea data-maxlength="2000" rows="3" id="matrRmk" name="matrRmk" class="form-control" msg="비고"></textarea>
					</td>
				</tr>
			</table>
		</form>
	</div>


	<br>
	<div class="col-xs-2" style="height: 70px;">
	</div>
</div>

<!-- 하단 버튼 -->
<div class ="popup_bottom_btn">
	<button type="button" id="actionBtn02" authChk>적용</button>
	<button type="button" class="close_btn" onclick="modalStack.close();">닫기</button>
</div>

<script type="text/javascript">
	var actionType = null;

	let selectData = null;

	$(document).ready(function() {
		setComboOptions($(".popup_area select[data-kind]"));
		// setByCoCd(modalStack.last().paramObj.coCd);
		setByCoCd('GUN');

		$("#pop02Form #userId").val(jwt.userId);

		actionType = modalStack.last().paramObj.actionType;

		$('#goodsDiv option[value = "GOODSDIV01"]').remove();

		if (actionType == "C") {

			$('#pop02Form .coCd').addClass('hit');
			$('#pop02Form input#coCd').attr('required', 'required');

			//버튼명 변경
			//$("#actionBtn").text("등록");

			//버튼 클릭 시
			$('#actionBtn02').on("click", function() {
				//insertBomMatr();
			});
		} else if (actionType == "U") {

			//타이틀명 변경
			$('.tit').text('BOM 자재 수정')

			//회사
			//$("#coCd").prop("disabled", true);
			$('#pop02Form .coCd').removeClass('hit');
			$('#coCd').css({'background-color':'#e6e6e6', 'pointer-events':'none'});
			//품번
			$("#matrCd").prop("readonly", true);

			//수정 모드 데이터 가져오기
			var sendLowData = modalStack.last().paramObj.sendLowData;
			selectData = JSON.parse(sendLowData);

			loadFormData("#pop02Form", selectData);
			//selectBomMatrInfo();

			//버튼명 변경
			$('#actionBtn02').text("적용");

			//버튼 클릭 시
			$('#actionBtn02').on("click", function() {
				//updateBomMatr();
				sendMatrData();
			});
		}

		authChk(); //권한체크
	});

	//입력정보
	function selectBomMatrInfo() {
		if(selectData){
			$.each(selectData, function(key, value) {
				if ($('#pop02Form #' + key)[0]) {
					$('#pop02Form #' + key).val(value);

					if ($('#pop02Form #' + key).is('[comma]')) {
						onlyNumber($('#pop02Form #' + key)[0]);
					}
				}
			});
		}
	}

	function sendMatrData() {
		// 금액 콤마 제거
		/*
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		//[data-money]
		$.each($('.popup_area input[data-money]'), function(idx, elem) {
			deleteComma(elem);
		});
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		*/

		var data = getSaveData("#pop02Form");
		modalStack.last().callback(data);
		modalStack.close();
	}

	// 버튼 클릭 시 규격값 + 처리
	// 규격 버튼
	function NrmBtn(buttonId) {
		const matrSpec = $('#matrSpec').val();

		if (buttonId === "nrm_btn1") {
			// ∅ 파이 : &#8709;
			//$('#matrSpec').val(matrSpec + '∅'); // ?로 들어감
			$('#matrSpec').val(matrSpec + "Ø");
		} else if(buttonId === "nrm_btn2") {
			// X
			$('#matrSpec').val(matrSpec + "X");
		} else if(buttonId === "nrm_btn3") {
			// T
			$('#matrSpec').val(matrSpec + "T");
		} else if(buttonId === "nrm_btn4") {
			// /
			$('#matrSpec').val(matrSpec + "/");
		} else if(buttonId === "nrm_btn5") {
			// -
			$('#matrSpec').val(matrSpec + "-");
		}
	}

	// 거래처 검색
	function ClntSearch(openType, gbn) {

		var paramObj = {};
		//debugger;
		if (gbn == "1") {
			paramObj = {"searchValue" : $("#pchsClntNm1").val()}
		} else if (gbn == "2") {
			paramObj = {"searchValue" : $("#pchsClntNm2").val()}
		} else if (gbn == "3") {
			paramObj = {"searchValue" : $("#pchsClntNm3").val()}
		}

		openThirdModal("/static/html/cmn/modal/clntSearch.html", 650, 650, "거래처 검색", paramObj, function (grid) {
			var row = grid.target.getList("selected")[0];
			if(gbn == "1"){
				$('#pchsClntCd1').val(row.clntCd);
				$('#pchsClntNm1').val(row.clntNm);
			}else if(gbn == "2"){
				$('#pchsClntCd2').val(row.clntCd);
				$('#pchsClntNm2').val(row.clntNm);
			}else if(gbn == "3"){
				$('#pchsClntCd3').val(row.clntCd);
				$('#pchsClntNm3').val(row.clntNm);
			}
		});
	}

	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();
	}

</script>