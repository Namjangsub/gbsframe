<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">구매BOM 엑셀업로드</h4>
    </div>
  <div class="form-group popup_table">
   <form id="popForm" onSubmit="return false;" method="post" enctype="multipart/form-data">
		<input type="hidden" id="userId" name="userId">
		<input type="hidden" id="fileTrgtTyp" name="fileTrgtTyp" value="SM0101M01">
		<input type="hidden" id="pgmId" name="pgmId" value="SM0101M01">
		<input type="hidden" id="fileTrgtKey" name="fileTrgtKey">
      <table>

        <colgroup>
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
        </colgroup>

        <tr>
			<th class="hit">회사</th>
			<td>
			  <select id="coCd" name="coCd" data-kind="CO" class="form-control" required="required" msg="회사" readonly="readonly">
			  </select>
			</td>
			<th class="hit">Sales Code</th>
			<td>
				<input type="text" id="salesCd" name="salesCd" class="form-control" required="required" msg="Sales Code" readonly="readonly">
			</td>
			<th>고객사</th>
			<td>
				<input type="text" id="clntNm" name="clntNm" class="form-control" msg="고객사" readonly="readonly">
			</td>
			<th>고객사PJT</th>
			<td>
				<input type="text" id="clntPjt" name="clntPjt" class="form-control" msg="고객사PJT" readonly="readonly">
			</td>
        </tr>

        <tr>
			<th>Excel Upload</th>
			<td colspan="3" style="height:38px;">
				<input type="file" style="width:400px;float:left;margin-left:20px;margin-top:3px;" class="form-control input-sm" id="fileInput" name="fileInput" multiple="multiple">
				<button style="width:100px;float:left;margin-left:20px;" class="btn btn-primary btn-sm" type="button" disabled="disabled" id="actionExcel">업로드엑셀</button>
			</td>
			<th>Excel Download</th>
			<td colspan="3" style="height:38px;">
				<button style="width:100px;float:left;margin-left:20px;" class="btn btn-primary btn-sm" type="button" disabled="disabled" id="downloadExcel">다운로드</button>
			</td>
        </tr>

      </table>
    </form>

	<!-- 콘텐츠 -->
	  <div class="contents" style="margin-top: 10px;">
	      <!-- 리스트 -->
	      <div class="ax5_grid" style="width: 100%">
	        <ul class="ul_list" style="height:350px; width: 100%">
	            <li style="width: 100%;">
	                <div class="table_list_tit" style="width: 100%;">
	                	<h5 style="color: #444;font-size: 16px;float:left; margin-left: 8px; margin-top: 8px; margin-bottom: 8px;">BOM and 자재정보</h5>
		                <div class="add_btn pdl10" style="margin-right:8px; margin-top: 8px;">
		                	<a onclick="initGrid()" style="width: 60px;" authchk><i class="fas fa-wrench"></i> 초기화</a>
<!--
		                	<a onclick="delRow()" style="width: 50px;" authchk><i class="fas fa-trash"></i> 삭제 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-thermometer"></i> 11 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-thumbs-down"></i> 12 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-thumbs-up"></i> 13 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-thumbtack"></i> 14 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-ticket-alt"></i> 15 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-times"></i> 16 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-times-circle"></i> 17 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-tint"></i> 18 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-tint-slash"></i> 19 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-tired"></i> 20 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-toggle-off"></i> 21 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-toggle-on"></i> 22 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-toilet"></i> 23 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-toilet-paper"></i> 24 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-toilet-paper-slash"></i> 25 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-toolbox"></i> 26 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-tools"></i> 27 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-torii-gate"></i> 28 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-tractor"></i> 29 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-trademark"></i> 30 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-traffic-light"></i> 31 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-trailer"></i> 32 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-train"></i> 33 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-tram"></i> 34 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-transgender"></i> 35 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-user"></i> 36 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-user-alt"></i> 37 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-user-edit"></i> 38 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-utensil-spoon"></i> 41 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-utensils"></i> 42 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-vector-square"></i> 44 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-venus"></i> 45 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-venus-double"></i> 46 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-venus-mars"></i> 47 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-vest"></i> 48 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-vest-patches"></i> 49 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-vial"></i> 53 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-vials"></i> 54 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-video"></i> 56 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-video-slash"></i> 57 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-vihara"></i> 58 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-virus"></i> 63 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-virus-slash"></i> 64 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-viruses"></i> 65 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-voicemail"></i> 68 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-volleyball-ball"></i> 69 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-volume-down"></i> 70 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-volume-mute"></i> 71 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-volume-off"></i> 72 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-volume-up"></i> 73 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-vote-yea"></i> 74 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-vr-cardboard"></i> 75 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-walking"></i> 77 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-wallet"></i> 78 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-warehouse"></i> 79 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-water"></i> 81 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-wave-square"></i> 82 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-weight"></i> 86 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-weight-hanging"></i> 87 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-wheelchair"></i> 91 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-wifi"></i> 93 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-wind"></i> 95 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-window-close"></i> 96 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-window-maximize"></i> 97 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-window-minimize"></i> 98 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-window-restore"></i> 99 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-wine-bottle"></i> 101 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-wine-glass"></i> 102 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-wine-glass-alt"></i> 103 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-won-sign"></i> 108 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-wrench"></i> 115 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-x-ray"></i> 116 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-yen-sign"></i> 126 </a>
<a onclick="" style="width: 50px;" authchk><i class="fas fa-yin-yang"></i> 127 </a>
 -->
		                </div>
	                </div>
	                <div>
	                	<div data-ax5grid="upload-grid" data-ax5grid-config="{}" style="height:600px; width: 100%" ></div>
	                </div>
	            </li>
	        </ul>
	    </div>
	  </div>
	</div>
 	<div class="col-xs-2" style="height: 70px;">
	</div>
</div>
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn" style="margin-bottom:20px;">
		<button type="button" id="actionBtnSave" authChk>수정</button>
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>

<script type="text/javascript">

var actionType = null;

var excelInputData = [];

var uploadGridView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	 showRowSelector: false,
		    	 showLineNumber: true,
		    	 multipleSelect: true,
		    	 lineNumberColumnWidth: 40,
		    	 sortable: false,
		         target: $('[data-ax5grid="upload-grid"]'),
		         header: {
		        		 align: "center",
		        		 selector: false
		         },
		         body: {
		        	 columnHeight: 23,
					 mergeCells : ["salesCd"],//editor 는 merge 안됨
					 onClick: function () {
						  /*
		                	$.each($.extend({}, this.list), function(idx, obj){
		                		uploadGridView.target.select(obj.__index, {selected: false});//this.self.select 사용시 멀티선택됨
	                        });
			             	this.self.select(this.dindex);
			              */
					 },
					 onDBLClick: function () {
					 },
			         onDataChanged: function () {
			            	if(this.key != "dtaChk" && this.key != "__selected__"){
			            		if(this.item.__modified__){
					            	this.item.dtaChk = "U";
			            		}
			            		else {
			            			this.item.dtaChk = "";
			            		}
				            }
			            	this.self.repaint();
			         }//,
	             },
		         columns : [
		        	 {key: "dtaChk",			label: " ", 				width: 30,		styleClass: "grid-font-blue-bold"}
		        	,{key: "coCd", 				label: "CO", 				width: 50,		hidden:true}
		        	,{key: "salesCd", 			label: "Sales Code", 		width: 100,		hidden:true}
		        	,{key: "lvl", 				label: "LVL", 				width: 40,		align: "center"	}
					,{key: "lowerCode",			label: "도번",				width: 370,		align: "left",		hidden:false,  treeControl: true}
		        	,{key: "dsgnNo" , 			label: "도번",				width: 180,		align: "left",		hidden:true}
					,{key: "upperCode",			label: "upperCode",			width: 150,		align: "left",		hidden:true}
					,{key: "upperCd", 			label: "upperCd" ,			width: 150,		align: "left",		hidden:true}
					,{key: "lowerCd", 			label: "lowerCd" ,			width: 180,		align: "left",		hidden:true}
		        	,{key: "matrYn", 			label: "자재여부", 			width:  60,		align: "center"}
					,{key: "dsgnNm" , 			label: "명칭" 	 ,			width: 300,		align: "left",
		        		editor:{type:  "text",
		        			disabled: function () {
		        				if(this.item.dtaChk == "D"||this.item.matrYn == "Y"){
			        		        return true;
		        				} else {
		        					return false;
		        				}
		        		    },
		        		    attributes: { 'maxlength': 100 }
    					}
                    }
					,{key: "dsgnBomQty",		label: "수량" 	,			width: 60,		align: "right",
		        		editor:{type:  "number",
		        			disabled: function () {
		        				if(this.item.dtaChk == "D"||this.item.matrYn == "Y"){
			        		        return true;
		        				} else {
		        					return false;
		        				}
		        		    },
	        		    	attributes: { 'maxlength': 5 }
						}
                	}
					,{key: "matrSeq", 			label: "자재순번", 			width:  70,		align: "center"}
					,{key: "ordrgDiv20", 		label: "발주용도", 		width: 80,	align: "left"
						, editor: {type: "select",
							config: {
								columnKeys: {optionValue: 'value',optionText: 'text'},
								options: options_02
							},
							disabled: function () {
								if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
								return true;
							}
						}
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.ordrgDiv20;
							$.each(options_02, function (idx, elem) {
								if(itemValue == elem.value)
								{
									result_text = elem.text;
								}
							});
							return result_text;
						}
					 }
					,{key: "ordrgDiv10", 		label: "발주유형", 		width: 80,	align: "left"
						, editor: {type: "select",
							config: {
								columnKeys: {optionValue: 'value',optionText: 'text'},
								options: options_01
							},
							disabled: function () {
								if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
								return true;
							}
						}
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.ordrgDiv10;
							$.each(options_01, function (idx, elem) {
								if(itemValue == elem.value)
								{
									result_text = elem.text;
								}
							});
							return result_text;
						}
					 }
					,{key: "nextPrcsnNm", 		label: "후행업체", 		width: 118,	align: "left"
						, editor: {type: "text",
							disabled: function () {
								if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
								return true;
							},attributes: {'maxlength': 100,'data-maxlength': 300}}
					}
					,{key: "dlvplcNm", 			label: "배송처", 			width: 118,	align: "left"
						, editor: {type: "text",
							disabled: function () {
								if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
								return true;
							},attributes: {'maxlength': 100,'data-maxlength': 300}}
					}
					,{key: "bomQty", 			label: "수량", 			width: 60,	align: "right"
						, editor:{type:  "number",
						disabled: function () {
							if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
							return true;
						}}}
					,{key: "posQty", 			label: "소유량", 			width: 60,	align: "right"
						, editor:{type:  "number",
						disabled: function () {
							if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
							return true;
						}}}
					,{key: "matrCd", 			label: "자재코드", 		width: 80,	align: "center"
						, editor: {type: "text",
							disabled: function () {
								if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
								return true;
							},attributes: {'maxlength': 100,'data-maxlength': 300}}
					}
			     ],
	              tree: {
	                    use: true,
	                    indentWidth: 15,
	                    arrowWidth: 15,
	                    iconWidth: 18,
	                    icons: {
	 	                   openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
		                   collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
		                   groupIcon: '<i class="fa fa-folder-open" aria-hidden="true"></i>',
		                   collapsedGroupIcon: '<i class="fa fa-folder" aria-hidden="true"></i>',
		                   itemIcon: '<i class="fa fa-cog" aria-hidden="true"></i>'
	                    },
		                columnKeys: {
		                parentKey: "upperCode",
		                selfKey: "lowerCode",
		               }
		           }
		    });
			return this;
		},

        setLoadData: function(listData){
        	let resultArr = initGridDataNullValue(listData, uploadGridView.target.columns, getEditorColumnKey(uploadGridView.target));
        	excelInputData = JSON.parse(JSON.stringify(resultArr));
			var target = this.target;
			var list = listData;
			target.setData({
        		list : list,
        		page : {
        			totalElements : list.length
        		}
   			});
			if(list.length > 0){
				//alert("Upload 되었습니다. [등록] 실행 시 삭제 후 반영됩니다.");
			}
     	},

        setData: function(_pageNo){
			var target = this.target;
			var formData = {
				"coCd" : $('#coCd').val(),
				"salesCd" : $("#salesCd").val(),
			}

    		postAjax("/user/sm/sm01/selectBomMatrTreeList", formData, null, function(data) {
    			var resultArr = initGridDataNullValue(data.resultList, uploadGridView.target.columns, getEditorColumnKey(uploadGridView.target));
    			excelInputData = JSON.parse(JSON.stringify(resultArr));
				var list = data.resultList;
				target.setData({
            		list : list,
            		page : {
            			totalElements : list.length
            		}
       			});
				if(list.length > 0){
					$('#actionBtnSave').text("수정");
					$('#actionBtnSave').show();
					$('#actionBtnSave').on("click", function() {
						actionBtnSaveClick();
					});

					$("#downloadExcel").prop("disabled", false);
					$('#downloadExcel').on("click", function() {
						downloadExcel();
					});
				}
				else {
					$('#actionBtnSave').hide();
				}
    	 	});
     	} //setData
     }


 	$(document).ready(function() {
 		//debugger;
		setCommonSelect($(".popup_area select[data-kind]"));
		setByCoCd(modalStack.last().paramObj.coCd);

		loadFormData("#popForm", modalStack.last().paramObj);

		/**
		 * grid 초기화
		*/
		uploadGridView.initView().setData(0);

		$('#actionBtnSave').hide();

		$('#fileInput').on("change", function() {
			fileInputChange();
		});

		authChk();// 권한체크

		if(MatModalList.length ==  0 ){
			setTimeout(function(){
				console.log("====MatModalList.length>>",MatModalList.length);
				setMatModalList();
			}, 100);
		}
 	});

 	function actionBtnSaveClick(){
 		var actionText = $('#actionBtnSave').text();

 		if(actionText=="등록"){
 			insertUploadBom();
 		}
 		if(actionText=="수정"){
 			insertCrudMatrAndBom();
 		}
 	}

	// 등록-삭제 후 등록한다.
	function insertUploadBom() {
		if (inputValidation($('.popup_area [required]'))) {// 필수 필드의 유효성 검사
			var formData = makeFormData();

			filePostAjax("/user/sm/sm01/insertUploadBom", formData, function(data) {
				alert(data.resultMessage);
				if (data.resultCode == 200) {
					gridView.setData(0);
					modalStack.close();
				}
			});
		}
	}

	function insertCrudMatrAndBom() {
		if (inputValidation($('.popup_area [required]'))) {// 필수 필드의 유효성 검사
			var formData = makeFormData();

			filePostAjax("/user/sm/sm01/insertCrudMatrAndBom", formData, function(data) {
				if (data.resultCode == 900) {
					alert("시스템 에러.");
				}
				else if (data.resultCode == 200){
					alert("저장 되었습니다.");
					gridView.setData(0);
					modalStack.close();
				}
				else {
					alert(data.resultMessage);
				}
			});
		}
	}
 	//----------------------------------------------//
	function makeFormData() {
		// 금액 콤마 제거
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		// 폼데이터 생성
		var formData = new FormData($("#popForm")[0]);
		var _fileTrgtKey = $('#fileTrgtKey').val();
		if(isEmpty(_fileTrgtKey)){
			_fileTrgtKey = "";
		}

		console.log("_fileTrgtKey","["+_fileTrgtKey+"]")
		$('#fileTrgtKey').val(_fileTrgtKey);

		let bom_dataList = JSON.parse(JSON.stringify(uploadGridView.target.list));
		let bom_data = getFilterData(bom_dataList, "N");
		let bomArr = deleteChildren(bom_data);
		//console.log("====bomArr",bomArr);
		formData.append("bomArr", JSON.stringify(bomArr));

		let matr_dataList = JSON.parse(JSON.stringify(uploadGridView.target.list));
		let matr_data = getFilterData(matr_dataList, "Y");
		let matrArr = deleteChildren(matr_data);
		//console.log("====matrArr",matrArr);
		formData.append("matrArr", JSON.stringify(matrArr));
		//세부 아이템 자료 끝
		return formData;
	}

	this.getFilterData = function(obj, sel_matrYn) {
		const resultData = obj.filter(function(element){
			return sel_matrYn == element.matrYn;
		});
		return resultData;
	}

	//해당 TreeGrid 의 __children__ 제거 , 이중배열제거
	function deleteChildren(_list){
		$.each(_list, function (idx, elem) {
			delete elem.__children__;
		});
		return _list;
	}

	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();
	}

 	this.setSaveReplace = function(obj, _coCd, before_salesCd, _salesCd) {
 		$.each($.extend({}, obj), function (idx, elem) {
			elem.coCd = _coCd;
			elem.salesCd = elem.salesCd.replace(before_salesCd,_salesCd);
			elem.upperCd = elem.upperCd.replace(before_salesCd,_salesCd);
			elem.lowerCd = elem.lowerCd.replace(before_salesCd,_salesCd);
			elem.upperCode = elem.upperCode.replace(before_salesCd,_salesCd);
			elem.lowerCode = elem.lowerCode.replace(before_salesCd,_salesCd);
			elem.dsgnNo = elem.lowerCd;
			elem.dtaChk = "I";
		});
 	}

	function fileInputChange() {
		if(!isEmpty($("#fileInput").val())) {
			$("#actionExcel").prop("disabled", false);
			$('#actionExcel').on("click", function() {
				actionExcel();
			});
		}
		else {
			$("#actionExcel").prop("disabled", true);
			$('#actionBtnSave').hide();
		}
		uploadGridView.initView();
	}

	function actionExcel() {
		if(isEmpty($("#fileInput").val())) {
			alert("파일을 선택하여야 합니다.");
			return;
		}

		var isDeleteBefore = false;
		if(uploadGridView.target.list != 0){
			if (!confirm("등록된 데이타가 있습니다. 삭제 후 진행 하시겠습니까?")) {
				isDeleteBefore = true;
			}
		}

		if(isDeleteBefore) return;

		var formData = new FormData($("#popForm")[0]);
		filePostAjax("/user/sm/sm01/uploadExcelFile", formData, function(data){
			if(!isEmpty(data.resultMessage)) {
				alert(data.resultMessage);
				return;
			}
			//let readExcelData = JSON.parse(JSON.stringify(data.resultList));
			//console.log("====>readExcelData>>",readExcelData);
			var columnsKey = ["dtaChk","lvl","lowerCode","matrYn","dsgnNm","dsgnBomQty","matrSeq","ordrgDiv20","ordrgDiv10","nextPrcsnNm","dlvplcNm","bomQty","posQty","matrCd"];
			/*
			//화면의 보이는 순서
			//var columnsKey = getViewColumnKey(uploadGridView.target);
			*/

			var excelReadData = getGridExcelData(columnsKey, data.resultList);
			//let _excelReadData = JSON.parse(JSON.stringify(excelReadData));
			//console.log("====>_excelReadData>>",_excelReadData);
			var resultData = setExcelDataModify(excelReadData);
			//console.log("====>resultData>>",resultData);
			if(resultData == null) return;
			uploadGridView.initView();

			uploadGridView.setLoadData(resultData);

			$('#actionBtnSave').text("등록");
			$('#actionBtnSave').show();
			$('#actionBtnSave').on("click", function() {
				actionBtnSaveClick();
			});
		});
	}

	function setMatModalList() {
		var mat_param = {
				coCd : $('#coCd').val(),
				searchValue : "",
				searchType : "MATR_CD",
				matrClntDiv : "",
				pageNo : 1,
				recordCnt : 99999999,
			};
		postAjax("/user/bm/bm05/MatModal_selectList", mat_param, null, function(data) {
			MatModalList = data.MatModalList;
		});
	}

	//그리드 데이타를 포멧에 맞춰 수정 salesCd 교체
	function setExcelDataModify(dataList){
		if(dataList.length < 1) {
			alert("Upload 데이타의 도번 [Sales Code]은 필수 입니다.");
			return null;
		}
		var excel_salesCd = trim(dataList[0].lowerCode);
		$.each(dataList, function (idx, data) {
			//그리드데이타 생성
			data["dtaChk"] = "I";
			data["lvl"] = xreplace(data.lvl,".0","");
			data["dsgnBomQty"] = xreplace(data.dsgnBomQty,".0","");
			data["bomQty"] = xreplace(data.bomQty,".0","");
			data["posQty"] = xreplace(data.posQty,".0","");
			data["matrSeq"] = xreplace(data.matrSeq,".0","");
			data["coCd"] = $('#coCd').val();
			var salesCd = $('#salesCd').val();
			data["salesCd"] = salesCd;
			var set_lowerCode = trim(data.lowerCode);
			if(excel_salesCd != salesCd){
				set_lowerCode = xreplace(set_lowerCode, excel_salesCd,salesCd);
			}
			var upperCode = set_lowerCode.substring(0,set_lowerCode.lastIndexOf('-'));
			if(set_lowerCode == salesCd || isEmpty(set_lowerCode)) {
				upperCode = "top";
			}
			data["upperCode"] = upperCode;
			data["lowerCode"] = set_lowerCode;

			if(data.matrYn == "N") { //bom
				data["upperCd"] = upperCode;
				data["lowerCd"] = set_lowerCode;
				data["dsgnNo"] = set_lowerCode;
				var lastDsgnNo = set_lowerCode.substring(set_lowerCode.lastIndexOf('-')+1,set_lowerCode.length);
				data["lastDsgnNo"] = lastDsgnNo;

				data["matrSeq"] = "";
				data["ordrgDiv20"] = "";
				data["ordrgDiv10"] = "";
				data["nextPrcsnNm"] = "";
				data["dlvplcNm"] = "";
				data["bomQty"] = "";
				data["posQty"] = "";
				data["matrCd"] = "";

				setMatrDataInit(data);
			} else {//matr
				var matr_upperCode = upperCode.substring(0,upperCode.lastIndexOf('-'));
				var ckmatr_upperCode = xreplace(upperCode, salesCd,"");
				if(isEmpty(ckmatr_upperCode)) {
					matr_upperCode = "top";
				}
				data["upperCd"] = matr_upperCode;

				var matr_lowerCode = set_lowerCode.substring(0,set_lowerCode.lastIndexOf('-'));
				if(matr_lowerCode == salesCd || isEmpty(matr_lowerCode)) {
					matr_lowerCode = salesCd;
				}
				data["lowerCd"] = matr_lowerCode;

				data["dsgnNo"] = "";
				data["lastDsgnNo"] = "";
				data["dsgnNm"] = "";
				data["dsgnBomQty"] = "";
				data["matrYn"] = "Y";

				data["ordrgDiv20"] = getOptionsCode(options_02,data.ordrgDiv20);
				data["ordrgDiv10"] = getOptionsCode(options_01,data.ordrgDiv10);

				if(!isEmpty(data.matrCd)){
					setMatrDataInfo(data, "matrCd");
				}
				else {
					setMatrDataInit(data);
				}
			}
		});
		return dataList;
	}

	function setMatrDataInfo(data, column){
		var idxArg = findIndexArray(MatModalList, column, data.matrCd);

		if(idxArg.length == 1){
			var idx = Number(idxArg[0]);
			var felem = MatModalList[idx];
			data["matrNm"]        = felem.matrNm;
			data["goodsDiv"]      = felem.goodsDiv;
			data["matrClntDiv"]   = felem.matrClntDiv;
			data["matrDiv"]       = felem.matrDiv;
			data["matrGrp"]       = felem.matrGrp;
			data["matrMat"]       = felem.matrMat;
			data["matrSize"]      = felem.matrSize;
			data["matrSpec"]      = felem.matrSpec;
			data["matrMakrNm"]    = felem.matrMakrNm;
			data["matrMno"]       = felem.matrMno;
			data["matrWt"]        = felem.matrWt;
			data["matrUnit"]      = felem.matrUnit;
			data["useYn"]         = felem.useYn;
			data["matrStockCd"]   = felem.matrStockCd;
			data["originNm"]      = felem.originNm;
			data["matrDrwNo"]     = felem.matrDrwNo;
			data["matrTestDiv"]   = felem.matrTestDiv;
			data["dlvrRqmDay"]    = felem.dlvrRqmDay;
			data["matrPurcDiv"]   = felem.matrPurcDiv;
			data["minOrdrgQty"]   = felem.minOrdrgQty;
			data["matrSaftQty"]   = felem.matrSaftQty;
			data["dsgn2DMd"]      = felem.dsgn2DMd;
			data["avrg2DMd"]      = felem.avrg2DMd;
			data["dsgn3DMd"]      = felem.dsgn3DMd;
			data["avrg3DMd"]      = felem.avrg3DMd;
			data["prdctnRqmMd"]   = felem.prdctnRqmMd;
			data["prdctnAvrgMd"]  = felem.prdctnAvrgMd;
			data["matrPartNo"]    = felem.matrPartNo;
			data["pchsClntCd1"]   = felem.pchsClntCd1;
			data["pchsClntPct1"]  = felem.pchsClntPct1;
			data["pchsClntCd2"]   = felem.pchsClntCd2;
			data["pchsClntPct2"]  = felem.pchsClntPct2;
			data["pchsClntCd3"]   = felem.pchsClntCd3;
			data["pchsClntPct3"]  = felem.pchsClntPct3;
			data["matrUpr"]       = felem.matrUpr;
			data["matrAvrgUpr"]   = felem.matrAvrgUpr;
			data["matrRmk"]       = felem.matrRmk;
			data["matrLastTrstDt"]= felem.matrLastTrstDt;
			data["matrAtntCd"]    = felem.matrAtntCd;
			data["matrNo"]        = felem.matrNo;
		}
		else {
			setMatrDataInit(data);
		}
	}

	function setMatrDataInit(data) {
		data["matrNm"]        = "";
		data["goodsDiv"]      = "";
		data["matrClntDiv"]   = "";
		data["matrDiv"]       = "";
		data["matrGrp"]       = "";
		data["matrMat"]       = "";
		data["matrSize"]      = "";
		data["matrSpec"]      = "";
		data["matrMakrNm"]    = "";
		data["matrMno"]       = "";
		data["matrWt"]        = "";
		data["matrUnit"]      = "";
		data["useYn"]         = "";
		data["matrStockCd"]   = "";
		data["originNm"]      = "";
		data["matrDrwNo"]     = "";
		data["matrTestDiv"]   = "";
		data["dlvrRqmDay"]    = "";
		data["matrPurcDiv"]   = "";
		data["minOrdrgQty"]   = "";
		data["matrSaftQty"]   = "";
		data["dsgn2DMd"]      = "";
		data["avrg2DMd"]      = "";
		data["dsgn3DMd"]      = "";
		data["avrg3DMd"]      = "";
		data["prdctnRqmMd"]   = "";
		data["prdctnAvrgMd"]  = "";
		data["matrPartNo"]    = "";
		data["pchsClntCd1"]   = "";
		data["pchsClntPct1"]  = "";
		data["pchsClntCd2"]   = "";
		data["pchsClntPct2"]  = "";
		data["pchsClntCd3"]   = "";
		data["pchsClntPct3"]  = "";
		data["matrUpr"]       = "";
		data["matrAvrgUpr"]   = "";
		data["matrRmk"]       = "";
		data["matrLastTrstDt"]= "";
		data["matrAtntCd"]    = "";
		data["matrNo"]        = "";
	}

	function downloadExcel() {
		var todayDate = new Date().format('yyyyMMddHHmmss');
        uploadGridView.target.exportExcel("구매Bom("+$("#salesCd").val()+")_"+todayDate+".xls");
	}

	function initGrid(){
		uploadGridView.setLoadData(excelInputData);
	}
	function delRow(){

	}
</script>