<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">구매BOM 복사</h4>
    </div>
    <div class="add_btn_small pdl10" style="margin-right:8px;margin-bottom:8px;">
        <button id="actionBtn2">생성</button>
    </div>

   <div class="form-group popup_table">
	<form id="popForm" onSubmit="return false;">
      <input type="hidden" id="fileTrgtKey" name="fileTrgtKey">
      <input type="hidden" id="pgmId"     name="pgmId" value="SM0101M01">
      <table>

        <colgroup>
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
        </colgroup>
        <tr>
			<th class="hit">회사</th>
			<td>
			  <select id="coCd" name="coCd" data-kind="CO" class="form-control" required="required" msg="회사" readonly="readonly">
			  </select>
			</td>
			<th class="hit">Sales Code</th>
			<td>
				<input type="text" id="salesCd" name="salesCd" class="form-control" required="required" msg="Sales Code" readonly="readonly">
			</td>
			<th class="hit">회사</th>
			<td>
			  <select id="coCd_SS" name="coCd_SS" data-kind="CO" required="required" msg="회사">
			  </select>
			</td>
			<th class="hit">Sales Code</th>
			<td>
				<div class="search_form" >
					<input type="text" id="salesCd_SS" readonly="readonly" onkeyup="if(window.event.keyCode == 13) {gridView.setData(0);};">
			        <a onclick="bomSalesCdSearch();"><i class="i_search_w"></i></a>
				</div>
			</td>
        </tr>
        
        <tr>
			<th>고객사</th>
			<td>
				<input type="text" id="clntNm" name="clntNm" class="form-control" msg="고객사" readonly="readonly">
			</td>
			<th>고객사PJT</th>
			<td>
				<input type="text" id="clntPjt" name="clntPjt" class="form-control" msg="고객사PJT" readonly="readonly"> 
			</td>
			<th>고객사</th>
			<td>
				<input type="text" id="clntNm_SS" name="clntNm_SS" class="form-control" msg="고객사" readonly="readonly">
			</td>
			<th>고객사PJT</th>
			<td>
				<input type="text" id="clntPjt_SS" name="clntPjt_SS" class="form-control" msg="고객사PJT" readonly="readonly"> 
			</td>
        </tr>

        <tr>
			<th>제품구분</th>
			<td>
				<input type="text" id="prdtNm" name="prdtNm" class="form-control" msg="제품명" readonly="readonly">
			</td>
			<th>아이템구분</th>
			<td>
				<input type="text" id="itemDivNm" name="itemDivNm" class="form-control" msg="아이템구분" readonly="readonly">
			</td>
			<th>제품구분</th>
			<td>
				<input type="text" id="prdtNm_SS" name="prdtNm_SS" class="form-control" msg="제품명" readonly="readonly">
			</td>
			<th>아이템구분</th>
			<td>
				<input type="text" id="itemDivNm_SS" name="itemDivNm_SS" class="form-control" msg="아이템구분" readonly="readonly">
			</td>
        </tr>

        <tr>
			<th>설비명</th>
			<td colspan="3">
				<input type="text" id="eqpNm" name="eqpNm" msg="설비명" class="form-control" readonly="readonly">
			</td>
			<th>설비명</th>
			<td colspan="3">
				<input type="text" id="eqpNm_SS" name="eqpNm_SS" msg="설비명" class="form-control" readonly="readonly">
			</td>
        </tr>

      </table>

    </form>

	<!-- 콘텐츠 -->
	  <div class="contents" style="margin-top: 10px;">
	      <!-- 리스트 -->
	      <div class="ax5_grid" style="width: 100%">
	        <ul class="ul_list" style="height:350px; width: 100%">
	            <li style="width: 49%;">
	                <div class="table_list_tit" style="width: 100%;">
	                	<h5 style="color: #444;font-size: 16px;float:left; margin-left: 8px; margin-top: 8px; margin-bottom: 8px;">원본 BOM</h5>
		                <div class="add_btn pdl10" style="margin-right:8px; margin-top: 8px;">
		                </div>
	                </div>
	                <div>
	                	<div data-ax5grid="bom-grid" data-ax5grid-config="{}" style="height:500px; width: 100%" ></div>
	                </div>
	            </li>
	            <li style="width: 49%; margin-left: 8px;">
	                <div class="table_list_tit">
	                	<h5 style="color: #444;font-size: 16px;float:left; margin-left: 8px; margin-top: 8px; margin-bottom: 8px;">생성 BOM</h5>
		                <div class="add_btn pdl10" style="margin-right:8px; margin-top: 8px;">
		                </div>
	                </div>
	                <div>
	                	<div data-ax5grid="matr-grid" data-ax5grid-config="{}" style="height:500px; width: 100%" ></div>
	                </div>
	            </li>
	        </ul>	
	    </div>
	  </div>
	</div>


    <br>
	<div class="col-xs-2" style="height: 70px;">
	</div>
</div>
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtn" authChk>등록</button>
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>

<script type="text/javascript">
  
var actionType = null;

var firstGrid = null;
var secondGrid = null;

var original_bomArr = [];  //원본 bom 데이타
var bomArr = []; //입력할 Bom 데이타
var matrArr = [];  //자재 데이타

const bomMatrView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	 showRowSelector: true,
		    	 multipleSelect: false,
		    	 sortable: false,
		         target: $('[data-ax5grid="bom-grid"]'),
		         header: {
		        		 align: "center",
		        		 selector: false
		         },
		         body: {
		        	 	 mergeCells : ["lvl", "salesCd","partNo", "unitNo", "revNo","dsgnNo"],
			        	 onClick: function () {
			        	 },
						 onDBLClick: function () {
						 },
			             onDataChanged: function () {
			             }
	             },
		        columns : [
     			 	 	 {key: "fileTrgtKey", 		label: "파일대상KEY", 			width: 100,		align: "center", 	hidden:true}
						,{key: "coCd", 				label: "회사코드", 			width: 100,		align: "center", 	hidden:true}
						,{key: "coNm",	    		label: "회사",				width: 70,		align: "center", 	hidden:true}
						,{key: "salesCd", 			label: "Sales Code", 		width: 120,		align: "center"}
						,{key: "partNo", 			label: "파트번호", 			width:  70,		align: "center"}
						,{key: "unitNo", 			label: "유닛번호", 			width:  70,		align: "center"}
						,{key: "revNo", 			label: "리버전", 				width:  70,		align: "center"}
						,{key: "dsgnNo", 			label: "도번", 				width: 180,		align: "left"}
						,{key: "lvl", 				label: "레벨", 				width:  50,		align: "center",	hidden:true}
						,{key: "matrSeq", 			label: "자재순번", 			width:  70,		align: "center"}
						,{key: "oldUpperCd", 		label: "이전상위코드", 			width: 160,		align: "left"		,hidden:true}
						,{key: "oldLowerCd", 		label: "이전하위코드", 			width: 180,		align: "left"		,hidden:true}
						,{key: "upperCd", 			label: "현재상위코드", 			width: 160,		align: "left"		,hidden:true}
						,{key: "lowerCd", 			label: "현재하위코드", 			width: 180,		align: "left"		,hidden:true}
						,{key: "ordrgDiv10", 		label: "발주용도", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.ordrgDiv10;
								$.each(options_01, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "ordrgDiv20", 		label: "발주유형", 		width: 100,	align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.ordrgDiv20;
								$.each(options_02, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "nextPrcsnNm", 		label: "후행업체", 			width: 150,		align: "left"}
						,{key: "dlvplcNm", 			label: "배송처", 				width: 150,		align: "left"}
						,{key: "bomQty", 			label: "수량", 				width: 60,		align: "right"}
						,{key: "matrCd", 			label: "자재코드", 			width: 80,		align: "center"}
						,{key: "matrNm", 			label: "자재명", 				width: 160,		align: "left"}
						,{key: "goodsDiv", 			label: "자재구분", 			width: 90,	align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.goodsDiv;
								$.each(options_03, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrClntDiv", 		label: "거래처구분", 			width: 120,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrClntDiv;
								$.each(options_04, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrDiv", 			label: "자재유형", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrDiv;
								$.each(options_05, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrGrp", 			label: "자재그룹", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrGrp;
								$.each(options_06, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrMat", 			label: "소재", 				width: 100,		align: "center"}
						,{key: "matrSize", 			label: "크기", 				width: 100,		align: "center"}
						,{key: "matrSpec", 			label: "규격", 				width: 100,		align: "left"}
						,{key: "matrMakrNm", 		label: "제조사", 				width: 100,		align: "center"}
						,{key: "matrMno", 			label: "Model No", 			width: 100,		align: "center"}
						,{key: "matrWt", 			label: "중량", 				width: 100,		align: "right"}
						,{key: "matrUnit", 			label: "단위", 				width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrUnit;
								$.each(options_07, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "useYn", 			label: "사용여부", 			width: 70,		align: "center", formatter: "useYn"}
						,{key: "matrStockCd", 		label: "재고관리", 			width: 70,		align: "center", formatter: "useYn"}
						,{key: "originNm", 			label: "원산지", 				width: 100,		align: "center"}
						,{key: "matrDrwNo", 		label: "대표도면", 			width: 120,		align: "center"}
						,{key: "matrTestDiv", 		label: "입고검사구분", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrTestDiv;
								$.each(options_08, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "dlvrRqmDay", 		label: "납품소요일자", 			width: 100,		align: "right"}
						,{key: "matrPurcDiv", 		label: "구매/외주구분", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrPurcDiv;
								$.each(options_09, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "minOrdrgQty", 		label: "최소발주량", 			width: 100,		align: "right"}
						,{key: "matrSaftQty", 		label: "안전재고", 			width: 100,		align: "right"}
						,{key: "dsgn2DMd", 			label: "2D설계소요일", 			width: 100,		align: "right"}
						,{key: "avrg2DMd", 			label: "2D평균소요일", 			width: 100,		align: "right"}
						,{key: "dsgn3DMd", 			label: "3D설계소요일", 			width: 100,		align: "right"}
						,{key: "avrg3DMd", 			label: "3D평균소요일", 			width: 100,		align: "right"}
						,{key: "prdctnRqmMd", 		label: "생산소요일", 			width: 100,		align: "right"}
						,{key: "prdctnAvrgMd", 		label: "생산평균소요일", 			width: 100,		align: "right"}
						,{key: "matrPartNo", 		label: "파트번호", 			width: 100,		align: "center"}
						,{key: "pchsClntCd1", 		label: "구매업체1", 			width: 80,		align: "right"}
						,{key: "pchsClntPct1", 		label: "구매업체1%", 			width: 80,		align: "right"}
						,{key: "pchsClntCd2", 		label: "구매업체2", 			width: 80,		align: "right"}
						,{key: "pchsClntPct2", 		label: "구매업체2%", 			width: 80,		align: "right"}
						,{key: "pchsClntCd3", 		label: "구매업체3", 			width: 80,		align: "right"}
						,{key: "pchsClntPct3", 		label: "구매업체3%", 			width: 80,		align: "right"}
						,{key: "matrUpr", 			label: "최종구매단가", 			width: 100,		align: "right",  formatter: "money"}
						,{key: "matrAvrgUpr", 		label: "평균구매단가", 			width: 100,		align: "right",  formatter: "money"}
						,{key: "matrRmk", 			label: "비고", 				width: 150,		align: "left"}
						,{key: "matrLastTrstDt", 	label: "최종거래일자", 			width: 100,		align: "center"}
						,{key: "matrAtntCd", 		label: "대체자재코드", 			width: 100,		align: "center"}
						,{key: "matrNo", 			label: "자재번호", 			width: 100,		align: "center"}
			     ]
		    });
			return this;
		},


        setData: function(_pageNo){
			var targetObj = this.target;
        	var formData = new FormData();
        	var salesCd = gridView1.target.getList("selected")[0].salesCd;
        	var fileTrgtKey = gridView1.target.getList("selected")[0].fileTrgtKey;
        	var formData = {
				"fileTrgtKey" : fileTrgtKey,
				"salesCd" : salesCd
			}
			postAjax("/user/sm/sm01/selectBomDetailList", formData, null, function(data){
			var list = data.resultList;
			targetObj.setData({
				list : list,
			    page : {
			    		totalElements : list.length,
			    	} 
				});
			
            });
        	/*
			var target = this.target;
			var formData = {
				"salesCd" 		: $("#salesCd").val(),
			}

    		postAjax("/user/sm/sm01/selectBuyBomList", formData, null, function(data) {
				var list = data.resultList;
				target.setData({
            		list : list,
            		page : {
            			totalElements : list.length
            		}
       			});
				if(list.length > 0){
					bomMatrView.target.clearSelect();
					//bomMatrView.target.focus("HOME")
					bomMatrView.target.select(0);
					bomMatrView.target.focused = true;
					select_bomIdx = 0;
					before_bomIdx = 0;
					select_dsgnNo = bomMatrView.target.getList("selected")[0].dsgnNo;
					before_dsgnNo = select_dsgnNo;
					
					//자재정보 조회
					copyView.setData('A');
				}
				
    	 	});
			*/
     	} //setData
     }


const copyView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	 showRowSelector: false,
		    	 multipleSelect: false,
		    	 sortable: false,
		         target: $('[data-ax5grid="matr-grid"]'),
		         header: {
			        		 align: "center",
			        		 selector: false
			    },
		        body: {
		        		   mergeCells : ["coCd","salesCd", "dsgnNo", "upperCd","lowerCd","ordrgDiv10"],
  			               onClick: function () {
  			               this.self.select(this.dindex);
			          },
			          onDBLClick: function () {
			          },
			          onDataChanged: function () {
			          },
		        },
		        columns : [
			 	 	 {key: "fileTrgtKey", 		label: "파일대상KEY", 			width: 100,		align: "center", 	hidden:true}
						,{key: "coCd", 				label: "회사코드", 			width: 100,		align: "center", 	hidden:true}
						,{key: "coNm",	    		label: "회사",				width: 70,		align: "center", 	hidden:true}
						,{key: "salesCd", 			label: "Sales Code", 		width: 120,		align: "center"}
						,{key: "partNo", 			label: "파트번호", 			width:  70,		align: "center"}
						,{key: "unitNo", 			label: "유닛번호", 			width:  70,		align: "center"}
						,{key: "revNo", 			label: "리버전", 				width:  70,		align: "center"}
						,{key: "dsgnNo", 			label: "도번", 				width: 180,		align: "left"}
						,{key: "lvl", 				label: "레벨", 				width:  50,		align: "center",	hidden:true}
						,{key: "matrSeq", 			label: "자재순번", 			width:  70,		align: "center"}
						,{key: "oldUpperCd", 		label: "이전상위코드", 			width: 160,		align: "left"		,hidden:true}
						,{key: "oldLowerCd", 		label: "이전하위코드", 			width: 180,		align: "left"		,hidden:true}
						,{key: "upperCd", 			label: "현재상위코드", 			width: 160,		align: "left"		}
						,{key: "lowerCd", 			label: "현재하위코드", 			width: 180,		align: "left"		}
						,{key: "ordrgDiv10", 		label: "발주용도", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.ordrgDiv10;
								$.each(options_01, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "ordrgDiv20", 		label: "발주유형", 		width: 100,	align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.ordrgDiv20;
								$.each(options_02, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "nextPrcsnNm", 		label: "후행업체", 			width: 150,		align: "left"}
						,{key: "dlvplcNm", 			label: "배송처", 				width: 150,		align: "left"}
						,{key: "bomQty", 			label: "수량", 				width: 60,		align: "right"}
						,{key: "matrCd", 			label: "자재코드", 			width: 80,		align: "center"}
						,{key: "matrNm", 			label: "자재명", 				width: 160,		align: "left"}
						,{key: "goodsDiv", 			label: "자재구분", 			width: 90,	align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.goodsDiv;
								$.each(options_03, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrClntDiv", 		label: "거래처구분", 			width: 120,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrClntDiv;
								$.each(options_04, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrDiv", 			label: "자재유형", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrDiv;
								$.each(options_05, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrGrp", 			label: "자재그룹", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrGrp;
								$.each(options_06, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrMat", 			label: "소재", 				width: 100,		align: "center"}
						,{key: "matrSize", 			label: "크기", 				width: 100,		align: "center"}
						,{key: "matrSpec", 			label: "규격", 				width: 100,		align: "left"}
						,{key: "matrMakrNm", 		label: "제조사", 				width: 100,		align: "center"}
						,{key: "matrMno", 			label: "Model No", 			width: 100,		align: "center"}
						,{key: "matrWt", 			label: "중량", 				width: 100,		align: "right"}
						,{key: "matrUnit", 			label: "단위", 				width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrUnit;
								$.each(options_07, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "useYn", 			label: "사용여부", 			width: 70,		align: "center", formatter: "useYn"}
						,{key: "matrStockCd", 		label: "재고관리", 			width: 70,		align: "center", formatter: "useYn"}
						,{key: "originNm", 			label: "원산지", 				width: 100,		align: "center"}
						,{key: "matrDrwNo", 		label: "대표도면", 			width: 120,		align: "center"}
						,{key: "matrTestDiv", 		label: "입고검사구분", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrTestDiv;
								$.each(options_08, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "dlvrRqmDay", 		label: "납품소요일자", 			width: 100,		align: "right"}
						,{key: "matrPurcDiv", 		label: "구매/외주구분", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrPurcDiv;
								$.each(options_09, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "minOrdrgQty", 		label: "최소발주량", 			width: 100,		align: "right"}
						,{key: "matrSaftQty", 		label: "안전재고", 			width: 100,		align: "right"}
						,{key: "dsgn2DMd", 			label: "2D설계소요일", 			width: 100,		align: "right"}
						,{key: "avrg2DMd", 			label: "2D평균소요일", 			width: 100,		align: "right"}
						,{key: "dsgn3DMd", 			label: "3D설계소요일", 			width: 100,		align: "right"}
						,{key: "avrg3DMd", 			label: "3D평균소요일", 			width: 100,		align: "right"}
						,{key: "prdctnRqmMd", 		label: "생산소요일", 			width: 100,		align: "right"}
						,{key: "prdctnAvrgMd", 		label: "생산평균소요일", 			width: 100,		align: "right"}
						,{key: "matrPartNo", 		label: "파트번호", 			width: 100,		align: "center"}
						,{key: "pchsClntCd1", 		label: "구매업체1", 			width: 80,		align: "right"}
						,{key: "pchsClntPct1", 		label: "구매업체1%", 			width: 80,		align: "right"}
						,{key: "pchsClntCd2", 		label: "구매업체2", 			width: 80,		align: "right"}
						,{key: "pchsClntPct2", 		label: "구매업체2%", 			width: 80,		align: "right"}
						,{key: "pchsClntCd3", 		label: "구매업체3", 			width: 80,		align: "right"}
						,{key: "pchsClntPct3", 		label: "구매업체3%", 			width: 80,		align: "right"}
						,{key: "matrUpr", 			label: "최종구매단가", 			width: 100,		align: "right",  formatter: "money"}
						,{key: "matrAvrgUpr", 		label: "평균구매단가", 			width: 100,		align: "right",  formatter: "money"}
						,{key: "matrRmk", 			label: "비고", 				width: 150,		align: "left"}
						,{key: "matrLastTrstDt", 	label: "최종거래일자", 			width: 100,		align: "center"}
						,{key: "matrAtntCd", 		label: "대체자재코드", 			width: 100,		align: "center"}
						,{key: "matrNo", 			label: "자재번호", 			width: 100,		align: "center"}
		         	]
		    });
			return this;
		},
		
		selectGrid : function(click_dsgnNo) {
			if(before_bomIdx == select_bomIdx) return; //선택행 변경없을때 사용안함.
			
			var delIdxArray = findIndexArray(matrArr, "dsgnNo", before_dsgnNo);
			
			var af_gridList = this.target.getList();
			if(af_gridList.length > 0) {
				$.each(af_gridList, function (idx, elem) {
					matrArr.push(elem);
				});
			}
			//행삭제는 index가 변경되므로 아래에서 삭제
			for(var i=delIdxArray.length-1; i >= 0; i--){
				matrArr.splice(delIdxArray[i],1);
			}
			
			//var target = this.target;
			var list = getFilterData(click_dsgnNo);
			copyView.target.setData({
        		list : list,
        		page : {
        			totalElements : list.length
        		}
   			});
		},
		
		setData: function(){
			if(_mod != "A"){
				var target = this.target;
				var sel_dsgnNo = bomMatrView.target.getList("selected")[0].dsgnNo;
				var list = getFilterData(sel_dsgnNo);
				target.setData({
            		list : list,
            		page : {
            			totalElements : list.length
            		}
       			});
			}	
		}
	}


 	$(document).ready(function() {
 		//debugger;
		setCommonSelect($(".popup_area select[data-kind]"));
		setByCoCd(modalStack.last().paramObj.coCd);
		$("#salesCd").val(modalStack.last().paramObj.salesCd);
		$("#clntNm").val(modalStack.last().paramObj.clntNm);
		$("#clntPjt").val(modalStack.last().paramObj.clntPjt);
		$("#itemDivNm").val(modalStack.last().paramObj.itemDivNm);
		$("#eqpNm").val(modalStack.last().paramObj.eqpNm);
		$("#prdtNm").val(modalStack.last().paramObj.prdtNm);
		
		authChk();// 권한체크

		/**
		 * grid 초기화
		*/
		bomMatrView.initView();
		copyView.initView();
		
		$('#actionBtn').text("등록");
		$('#actionBtn').on("click", function() {
			updateBomMatr();
		});
		$('#actionBtn2').on("click", function() {
			copyBomMatr();
		});
		
		
		bomMatrView.setData(0);
		
		
    	var formData = {"salesCd" : $('#salesCd').val() };
		postAjax("/user/sm/sm01/selectBuyBomList", formData, null, function(data){
			original_bomArr = data.resultList;
        });
 	});
 	
 	this.copyBomMatr = function(){
 		var coCd_SS = $('#coCd_SS').val();
		var salesCd_SS = $('#salesCd_SS').val();
		var salesCd = $('#salesCd').val();

		if(isEmpty(coCd_SS)){
	 		alert("대상 [회사] 를 검색 하세요.");
	 		return;
 		}
 		if(isEmpty(salesCd)){
	 		alert("복사 할 [Sales Code]가 없습니다.");
	 		return;
 		}
 		if(isEmpty(salesCd_SS)){
	 		alert("대상 [Sales Code] 를 검색 하세요.");
	 		return;
 		}
 		
 		
 		//var original_bomArr = [];  //원본 bom 데이타
 		//var bomArr = []; //입력할 Bom 데이타
 		//original_bomArr -> bomArr
 		for(var i=0;i<original_bomArr.length; i++){
 			bomArr[i] = original_bomArr[i];
 		}
		$.each(bomArr, function (idx, elem) {
			elem.coCd = coCd_SS;
			elem.salesCd = elem.salesCd.replace(salesCd,salesCd_SS);
			elem.upperCd = elem.upperCd.replace(salesCd,salesCd_SS);
			elem.lowerCd = elem.lowerCd.replace(salesCd,salesCd_SS);
			elem.dsgnNo = elem.lowerCd;
		});
 		/*
 		$.each(bomArr, function (idx, elem) {
			elem.coCd = coCd_SS;
			elem.salesCd = elem.salesCd.replace(salesCd,salesCd_SS);
			elem.upperCd = elem.upperCd.replace(salesCd,salesCd_SS);
			elem.lowerCd = elem.lowerCd.replace(salesCd,salesCd_SS);
			elem.dsgnNo = elem.lowerCd;
 		}
 		*/
 		
 		console.log("original_bomArr  >>>>>>", original_bomArr);
 		console.log("bomArr           >>>>>>", bomArr);
 		
 		
		var bomMatrList = bomMatrView.target.list;
		$.each(bomMatrList, function (idx, elem) {
			elem.coCd = coCd_SS;
			elem.salesCd = elem.salesCd.replace(salesCd,salesCd_SS);
			elem.upperCd = elem.upperCd.replace(salesCd,salesCd_SS);
			elem.lowerCd = elem.lowerCd.replace(salesCd,salesCd_SS);
			elem.dsgnNo = elem.lowerCd;
		});
		
		var list = bomMatrList;
		copyView.target.setData({
    		list : list,
    		page : {
    			totalElements : list.length
    		}
		});
 		
 	}
	
	// 등록
	function insertBomMatr() {
		if(gridDataValidation(bomMatrView.target)) return;
		if (inputValidation($('.popup_area [required]'))) {					// 필수 필드의 유효성 검사
			var formData = makeFormData();									// 요청이 통과하면 formData를 생성
			filePostAjax("/user/sm/sm01/insertBom", formData,				// 파일을 포함한 데이터를 서버로 전송하는 비동기적인 AJAX 요청을 수행
					function(data) {
						alert(data.resultMessage);							// 결과 메시지를 alert으로 출력
						if (data.resultCode == 200) {						// 요청이 성공(200)한 경우, gridView.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
							gridView1.setData(0);							// 결과갑시 200인 경우 리드 뷰를 업데이트
							modalStack.close();								// 모달을 닫음
						}
					});
		}
	}

	//----------------------------------------------//
	function makeFormData() {
		// 금액 콤마 제거
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		// 폼데이터 생성
		var formData = new FormData($("#popForm")[0]);
		
		//---------------------------------------------------------------  
		//-------itemarr  --첨부화일 처리를 위한 부분 시작
		//---------------------------------------------------------------  
		// 유저아이디 추가
		formData.append("userId", jwt.userId);
		formData.append("comonCd", treeModule.getFileNodeId());
		var fileUploadArr = [];
		var tempArr = [];
		
		tempArr = treeModule.getFileArr();
		$.each(tempArr, function(idx, obj) {
			if (obj.fileKey == 0) {
                formData.append("files", obj.file);
                obj.file = '';
                fileUploadArr.push(obj);
			}
		});

		formData.append("uploadFileArr", JSON.stringify(fileUploadArr));
		formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
		//---------------------------------------------------------------  
		//--첨부화일 처리를 위한 부분 끝
		//--------------------------------------------------------------- 

		var bomArr = [];
		var bomlist = bomMatrView.target.list;
		$.each(bomlist,function(idx, obj) {
			if(isEmpty(obj.dtaChk)){
				obj.dtaChk = "";
			}
		});
		formData.append("bomArr", JSON.stringify(bomlist));
		
		//현재 자재정보 그리드정보를 matrArr에  update 한다
		var matrGridList = copyView.target.list;
		if(matrGridList.length > 0){
			var delIdxArray = [];
			if(!isEmpty(before_dsgnNo)){
				delIdxArray = findIndexArray(matrArr, "dsgnNo", before_dsgnNo);
			}
			$.each(matrGridList, function (idx, elem) {
				matrArr.push(elem);
			});
			if(!isEmpty(before_dsgnNo)){
				for(var i=delIdxArray.length-1; i >= 0; i--){
					matrArr.splice(delIdxArray[i],1);
				}
			}
		}

		$.each(matrArr,function(idx, obj) {
			if(isEmpty(obj.dtaChk)){
				obj.dtaChk = "";
			}
		});
		formData.append("matrArr", JSON.stringify(matrArr));
		//세부 아이템 자료 끝
		return formData;
	}

	//등록되지 않은 SalesCd 를 검색한다.
	function bomSalesCdSearch() {
	    var paramObj = {
	       "coCd" : $('#coCd_SS').val(),
	       "salesCd": $('#salesCd_SS').val()
	    };
	    openSecondModal("/static/html/cmn/modal/bomSalesCdSearch.html", 1000, 430, "SALES CODE 검색", paramObj, function (grid){
	    	//sdebugger;
	        var row = grid.target.getList("selected")[0];
	        
	        //console.log("rowData==>",row);
	        $('#salesCd_SS').val(row.salesCd);
	        $('#clntNm_SS').val(row.clntNm);
	        $('#clntPjt_SS').val(row.clntPjt);
	        $('#prdtNm_SS').val(row.prdtNm);
	        $('#itemDivNm_SS').val(row.itemDivNm);
	        $('#eqpNm_SS').val(row.eqpNm);
	        //gridView1.setData(0);
	    });
	}

	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();		
	}

</script>