<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">구매BOM 복사</h4>
    </div>

  <div class="form-group popup_table">
   <form id="pop05Form" onSubmit="return false;">
		<input type="hidden" id="userId" name="userId">
		<input type="hidden" id="fileTrgtTyp" name="fileTrgtTyp" value="SM0101M01">
		<input type="hidden" id="fileTrgtKey" name="fileTrgtKey">
		<input type="hidden" id="pgmId" name="pgmId" value="SM0101M01">
      <table>

        <colgroup>
          <col width="7%">
          <col width="6%">
          <col width="7%">
          <col width="4%">
          <col width="7%">
          <col width="6%">

          <col width="7%">
          <col width="6%">
          <col width="7%">
          <col width="4%">
          <col width="7%">
          <col width="6%">
        </colgroup>

        <tr>
			<th class="hit">회사</th>
			<td>
			  <select id="coCd" name="coCd" data-kind="CO" class="form-control" required="required" msg="회사" readonly="readonly">
			  </select>
			</td>
			<th class="hit">수주번호</th>
			<td>
				<input type="text" id="ordrsNo" name="ordrsNo" class="form-control" required="required" readonly="readonly">
			</td>
			<th class="hit">원본 Sales Code</th>
			<td>
				<input type="text" id="salesCd" name="salesCd" class="form-control" required="required" msg="Sales Code" readonly="readonly">
			</td>


			<th class="hit">회사</th>
			<td>
			  <select id="coCd_SS" name="coCd_SS" data-kind="CO" required="required" msg="회사">
			  </select>
			</td>
			<th class="hit">수주번호</th>
			<td>
				<input type="text" id="ordrsNo_SS" name="ordrsNo_SS" class="form-control" required="required" readonly="readonly">
			</td>
			<th class="hit">대상 Sales Code</th>
			<td>
				<div class="search_form" >
					<input type="text" id="salesCd_SS" readonly="readonly" onkeyup="if(window.event.keyCode == 13) {bomSalesCdSearch();};">
			        <a onclick="bomSalesCdSearch();" data-onclick="bomSalesCdSearch();"><i class="i_search_w"></i></a>
				</div>
			</td>
        </tr>

        <tr>
			<th>고객사</th>
			<td>
				<input type="text" id="clntNm" name="clntNm" class="form-control" msg="고객사" readonly="readonly">
			</td>
			<th>고객사PJT</th>
			<td colspan="3">
				<input type="text" id="clntPjt" name="clntPjt" class="form-control" msg="고객사PJT" readonly="readonly">
			</td>


			<th>고객사</th>
			<td>
				<input type="text" id="clntNm_SS" name="clntNm_SS" class="form-control" msg="고객사" readonly="readonly">
			</td>
			<th>고객사PJT</th>
			<td colspan="3">
				<input type="text" id="clntPjt_SS" name="clntPjt_SS" class="form-control" msg="고객사PJT" readonly="readonly">
			</td>
        </tr>

        <tr>
			<th>아이템구분</th>
			<td>
				<input type="text" id="itemDivNm" name="itemDivNm" class="form-control" msg="아이템구분" readonly="readonly">
			</td>
			<th>제품구분</th>
			<td colspan="3">
				<input type="text" id="prdtNm" name="prdtNm" class="form-control" msg="제품명" readonly="readonly">
			</td>


			<th>아이템구분</th>
			<td>
				<input type="text" id="itemDivNm_SS" name="itemDivNm_SS" class="form-control" msg="아이템구분" readonly="readonly">
			</td>
			<th>제품구분</th>
			<td colspan="3">
				<input type="text" id="prdtNm_SS" name="prdtNm_SS" class="form-control" msg="제품명" readonly="readonly">
			</td>
        </tr>

        <tr>
			<th>설비명</th>
			<td colspan="5">
				<input type="text" id="eqpNm" name="eqpNm" msg="설비명" class="form-control" readonly="readonly">
			</td>

			<th>설비명</th>
			<td colspan="5">
				<input type="text" id="eqpNm_SS" name="eqpNm_SS" msg="설비명" class="form-control" readonly="readonly">
			</td>
        </tr>

      </table>
    </form>

	<!-- 콘텐츠 -->
	  <div class="contents" style="margin-top: 10px;">
	      <!-- 리스트 -->
	      <div class="ax5_grid" style="width: 100%">
	        <ul class="ul_list" style="height:350px; width: 100%">
	        	<li style="width: 100%;">
	        	<table style="border:0px;padding:0px;margin:0px;">
	        		<tr>
	        			<td style="width: 48%;border-right:0px;border-bottom:0px;">
			                <div class="table_list_tit" style="width: 100%;">
			                	<h5 style="color: #444;font-size: 16px;float:left; margin-left: 8px; margin-top: 8px; margin-bottom: 8px;">원본 BOM - 자재</h5>
				                <div class="add_btn pdl10" style="margin-right:8px; margin-top: 8px;">
				                </div>
			                </div>
	        			</td>
	        			<td style="width: 4%;border-right:0px;border-bottom:0px;">
	        			</td>
	        			<td style="width: 48%;border-right:0px;border-bottom:0px;">
			                <div class="table_list_tit">
			                	<h5 style="color: #444;font-size: 16px;float:left; margin-left: 8px; margin-top: 8px; margin-bottom: 8px;">생성 BOM - 자재</h5>
				                <div class="add_btn pdl10" style="margin-right:8px; margin-top: 8px;">
				                	<a onclick="initCopyGrid()" data-onclick="initCopyGrid()" style="width: 60px;" authchk><i class="fas fa-wrench"></i> 초기화</a>
				                	<a onclick="deleteCopyGrid()" data-onclick="deleteCopyGrid()" style="width: 50px;" authchk><i class="fas fa-trash"></i> 삭제 </a>
				                </div>
			                </div>
	        			</td>
	        		</tr>
	        		<tr>
	        			<td style="width: 48%;border-right:0px;border-bottom:0px;">
			                <div style="margin-left: 12px;">
			                	<div data-ax5grid="bom-search-grid" data-ax5grid-config="{}" style="height:580px; width: 100%" ></div>
			                </div>
	        			</td>
	        			<td style="width: 4%;border-right:0px;border-bottom:0px;">
	        				<button type="button" style="background:#ffffff;" onclick="copyBomMatr()" authchk>
	        					<img src="/static/img/rr-arrow.png"/>
	        				</button>
	        				<br>
	        				<button type="button" style="background:#ffffff;" onclick="deleteCopyBomMatr()" authchk>
	        					<img src="/static/img/ll-arrow.png"/>
	        				</button>
	        			</td>
	        			<td style="width: 48%;border-right:0px;border-bottom:0px;">
			                <div style="margin-right: 12px;">
			                	<div data-ax5grid="bom-copy-grid" data-ax5grid-config="{}" style="height:580px; width: 100%" ></div>
			                </div>
	        			</td>
	        		</tr>
	        	</table>
	        	</li>
	        </ul>
	    </div>
	  </div>
	</div>
    <br>
	<div class="col-xs-2" style="height: 70px;">
	</div>
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtnSave" authChk>등록</button>
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>
</div>

<script type="text/javascript">

var actionType = null;
let initBomMatrArr = [];

//"nextPrcsnNm",
ax5.ui.grid.formatter["popupGrid1"] = function () {
	if(this.item.matrYn == "N") {
		return "";
	}
	var aHtml = "";
	aHtml += '<a style="background:url(/static/img/svg/search.svg) no-repeat 50% 50%;background-size:18px 18px;opacity:0.5;" ';
	aHtml += 'onclick="openClntSearchGrid(\'nextPrcsnNm\','+this.dindex+');" data-onclick="openClntSearchGrid(\'nextPrcsnNm\','+this.dindex+');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>';

    return aHtml;
};
//dlvplcNm
ax5.ui.grid.formatter["popupGrid2"] = function () {
	if(this.item.matrYn == "N") {
		return "";
	}
	var aHtml = "";
	aHtml += '<a style="background:url(/static/img/svg/search.svg) no-repeat 50% 50%;background-size:18px 18px;opacity:0.5;" ';
	aHtml += 'onclick="openClntSearchGrid(\'dlvplcNm\','+this.dindex+');" data-onclick="openClntSearchGrid(\'dlvplcNm\','+this.dindex+');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>';

    return aHtml;
};
//openMatListSearch
ax5.ui.grid.formatter["popupGrid3"] = function () {
	if(this.item.matrYn == "N") {
		return "";
	}
	var aHtml = "";
	aHtml += '<a style="background:url(/static/img/svg/search.svg) no-repeat 50% 50%;background-size:18px 18px;opacity:0.5;" ';
	aHtml += 'onclick="openMatListSearchGrid(\'matrCd\','+this.dindex+');" data-onclick="openMatListSearchGrid(\'matrCd\','+this.dindex+');">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>';

    return aHtml;
};

var bomSearchGridView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	 showRowSelector: false,
		    	 showLineNumber: true,
		    	 lineNumberColumnWidth: 40,
		    	 multipleSelect: true,
		    	 sortable: false,
		         target: $('[data-ax5grid="bom-search-grid"]'),
		         header: {
		        		 align: "center",
		        		 selector: true
		         },
		         body: {
		        	 	 mergeCells : ["salesCd"],//editor 는 merge 안됨
			        	 onClick: function () {
		                	$.each($.extend({}, this.list), function(idx, obj){
		                		bomSearchGridView.target.select(obj.__index, {selected: false});//this.self.select 사용시 멀티선택됨
	                        });
			             	this.self.select(this.dindex);
			        	 },
						 onDBLClick: function () {
						 },
			             onDataChanged: function () {
			             }//,
	             },
		         columns : [
	        	 	 {key: "dtaChk",			label: " ",					width: 30,		align: "center",	hidden:true, styleClass: "grid-font-blue-bold"}
		        	,{key: "lvl",				label: "LVL",				width: 40,		align: "center",	hidden:true}
		        	,{key: "coCd", 				label: "CO", 				width: 50,		align: "center",	hidden:true}
		        	,{key: "ordrsNo", 			label: "ordrsNo", 			width: 80,		align: "center",	hidden:true}
		        	,{key: "salesCd", 			label: "Sales Code", 		width: 100,		align: "center",	hidden:true}
					,{key: "lowerCode",			label: "도번",				width: 320,		align: "left",  	treeControl: true}
		        	,{key: "dsgnNo" , 			label: "dsgnNo",			width: 180,		align: "left",		hidden:true}
					,{key: "upperCode",			label: "upperCode",			width: 150,		align: "left",		hidden:true}
					,{key: "upperCd", 			label: "upperCd" ,			width: 150,		align: "left",		hidden:true}
					,{key: "lowerCd", 			label: "lowerCd" ,			width: 180,		align: "left",		hidden:true}
		        	,{key: "matrYn", 			label: "자재여부", 			width:  60,		align: "center"}
					,{key: "dsgnNm" , 			label: "명칭" 	 ,			width: 300,		align: "left"}
					,{key: "dsgnBomQty",		label: "수량" 	,			width: 60,		align: "right"}
					,{key: "matrSeq", 			label: "자재순번", 			width:  70,		align: "center"}
					,{key: "ordrgDiv10", 		label: "발주용도", 			width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.ordrgDiv10;
							$.each(options_01, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "ordrgDiv20", 		label: "발주유형", 		width: 100,	align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.ordrgDiv20;
							$.each(options_02, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "nextPrcsnNm", 		label: "후행업체", 			width: 150,		align: "left"}
					,{key: "dlvplcNm", 			label: "배송처", 				width: 150,		align: "left"}
					,{key: "bomQty", 			label: "수량", 				width: 60,		align: "right"}
					,{key: "matrCd", 			label: "자재코드", 			width: 80,		align: "center"}
					,{key: "matrNm", 			label: "자재명", 				width: 160,		align: "left"}
					,{key: "goodsDiv", 			label: "자재구분", 			width: 90,	align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.goodsDiv;
							$.each(options_03, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "matrClntDiv", 		label: "거래처구분", 			width: 120,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrClntDiv;
							$.each(options_04, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "matrDiv", 			label: "자재유형", 			width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrDiv;
							$.each(options_05, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "matrGrp", 			label: "자재그룹", 			width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrGrp;
							$.each(options_06, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "matrMat", 			label: "소재", 				width: 100,		align: "center"}
					,{key: "matrSize", 			label: "크기", 				width: 100,		align: "center"}
					,{key: "matrSpec", 			label: "규격", 				width: 100,		align: "left"}
					,{key: "matrMakrNm", 		label: "제조사", 				width: 100,		align: "center"}
					,{key: "matrMno", 			label: "Model No", 			width: 100,		align: "center"}
					,{key: "matrWt", 			label: "중량", 				width: 100,		align: "right"}
					,{key: "matrUnit", 			label: "단위", 				width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrUnit;
							$.each(options_07, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "useYn", 			label: "사용여부", 			width: 70,		align: "center", formatter: "useYn"}
					,{key: "matrStockCd", 		label: "재고관리", 			width: 70,		align: "center", formatter: "useYn"}
					,{key: "originNm", 			label: "원산지", 				width: 100,		align: "center"}
					,{key: "matrDrwNo", 		label: "대표도면", 			width: 120,		align: "center"}
					,{key: "matrTestDiv", 		label: "입고검사구분", 			width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrTestDiv;
							$.each(options_08, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "dlvrRqmDay", 		label: "납품소요일자", 			width: 100,		align: "right"}
					,{key: "matrPurcDiv", 		label: "구매/외주구분", 			width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrPurcDiv;
							$.each(options_09, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "minOrdrgQty", 		label: "최소발주량", 			width: 100,		align: "right"}
					,{key: "matrSaftQty", 		label: "안전재고", 			width: 100,		align: "right"}
					,{key: "dsgn2dMd", 			label: "2D설계소요일", 			width: 100,		align: "right"}
					,{key: "avrg2dMd", 			label: "2D평균소요일", 			width: 100,		align: "right"}
					,{key: "dsgn3dMd", 			label: "3D설계소요일", 			width: 100,		align: "right"}
					,{key: "avrg3dMd", 			label: "3D평균소요일", 			width: 100,		align: "right"}
					,{key: "prdctnRqmMd", 		label: "생산소요일", 			width: 100,		align: "right"}
					,{key: "prdctnAvrgMd", 		label: "생산평균소요일", 		width: 100,		align: "right"}
					,{key: "matrPartNo", 		label: "파트번호", 			width: 100,		align: "center"}
					,{key: "pchsClntCd1", 		label: "구매업체1", 			width: 80,		align: "right"}
					,{key: "pchsClntPct1", 		label: "발주비율1", 			width: 80,		align: "right"}
					,{key: "pchsClntCd2", 		label: "구매업체2", 			width: 80,		align: "right"}
					,{key: "pchsClntPct2", 		label: "발주비율2", 			width: 80,		align: "right"}
					,{key: "pchsClntCd3", 		label: "구매업체3", 			width: 80,		align: "right"}
					,{key: "pchsClntPct3", 		label: "발주비율3", 			width: 80,		align: "right"}
					,{key: "matrUpr", 			label: "최종구매단가", 			width: 100,		align: "right",  formatter: "money"}
					,{key: "matrAvrgUpr", 		label: "평균구매단가", 			width: 100,		align: "right",  formatter: "money"}
					,{key: "matrRmk", 			label: "비고", 				width: 150,		align: "left"}
					,{key: "matrLastTrstDt", 	label: "최종거래일자", 			width: 100,		align: "center"}
					,{key: "matrAtntCd", 		label: "대체자재코드", 			width: 100,		align: "center"}
					,{key: "matrNo", 			label: "자재번호", 			width: 100,		align: "center"}
			     ],
	              tree: {
	                    use: true,
	                    indentWidth: 15,
	                    arrowWidth: 15,
	                    iconWidth: 18,
	                    icons: {
	                        openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
	                        collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
	                        groupIcon: '<i class="fa fa-folder-open" aria-hidden="true"></i>',
	                        collapsedGroupIcon: '<i class="fa fa-folder" aria-hidden="true"></i>',
	                        itemIcon: '<i class="fa fa-circle" aria-hidden="true"></i>'
	                    },
		                columnKeys: {
		                parentKey: "upperCode",
		                selfKey: "lowerCode",
		               }
		           }
		    });
			return this;
		},


        setData: function(_pageNo){
			var target = this.target;
			var formData = {
				"coCd" : $('#coCd').val(),
				"ordrsNo" : $('#ordrsNo').val(),
				"salesCd" : $("#salesCd").val(),
			}

    		postAjax("/user/sm/sm01/selectBomMatrTreeList", formData, null, function(data) {
				var list = data.resultList;
				target.setData({
            		list : list,
            		page : {
            			totalElements : list.length
            		}
       			});
    	 	});
     	} //setData
     }


var bomCopyGridView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	 showRowSelector: false,
		    	 showLineNumber: true,
		    	 lineNumberColumnWidth: 40,
		    	 multipleSelect: true,
		    	 sortable: false,
		         target: $('[data-ax5grid="bom-copy-grid"]'),
		         header: {
			        		 align: "center",
			        		 selector: true
			    },
		        body: {
		        	 	 mergeCells : ["salesCd"],//editor 는 merge 안됨
			        	 onClick: function () {
		                	$.each($.extend({}, this.list), function(idx, obj){
		                		bomCopyGridView.target.select(obj.__index, {selected: false});//this.self.select 사용시 멀티선택됨
	                        });
			             	this.self.select(this.dindex);
			        	 },
						 onDBLClick: function () {
						 },
			             onDataChanged: function () {
			             }
		        },
		        columns : [
		        	 	 {key: "dtaChk",			label: " ",					width: 30,		align: "center",	hidden:true, styleClass: "grid-font-blue-bold"}
			        	,{key: "lvl",				label: "LVL",				width: 40,		align: "center",	hidden:true}
			        	,{key: "coCd", 				label: "CO", 				width: 50,		align: "center",	hidden:true}
			        	,{key: "ordrsNo", 			label: "ordrsNo", 			width: 80,		align: "center",	hidden:true}
			        	,{key: "salesCd", 			label: "Sales Code", 		width: 100,		align: "center",	hidden:true}
						,{key: "lowerCode",			label: "도번",				width: 320,		align: "left",  	treeControl: true}
			        	,{key: "dsgnNo" , 			label: "dsgnNo",			width: 180,		align: "left",		hidden:true}
						,{key: "upperCode",			label: "upperCode",			width: 150,		align: "left",		hidden:true}
						,{key: "upperCd", 			label: "upperCd" ,			width: 150,		align: "left",		hidden:true}
						,{key: "lowerCd", 			label: "lowerCd" ,			width: 180,		align: "left",		hidden:true}
			        	,{key: "matrYn", 			label: "자재여부", 			width:  60,		align: "center"}
						,{key: "dsgnNm" , 			label: "명칭" 	 ,			width: 300,		align: "left",
			        		editor:{type:  "text",
			        			disabled: function () {
			        				if(this.item.dtaChk == "D"||this.item.matrYn == "Y"){
				        		        return true;
			        				} else {
			        					return false;
			        				}
			        		    },
			        		    attributes: { 'maxlength': 100 }
	    					}
	                    }
						,{key: "dsgnBomQty",		label: "수량" 	,			width: 60,		align: "right",
			        		editor:{type:  "number",
			        			disabled: function () {
			        				if(this.item.dtaChk == "D"||this.item.matrYn == "Y"){
				        		        return true;
			        				} else {
			        					return false;
			        				}
			        		    },
		        		    	attributes: { 'maxlength': 5 }
							}
	                	}
						,{key: "matrSeq", 			label: "자재순번", 			width:  70,		align: "center"}
						,{key: "ordrgDiv20", 		label: "발주용도", 			width: 80,	align: "left"
							, editor: {type: "select",
								config: {
									columnKeys: {optionValue: 'value',optionText: 'text'},
									options: options_02
								},
								disabled: function () {
									if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
									return true;
								}
							}
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.ordrgDiv20;
								$.each(options_02, function (idx, elem) {
									if(itemValue == elem.value)
									{
										result_text = elem.text;
									}
								});
								return result_text;
							}
						 }
						,{key: "ordrgDiv10", 		label: "발주유형", 		width: 80,	align: "left"
							, editor: {type: "select",
								config: {
									columnKeys: {optionValue: 'value',optionText: 'text'},
									options: options_01
								},
								disabled: function () {
									if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
									return true;
								}
							}
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.ordrgDiv10;
								$.each(options_01, function (idx, elem) {
									if(itemValue == elem.value)
									{
										result_text = elem.text;
									}
								});
								return result_text;
							}
						 }
						,{key: "nextPrcsnNm", 		label: "후행업체", 		width: 118,	align: "left"
							, editor: {type: "text",
								disabled: function () {
									if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
									return true;
								},attributes: {'maxlength': 100,'data-maxlength': 300}}
						}
						,{key: "popupGrid1",    	label: " ", 		    width: 30,	align: "center", formatter: "popupGrid1"}
						,{key: "dlvplcNm", 			label: "배송처", 			width: 118,	align: "left"
							, editor: {type: "text",
								disabled: function () {
									if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
									return true;
								},attributes: {'maxlength': 100,'data-maxlength': 300}}
						}
						,{key: "popupGrid2",    	label: " ", 		    width: 30,	align: "center", formatter: "popupGrid2"}
						,{key: "bomQty", 			label: "수량", 			width: 60,	align: "right"
							, editor:{type:  "number",
							disabled: function () {
								if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
								return true;
							}}}
						,{key: "posQty", 			label: "소유량", 			width: 60,	align: "right"
							, editor:{type:  "number",
							disabled: function () {
								if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
								return true;
							}}}
						,{key: "matrCd", 			label: "자재코드", 		width: 80,	align: "center"}
						,{key: "popupGrid3",    	label: " ", 		    width: 30,	align: "center", formatter: "popupGrid3"}
						,{key: "matrNm", 			label: "자재명", 			width: 160,	align: "left"}
						,{key: "goodsDiv", 			label: "자재구분", 		width: 90,	align: "center"
							, editor: {type: "select",
								config: {
									columnKeys: {optionValue: 'value',optionText: 'text'},
									options: options_03
								},
								disabled: function () {
									if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
									return true;
								}
							}
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.goodsDiv;
								$.each(options_03, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrClntDiv", 		label: "거래처구분", 			width: 120,		align: "center"
							, editor: {type: "select",
								config: {
									columnKeys: {optionValue: 'value',optionText: 'text'},
									options: options_04
								},
								disabled: function () {
									if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
									return true;
								}
							}
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrClntDiv;
								$.each(options_04, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrDiv", 			label: "자재유형", 			width: 100,		align: "center"
							, editor: {type: "select",
								config: {
									columnKeys: {optionValue: 'value',optionText: 'text'},
									options: options_05
								},
								disabled: function () {
									if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
									return true;
								}
							}
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrDiv;
								$.each(options_05, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrGrp", 			label: "자재그룹", 			width: 100,		align: "center"
							, editor: {type: "select",
								config: {
									columnKeys: {optionValue: 'value',optionText: 'text'},
									options: options_06
								},
								disabled: function () {
									if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
									return true;
								}
							}
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrGrp;
								$.each(options_06, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrMat", 			label: "소재", 				width: 100,		align: "center"}
						,{key: "matrSize", 			label: "크기", 				width: 100,		align: "center"}
						,{key: "matrSpec", 			label: "규격", 				width: 100,		align: "left"}
						,{key: "matrMakrNm", 		label: "제조사", 				width: 100,		align: "center"}
						,{key: "matrMno", 			label: "Model No", 			width: 100,		align: "center"}
						,{key: "matrWt", 			label: "중량", 				width: 100,		align: "right"}
						,{key: "matrUnit", 			label: "단위", 				width: 100,		align: "center"
							, editor: {type: "select",
								config: {
									columnKeys: {optionValue: 'value',optionText: 'text'},
									options: options_07
								},
								disabled: function () {
									if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
									return true;
								}
							}
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrUnit;
								$.each(options_07, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "useYn", 			label: "사용여부", 			width: 70,		align: "center", formatter: "useYn"}
						,{key: "matrStockCd", 		label: "재고관리", 			width: 70,		align: "center", formatter: "useYn"}
						,{key: "originNm", 			label: "원산지", 				width: 100,		align: "center"}
						,{key: "matrDrwNo", 		label: "대표도면", 			width: 120,		align: "center"}
						,{key: "matrTestDiv", 		label: "입고검사구분", 			width: 100,		align: "center"
							, editor: {type: "select",
								config: {
									columnKeys: {optionValue: 'value',optionText: 'text'},
									options: options_08
								},
								disabled: function () {
									if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
									return true;
								}
							}
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrTestDiv;
								$.each(options_08, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "dlvrRqmDay", 		label: "납품소요일자", 			width: 100,		align: "right"}
						,{key: "matrPurcDiv", 		label: "구매/외주구분", 			width: 100,		align: "center"
							, editor: {type: "select",
								config: {
									columnKeys: {optionValue: 'value',optionText: 'text'},
									options: options_09
								},
								disabled: function () {
									if(this.item.matrYn == "Y" && this.item.dtaChk != "D") return false;
									return true;
								}
							}
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrPurcDiv;
								$.each(options_09, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "minOrdrgQty", 		label: "최소발주량", 			width: 100,		align: "right"}
						,{key: "matrSaftQty", 		label: "안전재고", 			width: 100,		align: "right"}
						,{key: "dsgn2dMd", 			label: "2D설계소요일", 			width: 100,		align: "right"}
						,{key: "avrg2dMd", 			label: "2D평균소요일", 			width: 100,		align: "right"}
						,{key: "dsgn3dMd", 			label: "3D설계소요일", 			width: 100,		align: "right"}
						,{key: "avrg3dMd", 			label: "3D평균소요일", 			width: 100,		align: "right"}
						,{key: "prdctnRqmMd", 		label: "생산소요일", 			width: 100,		align: "right"}
						,{key: "prdctnAvrgMd", 		label: "생산평균소요일", 		width: 100,		align: "right"}
						,{key: "matrPartNo", 		label: "파트번호", 			width: 100,		align: "center"}
						,{key: "pchsClntCd1", 		label: "구매업체1", 			width: 80,		align: "right"}
						,{key: "pchsClntPct1", 		label: "발주비율1", 			width: 80,		align: "right"}
						,{key: "pchsClntCd2", 		label: "구매업체2", 			width: 80,		align: "right"}
						,{key: "pchsClntPct2", 		label: "발주비율2", 			width: 80,		align: "right"}
						,{key: "pchsClntCd3", 		label: "구매업체3", 			width: 80,		align: "right"}
						,{key: "pchsClntPct3", 		label: "발주비율3", 			width: 80,		align: "right"}
						,{key: "matrUpr", 			label: "최종구매단가", 			width: 100,		align: "right",  formatter: "money"}
						,{key: "matrAvrgUpr", 		label: "평균구매단가", 			width: 100,		align: "right",  formatter: "money"}
						,{key: "matrRmk", 			label: "비고", 				width: 150,		align: "left"}
						,{key: "matrLastTrstDt", 	label: "최종거래일자", 			width: 100,		align: "center"}
						,{key: "matrAtntCd", 		label: "대체자재코드", 			width: 100,		align: "center"}
						,{key: "matrNo", 			label: "자재번호", 			width: 100,		align: "center"}
						],
			              tree: {
			                    use: true,
			                    indentWidth: 15,
			                    arrowWidth: 15,
			                    iconWidth: 18,
			                    icons: {
			                        openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
			                        collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
			                        groupIcon: '<i class="fa fa-folder-open" aria-hidden="true"></i>',
			                        collapsedGroupIcon: '<i class="fa fa-folder" aria-hidden="true"></i>',
			                        itemIcon: '<i class="fa fa-circle" aria-hidden="true"></i>'
			                    },
				                columnKeys: {
				                parentKey: "upperCode",
				                selfKey: "lowerCode",
				               }
				           }
		    });
			return this;
		},

		setData: function(){
			var target = this.target;
	 		var coCd_SS = $('#coCd_SS').val();
			var ordrsNo_SS = $('#ordrsNo_SS').val();
			var salesCd_SS = $('#salesCd_SS').val();
			var salesCd = $('#salesCd').val();

			let bomMatrArr = JSON.parse(JSON.stringify(bomSearchGridView.target.list));
			setSaveReplace(bomMatrArr, coCd_SS, ordrsNo_SS, salesCd, salesCd_SS);

			var list = bomMatrArr;
			target.setData({
	    		list : list,
	    		page : {
	    			totalElements : list.length
	    		}
			});
		}
	}


 	$(document).ready(function() {
 		//debugger;
		setComboOptions($(".popup_area select[data-kind]"));
		setByCoCd(modalStack.last().paramObj.coCd);
		$("#ordrsNo").val(modalStack.last().paramObj.ordrsNo);
		$("#salesCd").val(modalStack.last().paramObj.salesCd);
		$("#clntNm").val(modalStack.last().paramObj.clntNm);
		$("#clntPjt").val(modalStack.last().paramObj.clntPjt);
		$("#itemDivNm").val(modalStack.last().paramObj.itemDivNm);
		$("#eqpNm").val(modalStack.last().paramObj.eqpNm);
		$("#prdtNm").val(modalStack.last().paramObj.prdtNm);

		$("#userId").val(jwt.userId);

		authChk();// 권한체크

		/**
		 * grid 초기화
		*/
		bomSearchGridView.initView().setData(0);
		bomCopyGridView.initView();

		$('#actionBtnSave').text("등록");
		$('#actionBtnSave').on("click", function() {
			insertCrudMatrAndBom();
		});
		/*
		$('#actionBtnCopy').on("click", function() {
			copyBomMatr();
		});
		*/
 	});

	this.deleteCopyBomMatr = function(){
		bomCopyGridView.initView();
	}

 	this.copyBomMatr = function(){
 		var coCd_SS = $('#coCd_SS').val();
		var salesCd_SS = $('#salesCd_SS').val();
		var salesCd = $('#salesCd').val();

		if(isEmpty(coCd_SS)){
	 		alert("대상 [회사] 를 검색 하세요.");
	 		return;
 		}
 		if(isEmpty(salesCd)){
	 		alert("복사 할 [Sales Code]가 없습니다.");
	 		return;
 		}
 		if(isEmpty(salesCd_SS)){
	 		alert("대상 [Sales Code] 를 검색 하세요.");
	 		return;
 		}

 		bomCopyGridView.setData(0);
 	}

 	// 등록
	function insertCrudMatrAndBom() {
		if(bomCopyGridView.target.list.length == 0) {
			alert("생성된 [BOM]이 없습니다. 복사될 Sales Code를 선택[생성] 후 [등록]하세요.");
			return;
		}

		if (inputValidation($('.popup_area [required]'))) {
			var formData = makeFormData();
			setFormLock(".popup_area");
 			filePostAjax("/user/sm/sm01/insertCrudMatrAndBom", formData,
					function(data) {
						alert(data.resultMessage);
						if (data.resultCode == 200) {
							gridView.setData(main_pageNo,true);
							modalStack.close();
						}
					});
		}
	}

 	//----------------------------------------------//
	function makeFormData() {
		// 금액 콤마 제거
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		// 폼데이터 생성
		var formData = getFormData("#pop05Form");
		//var formData = new FormData($("#pop05Form")[0]);

		let bom_dataList = JSON.parse(JSON.stringify(bomCopyGridView.target.list));
		let bom_data = getFilterDataMatrYn(bom_dataList, "N");
		let bomArr = deleteChildren(bom_data);
		//console.log("====bomArr",bomArr);
		formData.append("bomArr", JSON.stringify(bomArr));

		let matr_dataList = JSON.parse(JSON.stringify(bomCopyGridView.target.list));
		let matr_data = getFilterDataMatrYn(matr_dataList, "Y");
		let matrArr = deleteChildren(matr_data);
		//console.log("====matrArr",matrArr);
		formData.append("matrArr", JSON.stringify(matrArr));
		//세부 아이템 자료 끝
		return formData;
	}

	this.getFilterDataMatrYn = function(obj, sel_matrYn) {
		const resultData = obj.filter(function(element){
			return sel_matrYn == element.matrYn;
		});
		return resultData;
	}


	//등록되지 않은 SalesCd 를 검색한다.
	function bomSalesCdSearch() {
	    var paramObj = {
	       "coCd" : $('#coCd_SS').val(),
	       "salesCd": $('#salesCd_SS').val()
	    };
	    openSecondModal("/static/html/cmn/modal/bomSalesCdSearch.html", 1000, 430, "SALES CODE 검색", paramObj, function (grid){
	    	//debugger;
	        var row = grid.target.getList("selected")[0];

	        //console.log("rowData==>",row);
	        $('#ordrsNo_SS').val(row.ordrsNo);
	        $('#salesCd_SS').val(row.salesCd);
	        $('#clntNm_SS').val(row.clntNm);
	        $('#clntPjt_SS').val(row.clntPjt);
	        $('#prdtNm_SS').val(row.prdtNm);
	        $('#itemDivNm_SS').val(row.itemDivNm);
	        $('#eqpNm_SS').val(row.eqpNm);

	        bomCopyGridView.setData(0);
	    });
	}

	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();
	}

 	this.setSaveReplace = function(obj, _coCd, _ordrsNo, before_salesCd, _salesCd) {
 		$.each($.extend({}, obj), function (idx, elem) {
			elem.coCd = _coCd;
			elem.ordrsNo = _ordrsNo;
			elem.salesCd = elem.salesCd.replace(before_salesCd,_salesCd);
			elem.upperCd = elem.upperCd.replace(before_salesCd,_salesCd);
			elem.lowerCd = elem.lowerCd.replace(before_salesCd,_salesCd);
			elem.upperCode = elem.upperCode.replace(before_salesCd,_salesCd);
			elem.lowerCode = elem.lowerCode.replace(before_salesCd,_salesCd);
			elem.dsgnNo = elem.lowerCd;
			elem.dtaChk = "I";
		});
 	}

 	function initCopyGrid(){
 		copyBomMatr();
 	}

	function deleteCopyGrid(){
		if(selectGridValidation(bomCopyGridView.target)) return;
		var selData = bomCopyGridView.target.getList("selected")[0];
		var bomDtaChk = selData.dtaChk;
		let listData = JSON.parse(JSON.stringify(bomCopyGridView.target.list));
		var lowIndexArray = findLowerArray(listData, selData.lowerCode, "upperCode", "lowerCode");
		descSort(lowIndexArray);
		setFormLock(".popup_area", true , function () {
			$.each(lowIndexArray, function (idx, row) {
				var rowIdx = Number(row);
				var dtaChk = getValue(listData, rowIdx, "dtaChk");
				if(dtaChk == "I") {
					bomCopyGridView.target.removeRow(rowIdx);
				}
				else {
					bomCopyGridView.target.setValue(rowIdx, "dtaChk", "D");
				}
			});
			if(bomDtaChk == "I"){
				bomCopyGridView.target.removeRow(selData.__index);
			}
			else {
				bomCopyGridView.target.setValue(selData.__index, "dtaChk", "D");
			}
			console.log("====>>",bomCopyGridView.target);
			setFormUnLock(".popup_area" , true);
		});
	}
</script>