<style>
* input[comma] {
  text-align: right;
 }
</style>
<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">구매BOM 복사</h4>
    </div>
    <div class="add_btn_small pdl10" style="margin-right:8px;margin-bottom:8px;">
        <button id="actionBtnCopy">생성</button>
    </div>

  <div class="form-group popup_table">
   <form id="pop05Form" onSubmit="return false;">
		<input type="hidden" id="userId"     	name="userId">
		<input type="hidden" id="pgmId"     	name="pgmId"	value="SM0101M01">      
      <table>

        <colgroup>
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
        </colgroup>

        <tr>
			<th class="hit">회사</th>
			<td>
			  <select id="coCd" name="coCd" data-kind="CO" class="form-control" required="required" msg="회사" readonly="readonly">
			  </select>
			</td>
			<th class="hit">Sales Code</th>
			<td>
				<input type="text" id="salesCd" name="salesCd" class="form-control" required="required" msg="Sales Code" readonly="readonly">
			</td>
			<th class="hit">회사</th>
			<td>
			  <select id="coCd_SS" name="coCd_SS" data-kind="CO" required="required" msg="회사">
			  </select>
			</td>
			<th class="hit">Sales Code</th>
			<td>
				<div class="search_form" >
					<input type="text" id="salesCd_SS" readonly="readonly" onkeyup="if(window.event.keyCode == 13) {gridView.setData(0);};">
			        <a onclick="bomSalesCdSearch();"><i class="i_search_w"></i></a>
				</div>
			</td>
        </tr>
        
        <tr>
			<th>고객사</th>
			<td>
				<input type="text" id="clntNm" name="clntNm" class="form-control" msg="고객사" readonly="readonly">
			</td>
			<th>고객사PJT</th>
			<td>
				<input type="text" id="clntPjt" name="clntPjt" class="form-control" msg="고객사PJT" readonly="readonly"> 
			</td>
			<th>고객사</th>
			<td>
				<input type="text" id="clntNm_SS" name="clntNm_SS" class="form-control" msg="고객사" readonly="readonly">
			</td>
			<th>고객사PJT</th>
			<td>
				<input type="text" id="clntPjt_SS" name="clntPjt_SS" class="form-control" msg="고객사PJT" readonly="readonly"> 
			</td>
        </tr>

        <tr>
			<th>제품구분</th>
			<td>
				<input type="text" id="prdtNm" name="prdtNm" class="form-control" msg="제품명" readonly="readonly">
			</td>
			<th>아이템구분</th>
			<td>
				<input type="text" id="itemDivNm" name="itemDivNm" class="form-control" msg="아이템구분" readonly="readonly">
			</td>
			<th>제품구분</th>
			<td>
				<input type="text" id="prdtNm_SS" name="prdtNm_SS" class="form-control" msg="제품명" readonly="readonly">
			</td>
			<th>아이템구분</th>
			<td>
				<input type="text" id="itemDivNm_SS" name="itemDivNm_SS" class="form-control" msg="아이템구분" readonly="readonly">
			</td>
        </tr>

        <tr>
			<th>설비명</th>
			<td colspan="3">
				<input type="text" id="eqpNm" name="eqpNm" msg="설비명" class="form-control" readonly="readonly">
			</td>
			<th>설비명</th>
			<td colspan="3">
				<input type="text" id="eqpNm_SS" name="eqpNm_SS" msg="설비명" class="form-control" readonly="readonly">
			</td>
        </tr>

      </table>
    </form>

	<!-- 콘텐츠 -->
	  <div class="contents" style="margin-top: 10px;">
	      <!-- 리스트 -->
	      <div class="ax5_grid" style="width: 100%">
	        <ul class="ul_list" style="height:350px; width: 100%">
	            <li style="width: 49%;">
	                <div class="table_list_tit" style="width: 100%;">
	                	<h5 style="color: #444;font-size: 16px;float:left; margin-left: 8px; margin-top: 8px; margin-bottom: 8px;">원본 BOM - 자재</h5>
		                <div class="add_btn pdl10" style="margin-right:8px; margin-top: 8px;">
		                </div>
	                </div>
	                <div>
	                	<div data-ax5grid="bom-search-grid" data-ax5grid-config="{}" style="height:500px; width: 100%" ></div>
	                </div>
	            </li>
	            <li style="width: 49%; margin-left: 8px;">
	                <div class="table_list_tit">
	                	<h5 style="color: #444;font-size: 16px;float:left; margin-left: 8px; margin-top: 8px; margin-bottom: 8px;">생성 BOM - 자재</h5>
		                <div class="add_btn pdl10" style="margin-right:8px; margin-top: 8px;">
		                </div>
	                </div>
	                <div>
	                	<div data-ax5grid="bom-copy-grid" data-ax5grid-config="{}" style="height:500px; width: 100%" ></div>
	                </div>
	            </li>
	        </ul>	
	    </div>
	  </div>
	</div>
    <br>
	<div class="col-xs-2" style="height: 70px;">
	</div>
</div>
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtnSave" authChk>등록</button>
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>

<script type="text/javascript">

var actionType = null;

var bomSearchGridView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	 showRowSelector: false,
		    	 multipleSelect: true,
		    	 sortable: false,
		         target: $('[data-ax5grid="bom-search-grid"]'),
		         header: {
		        		 align: "center",
		        		 selector: true
		         },
		         body: {
		        	 	 mergeCells : ["salesCd"],//editor 는 merge 안됨
			        	 onClick: function () {
		                	$.each($.extend({}, this.list), function(idx, obj){
		                		bomSearchGridView.target.select(obj.__index, {selected: false});//this.self.select 사용시 멀티선택됨
	                        });
			             	this.self.select(this.dindex);
			        	 },
						 onDBLClick: function () {
						 },
			             onDataChanged: function () {
			             }//,
	             },
		         columns : [
		        	 {key: "dtaChk",label: " ", width: 30	,hidden:true}
		        	,{key: "lvl", label: "LVL", width: 40	,hidden:true}
		        	,{key: "coCd", label: "CO", width: 50	,hidden:true}
		        	,{key: "salesCd", 			label: "Sales Code", 		width: 120,		hidden:true}
					,{key: "partNo", 			label: "파트번호", 			width:  70,		align: "center", 	hidden:true}
					,{key: "unitNo", 			label: "유닛번호", 			width:  70,		align: "center", 	hidden:true}
					,{key: "revNo", 			label: "리버전", 				width:  70,		align: "center", 	hidden:true}
					,{key: "upperCode",			label: "상위코드",				width: 180,		align: "left",		hidden:true}
					,{key: "lowerCode",			label: "도번",				width: 400,		align: "left",		hidden:false,  treeControl: true}
					,{key: "upperCd", 			label: "upperCd" ,			width: 180,		align: "left",		hidden:true}
					,{key: "lowerCd", 			label: "lowerCd" ,			width: 180,		align: "left",		hidden:true}
		        	,{key: "dsgnNo" , 			label: "도번",				width: 180,		align: "left",		hidden:true}
		        	,{key: "bmGubun", 			label: "B/M", 				width:  50,		align: "center",	hidden:true}
					,{key: "matrSeq", 			label: "자재순번", 			width:  70,		align: "center"}
					,{key: "ordrgDiv10", 		label: "발주용도", 			width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.ordrgDiv10;
							$.each(options_01, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "ordrgDiv20", 		label: "발주유형", 		width: 100,	align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.ordrgDiv20;
							$.each(options_02, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "nextPrcsnNm", 		label: "후행업체", 			width: 150,		align: "left"}
					,{key: "dlvplcNm", 			label: "배송처", 				width: 150,		align: "left"}
					,{key: "bomQty", 			label: "수량", 				width: 60,		align: "right"}
					,{key: "matrCd", 			label: "자재코드", 			width: 80,		align: "center"}
					,{key: "matrNm", 			label: "자재명", 				width: 160,		align: "left"}
					,{key: "goodsDiv", 			label: "자재구분", 			width: 90,	align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.goodsDiv;
							$.each(options_03, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "matrClntDiv", 		label: "거래처구분", 			width: 120,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrClntDiv;
							$.each(options_04, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "matrDiv", 			label: "자재유형", 			width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrDiv;
							$.each(options_05, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "matrGrp", 			label: "자재그룹", 			width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrGrp;
							$.each(options_06, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "matrMat", 			label: "소재", 				width: 100,		align: "center"}
					,{key: "matrSize", 			label: "크기", 				width: 100,		align: "center"}
					,{key: "matrSpec", 			label: "규격", 				width: 100,		align: "left"}
					,{key: "matrMakrNm", 		label: "제조사", 				width: 100,		align: "center"}
					,{key: "matrMno", 			label: "Model No", 			width: 100,		align: "center"}
					,{key: "matrWt", 			label: "중량", 				width: 100,		align: "right"}
					,{key: "matrUnit", 			label: "단위", 				width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrUnit;
							$.each(options_07, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "useYn", 			label: "사용여부", 			width: 70,		align: "center", formatter: "useYn"}
					,{key: "matrStockCd", 		label: "재고관리", 			width: 70,		align: "center", formatter: "useYn"}
					,{key: "originNm", 			label: "원산지", 				width: 100,		align: "center"}
					,{key: "matrDrwNo", 		label: "대표도면", 			width: 120,		align: "center"}
					,{key: "matrTestDiv", 		label: "입고검사구분", 			width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrTestDiv;
							$.each(options_08, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "dlvrRqmDay", 		label: "납품소요일자", 			width: 100,		align: "right"}
					,{key: "matrPurcDiv", 		label: "구매/외주구분", 			width: 100,		align: "center"
						, formatter: function () {
							var result_text = "";
							var itemValue = this.item.matrPurcDiv;
							$.each(options_09, function (idx, elem) {
								if(itemValue == elem.value) result_text = elem.text;
							});
							return result_text;
						}
					 }
					,{key: "minOrdrgQty", 		label: "최소발주량", 			width: 100,		align: "right"}
					,{key: "matrSaftQty", 		label: "안전재고", 			width: 100,		align: "right"}
					,{key: "dsgn2DMd", 			label: "2D설계소요일", 			width: 100,		align: "right"}
					,{key: "avrg2DMd", 			label: "2D평균소요일", 			width: 100,		align: "right"}
					,{key: "dsgn3DMd", 			label: "3D설계소요일", 			width: 100,		align: "right"}
					,{key: "avrg3DMd", 			label: "3D평균소요일", 			width: 100,		align: "right"}
					,{key: "prdctnRqmMd", 		label: "생산소요일", 			width: 100,		align: "right"}
					,{key: "prdctnAvrgMd", 		label: "생산평균소요일", 		width: 100,		align: "right"}
					,{key: "matrPartNo", 		label: "파트번호", 			width: 100,		align: "center"}
					,{key: "pchsClntCd1", 		label: "구매업체1", 			width: 80,		align: "right"}
					,{key: "pchsClntPct1", 		label: "구매업체1%", 			width: 80,		align: "right"}
					,{key: "pchsClntCd2", 		label: "구매업체2", 			width: 80,		align: "right"}
					,{key: "pchsClntPct2", 		label: "구매업체2%", 			width: 80,		align: "right"}
					,{key: "pchsClntCd3", 		label: "구매업체3", 			width: 80,		align: "right"}
					,{key: "pchsClntPct3", 		label: "구매업체3%", 			width: 80,		align: "right"}
					,{key: "matrUpr", 			label: "최종구매단가", 			width: 100,		align: "right",  formatter: "money"}
					,{key: "matrAvrgUpr", 		label: "평균구매단가", 			width: 100,		align: "right",  formatter: "money"}
					,{key: "matrRmk", 			label: "비고", 				width: 150,		align: "left"}
					,{key: "matrLastTrstDt", 	label: "최종거래일자", 			width: 100,		align: "center"}
					,{key: "matrAtntCd", 		label: "대체자재코드", 			width: 100,		align: "center"}
					,{key: "matrNo", 			label: "자재번호", 			width: 100,		align: "center"}
			     ],
	              tree: {
	                    use: true,
	                    indentWidth: 15,
	                    arrowWidth: 15,
	                    iconWidth: 18,
	                    icons: {
	                        openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
	                        collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
	                        groupIcon: '<i class="fa fa-folder-open" aria-hidden="true"></i>',
	                        collapsedGroupIcon: '<i class="fa fa-folder" aria-hidden="true"></i>',
	                        itemIcon: '<i class="fa fa-circle" aria-hidden="true"></i>'
	                    },
		                columnKeys: {
		                parentKey: "upperCode",
		                selfKey: "lowerCode",
		               }
		           }
		    });
			return this;
		},


        setData: function(_pageNo){
			var target = this.target;
			var formData = {
				"coCd" : $('#coCd').val(),
				"salesCd" : $("#salesCd").val(),
			}

    		postAjax("/user/sm/sm01/selectBomMatrTreeList", formData, null, function(data) {
				var list = data.resultList;
				target.setData({
            		list : list,
            		page : {
            			totalElements : list.length
            		}
       			});
    	 	});
     	} //setData
     }


var bomCopyGridView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	 showRowSelector: false,
		    	 multipleSelect: true,
		    	 sortable: false,
		         target: $('[data-ax5grid="bom-copy-grid"]'),
		         header: {
			        		 align: "center",
			        		 selector: true
			    },
		        body: {
		        	 	 mergeCells : ["salesCd"],//editor 는 merge 안됨
			        	 onClick: function () {
		                	$.each($.extend({}, this.list), function(idx, obj){
		                		bomCopyGridView.target.select(obj.__index, {selected: false});//this.self.select 사용시 멀티선택됨
	                        });
			             	this.self.select(this.dindex);
			        	 },
						 onDBLClick: function () {
						 },
			             onDataChanged: function () {
			             }
		        },
		        columns : [
		        	 {key: "dtaChk",label: " ", width: 30	,hidden:true}
			        	,{key: "lvl", label: "LVL", width: 40	,hidden:true}
			        	,{key: "coCd", label: "CO", width: 50	,hidden:true}
			        	,{key: "salesCd", 			label: "Sales Code", 		width: 120,		hidden:true}
						,{key: "partNo", 			label: "파트번호", 			width:  70,		align: "center", 	hidden:true}
						,{key: "unitNo", 			label: "유닛번호", 			width:  70,		align: "center", 	hidden:true}
						,{key: "revNo", 			label: "리버전", 				width:  70,		align: "center", 	hidden:true}
						,{key: "upperCode",			label: "상위코드",				width: 180,		align: "left",		hidden:true}
						,{key: "lowerCode",			label: "도번",				width: 400,		align: "left",		hidden:false,  treeControl: true}
						,{key: "upperCd", 			label: "upperCd" ,			width: 180,		align: "left",		hidden:true}
						,{key: "lowerCd", 			label: "lowerCd" ,			width: 180,		align: "left",		hidden:true}
			        	,{key: "dsgnNo" , 			label: "도번",				width: 180,		align: "left",		hidden:true}
						,{key: "bmGubun", 			label: "B/M", 				width:  50,		align: "center",	hidden:true}
						,{key: "matrSeq", 			label: "자재순번", 			width:  70,		align: "center"}
						,{key: "ordrgDiv10", 		label: "발주용도", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.ordrgDiv10;
								$.each(options_01, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "ordrgDiv20", 		label: "발주유형", 		width: 100,	align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.ordrgDiv20;
								$.each(options_02, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "nextPrcsnNm", 		label: "후행업체", 			width: 150,		align: "left"}
						,{key: "dlvplcNm", 			label: "배송처", 				width: 150,		align: "left"}
						,{key: "bomQty", 			label: "수량", 				width: 60,		align: "right"}
						,{key: "matrCd", 			label: "자재코드", 			width: 80,		align: "center"}
						,{key: "matrNm", 			label: "자재명", 				width: 160,		align: "left"}
						,{key: "goodsDiv", 			label: "자재구분", 			width: 90,	align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.goodsDiv;
								$.each(options_03, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrClntDiv", 		label: "거래처구분", 			width: 120,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrClntDiv;
								$.each(options_04, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrDiv", 			label: "자재유형", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrDiv;
								$.each(options_05, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrGrp", 			label: "자재그룹", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrGrp;
								$.each(options_06, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "matrMat", 			label: "소재", 				width: 100,		align: "center"}
						,{key: "matrSize", 			label: "크기", 				width: 100,		align: "center"}
						,{key: "matrSpec", 			label: "규격", 				width: 100,		align: "left"}
						,{key: "matrMakrNm", 		label: "제조사", 				width: 100,		align: "center"}
						,{key: "matrMno", 			label: "Model No", 			width: 100,		align: "center"}
						,{key: "matrWt", 			label: "중량", 				width: 100,		align: "right"}
						,{key: "matrUnit", 			label: "단위", 				width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrUnit;
								$.each(options_07, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "useYn", 			label: "사용여부", 			width: 70,		align: "center", formatter: "useYn"}
						,{key: "matrStockCd", 		label: "재고관리", 			width: 70,		align: "center", formatter: "useYn"}
						,{key: "originNm", 			label: "원산지", 				width: 100,		align: "center"}
						,{key: "matrDrwNo", 		label: "대표도면", 			width: 120,		align: "center"}
						,{key: "matrTestDiv", 		label: "입고검사구분", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrTestDiv;
								$.each(options_08, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "dlvrRqmDay", 		label: "납품소요일자", 			width: 100,		align: "right"}
						,{key: "matrPurcDiv", 		label: "구매/외주구분", 			width: 100,		align: "center"
							, formatter: function () {
								var result_text = "";
								var itemValue = this.item.matrPurcDiv;
								$.each(options_09, function (idx, elem) {
									if(itemValue == elem.value) result_text = elem.text;
								});
								return result_text;
							}
						 }
						,{key: "minOrdrgQty", 		label: "최소발주량", 			width: 100,		align: "right"}
						,{key: "matrSaftQty", 		label: "안전재고", 			width: 100,		align: "right"}
						,{key: "dsgn2DMd", 			label: "2D설계소요일", 			width: 100,		align: "right"}
						,{key: "avrg2DMd", 			label: "2D평균소요일", 			width: 100,		align: "right"}
						,{key: "dsgn3DMd", 			label: "3D설계소요일", 			width: 100,		align: "right"}
						,{key: "avrg3DMd", 			label: "3D평균소요일", 			width: 100,		align: "right"}
						,{key: "prdctnRqmMd", 		label: "생산소요일", 			width: 100,		align: "right"}
						,{key: "prdctnAvrgMd", 		label: "생산평균소요일", 			width: 100,		align: "right"}
						,{key: "matrPartNo", 		label: "파트번호", 			width: 100,		align: "center"}
						,{key: "pchsClntCd1", 		label: "구매업체1", 			width: 80,		align: "right"}
						,{key: "pchsClntPct1", 		label: "구매업체1%", 			width: 80,		align: "right"}
						,{key: "pchsClntCd2", 		label: "구매업체2", 			width: 80,		align: "right"}
						,{key: "pchsClntPct2", 		label: "구매업체2%", 			width: 80,		align: "right"}
						,{key: "pchsClntCd3", 		label: "구매업체3", 			width: 80,		align: "right"}
						,{key: "pchsClntPct3", 		label: "구매업체3%", 			width: 80,		align: "right"}
						,{key: "matrUpr", 			label: "최종구매단가", 			width: 100,		align: "right",  formatter: "money"}
						,{key: "matrAvrgUpr", 		label: "평균구매단가", 			width: 100,		align: "right",  formatter: "money"}
						,{key: "matrRmk", 			label: "비고", 				width: 150,		align: "left"}
						,{key: "matrLastTrstDt", 	label: "최종거래일자", 			width: 100,		align: "center"}
						,{key: "matrAtntCd", 		label: "대체자재코드", 			width: 100,		align: "center"}
						,{key: "matrNo", 			label: "자재번호", 			width: 100,		align: "center"}
						],
			              tree: {
			                    use: true,
			                    indentWidth: 15,
			                    arrowWidth: 15,
			                    iconWidth: 18,
			                    icons: {
			                        openedArrow: '<i class="fa fa-caret-down" aria-hidden="true"></i>',
			                        collapsedArrow: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
			                        groupIcon: '<i class="fa fa-folder-open" aria-hidden="true"></i>',
			                        collapsedGroupIcon: '<i class="fa fa-folder" aria-hidden="true"></i>',
			                        itemIcon: '<i class="fa fa-circle" aria-hidden="true"></i>'
			                    },
				                columnKeys: {
				                parentKey: "upperCode",
				                selfKey: "lowerCode",
				               }
				           }
		    });
			return this;
		},
		
		setData: function(){
			var target = this.target;
	 		var coCd_SS = $('#coCd_SS').val();
			var salesCd_SS = $('#salesCd_SS').val();
			var salesCd = $('#salesCd').val();
			
			let bomMatrArr = JSON.parse(JSON.stringify(bomSearchGridView.target.list));
			setSaveReplace(bomMatrArr, coCd_SS, salesCd, salesCd_SS);
			
			var list = bomMatrArr;
			target.setData({
	    		list : list,
	    		page : {
	    			totalElements : list.length
	    		}
			});
		}
	}


 	$(document).ready(function() {
 		//debugger;
		setCommonSelect($(".popup_area select[data-kind]"));
		setByCoCd(modalStack.last().paramObj.coCd);
		$("#salesCd").val(modalStack.last().paramObj.salesCd);
		$("#clntNm").val(modalStack.last().paramObj.clntNm);
		$("#clntPjt").val(modalStack.last().paramObj.clntPjt);
		$("#itemDivNm").val(modalStack.last().paramObj.itemDivNm);
		$("#eqpNm").val(modalStack.last().paramObj.eqpNm);
		$("#prdtNm").val(modalStack.last().paramObj.prdtNm);
		
		authChk();// 권한체크

		/**
		 * grid 초기화
		*/
		bomSearchGridView.initView().setData(0);
		bomCopyGridView.initView();
		
		$('#actionBtnSave').text("등록");
		$('#actionBtnSave').on("click", function() {
			insertCopyBomMatr();
		});
		$('#actionBtnCopy').on("click", function() {
			copyBomMatr();
		});
		
 	});
 	
 	this.copyBomMatr = function(){
 		var coCd_SS = $('#coCd_SS').val();
		var salesCd_SS = $('#salesCd_SS').val();
		var salesCd = $('#salesCd').val();

		if(isEmpty(coCd_SS)){
	 		alert("대상 [회사] 를 검색 하세요.");
	 		return;
 		}
 		if(isEmpty(salesCd)){
	 		alert("복사 할 [Sales Code]가 없습니다.");
	 		return;
 		}
 		if(isEmpty(salesCd_SS)){
	 		alert("대상 [Sales Code] 를 검색 하세요.");
	 		return;
 		}
 		
 		bomCopyGridView.setData(0);
 	}
 	
 	// 등록
	function insertCopyBomMatr() {
		if(bomCopyGridView.target.list.length == 0) {
			alert("생성된 [BOM]이 없습니다. 복사될 Sales Code를 선택[생성] 후 [등록]하세요.");
			return;
		}
		
		if (inputValidation($('.popup_area [required]'))) {					// 필수 필드의 유효성 검사
			var formData = makeFormData();
		
 			filePostAjax("/user/sm/sm01/insertCopyBom", formData,
					function(data) {
						alert(data.resultMessage);							// 결과 메시지를 alert으로 출력
						if (data.resultCode == 200) {						// 요청이 성공(200)한 경우, gridView.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
							gridView.setData(0);							// 결과갑시 200인 경우 리드 뷰를 업데이트
							modalStack.close();								// 모달을 닫음
						}
					});
		}
	}

 	//----------------------------------------------//
	function makeFormData() {
		// 금액 콤마 제거
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});
		// 폼데이터 생성
		var formData = new FormData($("#pop05Form")[0]);
		
		let bom_dataList = JSON.parse(JSON.stringify(bomCopyGridView.target.list));
		let bom_data = getFilterData(bom_dataList, "B");
		let bomArr = getTreeBomData(bom_data);
		//console.log("====bomArr",bomArr);
		formData.append("bomArr", JSON.stringify(bomArr));
		
		let matr_dataList = JSON.parse(JSON.stringify(bomCopyGridView.target.list));
		let matr_data = getFilterData(matr_dataList, "M");
		let matrArr = getTreeMatrData(matr_data);
		//console.log("====matrArr",matrArr);
		formData.append("matrArr", JSON.stringify(matrArr));
		//세부 아이템 자료 끝
		return formData;
	}

	this.getFilterData = function(obj, sel_bmGubun) {
		const resultData = obj.filter(function(element){
			return sel_bmGubun == element.bmGubun;
		});
		return resultData;
	}
	//그리드가 트리일경우 사용
	function getTreeBomData(bom_list) {
		var resultBomArr = [];
		var bom_index = 0;
		$.each(bom_list, function (idx, elem) {
			if(isEmpty(elem.dtaChk)){
				elem.dtaChk = "";
			}
			var bomData = {};
			bomData.dtaChk = elem.dtaChk;
			bomData.lvl = elem.lvl;
			bomData.fileTrgtKey = elem.fileTrgtKey;
			bomData.coCd = elem.coCd;
			bomData.salesCd = elem.salesCd;
			bomData.partNo = elem.partNo;
			bomData.unitNo = elem.unitNo;
			bomData.revNo = elem.revNo;
			bomData.dsgnNo = elem.dsgnNo;
			bomData.lastDsgnNo = elem.lastDsgnNo;
			bomData.dsgnNm = elem.dsgnNm;
			bomData.dsgnBomQty = elem.dsgnBomQty;
			bomData.upperCd = elem.upperCd;
			bomData.lowerCd = elem.lowerCd;
			bomData.before_lowerCd = elem.lowerCd;
			bomData.bom_index = bom_index++;
			
			resultBomArr.push(bomData);
		});
		
		return resultBomArr;
	}
 	
	function getTreeMatrData(matr_list) {
		var resultArr = [];
		var matr_index = 0;
		$.each(matr_list, function (idx, elem) {
			if(isEmpty(elem.dtaChk)){
				elem.dtaChk = "";
			}
			var data = {};
			data.dtaChk = elem.dtaChk;
			data.coCd = elem.coCd;
			data.salesCd = elem.salesCd;
			data.upperCd = elem.upperCd;
			data.lowerCd = elem.lowerCd;
			data.matr_index = matr_index++;
			
			data.matrSeq			= elem.matrSeq		;
			data.ordrgDiv10			= elem.ordrgDiv10	;
			data.ordrgDiv20			= elem.ordrgDiv20	;
			data.nextPrcsnNm		= elem.nextPrcsnNm	;
			data.dlvplcNm			= elem.dlvplcNm		;
			data.bomQty				= elem.bomQty		;
			data.posQty				= elem.posQty		;
			data.matrCd				= elem.matrCd		;
			data.matrNm				= elem.matrNm		;
			data.goodsDiv			= elem.goodsDiv		;
			data.matrClntDiv		= elem.matrClntDiv	;
			data.matrDiv			= elem.matrDiv		;
			data.matrGrp			= elem.matrGrp		;
			data.matrMat			= elem.matrMat		;
			data.matrSize			= elem.matrSize		;
			data.matrSpec			= elem.matrSpec		;
			data.matrMakrNm			= elem.matrMakrNm	;
			data.matrMno			= elem.matrMno		;
			data.matrWt				= elem.matrWt		;
			data.matrUnit			= elem.matrUnit		;
			data.originNm			= elem.originNm		;
			data.matrDrwNo			= elem.matrDrwNo	;
			data.matrTestDiv		= elem.matrTestDiv	;
			data.dlvrRqmDay			= elem.dlvrRqmDay	;
			data.matrPurcDiv		= elem.matrPurcDiv	;
			data.minOrdrgQty		= elem.minOrdrgQty	;
			data.matrSaftQty		= elem.matrSaftQty	;
			data.matrStockCd		= elem.matrStockCd	;
			data.dsgn2DMd			= elem.dsgn2DMd		;
			data.avrg2DMd			= elem.avrg2DMd		;
			data.dsgn3DMd			= elem.dsgn3DMd		;
			data.avrg3DMd			= elem.avrg3DMd		;
			data.prdctnRqmMd		= elem.prdctnRqmMd	;
			data.prdctnAvrgMd		= elem.prdctnAvrgMd	;
			data.useYn				= elem.useYn		;
			data.matrPartNo			= elem.matrPartNo	;
			data.pchsClntCd1		= elem.pchsClntCd1	;
			data.pchsClntPct1		= elem.pchsClntPct1	;
			data.pchsClntCd2		= elem.pchsClntCd2	;
			data.pchsClntPct2		= elem.pchsClntPct2	;
			data.pchsClntCd3		= elem.pchsClntCd3	;
			data.pchsClntPct3		= elem.pchsClntPct3	;
			data.matrUpr			= elem.matrUpr		;
			data.matrAvrgUpr		= elem.matrAvrgUpr	;
			data.matrRmk			= elem.matrRmk		;
			data.matrLastTrstDt		= elem.matrLastTrstDt;
			data.matrAtntCd			= elem.matrAtntCd	;
		
			resultArr.push(data);
		});
		
		return resultArr;
	}

	//등록되지 않은 SalesCd 를 검색한다.
	function bomSalesCdSearch() {
	    var paramObj = {
	       "coCd" : $('#coCd_SS').val(),
	       "salesCd": $('#salesCd_SS').val()
	    };
	    openSecondModal("/static/html/cmn/modal/bomSalesCdSearch.html", 1000, 430, "SALES CODE 검색", paramObj, function (grid){
	    	//debugger;
	        var row = grid.target.getList("selected")[0];
	        
	        //console.log("rowData==>",row);
	        $('#salesCd_SS').val(row.salesCd);
	        $('#clntNm_SS').val(row.clntNm);
	        $('#clntPjt_SS').val(row.clntPjt);
	        $('#prdtNm_SS').val(row.prdtNm);
	        $('#itemDivNm_SS').val(row.itemDivNm);
	        $('#eqpNm_SS').val(row.eqpNm);
	        
	        bomCopyGridView.setData(0);
	    });
	}

	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();		
	}
	
 	this.setSaveReplace = function(obj, _coCd, before_salesCd, _salesCd) {
 		$.each($.extend({}, obj), function (idx, elem) {
			elem.coCd = _coCd;
			elem.salesCd = elem.salesCd.replace(before_salesCd,_salesCd);
			elem.upperCd = elem.upperCd.replace(before_salesCd,_salesCd);
			elem.lowerCd = elem.lowerCd.replace(before_salesCd,_salesCd);
			elem.upperCode = elem.upperCode.replace(before_salesCd,_salesCd);
			elem.lowerCode = elem.lowerCode.replace(before_salesCd,_salesCd);
			elem.dsgnNo = elem.lowerCd;
			elem.dtaChk = "I";
		});
 	}

</script>