<style>
* input[comma] {
  text-align: right;
 }
</style>
<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">구매BOM 도번추가</h4>
    </div>
  <div class="form-group popup_table">
   <form id="popForm" onSubmit="return false;">
		<input type="hidden" id="userId"     	name="userId">
		<input type="hidden" id="pgmId"     	name="pgmId"	value="SM0101M01">      
      <table>

        <colgroup>
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="20%">
          <col width="11%">
          <col width="5%">
        </colgroup>

        <tr>
			<th class="hit">Sales Code</th>
			<td>
				<input type="text" id="salesCd_SSS" name="salesCd_SSS" class="form-control" required="required" msg="Sales Code" readonly="readonly">
			</td>
			<th class="hit">상위도번</th>
			<td>
				<input type="text" id="upperCd_SSS" name="upperCd_SSS" class="form-control" required="required" msg="Sales Code" readonly="readonly">
			</td>
			<th class="hit">적용레벨</th>
			<td>
				<input type="text" id="lvl_SSS" name="lvl_SSS" class="form-control" required="required" msg="Sales Code" readonly="readonly">
			</td>
        </tr>
      </table>
    </form>

	<!-- 콘텐츠 -->
	  <div class="contents" style="margin-top: 10px;">
	      <!-- 리스트 -->
	      <div class="ax5_grid" style="width: 100%">
	        <ul class="ul_list" style="width: 100%">
	            <li style="width: 100%;">
	                <div class="table_list_tit" style="width: 100%;">
	                	<h5 style="color: #444;font-size: 16px;float:left; margin-left: 8px; margin-top: 8px; margin-bottom: 8px;">하위 도번</h5>
		                <div class="add_btn pdl10" style="margin-right:8px; margin-top: 8px;">
		                    <a onclick="addRowLevel()" style="" authchk>+</a>
		                    <a onclick="delRowLevel()" style="" authchk>-</a>
		                </div>
	                </div>
	                <div>
	                	<div data-ax5grid="pop-bom-grid" data-ax5grid-config="{}" style="height:160px; width: 100%" ></div>
	                </div>
	            </li>
	        </ul>	
	    </div>
	  </div>
	</div>


	<!-- 공통 파일 영역
	<div id="fileList_area"></div>
     -->
    <br>
	<div class="col-xs-2" style="height: 70px;">
	</div>
</div>
    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtnLevel" authChk>적용</button>
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>

<script type="text/javascript">

var send_bomArr = [];

const popBomGridView = {
		initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
		    	 showRowSelector: true,
		    	 multipleSelect: false,
		    	 sortable: false,
		         target: $('[data-ax5grid="pop-bom-grid"]'),
		         header: {
		        		 align: "center",
		        		 selector: false
		         },
		         body: {
		        	 	 //mergeCells : ["lvl", "salesCd","partNo", "unitNo", "revNo","dsgnNo","upperCd","lowerCd"],
			        	 onClick: function () {
			        	 },
						 onDBLClick: function () {
						 },
			             onDataChanged: function () {
			             }
	             },
		        columns : [
		        	{key: "dtaChk",label: " ", width: 30, 	styleClass: "grid-font-blue-bold"},
		        	{key: "coCd", label: "CO", width: 50,hidden:true},
		        	{key: "salesCd", label: "Sales Code", width: 120,hidden:true},
		        	{key: "lvl", label: "LVL", width: 50},
		        	{key: "partNo" , label: "PART"	, width: 80,align: "left",hidden:true},
		        	{key: "unitNo" , label: "UNIT"	, width: 80,align: "left",hidden:true},
		        	{key: "revNo"  , label: "REV" 	, width: 80,align: "left",hidden:true},
		        	{key: "lastDsgnNo"  , label: "도번", width: 90,align: "left", 
		        		editor:{type:  "text",
		        			disabled: function () {
		        				if(this.item.lvl >= 1){
			        		        return false;
		        				} else {
		        					return true;
		        				}
		        		    },
		        		    attributes: {
		        		        'maxlength': 5, 'data-maxlength': 5
		        		    }
    					}
                    },
					{key: "dsgnNm" , label: "명칭" 	,width: 160,align: "left", 
		        		editor:{type:  "text",
		        		    attributes: { 'maxlength': 30 }
    					}
                    },
					{key: "bomQty" , label: "수량" 	,width: 80,align: "right", 
		        		editor:{type:  "number",
	        		    	attributes: { 'maxlength': 5 }
						}
                	},
		        	{key: "dsgnNo" , label: "적용도번" ,width: 200,align: "left",hidden:false},
					{key: "upperCd", label: "upperCd" ,width: 160,align: "left",hidden:false},
					{key: "lowerCd", label: "lowerCd" ,width: 180,align: "left",hidden:false},
			     ]
		    });
			return this;
		},


        setData: function(_pageNo){
			var targetObj = this.target;
			var list = send_bomArr;
			targetObj.setData({
				list : list,
			    page : {
			    		totalElements : list.length
			    	   } 
			});

			/*
        	var formData = new FormData();
        	var salesCd = $('#salesCd').val();
        	var formData = {
				"salesCd" : salesCd
			}
			postAjax("/user/sm/sm01/selectBomDetailList", formData, null, function(data){
			var list = data.resultList;
			targetObj.setData({
				list : list,
			    page : {
			    		totalElements : list.length,
			    	} 
				});
			
            });
        	*/
     	} //setData
     }



 	$(document).ready(function() {
		$("#salesCd_SSS").val(modalStack.last().paramObj.salesCd);
		$("#upperCd_SSS").val(modalStack.last().paramObj.upperCd);
		$("#lvl_SSS").val(modalStack.last().paramObj.lvl);
		
		authChk();// 권한체크

		/**
		 * grid 초기화
		*/
		var sendData = modalStack.last().paramObj.sendData;
		send_bomArr = JSON.parse(sendData);
		console.log("send_bomArr>>>",send_bomArr);
		popBomGridView.initView().setData(0);
		
		$('#actionBtnLevel').on("click", function() {
			insertBomLevel();
		});
		
 	});
 	
	function insertBomLevel() {
		var bomList = popBomGridView.target.getList();
		modalStack.last().callback(bomList);
		modalStack.close();
	}

	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();		
	}
	
</script>