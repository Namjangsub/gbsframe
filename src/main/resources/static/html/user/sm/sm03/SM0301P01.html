<style>
* input[comma] {
  text-align: right;
 }
/* 인풋 테이블 2분할 */
.table_input.type08 tr td:nth-of-type(1) {
    width: 39%;
}

.table_input.type08 tr td:nth-of-type(2) {
    width: 59%;
}
.title_m_td {text-align:left; height:25px; background:#fff; font-weight:bold; color:blue; padding:5px;
}

/* 크기 조절되지 않아 임시로 */
.date_input .input_calendar2 {
    background-color: #fff;
    width: calc(100%) !important;
}

.input_calendar2 {
    background-color: #fff;
    width: 100% !important;
    background: url("../../../../img/svg/calendar-alt-regular.svg") no-repeat 95% 50%;
    background-size: 13px 13px;
    cursor: pointer
}

* input[comma] {
  text-align: right;
 }
</style>

<div class="popup_area of_a" style="width: 100%; height: 100%;">
    <div class="tit_contents">
      <h4 class="tit">입고 등록</h4>
    </div>

  <form id="popForm" onSubmit="return false;">
    <div class="form-group popup_table">
		<input type="hidden" id="userId"     	name="userId">
		<input type="hidden" id="pgmId"     	name="pgmId" value="SM0201M01">
		<input type="hidden" id="fileTrgtKey"	name="fileTrgtKey" value="">		<!-- file target key -->
	
      <table>

        <colgroup>
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
          <col width="11%">
          <col width="14%">
        </colgroup>
        <tr>
        	<td colspan="8" class="title_m_td">발주 검색</td>
        </tr>
        <tr>
			<th class="hit">회사</th>
			<td>
			  <select id="coCd" name="coCd" data-kind="CO" data-search="coCd" required="required" msg="회사">
			  </select>
			</td>
			<th class="hit">Sales Code</th>
			<td>
				<div class="search_form">
				    <input type="text" id="salesCd" name="salesCd" data-search="salesCd" required="required" msg="Sales Code">
				   	<a onclick="wbsSalesCodeSearchP();" id="salesCdAnchor"><i class="i_search_w"></i></a>
			    </div>
			</td>
			<th>고객사</th>
			<td>
				<input type="hidden" id="ordrsClntCd" name="ordrsClntCd" data-search="ordrsClntCd">
				<input type="text" id="ordrsClntNm" name="ordrsClntNm" data-search="ordrsClntNm" readonly="readonly"> 
			</td>
			<th>고객사PJT</th>
			<td>
				<input type="text" id="clntPjt" name="clntPjt" data-search="clntPjt" msg="고객사PJT" readonly="readonly">  
			</td>			
        </tr>
        
        <tr>
			<th>제품구분</th>
			<td>
				<input type="hidden" id="prdtCd" name="prdtCd" data-search="prdtCd" msg="제품구분">
				<input type="text" id="prdtNm" name="prdtNm" data-search="prdtNm" msg="제품구분" readonly="readonly">				 
			</td>
			<th>아이템구분</th>
			<td>
				<input type="text" id="itemDivNm" name="itemDivNm" data-search="itemDivNm" msg="아이템구분" readonly="readonly">	
			</td>
			<th>설비명</th>
			<td colspan="0">
				<input type="text" id="eqpNm" name="eqpNm" data-search="eqpNm" msg="설비명" readonly="readonly">
			</td>
			<th>요인별요청번호</th>
			<td>
				<input type="text" id="reqNo" name="reqNo" data-search="reqNo" msg="요인별요청번호">
			</td>			
        </tr>        
      </table>
    </form>
    
    
    <div class="" style="margin-top:10px; height: 10px;">
		<div class="contents no_bg">
			<ul class="btn_ul">
				<li class="btn_r">
					 <a onclick="initSearch();"><button class="bg_gray">초기화</button></a>
					 <a id="orderSearchBtn"><button class="bg_gray">검 색</button></a>
	            </li>
            </ul>
        </div>    
	</div>

	<div class="" style="height: 10px;">
	</div>	    
        	

<!-- 하단 디테일그리드 -->
		<!-- 콘텐츠 -->
	  <div class="contents2" style="margin-bottom: 50px;">
	      <!-- 리스트 -->
	      <div class="ax5_grid" style="width: 100%">
	        <ul class="ul_list" style="height:250px; width: 100%">
	            <li style="width: 100%;">
	                <div class="table_list_tit" style="width: 100%;">
	                	<h5 class="tit" style="float:left; margin-left: 8px; margin-top: 8px; margin-bottom: 8px;">발주 리스트</h5>
		                <div class="add_btn pdl10" style="margin-right:8px; margin-top: 8px;">
		                    <!--  <a onclick="addRowBom()" style="" authchk>+</a> -->
		                    <a id="deleteDetailButton" style="" authchk>-</a>
		                </div>
	                </div>
	                <div>
	                	<div data-ax5grid="order-grid-modal" data-ax5grid-config="{}" style="height:250px; width: 100%" ></div>
	                </div>
	            </li>
	        </ul>	
	    </div>
	  </div>
	</div>
<!-- 하단 디테일그리드 end -->

	<!-- 공통 파일 영역 -->
	<div id="fileList_area"></div>

    <!-- 하단 버튼 -->
	<div class ="popup_bottom_btn">
		<button type="button" id="actionBtn" authChk>등록</button>
		<button type="button" class="close_btn"
			onclick="modalStack.close();">닫기</button>
	</div>

<script type="text/javascript">
  
//전역초기화  
var actionType = null;
var paramPrjctSeq = null;
var firstGrid = null;
var secondGrid = null;
var userId = null;
var userNm = null;
var fileTrgtKeyU = null;

var gridViewPop = {
    	initView: function(){
			this.target = new ax5.ui.grid();
			this.target.setConfig({
				showLineNumber: true,	
				showRowSelector: false,
				multipleSelect: false,
				sortable: false,
				target: $('[data-ax5grid="order-grid-modal"]'),
				header: {
	              align: "center",
	              selector: false
	            },
	            body: {
	            	mergeCells : ["coNm", "salesCd", "partNo", "unitNo", "revNo","dsgnNo"],
					onClick: function() {
					    this.self.select(this.dindex);
					    var row = this.dindex;
                        var paramObj = {"row" : row};
                        //체크박스일 경우 실행 - 등록모드만
                        if( this.column.key == "userChk" && actionType == "C" ) {
                        	//chk, 수량, 기입고수량, row번호 
                            $.setOrdrgQty(gridViewPop, this.item.userChk , this.item.bomQty, this.item.preBomQty, row);                        		
                        }
					},
					//그리드값 변경시 실행
		            onDataChanged: function () {
					    var row = this.dindex;
					    var col = this.colIndex;
					    var ordrgPrc = 0;
					    //체크박스 변경 제외
					    if( this.key != "userChk" ) {

	            			var ordrgPrc = (this.item.ordrgPrc=="" || typeof(this.item.ordrgPrc)=="undefined")? 0 : this.item.ordrgPrc;
			            	// 입고단가, 입고수량  변경시
			            	if ( this.key == "ordrgPrc" || this.key == "ordrgQty" ) {   			            		
			            		if( this.item.ordrgQty != "" && this.item.ordrgQty > 0  ) {
			            			var ordrgAmt = parseInt( deleteCommaStr(this.item.ordrgQty) * deleteCommaStr(ordrgPrc) );
			            			gridViewPop.target.setValue(row, "ordrgAmt", ordrgAmt);		            			
			            		} else {
								    gridViewPop.target.setValue(row, "ordrgAmt", "");		            			
			            		}
			            	}           	
							//입고수량 OVER CHK
			            	if ( this.key == "ordrgQty") {			            		
			            		if( this.item.ordrgQty != "" && this.item.ordrgQty > 0  ) {			            			
				            		var calcuOrdrgQty = parseInt( deleteCommaStr(this.item.bomQty) - deleteCommaStr(this.item.preBomQty) );
			            			if( this.item.ordrgQty == 0 ) {
									    alert("입고수량은 0 보다 커야 합니다.");
									    gridViewPop.target.setValue(row, "ordrgQty", "");	
									    return;			        
			            			} else if( calcuOrdrgQty == 0 ) {
									    alert("입고 가능 수량이 0입니다.");
									    gridViewPop.target.setValue(row, "ordrgQty", "");	
									    return;		 			            				
			            			} else if( calcuOrdrgQty < this.item.ordrgQty   ) {
				            			//등록일때만 값 초기화
				            			if( actionType == "C" ) gridViewPop.target.setValue(row, "ordrgQty", "");            			
									    alert("입고수량은 "+ calcuOrdrgQty+" (와)과 같거나 작아야 합니다");
									    return;
				            		}
			            		}
			            	}	
					    }
		            	
		            	 
		            },					
					onDBLClick: function() {

					},
			   },
			   /*
				footSum: [
  			    	[	
  	                 ]
  			    ],
  			    */
				page: {
					navigationItemCount: 9,
					height: 30,
					display: true,
					firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
					prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
					nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
					lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
					onChange: function () {
						gridViewPop.setData(this.page.selectPage); 
					}
       			},  			    
				columns: [
					{key: "rn",   				   label: "No.",          align: "center",   width: 60},
		            {key: "coCd",      				label: "회사",          hidden: true},
		            {key: "ordrgNo",      			label: "발주번호",      align: "center",   width: 100},		            
		            {key: "salesCd",  				label: "Sales Code",      align: "center",   width: 110},
		            {key: "reqNo",    				label: "요청번호",      align: "center",   width: 120, hidden: true},  
		            {key: "pchsClntCd",    			label: "구매처",      align: "center",   width: 120, hidden: true},  
		            {key: "pchsClntNm",      		label: "구매처명",      align: "left",   width: 150},
		            {key: "ordrgDt",      			label: "발주일자",      align: "center",   width: 110},
		            {key: "dudtDeqDt",    			label: "납기요청일",      align: "center",   width: 100},
		            {key: "ordrgQty",      			label: "발주수량",      align: "right",   width: 100, formatter: "money"},              
		            {key: "ordrgAmt",      			label: "발주금액",      align: "right",   width: 130, formatter: "money"},              
		            {key: "ordrgDiv10",      		label: "발주구분cd",      align: "center",   width: 130, hidden: true},
		            {key: "ordrgDiv10Nm",    		label: "발주구분",      align: "center",   width: 80},
		            {key: "ordrgDiv20",      		label: "용도구분cd",      align: "center",   width: 130, hidden: true},
		            {key: "ordrgDiv20Nm",    		label: "용도구분",      align: "center",   width: 130},
		            {key: "ordrgDiv30",      		label: "특성구분cd",      align: "center",   width: 130, hidden: true},
		            {key: "ordrgDiv30Nm",    		label: "특성구분",      align: "center",   width: 130},
		            {key: "exrate",    				label: "환율",      align: "center",   width: 130, hidden: true},
	              ]
	        });
			return this;
    	},
		setData: function(_pageNo) {
			var targetObj = this.target;
        	var formData = new FormData();
        	var salesCd = $('#salesCd').val();
        	var fileTrgtKey = (fileTrgtKeyU) ? fileTrgtKeyU : 0;
        	var reqNo = $('#reqNo').val();
        	var formData = {
				"fileTrgtKey" : fileTrgtKey,
				"salesCd" : salesCd,
				"reqNo" : reqNo,
			}
        	//등록과 수정 URL 다르게
        	var url = "selectOrderList";
			postAjax("/user/sm/sm02/" + url, formData, null, function(data){
				var list = data.resultList;
				targetObj.setData({
					list : list,
				    page : {
		                   currentPage : _pageNo,
		                   pageSize : data.paginationInfo.pageSize,
		                   totalElements : data.paginationInfo.totalRecordCount,
		                   totalPages : data.paginationInfo.totalPageCount
				    	   }  
					});
            });
      	   
		} 
	}

// 권한체크    
authChk();		
	
//구매 BOM
gridViewPop.initView();	 	

//등록/수정 버튼
actionType = modalStack.last().paramObj.actionType;
if (actionType == "C") {
	$("#actionBtn").text("등록");
	$('#actionBtn').on("click", function() {
		insertOrder();
	});

} else if (actionType == "U") {
	$('.tit_contents .tit').text('입고 수정')
	
	$('#actionBtn').text("수정");
	$('#actionBtn').on("click", function() {
		updateOrder();
	});
}	

// 등록 - done
function insertOrder() {
		
	if (inputValidation($('.popup_area [required]'))) {					// 필수 필드의 유효성 검사
		var formData = makeFormData();									// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
		var makeArr = {};
        //저장용 배열 push
		makeArr = $.gridInsertArr(gridViewPop);
        if( !makeArr ) {
        	return;
        }
        
		if(makeArr.length<1) {
			alert("구매 BOM 항목은 최소 1개 이상이어야 합니다.");
			return;
		} else {
			formData.append("makeArr", JSON.stringify(makeArr));
		}          
        
		filePostAjax("/user/sm/sm02/insertOrderMaster", formData,		// 파일을 포함한 데이터를 서버로 전송하는 비동기적인 AJAX 요청을 수행		
			function(data) {
				alert(data.resultMessage);								// 결과 메시지를 alert으로 출력
				if (data.resultCode == 200) {							//  요청이 성공(200)한 경우, gridViewPop.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
					gridView.setData(0);
					modalStack.close();									// 모달을 닫음
				}
		});
	}
}

//수정 
function updateOrder() {
		
	if (inputValidation($('.popup_area [required]'))) {					// 필수 필드의 유효성 검사
		var formData = makeFormData();									// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
		var makeArr = {};
        //저장용 배열 push
		makeArr = $.gridInsertArr(gridViewPop);
        if( !makeArr ) {
        	return;
        }
		if(makeArr.length<1) {
			alert("구매 BOM 항목은 최소 1개 이상이어야 합니다.");
			return;
		} else {
	        //입고번호 set
	        formData.append("ordrgNo", $("#ordrgNo").val());			
			formData.append("makeArr", JSON.stringify(makeArr));
		}          
		filePostAjax("/user/sm/sm02/updateOrder", formData,		// 파일을 포함한 데이터를 서버로 전송하는 비동기적인 AJAX 요청을 수행		
			function(data) {
				alert(data.resultMessage);								// 결과 메시지를 alert으로 출력
				if (data.resultCode == 200) {							//  요청이 성공(200)한 경우, gridViewPop.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
					gridView.setData(0);
					modalStack.close();									// 모달을 닫음
				}
		});
	}
}

//Sales Code (수주마스터, 수주상세테이블 조인) 검색
function wbsSalesCodeSearchP() {
    var paramObj = {
       "coCd" : $('#coCd').val(),
       "salesCd": $('#salesCd').val()
    };
    openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 430, "SALES CODE 검색", paramObj, function (grid){
        var row = grid.target.getList("selected")[0];
        $('#salesCd').val(row.salesCd);;
		//고객사~설비명 등 set
		$("#ordrsClntNm").val(row.ordrsClntNm)		
		$("#clntPjt").val(row.clntPjt)
		$("#ordrsClntNm").val(row.ordrsClntNm)
		$("#prdtNm").val(row.prdtCdNm);
		$("#itemDivNm").val(row.itemDivNm);		
		$("#eqpNm").val(row.eqpNm);			
    });
}
 
//제품구분 검색 
function openPrdtSearchP(){
	var paramObj = {	
			"searchValue" : $("#prdtCdNm").val()
	}
	openSecondModal("/static/html/cmn/modal/prdtSearch.html", 800, 600, "제품 검색", paramObj, function (grid) {
		var row = grid.target.getList("selected")[0];
		$("#prdtCd").val(row.prdtCd);
		$("#prdtCdNm").val(row.prdtNm);
	});
}	


// 거래처 검색
function openClntSearchP(openType) {
	var searchValueM = null;
	// P:고객사, S:구매처
	if(openType == "P") {
		searchValueM = $("#clntNm").val();
	} else if(openType == "S") {
		searchValueM = $("#pchsClntNm").val();
	}	
	var paramObj = {
			"searchValue" :  searchValueM
			, "clntDivCd" : "CLNTDIV12"		/*거래처 검색 기본값 고객사로 세팅 */
			, "pchsClntCd" : "CLNTDIV12"		/*구매처 팝업일 경우 구분자 고객사 제외하고 세팅 */				
	}		
	if(openType == "S") {
		paramObj.clntDivCd = null;
	}
	//입고관리에서 호출 플래그 추가
	paramObj.orderFlag = "Y";		
	openSecondModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색", paramObj, function (grid) {
		var row = grid.target.getList("selected")[0];
		//고객사 콤보 세팅
		if(openType == "P"){
			$('#clntCd').val(row.clntCd);
			$('#clntNm').val(row.clntNm);
		//구매처 콤보세팅
		} else if(openType == "S"){
			$('#pchsClntCd').val(row.clntCd);
			$('#pchsClntNm').val(row.clntNm);
		}
	});
} 

function makeFormData() {
	// 금액 콤마 제거
	$.each($('.popup_area input[comma]'), function(idx, elem) {
		deleteComma(elem);
	});
	// 날짜 하이픈 제거
	$.each($('.popup_area input[date]'), function(idx, elem) {
		deleteHyphen(elem);
	});
	// 폼데이터 생성
	var formData = new FormData($("#popForm")[0]);
	// 기본값 set
	formData.append("userId", jwt.userId);
	
	//---------------------------------------------------------------  
	//-------itemarr  --첨부화일 처리를 위한 부분 시작
	//---------------------------------------------------------------  

	formData.append("comonCd", treeModule.getFileNodeId());
	var fileUploadArr = [];
	var tempArr = [];
	
	tempArr = treeModule.getFileArr();
	$.each(tempArr, function(idx, obj) {
		if (obj.fileKey == 0) {
            formData.append("files", obj.file);
            obj.file = '';
            fileUploadArr.push(obj);
		}
	});

	formData.append("uploadFileArr", JSON.stringify(fileUploadArr));
	formData.append("deleteFileArr", JSON.stringify(treeModule.getDeleteFileArr()));
	//---------------------------------------------------------------  
	//--첨부화일 처리를 위한 부분 끝
	//--------------------------------------------------------------- 
	
	return formData;	
}


var param_fileTrgtKey = modalStack.last().paramObj.fileTrgtKey;
//---------------------------------------------------------------  
//첨부 화일 처리 시작 
//---------------------------------------------------------------  
fileParam = {
		fileTrgtTyp	: $("#pgmId").val(),
		fileTrgtKey : param_fileTrgtKey
}
		treeModule.initAll('deptTreeOrdars', 'file-grid', 'FILETREE', fileParam);
//---------------------------------------------------------------  
//첨부 화일 처리 끝
//---------------------------------------------------------------



$(document).ready(function() {

	$.initViewPop = function() {
		//combo set
		setCommonSelect($(".popup_area select[data-kind]"));
		userId = modalStack.last().paramObj.userId;
		fileTrgtKeyU = modalStack.last().paramObj.fileTrgtKey;
		//modal 넘어온값만큼 만큼 루프 
		$.each(modalStack.last().paramObj, function (key, val) {		
			if( $("#popForm").find("#"+key).length > 0 ) {
				$("#popForm").find("#"+key).val(val);
			}
		});
		$("#popForm #userId").val(userId);	
		//작성자 readonly 등 set
		$("#salesCd").attr("readonly", true);
		
		//formatter
		$('[data-ax5formatter]').ax5formatter();
		let today = moment(new Date());
		let yesterday = moment(new Date()).add(-1, 'days');	

		//등록일때만 set
		if(actionType == "C") {
			// 입고일자
			$('#ordrgDt').datepicker({
					format : "yyyy-mm-dd",
					language : "ko",
					autoclose : true
				})
			.datepicker("setDate", today.toDate());
					
			// 납기요청일자
			$('#dudtDeqDt').datepicker({
					format : "yyyy-mm-dd",
					language : "ko",
					autoclose : true
				})
			.datepicker("setDate", yesterday.toDate())			
		} else if(actionType == "U") {
			//그리드 load
			gridViewPop.initView().setData(0);
			
			//chkbox 삭제 - 합계 틀어짐
			//gridViewPop.target.removeColumn(18);	
			//sale code readonly
			$("#salesCd").attr("readonly", true);
			//wbsSalesCodeSearchP();
			$("#salesCdAnchor").removeAttr("onclick");
		}		
	}

	$.initViewPop();
	
	//발주검색 
	$("#orderSearchBtn").click(function() {
		if( $('#salesCd').val() == "" ) {
			alert("Sales Code 를 검색하여 주십시오.");
			$('#salesCd').focus();
			return;
		} else {
			gridViewPop.initView().setData(0);			
		}
	});
	
	
	//sale Code keyup 이벤트
	$("#salesCd").on("keyup", function () {
		if(event.keyCode == 8) {
			$("#salesCd").val('');
		} else if(event.keyCode == 13) { 
			gridViewPop.setData(0); 
		}		
	});	
	
	//등록시 그리드값 배열 저장
	$.gridInsertArr = function(gridObj, mode) {
		var gridList = gridObj.target.getList();
		var gridColumns = gridObj.target.columns;
		var detailArr = [];    	
		var msgArr = [];    	
		var errCnt = 0;
		if( gridList.length > 0 ) {
        	var msgArr = [];			
	        $.each(gridList, function (idx, elem) {
	            var detailObj = {};	     	        	
	        	//컬럼수 루프 
	        	for(var i=0; i<gridColumns.length; i++) {
					var key = gridColumns[i].key;
					var val = elem[key];
					if( typeof(val) == "undefined") val = "";
					//console.log('key:' + key+'=-====>val:' + val);					
					//type number 시 콤마제거
					if( typeof(gridColumns[i].editor) != "undefined" && gridColumns[i].editor.type == "number" && val != "" ) {
						val = deleteCommaStr(val); 
					}	     
					
					detailObj["idx"] = i + 1;
					//입고순번 은 select key로  ORDRG_SEQ  
					detailObj[key] = val;			            			            
	        	}
	            //필수값 체크를 여기서 한다. 입고수량, 납기요청일 - 체크된 항목만	            
	            //if( actionType == "C" && detailObj['userChk'] == "Y" ) {
	            	//입고수량
		            if( detailObj['ordrgQty'] =="" || detailObj['ordrgQty'] =="0" ) {
		            	msgArr.push((idx+1)+" 행의 입고수량을 입력해 주십시오.")	;
		            }	 
		            //납기요청일
		            if(detailObj['dudtDeqDt'] == "" ) {
		            	msgArr.push((idx+1)+" 행의 납기요청일을 입력해 주십시오.")	;		            	
		            }
		            //입고단가 체크 없음??
		            if( detailObj['ordrgPrc'] =="" || detailObj['ordrgPrc'] =="0" ) {
		            	msgArr.push((idx+1)+" 행의 입고단가를 입력해 주십시오.")	;
		            }
		            //입고수량
		            if( Number(detailObj['bomQty']) < Number(detailObj['preBomQty']) + Number(detailObj['ordrgQty']) ) {
		            	var calQty = parseInt( Number(detailObj['bomQty']) - Number(detailObj['preBomQty']) );
		            	msgArr.push((idx+1)+" 행의 입고수량은 " + calQty + "보다 작거나 같아야 합니다.")	;
		            }		
		            //체크된 항목만 저장		            
		            detailArr.push(detailObj);	
	            //} else if( actionType == "U" ) {
		            //detailArr.push(detailObj);	            	
	            //}
	            		
	        });			
	        //error alert 후 종료
	        if( msgArr.length > 0 ) {
	        	alert(msgArr.join("\r\n"));
	        	return false;
	        }
		}
		return detailArr;
	}
	
	// bom 그리드 삭제
	$("#deleteDetailButton").on("click", function () {
 		var selRow = parseInt(gridViewPop.target.selectedDataIndexs);
 		if( isNaN(selRow) ) {
 			alert("선택된 행이 없습니다.");
 			return;
 		} else {
 			
 			var actFlag = gridViewPop.target.getList()[selRow].actFlag;	
 	    	//등록상태
 			if( actionType == "C" ) {		
				//신규 추가한 행일 경우만 삭제 				
 				if( selRow > -1 && actFlag == "I") {
 					gridViewPop.target.removeRow(selRow);
 					$.gridNoSet(gridViewPop);					 				
 				}
			//수정시 FLAG D 처리
 			} else if(actionType == "U") { 				
 				if( selRow > -1 ) {
 					//기존값이면 D 처리 아니면 row 삭제
 					var coCd = gridViewPop.target.getList()[selRow].coCd;
 					var ordrgNo = gridViewPop.target.getList()[selRow].ordrgNo;
 					var ordrgSeq = gridViewPop.target.getList()[selRow].ordrgSeq;
 					var paramObj = {
 							"coCd" : coCd
 							, "ordrgNo" : ordrgNo
 							, "ordrgSeq" : ordrgSeq
 						} 					

					if( confirm("선택행을 삭제하시겠습니까?\n\n그리드에 변경중인 내용이 초기화 됩니다.")) {
						deleteAjax("/user/sm/sm02/deleteOrderDetail", paramObj, null, function(data) {
							if (data.resultCode == 200) {
								alert(data.resultMessage);
								
								//modalStack.close();
								//inserOrderModal('U');
								gridViewPop.setData(0);
								$.initViewPop();
							}
						});
 	 					//gridViewPop.target.removeRow(selRow); 						
 					}				 							 				
 				} 				
 			} 			
 		}		
	});
	
	//bom 입고수량 set
	$.setOrdrgQty = function(gridObj, chkVal, bomQty, preBomQty, row ) {
		//수량 - 기입고수량 = 입고수량 //수량 - 기입고수량 = 입고수량 
		var gridList = gridObj.target.getList();
		var gridColumns = gridObj.target.columns;	
		
			var bomQty = parseInt(bomQty);
			var preBomQty = parseInt(preBomQty);
			var ordrgQty = parseInt(bomQty - preBomQty);			
		    //입고금액 없을경우 0 셋
		    if( gridList[row].ordrgPrc == "" || typeof(gridList[row].ordrgPrc) == "undefined" ) {
		    	gridObj.target.setValue(row, "ordrgPrc", 0);  
		    }			
        	//수량
        	if(chkVal == "Y") {
        		if( ordrgQty > 0 ) {
        			gridObj.target.setValue(row, "ordrgQty", ordrgQty);  
        		} else if( isNaN(ordrgQty) || ordrgQty == 0 ) {
        			gridObj.target.setValue(row, "ordrgQty", 0);        			
        		}
        	} else if(chkVal == "N") {
    			gridObj.target.setValue(row, "ordrgQty", "");
    			gridObj.target.setValue(row, "ordrgPrc", "");     
    			gridObj.target.setValue(row, "ordrgAmt", "");     
        	}
        	console.log('---chkVal:' + chkVal+'=======>bomQty:' + bomQty + "====>preBomQty:" + preBomQty+'===ordrgQty:' + ordrgQty);
	}
	
});
</script>