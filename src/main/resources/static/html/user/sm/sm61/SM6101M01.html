<!DOCTYPE html>
<html lang="ko">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
	<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
	<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-multiselect.css">
	<link rel="stylesheet" href="/static/fontawesome/css/all.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5grid.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5mask.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5modal.css">
	<link rel="stylesheet" href="/static/css/ax5/ax5toast.css">
	<link rel="stylesheet" href="/static/css/jstree/style.min.css">
	<link rel="stylesheet" href="/static/css/gnb.css">
	<link rel="stylesheet" href="/static/css/main.css">
	<link rel="stylesheet" href="/static/css/sub.css">
	<link rel="stylesheet" href="/static/css/common.css">
	
          
	<script src="/static/js/jquery-latest.min.js"></script>
	<script src="/static/js/jquery.serializeObject.js"></script>
	<script src="/static/bootstrap/js/bootstrap.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap-multiselect.min.js"></script>
	<script src="/static/js/moment/moment-with-locales.js"></script>
	<script src="/static/js/ax5/ax5core.min.js"></script>
	<script src="/static/js/ax5/ax5grid.min.js"></script>
	<script src="/static/js/ax5/ax5mask.min.js"></script>
	<script src="/static/js/ax5/ax5modal.min.js"></script>
	<script src="/static/js/ax5/ax5toast.min.js"></script>
	<script src="/static/js/ax5/ax5formatter.min.js"></script>
	<script src="/static/js/jstree/jstree.min.js"></script>
	<script src="/static/js/global.js"></script>
	<script src="/static/js/fileTree.js"></script>
	<script src="/static/js/jquery.blockUI.js"></script>
	<!-- 도움말 팝업 -->
    <script src="/static/js/manualPopup.js"></script>
</head>

<body>
  <div id="head_area"></div>
  <div id="top_area"></div>
  <div id="main_area">
  
		<!-- 페이지 상단 -->
		<div class="contents no_bg">
			<ul class="btn_ul">
				<li class="btn_r">
					<a onclick="manualPopup();"> <button type="button" class="bg_gray" onclick="manualPopup();">도움말</button></a>
					<a onclick="initSearch();"><button class="bg_gray">초기화</button></a>
					<a onclick="clntPurchaseGridView.setData(0);"><button class="bg_gray">검 색</button></a>			 
	            </li>
            </ul>
        </div>
    
		<!-- 검색 콘텐츠 -->
		<div class="contents search">
			<div class="">
				<!-- 테이블 인풋 5분할 -->
				<table class="table_input type05">

					<tr>
<!-- 						<th class= "hit">회사</th> -->
<!-- 						<td> -->
<!-- 							<select id="coCd" name="coCd" data-kind="CO" data-search="coCd" required="required" msg="회사"> -->
<!-- 							</select> -->
<!-- 						</td> -->

						<th>담당자</th>
						<td>
							<div class="" >
								<select id="multiple-checkboxes-mngId" multiple="multiple">
								</select>
							</div>
						</td>
						<th>거래처구분</th>
						<td>
							<select id="clntDivCd" name="clntDivCd" data-kind="CLNTDIV" data-search="clntDivCd" msg="거래처구분">
								<option value="">전체</option>
							</select>
						</td>
						<th>구매처</th>
						<td>
								<input type="hidden" id="pchsClntCd_S" name="pchsClntCd_S"  data-search="pchsClntCd">
								<div class="search_form">
									<input type="text" id="pchsClntNm_S" name="pchsClntNm_S"  data-search="pchsClntNm" onkeyup="(event.keyCode == 8 || event.keyCode == 46) ? pchsClntCd_S.value = '' : event.keyCode == 13 ? clntPurchaseGridView.setData(0) : ''">
									<a onclick="openClntSearch('S');"><i class="i_search_w"></i></a>
								</div>						
						</td>
						
						<th></th>
						<td></td>
						<th></th>
						<td></td>
					</tr>			     
	            </table>
				<!-- 검색조건 END -->	      
<form id="mainForm" onSubmit="return false;">				      
		<input type="hidden" id="userId"    name="userId">
		<input type="hidden" id="coCd"    	name="coCd">
		<input type="hidden" id="pgmId"     name="pgmId" value="SM6101M01">
</form>			        
            </div>
        </div>        

		<!-- 콘텐츠 -->
		<div class="contents no_bg">
			<!-- 콘텐츠 타이틀 -->
			<div class="contents_tit">
				<span  style="height: 30px; line-height: 30px;font-size: 15px;">공급업체 최초 평가표 현황  </span>
				<div class="add_btn_small pdl10">
<!-- 					<a onclick="inserPurchase('C');" style="height: 30px; line-height: 28px;" authchk>+</a> -->
					<a onclick="deleteVendEstimate();" style="height: 30px; line-height: 28px;" authChk>-</a>
					<a onclick="updateVendEstimate();" style="height: 30px; line-height: 28px; width: 90px;" authChk><i class="fas fa-save"></i> 평가점수저장</a> 
<!-- 					<a onclick="setReportMulti();" style="height: 30px; line-height: 28px; width: 90px;" authChk><i class="fas fa-print"></i> 평가서발행</a>  -->
					<a onclick="excelDown();" style="height: 30px; line-height: 28px; width: 90px;" authChk><i class="fas fa-file-excel"></i> 엑셀다운로드</a>
			    </div>
			</div>
		    <!-- 리스트 -->
		      <div class="ax5_grid" data-ax5grid="clntCompGrid-grid" data-ax5grid-config="{}" style="height: 740px; width: 100%" ></div>
		      <div data-ax5grid="excel-grid" data-ax5grid-config="{}" style="display: none;"></div>
		</div>
		
    </div>
                    
</body>
</html>

<script type="text/javascript">
//필드별 최대 점수 설정 (필드명: 최대 점수)
const SCORE_LIMITS = {
		suplExpScore: 20,        // 공급사업력
		similMcScore: 15,       // 유사기계제작
		suppleScore: 10,        // 안정적공급
		mainClientScore: 20,    // 주거래고객사
		qcScore: 20,       		// 품질기준
		asScore: 10,        	// A/S기준
		warrentScore: 5,        // 보증보험가입
		bonusScore: 5,        	// 가산점
};

	
var clntPurchaseGridView = {
	initView: function(){
	this.target = new ax5.ui.grid();
	this.target.setConfig({
		showRowSelector: true,
		multipleSelect: true,
		sortable: true,
		showLineNumber: true,
		lineNumberColumnWidth: 40,
		target: $('[data-ax5grid="clntCompGrid-grid"]'),
		header: {
           align: "center",
           selector: true
         },
         body: {
		    mergeCells : ["salesCd", "pchsClntNm", ],
			onClick: function () {
				this.self.clearSelect();				
			    this.self.select(this.dindex);
			},
			onDBLClick: function () {
				this.self.clearSelect();
				this.self.select(this.dindex);
				var row = this.dindex;
				//거래처조회 화면 call
				if (this.column.key == 'clntNm' || this.column.key == 'salesEmpIdNm' ) {
					var paramObj = {
									actionType: "U",
									crnTyp    : "CRNTYP01",
									clntCd    : this.item.clntCd,
									};
					openModal("/static/html/admin/bm/bm02/BM0202P01.html", 1500, 870, "", paramObj);
				}
			},
			//그리드값 변경시 실행
            onDataChanged: function () {
            	let row = this.dindex;
			    let col = this.colIndex;
			    
			 	// 평가점수 최대치 설정
			    if (Object.prototype.hasOwnProperty.call(SCORE_LIMITS, this.key)) {
			        const maxScore = SCORE_LIMITS[this.key];
			        let newValue = parseInt(this.value, 10) || 0; // 입력값을 정수로 변환, 유효하지 않으면 0

			        // 입력 유효성 검사
			        if (newValue < 0) {
			            newValue = 0;
			        } else if (newValue > maxScore) {
			            newValue = maxScore;
			        }
			        this.self.setValue(this.dindex, this.key, newValue);

			        // totalScore 계산 (SCORE_LIMITS에 정의된 모든 필드 포함)
			        let totalScore = 0;
			        for (let field in SCORE_LIMITS) {
			            totalScore += parseInt(this.item[field], 10) || 0; // 각 필드 값을 정수로 변환 후 합산
			        }
			        this.self.setValue(this.dindex, "totalScore", totalScore);
			    }
            },
	   },
        page: {
			navigationItemCount: 9,
			height: 30,
			display: false,
			firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
			prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
			nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
			lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
			onChange: function () {
				clntPurchaseGridView.setData(this.page.selectPage); 
			}
        },     
        columns: [
            {key: "coCd",      					label: "회사",          	hidden: true},
            {key: "coCdNm",      				label: "회사명",          hidden: true},
            {key: undefined, label: "공급사", columns: [         
	            {key: "clntNm",      				label: "거래처명",      	align: "left",   	width: 230}, 
	            {key: "salesEmpIdNm",      			label: "관리담당",      	align: "center",   	width: 80}, 
	        ]},
            {key: "clntDivNm",      				label: "공급사구분",      	lign: "center",   	width: 80}, 
            {key: "clntEstmtMngNm",    				label: "평가담당",      	align: "center",	width: 80, hidden: false},   
            {key: "estmtDt",    					label: "평가일자",      	align: "center",	width: 90, hidden: false},             
	        {key: undefined, label: "평가현황", columns: [
	        	{key: "suplExpScore",    			label: "공급사업력(20)",      	align: "center",	width: 100, editor: {type: "number"}, disabled: function () { if (this.item.estmYn == "Y") { return true; } }, },           
	        	{key: "similMcScore",    			label: "유사기계제작(15)",    	align: "center",	width: 110, editor: {type: "number"}, disabled: function () { if (this.item.estmYn == "Y") { return true; } }, }, 
	        	{key: "suppleScore",    			label: "안정적공급(10)",      	align: "center",	width: 100, editor: {type: "number"}, disabled: function () { if (this.item.estmYn == "Y") { return true; } }, },              
	        	{key: "mainClientScore",    		label: "주거래고객사(20)",     	align: "center",	width: 110, editor: {type: "number"}, disabled: function () { if (this.item.estmYn == "Y") { return true; } }, },              
	        	{key: "qcScore",    				label: "품질기준(20)",      	align: "center",	width: 90, editor: {type: "number"}, disabled: function () { if (this.item.estmYn == "Y") { return true; } }, },              
	        	{key: "asScore",    				label: "A/S기준(10)",      	align: "center",	width: 100, editor: {type: "number"}, disabled: function () { if (this.item.estmYn == "Y") { return true; } }, },              
	        	{key: "warrentScore",    			label: "보증보험가입(5)",     	align: "center",	width: 110, editor: {type: "number"}, disabled: function () { if (this.item.estmYn == "Y") { return true; } }, },              
	        	{key: "bonusScore",    				label: "가산점(5)",      		align: "center",	width: 80, editor: {type: "number"}, disabled: function () { if (this.item.estmYn == "Y") { return true; } }, },              
            ]},            
	        {key: "totalScore",    					label: "평가합계(105)",     	align: "center",	width: 100, hidden: false},              
            {key: "estmtRmk",    					label: "평가비고",      	align: "left",		width: "*", editor: {type: "textarea"}, disabled: function () { if (this.item.estmYn == "Y") { return true; } }, },         
//             {key: "pchsClntCd",    					label: "구매처",      	align: "center",	width: 80, hidden: false},     
        ]
	});
		return this;
	},
     setData: function(_pageNo) {
   	    	var targetObj = this.target;
			var paramObj = {};
			$.each($('#main_area [data-search]'), function(idx, elem){
				if( $(elem).attr("class") == "input_calendar" ) {
					paramObj[$(elem).data("search")] = deleteHyphenStr($(elem).val());
				} else {
					paramObj[$(elem).data("search")] = $(elem).val();	
				}
			});			
			
			paramObj["pageNo"] = _pageNo + 1;
			paramObj["userId"] = jwt.userId;
			
			//발주 담당자 multi select
			let mngIdCd = $('#multiple-checkboxes-mngId').val();
			if (!mngIdCd) { //nul이면
				paramObj["mngIdCd"] = "";
			} else {
				paramObj["mngIdCd"] = mngIdCd.join(",");
			}
			
			postAjax("/user/sm/sm61/selectVendInitEstimateList", paramObj, null, function(data){
				try {
					let list = data.result;
					//숫자필드  정수로 변경 숫자 정렬 처리
					const fieldsToCheck = [
						'suplExpScore',		'similMcScore', 	'suppleScore', 		'mainClientScore',
						'qcScore', 			'asScore', 			'warrentScore', 	'bonusScore',
						'totalScore'
					];// 숫자 필드 정수 변환
					list.forEach(item => {
					    fieldsToCheck.forEach(field => {
					        item[field] = item[field] == undefined ? '' : gPasIntChk(item[field]);
					    });
					});
					targetObj.setData({
							list : list,
							page : {
								totalElements : list.length,
							} 
					});	

					list = data.resultMngId;
					multiPrjctSelectHtml(list, $('#multiple-checkboxes-mngId')); //프로젝트 코드를 multi select 자동 생성
					$('#multiple-checkboxes-mngId').multiselect('select', mngIdCd); //이전 선택된 내용 복원하기
				} catch (error) {
					alert("오류 발생!! 전산실 연락 바랍니다", error.message);
					return null; // 오류 발생 시 null 반환
				} finally {
					// console.log("함수 실행 완료.");
				}
           });
      } 
	}


	var excelView = {
		initView: function(){
		this.target = new ax5.ui.grid();
		this.target.setConfig({
		target: $('[data-ax5grid="excel-grid"]'),
		columns: [
	            {key: "coCd",      					label: "회사",          	hidden: true},
	            {key: "coCdNm",      				label: "회사명",          hidden: true},
	            {key: undefined, label: "공급사", columns: [         
		            {key: "clntNm",      				label: "거래처명",      	align: "left",   	width: 230}, 
		            {key: "salesEmpIdNm",      			label: "관리담당",      	align: "center",   	width: 80}, 
		        ]},
	            {key: "clntEstmtMngNm",    				label: "평가담당",      	align: "center",	width: 80, hidden: false},   
	            {key: "estmtDt",    					label: "평가일자",      	align: "center",	width: 90, hidden: false},             
		        {key: undefined, label: "평가현황", columns: [
		        	{key: "suplExpScore",    			label: "공급사업력(20)",      	align: "center",	width: 100,},           
		        	{key: "similMcScore",    			label: "유사기계제작(15)",    	align: "center",	width: 110,}, 
		        	{key: "suppleScore",    			label: "안정적공급(10)",      	align: "center",	width: 100,},              
		        	{key: "mainClientScore",    		label: "주거래고객사(20)",     	align: "center",	width: 110,},              
		        	{key: "qcScore",    				label: "품질기준(20)",      	align: "center",	width: 90,},              
		        	{key: "asScore",    				label: "A/S기준(10)",      	align: "center",	width: 100,},              
		        	{key: "warrentScore",    			label: "보증보험가입(5)",     	align: "center",	width: 110,},              
		        	{key: "bonusScore",    				label: "가산점(5)",      		align: "center",	width: 80,},       
	            ]},                  
	        	{key: "totalScore",    				label: "평가합계(105)",     	align: "center",	width: 100, hidden: false},             
	            {key: "pchsClntCd",    					label: "구매처",      	align: "center",	width: 80, hidden: false},       
	            {key: "estmtRmk",    					label: "평가비고",      	align: "left",	width: 200, hidden: false},
            ]
		});
		   return this;
    }
}        
  
    
	function initSearch() {
	    // datepicker를 제외한 select, input 값 모두 초기화
	    $(".contents.search select").val("");
	    $(".contents.search input").val("");    
	    // 회사 초기화
	    $("#coCd").val(jwt.coCd);
	
	    $.dayInit();
	    
	    // 재검색
	    clntPurchaseGridView.setData(0);
	}


	$(document).ready(function() {
		//초기설정들		
		mainDefaultLoad("외주관리", "공급업체 최초평가");
		setCommonSelect($("#main_area select[data-kind]"));
		SetYm();
		
		$.dayInit = function() {
	
			// 종료일 (현재날짜의 월 말일)
			$('#ordrgDtTo_S').datepicker({
				format : "yyyy-mm-dd",
				language : "ko",
				autoclose : true
			})
			.datepicker("setDate", moment(new Date()).endOf("year").toDate())
			.on("changeDate", function(){
				if($('#ordrgDtFrom_S').val() > $('#ordrgDtTo_S').val()){
					alert("날짜를 확인해주세요");
					$('#ordrgDtTo_S').datepicker("setDate", new Date($('#ordrgDtFrom_S').val()));
				}
			});		
			
			// 시작일 (현재날짜의 월 첫일)
			$('#ordrgDtFrom_S').datepicker({
					format : "yyyy-mm-dd",
					language : "ko",
					autoclose : true
				})
			.datepicker("setDate", moment(new Date()).startOf("year").toDate())
			.on("changeDate", function(){
				if($('#ordrgDtFrom_S').val() > $('#ordrgDtTo_S').val()){
					alert("날짜를 확인해주세요");
					$('#ordrgDtTo_S').datepicker("setDate", new Date($('#ordrgDtFrom_S').val()));
				}
			});	
		}
	
		// 접속자 회사 set
		$("#coCd").val(jwt.coCd);
	    $("#userId").val(jwt.userId);
	    $.dayInit();
	    
	    clntPurchaseGridView.initView().setData(0);
		excelView.initView();

		$('#multiple-checkboxes-mngId').multiselect({includeSelectAllOption : true,});
	    // 검색조건 이벤트 bind
		$('[data-search]').on("change", function(){
			if (this.name == 'trgYear_S') {
				$('#ordrgDtFrom_S').val($("#trgYear_S").val()+'-01-01')
				$('#ordrgDtTo_S').val($("#trgYear_S").val()+'-12-31')
			}
			clntPurchaseGridView.setData(0);
		});
		
	
		$('#multiple-checkboxes-mngId').on("change", function() {clntPurchaseGridView.setData(0);});
		//권한체크
		authChk();	
			
	 });
	 //ready end
	 
	 
	 //공급업체 평가 점수 저장하기
	 function updateVendEstimate() {
	    	let selRow = clntPurchaseGridView.target.getList("modified")
			let gridData = selRow[0];     	
	 		if( typeof(selRow[0])=="undefined" ) {
// 	 			alert("변경된 자료가 없습니다.");
	 			return false;
	 		}  	
					
			if (confirm("변경 내역을 저장 하시겠습니까?")) {
				for (let i = 0; i < selRow.length; i++) {
					selRow[i].pchsQty = gPasIntChk(selRow[i].pchsQty);
					selRow[i].pchsAmt = gPasIntChk(selRow[i].pchsAmt);
					selRow[i].badnCnt = gPasIntChk(selRow[i].badnCnt);
					selRow[i].badnAmt = gPasIntChk(selRow[i].badnAmt);
					selRow[i].badnScore = gPasIntChk(selRow[i].badnScore);
					selRow[i].cntmsrScore = gPasIntChk(selRow[i].cntmsrScore);
					selRow[i].schdulScore = gPasIntChk(selRow[i].schdulScore);
					selRow[i].emgcScore = gPasIntChk(selRow[i].emgcScore);
					selRow[i].estScore = gPasIntChk(selRow[i].estScore);
					selRow[i].prcScore = gPasIntChk(selRow[i].prcScore);
					selRow[i].totalScore = gPasIntChk(selRow[i].totalScore);
					selRow[i].trgYear = $('#trgYear_S').val();
					selRow[i].userId = jwt.userId;
					selRow[i].pgmId = "SM6101M01";
				}
				
				var paramObj = {
					"userId"    : jwt.userId,
					"pgmId"     : "SM6101M01",
					"detailArr" : JSON.stringify(selRow)
				};
				postAjax("/user/sm/sm61/updateVendInitEstimate", paramObj, null, function(data) {
					if (data.resultCode == 200) {
						clntPurchaseGridView.setData(0);
					}
				});
			}		
	 }
	 
	 //공급업체 평가 점수 삭제하기
	 function deleteVendEstimate() {
	    	let selRow = clntPurchaseGridView.target.getList("selected")
			let gridData = selRow[0];     	
	 		if( typeof(selRow[0])=="undefined" ) {
// 	 			alert("선택된 자료가 없습니다.");
	 			return false;
	 		}  	
					
			if (confirm("선택 내역을 삭제 하시겠습니까?")) {
				for (let i = 0; i < selRow.length; i++) {
					selRow[i].trgYear = $('#trgYear_S').val();
				}
				
				var paramObj = {
					"userId"    : jwt.userId,
					"pgmId"     : "SM6101M01",
					"detailArr" : JSON.stringify(selRow)
				};
				putAjax("/user/sm/sm61/deleteVendInitEstimate", paramObj, null, function(data) {
					if (data.resultCode == 200) {
						clntPurchaseGridView.setData(0);
					}
				});
			}		
	 }
	 
	 
	//평가년도 설정
	function SetYm(){
		var now = new Date();
		var nyear = now.getFullYear();
		
		for(var sy = 2023; sy <= nyear; sy++){
			$("#trgYear_S").append("<option value='" + sy + "'>" + sy + "년</option>");
		}
		
		$("#trgYear_S option[value=" + nyear +"]").attr("selected", true);
	}
	 

	// 거래처(구매처) 검색
	function openClntSearch(openType) {
		var searchValueM = null;
		// P:고객사, S:구매처
		if(openType == "P") {
			searchValueM = $("#clntNm_S").val();
		} else if(openType == "S") {
			searchValueM = $("#pchsClntNm_S").val();
		}
		var paramObj = {
				"searchValue" :  searchValueM
				, "clntDivCd" : "CLNTDIV12"		/*거래처 검색 기본값 고객사로 세팅 */
				, "pchsClntCd" : "CLNTDIV12"		/*구매처 팝업일 경우 구분자 고객사 제외하고 세팅 */				
		}		
		if(openType == "S") {
			paramObj.clntDivCd = null;
		}
		//매입관리에서 호출 플래그 추가
		paramObj.PurchaseFlag = "Y";
		
		openSecondModal("/static/html/cmn/modal/clntSearch.html", 650, 650, "거래처 검색", paramObj, function (grid) {
			var row = grid.target.getList("selected")[0];
			//고객사 콤보 세팅
			if(openType == "P"){
				$('#clntCd_S').val(row.clntCd);
				$('#clntNm_S').val(row.clntNm);
			//구매처 콤보세팅
			} else if(openType == "S"){
				$('#pchsClntCd_S').val(row.clntCd);
				$('#pchsClntNm_S').val(row.clntNm);
			}
			clntPurchaseGridView.setData(0);
		});
	} 

	//평가내역 팝업
	function openCostDetailNew(param) {
		if (param.coCd == "undefined" || param.coCd == "") {
			alert("수정할 자료를 선택해 주세요.");
			return;
		}

		paramObj = {
			"actionType" : "U",
			"userId" : jwt.userId,
			"pgmId" : "SM6101M01"
		};
		Object.assign(paramObj, param);
		openModal("/static/html/user/sm/sm61/SM6101P01.html", 1000, 520, "", paramObj);
	}
	
	//엑셀다운로드
	function excelDown() {
		var paramObj = {};
		$.each($('#main_area [data-search]'), function(idx, elem){
			if( $(elem).attr("class") == "input_calendar" ) {
				paramObj[$(elem).data("search")] = deleteHyphenStr($(elem).val());
			} else {
				paramObj[$(elem).data("search")] = $(elem).val();	
			}
		});			
		paramObj["pageNo"] =  1;
		paramObj["userId"] = jwt.userId;
		//발주 담당자 multi select
		let mngIdCd = $('#multiple-checkboxes-mngId').val();
		if (!mngIdCd) { //nul이면
			paramObj["mngIdCd"] = "";
		} else {
			paramObj["mngIdCd"] = mngIdCd.join(",");
		}
		postAjax("/user/sm/sm61/selectVendInitEstimateList", paramObj, null, function(data){
			let list = data.result;
		  	excelView.target.setData({
		  		list : list,
		  		page : {
		                  totalElements : list.length
		        			}
		  	});
 			var todayDate = new Date().format('yyyyMMddHHmmss');
			excelView.target.exportExcel("공급업체평가_"+todayDate+".xls");
		});       
	}  
	
 
    function gridResize(size) {
        let tagHeight = (size) * 27 + 50 ;
        tagHeight = tagHeight > 750 ? 750 : tagHeight;
        tagHeight = tagHeight < 320 ? 320 : tagHeight;
        
        clntPurchaseGridView.target.setHeight(tagHeight);
    }
    

	//공급업체평가표 출력
	function setReportMulti(_type = "") {
		if(selectGridValidationM(clntPurchaseGridView.target)) return false;
		var selDataList = clntPurchaseGridView.target.getList("selected");
	    
		var fileName = "SM6101R01.jrf";
		var arg =  
			  "coCd#"		+  $('#coCd_S').val()
		    + "#clntCd#"	+  selDataList.map(item => item.pchsClntCd).join(",") 
	    	+ "#year#"		+  $('#trgYear_S').val()
	    	+ "#";                 
	
		if (_type == '' || _type == undefined ) {
			callReport(fileName, arg, 1150, 720, '공급업체평가표');
		} else { //Export 작업
			ubiExportAjax(fileName, arg, function(response) {
				if (response.resultCode === 200) {
					var base64FileData = response.base64FileData;
					var fileName = response.exportFileName;
					downloadPDFFromBase64(base64FileData, fileName);
				} else {
					alert('PDF 내보내기 실패: ' + response.resultText);
				}
	
			});
		}
	
	}    

    
</script>
