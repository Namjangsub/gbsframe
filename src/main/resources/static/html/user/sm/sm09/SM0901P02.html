<div class="popup_area of_a" style="width: 100%; height: 100%;">
	<div class="tit_contents">
		<h4 class="tit">품목대체</h4>
	</div>
	
	<form id="popForm_1" onSubmit="return false;">
		<div class="form-group popup_table">
			<input type="hidden" id="fileTrgtKey" name="fileTrgtKey">
			<input type="hidden" id="userId"      name="userId">
			<input type="hidden" id="pgmId"       name="pgmId" value="SM0901M01">
			<table>
				<colgroup>
					<col width="11%">
					<col width="14%">
					<col width="11%">
					<col width="14%">
					<col width="11%">
					<col width="14%">
					<col width="11%">
					<col width="14%">
				</colgroup>
				<!-- 1행 -->
				<tr height="35">
				<th colspan = "4">대체(Form) 원본</th>
				<th colspan = "4">대체(To) 대상</th>
				</tr>
				
				<!-- 2행 -->
				<tr height="30">
					<th>회사</th>
					<td>
						<select id="coCd_X" name="coCd_X" data-kind="CO" class="form-control input-sm"></select>
					</td>
					
					<th>SalesCode</th>
					<td>
						<div class="search_form">
							<input type="text" id="salesCd_X" name="salesCd_X" readonly="readonly">
						</div>
					</td>
					
					<th  class="hit">회사</th>
					<td>
						<select id="coCd_Y" name="coCd_Y" data-kind="CO" class="form-control input-sm"></select>
					</td>
					
					<th class="hit salesCd_Y">SalesCode</th>
					<td>
						<div class="search_form">
							<input type="text" id="salesCd_Y" name="salesCd_Y" required onkeyup="event.keyCode == 13 ? SalesCodeSearch() : ''">
							<a onclick="SalesCodeSearch();"><i class="i_search_w"></i></a>
						</div>
					</td>	
				</tr>
				
				<!-- 3행 -->
				<tr height="30">
					<th>고객사</th>
					<td>
						<input type="hidden" id="clntCd_X" name="clntCd_X" readonly="readonly">
						<input type="text" id="clntNm_X" name="clntNm_X" readonly="readonly">
					</td>

					<th>고객사PJT</th>
					<td>
						<input type="text" id="clntPjt_X" name="clntPjt_X" readonly="readonly">
					</td>
					
					<th>고객사</th>
					<td>
						<input type="hidden" id="clntCd_Y" name="clntCd_Y" readonly="readonly">
						<input type="text" id="clntNm_Y" name="clntNm_Y" readonly="readonly">
					</td>

					<th>고객사PJT</th>
					<td>
						<input type="text" id="clntPjt_Y" name="clntPjt_Y" readonly="readonly">
					</td>
				</tr>
				
				<!-- 4행 -->
				<tr height="30">
				    <th>설비명</th>
					<td colspan="3">
						<input type="text" id="eqpNm_X" name="eqpNm_X" readonly="readonly">
					</td>
					
					<th>설비명</th>
					<td colspan="3">
						<input type="text" id="eqpNm_Y" name="eqpNm_Y" readonly="readonly">
					</td>
					
				</tr>
				
				<!-- 5행 -->
				<tr height="30">
					<th>제품구분</th>
					<td>
						<input type="hidden" id="prdtCd_X" name="prdtCd_X" class="form-control" >
						<div class="search_form">
							<input type="text" id="prdtNm_X" name="prdtNm_X" class="form-control" readonly="readonly">
						</div>
					</td>
					
					<th>아이템구분</th>
					<td>
						<input type="text" id="itemDiv_X" name="itemDiv_X" class="form-control" readonly="readonly">
					</td>
					
					<th>제품구분</th>
					<td>
						<input type="hidden" id="prdtCd_Y" name="prdtCd_Y" class="form-control" >
						<div class="search_form">
							<input type="text" id="prdtNm_Y" name="prdtNm_Y" class="form-control" readonly="readonly">
						</div>
					</td>
					
					<th>아이템구분</th>
					<td>
						<input type="text" id="itemDiv_Y" name="itemDiv_Y" class="form-control" readonly="readonly">
					</td>
				</tr>
				
				<!-- 6행 -->
				<tr height="30">
					<th>도면번호</th>
					<td colspan="3">
						<input type="text" id="matrDrwNo_X" name="matrDrwNo_X" class="form-control" readonly="readonly" >
					</td>
					
					<th>도면번호</th>
					<td colspan="3">
						<input type="text" id="matrDrwNo_Y" name="matrDrwNo_Y" class="form-control" >
					</td>
				</tr>
				
				<!-- 7행 -->
				<tr height="30">
					<th>재고 수량</th>
					<td>
						<input type="text" id="stockQty_X" name="stockQty_X" class="form-control" readonly="readonly" >
					</td>
					<th></th>
					<th></th>
					<th class="hit">대체 수량</th>
					<td>
						<input type="text" id="trialQty_Y" name="trialQty_Y" class="form-control" required value="0" required msg = "수량">
					</td>
					<th></th>
					<th></th>
				</tr>
				
				<!-- 8행 -->
				<tr height="30">
				  	<th>품번</th>
					<td>
						<input type="text" id="prodCd_X" name="prodCd_X" class="form-control" readonly="readonly">
					</td>

					<th>품명</th>
					<td>
						<input type="text" id="prodNm_X" name="prodNm_X" class="form-control" readonly="readonly">
					</td>
					
					<th>품번</th>
					<td>
						<input type="text" id="prodCd_Y" name="prodCd_Y" class="form-control" readonly="readonly">
					</td>

					<th>품명</th>
					<td>
						<input type="text" id="prodNm_Y" name="prodNm_Y" class="form-control" readonly="readonly">
					</td>
				</tr>
				<!-- 9행 -->
				<tr height="30">
					<th>품목구분</th>
					<td>
						<input type="text" id="goodsDiv_X" name="goodsDiv_X"  class="form-control" readonly="readonly">
					</td>
					
					<th>거래처분류</th>
					<td>
						<input type="text" id="matrClntDiv_X" name="matrClntDiv_X" class="form-control" readonly="readonly">
					</td>
					
					<th>품목구분</th>
					<td>
						<input type="text" id="goodsDiv_Y" name="goodsDiv_Y"  class="form-control" readonly="readonly">
					</td>
					
					<th>거래처분류</th>
					<td>
						<input type="text" id="matrClntDiv_Y" name="matrClntDiv_Y" class="form-control" readonly="readonly">
					</td>
				</tr>
				
				<!-- 10행 -->
				<tr height="30">
					<th>자재유형</th>
					<td>
						<input type="text" id="matrDiv_X" name="matrDiv_X" class="form-control" readonly="readonly">
					</td>
					
					<th>자재그룹</th>
					<td>
						<input type="text" id="matrGrp_X" name="matrGrp_X" class="form-control" readonly="readonly">
					</td>
					
					<th>자재유형</th>
					<td>
						<input type="text" id="matrDiv_Y" name="matrDiv_Y" class="form-control" readonly="readonly">
					</td>
					
					<th>자재그룹</th>
					<td>
						<input type="text" id="matrGrp_Y" name="matrGrp_Y" class="form-control" readonly="readonly">
					</td>
				</tr>
				
				<!-- 11행 -->
				<tr height="30">
                     <th>재질</th>
                     <td>
                         <input type="text" id="matrMat_X" name="matrMat_X" readonly="readonly">
                     </td>
                     <th>사이즈</th>
                     <td>
                         <input type="text" id="matrSize_X" name="matrSize_X" readonly="readonly">
                     </td>
                     
                     <th>재질</th>
                     <td>
                         <input type="text" id="matrMat_Y" name="matrMat_Y" readonly="readonly">
                     </td>
                     <th>사이즈</th>
                     <td>
                         <input type="text" id="matrSize_Y" name="matrSize_Y" readonly="readonly">
                     </td>
                </tr>

				<!-- 12행 -->
				<tr height="30">
					<th>규격</th>
					<td>
						<input type="text" id="matrSpec_X" name="matrSpec_X" readonly="readonly">
					</td>
					<th></th>
					<th></th>
					
					<th>규격</th>
					<td>
						<input type="text" id="matrSpec_Y" name="matrSpec_Y" readonly="readonly">
					</td>
					<th></th>
					<th>
					   <input type="hidden" id="outWhCd_Y" name="outWhCd_Y" class="form-control" readonly="readonly">
					</th>
				</tr>
				<!-- 13행 -->
				<tr height="30">
					<th>Maker</th>
					<td>
						<input type="text" id="matrMakrNm_X" name="matrMakrNm_X" readonly="readonly">
					</td>

					<th>형번</th>
					<td>
						<input type="text" id="matrMno_X" name="matrMno_X" readonly="readonly">
					</td>
					
					<th>Maker</th>
					<td>
						<input type="text" id="matrMakrNm_Y" name="matrMakrNm_Y" readonly="readonly">
					</td>

					<th>형번</th>
					<td>
						<input type="text" id="matrMno_Y" name="matrMno_Y" readonly="readonly">
					</td>
				</tr>
			</table>
		  </div>
		</form>
</div>

<!-- 하단 버튼 -->
<div class ="popup_bottom_btn">
	<button type="button" id="actionBtn_1" authChk>등록</button>
	<button type="button" class="close_btn" onclick="modalStack.close();">닫기</button>
</div>

<script type="text/javascript">
	// debugger;
	var actionType = null;
	var fileTrgtKey = null;
	
	$(document).ready(function() {
		setCommonSelect($(".popup_area select[data-kind]"));
		setByCoCd(modalStack.last().paramObj.coCd);
		//data세팅
		dataSetting(modalStack.last().paramObj);

		$("#popForm #userId").val(jwt.userId);

		$("#trialQty_Y").change(function(){ // 대표수량에 변화 발생시
			if ($("#stockQty_X").val() < $("#trialQty_Y").val()){ //재고수량보다 크면
				alert("재고수량보다 클 수 없습니다. \n 수량을 다시 확인해주세요.");
				$("#trialQty_Y").val($("#stockQty_X").val());  //재고수량만큼 다시 대표 수량을 세팅함
				
				return;
			}
	    });
		
		authChk(); //권한체크
		
		actionType = modalStack.last().paramObj.actionType;
		fileTrgtKey = modalStack.last().paramObj.fileTrgtKey;
			
		if (actionType == "C") {
			//버튼명 변경
			$("#actionBtn_1").text("등록");
			
			//버튼 클릭 시
			$('#actionBtn_1').on("click", function() {
				
				insert_sm091();
			});
		} else if (actionType == "U") {
			
			//타이틀명 변경
			$('.tit').text('품목대체 수정')
			
			//회사
			// $("#coCd").prop("disabled", true);
			//회사 비활성화
			$('#coCd').css({'background-color':'#e6e6e6', 'pointer-events':'none'});
			//품번
			$("#prodCd").prop("readonly", true);
			//품명
			$("#prodNm").prop("readonly", true);
			//품목구분
			$("#goodsDiv").prop("disabled", true);
			//제품구분
			$("#prdtCd").prop("readonly", true);
			$("#prdtNm").prop("readonly", true);
			//아이템구분
			$("#itemDiv").prop("disabled", true);
			//작업구분
			$("#prodDtlDiv20").prop("disabled", true);
			//자체구분
			$("#prodDtlDiv30").prop("disabled", true);
			//고객사PJT
			$("#clntPjt").prop("readonly", true);

			//수정 모드 데이터 가져오기
// 			select_bm10_Info();
			
			//버튼명 변경
			$('#actionBtn_1').text("수정");

			//버튼 클릭 시
			$('#actionBtn_1').on("click", function() {
				update_bm10();
			});
		}
		
	});
	
	//그리드에 뿌리는 데이터
	function select_bm10_Info() {
		var formData = {
			"fileTrgtKey" : fileTrgtKey,
		}
		
		postAjax("/user/bm/bm10/select_bm10_Info", formData, null, function(data) {
			$.each(data.result, function(key, value) {
				if ($('#popForm #' + key)[0]) {
					$('#popForm #' + key).val(value);
					
					if ($('#popForm #' + key).is('[comma]')) {
						onlyNumber($('#popForm #' + key)[0]);
					}
				}
			});
		});
	}
	
	// 등록
	function insert_sm091() {
		if (inputValidation($('.popup_area [required]'))) {		// 필수 필드의 유효성 검사
			var formData = makeFormData();						// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성

			filePostAjax("/user/sm/sm09/insert_sm091", formData,	// 파일을 포함한 데이터를 서버로 전송하는 비동기적인 AJAX 요청을 수행
			            function(data) {
							alert(data.resultMessage);			// 결과 메시지를 alert으로 출력
							
							if (data.resultCode == 200) {		//  요청이 성공(200)한 경우, gridView.setData(0)를 호출하여 그리드 뷰를 업데이트하고,
								gridView.setData(0);
								modalStack.close();				// 모달을 닫음
								modalStack.close();				// 모달을 닫음
							}
						}
			);
		}
	}
	
	// 수정
	function update_bm10() {
		if (inputValidation($('.popup_area [required]'))) {						// 필수 필드의 유효성 검사
			var formData = makeFormData();										// 요청이 통과하면 makeFormData() 함수를 이용해 formData를 생성
			
			filePostAjax("/user/bm/bm10/update_bm10", formData,function(data) {
				
				alert(data.resultMessage);
				
				if (data.resultCode == 200) {
					gridView.setData(0);
					modalStack.close();
				}
			});
		}
	}
	
	function makeFormData() {
		// 금액 콤마 제거
		$.each($('.popup_area input[comma]'), function(idx, elem) {
			deleteComma(elem);
		});
		
		// 날짜 하이픈 제거
		$.each($('.popup_area input[date]'), function(idx, elem) {
			deleteHyphen(elem);
		});

		// 폼데이터 생성
		var formData = new FormData($("#popForm_1")[0]);
// 		    formData.append("matrCd" , $('#prodCd_X').val());
// 		    formData.append("dsgnNo" , $('#matrDrwNo_Y').val());
// 		    formData.append("outQty" , $('#trialQty_Y').val());
// 		    formData.append("selesCd" , $('#salesCd_Y').val());
		    formData.append("ioDt" , $("#ioDt").val());
		    formData.append("outWhCd" , 'WH01');
		    formData.append("userId" , jwt.userId);
		    
		    ////////////////
		    if ($("#stockQty_X").val() < $("#trialQty_Y").val()){
		    	alert("재고수량보다 클 수 없습니다. \n 수량을 다시 확인해주세요.");
				$("#trialQty_Y").val($("#stockQty_X").val());
				
				return;
		    }
		    var sumQty = parseInt($('#stockQty_X').val()) - parseInt($('#trialQty_Y').val()); //재고수량 - 대체수량
		    
		    formData.append("stockQty" , sumQty);
		    
		    ////////////////
		    
		return formData;
	}

	//제품구분 검색
	function PrdtSearch(){
		var paramObj = {
			"coCd"  : $('#coCd').val(),
			"prdtCd": $('#prdtCd').val(),
			"prdtNm": $('#prdtNm').val(),
			"useYn" : "Y"
		}

		//등록일 경우만 팝업오픈
		if (actionType == "C") {
			openSecondModal("/static/html/cmn/modal/prdtSearch.html", 800, 600, "제품 검색", paramObj, function (grid) {
				var row = grid.target.getList("selected")[0];
				$("#prdtCd").val(row.prdtCd);
				$("#prdtNm").val(row.prdtNm);
			});
		}
	}
	
	//Sales Code
    function SalesCodeSearch() {
		//등록일 경우만 팝업처리
		if (actionType == "C") {
			var newSales = $("#matrDrwNo_X").val();//왼쪽 도면 번호
			var leftSalesCd = $("#salesCd_X").val(); //왼쪽 SalesCd
			var result = newSales.split('-'); //왼쪽 Sales Code '-' 자르기

			var paramObj = {
				"coCd" : $('#coCd').val(),
				"salesCd": $('#salesCd').val()
			};
			openThirdModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000, 430, "SALES CODE 검색", paramObj, function (grid) {
				var row = grid.target.getList("selected")[0];

				//같은 Sales Code 일 경우 알림
				if (leftSalesCd == row.salesCd){
					alert("왼쪽 Sales Code와 일치합니다.");
					return;
				}
				else if (row.salesCd == "" || row.salesCd == undefined){
					alert("Sales Code는 빈값입니다.");
					return;
				}

				$('#salesCd_Y').val(row.salesCd);
				$('#clntCd_Y').val(row.ordrsClntCd);
 				$('#clntNm_Y').val(row.ordrsClntNm);
 				$('#prdtCd_Y').val(row.prdtCd);
 				$('#prdtNm_Y').val(row.prdtCdNm);
				$('#itemDiv_Y').val(row.itemDiv);
 				$('#eqpNm_Y').val(row.eqpNm);
				$("#matrDrwNo_Y").val(row.salesCd + "-" + result[2] +"-" + result[3] + "-" + result[4]);
// 				$('#clntCd').val(row.ordrsClntCd);
// 				$('#clntNm').val(row.ordrsClntNm);
// 				$('#clntPjt').val(row.clntPjt);
// 				$('#prdtCd').val(row.prdtCd);
// 				$('#prdtNm').val(row.prdtCdNm);
// 				$('#itemDiv').val(row.itemDiv);
// 				$('#itemDivNm').val(row.itemDivNm);
// 				$('#eqpNm').val(row.eqpNm);
				
				//Modal_DataSearch();
			});
		}
    }
	
	function setByCoCd(value) {
		$('#coCd option:not([value="'+value+'"])').remove();
	}
	
	function dataSetting(value) {
		$("#salesCd_X").val(value.salesCd);       //왼쪽 salesCd
		$("#clntCd_X").val(value.clntCd);         //왼쪽 고객코드
		$("#clntNm_X").val(value.clntNm);         //왼쪽 고객명
		$("#clntPjt_X").val(value.clntPjt);       //왼쪽 고객사PJT
		$("#eqpNm_X").val(value.eqpNm);           //왼쪽 설비명
		$("#prdtCd_X").val(value.prdtCd);         //왼쪽 제품구분코드
		$("#prdtNm_X").val(value.prdtNm);         //왼쪽 제품구분명
		$("#itemDiv_X").val(value.itemDivNm);     //왼쪽 아이템구분
		$("#matrDrwNo_X").val(value.dsgnNo);      //왼쪽 도번
		$("#stockQty_X").val(value.stockQty);     //왼쪽 재고수량
		$("#prodCd_X").val(value.matrCd);         //왼쪽 품번
		$("#prodNm_X").val(value.matrNm);         //왼쪽 품명
		//품목구분
		//거래처분류
		$("#matrDiv_X").val(value.matrDiv);       //왼쪽 자재유형
		$("#matrGrp_X").val(value.matrGrp);       //왼쪽 자재그룹
		$("#matrMat_X").val(value.matrMat);       //왼쪽 소재
		$("#matrSize_X").val(value.matrSize);     //왼쪽 사이즈
		$("#matrSpec_X").val(value.matrSpec);     //왼쪽 규격
		$("#matrSpec_X").val(value.matrSpec);     //왼쪽 규격
		$("#matrMakrNm_X").val(value.matrMakrNm); //왼쪽 Maker
		$("#matrMno_X").val(value.matrMno);       //왼쪽 Maker

		$("#clntCd_Y").val(value.clntCd);         //오른쪽 고객코드
		$("#clntNm_Y").val(value.clntNm);         //오른쪽 고객명
		$("#clntPjt_Y").val(value.clntPjt);       //오른쪽 고객사PJT
		$("#eqpNm_Y").val(value.eqpNm);           //오른쪽 설비명
		$("#prdtCd_Y").val(value.prdtCd);         //오른쪽 제품구분코드
		$("#prdtNm_Y").val(value.prdtNm);         //오른쪽 제품구분명
		$("#itemDiv_Y").val(value.itemDivNm);     //오른쪽 아이템구분
		$("#matrDrwNo_Y").val(value.dsgnNo);      //오른쪽 도번
		//오른쪽 대표수량 입력칸
		$("#prodCd_Y").val(value.matrCd);         //오른쪽 품번
		$("#prodNm_Y").val(value.matrNm);         //오른쪽 품명
		//품목구분
		//거래처분류
		$("#matrDiv_Y").val(value.matrDiv);       //오른쪽 자재유형
		$("#matrGrp_Y").val(value.matrGrp);       //오른쪽 자재그룹
		$("#matrMat_Y").val(value.matrMat);       //오른쪽 소재
		$("#matrSize_Y").val(value.matrSize);     //오른쪽 사이즈
		$("#matrSpec_Y").val(value.matrSpec);     //오른쪽 규격
		$("#matrSpec_Y").val(value.matrSpec);     //오른쪽 규격
		$("#matrMakrNm_Y").val(value.matrMakrNm); //오른쪽 Maker
		$("#matrMno_Y").val(value.matrMno);       //오른쪽 Maker
		$("#outWhCd_Y").val(value.outWhCd);       //창고
	}

</script>