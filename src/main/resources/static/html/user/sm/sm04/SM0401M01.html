<!DOCTYPE html>
<html lang="ko">
<style>
    .EST, .file {
        background-color: white;
        visibility: hidden;
    }


    .grid-cell-blue {
        background: #dcf0f8;
    }

    .file, .EST {

        min-height: 800px;
        float: left;
    }

    ul.ul_list.type03-est li {
        width: calc(100% - 6px);
        float: left;
    }

    ul.ul_list.type03-est li:nth-child(odd) {
        clear: left;
    }

    ul.ul_list.type03-est li + li {
    }

    @media only screen and (max-width: 767px) {
        .file, .EST {
            width: 100%;
        }
    }

    @media only screen and (min-width: 768px) {
        .file, .EST {
            width: 50%;
        }

    }
</style>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="/static/fontawesome/css/all.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5grid.css"/>
    <link rel="stylesheet" href="/static/css/ax5/ax5mask.css"/>
    <link rel="stylesheet" href="/static/css/ax5/ax5modal.css"/>
    <link rel="stylesheet" href="/static/css/ax5/ax5toast.css"/>

    <link rel="stylesheet" href="/static/css/jstree/style.min.css"/>
    <link rel="stylesheet" href="/static/css/gnb.css"/>
    <link rel="stylesheet" href="/static/css/main.css"/>
    <!--	<link rel="stylesheet" href="/static/css/sub.css" />-->
    <link rel="stylesheet" href="/static/css/common.css"/>

    <link rel="stylesheet" href="/static/css/sub.css"/>

    <link rel="stylesheet" type="text/css"
          href="https://cdn.rawgit.com/ax5ui/ax5ui-calendar/master/dist/ax5calendar.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/ax5ui/ax5ui-picker/master/dist/ax5picker.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/ax5ui/ax5ui-select/master/dist/ax5select.css">
    <link rel="stylesheet" href="/static/css/ax5/ax5menu.css">

    <script src="/static/js/jquery-latest.min.js"></script>
    <script src="/static/js/jquery.serializeObject.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
    <script src="/static/js/moment/moment-with-locales.js"></script>
    <script src="/static/js/ax5/ax5core.min.js"></script>
    <script src="/static/js/ax5/ax5calendar.min.js"></script>
    <script type="text/javascript"
            src="https://cdn.rawgit.com/ax5ui/ax5ui-picker/master/dist/ax5picker.min.js"></script>
    <script type="text/javascript"
            src="https://cdn.rawgit.com/ax5ui/ax5ui-formatter/master/dist/ax5formatter.min.js"></script>
    <script type="text/javascript"
            src="https://cdn.rawgit.com/ax5ui/ax5ui-select/master/dist/ax5select.min.js"></script>
    <script src="/static/js/ax5/ax5grid.min.js"></script>
    <script src="/static/js/ax5/ax5mask.min.js"></script>
    <script src="/static/js/ax5/ax5modal.min.js"></script>
    <script src="/static/js/ax5/ax5toast.min.js"></script>
    <script src="/static/js/jstree/jstree.min.js"></script>
    <script src="/static/js/ax5/ax5menu.min.js"></script>
    <script type="text/javascript" src="https://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="/static/js/global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.5.0/jszip.min.js"></script>
	<script src="/static/js/fileTree.js"></script>

</head>

<body>
<div id="head_area"></div>
<div id="top_area"></div>

<div id="main_area">
    <!-- 페이지 상단 -->
    <div class="contents no_bg">
        <ul class="btn_ul">
            <li class="btn_r">
                <a onclick="initSearch();">
                    <button class="bg_gray">초기화</button>
                </a>
                <a onclick="gridView.setData(0);">
                    <button class="bg_gray">검 색</button>
                </a>
            </li>
        </ul>
    </div>
    <!-- 검색 콘텐츠 -->
    <div class="contents search">
        <div class="">
            <!-- 테이블 인풋 3분할 -->
            <table class="table_input type04">
                <tr>
                    <th class="hit">회사</th>
                    <td>
                        <select id="coCd_S" style="width:100%;" data-kind="CO" onchange="gridView.setData(0);"
                                required="required">
                            <option value="">전체</option>
                        </select>
                    </td>
                    <th class="hit">불출일자</th>
                    <td>
                        <div class="date_input">
                            <input type="text" id="strtDt_S" class="input_calendar" autocomplete="off"
                                   required="required" data-search="strtDt_S">
                            <span>~</span>
                            <input type="text" id="endDt_S" class="input_calendar" autocomplete="off"
                                   required="required" data-search="endDt_S">
                        </div>
                    </td>
                    <th class="">고객사</th>
                    <td>
                        <input type="hidden" id="ordrsClntCd_S" name="ordrsClntCd_S">
                        <div class="search_form">
                            <input type="text" id="ordrsClntNm_S" name="ordrsClntNm_S" onkeyup="event.keyCode == 13 ? gridView.setData(0) : ''" >
                            <a onclick="opendClntSearch($('#ordrsClntNm_S').val());">
                                <i class="i_search_w"></i>
                            </a>
                        </div>
                    </td>


                </tr>
                <tr>
				  	<th>Sales Code</th>
	                <td>
						<div class="search_form" >
						<input type="text"  id="salesCd_S" data-search="salesCd"  onkeyup="event.keyCode == 13 ? gridView.setData(0) : ''">
                        <a onclick="wbsSalesCodeSearch();"><i class="i_search_w" ></i></a>
						</div>
					</td>
					
					<th>제품 구분</th>
					<td>
					    <input type="hidden" id="prdtDiv_S" name="prdtDiv_S" data-search="prdtDiv" >
	                          <div class="search_form">
	                            <input type="text" id="prdtDivNm_S" name="prdtDivNm_S" data-search="prdtDivNm" onkeyup="event.keyCode == 13 ? gridView.setData(0) : ''"> 
	                              <a onclick="openPrdtSearch();"><i class="i_search_w"></i></a>
	                          </div>
	
					</td>					
					
					<th>아이템 구분</th>
					<td>
						<select  id="itemDiv_S" name="itemDiv_S" data-kind="ITEMLIST" style="width: 100%;">
						   <option value="">선택</option>
						</select>
					</td>    
                </tr>
                
                <tr>
					<th>출고창고</th>
					<td>
						<select  id="outWhNm_S" name="outWhNm_S"  onchange="setByCoCd(this.value)" style="width: 100%;">
						   <option value="">선택</option>
						</select>
					</td>
					
                	<th>품번</th>
					<td>
						<input type="text" id="matrCd_S" name="matrCd_S" data-kind="matrCd">
					</td>
					<!-- <td>
						<input type="hidden" id="matrCd_S" data-kind="matrCd_S" data-search="matrCd_S" required="required" >
						<div class="search_form"  style="width: 100%;" >
							<input type="text" id="matrCdNm_S" data-kind="matrCdNm_S" data-search="matrCdNm_S" required="required"  onkeyup="event.keyCode == 8 ? salesCd_S.value = '' : event.keyCode == 13 ? bmUprMstrGridView.setData(0) : ''">                      
							<a onclick="openMatListSearch('P');"> <i class="i_search_w" ></i></a> 
						</div>
					</td> -->
				 
					<th>품명</th>
					<td>
						<input type="text" id="matrNm_S" name="matrNm_S" data-kind="matrNm"> 
					</td>   
				 
					<th>규격</th>
					<td>
						<input type="text" id="matrSpec_S" name="matrSpec_S" data-kind="matrSpec">
					</td> 
                
                </tr>
                
                <tr>
	                <th>거래처분류</th>
						<td>
							<select id="matrClntDiv_S" data-kind="CLNTDIV" data-search="MATRCLNTDIV" >
								<option value="">선택</option>
							</select>
						</td>
					 
						<th>소재</th>
						<td>
							<input type="text" id="matrMat_S" name="matrMat_S" data-kind="matrMat" >
						</td>
					 
						<th>Maker</th>
						<td>
							<input type="text" id="matrMakrNm_S" name="matrMakrNm_S" data-kind="matrMakrNm" >
						</td>   
					 
						<th>형번</th>
						<td>
							<input type="text" id="matrMno_S" name="matrMno_S" data-kind="matrMno" >
						</td> 
	                
	                </tr>
                <tr>
					<!-- <th class="">견적서차수</th>
                    <td>
                        <select id="estDeg_S" name="estDeg_S" onchange="gridView.setData(0);">

                        </select>
                    </td>
                    <th class="">공사명</th>
                    <td>
                        <div class="search_form">
                            <input type="text" id="estNm_S" name="estNm_S" class="modal-estNm_S">
                        </div>

                    </td> -->
                </tr>
            </table>
        </div>
    </div>
    <div class="contents no_bg">
        <!-- 콘텐츠 타이틀 -->
        <div class="contents_tit">
            <div>
                <div style="float:right">
                    <a class="btn btn-default btn-sm" onclick="excelDown();"><i class="fas fa-file-excel"></i>
                        엑셀다운로드</a>
                </div>
                <div class="add_btn_small pdl10" style="margin-right:8px;">
                    <a onclick="insertProjectModal('C')" style="height: 30px; line-height: 28px;" authchk>+</a>
                    <a onclick="deleteEst()" style="height: 30px; line-height: 28px;" authchk>-</a>
                </div>

            </div>
            <select class="prae_select" style="height:30px;" onchange="gridView.setData(0);" id="recordCnt">
                <option value="10">10</option>
                <option value="20" selected>20</option>
                <option value="50">50</option>
                <option value="100">100</option>
                <option value="9999999">전체</option>
            </select>
            <div class="add_btn_small pdr10">

            </div>
            <input type="hidden" id="recordCnt">
            <input type="hidden" id="basisPriceSeq">
        </div>
    </div>
    <div class="contents">
        <div class="ax5_grid">
            <ul class="ul_list type03-est">
                <li>
                    <div>
                        <div data-ax5grid="first-grid" data-ax5grid-config="{}"
                             style="height: 250px; width: 100%"></div>
                    </div>
                </li>
                <li>
                    <div class="table_list_tit">
                    </div>
                    <div>
                        <div id="second-grid" data-ax5grid="second-grid" data-ax5grid-config="{}"
                             style="height: 250px; width: 100%;"></div>

                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>
<div data-ax5grid="excel-grid" data-ax5grid-config="{}" style="display: none;"></div>

</body>


<script type="text/javascript">

    var gridView = {
        	initView: function(){
    			this.target = new ax5.ui.grid();
    			this.target.setConfig({
    				// 체크박스
    				showRowSelector: true,
    				multipleSelect: false,
    				sortable: true,
    				target: $('[data-ax5grid="first-grid"]'),
    				header: {
    	              align: "center",
    	              selector: false
    	            },
    	            body: {
    					onClick: function () {
    					    this.self.select(this.dindex);
    					    handleClickMainEvent(this.item);
    					    /* var row = this.dindex;
                            var item = this.item; // 선택된 행의 데이터
                            var coCd = item.coCd; // 선택된 행의 coCd 값
                            var ioNo = item.ioNo; // 선택된 행의 coCd 값
                            var paramObj = {
                                    "coCd": coCd,
                                    "ioNo": ioNo
                             };
                            
                            getGridDetail(paramObj); */
                            
    					},
    					onDBLClick: function () {
                            this.self.select(this.dindex);
                            var item = this.item; // 선택된 행의 데이터
                            var coCd = item.coCd; // 선택된 행의 coCd 값
                            var ioNo = item.ioNo; // 선택된 행의 coCd 값
                            // selectEstInfo 함수 호출
                            var paramObj = {
                                "coCd": coCd,
                                "ioNo": ioNo
                            };
                            handleClickEvent(this.item);
    					}
    			   },
    	           page: {
    					navigationItemCount: 9,
    					height: 30,
    					display: true,
    					firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
    					prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
    					nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
    					lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
    					onChange: function () {
    						gridView.setData(this.page.selectPage); 
    					}
    	           },
    	           columns: [
    	        	   {key: "fileTrgtKey",      label: "첨부파일키", align: "center",   width: 80, hidden: true},
    	        	   {key: "coCd",      label: "회사", align: "center",   width: 80, hidden: true},
                       {key: "ioNo", label: "불출번호", align: "center", width: 100,},
                       {key: "salesCd", label: "Sales Code", align: "center", width: 140,},
                       {key: "outWhCd", label: "출고창고코드", align: "center", width: 80, hidden: true },
                       {key: "outWhNm", label: "출고창고", align: "center", width: 130 },
                       {key: "inWhCd", label: "입고창고코드", align: "center", width: 110, hidden: true },
                       {key: "inWhNm", label: "입고창고", align: "center", width: 130},
                       {key: "ioRmk", label: "비고", align: "center", width: 110},
                       {key: "creatIdNm", label: "생성자", align: "center", width: 80},
                       {key: "creatDttm", label: "생성일시", align: "center", width: 100},
                       {key: "udtIdNm", label: "변경자", align: "center", width: 100},
                       {key: "udtDttm", label: "변경일시", align: "center", width: 100}
    	               
    	              ]
    	        });
    	        return this;
    		
    	      },
              setData: function(_pageNo) {

            	    var targetObj = this.target;

               	   var formData = new FormData();
               	   
               	   var formData = {
           	    		// 조회조건 수정하기            	    			                    
           	    		   "coCd": $('#coCd_S').val(),
                           "strtDt": $("#strtDt_S").val().replace(/\-/g, ''),
                           "endDt": $("#endDt_S").val().replace(/\-/g, ''),
                           "OrdrsClntCd": $("#OrdrsClntCd_S").val(),
                           "clntNm": $("#clntNm_S").val(),
                           "salesCd": $("#salesCd_S").val(),
                           "prdtCd": $("#prdtDivNm_S").val(),
                           "itemDiv": $("#itemDiv_S").val(),
                           "outWhCd": $("#outWhCd_S").val(),
                           "pageNo": _pageNo + 1,
                           "recordCnt": $("#recordCnt").val(),
                           "matrCd": $("#matrCd_S").val(),
                           "matrNm": $("#matrNm_S").val(),
                           "matrSpec": $("#matrSpec_S").val(),
                           "matrClntDiv": $("#matrClntDiv_S").val(),
                           "matrMat": $("#matrMat_S").val(),
                           "matrMakrNm": $("#matrMakrNm_S").val(),
                           "matrMno": $("#matrMno_S").val()
             
           	        }
            	 	
                    postAjax("/user/sm/sm04/selectIoList", formData, null,  function(data){
                        var list = data.ioList;
                       	
    					targetObj.setData({
    					    list : list,
    					    page : {
    		                    currentPage : _pageNo,
    		                    pageSize : data.paginationInfo.pageSize,
    		                    totalElements : data.paginationInfo.totalRecordCount,
    		                    totalPages : data.paginationInfo.totalPageCount
    					    } 
    					});
                    });
               } 
         }
     
    function fetchCurrencyData() {
        var paramObj = {"codeKind": "ORDRSDTLDIV10", "useYn": "Y"};
        var paramObj2 = {"codeKind": "ITEMLIST", "useYn": "Y"};
        var paramObj3 = {"codeKind": "ORDRSDTLDIV20", "useYn": "Y"};
        var paramObj4 = {"codeKind": "ORDRSDTLDIV30", "useYn": "Y"};

        var promise1 = new Promise(function (resolve, reject) {
            postAjax("/admin/cm/cm05/selectCodeList", paramObj, null, function (data) {
                if (data && data.codeList) {
                    var codeList = data.codeList;
                    var options = codeList.map(function (code) {
                        return {
                            value: code.codeId,
                            text: code.codeNm
                        };
                    });
                    resolve(options);
                } else {
                    console.error("codeList is undefined. Check the AJAX response:", data);
                    reject(data);
                }
            });
        });

        var promise2 = new Promise(function (resolve, reject) {
            postAjax("/admin/cm/cm05/selectCodeList", paramObj2, null, function (data) {
                if (data && data.codeList) {
                    var codeList = data.codeList;
                    var options2 = codeList.map(function (code) {
                        return {
                            value: code.codeId,
                            text: code.codeNm
                        };
                    });
                    resolve(options2);
                } else {
                    console.error("codeList is undefined. Check the AJAX response:", data);
                    reject(data);
                }
            });
        });
        var promise3 = new Promise(function (resolve, reject) {
            postAjax("/admin/cm/cm05/selectCodeList", paramObj3, null, function (data) {
                if (data && data.codeList) {
                    var codeList = data.codeList;
                    var options3 = codeList.map(function (code) {
                        return {
                            value: code.codeId,
                            text: code.codeNm
                        };
                    });
                    resolve(options3);
                } else {
                    console.error("codeList is undefined. Check the AJAX response:", data);
                    reject(data);
                }
            });
        });
        var promise4 = new Promise(function (resolve, reject) {
            postAjax("/admin/cm/cm05/selectCodeList", paramObj4, null, function (data) {
                if (data && data.codeList) {
                    var codeList = data.codeList;
                    var options4 = codeList.map(function (code) {
                        return {
                            value: code.codeNm,
                            text: code.codeNm
                        };
                    });
                    resolve(options4);
                } else {
                    console.error("codeList is undefined. Check the AJAX response:", data);
                    reject(data);
                }
            });
        });

        return Promise.all([promise1, promise2, promise3, promise4]);
    }


    var thisGridRow = "";
    var thisGridCol = "";
    
    const gridView2 = new ax5.ui.grid();
    fetchCurrencyData().then(function () {
        // 그리드 생성

        gridView2.setConfig({
            target: $('[data-ax5grid="second-grid"]'),
            header: {
                align: "center",
                selector: false
            },
            columns: [
	        	{key: "fileTrgtKey",      label: "첨부파일키", align: "center",   width: 80, hidden: true},
                {key: "ioSeq", label: "불출순번", align: "center", width: 50,},
                {key: "dsgnNo", label: "도번", align: "center", width: 190,},
                {key: "matrCd", label: "품번", align: "center", width: 110,},
                {key: "matrNm", label: "품명", align: "center", width: 80, hidden: true },
                {key: "matrSpec", label: "규격", align: "center", width: 110 },
                {key: "matrMat", label: "소재", align: "center", width: 120, hidden: true },
                {key: "matrMakrNm", label: "maker", align: "center", width: 80},
                {key: "matrMno", label: "형번", align: "center", width: 100},
                {key: "ioQty", label: "불출수량", align: "center", width: 80, align: "right"},
                {key: "ioDtlRmk", label: "상세비고", align: "center", width: 120},
                {key: "creatIdNm", label: "생성자", align: "center", width: 80},
                {key: "creatDttm", label: "생성일시", align: "center", width: 100},
                {key: "udtIdNm", label: "변경자", align: "center", width: 100},
                {key: "udtDttm", label: "변경일시", align: "center", width: 100}
	               
	              ],
            body: {
                onClick: function () {
                    this.self.select(this.dindex);
                    thisGridRow = this.dindex;
                    thisGridCol = this.colIndex;
                    selectedRowKey = this.dindex;
                },
                columnHeight: 26,
                onDataChanged: function () {
                	gridView2.repaint();
                    const data = gridView2.getList();
                    gridView2.setData(data);
                    if (this.key == 'isChecked') {
                        this.self.updateChildRows(this.dindex, {isChecked: this.item.isChecked});
                    } else if (this.key == '__selected__') {
                        this.self.updateChildRows(this.dindex, {__selected__: this.item.__selected__});
                    }

                }
            }
        });
    })


	//Sales Code (수주마스터, 수주상세테이블 조인) 검색
	function wbsSalesCodeSearch() {
		var paramObj = {
			"coCd" : $('#coCd_S').val(),
			"salesCd" : $('#salesCd_S').val()
		};
		//debugger;
		openSecondModal("/static/html/cmn/modal/wbsSalesCodeSearch.html", 1000,
				430, "SALES CODE 검색", paramObj, function(grid) {
					//debugger;
					var row = grid.target.getList("selected")[0];
					$('#salesCd_S').val(row.salesCd);
				});
	}

  	//제품코드 검색
	function openPrdtSearch(){
		var paramObj = {
				"coCd": $('#coCd_S').val(),
				"prdtCd": $('#prdtDiv_S').val(),
				"prdtNm": $('#prdtDivNm_S').val(),
				"useYn" : "Y"
		}
		openSecondModal("/static/html/cmn/modal/prdtSearch.html", 800, 600, "제품 검색", paramObj, function (grid) {
			var row = grid.target.getList("selected")[0];
			$("#prdtDiv_S").val(row.prdtCd);
			$("#prdtDivNm_S").val(row.prdtNm);
		});
	}

	var excelView = {
		initView : function() {
			this.target = new ax5.ui.grid();
			this.target.setConfig({
				target : $('[data-ax5grid="excel-grid"]'),
				columns : [ {
					key : "coCd",
					label : "회사코드",
					align : "center",
					width : 80,
				}, {
					key : "estNo",
					label : "견적번호",
					align : "center",
					width : 80,
					enableFilter : true
				}, {
					key : "estDeg",
					label : "차수",
					align : "center",
					width : 80,
					enableFilter : true
				}, {
					key : "estClntCd",
					label : "고객사",
					align : "center",
					width : 80
				}, {
					key : "estClntNm",
					label : "고객사명",
					align : "center",
					width : 80
				}, {
					key : "estDt",
					label : "작성일",
					align : "center",
					width : 80
				}, {
					key : "estsDt",
					label : "견적유효일자FROM",
					align : "center",
					width : 120
				}, {
					key : "esteDt",
					label : "견적유효일자TO",
					align : "center",
					width : 120
				}, {
					key : "cstmMngNm",
					label : "고객담당자",
					align : "center",
					width : 80
				}, {
					key : "cstmMngHp",
					label : "고객담당자 연락처",
					align : "center",
					width : 120
				}, {
					key : "mngId",
					label : "견적제출자",
					align : "center",
					width : 80
				}, {
					key : "estNm",
					label : "공사명",
					align : "center",
					width : 250
				}, {
					key : "currCd",
					label : "통화단위",
					align : "center",
					width : 80,
					formatter : function() {
						var value = this.value;
						switch (value) {
						case "CURR01":
							return "WON";
						case "CURR02":
							return "달러";
						case "CURR03":
							return "유로";
						case "CURR04":
							return "엔화";
						default:
							return value; // unknown value, return as is
						}
					}
				}, {
					key : "exrate",
					label : "환율",
					align : "right",
					width : 80,
					formatter : "money"
				}, {
					key : "estAmt",
					label : "견적금액",
					align : "right",
					width : 80,
					formatter : "money"
				}, {
					key : "estNegoAmt",
					label : "견적네고금액",
					align : "right",
					width : 120,
					formatter : "money"
				}, {
					key : "estExcept",
					label : "견적제외사항",
					align : "center",
					width : 500,
				}, {
					key : "estStd",
					label : "견적기준",
					align : "center",
					width : 500,
				}, {
					key : "estDlvrCndt",
					label : "납품조건",
					align : "center",
					width : 80,
				}, {
					key : "estPmntCndt",
					label : "결재조건",
					align : "center",
					width : 80,
				}, {
					key : "estDudt",
					label : "납기",
					align : "center",
					width : 80,
				}, {
					key : "ordrsYn",
					label : "수주확정여부",
					align : "center",
					width : 120,
				}, {
					key : "ordrsDt",
					label : "수주확정일자",
					align : "center",
					width : 120,
				}, {
					key : "estRmk",
					label : "비고",
					align : "center",
					width : 80,
				}, ],

			});
			return this;
		}
	}
	//화면로드시
	$(document).ready(
		function() {
			// 인터벌을 설정합니다. 여기서는 1000밀리초(=1초) 간격으로 설정했습니다.
			     let intervalId = setInterval(function () {
			    // 선택자에 해당하는 요소를 가져옵니다.
			    let element = $('[data-ax5grid-data-o-index="0"]');

			    // 요소가 존재하면 클릭 이벤트를 트리거합니다.
			    if (element.length) {
			        element.trigger('click');
			        console.log('Click event triggered successfully');

			        // 클릭 이벤트가 성공적으로 트리거되면 인터벌을 중지합니다.
			        clearInterval(intervalId);
			    } else {
			        console.log('Element not found, trying again...');
			    }
			}, 1000);  
			
		    //excelView.initView();
	        $("#coCd_S").focus();
	        mainDefaultLoad("영업관리", "자재불출 등록");
	        setCommonSelect($("#main_area select[data-kind]"));
	        $("#coCd_S").val(jwt.coCd);
	        getWhNm();

			gridView.initView().setData(0);

			// 시작일 (현재날짜의 월 첫일)
			$('#strtDt_S').datepicker({
				format : "yyyy-mm-dd",
				language : "ko",
				autoclose : true
			}).datepicker("setDate",
					moment(new Date()).startOf("month").toDate()).on(
					"changeDate",
					function() {
						if ($('#strtDt_S').val() > $('#endDt_S').val()) {
							alert("날짜를 확인해주세요");
							$('#strtDt_S').datepicker("setDate",
									new Date($('#endDt_S').val()));
						}
					});

			// 종료일 (현재날짜의 월 말일)
			$('#endDt_S').datepicker({
				format : "yyyy-mm-dd",
				language : "ko",
				autoclose : true
			}).datepicker("setDate",
					moment(new Date()).endOf("month").toDate()).on(
					"changeDate",
					function() {
						if ($('#strtDt_S').val() > $('#endDt_S').val()) {
							alert("날짜를 확인해주세요");
							$('#endDt_S').datepicker("setDate",
									new Date($('#strtDt_S').val()));
						}
					});
			;

			$("#ordrsClntNm_S").keypress(function(event) {
				if (event.keyCode == 13) { // Enter 키의 키 코드는 13입니다.
					gridView.setData(0);
					event.preventDefault(); // 폼 제출 등의 기본 동작을 방지합니다.
				}
			});
			$('.input_calendar').on('change', function() {
				gridView.setData(0);
			});

			$('.input_calendar').on('change', function() {
				gridView.setData(0);
			});

	});
	
	
	function insertProjectModal(type) {
		
		 var paramObj = {
			"actionType"  : type,
			"fileTrgtKey" : 0,
			"coCd" 	   : jwt.coCd,
	       	"userId"   : jwt.userId,
			"pgmId"       : "SM0401M001"
		};
		 
		openModal("/static/html/user/sm/sm04/SM0402P01.html", 1400, 736, "",
				paramObj);
 
	}

	function getWhNm() {
		var paramObj = {
				"WhNm" : "INOUTDIV_O03",
				"coCd" : $("#coCd_S").val()
			};
		
		postAjax("/user/sm/sm04/selectWhCd", paramObj, null, function (data) {
	    	   var row = data.whList;
	    	   
				for(var i=0;  i<row.length; i++) {
				    $('#outWhNm_S').append($('<option>', { 
				        value: row[i].codeEtc,
				        text : row[i].codeNm 
				    }));					
				}
				
	        });
	}
			
			
			
	// 거래처 검색 함수
	function opendClntSearch(inputValue) {
		openModal("/static/html/cmn/modal/clntSearch.html", 600, 420, "거래처 검색",
				{
					searchValue : inputValue
				}, function(grid) {
					var row = grid.target.getList("selected")[0];
					$('#ordrsClntCd_S').val(row.clntCd);
					$('#ordrsClntNm_S').val(row.clntNm);
					gridView.setData(0);
				});
	}

	/* function opendClntSearchEnter(searchValue) {

		postAjax("/static/html/cmn/modal/clntSearch.html", {
			CODE_ETC : searchValue
		}, null, function(data) {
			alert(JSON.stringify(data));
			$("#ordrsClntCd_S").val()
			gridView.setData(0);

		})
	};
 */
	function handleClickEvent(item) {
		updateProjectModal(item)

	}

	function handleClickMainEvent(item) {
		updateDetailGrid(item)

	}

	function updateProjectModal(item) {
		var paramObj = {
			"actionType" : "U",
			"coCd" : item.coCd,
			"ioNo" : item.ioNo,
			"fileTrgtKey" : item.fileTrgtKey
		};
		openModal("/static/html/user/sm/sm04/SM0402P01.html", 1400, 736, "",
				paramObj);

	}

	  function updateDetailGrid(item) {
	       var paramObj = {
	           "coCd": item.coCd,
	           "ioNo": item.ioNo,
	           "salesCd": item.salesCd
	           
	       };
	       
	       postAjax("/user/sm/sm04/selectIoDetail", paramObj, null, function (data) {
	    	   
	    	   var list = data.ioDetailList;

	            gridView2.setData({
	            	list : list,
					page: {
	                    totalElements: list.length
	                }
				});
	        });
	   } 

	function initSearch() {
		// 모든 텍스트 필드 값을 초기화
		$(".table_input.type04 input[type='text']").val("");

		// 회사 선택 상자 값 설정
		$("#coCd_S").val(jwt.coCd);

		// 날짜 필드 값 설정
		$("#strtDt_S").val(lastMonth());
		$("#endDt_S").val(dateToStr(new Date()));

		// '견적서차수' 선택 상자 초기화
		$("#estDeg_S option").eq(0).prop("selected", true);

		// 그리드 뷰 초기화
		gridView.initView().setData(0);
	}

	
	
	function lastMonth() {
		var date = new Date();
		date.setMonth(date.getMonth() - 1);
		return date.toISOString().split('T')[0];
	}
</script>
</html>
