<body>
<div class="popup_area" style="width: 100%;">
    <div class="popup_table">
        <table>
            <colgroup>
                <col width="30%">
                <col width="">
            </colgroup>
            <tr>
                <td>
                    <select data-search="searchType">
                        <!--		                  	<option value="SITE_NM">고객사</option>-->
                        <option value="ORDRS_NO">수주번호</option>
                    </select>
                </td>
                <td>
                    <div class="search_form">
                        <input type="text" data-search="searchValue" onkeypress="if(event.keyCode == 13){ordrsGridView.setData(0);}">
                        <a onclick="ordrsGridView.setData(0);">
                            <i class="i_search_w"></i>
                        </a>
                    </div>
                </td>
            </tr>
        </table>
        <div class="ax5_grid" data-ax5grid="ordrs-grid" data-ax5grid-config="{}" style="height: 320px;"></div>
    </div>
</div>
<div class="popup_bottom_btn">
    <button type="button" onclick="executeCallback();">선택</button>
    <button type="button" class="close_btn" onclick="modalStack.close();">닫기</button>
</div>
</body>
<script type="text/javascript">
    var ordrsGridView = {
        initView: function () {
            this.target = new ax5.ui.grid();
            this.target.setConfig({
                showRowSelector: true,
                multipleSelect: false,
                target: $('[data-ax5grid="ordrs-grid"]'),
                header: {
                    align: "center",
                    selector: false
                },
                body: {
                    onClick: function () {
                        this.self.select(this.dindex);
                    },
                    onDBLClick: function () {
                        executeCallback();
                    }
                },
                page: {
                    navigationItemCount: 9,
                    height: 30,
                    display: true,
                    firstIcon: '<i class="fa fa-step-backward" aria-hidden="true"></i>',
                    prevIcon: '<i class="fa fa-caret-left" aria-hidden="true"></i>',
                    nextIcon: '<i class="fa fa-caret-right" aria-hidden="true"></i>',
                    lastIcon: '<i class="fa fa-step-forward" aria-hidden="true"></i>',
                    onChange: function () {
                        ordrsGridView.setData(this.page.selectPage);
                    }
                },
                columns: [
                    // {key: "coCd", label: "회사코드", align: "center", width: 100, enableFilter: true},
                    {key: "estNo", label: "견적서번호", align: "center", width: 100, enableFilter: true},
                    {key: "ordrsNo", label: "수주번호", align: "center", width: 100},
                    {key: "ordrsDt", label: "수주일자", align: "center", width: 100},
                    {key: "ordrsClntCd", label: "고객사", align: "center", width: 100},
                    {key: "ordrsClntNm", label: "고객사명", align: "center", width: 100},
                    //	{key: "clntPjt", label: "고객사PJT", align: "center", width: 100},
                    {key: "ctrtNm", label: "계약명", align: "center", width: 100},
                    {key: "currCd", label: "통화단위", align: "center", width: 100},
                    {key: "ordrsAmt", label: "수주금액", align: "right", width: 100, formatter: "money"},
                    //{key: "fwdExchJoinDt", label: "선물환가입일", align: "center", width: 100},
                    //{key: "fwdExchChkList", label: "선물환 Check List", align: "center", width: 100},
                    {key: "ordrger", label: "발주자", align: "center", width: 100},
                    {key: "mngId", label: "담당자", align: "center", width: 100},
                    {key: "ctrtDoc", label: "계약문서", align: "center", width: 100},
                    {key: "pmntMtd", label: "결제방법", align: "center", width: 100}
                ]
            });
            return this;
        },
        setData: function (_pageNo) {
            var targetObj = this.target;
            var paramObj = {};
            paramObj.pageNo = _pageNo + 1;
            paramObj.recordCnt = 10;

            for (var i = 0; i < $('.popup_area [data-search]').length; i++) {
                var tempElem = $('.popup_area [data-search]')[i];
                paramObj[$(tempElem).data("search")] = $(tempElem).val();
            }

            postAjax("/user/cr/cr02/selectOrdrsList", paramObj, null, function (data) {


                var list = data.ordrsList;
                alert(JSON.stringify(data.ordrsList));

                originalData = list;
                targetObj.setData({
                    list: list,
                    page: {
                        currentPage: _pageNo,
                        pageSize: data.paginationInfo.pageSize,
                        totalElements: data.paginationInfo.totalRecordCount,
                        totalPages: data.paginationInfo.totalPageCount
                    }
                });


            });
        }
    }

    $(document).ready(function () {
        alert("wwwww");
        alert(modalStack.last().paramObj.searchValue);
        $('[data-search="searchValue"]').val(modalStack.last().paramObj.searchValue);
        $('[data-search="searchValue"]').focus();
        ordrsGridView.initView();

    });
    function executeCallback() {
        if (selectGridValidation(ordrsGridView.target)) return;
        modalStack.last().callback(ordrsGridView);
        modalStack.close();
    }
</script>
