<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=0.6, user-scalable=no">
<link rel="icon" href="/static/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-theme.min.css">
<link rel="stylesheet" href="/static/bootstrap/css/dashboard.css">
<link rel="stylesheet" href="/static/bootstrap/css/bootstrap-datepicker.css">
<link rel="stylesheet" href="/static/fontawesome/css/all.css">
<link rel="stylesheet" href="/static/css/ax5/ax5grid.css">
<link rel="stylesheet" href="/static/css/ax5/ax5mask.css">
<link rel="stylesheet" href="/static/css/ax5/ax5modal.css">
<link rel="stylesheet" href="/static/css/ax5/ax5toast.css">
<link rel="stylesheet" href="/static/css/ax5/ax5menu.css">
<link rel="stylesheet" href="/static/css/ax5/ax5calendar.css">
<link rel="stylesheet" href="/static/css/jstree/style.min.css">
<link rel="stylesheet" href="/static/css/ax5/ax5combobox.css">
<link rel="stylesheet" href="/static/css/gnb.css">
<link rel="stylesheet" href="/static/css/main.css">
<link rel="stylesheet" href="/static/css/sub.css">
<link rel="stylesheet" href="/static/css/common.css">
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <link rel="stylesheet" type="text/css" href="fontawesome-free-5.15.1-web/css/fontawesome.min.css">
<script src="/static/js/jquery-latest.min.js"></script>
<script src="/static/js/jquery.serializeObject.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="/static/bootstrap/js/bootstrap.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.min.js"></script>
<script src="/static/bootstrap/js/bootstrap-datepicker.ko.min.js"></script>
<script src="/static/js/moment/moment-with-locales.js"></script>
<script src="/static/js/jstree/jstree.min.js"></script>
<script src="/static/js/ax5/ax5core.min.js"></script>
<script src="/static/js/ax5/ax5grid.min.js"></script>
<script src="/static/js/ax5/ax5mask.min.js"></script>
<script src="/static/js/ax5/ax5modal.min.js"></script>
<script src="/static/js/ax5/ax5toast.min.js"></script>
<script src="/static/js/ax5/ax5calendar.min.js"></script>
<script src="/static/js/ax5/ax5picker.min.js"></script>
<script src="/static/js/ax5/ax5menu.min.js"></script>
<script src="/static/js/ax5/ax5formatter.min.js"></script>
<script src="/static/js/ax5/ax5combobox.min.js"></script>
<script src="/static/js/ax5/ax5grid-inline-editor.js"></script>
<script src="https://unpkg.com/exceljs/dist/exceljs.min.js"></script>
<script src="/static/js/global.js"></script>
<!-- <script src="/static/js/calLuna.js"></script> -->
	<script src="/static/js/LunarCalendar.js"></script>
	<script src="/static/js/CalendarLunar.js"></script>
	<script src="/static/js/workingDayCalc.js"></script>
	<script src="/static/js/korean-lunar-calendar.min.js"></script>
<!-- 	<script src="https://cdn.jsdelivr.net/npm/korean-lunar-calendar/dist/korean-lunar-calendar.min.js"></script> -->
<style>
        th.blue {
            background-color: transparent; /* Clear the background color */
            color: blue; /* Set the text color */
        }

        th.red {
            background-color: transparent; /* Clear the background color */
            color: red; /* Set the text color */
        }

        th, td {
            border: 1px solid black;
            padding: 2px;
            text-align: center;
        }

        th.cBlue, td.cBlue {
            border: 1px solid blue;
        }

        /* Additional styles for better visual */
        table {
            border-collapse: collapse;
        }

        /* Style for header row */
        thead tr:first-child th {
            border-bottom: 2px solid black;
        }


fieldset {
	padding: 10px;
   border: 5px solid blue;
}

 legend {
   padding: 10px;
   background: blue;
   color: cyan;  }





#black {
        display: flex; /* Use flexbox to arrange children horizontally */
    }
#red {
	background-color: red;
	width: 14px;
	height: 14px;
	border-radius: 7px;
}

#yellow {
	background-color: yellow;
	width: 14px;
	height: 14px;
	border-radius: 7px;
}

#green {
	background-color: green;
	width: 14px;
	height: 14px;
	border-radius: 7px;
}
    </style>
</head>
<body>
      <div class="contents no_bg">
	<!-- 콘텐츠 -->
		<div class="contents no_bg">
			<!-- 콘텐츠 타이틀 -->
			<div class="contents_tit" style="margin: 0px; width: 1600px; display: flex;">
			 <input id="reqDtFrom_S" name="reqDtFrom" value="2023-08-29" >
			 <input id="toWork" name="toWork" value="3">
			 <input id="yymmdd" name="yymmdd" >
             <a onclick="nextday();" style="height: 30px; line-height: 28px; width: 50px;">작업일 계산</a>
	             <div>일정</div><div id=red> </div>
	             <div> 품질</div><div id=green> </div>
	             <div> 업무부하</div><div id=yellow> </div>
	             <div> 소통</div><div id=green> </div>



				<div class="add_btn_small pdl10" style="margin: 0px; padding: 0px;">
					<a onclick="prevCalendar();" style="height: 30px; line-height: 28px; width: 50px;" authChk>이전달</a>
					<span id="calendarYM"></span>
					<a onclick="nextCalendar();" style="height: 30px; line-height: 28px; width: 50px;">다음달</a>
				</div>
			</div>
			<table id="calendar">
			</table>
		</div>
	</div>

	<div class="contents">
      <div class="ax5_grid">
        <div data-ax5grid="first-grid" data-ax5grid-config="{}" style="height: 480px; width: 100%"></div>
      </div>
    </div>
<input type="date" step="7" value="2024-07-03">
<fieldset>

<legend>Choose your interests</legend>
	<div id="COBGB1-checkboxContainer">
	</div>
</fieldset>

<div id="COBTP-radioButtonContainer"></div>

  <script>
	function createCheckBox(groupName) {
		var param = {
				"userDept" : 'GUN30'
		};
		postAjaxSync("/admin/cm/cm05/selectCheckboxList", param , null,  function(data){
			var codeList = data.childCodeList;
			   $.each(codeList, function (index, item){
					const iHtml = '<td style="text-align:left;height:20px;">'+
								  '<input type="checkbox" id="' + item.codeId +
													 '" name="' + item.codeKind +
													'" value="' + item.codeId +
											   '" data-label="' + item.codeNm +
								     '" onchange="fnc(this)"> ' + item.codeNm + '</td>';
					$('#'+groupName+'-checkboxContainer').append(iHtml);
				});
		})
	}
	createCheckBox('COBGB1');

	function createRadioOptions(groupName) {
		var param = {
				"codeKind" : groupName
		};
		postAjaxSync("/admin/cm/cm05/selectChildCodeList", param , null,  function(data){
			const codeList = data.childCodeList;
			codeList.forEach(item => {
				const iHtml = '<input type="radio" id="' + item.codeId +
				                              '" name="' + item.codeKind +
				                             '" value="' + item.codeId +
				                        '" data-label="' + item.codeNm +
				              '" onchange="fnc(this)"> ' + item.codeNm + '<br>';
				$('#' + groupName + '-radioButtonContainer').append(iHtml);
			});
		})
	}
	createRadioOptions('COBTP');

	function fnc(thisButton) {
		const inputType = $(thisButton).attr('type');

		if (inputType === 'radio') {
			console.log(thisButton.dataset.label + ' radio button. = ' + $("input[name='COBTP']:checked").val() + ' 선택');
		} else if (inputType === 'checkbox') {
			console.log(thisButton.dataset.label + ' checkbox. = ' + thisButton.value + '의 상태는 ' + thisButton.checked);
		}
		if (thisButton.id == 'COBTP99') {
			$("#COBGB9999").prop("checked", true);
		} else {
			$("#COBGB9999").prop("checked", false);
		}



// 		$("#COBGB2201").prop("checked", true);
// 		$("#COBGB2201").prop("checked", false);
// 		$("#COBTP08").prop("checked", true);
// 		$("#COBTP08").prop("checked", false);
	}



	var gridView = {
			initView : function() {
	  			this.target = new ax5.ui.grid();
	  			this.target.setConfig({
	  		    	showRowSelector: true,
	  		    	multipleSelect: true,
	  		    	sortable: false,
	  		        target: $('[data-ax5grid="first-grid"]'),
	  		        header: {
	  		        	align: "center",
	  		        	selector: true
	  		        },
	  		        body: {
	  		        	columnHeight: 40,
	  		        	 onClick: function () {
	  		                this.self.select(this.dindex);
	  		            },
	  		            onDBLClick: function () {
	  		            },
	  		        },

// 					page : {
// 						navigationItemCount : 9,
// 						height : 30,
// 						display : true,
// 						firstIcon : '<i class="fa fa-step-backward" aria-hidden="true"></i>',
// 						prevIcon : '<i class="fa fa-caret-left" aria-hidden="true"></i>',
// 						nextIcon : '<i class="fa fa-caret-right" aria-hidden="true"></i>',
// 						lastIcon : '<i class="fa fa-step-forward" aria-hidden="true"></i>',
// 						onChange : function() {
// 							gridView.setData(this.page.selectPage);
// 						}
// 					},

			    	columns : [
							 {key: "id",		label: "ID", 	    	width: 60,		align: "center",	hidden:true}
							,{key: "name", 		label: "성명", 			width: 80,		align: "center"  }
							,{key: "levelNm", 	label: "직위", 			width: 60,		align: "center"  }
	    	            ]

				});
	        	return this;
	        },

			setData : function(_pageNo) {
		    firstGrid = this.target;
				if (inputValidation($('input[required]'))) {
					var paramObj = {};
					$.each($('#main_area [data-search]'), function(idx, elem){
						paramObj[$(elem).data("search")] = $(elem).val();
					});
					paramObj["pageNo"] = _pageNo + 1;

					postAjax("/admin/cm/cm06/selectUserList", paramObj, null, function(data){
					var list = data.userList;
	  					firstGrid.setData({
	  						list : list,
	  						page : {
// 	  							currentPage   : _pageNo,
// 	  							pageSize      : data.paginationInfo.pageSize,
// 	  							totalElements : data.paginationInfo.totalRecordCount,
// 	  							totalPages    : data.paginationInfo.totalPageCount
	  						}
	  					});
	  				});
	  			}
	  		}
	  	}
debugger;
	$(document).ready(function() {
		gridView.initView();
		buildCalendar();
		gridView.setData();
		$('.red').show();

        // When the mouse enters the red light
        $('.red').mouseenter(function() {
            // Show all lights
            $('.light').show();
        });

        // When the mouse leaves the traffic light
        $('.traffic-light').mouseleave(function() {
            // Hide all lights
            $('.light').hide();
        });

        // When a light is clicked
        $('.light').click(function() {
            // Hide all lights
            $('.light').hide();

            // Show the selected light
            $(this).show();
        });
		var requestData = {};
// 		postAjax("/your-api-endpoint", requestData, null, function(data){
// 		        console.log("API Response:", data);
// 		});
// 		postAjax("/endpoint", requestData, null, function(data){
// 		        console.log("API Response:", data);
// 		});

		$.ajax({
            url: "/endPointApiInfomation", // Replace with the actual endpoint URL
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify(requestData),
    	    beforeSend: function (request) {
                request.setRequestHeader("Authorization", authorizationToken);
            },
            success: function(response) {
                // Handle the successful response from the server
                console.log("Server Response:", response);
                $('#clientIp').text( '사용자 IP는 ' + response.clientIp +' 입니다.');
            },
            error: function(xhr, status, error) {
                // Handle errors
                console.error("Error:", error);
            }
        });


	});

  var today = new Date();

  function setToday(year, month){
  	today = new Date(year, month-1, 1);
  }

  //today 에 Date객체를 넣어줌 //ex)5일
	function prevCalendar() {
		gridView.initView();
		today = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate()); // month 를 조정해 해당 월을 변경함
		buildCalendar(); // 달력을 새로 그려준다.
		gridView.setData();
	}

	function nextCalendar() {
		gridView.initView();
		today = new Date(today.getFullYear(), today.getMonth() + 1, today.getDate());
		buildCalendar();
		gridView.setData();
	}

  function buildCalendar() {// 현재 달fur
  	var week = [ '일', '월', '화', '수', '목', '금', '토', '일'];
  	var nMonth = new Date(today.getFullYear(), today.getMonth(), 1); // 이번 달의 첫째 날
  	var lastDate = new Date(today.getFullYear(), today.getMonth() + 1, 0); // 이번 달의 마지막 날
  	var tblCalendar = $("#calendar"); // 테이블 달력을 만들 테이블
  	var tblCalendarYM = $("#calendarYM"); // yyyy년 m월 출력할 곳
  	tblCalendarYM.html(today.getFullYear() + "년 " + (today.getMonth() + 1) + "월");// yyyy년 m월 출력

  	var dayWeek = week[nMonth.getDay()]; //이번달 첫째날의 요일
  	var year = today.getFullYear();
  	var lastYear = 0;

  	// year와 lastyear가 동일할경우 setLunaToSolar를 계산하지 않음;
  	var isSame = false;
  	if (year == lastYear)
  		isSame = true;
  	//1949~1959년까지 식목일 공휴일지정, 1961~2005년까지 공휴일지정
  	//2006년까지는 0717(체헌절) 공휴일, 0405(식목일)
  	//1949~1990년까지 1009(한글날) 1990년폐지됐다가 2014년부터 공휴일 시행 상기내용은 일자계산시 반영 되지 않음
  	var solarHolidays = [ "0101", "0301", "0505", "0606", "0815", "1003", "1009", "1225" ]; //양력휴일
  	var lunarHolidays = [ "0101", "0102", "0408", "0814", "0815", "0816" ]; //음력휴일, 설전날도 넣어야함.

  	//대체공휴일 입력구간. 임시휴일이나 대체공휴일이 있을 경우 배열에 넣으면됨. yyyymmdd 입력
	//20241001 임시 공휴일-->당사는 20241004일로 변경 근무 진행함
  	var alternativeHolidays = [   "20140910", "20150929", "20160210", "20170130", "20171006",
		"20180507", "20180926", "20190506", "20200127", "20210816",
		"20211004", "20211011", "20220912", "20221010", "20230124",
		"20230529", "20231002", "20240212", "20240410", "20240501",
		"20240506", "20240729", "20240730", "20240731", "20241004",
		"20250127", "20250303", "20250501", "20250506", "20250603", 
		"20250730", "20250731", "20250801",
		"20251008", "20260302", "20260525",
		"20260817", "20261005", "20270209", "20270816", "20271004",
		"20271011", "20271227", "20281005", "20290507", "20290521",
		"20290924", "20300205", "20300506", "20310303", "20320517",
		"20320816", "20320921", "20321004", "20321011", "20321227",
		"20330202", "20331010", "20331226", "20340221", "20350507",
		"20350918", "20360130", "20360303", "20360506", "20361006",
		"20361007", "20370217", "20370302", "20370817", "20371005",
		"20380816", "20380915", "20381004", "20381011", "20381227",
		"20390126", "20390502", "20391004", "20391005", "20391010",
		"20391226", "20400214", "20400507", "20410506", "20420303",
		"20420930", "20430302", "20430518", "20430817", "20431005",
		"20440201", "20440506", "20441010", "20441226", "20450927",
		"20460507", "20460514", "20460917", "20470128", "20470506",
		"20471007", "20480302", "20480817", "20481005", "20490510",
		"20490816", "20490913", "20491004", "20491011", "20491227"];

  	var setLunaToSolar = []; //당년도의 음력을 양력으로

	//휴일관리 테이블에서 불러오기 --> 휴일관리는 TB_CM12M01에서 등록 관리로 변경함.
// 	var paramObj = {
// 		"calDivCd": "A",	//calDivCd : A(All), S(solarHolidays), L(lunarHolidays), E(alternativeHolidays)
// 	};
// 	postAjaxSync("/admin/cm/cm12/selectSolarLunarEventHolidaysList", paramObj, null, function(data){
// 		let temp = data.resultSolar;	//양력휴일
// 		solarHolidays = temp.map(item => item.calYmd.trim());
		
// 		temp = data.resultLumar;	//음력휴일, 설전날은 계산헤서 넣음.
// 		lunarHolidays = temp.map(item => item.calYmd.trim());
		
// 		temp = data.resultEnent;	//대체공휴일 입력구간. 임시휴일
// 		alternativeHolidays = temp.map(item => item.calYmd.trim());
// 	});
	
  	//테이블에 기존값이 존재할 경우 해당 값을 다 날림.
	if ($('#calendar').length > 0) {
	    $('#calendar thead').empty(); // Delete all content inside <thead>
	    $('#calendar tbody').empty(); // Delete all content inside <tbody>
	}

    if (tblCalendar.find("thead").length === 0) {
        tblCalendar.append("<thead></thead>");
    }

    var header = tblCalendar.find("thead")[0];
  	var hrow = null;
  	hrow = header.insertRow();
  	var headerCell = document.createElement("th");
  	headerCell.innerHTML = "소속(팀)";
  	headerCell.rowSpan = 2;
  	hrow.appendChild(headerCell);

  	headerCell = document.createElement("th");
  	headerCell.innerHTML = "성명";
  	headerCell.rowSpan = 2;
  	hrow.appendChild(headerCell);

  	var workDay = 0;
  	var cnt = nMonth.getDay();

  	//setLunaToSolar
  	///////////////////////////////////////////////////
  	if (!isSame) { //당년도의 음력휴일 양력으로 변환
  		for (i = 0; i < lunarHolidays.length; i++) {
  			var solar = Resut(year + "" + lunarHolidays[i]);
  			if (i == 0) {
  				//var cDate = new Date();
  				var cMonth = solar.substring(0, 2);
  				var cDay = solar.substring(2, 4);
  				var cDate = new Date(parseInt(cMonth) + "/"
  				+ parseInt(cDay) + "/" + year);
  				cDate.setDate(cDate.getDate() - 1); // 하루전

  				/* cDate.setMonth(parseInt(cMonth-1)); // 월 설정
  				cDate.setDate(parseInt(cDay)); //일 설정
  				//cDate.setDate(-1); //하루전날

  				//var sdate = cDate.setDate(cDate.getDate()-1); */
  				var sm = (cDate.getMonth() + 1);
  				if (sm < 10)
  					sm = "0" + sm;
  				var sd = (cDate.getDate());
  				if (sd < 10)
  					sd = "0" + sd;
  				sDate = sm + "" + sd;
  				setLunaToSolar.push(sDate);
  			}
  			setLunaToSolar.push(solar);
  		}
  		lastYear = today.getFullYear();
  	}

  	var year1 = today.getFullYear();
  	var month1 = (today.getMonth() + 1);
  	//console.log(dayWeek);
  	if ((today.getMonth() + 1) < 10) {
  		month1 = "0" + (today.getMonth() + 1);
  	}

  	var list = [];

  	for (i = 0; i < solarHolidays.length; i++) { // 양력휴일 넣음
  		if (solarHolidays[i].substring(0, 2) == month1) {
  			list.push(solarHolidays[i].substring(2, 4)); //휴일이 있을경우 list에 넣는다.
  		}
  	}

  	for (i = 0; i < setLunaToSolar.length; i++) { // 음력휴일 넣음
  		if (setLunaToSolar[i].substring(0, 2) == month1) {
  			list.push(setLunaToSolar[i].substring(2, 4)); //휴일이 있을경우 list에 넣는다.
  		}
  	}

  	for (i = 0; i < alternativeHolidays.length; i++) { //해당년도의 임시, 대체공휴일 추가
  		if (alternativeHolidays[i].substring(0, 4) == year) {//공휴년도가 해당년도와 일치할경우
  			if (alternativeHolidays[i].substring(4, 6) == month1) { //공휴년도가 해당월과 일치할경우
  				list.push(alternativeHolidays[i].substring(6, 8)); //일치하는 휴일이 있을경우 list에 넣는다.
  			}
  		}
  	}
    var tempWeek = "";
  	for (i = 0; i < lastDate.getDate(); i++) {
  		var pass = false;
  		headerCell = document.createElement("th");
  		if (list.length > 0) { //휴일이 있을경우
  			for (j = 0; j < list.length; j++) {
  				if (list[j] == (i + 1)) {
  					headerCell.className = "red"; //공휴일은 빨간날로
  					pass = true;
  					break; //공휴일을 그렸으면 토,일 검사를 하지 않음.
  				}
  			}
  		}
  		if (!pass) {
  			if (cnt % 7 == 6) {
  				headerCell.className = "blue"; // 토요일은 파란색으로
  			}
  			if (cnt % 7 == 0) {
  				headerCell.className = "red"; // 일요일은 빨간색으로
  			}
  		}
		tempWeek = week[(nMonth.getDay() + i) % 7];
  		headerCell.innerHTML = tempWeek;
  		hrow.appendChild(headerCell);

  		gridView.target.addColumn({label: tempWeek,
  			columns:[{key: "d"+(i+1), label: i+1, width: 40, align: "center"}]});
  		cnt++;
  	}

	gridView.target.addColumn({key: "tot", label: "합계", width: 80, align: "center"});
	gridView.target.addColumn({key: "rmk", label: "비고", width: 120, align: "center"});


  	headerCell = document.createElement("th");
  	headerCell.innerHTML = "비고";
  	headerCell.className = "cBlue";
  	headerCell.rowSpan = 2;
  	hrow.appendChild(headerCell);

  	headerCell = document.createElement("th");
  	headerCell.innerHTML = "기타";
  	headerCell.className = "cBlue";
  	headerCell.rowSpan = 2;
  	hrow.appendChild(headerCell);

  	hrow = calendar.insertRow();

  	cnt = nMonth.getDay();
  	for (i = 1; i <= lastDate.getDate(); i++) { //1일부터 그달의 마지막일까지 그려준다.
  		var pass = false;
  		var isHoliday = false;
  		headerCell = document.createElement("th");

  		if (list.length > 0) { //휴일이 있을경우
  			for (j = 0; j < list.length; j++) {
  				if (list[j] == i) {
  					headerCell.className = "red";
  					pass = true;
  					isHoliday = true;
  					break;
  				}
  			}
  		}
  		if (!pass) {
  			if (cnt % 7 == 6) {
  				headerCell.className = "blue";
  				isHoliday = true;
  			}
  			if (cnt % 7 == 0) {
  				headerCell.className = "red";
  				isHoliday = true;
  			}
  		}
  		if (!isHoliday) {
  			workDay++;
  		}
  		headerCell.innerHTML = i;
  		hrow.appendChild(headerCell);
  		cnt++;
  	}
  }

//---------------------------------------------------------------------------------------------------

function nextday() {
	    const startDate = $('#reqDtFrom_S').val();
	    const duration = $('#toWork').val();
	    const calDate= calculateHoliday(startDate, duration);
	    const resultYMD = calDate.YMD;
	    $('#yymmdd').val(resultYMD);
	  }
  </script>
</body>
</html>
