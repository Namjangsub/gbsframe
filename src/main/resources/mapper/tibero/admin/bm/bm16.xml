<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.admin.bm.bm16.mapper.BM16Mapper">
	
	<select id="selectPrjctCount" resultType="int">
		SELECT count(*)
		  FROM TB_BM06M01 

         WHERE 1=1
            <if test="coCd !=null and !coCd.equals('')">
  	       AND CO_CD = #{coCd}
		</if>				     	         
		<if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')" >
		   AND ORDRS_DT  BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD') +1
		</if>				     	         


		
	</select>
	
	<select id="selectPrjctList" resultType="CamelMap">
		SELECT
			*
		FROM
		(
			SELECT
				ROWNUM AS RNUM, A.*
				
			FROM
			(	
				SELECT PRJCT_SEQ 
					 , CO_CD 
					 , FN_CM05M01_CD_TO_NM(CO_CD) CO_NM
					 , YYYYMM  
					 , INPEXP_CD 
					 , FN_CM05M01_CD_TO_NM(INPEXP_CD) INPEXP_NM
					 , NEW_PRDT_CD 
					 , PRJCT_CD 
					 , PRJCT_NM 
					 , EQP_NM 
					 , CAR_NM 
					 , EQP_QTY 
					 , CLNT_CD 
					 , CLNT_MNG_NM 
					 , ODR_CD 
					 , ODR_RMK 
					 , EPCT_AMT 
					 , ORDRS_PLAN_AMT 
					 , WINBD_CD
					 , WINBD_RMK 
					 , ORDRS_PLAN_DT 
					 , ORDRS_AMT 
					 , ORDRS_DT
					 , DUDT_PLAN_DT 
					 , SALES_MNG 
					 , PRJCT_RMK
					 , ETC_FIELD1
					 , ETC_FIELD2
					 , ETC_FIELD3
					 , CREAT_ID
					 , CREAT_PGM
					 , CREAT_DTTM
					 , UDT_ID
					 , UDT_PGM
					 , UDT_DTTM
					 , MAKR_CD
				  FROM TB_BM06M01 

		         WHERE 1=1
	             <if test="coCd !=null and !coCd.equals('')">
     	           AND CO_CD = #{coCd} 
				<if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')" >
				   AND ORDRS_DT  BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD') +1
				</if>				     	         
		      ORDER BY YYYYMM, INPEXP_NM
	            </if>
				) AS a
			) A
		WHERE  RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>
 
	<resultMap id="prjctInfoMap" type="CamelMap">
		<collection select="selectItemlList" property="ITEM_LIST" column="{prjctSeq=PRJCT_SEQ}" ofType="CamelMap"/>
		<collection select="selectFileList" property="FILE_LIST" column="{fileTrgtKey=PRJCT_SEQ}" ofType="CamelMap"/>
	</resultMap>

	<select id="selectPrjctInfo" resultMap="prjctInfoMap">
				SELECT PRJCT_SEQ 
					 , CO_CD 
					 , FN_CM05M01_CD_TO_NM(CO_CD) CO_NM
					 , YYYYMM  
					 , INPEXP_CD 
					 , FN_CM05M01_CD_TO_NM(INPEXP_CD) INPEXP_NM
					 , NEW_PRDT_CD 
					 , PRJCT_CD 
					 , PRJCT_NM 
					 , EQP_NM 
					 , CAR_NM 
					 , EQP_QTY 
					 , CLNT_CD 
					 , CLNT_MNG_NM 
					 , ODR_CD 
					 , ODR_RMK 
					 , EPCT_AMT 
					 , ORDRS_PLAN_AMT 
					 , WINBD_CD
					 , WINBD_RMK 
					 , ORDRS_PLAN_DT 
					 , ORDRS_AMT 
					 , ORDRS_DT
					 , DUDT_PLAN_DT 
					 , SALES_MNG 
					 , PRJCT_RMK
					 , ETC_FIELD1
					 , ETC_FIELD2
					 , ETC_FIELD3
					 , CREAT_ID
					 , CREAT_PGM
					 , CREAT_DTTM
					 , UDT_ID
					 , UDT_PGM
					 , UDT_DTTM
					 , MAKR_CD
		FROM 
			TB_BM06M01 T
		WHERE
			PRJCT_SEQ = #{prjctSeq}
	</select>	
	
	<select id="selectItemlList" resultType="CamelMap">	
		SELECT nvl2(b.PRJCT_PRDT_CD,'Y','N') IS_CHK, 
		 	   B.*, 
		 	   A.*
		  FROM  (SELECT * 
		           FROM TB_CM05M01 
		          WHERE CODE_KIND = 'ITEMLIST'
		        ) a LEFT OUTER join
		        (SELECT * 
		           FROM TB_BM06D01 
		          WHERE PRJCT_SEQ = #{prjctSeq}
		            AND PRJCT_PRDT_CD = #{prjctSeq}
		        ) b 
		       ON a. CODE_ID = b.PRJCT_ITEM_CD
	</select>
	
	<select id="selectFileList" resultType="CamelMap">
		SELECT * FROM TB_CM08M01 WHERE FILE_TRGT_TYP = 'TB_BM16M01' AND FILE_TRGT_KEY = #{fileTrgtKey}
	</select>      
	
</mapper>