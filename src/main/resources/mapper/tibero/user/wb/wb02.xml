<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.wb.wb02.mapper.WB02Mapper">

          <!-- WBS실적관리 메인화면 계획 조회 리스트 카운터  -->
          <select id="selectWbsRsltsPlanListCount" parameterType="Map" resultType="int">   
            SELECT COUNT(*) FROM (
                    SELECT ROWNUM AS RN, Z.*, 
                                   S.ORDRS_NO, -- 수주번호
                                   S.ORGN_SALES_CD, -- 원천 SALES CODE
                                   S.ORDRS_CLNT_CD, -- 고객사
                                   (SELECT T.CLNT_NM FROM TB_BM02M01 T WHERE T.CLNT_CD =S.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                                   S.CLNT_PJT, -- 고객사 PJT
                                   S.ORDRS_DTL_DIV20, -- 신작구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                                   S.PRDT_CD, -- 제품구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.PRDT_CD) AS PRDT_CD_NM,
                                   S.ITEM_DIV, -- 아이템구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ITEM_DIV) AS ITEM_DIV_NM,
                                   S.EQP_NM -- 설비명
                                   FROM (
                                    SELECT 
                                       X.FILE_TRGT_KEY,
                                       X.CO_CD, -- 회사코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
                                       X.SALES_CD,-- SALES_CODE
                                       X.WBS_PLAN_NO, -- WBS계획번호
                                       Y.LVL1, -- WBS 레벨 1
                                       Y.LVL2, -- WBS 레벨 2
                                       Y.LVL3, -- WBS 레벨 3
                                       Y.CODE_KIND, -- 계획항목분류
                                       Y.CODE_ID, -- 계획항목코드
                                       X.WBS_PLAN_CNTS, -- 주요내용
                                       TO_CHAR(X.WBS_PLAN_DT, 'YYYY-MM-DD') AS WBS_PLAN_DT, -- 작성일
                                       X.WBS_PLAN_ID, -- 작성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.WBS_PLAN_ID) AS WBS_PLAN_NM,
                                       X.WBS_PLAN_MNG_ID, -- 담당자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.WBS_PLAN_MNG_ID) AS WBS_PLAN_MNG_NM,
                                       TO_CHAR(X.WBS_PLANS_DT, 'YYYY-MM-DD') AS WBS_PLANS_DT, -- 시작일자
                                       TO_CHAR(X.WBS_PLANE_DT, 'YYYY-MM-DD') AS WBS_PLANE_DT, -- 종료일자
                                       X.WBS_PLAN_RMK, -- 비고
                                       X.WBS_PLAN_STS_CODE_ID, -- 계획상태코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_STS_CODE_ID) AS WBS_PLAN_STS_NM,
                                       X.DSGN_DIF_CODE_ID, -- 설계난이도코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.DSGN_DIF_CODE_ID) AS DSGN_DIF_CODE_NM,
                                       X.DSGN_PLAN_HOUR, -- 설계계획공수
                                       X.PRDCTN_DIF_CODE_ID, -- 생산난이도코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.PRDCTN_DIF_CODE_ID) AS PRDCTN_DIF_CODE_NM,
                                       X.PRDCTN_PLAN_HOUR, -- 생산계획공수
                                       X.WBS_PLAN_OS_YN, -- 계획외주코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_OS_YN) AS WBS_PLAN_OS_NM,
                                       X.CREAT_ID, -- 생성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,
                                       X.CREAT_PGM, -- 셍성프로그램ID
                                       TO_CHAR(CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM, -- 생성일시
                                       X.UDT_ID, -- 최종변경자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,
                                       X.UDT_PGM, -- 최종수정프로그램ID
                                       TO_CHAR(UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM,  -- 최종변경일시
                                       X.LOCK_YN,
                                       X.CLOSE_YN                                       
                                          FROM TB_WB01M01 X
                                           INNER JOIN (
                                                        SELECT 
                                                        CODE_KIND,
                                                        CODE_ID,
                                                        CODE_RPRC,
                                                        CODE_NM,
                                                        CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
                                                        CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
                                                        CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
                                                        LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CODE_NM, '>') PATH
                                                    FROM TB_CM05M01
                                                    START WITH CODE_KIND = 'WBSDIV'
                                                    CONNECT BY PRIOR CODE_ID  =  CODE_KIND ) Y
                                            ON X.WBS_PLAN_CODE_KIND = Y.CODE_KIND
                                            AND X.WBS_PLAN_CODE_ID = Y.CODE_ID     
                                     ORDER BY X.SALES_CD, X.WBS_PLAN_CODE_ID ASC) Z 
                         INNER JOIN (
                           SELECT  X.CO_CD, -- 회사코드
                                   X.ORDRS_NO, -- 수주번호
                                   X.SALES_CD, -- SALES CODE
                                   Y.ORGN_SALES_CD, -- 원천 SALES CODE
                                   Y.ORDRS_CLNT_CD, -- 고객사
                                   Y.CLNT_PJT, -- 고객사 PJT
                                   X.ORDRS_DTL_DIV20, -- 신작구분
                                   X.PRDT_CD, -- 제품구분
                                   X.ITEM_DIV, -- 아이템구분
                                   X.EQP_NM -- 설비명
                                   FROM TB_CR02D02 X
                            INNER JOIN TB_CR02M01 Y
                            ON X.CO_CD = Y.CO_CD
                            AND X.ORDRS_NO = Y.ORDRS_NO ) S
                          ON Z.CO_CD = S.CO_CD
                          AND Z.SALES_CD = S.SALES_CD 
                )                
             WHERE CO_CD LIKE '%${coCd}%'
              AND WBS_PLAN_DT BETWEEN '${wbsPlansDt}' AND '${wbsPlaneDt}'           
             <if test="salesCd != null and !salesCd.equals('')">
                AND SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
             </if>
             <if test="!clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
             </if>
             <if test="clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
             </if>
             <if test="!prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD LIKE '%${prdtDiv}%' <!--  제품구분 검색    -->               
             </if>
             
             <if test="prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD_NM LIKE '%${prdtDivNm}%' <!--  제품구분명 검색    -->               
             </if>
             
             <if test="prdtItem != null and !prdtItem.equals('')">
                AND ITEM_DIV LIKE '%${prdtItem}%'  <!--  아이템구분 검색    -->              
             </if> 
             <if test="wbsClntPjt != null and !wbsClntPjt.equals('')">
                AND CLNT_PJT LIKE '%${wbsClntPjt}%'  <!--  고객사 PJT 검색    -->              
             </if> 
             <if test="eqp_nm != null and !eqp_nm.equals('')">
                AND EQP_NM LIKE '%${eqp_nm}%'   <!--  설비명 검색    -->             
             </if>
             <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                AND WBS_PLAN_NO LIKE '%${wbsPlanNo}%'   <!--  관리번호 검색    -->             
             </if>
             <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
                 AND CODE_ID IN (
		              SELECT X.WBS_RSLTS_PLAN_CODE_ID
						 FROM TB_WB20M01 X
						 INNER JOIN TB_CM06M01 Y
						 ON X.TODO_ID = Y.ID
						 WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
						 <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
						    AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
						 </if>
						 <if test="salesCd != null and !salesCd.equals('')">
						    AND X.SALES_CD LIKE '%${salesCd}%'
						 </if>   
						    AND X.TODO_ID LIKE '%${salesMngId}%' )
			  </if>	 
			  <if test="salesMngId.equals('') and !salesMngNm.equals('')">
                 AND CODE_ID IN (
                      SELECT X.WBS_RSLTS_PLAN_CODE_ID
                         FROM TB_WB20M01 X
                         INNER JOIN TB_CM06M01 Y
                         ON X.TODO_ID = Y.ID
                         WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
                         <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                            AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
                         </if>
                         <if test="salesCd != null and !salesCd.equals('')">
                            AND X.SALES_CD LIKE '%${salesCd}%'
                         </if>   
                            AND Y.NAME LIKE '%${salesMngNm}%' )
              </if>  
			  
             </select>
          
          
          <!-- WBS실적관리 메인화면 계획 조회 리스트  -->
          <select id="selectWbsRsltsPlanList" parameterType="Map" resultType="camelMap">   
            SELECT * FROM (
                    SELECT ROWNUM AS RN, Z.*, 
                                   S.ORDRS_NO, -- 수주번호
                                   S.ORGN_SALES_CD, -- 원천 SALES CODE
                                   S.ORDRS_CLNT_CD, -- 고객사
                                   (SELECT T.CLNT_NM FROM TB_BM02M01 T WHERE T.CLNT_CD =S.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                                   S.CLNT_PJT, -- 고객사 PJT
                                   S.ORDRS_DTL_DIV20, -- 신작구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                                   S.PRDT_CD, -- 제품구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.PRDT_CD) AS PRDT_CD_NM,
                                   S.ITEM_DIV, -- 아이템구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ITEM_DIV) AS ITEM_DIV_NM,
                                   S.EQP_NM -- 설비명
                                   FROM (
                                    SELECT 
                                       X.FILE_TRGT_KEY,
                                       X.CO_CD, -- 회사코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
                                       X.SALES_CD,-- SALES_CODE
                                       X.WBS_PLAN_NO, -- WBS계획번호
                                       Y.LVL1, -- WBS 레벨 1
                                       Y.LVL2, -- WBS 레벨 2
                                       Y.LVL3, -- WBS 레벨 3
                                       Y.CODE_KIND, -- 계획항목분류
                                       Y.CODE_ID, -- 계획항목코드
                                       X.WBS_PLAN_CNTS, -- 주요내용
                                       TO_CHAR(X.WBS_PLAN_DT, 'YYYY-MM-DD') AS WBS_PLAN_DT, -- 작성일
                                       X.WBS_PLAN_ID, -- 작성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.WBS_PLAN_ID) AS WBS_PLAN_NM,
                                       X.WBS_PLAN_MNG_ID, -- 담당자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.WBS_PLAN_MNG_ID) AS WBS_PLAN_MNG_NM,
                                       TO_CHAR(X.WBS_PLANS_DT, 'YYYY-MM-DD') AS WBS_PLANS_DT, -- 시작일자
                                       TO_CHAR(X.WBS_PLANE_DT, 'YYYY-MM-DD') AS WBS_PLANE_DT, -- 종료일자
                                       X.WBS_PLAN_RMK, -- 비고
                                       X.WBS_PLAN_STS_CODE_ID, -- 계획상태코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_STS_CODE_ID) AS WBS_PLAN_STS_NM,
                                       X.DSGN_DIF_CODE_ID, -- 설계난이도코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.DSGN_DIF_CODE_ID) AS DSGN_DIF_CODE_NM,
                                       X.DSGN_PLAN_HOUR, -- 설계계획공수
                                       X.PRDCTN_DIF_CODE_ID, -- 생산난이도코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.PRDCTN_DIF_CODE_ID) AS PRDCTN_DIF_CODE_NM,
                                       X.PRDCTN_PLAN_HOUR, -- 생산계획공수
                                       X.WBS_PLAN_OS_YN, -- 계획외주코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_OS_YN) AS WBS_PLAN_OS_NM,
                                       X.CREAT_ID, -- 생성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,
                                       X.CREAT_PGM, -- 셍성프로그램ID
                                       TO_CHAR(CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM, -- 생성일시
                                       X.UDT_ID, -- 최종변경자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,
                                       X.UDT_PGM, -- 최종수정프로그램ID
                                       TO_CHAR(UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM,  -- 최종변경일시
                                       X.LOCK_YN,
                                       X.CLOSE_YN                                       
                                          FROM TB_WB01M01 X
                                           INNER JOIN (
                                                        SELECT 
                                                        CODE_KIND,
                                                        CODE_ID,
                                                        CODE_RPRC,
                                                        CODE_NM,
                                                        CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
                                                        CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
                                                        CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
                                                        LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CODE_NM, '>') PATH
                                                    FROM TB_CM05M01
                                                    START WITH CODE_KIND = 'WBSDIV'
                                                    CONNECT BY PRIOR CODE_ID  =  CODE_KIND ) Y
                                            ON X.WBS_PLAN_CODE_KIND = Y.CODE_KIND
                                            AND X.WBS_PLAN_CODE_ID = Y.CODE_ID     
                                     ORDER BY X.SALES_CD, X.WBS_PLAN_CODE_ID ASC) Z 
                         INNER JOIN (
                           SELECT  X.CO_CD, -- 회사코드
                                   X.ORDRS_NO, -- 수주번호
                                   X.SALES_CD, -- SALES CODE
                                   Y.ORGN_SALES_CD, -- 원천 SALES CODE
                                   Y.ORDRS_CLNT_CD, -- 고객사
                                   Y.CLNT_PJT, -- 고객사 PJT
                                   X.ORDRS_DTL_DIV20, -- 신작구분
                                   X.PRDT_CD, -- 제품구분
                                   X.ITEM_DIV, -- 아이템구분
                                   X.EQP_NM -- 설비명
                                   FROM TB_CR02D02 X
                            INNER JOIN TB_CR02M01 Y
                            ON X.CO_CD = Y.CO_CD
                            AND X.ORDRS_NO = Y.ORDRS_NO ) S
                          ON Z.CO_CD = S.CO_CD
                          AND Z.SALES_CD = S.SALES_CD 
                )                
             WHERE CO_CD LIKE '%${coCd}%'
              AND WBS_PLAN_DT BETWEEN '${wbsPlansDt}' AND '${wbsPlaneDt}'           
             <if test="salesCd != null and !salesCd.equals('')">
                AND SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
             </if>
             <if test="!clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
             </if>
             <if test="clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
             </if>
             <if test="!prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD LIKE '%${prdtDiv}%' <!--  제품구분 검색    -->               
             </if>
             
             <if test="prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD_NM LIKE '%${prdtDivNm}%' <!--  제품구분명 검색    -->               
             </if>
             
             <if test="prdtItem != null and !prdtItem.equals('')">
                AND ITEM_DIV LIKE '%${prdtItem}%'  <!--  아이템구분 검색    -->              
             </if> 
             <if test="wbsClntPjt != null and !wbsClntPjt.equals('')">
                AND CLNT_PJT LIKE '%${wbsClntPjt}%'  <!--  고객사 PJT 검색    -->              
             </if> 
             <if test="eqp_nm != null and !eqp_nm.equals('')">
                AND EQP_NM LIKE '%${eqp_nm}%'   <!--  설비명 검색    -->             
             </if>
             <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                AND WBS_PLAN_NO LIKE '%${wbsPlanNo}%'   <!--  관리번호 검색    -->             
             </if>
             <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
                 AND CODE_ID IN (
                      SELECT X.WBS_RSLTS_PLAN_CODE_ID
                         FROM TB_WB20M01 X
                         INNER JOIN TB_CM06M01 Y
                         ON X.TODO_ID = Y.ID
                         WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
                         <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                            AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
                         </if>
                         <if test="salesCd != null and !salesCd.equals('')">
                            AND X.SALES_CD LIKE '%${salesCd}%'
                         </if>   
                            AND X.TODO_ID LIKE '%${salesMngId}%' )
              </if>  
              <if test="salesMngId.equals('') and !salesMngNm.equals('')">
                 AND CODE_ID IN (
                      SELECT X.WBS_RSLTS_PLAN_CODE_ID
                         FROM TB_WB20M01 X
                         INNER JOIN TB_CM06M01 Y
                         ON X.TODO_ID = Y.ID
                         WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
                         <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                            AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
                         </if>
                         <if test="salesCd != null and !salesCd.equals('')">
                            AND X.SALES_CD LIKE '%${salesCd}%'
                         </if>   
                            AND Y.NAME LIKE '%${salesMngNm}%' )
              </if>  
              
               AND  RN BETWEEN ${firstIndex} AND ${lastIndex}
              
          </select>


          <!-- WBS실적관리 메인화면 계획 엑셀 조회 리스트  -->
          <select id="selectWbsRsltsPlanExcelList" parameterType="Map" resultType="camelMap">   
            SELECT * FROM (
                    SELECT ROWNUM AS RN, Z.*, 
                                   S.ORDRS_NO, -- 수주번호
                                   S.ORGN_SALES_CD, -- 원천 SALES CODE
                                   S.ORDRS_CLNT_CD, -- 고객사
                                   (SELECT T.CLNT_NM FROM TB_BM02M01 T WHERE T.CLNT_CD =S.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                                   S.CLNT_PJT, -- 고객사 PJT
                                   S.ORDRS_DTL_DIV20, -- 신작구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                                   S.PRDT_CD, -- 제품구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.PRDT_CD) AS PRDT_CD_NM,
                                   S.ITEM_DIV, -- 아이템구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ITEM_DIV) AS ITEM_DIV_NM,
                                   S.EQP_NM -- 설비명
                                   FROM (
                                    SELECT 
                                       X.FILE_TRGT_KEY,
                                       X.CO_CD, -- 회사코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
                                       X.SALES_CD,-- SALES_CODE
                                       X.WBS_PLAN_NO, -- WBS계획번호
                                       Y.LVL1, -- WBS 레벨 1
                                       Y.LVL2, -- WBS 레벨 2
                                       Y.LVL3, -- WBS 레벨 3
                                       Y.CODE_KIND, -- 계획항목분류
                                       Y.CODE_ID, -- 계획항목코드
                                       X.WBS_PLAN_CNTS, -- 주요내용
                                       TO_CHAR(X.WBS_PLAN_DT, 'YYYY-MM-DD') AS WBS_PLAN_DT, -- 작성일
                                       X.WBS_PLAN_ID, -- 작성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.WBS_PLAN_ID) AS WBS_PLAN_NM,
                                       X.WBS_PLAN_MNG_ID, -- 담당자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.WBS_PLAN_MNG_ID) AS WBS_PLAN_MNG_NM,
                                       TO_CHAR(X.WBS_PLANS_DT, 'YYYY-MM-DD') AS WBS_PLANS_DT, -- 시작일자
                                       TO_CHAR(X.WBS_PLANE_DT, 'YYYY-MM-DD') AS WBS_PLANE_DT, -- 종료일자
                                       X.WBS_PLAN_RMK, -- 비고
                                       X.WBS_PLAN_STS_CODE_ID, -- 계획상태코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_STS_CODE_ID) AS WBS_PLAN_STS_NM,
                                       X.DSGN_DIF_CODE_ID, -- 설계난이도코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.DSGN_DIF_CODE_ID) AS DSGN_DIF_CODE_NM,
                                       X.DSGN_PLAN_HOUR, -- 설계계획공수
                                       X.PRDCTN_DIF_CODE_ID, -- 생산난이도코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.PRDCTN_DIF_CODE_ID) AS PRDCTN_DIF_CODE_NM,
                                       X.PRDCTN_PLAN_HOUR, -- 생산계획공수
                                       X.WBS_PLAN_OS_YN, -- 계획외주코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_OS_YN) AS WBS_PLAN_OS_NM,
                                       X.CREAT_ID, -- 생성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,
                                       X.CREAT_PGM, -- 셍성프로그램ID
                                       TO_CHAR(CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM, -- 생성일시
                                       X.UDT_ID, -- 최종변경자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,
                                       X.UDT_PGM, -- 최종수정프로그램ID
                                       TO_CHAR(UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM,  -- 최종변경일시
                                       X.LOCK_YN,
                                       X.CLOSE_YN                                       
                                          FROM TB_WB01M01 X
                                           INNER JOIN (
                                                        SELECT 
                                                        CODE_KIND,
                                                        CODE_ID,
                                                        CODE_RPRC,
                                                        CODE_NM,
                                                        CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
                                                        CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
                                                        CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
                                                        LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CODE_NM, '>') PATH
                                                    FROM TB_CM05M01
                                                    START WITH CODE_KIND = 'WBSDIV'
                                                    CONNECT BY PRIOR CODE_ID  =  CODE_KIND ) Y
                                            ON X.WBS_PLAN_CODE_KIND = Y.CODE_KIND
                                            AND X.WBS_PLAN_CODE_ID = Y.CODE_ID     
                                     ORDER BY X.SALES_CD, X.WBS_PLAN_CODE_ID ASC) Z 
                         INNER JOIN (
                           SELECT  X.CO_CD, -- 회사코드
                                   X.ORDRS_NO, -- 수주번호
                                   X.SALES_CD, -- SALES CODE
                                   Y.ORGN_SALES_CD, -- 원천 SALES CODE
                                   Y.ORDRS_CLNT_CD, -- 고객사
                                   Y.CLNT_PJT, -- 고객사 PJT
                                   X.ORDRS_DTL_DIV20, -- 신작구분
                                   X.PRDT_CD, -- 제품구분
                                   X.ITEM_DIV, -- 아이템구분
                                   X.EQP_NM -- 설비명
                                   FROM TB_CR02D02 X
                            INNER JOIN TB_CR02M01 Y
                            ON X.CO_CD = Y.CO_CD
                            AND X.ORDRS_NO = Y.ORDRS_NO ) S
                          ON Z.CO_CD = S.CO_CD
                          AND Z.SALES_CD = S.SALES_CD 
                )                
             WHERE CO_CD LIKE '%${coCd}%'
              AND WBS_PLAN_DT BETWEEN '${wbsPlansDt}' AND '${wbsPlaneDt}'           
              <if test="salesCd != null and !salesCd.equals('')">
                AND SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
             </if>
             <if test="!clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
             </if>
             <if test="clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
             </if>
             <if test="!prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD LIKE '%${prdtDiv}%' <!--  제품구분 검색    -->               
             </if>
             
             <if test="prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD_NM LIKE '%${prdtDivNm}%' <!--  제품구분명 검색    -->               
             </if>
             
             <if test="prdtItem != null and !prdtItem.equals('')">
                AND ITEM_DIV LIKE '%${prdtItem}%'  <!--  아이템구분 검색    -->              
             </if> 
             <if test="wbsClntPjt != null and !wbsClntPjt.equals('')">
                AND CLNT_PJT LIKE '%${wbsClntPjt}%'  <!--  고객사 PJT 검색    -->              
             </if> 
             <if test="eqp_nm != null and !eqp_nm.equals('')">
                AND EQP_NM LIKE '%${eqp_nm}%'   <!--  설비명 검색    -->             
             </if>
             <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                AND WBS_PLAN_NO LIKE '%${wbsPlanNo}%'   <!--  관리번호 검색    -->             
             </if>
             <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
                 AND CODE_ID IN (
                      SELECT X.WBS_RSLTS_PLAN_CODE_ID
                         FROM TB_WB20M01 X
                         INNER JOIN TB_CM06M01 Y
                         ON X.TODO_ID = Y.ID
                         WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
                         <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                            AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
                         </if>
                         <if test="salesCd != null and !salesCd.equals('')">
                            AND X.SALES_CD LIKE '%${salesCd}%'
                         </if>   
                            AND X.TODO_ID LIKE '%${salesMngId}%' )
              </if>  
              <if test="salesMngId.equals('') and !salesMngNm.equals('')">
                 AND CODE_ID IN (
                      SELECT X.WBS_RSLTS_PLAN_CODE_ID
                         FROM TB_WB20M01 X
                         INNER JOIN TB_CM06M01 Y
                         ON X.TODO_ID = Y.ID
                         WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
                         <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                            AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
                         </if>
                         <if test="salesCd != null and !salesCd.equals('')">
                            AND X.SALES_CD LIKE '%${salesCd}%'
                         </if>   
                            AND Y.NAME LIKE '%${salesMngNm}%' )
              </if>  
          </select>

           <!--   -->




          <!-- 실적 마스터 정보 조회  -->
          <select id="selectWbsRsltsMasterList" parameterType="Map" resultType="camelMap">
                SELECT  FILE_TRGT_KEY, 
		                CO_CD ,
		                WBS_PLAN_NO,
		                WBS_PLAN_CODE_KIND,
		                WBS_PLAN_CODE_ID ,
		                SALES_CD ,
		                TO_CHAR(WBS_RSLTS_DT, 'YYYY-MM-DD') AS WBS_RSLTS_DT, 
		                WBS_RSLTS_ID , 
		                WBS_RSLTS_RATE, 
		                WBS_PLAN_MH  ,
		                WBS_RSLTS_MH ,
		                WBS_RSLTS_CNTS,  
		                TO_CHAR(WBS_RSLTSS_DT, 'YYYY-MM-DD') AS  WBS_RSLTSS_DT ,
		                TO_CHAR(WBS_RSLTSE_DT, 'YYYY-MM-DD') AS  WBS_RSLTSE_DT ,
		                WBS_RSLTS_RMK ,
		                LOCK_YN ,
		                CLOSE_YN,  
		                CREAT_ID ,
		                CREAT_DTTM,
		                UDT_ID,
		                UDT_DTTM
		                FROM TB_WB02M01 X 
		                WHERE CO_CD =  '${coCd}' 
		                      AND WBS_PLAN_CODE_KIND =  '${codeKind}'  
		                      AND WBS_PLAN_CODE_ID = '${codeId}' 
		                      AND SALES_CD ='${salesCd}' 

          </select>
          
           <!-- 실적 상세  정보 조회  -->
          <select id="selectWbsRsltsDetailList" parameterType="Map" resultType="camelMap">
                SELECT  ROWNUM AS RN,
                        X.CO_CD, 
					    X.WBS_PLAN_NO  ,
					    X.WBS_PLAN_CODE_KIND ,
					    X.WBS_PLAN_CODE_ID ,
					    WBS_RSLTS_SEQ ,
					    X.WBS_RSLTS_RATE, 
					    X.WBS_ASS_RATE ,
					    (X.WBS_RSLTS_RATE * (X.WBS_ASS_RATE/100)) AS WBS_ASS_RATE_VAL,					   
					    X.WBS_RSLTS_CNTS ,
					    X.WBS_PLAN_MH ,
					    X.WBS_RSLTS_MH ,
					    X.WBS_RSLTS_RMK ,
					    X.LOCK_YN ,
					    X.CLOSE_YN ,
					    X.CREAT_ID,
					    X.CREAT_DTTM,
					    X.UDT_ID,
					    X.UDT_DTTM
					    FROM TB_WB02D01 X
					    INNER JOIN TB_WB02M01 Y
					    ON X.CO_CD = Y.CO_CD  
                           AND X.WBS_PLAN_NO = Y.WBS_PLAN_NO   
                           AND X.WBS_PLAN_CODE_KIND = Y.WBS_PLAN_CODE_KIND 
                           AND X.WBS_PLAN_CODE_ID = Y.WBS_PLAN_CODE_ID
                        WHERE X.CO_CD =  '${coCd}' 
                              AND X.WBS_PLAN_CODE_KIND = '${codeKind}'  
                              AND X.WBS_PLAN_CODE_ID = '${codeId}' 
                              AND Y.SALES_CD = '${salesCd}' 
                        ORDER BY ROWNUM ASC      
  
          </select>
          
          <!-- 공유대상자 리스트 조회  -->          
          <select id="selectRsltsSharngList" parameterType="Map" resultType="camelMap">
               SELECT ROWNUM AS RN,
                      X.SALES_CD, 
                      X.WBS_RSLTS_PLAN_CODE_ID,
                      (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_RSLTS_PLAN_CODE_ID) AS WBS_RSLTS_PLAN_CODE_NM,
                      X.WBS_RSLTS_PLAN_NO,
                      X.WBS_RSLTS_CO_CD,
                      (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS WBS_RSLTS_CO_CD_NM,                      
                      Y.ID AS WBS_SHARNG_USER_ID, 
                      Y.EMP_NO,
                      Y.NAME,
                      Y.TEL_NO,
                      Y.EMAIL
                      FROM TB_WB20M01 X
                      INNER JOIN TB_CM06M01 Y
                      ON X.CO_CD = Y.CO_CD
                      AND X.TODO_ID = Y.ID
                      WHERE X.CO_CD = '${coCd}'
                      AND X.WBS_RSLTS_PLAN_CODE_ID = '${codeId}' 
                      AND X.SALES_CD = '${salesCd}'
                      AND X.TODO_DIV2_CODE_ID = 'TODODIV1020'
                      ORDER BY ROWNUM ASC
          </select>
          
          <!-- 결재대상자 리스트 조회  -->          
          <select id="selectRsltsApprovalList" parameterType="Map" resultType="camelMap">
               SELECT ROWNUM AS RN,
                      X.SALES_CD, 
                      X.WBS_RSLTS_PLAN_CODE_ID,
                      (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_RSLTS_PLAN_CODE_ID) AS WBS_RSLTS_PLAN_CODE_NM,
                      X.WBS_RSLTS_PLAN_NO, 
                      X.WBS_RSLTS_CO_CD,
                      (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS WBS_RSLTS_CO_CD_NM,                   
                      Y.ID AS WBS_SHARNG_USER_ID, 
                      Y.EMP_NO,
                      Y.NAME,
                      Y.TEL_NO,
                      Y.EMAIL
                      FROM TB_WB20M01 X
                      INNER JOIN TB_CM06M01 Y
                      ON X.CO_CD = Y.CO_CD
                      AND X.TODO_ID = Y.ID
                      WHERE X.CO_CD = '${coCd}'
                      AND X.WBS_RSLTS_PLAN_CODE_ID = '${codeId}' 
                      AND X.SALES_CD = '${salesCd}'
                      AND X.TODO_DIV2_CODE_ID = 'TODODIV2010'
                      ORDER BY ROWNUM ASC
          </select>
          
          <!-- 사용자 정보 조회, 20230614 cy.kim fax, office 등 추가  -->          
          <select id="selectRsltsMemberList" parameterType="Map" resultType="camelMap">
               SELECT X.CO_CD,
                      (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,                      
                      X.ID,
                      X.EMP_NO,
                      X.NAME,
                      X.TEL_NO,
                      X.EMAIL, 
                      X.FAX_NO, 
					  X.OFF_TEL_NO
                      FROM TB_CM06M01 X                      
                      WHERE X.CO_CD = '${coCd}'
                      AND X.ID = '${userId}' 
          </select>
          
          
          <!-- 공유, 결재선 조회  -->          
          <select id="selectApprovalList" parameterType="Map" resultType="camelMap">
             SELECT ROWNUM AS RN,
                   X.CO_CD,
                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
                   APP_NO,
                   APP_SEQ,
                   APP_DIV,
                   APP_LINE_NM,
                   APP_ID,
                   (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.APP_ID) AS APP_NM,
                   Y.NAME AS APP_NM,
                   X.USE_YN,
                   X.PG_PATH,
                   X.CREAT_ID,
                   (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,
                   X.CREAT_PGM,
                   X.CREAT_DTTM,
                   X.UDT_ID,
                   (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,
                   X.UDT_PGM ,
                   X.UDT_DTTM,         
                   Y.DEPT_ID,
                   (SELECT T.DEPT_NM FROM TB_CM04M01 T WHERE T.DEPT_ID = Y.DEPT_ID) AS DEPT_NM,
                    Y.LEVEL_CD,
                   (SELECT T.LEVEL_CD FROM TB_CM07M01 T WHERE T.LEVEL_CD =Y.LEVEL_CD) AS LEVEL_NM ,
                    Y.TEL_NO,
                    Y.OFF_TEL_NO,
                    Y.FAX_NO
                           FROM  TB_BM13M01 X
                           INNER JOIN TB_CM06M01 Y
                           ON X.CO_CD = Y.CO_CD
                           AND X.APP_ID = Y.ID             
                   ORDER BY ROWNUM ASC
          </select>
          
          <!-- 실적 등록을 위한 파일키 생성  -->     
          <select id="selectMaxTrgtKey" parameterType="Map" resultType="int">
               SELECT NVL(MAX(TO_NUMBER(FILE_TRGT_KEY)),0) + 1 FROM TB_WB02M01
          </select>
          
          <!-- WBS 실적 No Max값 가져오기  -->
          <select id="selectMaxWbsPlanNo" parameterType="Map" resultType="int">
              SELECT MAX(SUBSTR(WBS_PLAN_NO,4,4)) + 1  FROM TB_WB02M01 
                   WHERE SUBSTR(WBS_PLAN_NO,1,3) ='${year}' and CO_CD = '${coCd}'   
          </select>
        
           <!-- 실적 마스터 데이터 유무 체크  -->     
           <select id="selectWbsPlanChk" parameterType="Map" resultType="int">
                SELECT *
                  FROM TB_WB02M01 
                   WHERE CO_CD = '${coCd}'
                   AND SALES_CD = '${salesCd}'
                   AND WBS_PLAN_CODE_ID = '${codeId}'
          </select>
        
           <!--실적 마스터 테이블 등록 -->   
          <insert id="wbsRsltsMasterInsert" parameterType="Map">
                INSERT INTO TB_WB02M01
                (
                        FILE_TRGT_KEY,
					    CO_CD,
					    WBS_PLAN_NO,
					    WBS_PLAN_CODE_KIND,
					    WBS_PLAN_CODE_ID,
					    SALES_CD,
					    WBS_RSLTS_DT,
					    WBS_RSLTS_ID,
					    WBS_RSLTS_RATE,
					    WBS_PLAN_MH,
					    WBS_RSLTS_MH,
					    WBS_RSLTS_CNTS,
					    WBS_RSLTSS_DT,
					    WBS_RSLTSE_DT,
					    WBS_RSLTS_RMK,
					    LOCK_YN,
					    CLOSE_YN,
					    CREAT_ID,
					    CREAT_PGM,
					    CREAT_DTTM                 
                ) 
                VALUES
                (       
                        #{fileTrgtKey},
                        #{coCd},
                        #{wbsRsltsNo},
                        #{wbsPlanCodeKind},
                        #{wbsPlanCodeId},
                        #{salesCd},
                        #{wbsRsltsDt},
                        #{wbsRsltsId},
                        #{wbsRsltsRate},
                        #{wbsPlanMh},
                        #{wbsRsltsMh},
                        #{wbsRsltsCnts},
                        #{wbsRsltssDt},
                        #{wbsRsltseDt},
                        #{wbsRsltsRmk},
                        'N',
                        'N',
                        #{creatId},
                        #{creatPgm},
                        SYSDATE  
                )
                
         </insert>   
         
         <!--실적 상세 테이블 등록 -->   
          <insert id="wbsRsltsDetailInsert" parameterType="Map">
                INSERT INTO TB_WB02D01
                (
                        CO_CD,
					    WBS_PLAN_NO,
					    WBS_PLAN_CODE_KIND,
					    WBS_PLAN_CODE_ID,
					    WBS_RSLTS_SEQ, -- 순번
					    WBS_RSLTS_RATE, -- 진척율
					    WBS_ASS_RATE, -- 배부율(가중치)
					    WBS_RSLTS_CNTS, -- 실적내용
					    WBS_PLAN_MH, -- 계획공수
					    WBS_RSLTS_MH, -- 실투입공수
					    WBS_RSLTS_RMK, -- 비고
					    LOCK_YN,
					    CLOSE_YN,
					    CREAT_ID,
					    CREAT_PGM,
					    CREAT_DTTM   
                ) 
                VALUES
                (       
                        #{coCd}, 
                        #{wbsRsltsNo},
                        #{wbsPlanCodeKind},
                        #{wbsPlanCodeId},
                        #{wbsRsltsSeq},
                        #{wbsRsltsRate},
                        #{wbsAssRate},
                        #{wbsRsltsCnts},
                        #{wbsPlanMh},
                        #{wbsRsltsMh},
                        #{wbsRsltsRmk},
                        'N',
                        'N',
                        #{creatId},
                        #{creatPgm},
                        SYSDATE  
                )
                
         </insert>   
         
        <!-- 공유 테이블 등록  -->
         <insert id="insertWbsSharngList" parameterType="Map">
                <selectKey keyProperty="toDoKey" resultType="Int" order="BEFORE">
                    SELECT NVL(MAX(TODO_KEY), 0) + 1 AS TODO_KEY FROM TB_WB20M01
                </selectKey>
                INSERT INTO TB_WB20M01
                (
                    TODO_KEY,
                    CO_CD,
                    TODO_DIV1_CODE_ID,
                    TODO_DIV2_CODE_ID,
                    TODO_ID,
                    SALES_CD,
                    PG_PATH,
                    WBS_RSLTS_FILE_TRGT_KEY,
                    WBS_RSLTS_CO_CD,
                    WBS_RSLTS_PLAN_NO,
                    WBS_RSLTS_PLAN_CODE_KIND,
                    WBS_RSLTS_PLAN_CODE_ID,
                    CREAT_ID,
                    CREAT_PGM,
                    CREAT_DTTM
                ) 
                VALUES
                (
                    #{toDoKey},
                    #{coCd},
                    #{todoDiv1CodeId},
                    #{todoDiv2CodeId},
                    #{wbsSharngUserId},
                    #{salesCd},
                    #{pgPath},
                    #{fileTrgtKey},
                    #{wbsRsltsCoCd},
                    #{wbsRsltsPlanNo},
                    #{wbsRsltsPlanCodeKind},
                    #{wbsRsltsPlanCodeId},
                    #{creatId},
                    #{creatPgm},
                    SYSDATE
                )
         </insert>
         
          <!-- 결재 테이블 등록  -->
         <insert id="insertWbsApprovalList" parameterType="Map">
                <selectKey keyProperty="toDoKey" resultType="Int" order="BEFORE">
                    SELECT NVL(MAX(TODO_KEY), 0) + 1 AS TODO_KEY FROM TB_WB20M01
                </selectKey>
                INSERT INTO TB_WB20M01
                (
                    TODO_KEY,
                    CO_CD,
                    TODO_DIV1_CODE_ID,
                    TODO_DIV2_CODE_ID,
                    TODO_ID,
                    SALES_CD,
                    PG_PATH,
                    WBS_RSLTS_FILE_TRGT_KEY,
                    WBS_RSLTS_CO_CD,
                    WBS_RSLTS_PLAN_NO,
                    WBS_RSLTS_PLAN_CODE_KIND,
                    WBS_RSLTS_PLAN_CODE_ID,
                    CREAT_ID,
                    CREAT_PGM,
                    CREAT_DTTM
                ) 
                VALUES
                (
                    #{toDoKey},
                    #{coCd},
                    #{todoDiv1CodeId},
                    #{todoDiv2CodeId},
                    #{wbsSharngUserId},
                    #{salesCd},
                    #{pgPath},
                    #{fileTrgtKey},
                    #{wbsRsltsCoCd},
                    #{wbsRsltsPlanNo},
                    #{wbsRsltsPlanCodeKind},
                    #{wbsRsltsPlanCodeId},
                    #{creatId},
                    #{creatPgm},
                    SYSDATE
                )
         </insert>
         
         
         <!--실적 마스트 테이블 수정 -->   
         <update id="wbsRsltsMasterUpdate" parameterType="Map">
                 UPDATE TB_WB02M01
                        SET
                        WBS_RSLTS_DT  =  #{wbsRsltsDt},
                        WBS_RSLTS_ID  =  #{wbsRsltsId},
                        WBS_RSLTS_RATE  =  #{wbsRsltsRate},
                        WBS_PLAN_MH   = #{wbsPlanMh},
                        WBS_RSLTS_MH   = #{wbsRsltsMh},
                        WBS_RSLTS_CNTS  =  #{wbsRsltsCnts},
                        WBS_RSLTSS_DT  =  #{wbsRsltssDt},
                        WBS_RSLTSE_DT  =  #{wbsRsltseDt},
                        WBS_RSLTS_RMK  =  #{wbsRsltsRmk},
                        UDT_ID  =  #{creatId},
                        UDT_PGM  =  #{creatPgm},
                        UDT_DTTM  =  SYSDATE       
                        WHERE FILE_TRGT_KEY = #{fileTrgtKey}
                             AND CO_CD  = #{coCd}
                             AND WBS_PLAN_NO  = #{wbsRsltsNo}
                             AND WBS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                             AND WBS_PLAN_CODE_ID  = #{wbsPlanCodeId}
                             AND SALES_CD  = #{salesCd}
         </update>   
         
         
        
         <!-- 실적상세 테이블 삭제 전 확인  -->  
         <select id="deleteWbsRsltsDetailChk" parameterType="Map" resultType="camelMap">
                SELECT * FROM TB_WB02D01
                   WHERE CO_CD  = #{coCd}
                         AND WBS_PLAN_NO  = #{wbsRsltsNo}
                         AND WBS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                         AND WBS_PLAN_CODE_ID  = #{wbsPlanCodeId}
         </select>
        
        
        <!-- 공유 테이블 삭제 전 확인 -->
         <select id="deleteWbsSharngListChk" parameterType="Map" resultType="camelMap">
               SELECT *  FROM TB_WB20M01
                   WHERE WBS_RSLTS_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND WBS_RSLTS_PLAN_NO  = #{wbsRsltsNo}
                         AND WBS_RSLTS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                         AND WBS_RSLTS_PLAN_CODE_ID  = #{wbsPlanCodeId}
                         AND TODO_DIV1_CODE_ID  = #{S_todoDiv1CodeId}
                         AND TODO_DIV2_CODE_ID  = #{S_todoDiv2CodeId}
        </select>
        
        <!-- 결재 테이블 삭제 전 확인  -->
        <select id="deleteWbsApprovalListChk" parameterType="Map" resultType="camelMap">
               SELECT *  FROM TB_WB20M01
                   WHERE WBS_RSLTS_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND WBS_RSLTS_PLAN_NO  = #{wbsRsltsNo}
                         AND WBS_RSLTS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                         AND WBS_RSLTS_PLAN_CODE_ID  = #{wbsPlanCodeId}
                         AND TODO_DIV1_CODE_ID  = #{A_todoDiv1CodeId}
                         AND TODO_DIV2_CODE_ID  = #{A_todoDiv2CodeId}
                         
        </select>
        
        
        
        
         <!-- 실적상세 테이블 삭제  -->  
         <delete id="deleteWbsRsltsDetail" parameterType="Map">
               DELETE FROM TB_WB02D01
                   WHERE CO_CD  = #{coCd}
                         AND WBS_PLAN_NO  = #{wbsRsltsNo}
                         AND WBS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                         AND WBS_PLAN_CODE_ID  = #{wbsPlanCodeId}
         </delete>
        
        
         <!-- 공유 테이블 삭제  -->
         <delete id="deleteWbsSharngList" parameterType="Map">
               DELETE FROM TB_WB20M01
                   WHERE WBS_RSLTS_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND WBS_RSLTS_PLAN_NO  = #{wbsRsltsNo}
                         AND WBS_RSLTS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                         AND WBS_RSLTS_PLAN_CODE_ID  = #{wbsPlanCodeId}
                         AND TODO_DIV1_CODE_ID  = #{S_todoDiv1CodeId}
                         AND TODO_DIV2_CODE_ID  = #{S_todoDiv2CodeId}
        </delete>
        
        <!-- 결재 테이블 삭제  -->
        <delete id="deleteWbsApprovalList" parameterType="Map">
               DELETE FROM TB_WB20M01
                   WHERE WBS_RSLTS_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND WBS_RSLTS_PLAN_NO  = #{wbsRsltsNo}
                         AND WBS_RSLTS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                         AND WBS_RSLTS_PLAN_CODE_ID  = #{wbsPlanCodeId}
                         AND TODO_DIV1_CODE_ID  = #{A_todoDiv1CodeId}
                         AND TODO_DIV2_CODE_ID  = #{A_todoDiv2CodeId}
                         
        </delete>
        
         
         
          <!-- WBS실적관리 메인화면 실적 조회 카운터  -->
          <select id="selectWbsRsltsResultCount" parameterType="Map" resultType="int">   
            SELECT COUNT(*) FROM (
                    SELECT ROWNUM AS RN, Z.*,
                                   S.ORDRS_NO, -- 수주번호
                                   S.ORGN_SALES_CD, -- 원천 SALES CODE
                                   S.ORDRS_CLNT_CD, -- 고객사
                                   (SELECT T.CLNT_NM FROM TB_BM02M01 T WHERE T.CLNT_CD =S.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                                   S.CLNT_PJT, -- 고객사 PJT
                                   S.ORDRS_DTL_DIV20, -- 신작구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                                   S.PRDT_CD, -- 제품구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.PRDT_CD) AS PRDT_CD_NM,
                                   S.ITEM_DIV, -- 아이템구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ITEM_DIV) AS ITEM_DIV_NM,
                                   S.EQP_NM -- 설비명
                                                                       
                                   FROM (
                                    SELECT 
                                       X.FILE_TRGT_KEY,
                                       X.CO_CD, -- 회사코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
                                       X.SALES_CD,-- SALES_CODE
                                       X.WBS_PLAN_NO, -- WBS계획번호
                                       Y.LVL1, -- WBS 레벨 1
                                       Y.LVL2, -- WBS 레벨 2
                                       Y.LVL3, -- WBS 레벨 3
                                       Y.CODE_KIND, -- 계획항목분류
                                       Y.CODE_ID, -- 계획항목코드
                                       X.WBS_RSLTS_CNTS, -- 주요내용
                                       TO_CHAR(X.WBS_RSLTS_DT, 'YYYY-MM-DD') AS WBS_RSLTS_DT, -- 작성일
                                       X.WBS_RSLTS_ID, -- 작성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.WBS_RSLTS_ID) AS WBS_RSLTS_NM,
                                       TO_CHAR(X.WBS_RSLTSS_DT, 'YYYY-MM-DD') AS WBS_RSLTSS_DT, -- 시작일자
                                       TO_CHAR(X.WBS_RSLTSE_DT, 'YYYY-MM-DD') AS WBS_RSLTSE_DT, -- 종료일자
                                       X.WBS_RSLTS_RMK, -- 비고
                                       X.LOCK_YN,
                                       X.CLOSE_YN,                             
                                       X.CREAT_ID, -- 생성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,
                                       X.CREAT_PGM, -- 셍성프로그램ID
                                       TO_CHAR(CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM, -- 생성일시
                                       X.UDT_ID, -- 최종변경자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,
                                       X.UDT_PGM, -- 최종수정프로그램ID
                                       TO_CHAR(UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM,  -- 최종변경일시
                                       X.LOCK_YN,
                                       X.CLOSE_YN                                       
                                          FROM TB_WB02M01 X
                                           INNER JOIN (
                                                        SELECT 
                                                        CODE_KIND,
                                                        CODE_ID,
                                                        CODE_RPRC,
                                                        CODE_NM,
                                                        CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
                                                        CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
                                                        CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
                                                        LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CODE_NM, '>') PATH
                                                    FROM TB_CM05M01
                                                    START WITH CODE_KIND = 'WBSDIV'
                                                    CONNECT BY PRIOR CODE_ID  =  CODE_KIND ) Y
                                            ON X.WBS_PLAN_CODE_KIND = Y.CODE_KIND
                                            AND X.WBS_PLAN_CODE_ID = Y.CODE_ID 

   
                                     ORDER BY X.SALES_CD, X.WBS_PLAN_CODE_ID ASC) Z 
                         INNER JOIN (
                           SELECT  X.CO_CD, -- 회사코드
                                   X.ORDRS_NO, -- 수주번호
                                   X.SALES_CD, -- SALES CODE
                                   Y.ORGN_SALES_CD, -- 원천 SALES CODE
                                   Y.ORDRS_CLNT_CD, -- 고객사
                                   Y.CLNT_PJT, -- 고객사 PJT
                                   X.ORDRS_DTL_DIV20, -- 신작구분
                                   X.PRDT_CD, -- 제품구분
                                   X.ITEM_DIV, -- 아이템구분
                                   X.EQP_NM -- 설비명
                                   FROM TB_CR02D02 X
                            INNER JOIN TB_CR02M01 Y
                            ON X.CO_CD = Y.CO_CD
                            AND X.ORDRS_NO = Y.ORDRS_NO ) S
                          ON Z.CO_CD = S.CO_CD
                          AND Z.SALES_CD = S.SALES_CD 
                )                
             WHERE CO_CD LIKE '%${coCd}%'
              AND WBS_RSLTS_DT BETWEEN '${wbsPlansDt}' AND '${wbsPlaneDt}'           
              <if test="salesCd != null and !salesCd.equals('')">
                AND SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
             </if>
             <if test="!clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
             </if>
             <if test="clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
             </if>
             <if test="!prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD LIKE '%${prdtDiv}%' <!--  제품구분 검색    -->               
             </if>
             
             <if test="prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD_NM LIKE '%${prdtDivNm}%' <!--  제품구분명 검색    -->               
             </if>
             
             <if test="prdtItem != null and !prdtItem.equals('')">
                AND ITEM_DIV LIKE '%${prdtItem}%'  <!--  아이템구분 검색    -->              
             </if> 
             <if test="wbsClntPjt != null and !wbsClntPjt.equals('')">
                AND CLNT_PJT LIKE '%${wbsClntPjt}%'  <!--  고객사 PJT 검색    -->              
             </if> 
             <if test="eqp_nm != null and !eqp_nm.equals('')">
                AND EQP_NM LIKE '%${eqp_nm}%'   <!--  설비명 검색    -->             
             </if>
             <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                AND WBS_PLAN_NO LIKE '%${wbsPlanNo}%'   <!--  관리번호 검색    -->             
             </if>
             <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
                 AND CODE_ID IN (
                      SELECT X.WBS_RSLTS_PLAN_CODE_ID
                         FROM TB_WB20M01 X
                         INNER JOIN TB_CM06M01 Y
                         ON X.TODO_ID = Y.ID
                         WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
                         <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                            AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
                         </if>
                         <if test="salesCd != null and !salesCd.equals('')">
                            AND X.SALES_CD LIKE '%${salesCd}%'
                         </if>   
                            AND X.TODO_ID LIKE '%${salesMngId}%' )
              </if>  
              <if test="salesMngId.equals('') and !salesMngNm.equals('')">
                 AND CODE_ID IN (
                      SELECT X.WBS_RSLTS_PLAN_CODE_ID
                         FROM TB_WB20M01 X
                         INNER JOIN TB_CM06M01 Y
                         ON X.TODO_ID = Y.ID
                         WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
                         <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                            AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
                         </if>
                         <if test="salesCd != null and !salesCd.equals('')">
                            AND X.SALES_CD LIKE '%${salesCd}%'
                         </if>   
                            AND Y.NAME LIKE '%${salesMngNm}%' )
              </if>  
          </select>
          
          
           <!-- WBS실적관리 메인화면 실적 조회 리스트  -->
          <select id="selectWbsRsltsResultList" parameterType="Map" resultType="camelMap">   
            SELECT * FROM (
                    SELECT ROWNUM AS RN, Z.*,
                                   S.ORDRS_NO, -- 수주번호
                                   S.ORGN_SALES_CD, -- 원천 SALES CODE
                                   S.ORDRS_CLNT_CD, -- 고객사
                                   (SELECT T.CLNT_NM FROM TB_BM02M01 T WHERE T.CLNT_CD =S.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                                   S.CLNT_PJT, -- 고객사 PJT
                                   S.ORDRS_DTL_DIV20, -- 신작구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                                   S.PRDT_CD, -- 제품구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.PRDT_CD) AS PRDT_CD_NM,
                                   S.ITEM_DIV, -- 아이템구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ITEM_DIV) AS ITEM_DIV_NM,
                                   S.EQP_NM -- 설비명                                    
                                   FROM (
                                    SELECT 
                                       X.FILE_TRGT_KEY,
                                       X.CO_CD, -- 회사코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
                                       X.SALES_CD,-- SALES_CODE
                                       X.WBS_PLAN_NO, -- WBS계획번호
                                       Y.LVL1, -- WBS 레벨 1
                                       Y.LVL2, -- WBS 레벨 2
                                       Y.LVL3, -- WBS 레벨 3
                                       Y.CODE_KIND, -- 계획항목분류
                                       Y.CODE_ID, -- 계획항목코드
                                       X.WBS_RSLTS_RATE,
                                       X.WBS_RSLTS_CNTS, -- 주요내용
                                       TO_CHAR(X.WBS_RSLTS_DT, 'YYYY-MM-DD') AS WBS_RSLTS_DT, -- 작성일
                                       X.WBS_RSLTS_ID, -- 작성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.WBS_RSLTS_ID) AS WBS_RSLTS_NM,
                                       TO_CHAR(X.WBS_RSLTSS_DT, 'YYYY-MM-DD') AS WBS_RSLTSS_DT, -- 시작일자
                                       TO_CHAR(X.WBS_RSLTSE_DT, 'YYYY-MM-DD') AS WBS_RSLTSE_DT, -- 종료일자
                                       X.WBS_RSLTS_RMK, -- 비고
                                       X.LOCK_YN,
                                       X.CLOSE_YN,                             
                                       X.CREAT_ID, -- 생성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,
                                       X.CREAT_PGM, -- 셍성프로그램ID
                                       TO_CHAR(CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM, -- 생성일시
                                       X.UDT_ID, -- 최종변경자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,
                                       X.UDT_PGM, -- 최종수정프로그램ID
                                       TO_CHAR(UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM,  -- 최종변경일시
                                       X.LOCK_YN,
                                       X.CLOSE_YN                                       
                                          FROM TB_WB02M01 X
                                           INNER JOIN (
                                                        SELECT 
                                                        CODE_KIND,
                                                        CODE_ID,
                                                        CODE_RPRC,
                                                        CODE_NM,
                                                        CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
                                                        CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
                                                        CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
                                                        LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CODE_NM, '>') PATH
                                                    FROM TB_CM05M01
                                                    START WITH CODE_KIND = 'WBSDIV'
                                                    CONNECT BY PRIOR CODE_ID  =  CODE_KIND ) Y
                                            ON X.WBS_PLAN_CODE_KIND = Y.CODE_KIND
                                            AND X.WBS_PLAN_CODE_ID = Y.CODE_ID     
                                     ORDER BY X.SALES_CD, X.WBS_PLAN_CODE_ID ASC) Z 
                         INNER JOIN (
                           SELECT  X.CO_CD, -- 회사코드
                                   X.ORDRS_NO, -- 수주번호
                                   X.SALES_CD, -- SALES CODE
                                   Y.ORGN_SALES_CD, -- 원천 SALES CODE
                                   Y.ORDRS_CLNT_CD, -- 고객사
                                   Y.CLNT_PJT, -- 고객사 PJT
                                   X.ORDRS_DTL_DIV20, -- 신작구분
                                   X.PRDT_CD, -- 제품구분
                                   X.ITEM_DIV, -- 아이템구분
                                   X.EQP_NM -- 설비명
                                   FROM TB_CR02D02 X
                            INNER JOIN TB_CR02M01 Y
                            ON X.CO_CD = Y.CO_CD
                            AND X.ORDRS_NO = Y.ORDRS_NO ) S
                          ON Z.CO_CD = S.CO_CD
                          AND Z.SALES_CD = S.SALES_CD 
                )                
             WHERE CO_CD LIKE '%${coCd}%'
              AND WBS_RSLTS_DT BETWEEN '${wbsPlansDt}' AND '${wbsPlaneDt}'           
             <if test="salesCd != null and !salesCd.equals('')">
                AND SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
             </if>
             <if test="!clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
             </if>
             <if test="clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
             </if>
             <if test="!prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD LIKE '%${prdtDiv}%' <!--  제품구분 검색    -->               
             </if>
             
             <if test="prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD_NM LIKE '%${prdtDivNm}%' <!--  제품구분명 검색    -->               
             </if>
             
             <if test="prdtItem != null and !prdtItem.equals('')">
                AND ITEM_DIV LIKE '%${prdtItem}%'  <!--  아이템구분 검색    -->              
             </if> 
             <if test="wbsClntPjt != null and !wbsClntPjt.equals('')">
                AND CLNT_PJT LIKE '%${wbsClntPjt}%'  <!--  고객사 PJT 검색    -->              
             </if> 
             <if test="eqp_nm != null and !eqp_nm.equals('')">
                AND EQP_NM LIKE '%${eqp_nm}%'   <!--  설비명 검색    -->             
             </if>
             <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                AND WBS_PLAN_NO LIKE '%${wbsPlanNo}%'   <!--  관리번호 검색    -->             
             </if>
             <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
                 AND CODE_ID IN (
                      SELECT X.WBS_RSLTS_PLAN_CODE_ID
                         FROM TB_WB20M01 X
                         INNER JOIN TB_CM06M01 Y
                         ON X.TODO_ID = Y.ID
                         WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
                         <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                            AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
                         </if>
                         <if test="salesCd != null and !salesCd.equals('')">
                            AND X.SALES_CD LIKE '%${salesCd}%'
                         </if>   
                            AND X.TODO_ID LIKE '%${salesMngId}%' )
              </if>  
              <if test="salesMngId.equals('') and !salesMngNm.equals('')">
                 AND CODE_ID IN (
                      SELECT X.WBS_RSLTS_PLAN_CODE_ID
                         FROM TB_WB20M01 X
                         INNER JOIN TB_CM06M01 Y
                         ON X.TODO_ID = Y.ID
                         WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
                         <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                            AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
                         </if>
                         <if test="salesCd != null and !salesCd.equals('')">
                            AND X.SALES_CD LIKE '%${salesCd}%'
                         </if>   
                            AND Y.NAME LIKE '%${salesMngNm}%' )
              </if>  
              
               AND  RN BETWEEN ${firstIndex} AND ${lastIndex}
          </select>
          
          
           <!-- WBS실적관리 메인화면 실적 엑셀 조회 리스트  -->
          <select id="selectWbsRsltsResultExcelList1" parameterType="Map" resultType="camelMap">   
            SELECT * FROM (
                    SELECT ROWNUM AS RN, Z.*,
                                   S.ORDRS_NO, -- 수주번호
                                   S.ORGN_SALES_CD, -- 원천 SALES CODE
                                   S.ORDRS_CLNT_CD, -- 고객사
                                   (SELECT T.CLNT_NM FROM TB_BM02M01 T WHERE T.CLNT_CD =S.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                                   S.CLNT_PJT, -- 고객사 PJT
                                   S.ORDRS_DTL_DIV20, -- 신작구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                                   S.PRDT_CD, -- 제품구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.PRDT_CD) AS PRDT_CD_NM,
                                   S.ITEM_DIV, -- 아이템구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ITEM_DIV) AS ITEM_DIV_NM,
                                   S.EQP_NM -- 설비명                                    
                                   FROM (
                                    SELECT 
                                       X.FILE_TRGT_KEY,
                                       X.CO_CD, -- 회사코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
                                       X.SALES_CD,-- SALES_CODE
                                       X.WBS_PLAN_NO, -- WBS계획번호
                                       Y.LVL1, -- WBS 레벨 1
                                       Y.LVL2, -- WBS 레벨 2
                                       Y.LVL3, -- WBS 레벨 3
                                       Y.CODE_KIND, -- 계획항목분류
                                       Y.CODE_ID, -- 계획항목코드
                                       X.WBS_RSLTS_RATE,
                                       X.WBS_RSLTS_CNTS, -- 주요내용
                                       TO_CHAR(X.WBS_RSLTS_DT, 'YYYY-MM-DD') AS WBS_RSLTS_DT, -- 작성일
                                       X.WBS_RSLTS_ID, -- 작성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.WBS_RSLTS_ID) AS WBS_RSLTS_NM,
                                       TO_CHAR(X.WBS_RSLTSS_DT, 'YYYY-MM-DD') AS WBS_RSLTSS_DT, -- 시작일자
                                       TO_CHAR(X.WBS_RSLTSE_DT, 'YYYY-MM-DD') AS WBS_RSLTSE_DT, -- 종료일자
                                       X.WBS_RSLTS_RMK, -- 비고
                                       X.LOCK_YN,
                                       X.CLOSE_YN,                             
                                       X.CREAT_ID, -- 생성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,
                                       X.CREAT_PGM, -- 셍성프로그램ID
                                       TO_CHAR(CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM, -- 생성일시
                                       X.UDT_ID, -- 최종변경자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,
                                       X.UDT_PGM, -- 최종수정프로그램ID
                                       TO_CHAR(UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM,  -- 최종변경일시
                                       X.LOCK_YN,
                                       X.CLOSE_YN                                       
                                          FROM TB_WB02M01 X
                                           INNER JOIN (
                                                        SELECT 
                                                        CODE_KIND,
                                                        CODE_ID,
                                                        CODE_RPRC,
                                                        CODE_NM,
                                                        CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
                                                        CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
                                                        CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
                                                        LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CODE_NM, '>') PATH
                                                    FROM TB_CM05M01
                                                    START WITH CODE_KIND = 'WBSDIV'
                                                    CONNECT BY PRIOR CODE_ID  =  CODE_KIND ) Y
                                            ON X.WBS_PLAN_CODE_KIND = Y.CODE_KIND
                                            AND X.WBS_PLAN_CODE_ID = Y.CODE_ID     
                                     ORDER BY X.SALES_CD, X.WBS_PLAN_CODE_ID ASC) Z 
                         INNER JOIN (
                           SELECT  X.CO_CD, -- 회사코드
                                   X.ORDRS_NO, -- 수주번호
                                   X.SALES_CD, -- SALES CODE
                                   Y.ORGN_SALES_CD, -- 원천 SALES CODE
                                   Y.ORDRS_CLNT_CD, -- 고객사
                                   Y.CLNT_PJT, -- 고객사 PJT
                                   X.ORDRS_DTL_DIV20, -- 신작구분
                                   X.PRDT_CD, -- 제품구분
                                   X.ITEM_DIV, -- 아이템구분
                                   X.EQP_NM -- 설비명
                                   FROM TB_CR02D02 X
                            INNER JOIN TB_CR02M01 Y
                            ON X.CO_CD = Y.CO_CD
                            AND X.ORDRS_NO = Y.ORDRS_NO ) S
                          ON Z.CO_CD = S.CO_CD
                          AND Z.SALES_CD = S.SALES_CD 
                )                
             WHERE CO_CD LIKE '%${coCd}%'
              AND WBS_RSLTS_DT BETWEEN '${wbsPlansDt}' AND '${wbsPlaneDt}'           
              <if test="salesCd != null and !salesCd.equals('')">
                AND SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
             </if>
             <if test="!clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
             </if>
             <if test="clntCd.equals('') and !clntNm.equals('')">
                 AND ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
             </if>
             <if test="!prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD LIKE '%${prdtDiv}%' <!--  제품구분 검색    -->               
             </if>
             
             <if test="prdtDiv.equals('') and !prdtDivNm.equals('')">
                AND PRDT_CD_NM LIKE '%${prdtDivNm}%' <!--  제품구분명 검색    -->               
             </if>
             
             <if test="prdtItem != null and !prdtItem.equals('')">
                AND ITEM_DIV LIKE '%${prdtItem}%'  <!--  아이템구분 검색    -->              
             </if> 
             <if test="wbsClntPjt != null and !wbsClntPjt.equals('')">
                AND CLNT_PJT LIKE '%${wbsClntPjt}%'  <!--  고객사 PJT 검색    -->              
             </if> 
             <if test="eqp_nm != null and !eqp_nm.equals('')">
                AND EQP_NM LIKE '%${eqp_nm}%'   <!--  설비명 검색    -->             
             </if>
             <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                AND WBS_PLAN_NO LIKE '%${wbsPlanNo}%'   <!--  관리번호 검색    -->             
             </if>
             <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
                 AND CODE_ID IN (
                      SELECT X.WBS_RSLTS_PLAN_CODE_ID
                         FROM TB_WB20M01 X
                         INNER JOIN TB_CM06M01 Y
                         ON X.TODO_ID = Y.ID
                         WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
                         <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                            AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
                         </if>
                         <if test="salesCd != null and !salesCd.equals('')">
                            AND X.SALES_CD LIKE '%${salesCd}%'
                         </if>   
                            AND X.TODO_ID LIKE '%${salesMngId}%' )
              </if>  
              <if test="salesMngId.equals('') and !salesMngNm.equals('')">
                 AND CODE_ID IN (
                      SELECT X.WBS_RSLTS_PLAN_CODE_ID
                         FROM TB_WB20M01 X
                         INNER JOIN TB_CM06M01 Y
                         ON X.TODO_ID = Y.ID
                         WHERE X.WBS_RSLTS_CO_CD = '${coCd}' 
                         <if test="wbsPlanNo != null and !wbsPlanNo.equals('')">
                            AND X.WBS_RSLTS_PLAN_NO LIKE '%${wbsPlanNo}%'
                         </if>
                         <if test="salesCd != null and !salesCd.equals('')">
                            AND X.SALES_CD LIKE '%${salesCd}%'
                         </if>   
                            AND Y.NAME LIKE '%${salesMngNm}%' )
              </if>  
          </select>
         
         
          <!--   -->
         
         
         
          
          <select id="selectWbsPlanInfoSelect" parameterType="Map" resultType="camelMap">
                SELECT * FROM (
                    SELECT ROWNUM AS RN, Z.*, 
                                   S.ORDRS_NO, -- 수주번호
                                   S.ORGN_SALES_CD, -- 원천 SALES CODE
                                   S.ORDRS_CLNT_CD, -- 고객사
                                   (SELECT T.CLNT_NM FROM TB_BM02M01 T WHERE T.CLNT_CD =S.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                                   S.CLNT_PJT, -- 고객사 PJT
                                   S.ORDRS_DTL_DIV20, -- 신작구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                                   S.PRDT_CD, -- 제품구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.PRDT_CD) AS PRDT_CD_NM,
                                   S.ITEM_DIV, -- 아이템구분
                                   (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = S.ITEM_DIV) AS ITEM_DIV_NM,
                                   S.EQP_NM -- 설비명
                                   FROM (
                                    SELECT 
                                       X.FILE_TRGT_KEY,
                                       X.CO_CD, -- 회사코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
                                       X.SALES_CD,-- SALES_CODE
                                       X.WBS_PLAN_NO, -- WBS계획번호
                                       Y.LVL1, -- WBS 레벨 1
                                       Y.LVL2, -- WBS 레벨 2
                                       Y.LVL3, -- WBS 레벨 3
                                       Y.CODE_KIND, -- 계획항목분류
                                       Y.CODE_ID, -- 계획항목코드
                                       X.WBS_PLAN_CNTS, -- 주요내용
                                       TO_CHAR(X.WBS_PLAN_DT, 'YYYY-MM-DD') AS WBS_PLAN_DT, -- 작성일
                                       X.WBS_PLAN_ID, -- 작성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.WBS_PLAN_ID) AS WBS_PLAN_NM,
                                       X.WBS_PLAN_MNG_ID, -- 담당자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.WBS_PLAN_MNG_ID) AS WBS_PLAN_MNG_NM,
                                       TO_CHAR(X.WBS_PLANS_DT, 'YYYY-MM-DD') AS WBS_PLANS_DT, -- 시작일자
                                       TO_CHAR(X.WBS_PLANE_DT, 'YYYY-MM-DD') AS WBS_PLANE_DT, -- 종료일자
                                       X.WBS_PLAN_RMK, -- 비고
                                       X.WBS_PLAN_STS_CODE_ID, -- 계획상태코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_STS_CODE_ID) AS WBS_PLAN_STS_NM,
                                       X.DSGN_DIF_CODE_ID, -- 설계난이도코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.DSGN_DIF_CODE_ID) AS DSGN_DIF_CODE_NM,
                                       X.DSGN_PLAN_HOUR, -- 설계계획공수
                                       X.PRDCTN_DIF_CODE_ID, -- 생산난이도코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.PRDCTN_DIF_CODE_ID) AS PRDCTN_DIF_CODE_NM,
                                       X.PRDCTN_PLAN_HOUR, -- 생산계획공수
                                       X.WBS_PLAN_OS_YN, -- 계획외주코드
                                       (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_OS_YN) AS WBS_PLAN_OS_NM,
                                       X.CREAT_ID, -- 생성자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,
                                       X.CREAT_PGM, -- 셍성프로그램ID
                                       TO_CHAR(CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM, -- 생성일시
                                       X.UDT_ID, -- 최종변경자
                                       (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,
                                       X.UDT_PGM, -- 최종수정프로그램ID
                                       TO_CHAR(UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM -- 최종변경일시
                                          FROM TB_WB01M01 X
                                           INNER JOIN (
                                                        SELECT 
                                                        CODE_KIND,
                                                        CODE_ID,
                                                        CODE_RPRC,
                                                        CODE_NM,
                                                        CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
                                                        CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
                                                        CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
                                                        LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CODE_NM, '>') PATH
                                                    FROM TB_CM05M01
                                                    START WITH CODE_KIND = 'WBSDIV'
                                                    CONNECT BY PRIOR CODE_ID  =  CODE_KIND ) Y
                                            ON X.WBS_PLAN_CODE_KIND = Y.CODE_KIND
                                            AND X.WBS_PLAN_CODE_ID = Y.CODE_ID     
                                     ORDER BY X.SALES_CD, X.WBS_PLAN_CODE_ID ASC) Z 
                         INNER JOIN (
                           SELECT  X.CO_CD, -- 회사코드
                                   X.ORDRS_NO, -- 수주번호
                                   X.SALES_CD, -- SALES CODE
                                   Y.ORGN_SALES_CD, -- 원천 SALES CODE
                                   Y.ORDRS_CLNT_CD, -- 고객사
                                   Y.CLNT_PJT, -- 고객사 PJT
                                   X.ORDRS_DTL_DIV20, -- 신작구분
                                   X.PRDT_CD, -- 제품구분
                                   X.ITEM_DIV, -- 아이템구분
                                   X.EQP_NM -- 설비명
                                   FROM TB_CR02D02 X
                            INNER JOIN TB_CR02M01 Y
                            ON X.CO_CD = Y.CO_CD
                            AND X.ORDRS_NO = Y.ORDRS_NO ) S
                          ON Z.CO_CD = S.CO_CD
                          AND Z.SALES_CD = S.SALES_CD 
                )                
             WHERE CO_CD = '${coCd}'
             AND CODE_KIND = '${codeKind}'
             AND CODE_ID = '${codeId}'
             AND SALES_CD = '${salesCd}'
        </select>
        
        <!-- WBS 실적 상위공정 유무체크  -->
        <select id="selectWbsPlanConfirmCount" parameterType="Map" resultType="int">
               SELECT COUNT(*)
                  FROM TB_WB02M01 
                   WHERE CO_CD = '${coCd}'
                   AND SALES_CD = '${salesCd}'
                   AND WBS_PLAN_CODE_ID = '${codeId}'
        </select>
         
         <!-- WBS일정실적 메인화면 삭제 시 삭제유무 체크  -->
        <select id="selectWbsPlanDeleteConfirmCount" parameterType="Map" resultType="int">
               SELECT COUNT(*)
                  FROM TB_WB02M01 
                   WHERE CO_CD = '${coCd}'
                   AND SALES_CD = '${salesCd}'
                   AND WBS_PLAN_CODE_ID IN (SELECT CODE_ID FROM TB_CM05M01 WHERE CODE_KIND ='${codeId}')
        </select>
    
        <!-- WBS일정실적 메인화면 삭제  -->  
        <delete id="deleteWbsPlanlist" parameterType="Map">
               DELETE FROM TB_WB02M01
                   WHERE CO_CD = '${coCd}'
                   AND SALES_CD = '${salesCd}'
                   AND WBS_PLAN_NO = '${wbsPlanNo}' 
                   AND WBS_PLAN_CODE_ID = '${codeId}'
        </delete>
        
        <!--실적 상세 테이블 수정 -->   
         <update id="wbsPlanStsCodeUpdate" parameterType="Map">
                UPDATE TB_WB01M01
                     SET 
                        WBS_PLAN_STS_CODE_ID =  #{wbsPlanStsCodeId}, 
                        UDT_ID = #{creatId},
                        UDT_PGM = #{creatPgm},
                        UDT_DTTM = SYSDATE  
                    WHERE     
                         CO_CD  = #{coCd}
                         AND WBS_PLAN_NO  = #{wbsPlanNo}
                         AND WBS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                         AND WBS_PLAN_CODE_ID  = #{wbsPlanCodeId}
                         AND SALES_CD  = #{salesCd}
         </update>
         
          <!--실적 상세 테이블 수정 -->   
          <!-- <update id="wbsRsltsDetailUpdate" parameterType="Map">
                UPDATE TB_WB02D01
                     SET 
                        WBS_RSLTS_RATE #{wbsRsltsRate}, 
                        WBS_ASS_RATE #{wbsAssRate}, 
                        WBS_RSLTS_CNTS #{wbsRsltsCnts},
                        WBS_PLAN_MH #{wbsPlanMh}, 
                        WBS_RSLTS_MH #{wbsRsltsMh}, 
                        WBS_RSLTS_RMK #{wbsRsltsRmk}, 
                        UDT_ID = #{creatId},
                        UDT_PGM = #{creatPgm},
                        UDT_DTTM = SYSDATE  
                    WHERE     
                         CO_CD  = #{coCd}
                         AND WBS_PLAN_NO  = #{wbsRsltsNo}
                         AND WBS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                         AND WBS_PLAN_CODE_ID  = #{wbsPlanCodeId}
                         AND WBS_RSLTS_SEQ  = #{wbsRsltsSeq}
         </update>    -->
         
         
         <update id="updateWbsPlanLockYnLvl1" parameterType="Map">
          UPDATE TB_WB01M01
              SET LOCK_YN = #{state}
              WHERE CO_CD = '${coCd}'
                   AND SALES_CD = '${salesCd}'
                   AND WBS_PLAN_CODE_ID = '${codeId}'
         </update>
         
         <update id="updateWbsPlanLockYnLvl2" parameterType="Map">
          UPDATE TB_WB01M01
              SET LOCK_YN = #{state}
              WHERE CO_CD = '${coCd}'
                 AND SALES_CD = '${salesCd}'
                 AND WBS_PLAN_CODE_ID IN (
	              SELECT  CODE_ID FROM (
	                 SELECT CODE_ID, CODE_RPRC
	                    FROM TB_CM05M01
	                    START WITH CODE_KIND = 'WBSDIV'
	                    CONNECT BY PRIOR CODE_ID  =  CODE_KIND ) X          
	                    WHERE CODE_RPRC = '${lvl}')
         </update>
         
         <update id="updateWbsPlanLockYnLvl3" parameterType="Map">
          UPDATE TB_WB01M01
              SET LOCK_YN = #{state}
              WHERE CO_CD = '${coCd}'
                 AND SALES_CD = '${salesCd}'
                 AND WBS_PLAN_CODE_ID IN (
                  SELECT  CODE_ID FROM (
                     SELECT CODE_ID, CODE_RPRC
                        FROM TB_CM05M01
                        START WITH CODE_KIND = 'WBSDIV'
                        CONNECT BY PRIOR CODE_ID  =  CODE_KIND ) X          
                        WHERE CODE_RPRC = '${lvl}')
         </update>
         
         
         <update id="updateWbsPlanCloseYn" parameterType="Map">
          UPDATE TB_WB01M01
              SET LOCK_YN = #{state},
                  CLOSE_YN = #{state}              
              WHERE CO_CD = '${coCd}'
                   AND SALES_CD = '${salesCd}'                   
         </update>
         
         <update id="updateWbsRsltsMasterCloseYn" parameterType="Map">
          UPDATE TB_WB02M01 
	          SET CLOSE_YN = #{state},
	                LOCK_YN = #{state}
	          WHERE CO_CD = '${coCd}'
	          AND SALES_CD = '${salesCd}'       
         </update>
         
         <update id="updateWbsRsltsDetailCloseYn" parameterType="Map">  
		  MERGE INTO TB_WB02D01 X
		  USING TB_WB02M01 Y
		  ON (X.CO_CD = Y.CO_CD  
			 AND X.WBS_PLAN_NO = Y.WBS_PLAN_NO   
			 AND X.WBS_PLAN_CODE_KIND = Y.WBS_PLAN_CODE_KIND 
			 AND X.WBS_PLAN_CODE_ID = Y.WBS_PLAN_CODE_ID
			 AND  Y.CO_CD = '${coCd}' AND Y.SALES_CD = '${salesCd}')
			WHEN MATCHED THEN
			UPDATE SET X.CLOSE_YN = #{state},
			           X.LOCK_YN = #{state}
         </update>
         
         
         
         
          
 </mapper>