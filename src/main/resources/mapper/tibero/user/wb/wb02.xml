<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.wb.wb02.mapper.WB02Mapper">

<!-- WBS일정실적 메인화면 삭제  -->  
        <delete id="deleteWbsRsltslist" parameterType="Map">
               DELETE FROM TB_WB02M01
                   WHERE CO_CD = '${coCd}'
                   AND SALES_CD = '${salesCd}'
                   AND WBS_PLAN_NO = '${wbsPlanNo}' 
                   AND WBS_PLAN_CODE_KIND = '${codeKind}'
                   AND WBS_PLAN_CODE_ID = '${codeId}'
        </delete>


       <!-- 실적 메인화면에서 실적 데이터 삭제 시 실적상세 테이블 삭제  -->  
         <delete id="deleteWbsRsltsDetailSub" parameterType="Map">
               DELETE FROM TB_WB02D01
                   WHERE CO_CD  = '${coCd}'
                         AND WBS_PLAN_NO  = '${wbsPlanNo}'
                         AND WBS_PLAN_CODE_KIND  = '${codeKind}'
                         AND WBS_PLAN_CODE_ID  = '${codeId}'
         </delete>


<!-- 실적 메인화면에서 실적 데이터 삭제 시 공유 테이블 삭제  --> 
         <delete id="deleteWbsSharngListSub" parameterType="Map">
               DELETE FROM TB_WB20M01
                   WHERE WBS_RSLTS_CO_CD  = '${coCd}'
                         AND SALES_CD  = '${salesCd}'
                         AND WBS_RSLTS_PLAN_NO  = '${wbsPlanNo}'
                         AND WBS_RSLTS_PLAN_CODE_KIND  = '${codeKind}'
                         AND WBS_RSLTS_PLAN_CODE_ID  = '${codeId}'
                         AND TODO_DIV1_CODE_ID  = '${S_todoDiv1CodeId}'
                         AND TODO_DIV2_CODE_ID  = '${S_todoDiv2CodeId}'
        </delete>

<!-- 실적 메인화면에서 실적 데이터 삭제 시 결재 테이블 삭제  --> 
        <delete id="deleteWbsApprovalListSub" parameterType="Map">
               DELETE FROM TB_WB20M01
                   WHERE WBS_RSLTS_CO_CD  = '${coCd}'
                         AND SALES_CD  = '${salesCd}'
                         AND WBS_RSLTS_PLAN_NO  = '${wbsPlanNo}'
                         AND WBS_RSLTS_PLAN_CODE_KIND  = '${codeKind}'
                         AND WBS_RSLTS_PLAN_CODE_ID  = '${codeId}'
                         AND TODO_DIV1_CODE_ID  = '${A_todoDiv1CodeId}'
                         AND TODO_DIV2_CODE_ID  = '${A_todoDiv2CodeId}'
                         
        </delete>

         <update id="updateWbsRsltsCloseYn" parameterType="Map">
              UPDATE TB_WB02M01
              SET LOCK_YN = #{state}, 
                  CLOSE_YN = #{state}
              WHERE CO_CD = #{coCd}
                   AND SALES_CD = #{salesCd}
                   AND WBS_PLAN_CODE_ID LIKE '${codeId}%'
          </update> 


<!-- 사용자 정보 조회, 20230614 cy.kim fax, office 등 추가  -->          
          <select id="selectRsltsMemberList" parameterType="Map" resultType="camelMap">
               SELECT X.CO_CD,
                      (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,                      
                      X.ID,
                      X.EMP_NO,
                      X.NAME,
                      X.TEL_NO,
                      X.EMAIL, 
                      X.FAX_NO, 
                      X.OFF_TEL_NO,
                      C.DEPT_NM, 
                      (SELECT D.LEVEL_NM FROM TB_CM07M01 D WHERE D.LEVEL_CD=X.LEVEL_CD) AS LEVEL_NM     /* 직급 */                      
                      FROM TB_CM06M01 X  
                      INNER JOIN TB_CM04M01 C ON(X.DEPT_ID=C.DEPT_ID)                      
                      WHERE X.CO_CD = '${coCd}'
                      AND X.ID = '${userId}' 
          </select>


<!-- 실적 상세  정보 조회  -->
          <select id="selectWbsRsltsDetailList" parameterType="Map" resultType="camelMap">
                SELECT  ROWNUM AS RN,
                        X.CO_CD, 
                        X.WBS_PLAN_NO  ,
                        X.WBS_PLAN_CODE_KIND ,
                        X.WBS_PLAN_CODE_ID ,
                        WBS_RSLTS_SEQ ,
                        X.WBS_RSLTS_RATE, 
                        X.WBS_ASS_RATE ,
                        (X.WBS_RSLTS_RATE * (X.WBS_ASS_RATE/100)) AS WBS_ASS_RATE_VAL,                     
                        X.WBS_RSLTS_CNTS ,
                        X.WBS_PLAN_MH ,
                        X.WBS_RSLTS_MH ,
                        X.WBS_RSLTS_RMK ,
                        X.LOCK_YN ,
                        X.CLOSE_YN ,
                        X.CREAT_ID,
                        (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,  
                        TO_CHAR(X.CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM,
                        X.UDT_ID,
                        (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,  
                        TO_CHAR(X.UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM 
                        FROM TB_WB02D01 X
                        INNER JOIN TB_WB02M01 Y
                        ON X.CO_CD = Y.CO_CD  
                           AND X.WBS_PLAN_NO = Y.WBS_PLAN_NO   
                           AND X.WBS_PLAN_CODE_KIND = Y.WBS_PLAN_CODE_KIND 
                           AND X.WBS_PLAN_CODE_ID = Y.WBS_PLAN_CODE_ID
                        WHERE X.CO_CD =  '${coCd}' 
                              AND X.WBS_PLAN_CODE_KIND = '${codeKind}'  
                              AND X.WBS_PLAN_CODE_ID = '${codeId}' 
                              AND Y.SALES_CD = '${salesCd}' 
                        ORDER BY ROWNUM ASC      
  
          </select>

<!-- 공유대상자 리스트 조회  -->          
          <select id="selectRsltsSharngList" parameterType="Map" resultType="camelMap">
               SELECT ROWNUM AS RN,
                      X.SALES_CD, 
                      X.TODO_CODE_ID AS WBS_RSLTS_PLAN_CODE_ID,
                      (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.TODO_CODE_ID) AS WBS_RSLTS_PLAN_CODE_NM,
                      X.TODO_NO AS WBS_RSLTS_PLAN_NO,
                      X.TODO_CO_CD AS WBS_RSLTS_CO_CD,
                      (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.TODO_CO_CD) AS WBS_RSLTS_CO_CD_NM,                      
                      Y.ID AS WBS_SHARNG_USER_ID, 
                      Y.EMP_NO,
                      Y.NAME,
                      Y.TEL_NO,
                      Y.EMAIL,
                      TO_CHAR(X.TODO_CF_DT,'YYYY-MM-DD') AS TODO_CF_DT,
                      X.TODO_CF_OPN
                      FROM TB_WB20M03 X
                      INNER JOIN TB_CM06M01 Y
                      ON X.TODO_CO_CD = Y.CO_CD
                      AND X.TODO_ID = Y.ID
                      WHERE X.TODO_CO_CD = '${coCd}'
                      AND X.TODO_CODE_ID = '${codeId}' 
                      AND X.SALES_CD = '${salesCd}'
                      AND X.TODO_DIV2_CODE_ID = 'TODODIV1020'
                      ORDER BY ROWNUM ASC
          </select>

<!-- 결재대상자 리스트 조회  -->          
          <select id="selectRsltsApprovalList" parameterType="Map" resultType="camelMap">
               SELECT ROWNUM AS RN,
                      X.SALES_CD, 
                      X.TODO_CODE_ID AS WBS_RSLTS_PLAN_CODE_ID,
                      (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.TODO_CODE_ID) AS WBS_RSLTS_PLAN_CODE_NM,
                      X.TODO_NO AS WBS_RSLTS_PLAN_NO, 
                      X.TODO_CO_CD AS WBS_RSLTS_CO_CD,
                      (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.TODO_CO_CD) AS WBS_RSLTS_CO_CD_NM,                   
                      Y.ID AS WBS_SHARNG_USER_ID, 
                      Y.EMP_NO,
                      Y.NAME,
                      Y.TEL_NO,
                      Y.EMAIL,
                      TO_CHAR(X.TODO_CF_DT,'YYYY-MM-DD') AS TODO_CF_DT,
                      X.TODO_CF_OPN
                      FROM TB_WB20M03 X
                      INNER JOIN TB_CM06M01 Y
                      ON X.TODO_CO_CD = Y.CO_CD
                      AND X.TODO_ID = Y.ID
                      WHERE X.TODO_CO_CD = '${coCd}'
                      AND X.TODO_CODE_ID = '${codeId}' 
                      AND X.SALES_CD = '${salesCd}'
                      AND X.TODO_DIV2_CODE_ID = 'TODODIV2010'
                      ORDER BY ROWNUM ASC
          </select>
<select id="selectWbsRsltsInfo" parameterType="Map" resultType="camelMap">
            SELECT WBS_PLAN_NO AS WBS_RSLTS_NO,
                   TO_CHAR(WBS_RSLTS_DT, 'YYYY-MM-DD') AS WBS_RSLTS_DT,
                   WBS_RSLTS_ID,
                   (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = WBS_RSLTS_ID) AS WBS_RSLTS_NM,
                   TO_CHAR(WBS_RSLTSS_DT, 'YYYY-MM-DD') AS WBS_RSLTSS_DT,
                   TO_CHAR(WBS_RSLTSE_DT, 'YYYY-MM-DD') AS WBS_RSLTSE_DT ,
                   WBS_RSLTS_RATE,
                   WBS_PLAN_MH,
                   WBS_RSLTS_MH,
                   WBS_RSLTS_CNTS,
                   WBS_RSLTS_RMK
                   FROM TB_WB02M01
                   WHERE FILE_TRGT_KEY =  #{fileTrgtKey}
         </select>  

<select id="selectWbsRstlsSeqNext" parameterType="Map" resultType="int">
             SELECT TO_CHAR(SYSDATE, 'YYYYMM')||LPAD(TB_WB02M01_SQ01.NEXTVAL,3,0) FROM DUAL
         </select>
 
 <!--실적 마스터 테이블 등록 -->   
          <insert id="wbsRsltsMasterInsert" parameterType="Map">
                INSERT INTO TB_WB02M01
                (
                        FILE_TRGT_KEY,
                        CO_CD,
                        WBS_PLAN_NO,
                        WBS_PLAN_CODE_KIND,
                        WBS_PLAN_CODE_ID,
                        SALES_CD,
                        WBS_RSLTS_DT,
                        WBS_RSLTS_ID,
                        WBS_RSLTS_RATE,
                        WBS_PLAN_MH,
                        WBS_RSLTS_MH,
                        WBS_RSLTS_CNTS,
                        WBS_RSLTSS_DT,
                        WBS_RSLTSE_DT,
                        WBS_RSLTS_RMK,
                        LOCK_YN,
                        CLOSE_YN,
                        CREAT_ID,
                        CREAT_PGM,
                        CREAT_DTTM                 
                ) 
                VALUES
                (       
                        #{fileTrgtKey},
                        #{coCd},
                        #{wbsRsltsNo},
                        #{wbsPlanCodeKind},
                        #{wbsPlanCodeId},
                        #{salesCd},
                        #{wbsRsltsDt},
                        #{wbsRsltsId},
                        #{wbsRsltsRate},
                        #{wbsPlanMh},
                        #{wbsRsltsMh},
                        #{wbsRsltsCnts},
                        #{wbsRsltssDt},
                        #{wbsRsltseDt},
                        #{wbsRsltsRmk},
                        'N',
                        'N',
                        #{creatId},
                        #{creatPgm},
                        SYSDATE  
                )
                
         </insert>   


<!--실적 상세 테이블 등록 -->   
          <insert id="wbsRsltsDetailInsert" parameterType="Map">
                INSERT INTO TB_WB02D01
                (
                        CO_CD,
                        WBS_PLAN_NO,
                        WBS_PLAN_CODE_KIND,
                        WBS_PLAN_CODE_ID,
                        WBS_RSLTS_SEQ, 
                        WBS_RSLTS_RATE,
                        WBS_ASS_RATE, 
                        WBS_RSLTS_CNTS, 
                        WBS_PLAN_MH, 
                        WBS_RSLTS_MH, 
                        WBS_RSLTS_RMK,
                        LOCK_YN,
                        CLOSE_YN,
                        CREAT_ID,
                        CREAT_PGM,
                        CREAT_DTTM   
                ) 
                VALUES
                (       
                        #{coCd}, 
                        #{wbsRsltsNo},
                        #{wbsPlanCodeKind},
                        #{wbsPlanCodeId},
                        #{wbsRsltsSeq},
                        #{wbsRsltsRate},
                        #{wbsAssRate},
                        #{wbsRsltsCnts},
                        #{wbsPlanMh},
                        #{wbsRsltsMh},
                        #{wbsRsltsRmk},
                        'N',
                        'N',
                        #{creatId},
                        #{creatPgm},
                        SYSDATE  
                )
                
         </insert>   

<!-- 공유 테이블 등록  -->
         <insert id="insertWbsSharngList" parameterType="Map">
                <selectKey keyProperty="toDoKey" resultType="Int" order="BEFORE">
                    SELECT NVL(MAX(TODO_KEY), 0) + 1 AS TODO_KEY FROM TB_WB20M03
                </selectKey>
                INSERT INTO TB_WB20M03
                (
                    TODO_KEY,
                    SANCTN_SN,
                    CO_CD,
                    TODO_DIV1_CODE_ID,
                    TODO_DIV2_CODE_ID,
                    TODO_ID,
                    SALES_CD,
                    PG_PATH,
                    TODO_FILE_TRGT_KEY,
                    TODO_CO_CD,
                    TODO_NO,
                    TODO_CODE_KIND,
                    TODO_CODE_ID,
                    CREAT_ID,
                    CREAT_PGM,
                    CREAT_DTTM,
                    PG_PARAM
                ) 
                VALUES
                (
                    #{toDoKey},
                    #{sanctnSn},
                    #{coCd},
                    #{todoDiv1CodeId},
                    #{todoDiv2CodeId},
                    #{wbsSharngUserId},
                    #{salesCd},
                    #{pgPath},
                    #{fileTrgtKey},
                    #{wbsRsltsCoCd},
                    #{wbsRsltsPlanNo},
                    #{wbsRsltsPlanCodeKind},
                    #{wbsRsltsPlanCodeId},
                    #{creatId},
                    #{creatPgm},
                    SYSDATE,
                    #{pgParam}
                )
         </insert>
         
          <!-- 결재 테이블 등록  -->
         <insert id="insertWbsApprovalList" parameterType="Map">
                <selectKey keyProperty="toDoKey" resultType="Int" order="BEFORE">
                    SELECT NVL(MAX(TODO_KEY), 0) + 1 AS TODO_KEY FROM TB_WB20M03
                </selectKey>
                INSERT INTO TB_WB20M03
                (
                    TODO_KEY,
                    SANCTN_SN,
                    CO_CD,
                    TODO_DIV1_CODE_ID,
                    TODO_DIV2_CODE_ID,
                    TODO_ID,
                    SALES_CD,
                    PG_PATH,
                    TODO_FILE_TRGT_KEY,
                    TODO_CO_CD,
                    TODO_NO,
                    TODO_CODE_KIND,
                    TODO_CODE_ID,
                    CREAT_ID,
                    CREAT_PGM,
                    CREAT_DTTM,
                    PG_PARAM
                ) 
                VALUES
                (
                    #{toDoKey},
                    #{sanctnSn},
                    #{coCd},
                    #{todoDiv1CodeId},
                    #{todoDiv2CodeId},
                    #{wbsSharngUserId},
                    #{salesCd},
                    #{pgPath},
                    #{fileTrgtKey},
                    #{wbsRsltsCoCd},
                    #{wbsRsltsPlanNo},
                    #{wbsRsltsPlanCodeKind},
                    #{wbsRsltsPlanCodeId},
                    #{creatId},
                    #{creatPgm},
                    SYSDATE,
                    #{pgParam}
                )
         </insert>
         

<!--WBS 계획 테이블 수정 -->   
         <update id="wbsPlanStsCodeUpdate" parameterType="Map">
                UPDATE TB_WB01M01
                     SET 
                        WBS_PLAN_STS_CODE_ID =  #{wbsPlanStsCodeId}, 
                        UDT_ID = #{creatId},
                        UDT_PGM = #{creatPgm},
                        UDT_DTTM = SYSDATE  
                    WHERE     
                         CO_CD  = #{coCd}
                         AND WBS_PLAN_NO  = #{wbsPlanNo}
                         AND WBS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                         AND WBS_PLAN_CODE_ID  = #{wbsPlanCodeId}
                         AND SALES_CD  = #{salesCd}
         </update>

<!--실적 마스트 테이블 수정 -->   
         <update id="wbsRsltsMasterUpdate" parameterType="Map">
                 UPDATE TB_WB02M01
                        SET
                        WBS_RSLTS_DT  =  #{wbsRsltsDt},
                        WBS_RSLTS_ID  =  #{wbsRsltsId},
                        WBS_RSLTS_RATE  =  #{wbsRsltsRate},
                        WBS_PLAN_MH   = #{wbsPlanMh},
                        WBS_RSLTS_MH   = #{wbsRsltsMh},
                        WBS_RSLTS_CNTS  =  #{wbsRsltsCnts},
                        WBS_RSLTSS_DT  =  #{wbsRsltssDt},
                        WBS_RSLTSE_DT  =  #{wbsRsltseDt},
                        WBS_RSLTS_RMK  =  #{wbsRsltsRmk},
                        UDT_ID  =  #{creatId},
                        UDT_PGM  =  #{creatPgm},
                        UDT_DTTM  =  SYSDATE       
                        WHERE FILE_TRGT_KEY = #{fileTrgtKey}
                             AND CO_CD  = #{coCd}
                             AND WBS_PLAN_NO  = #{wbsRsltsNo}
                             AND WBS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                             AND WBS_PLAN_CODE_ID  = #{wbsPlanCodeId}
                             AND SALES_CD  = #{salesCd}
         </update>   

 	<!-- 공유, 결재선 조회  -->          
	<select id="selectApprovalList" parameterType="Map" resultType="camelMap">
		SELECT *
			FROM
			(
			SELECT X.*
					, ROWNUM AS RN
				FROM
				(
				SELECT X.CO_CD
					, (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM
					, APP_NO
					, APP_SEQ
					, APP_DIV
					, FN_CM05M01_CD_TO_NM(X.APP_DIV) AS APP_DIV_NM
					, APP_LINE_NM
					, APP_ID
					, Y.NAME
					, Y.NAME AS USR_NM
					, Y.EMP_NO
					, Y.EMAIL
					, X.USE_YN
					, X.PG_PATH
					, X.CREAT_ID
					, (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM
					, X.CREAT_PGM
					, NVL(TO_CHAR(X.UDT_DTTM, 'YYYY-MM-DD'), TO_CHAR(X.CREAT_DTTM, 'YYYY-MM-DD')) AS CREAT_DTTM
					, Y.DEPT_ID
					, (SELECT T.DEPT_NM FROM TB_CM04M01 T WHERE T.DEPT_ID=Y.DEPT_ID) AS DEPT_NM
					, Y.LEVEL_CD
					, (SELECT T.LEVEL_NM FROM TB_CM07M01 T WHERE T.LEVEL_CD=Y.LEVEL_CD) AS LEVEL_NM 
					, Y.TEL_NO
					, Y.OFF_TEL_NO
					, Y.FAX_NO
				FROM TB_BM13M01 X
				INNER JOIN TB_CM06M01 Y ON(X.CO_CD = Y.CO_CD AND X.APP_ID = Y.ID)             				
				WHERE 1=1				
				<!-- 회사코드 -->         
				<if test="coCd != null and !coCd.equals('')">
					AND X.CO_CD = #{coCd}   
				</if>					
				<!-- 작성자 id 필수 -->         
				<if test="userId != null and !userId.equals('')">
					AND X.ID = #{userId}   
				</if>					
				<!-- 결재자 -->         
				<if test="appId != null and !appId.equals('')">
					AND X.APP_ID = #{appId}   
				</if>	
				<!-- 결재선구분 -->         
				<if test="appDiv != null and !appDiv.equals('')">
					AND X.APP_DIV = #{appDiv}   
				</if>			
				<!-- 작성자명 id가 null일 경우만 -->
				<if test="userId.equals('')">		
					<if test="userNm != null and !userNm.equals('')">
						AND X.ID = ( SELECT DD.ID FROM TB_CM06M01 DD WHERE DD.NAME = #{userNm,  jdbcType=VARCHAR} )   
					</if>		
				</if>												
					ORDER BY X.APP_DIV ASC, X.APP_NO DESC, X.APP_SEQ DESC				
				) X
			)					
	</select>
	
	<select id="deleteWbsRsltsDetailChk" parameterType="Map" resultType="camelMap">
                SELECT * FROM TB_WB02D01
                   WHERE CO_CD  = #{coCd}
                         AND WBS_PLAN_NO  = #{wbsRsltsNo}
                         AND WBS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                         AND WBS_PLAN_CODE_ID  = #{wbsPlanCodeId}
         </select>
         
         <select id="deleteWbsSharngListChk" parameterType="Map" resultType="camelMap">
               SELECT *  FROM TB_WB20M03
                   WHERE TODO_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND TODO_NO  = #{wbsRsltsNo}
                         AND TODO_CODE_KIND  = #{wbsPlanCodeKind}
                         AND TODO_CODE_ID  = #{wbsPlanCodeId}
                         AND TODO_DIV1_CODE_ID  = #{S_todoDiv1CodeId}
                         AND TODO_DIV2_CODE_ID  = #{S_todoDiv2CodeId}
        </select>
        
        <!-- 결재 테이블 삭제 전 확인  -->
        <select id="deleteWbsApprovalListChk" parameterType="Map" resultType="camelMap">
               SELECT *  FROM TB_WB20M03
                   WHERE TODO_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND TODO_NO  = #{wbsRsltsNo}
                         AND TODO_CODE_KIND  = #{wbsPlanCodeKind}
                         AND TODO_CODE_ID  = #{wbsPlanCodeId}
                         AND TODO_DIV1_CODE_ID  = #{A_todoDiv1CodeId}
                         AND TODO_DIV2_CODE_ID  = #{A_todoDiv2CodeId}
                         
        </select>
        
        
         <!-- 실적상세 테이블 삭제  -->  
         <delete id="deleteWbsRsltsDetail" parameterType="Map">
               DELETE FROM TB_WB02D01
                   WHERE CO_CD  = #{coCd}
                         AND WBS_PLAN_NO  = #{wbsRsltsNo}
                         AND WBS_PLAN_CODE_KIND  = #{wbsPlanCodeKind}
                         AND WBS_PLAN_CODE_ID  = #{wbsPlanCodeId}
         </delete>
        
        
         <!-- 공유 테이블 삭제  -->
         <delete id="deleteWbsSharngList" parameterType="Map">
               DELETE FROM TB_WB20M03
                   WHERE TODO_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND TODO_NO  = #{wbsRsltsNo}
                         AND TODO_CODE_KIND  = #{wbsPlanCodeKind}
                         AND TODO_CODE_ID  = #{wbsPlanCodeId}
                         AND TODO_DIV1_CODE_ID  = #{S_todoDiv1CodeId}
                         AND TODO_DIV2_CODE_ID  = #{S_todoDiv2CodeId}
        </delete>
        
        <!-- 결재 테이블 삭제  -->
        <delete id="deleteWbsApprovalList" parameterType="Map">
               DELETE FROM TB_WB20M03
                   WHERE TODO_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND TODO_NO  = #{wbsRsltsNo}
                         AND TODO_CODE_KIND  = #{wbsPlanCodeKind}
                         AND TODO_CODE_ID  = #{wbsPlanCodeId}
                         AND TODO_DIV1_CODE_ID  = #{A_todoDiv1CodeId}
                         AND TODO_DIV2_CODE_ID  = #{A_todoDiv2CodeId}
                         
        </delete>
        
        <!-- todo insert -->
		<insert id="insertTodoMaster" parameterType="Map">
		MERGE INTO TB_WB03M01 
			USING DUAL
			ON (
			TODO_KEY = #{todoKey}
			SANCTN_SN = #{sanctnSn} 
			CO_CD = #{coCd}
			TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
			TODO_DIV2_CODE_ID = #{todoDiv2CodeId} 
				)		
		WHEN MATCHED THEN
			UPDATE SET	
				CMPLET_YN = #{cmpletYn,			jdbcType=VARCHAR}
				, UDT_ID = #{userId}
				, UDT_PGM = #{pgmId}
				, UDT_DTTM = SYSDATE
		WHEN NOT MATCHED THEN					
		INSERT 
		(		
			TODO_KEY
			, SANCTN_SN
			, CO_CD
			, TODO_DIV1_CODE_ID
			, TODO_DIV2_CODE_ID
			, TODO_ID
			, TODO_CF_DT
			, TODO_CF_OPN
			, SANCTN_STTUS
			, SALES_CD
			, PG_PATH
			, TODO_FILE_TRGT_KEY
			, TODO_CO_CD
			, TODO_NO
			, TODO_CODE_KIND
			, TODO_CODE_ID
			, CREAT_ID
			, CREAT_PGM
			, CREAT_DTTM
			, PG_PARAM                
		) 
		VALUES
		(       
			#{todoKey}
			, #{sanctnSn}
			, #{coCd}
			, #{todoDiv1CodeId}
			, #{todoDiv2CodeId}
			, #{todoId}
			, #{todoCfDt}
			, #{todoCfOpn}
			, #{sanctnSttus}
			, #{salesCd}
			, #{pgPath}
			, #{todoFileTrgtKey}
			, #{todoCoCd}
			, #{todoNo}
			, #{todoCodeKind}
			, #{todoCodeId}
			, #{userId}
			, #{pgmId}
			, SYSDATE
			, #{pgParam}    
		)            
	</insert>  
	<!-- todo insert -->
 </mapper>
