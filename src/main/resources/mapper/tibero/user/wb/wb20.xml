<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.wb.wb20.mapper.WB20Mapper">

          <!-- ToDo List  메인 화면 조회 카운터  -->
          <select id="selectToDoCount" parameterType="Map" resultType="int">
              SELECT COUNT(*) FROM (
                      SELECT ROWNUM AS RN, 
                             TODO_KEY, 
                             CO_CD, 
                             TODO_CO_CD,
                             TODO_CO_CD_NM,
                             TODO_DIV1_CODE_ID, 
                             TODO_DIV1_CODE_NM,
                             TODO_DIV2_CODE_ID,
                             TODO_DIV2_CODE_NM,
                             SALES_CD,
                             TODO_ID,
                             TODO_NM,
                             TODO_CF_DT,
                             TODO_CF_OPN,
                             PG_PATH,
                             CASE WHEN TODO_DIV1_CODE_ID='APPDIV03' THEN TODO_DIV2_CODE_ID ELSE  TODO_NO END AS TODO_NO,           
                             TODO_FILE_TRGT_KEY,
                             CREAT_ID,
                             CREAT_NM,
                             CREAT_PGM,
                             CREAT_DTTM,
                             CREAT_DTTM1,
                             UDT_ID,
                             UDT_NM,
                             UDT_PGM,
                             UDT_DTTM,
                             PG_PARAM,
                             LVL,
                             
                             TODO_CODE_KIND,
                             CASE WHEN LVL=0 THEN TODO_CODE_ID
                                  WHEN LVL=1 THEN TODO_CODE_ID_01
                                  WHEN LVL=2 THEN TODO_CODE_ID_02
                                  WHEN LVL=3 THEN TODO_CODE_ID_03 END AS TODO_CODE_ID_R,
                                  
                             CASE WHEN LVL=0 THEN ''
                                  WHEN LVL=1 THEN TODO_CODE_NM_01
                                  WHEN LVL=2 THEN TODO_CODE_NM_02
                                  WHEN LVL=3 THEN TODO_CODE_NM_03 END AS TODO_CODE_NM_R, 
                                  
                             CASE WHEN TODO_DIV2_CODE_NM = 'WBS계획' THEN WBS_PLAN_CNTS
                                  WHEN TODO_DIV2_CODE_NM = 'WBS실적' THEN WBS_RSLTS_CNTS
                                  WHEN TODO_DIV2_CODE_NM = 'WBS이슈' THEN ISS_CNTS ELSE '' END AS TODO_CNTS,
                                  
                             TODO_CODE_ID,
                             TODO_CODE_ID_01, 
                             TODO_CODE_NM_01,
                             TODO_CODE_ID_02, 
                             TODO_CODE_NM_02,
                             TODO_CODE_ID_03,
                             TODO_CODE_NM_03,
                             
                             WBS_PLAN_MNG_ID_01,
                             WBS_PLAN_MNG_NM_01,
                             WBS_PLANS_DT_01,
                             WBS_PLANE_DT_01,
                             
                             WBS_PLAN_MNG_ID_02,
                             WBS_PLAN_MNG_NM_02,
                             WBS_PLANS_DT_02,
                             WBS_PLANE_DT_02,
                             
                             WBS_PLAN_MNG_ID_03,
                             WBS_PLAN_MNG_NM_03,
                             WBS_PLANS_DT_03,
                             WBS_PLANE_DT_03,
                             
                             WBS_PLAN_NO,
                             WBS_PLAN_DT,
                             WBS_PLAN_ID,
                             WBS_PLAN_NM,
                             WBS_PLAN_CNTS,
                             WBS_PLAN_RMK,
                             WBS_PLAN_STS_CODE_ID,
                             WBS_PLAN_STS_CODE_NM,
                             DSGN_DIF_CODE_ID,
                             DSGN_DIF_CODE_NM,
                             DSGN_PLAN_HOUR,
                             PRDCTN_DIF_CODE_ID,
                             PRDCTN_DIF_CODE_NM,
                             PRDCTN_PLAN_HOUR,
                             WBS_PLAN_OS_YN,
                             LOCK_YN_P,
                             CLOSE_YN_P,
                             FILE_TRGT_KEY_P,
                             
                             WBS_RSLTS_NO,
                             WBS_RSLTS_DT,
                             WBS_RSLTS_ID,
                             WBS_RSLTS_NM,
                             WBS_RSLTS_RATE,
                             WBS_PLAN_MH,
                             WBS_RSLTS_MH,
                             WBS_RSLTS_CNTS,
                             WBS_RSLTSS_DT,
                             WBS_RSLTSE_DT,
                             WBS_RSLTS_RMK,
                             LOCK_YN_R,
                             CLOSE_YN_R,
                             FILE_TRGT_KEY_R,
                             
                             WBS_ISS_NO,
                             ACT_YN,
                             ISS_DIV,
                             ISS_DIV_NM,
                             ISS_DTL_DIV,
                             ISS_DTL_DIV_NM,
                             ISS_GRD,
                             ISS_GRD_NM,
                             ISS_CNTS,
                             ACT_ID,
                             ACT_NM,
                             ACTS_DT,
                             ACTE_DT,
                             ACT_MH,
                             ACT_AMT,
                             CF_YN,
                             CF_ID,
                             CF_NM,
                             CAUSE_CNTS,
                             ACT_CNTS,
                             CF_DIV,
                             CF_DIV_NM,
                             CF_DTL_DIV,
                             CF_DTL_DIV_NM,
                             CF_GRD,
                             CF_GRD_NM,
                             CF_CNTS,
                             ISS_STS,
                             ISS_STS_NM,
                             FILE_TRGT_KEY_I,
                             
                             ORDRS_CLNT_CD,
                             ORDRS_CLNT_NM,
                             CLNT_PJT,
                             ORDRS_DTL_DIV20,
                             ORDRS_DTL_DIV20_NM,
                             PRDT_CD,
                             PRDT_NM,
                             ITEM_DIV,
                             ITEM_DIV_NM,
                             EQP_NM
                      FROM (
                              SELECT T.* FROM (
                                    SELECT   T.TODO_KEY, 
                                             T.CO_CD, 
                                             T.TODO_CO_CD,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CO_CD) AS TODO_CO_CD_NM,
                                             T.TODO_DIV1_CODE_ID, 
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_DIV1_CODE_ID) AS TODO_DIV1_CODE_NM,
                                             T.TODO_DIV2_CODE_ID,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_DIV2_CODE_ID) AS TODO_DIV2_CODE_NM,
                                             T.SALES_CD,
                                             T.TODO_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.TODO_ID) AS TODO_NM,
                                             TO_CHAR(T.TODO_CF_DT, 'YYYY-MM-DD') AS TODO_CF_DT,
                                             T.TODO_CF_OPN,
                                             T.PG_PATH,
                                             T.TODO_NO,           
                                             T.TODO_FILE_TRGT_KEY,
                                             T.CREAT_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CREAT_ID) AS CREAT_NM,
                                             T.CREAT_PGM,
                                             TO_CHAR(T.CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM,
                                             TO_CHAR(T.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM1,
                                             T.UDT_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.UDT_ID) AS UDT_NM,
                                             T.UDT_PGM,
                                             TO_CHAR(T.UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM,
                                             T.PG_PARAM,
                                             T.LVL,
                                             
                                             T.TODO_CODE_KIND,
                                             T.TODO_CODE_ID,
                                             T.TODO_CODE_ID_01, 
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CODE_ID_01) AS TODO_CODE_NM_01,
                                             T.TODO_CODE_ID_02, 
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CODE_ID_02) AS TODO_CODE_NM_02,
                                             T.TODO_CODE_ID_03,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CODE_ID_03) AS TODO_CODE_NM_03,
                                             
                                             T.WBS_PLAN_MNG_ID_01,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_MNG_ID_01) AS WBS_PLAN_MNG_NM_01,
                                             TO_CHAR(T.WBS_PLANS_DT_01, 'YYYY-MM-DD') AS WBS_PLANS_DT_01,
                                             TO_CHAR(T.WBS_PLANE_DT_01, 'YYYY-MM-DD') AS WBS_PLANE_DT_01,
                                             
                                             T.WBS_PLAN_MNG_ID_02,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_MNG_ID_02) AS WBS_PLAN_MNG_NM_02,
                                             TO_CHAR(T.WBS_PLANS_DT_02, 'YYYY-MM-DD') AS WBS_PLANS_DT_02,
                                             TO_CHAR(T.WBS_PLANE_DT_02, 'YYYY-MM-DD') AS WBS_PLANE_DT_02,
                                             
                                             T.WBS_PLAN_MNG_ID_03,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_MNG_ID_03) AS WBS_PLAN_MNG_NM_03,
                                             TO_CHAR(T.WBS_PLANS_DT_03, 'YYYY-MM-DD') AS WBS_PLANS_DT_03,
                                             TO_CHAR(T.WBS_PLANE_DT_03, 'YYYY-MM-DD') AS WBS_PLANE_DT_03,
                                             
                                             T.WBS_PLAN_NO,
                                             TO_CHAR(T.WBS_PLAN_DT, 'YYYY-MM-DD') AS WBS_PLAN_DT,
                                             T.WBS_PLAN_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_ID) AS WBS_PLAN_NM,
                                             T.WBS_PLAN_CNTS,
                                             T.WBS_PLAN_RMK,
                                             T.WBS_PLAN_STS_CODE_ID,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.WBS_PLAN_STS_CODE_ID) AS WBS_PLAN_STS_CODE_NM,
                                             T.DSGN_DIF_CODE_ID,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.DSGN_DIF_CODE_ID) AS DSGN_DIF_CODE_NM,
                                             T.DSGN_PLAN_HOUR,
                                             T.PRDCTN_DIF_CODE_ID,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.PRDCTN_DIF_CODE_ID) AS PRDCTN_DIF_CODE_NM,
                                             T.PRDCTN_PLAN_HOUR,
                                             T.WBS_PLAN_OS_YN,
                                             T.LOCK_YN_P,
                                             T.CLOSE_YN_P,
                                             T.FILE_TRGT_KEY_P,
                                             
                                             T.WBS_RSLTS_NO,
                                             TO_CHAR(T.WBS_RSLTS_DT, 'YYYY-MM-DD') AS WBS_RSLTS_DT,
                                             T.WBS_RSLTS_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_RSLTS_ID) AS WBS_RSLTS_NM,
                                             T.WBS_RSLTS_RATE,
                                             T.WBS_PLAN_MH,
                                             T.WBS_RSLTS_MH,
                                             T.WBS_RSLTS_CNTS,
                                             TO_CHAR(T.WBS_RSLTSS_DT, 'YYYY-MM-DD') AS WBS_RSLTSS_DT,
                                             TO_CHAR(T.WBS_RSLTSE_DT, 'YYYY-MM-DD') AS WBS_RSLTSE_DT,
                                             T.WBS_RSLTS_RMK,
                                             T.LOCK_YN_R,
                                             T.CLOSE_YN_R,
                                             T.FILE_TRGT_KEY_R,
                                             
                                             T.WBS_ISS_NO,
                                             T.ACT_YN,
                                             T.ISS_DIV,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_DIV) AS ISS_DIV_NM,
                                             T.ISS_DTL_DIV,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_DTL_DIV) AS ISS_DTL_DIV_NM,
                                             T.ISS_GRD,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_GRD) AS ISS_GRD_NM,
                                             T.ISS_CNTS,
                                             T.ACT_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ACT_ID) AS ACT_NM,
                                             TO_CHAR(T.ACTS_DT, 'YYYY-MM-DD') AS ACTS_DT,
                                             TO_CHAR(T.ACTE_DT, 'YYYY-MM-DD') AS ACTE_DT,
                                             T.ACT_MH,
                                             T.ACT_AMT,
                                             T.CF_YN,
                                             T.CF_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_ID) AS CF_NM,
                                             T.CAUSE_CNTS,
                                             T.ACT_CNTS,
                                             T.CF_DIV,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_DIV) AS CF_DIV_NM,
                                             T.CF_DTL_DIV,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_DTL_DIV) AS CF_DTL_DIV_NM,
                                             T.CF_GRD,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_GRD) AS CF_GRD_NM,
                                             T.CF_CNTS,
                                             T.ISS_STS,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_STS) AS ISS_STS_NM,
                                             T.FILE_TRGT_KEY_I,
                                             
                                             C.ORDRS_CLNT_CD,
                                             (SELECT X.CLNT_NM FROM TB_BM02M01 X WHERE X.CLNT_CD = C.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                                             C.CLNT_PJT,
                                             C.ORDRS_DTL_DIV20,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = C.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                                             C.PRDT_CD,
                                             (SELECT X.PRDT_NM FROM TB_BM01M01 X WHERE X.PRDT_CD = C.PRDT_CD) AS  PRDT_NM,
                                             C.ITEM_DIV,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = C.ITEM_DIV) AS ITEM_DIV_NM,
                                             C.EQP_NM
                                                            
                                          FROM (
                                                  SELECT TODO_KEY, 
                                                         CO_CD, 
                                                         TODO_CO_CD,
                                                         TODO_DIV1_CODE_ID, 
                                                         TODO_DIV2_CODE_ID,
                                                         SALES_CD,
                                                         TODO_ID, 
                                                         TODO_CF_DT,
                                                         TODO_CF_OPN,
                                                         PG_PATH,
                                                         TODO_NO,           
                                                         TODO_FILE_TRGT_KEY,
                                                         CREAT_ID,
                                                         CREAT_PGM,
                                                         CREAT_DTTM,
                                                         UDT_ID,
                                                         UDT_PGM,
                                                         UDT_DTTM,
                                                         PG_PARAM,
                                                         0 AS LVL,
                                                         
                                                         NULL AS TODO_CODE_KIND,
                                                         TODO_CODE_ID,
                                                         NULL AS TODO_CODE_ID_01, 
                                                         NULL AS TODO_CODE_ID_02, 
                                                         NULL AS TODO_CODE_ID_03,
                                                         
                                                         NULL AS WBS_PLAN_MNG_ID_01,
                                                         NULL AS WBS_PLANS_DT_01,
                                                         NULL AS WBS_PLANE_DT_01,
                                                         NULL AS WBS_PLAN_MNG_ID_02,
                                                         NULL AS WBS_PLANS_DT_02,
                                                         NULL AS WBS_PLANE_DT_02,
                                                         NULL AS WBS_PLAN_MNG_ID_03,
                                                         NULL AS WBS_PLANS_DT_03,
                                                         NULL AS WBS_PLANE_DT_03,
                                                         
                                                         NULL AS WBS_PLAN_NO,
                                                         NULL AS WBS_PLAN_DT,
                                                         NULL AS WBS_PLAN_ID,
                                                         NULL AS WBS_PLAN_CNTS,
                                                         NULL AS WBS_PLAN_RMK,
                                                         NULL AS WBS_PLAN_STS_CODE_ID,
                                                         NULL AS DSGN_DIF_CODE_ID,
                                                         NULL AS DSGN_PLAN_HOUR,
                                                         NULL AS PRDCTN_DIF_CODE_ID,
                                                         NULL AS PRDCTN_PLAN_HOUR,
                                                         NULL AS WBS_PLAN_OS_YN,
                                                         NULL AS LOCK_YN_P,
                                                         NULL AS CLOSE_YN_P,
                                                         NULL AS FILE_TRGT_KEY_P,
                                                         
                                                         NULL AS WBS_RSLTS_NO,
                                                         NULL AS WBS_RSLTS_DT,
                                                         NULL AS WBS_RSLTS_ID,
                                                         NULL AS WBS_RSLTS_RATE,
                                                         NULL AS WBS_PLAN_MH,
                                                         NULL AS WBS_RSLTS_MH,
                                                         NULL AS WBS_RSLTS_CNTS,
                                                         NULL AS WBS_RSLTSS_DT,
                                                         NULL AS WBS_RSLTSE_DT,
                                                         NULL AS WBS_RSLTS_RMK,
                                                         NULL AS LOCK_YN_R,
                                                         NULL AS CLOSE_YN_R,
                                                         NULL AS FILE_TRGT_KEY_R,
                                                         
                                                         NULL AS WBS_ISS_NO,
                                                         NULL AS ACT_YN,
                                                         NULL AS ISS_DIV,
                                                         NULL AS ISS_DTL_DIV,
                                                         NULL AS ISS_GRD,
                                                         NULL AS ISS_CNTS,
                                                         NULL AS ACT_ID,
                                                         NULL AS ACTS_DT,
                                                         NULL AS ACTE_DT,
                                                         NULL AS ACT_MH,
                                                         NULL AS ACT_AMT,
                                                         NULL AS CF_YN,
                                                         NULL AS CF_ID,
                                                         NULL AS CAUSE_CNTS,
                                                         NULL AS ACT_CNTS,
                                                         NULL AS CF_DIV,
                                                         NULL AS CF_DTL_DIV,
                                                         NULL AS CF_GRD,
                                                         NULL AS CF_CNTS,
                                                         NULL AS ISS_STS,
                                                         NULL AS FILE_TRGT_KEY_I
                                                         FROM TB_WB20M03
                                                         WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 1
                                                  UNION ALL 
                                                  -- 1레벨
                                                  SELECT X.TODO_KEY, 
                                                         X.CO_CD, 
                                                         X.TODO_CO_CD,
                                                         X.TODO_DIV1_CODE_ID, 
                                                         X.TODO_DIV2_CODE_ID,
                                                         X.SALES_CD,
                                                         X.TODO_ID,
                                                         X.TODO_CF_DT,
                                                         X.TODO_CF_OPN,
                                                         X.PG_PATH,
                                                         X.TODO_NO,           
                                                         X.TODO_FILE_TRGT_KEY,
                                                         X.CREAT_ID,
                                                         X.CREAT_PGM,
                                                         X.CREAT_DTTM,
                                                         X.UDT_ID,
                                                         X.UDT_PGM,
                                                         X.UDT_DTTM,
                                                         X.PG_PARAM,
                                                         1 AS LVL,
                                                         
                                                         X.TODO_CODE_KIND,
                                                         X.TODO_CODE_ID,
                                                         X.TODO_CODE_ID_01,
                                                         X.TODO_CODE_ID_02,
                                                         X.TODO_CODE_ID_03,
                                                         
                                                         P1.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_01,
                                                         P1.WBS_PLANS_DT AS WBS_PLANS_DT_01,
                                                         P1.WBS_PLANE_DT AS WBS_PLANE_DT_01,
                                                         NULL AS WBS_PLAN_MNG_ID_02,
                                                         NULL AS WBS_PLANS_DT_02,
                                                         NULL AS WBS_PLANE_DT_02,
                                                         NULL AS WBS_PLAN_MNG_ID_03,
                                                         NULL AS WBS_PLANS_DT_03,
                                                         NULL AS WBS_PLANE_DT_03,
                                                         
                                                         P1.WBS_PLAN_NO,
                                                         P1.WBS_PLAN_DT,
                                                         P1.WBS_PLAN_ID,
                                                         P1.WBS_PLAN_CNTS,
                                                         P1.WBS_PLAN_RMK,
                                                         P1.WBS_PLAN_STS_CODE_ID,
                                                         P1.DSGN_DIF_CODE_ID,
                                                         P1.DSGN_PLAN_HOUR,
                                                         P1.PRDCTN_DIF_CODE_ID,
                                                         P1.PRDCTN_PLAN_HOUR,
                                                         P1.WBS_PLAN_OS_YN,
                                                         P1.LOCK_YN AS LOCK_YN_P,
                                                         P1.CLOSE_YN AS CLOSE_YN_P,
                                                         P1.FILE_TRGT_KEY AS FILE_TRGT_KEY_P,
                                                         
                                                         R.WBS_PLAN_NO AS WBS_RSLTS_NO,
                                                         R.WBS_RSLTS_DT,
                                                         R.WBS_RSLTS_ID,
                                                         R.WBS_RSLTS_RATE,
                                                         R.WBS_PLAN_MH,
                                                         R.WBS_RSLTS_MH,
                                                         R.WBS_RSLTS_CNTS,
                                                         R.WBS_RSLTSS_DT,
                                                         R.WBS_RSLTSE_DT,
                                                         R.WBS_RSLTS_RMK,
                                                         R.LOCK_YN AS LOCK_YN_R,
                                                         R.CLOSE_YN AS CLOSE_YN_R,
                                                         R.FILE_TRGT_KEY AS FILE_TRGT_KEY_R,
                                                         
                                                         I.ISS_NO AS WBS_ISS_NO,
                                                         I.ACT_YN,
                                                         I.ISS_DIV,
                                                         I.ISS_DTL_DIV,
                                                         I.ISS_GRD,
                                                         I.ISS_CNTS,
                                                         I.ACT_ID,
                                                         I.ACTS_DT,
                                                         I.ACTE_DT,
                                                         I.ACT_MH,
                                                         I.ACT_AMT,
                                                         I.CF_YN,
                                                         I.CF_ID,
                                                         I.CAUSE_CNTS,
                                                         I.ACT_CNTS,
                                                         I.CF_DIV,
                                                         I.CF_DTL_DIV,
                                                         I.CF_GRD,
                                                         I.CF_CNTS,
                                                         I.ISS_STS,
                                                         I.FILE_TRGT_KEY AS FILE_TRGT_KEY_I
                                                         
                                                         FROM (
                                                              SELECT TODO_KEY, 
                                                                     CO_CD, 
                                                                     TODO_CO_CD,
                                                                     TODO_DIV1_CODE_ID, 
                                                                     TODO_DIV2_CODE_ID,
                                                                     SALES_CD,
                                                                     TODO_ID, 
                                                                     TODO_CF_DT,
                                                                     TODO_CF_OPN,
                                                                     PG_PATH,
                                                                     TODO_NO,           
                                                                     TODO_FILE_TRGT_KEY,
                                                                     CREAT_ID,
                                                                     CREAT_PGM,
                                                                     CREAT_DTTM,
                                                                     UDT_ID,
                                                                     UDT_PGM,
                                                                     UDT_DTTM,
                                                                     PG_PARAM,
                                                                     
                                                                     TODO_CODE_KIND,
                                                                     '' AS TODO_CODE_ID,
                                                                     TODO_CODE_ID AS TODO_CODE_ID_01, 
                                                                     '' AS TODO_CODE_ID_02, 
                                                                     '' AS TODO_CODE_ID_03
                                                                     
                                                                     FROM TB_WB20M03
                                                                     WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 8 ) X
                                                        LEFT OUTER JOIN TB_WB01M01 P1   
                                                        ON X.TODO_CO_CD = P1.CO_CD
                                                        AND X.TODO_CODE_ID_01 = P1.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P1.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB02M01 R   
                                                        ON X.TODO_CO_CD = R.CO_CD
                                                        AND X.TODO_CODE_ID_01 = R.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = R.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB03M01 I   
                                                        ON X.TODO_CO_CD = I.CO_CD
                                                        AND X.TODO_CODE_ID_01 = I.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = I.SALES_CD
                                                        
                                                    UNION ALL 
                                                    -- 2레벨
                                                    SELECT X.TODO_KEY, 
                                                         X.CO_CD, 
                                                         X.TODO_CO_CD,
                                                         X.TODO_DIV1_CODE_ID, 
                                                         X.TODO_DIV2_CODE_ID,
                                                         X.SALES_CD,
                                                         X.TODO_ID,
                                                         X.TODO_CF_DT,
                                                         X.TODO_CF_OPN,
                                                         X.PG_PATH,
                                                         X.TODO_NO,           
                                                         X.TODO_FILE_TRGT_KEY,
                                                         X.CREAT_ID,
                                                         X.CREAT_PGM,
                                                         X.CREAT_DTTM,
                                                         X.UDT_ID,
                                                         X.UDT_PGM,
                                                         X.UDT_DTTM,
                                                         X.PG_PARAM,
                                                         2 AS LVL,
                                                         
                                                         X.TODO_CODE_KIND,
                                                         X.TODO_CODE_ID,
                                                         X.TODO_CODE_ID_01,
                                                         X.TODO_CODE_ID_02,
                                                         X.TODO_CODE_ID_03,
                                                         
                                                         P1.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_01,
                                                         P1.WBS_PLANS_DT AS WBS_PLANS_DT_01,
                                                         P1.WBS_PLANE_DT AS WBS_PLANE_DT_01,
                                                         P2.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_02,
                                                         P2.WBS_PLANS_DT AS WBS_PLANS_DT_02,
                                                         P2.WBS_PLANE_DT AS WBS_PLANE_DT_02,
                                                         NULL AS WBS_PLAN_MNG_ID_03,
                                                         NULL AS WBS_PLANS_DT_03,
                                                         NULL AS WBS_PLANE_DT_03,
                                                         
                                                         P2.WBS_PLAN_NO,
                                                         P2.WBS_PLAN_DT,
                                                         P2.WBS_PLAN_ID,
                                                         P2.WBS_PLAN_CNTS,
                                                         P2.WBS_PLAN_RMK,
                                                         P2.WBS_PLAN_STS_CODE_ID,
                                                         P2.DSGN_DIF_CODE_ID,
                                                         P2.DSGN_PLAN_HOUR,
                                                         P2.PRDCTN_DIF_CODE_ID,
                                                         P2.PRDCTN_PLAN_HOUR,
                                                         P2.WBS_PLAN_OS_YN,
                                                         P2.LOCK_YN AS LOCK_YN_P,
                                                         P2.CLOSE_YN AS CLOSE_YN_P,
                                                         P2.FILE_TRGT_KEY AS FILE_TRGT_KEY_P,
                                                         
                                                         R.WBS_PLAN_NO AS WBS_RSLTS_NO,
                                                         R.WBS_RSLTS_DT,
                                                         R.WBS_RSLTS_ID,
                                                         R.WBS_RSLTS_RATE,
                                                         R.WBS_PLAN_MH,
                                                         R.WBS_RSLTS_MH,
                                                         R.WBS_RSLTS_CNTS,
                                                         R.WBS_RSLTSS_DT,
                                                         R.WBS_RSLTSE_DT,
                                                         R.WBS_RSLTS_RMK,
                                                         R.LOCK_YN AS LOCK_YN_R,
                                                         R.CLOSE_YN AS CLOSE_YN_R,
                                                         R.FILE_TRGT_KEY AS FILE_TRGT_KEY_R,
                                                         
                                                         I.ISS_NO AS WBS_ISS_NO,
                                                         I.ACT_YN,
                                                         I.ISS_DIV,
                                                         I.ISS_DTL_DIV,
                                                         I.ISS_GRD,
                                                         I.ISS_CNTS,
                                                         I.ACT_ID,
                                                         I.ACTS_DT,
                                                         I.ACTE_DT,
                                                         I.ACT_MH,
                                                         I.ACT_AMT,
                                                         I.CF_YN,
                                                         I.CF_ID,
                                                         I.CAUSE_CNTS,
                                                         I.ACT_CNTS,
                                                         I.CF_DIV,
                                                         I.CF_DTL_DIV,
                                                         I.CF_GRD,
                                                         I.CF_CNTS,
                                                         I.ISS_STS,
                                                         I.FILE_TRGT_KEY AS FILE_TRGT_KEY_I
                                                         
                                                         FROM (
                                                              SELECT TODO_KEY, 
                                                                     CO_CD, 
                                                                     TODO_CO_CD,
                                                                     TODO_DIV1_CODE_ID, 
                                                                     TODO_DIV2_CODE_ID,
                                                                     SALES_CD,
                                                                     TODO_ID,
                                                                     TODO_CF_DT,
                                                                     TODO_CF_OPN,
                                                                     PG_PATH,
                                                                     TODO_NO,           
                                                                     TODO_FILE_TRGT_KEY,
                                                                     CREAT_ID,
                                                                     CREAT_PGM,
                                                                     CREAT_DTTM,
                                                                     UDT_ID,
                                                                     UDT_PGM,
                                                                     UDT_DTTM,
                                                                     PG_PARAM,
                                                                     
                                                                     TODO_CODE_KIND,
                                                                     '' AS TODO_CODE_ID,
                                                                     SUBSTR(TODO_CODE_ID,0,8) AS TODO_CODE_ID_01, 
                                                                     TODO_CODE_ID AS TODO_CODE_ID_02, 
                                                                     '' AS TODO_CODE_ID_03
                                                                     
                                                                     FROM TB_WB20M03
                                                                     WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 10 ) X
                                                        LEFT OUTER JOIN TB_WB01M01 P2   
                                                        ON X.TODO_CO_CD = P2.CO_CD
                                                        AND X.TODO_CODE_ID_02 = P2.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P2.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB01M01 P1   
                                                        ON X.TODO_CO_CD = P1.CO_CD
                                                        AND X.TODO_CODE_ID_01 = P1.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P1.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB02M01 R   
                                                        ON X.TODO_CO_CD = R.CO_CD
                                                        AND X.TODO_CODE_ID_02 = R.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = R.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB03M01 I   
                                                        ON X.TODO_CO_CD = I.CO_CD
                                                        AND X.TODO_CODE_ID_02 = I.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = I.SALES_CD
                                                        
                                                    UNION ALL 
                                                    -- 3레벨
                                                    SELECT X.TODO_KEY, 
                                                         X.CO_CD, 
                                                         X.TODO_CO_CD,
                                                         X.TODO_DIV1_CODE_ID, 
                                                         X.TODO_DIV2_CODE_ID,
                                                         X.SALES_CD,
                                                         X.TODO_ID,
                                                         X.TODO_CF_DT,
                                                         X.TODO_CF_OPN,
                                                         X.PG_PATH,
                                                         X.TODO_NO,           
                                                         X.TODO_FILE_TRGT_KEY,
                                                         X.CREAT_ID,
                                                         X.CREAT_PGM,
                                                         X.CREAT_DTTM,
                                                         X.UDT_ID,
                                                         X.UDT_PGM,
                                                         X.UDT_DTTM,
                                                         X.PG_PARAM,
                                                         3 AS LVL,
                                                         
                                                         X.TODO_CODE_KIND,
                                                         X.TODO_CODE_ID,
                                                         X.TODO_CODE_ID_01,
                                                         X.TODO_CODE_ID_02,
                                                         X.TODO_CODE_ID_03,
                                                         
                                                         P1.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_01,
                                                         P1.WBS_PLANS_DT AS WBS_PLANS_DT_01,
                                                         P1.WBS_PLANE_DT AS WBS_PLANE_DT_01,
                                                         P2.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_02,
                                                         P2.WBS_PLANS_DT AS WBS_PLANS_DT_02,
                                                         P2.WBS_PLANE_DT AS WBS_PLANE_DT_02,
                                                         P3.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_03,
                                                         P3.WBS_PLANS_DT AS WBS_PLANS_DT_03,
                                                         P3.WBS_PLANE_DT AS WBS_PLANE_DT_03,
                                                         
                                                         P3.WBS_PLAN_NO,
                                                         P3.WBS_PLAN_DT,
                                                         P3.WBS_PLAN_ID,
                                                         P3.WBS_PLAN_CNTS,
                                                         P3.WBS_PLAN_RMK,
                                                         P3.WBS_PLAN_STS_CODE_ID,
                                                         P3.DSGN_DIF_CODE_ID,
                                                         P3.DSGN_PLAN_HOUR,
                                                         P3.PRDCTN_DIF_CODE_ID,
                                                         P3.PRDCTN_PLAN_HOUR,
                                                         P3.WBS_PLAN_OS_YN,
                                                         P3.LOCK_YN AS LOCK_YN_P,
                                                         P3.CLOSE_YN AS CLOSE_YN_P,
                                                         P3.FILE_TRGT_KEY AS FILE_TRGT_KEY_P,
                                                         
                                                         R.WBS_PLAN_NO AS WBS_RSLTS_NO,
                                                         R.WBS_RSLTS_DT,
                                                         R.WBS_RSLTS_ID,
                                                         R.WBS_RSLTS_RATE,
                                                         R.WBS_PLAN_MH,
                                                         R.WBS_RSLTS_MH,
                                                         R.WBS_RSLTS_CNTS,
                                                         R.WBS_RSLTSS_DT,
                                                         R.WBS_RSLTSE_DT,
                                                         R.WBS_RSLTS_RMK,
                                                         R.LOCK_YN AS LOCK_YN_R,
                                                         R.CLOSE_YN AS CLOSE_YN_R,
                                                         R.FILE_TRGT_KEY AS FILE_TRGT_KEY_R,
                                                         
                                                         I.ISS_NO AS WBS_ISS_NO,
                                                         I.ACT_YN,
                                                         I.ISS_DIV,
                                                         I.ISS_DTL_DIV,
                                                         I.ISS_GRD,
                                                         I.ISS_CNTS,
                                                         I.ACT_ID,
                                                         I.ACTS_DT,
                                                         I.ACTE_DT,
                                                         I.ACT_MH,
                                                         I.ACT_AMT,
                                                         I.CF_YN,
                                                         I.CF_ID,
                                                         I.CAUSE_CNTS,
                                                         I.ACT_CNTS,
                                                         I.CF_DIV,
                                                         I.CF_DTL_DIV,
                                                         I.CF_GRD,
                                                         I.CF_CNTS,
                                                         I.ISS_STS,
                                                         I.FILE_TRGT_KEY AS FILE_TRGT_KEY_I
                                                         
                                                         FROM (
                                                              SELECT TODO_KEY, 
                                                                     CO_CD, 
                                                                     TODO_CO_CD,
                                                                     TODO_DIV1_CODE_ID, 
                                                                     TODO_DIV2_CODE_ID,
                                                                     SALES_CD,
                                                                     TODO_ID,
                                                                     TODO_CF_DT,
                                                                     TODO_CF_OPN,
                                                                     PG_PATH,
                                                                     TODO_NO,           
                                                                     TODO_FILE_TRGT_KEY,
                                                                     CREAT_ID,
                                                                     CREAT_PGM,
                                                                     CREAT_DTTM,
                                                                     UDT_ID,
                                                                     UDT_PGM,
                                                                     UDT_DTTM,
                                                                     PG_PARAM,
                                                                     
                                                                     TODO_CODE_KIND,
                                                                     '' AS TODO_CODE_ID,
                                                                     SUBSTR(TODO_CODE_ID,0,8) AS TODO_CODE_ID_01, 
                                                                     SUBSTR(TODO_CODE_ID,0,10) AS TODO_CODE_ID_02, 
                                                                     TODO_CODE_ID AS TODO_CODE_ID_03
                                                                     
                                                                     FROM TB_WB20M03
                                                                     WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 12 ) X
                                                        LEFT OUTER JOIN TB_WB01M01 P3   
                                                        ON X.TODO_CO_CD = P3.CO_CD
                                                        AND X.TODO_CODE_ID_03 = P3.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P3.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB01M01 P2   
                                                        ON X.TODO_CO_CD = P2.CO_CD
                                                        AND X.TODO_CODE_ID_02 = P2.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P2.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB01M01 P1   
                                                        ON X.TODO_CO_CD = P1.CO_CD
                                                        AND X.TODO_CODE_ID_01 = P1.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P1.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB02M01 R   
                                                        ON X.TODO_CO_CD = R.CO_CD
                                                        AND X.TODO_CODE_ID_03 = R.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = R.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB03M01 I   
                                                        ON X.TODO_CO_CD = I.CO_CD
                                                        AND X.TODO_CODE_ID_03 = I.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = I.SALES_CD ) T
                                           LEFT OUTER JOIN (                
                                              SELECT  X1.CO_CD,
                                                       X1.SALES_CD,
                                                       Y1.ORDRS_CLNT_CD, -- 고객사
                                                       Y1.CLNT_PJT, -- 고객사 PJT
                                                       X1.ORDRS_DTL_DIV20, -- 신작구분
                                                       X1.PRDT_CD, -- 제품구분
                                                       X1.ITEM_DIV, -- 아이템구분
                                                       X1.EQP_NM -- 설비명
                                                       FROM TB_CR02D02 X1
                                                        INNER JOIN TB_CR02M01 Y1
                                                        ON X1.CO_CD = Y1.CO_CD
                                                        AND X1.ORDRS_NO = Y1.ORDRS_NO ) C 
                                            ON T.TODO_CO_CD = C.CO_CD
                                            AND T.SALES_CD = C.SALES_CD ) T                
                                 
                                 WHERE T.TODO_CO_CD = #{coCd}                 
                                 AND T.CREAT_DTTM1 BETWEEN #{wbsPlansDt} AND #{wbsPlaneDt} 
                                 <if test="salesCd != null and !salesCd.equals('')">
                                    AND T.SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
                                 </if>
                                 <if test="!clntCd.equals('') and !clntNm.equals('')">
                                     AND T.ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
                                 </if>
                                 <if test="clntCd.equals('') and !clntNm.equals('')">
                                     AND T.ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
                                 </if>                               
                                 <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
                                    AND T.TODO_ID = '${salesMngId}'                                   
                                 </if> 
                                 <if test="salesMngId.equals('') and !salesMngNm.equals('')">
                                    AND T.TODO_NM LIKE '%${salesMngNm}%'                                  
                                 </if>
                                 <if test="!todoDiv.equals('')">
                                    AND T.TODO_DIV1_CODE_ID = #{todoDiv}                                  
                                 </if>   
                                 ) T ) T
          </select>
          
          <!-- ToDo List 메인 화면 조회 리스트  -->
          <select id="selectToDoList" parameterType="Map" resultType="camelMap">  
            SELECT * FROM (
		              SELECT ROWNUM AS RN, 
		                     TODO_KEY, 
                             CO_CD, 
                             TODO_CO_CD,
                             TODO_CO_CD_NM,
                             TODO_DIV1_CODE_ID, 
                             TODO_DIV1_CODE_NM,
                             TODO_DIV2_CODE_ID,
                             TODO_DIV2_CODE_NM,
                             SALES_CD,
                             SANCTN_SN,
                             TODO_ID,
                             TODO_NM,
                             TODO_CF_DT,
                             TODO_CF_OPN,
                             PG_PATH,
                             CASE WHEN TODO_DIV1_CODE_ID='APPDIV03' THEN TODO_DIV2_CODE_ID ELSE  TODO_NO END AS TODO_NO,           
                             TODO_FILE_TRGT_KEY,
                             CREAT_ID,
                             CREAT_NM,
                             CREAT_PGM,
                             CREAT_DTTM,
                             CREAT_DTTM1,
                             UDT_ID,
                             UDT_NM,
                             UDT_PGM,
                             UDT_DTTM,
                             PG_PARAM,
                             LVL,
                             
                             TODO_CODE_KIND,
                             CASE WHEN LVL=0 THEN TODO_CODE_ID
                                  WHEN LVL=1 THEN TODO_CODE_ID_01
                                  WHEN LVL=2 THEN TODO_CODE_ID_02
                                  WHEN LVL=3 THEN TODO_CODE_ID_03 END AS TODO_CODE_ID_R,
                                  
                             CASE WHEN LVL=0 THEN ''
                                  WHEN LVL=1 THEN TODO_CODE_NM_01
                                  WHEN LVL=2 THEN TODO_CODE_NM_02
                                  WHEN LVL=3 THEN TODO_CODE_NM_03 END AS TODO_CODE_NM_R, 
                                  
                             CASE WHEN TODO_DIV2_CODE_NM = 'WBS계획' THEN WBS_PLAN_CNTS
                                  WHEN TODO_DIV2_CODE_NM = 'WBS실적' THEN WBS_RSLTS_CNTS
                                  WHEN TODO_DIV2_CODE_NM = 'WBS이슈' THEN ISS_CNTS ELSE '' END AS TODO_CNTS,
                                  
                             TODO_CODE_ID,
                             TODO_CODE_ID_01, 
                             TODO_CODE_NM_01,
                             TODO_CODE_ID_02, 
                             TODO_CODE_NM_02,
                             TODO_CODE_ID_03,
                             TODO_CODE_NM_03,
                             
                             WBS_PLAN_MNG_ID_01,
                             WBS_PLAN_MNG_NM_01,
                             WBS_PLANS_DT_01,
                             WBS_PLANE_DT_01,
                             
                             WBS_PLAN_MNG_ID_02,
                             WBS_PLAN_MNG_NM_02,
                             WBS_PLANS_DT_02,
                             WBS_PLANE_DT_02,
                             
                             WBS_PLAN_MNG_ID_03,
                             WBS_PLAN_MNG_NM_03,
                             WBS_PLANS_DT_03,
                             WBS_PLANE_DT_03,
                             
                             WBS_PLAN_NO,
                             WBS_PLAN_DT,
                             WBS_PLAN_ID,
                             WBS_PLAN_NM,
                             WBS_PLAN_CNTS,
                             WBS_PLAN_RMK,
                             WBS_PLAN_STS_CODE_ID,
                             WBS_PLAN_STS_CODE_NM,
                             DSGN_DIF_CODE_ID,
                             DSGN_DIF_CODE_NM,
                             DSGN_PLAN_HOUR,
                             PRDCTN_DIF_CODE_ID,
                             PRDCTN_DIF_CODE_NM,
                             PRDCTN_PLAN_HOUR,
                             WBS_PLAN_OS_YN,
                             LOCK_YN_P,
                             CLOSE_YN_P,
                             FILE_TRGT_KEY_P,
                             
                             WBS_RSLTS_NO,
                             WBS_RSLTS_DT,
                             WBS_RSLTS_ID,
                             WBS_RSLTS_NM,
                             WBS_RSLTS_RATE,
                             WBS_PLAN_MH,
                             WBS_RSLTS_MH,
                             WBS_RSLTS_CNTS,
                             WBS_RSLTSS_DT,
                             WBS_RSLTSE_DT,
                             WBS_RSLTS_RMK,
                             LOCK_YN_R,
                             CLOSE_YN_R,
                             FILE_TRGT_KEY_R,
                             
                             WBS_ISS_NO,
                             ACT_YN,
                             ISS_DIV,
                             ISS_DIV_NM,
                             ISS_DTL_DIV,
                             ISS_DTL_DIV_NM,
                             ISS_GRD,
                             ISS_GRD_NM,
                             ISS_CNTS,
                             ACT_ID,
                             ACT_NM,
                             ACTS_DT,
                             ACTE_DT,
                             ACT_MH,
                             ACT_AMT,
                             CF_YN,
                             CF_ID,
                             CF_NM,
                             CAUSE_CNTS,
                             ACT_CNTS,
                             CF_DIV,
                             CF_DIV_NM,
                             CF_DTL_DIV,
                             CF_DTL_DIV_NM,
                             CF_GRD,
                             CF_GRD_NM,
                             CF_CNTS,
                             ISS_STS,
                             ISS_STS_NM,
                             FILE_TRGT_KEY_I,
                             
                             ORDRS_CLNT_CD,
                             ORDRS_CLNT_NM,
                             CLNT_PJT,
                             ORDRS_DTL_DIV20,
                             ORDRS_DTL_DIV20_NM,
                             PRDT_CD,
                             PRDT_NM,
                             ITEM_DIV,
                             ITEM_DIV_NM,
                             EQP_NM
		              FROM (
				              SELECT T.* FROM (
						            SELECT   T.TODO_KEY, 
									         T.CO_CD, 
									         T.TODO_CO_CD,
									         (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CO_CD) AS TODO_CO_CD_NM,
									         T.TODO_DIV1_CODE_ID, 
									         (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_DIV1_CODE_ID) AS TODO_DIV1_CODE_NM,
									         T.TODO_DIV2_CODE_ID,
									         (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_DIV2_CODE_ID) AS TODO_DIV2_CODE_NM,
									         T.SALES_CD,
									         T.SANCTN_SN,
									         T.TODO_ID,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.TODO_ID) AS TODO_NM,
									         TO_CHAR(T.TODO_CF_DT, 'YYYY-MM-DD') AS TODO_CF_DT,
									         T.TODO_CF_OPN,
									         T.PG_PATH,
									         T.TODO_NO,           
									         T.TODO_FILE_TRGT_KEY,
									         T.CREAT_ID,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CREAT_ID) AS CREAT_NM,
									         T.CREAT_PGM,
									         TO_CHAR(T.CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM,
									         TO_CHAR(T.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM1,
									         T.UDT_ID,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.UDT_ID) AS UDT_NM,
									         T.UDT_PGM,
									         TO_CHAR(T.UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM,
									         T.PG_PARAM,
									         T.LVL,
									         
									         T.TODO_CODE_KIND,
									         T.TODO_CODE_ID,
									         T.TODO_CODE_ID_01, 
									         (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CODE_ID_01) AS TODO_CODE_NM_01,
									         T.TODO_CODE_ID_02, 
									         (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CODE_ID_02) AS TODO_CODE_NM_02,
									         T.TODO_CODE_ID_03,
									         (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CODE_ID_03) AS TODO_CODE_NM_03,
									         
									         T.WBS_PLAN_MNG_ID_01,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_MNG_ID_01) AS WBS_PLAN_MNG_NM_01,
									         TO_CHAR(T.WBS_PLANS_DT_01, 'YYYY-MM-DD') AS WBS_PLANS_DT_01,
									         TO_CHAR(T.WBS_PLANE_DT_01, 'YYYY-MM-DD') AS WBS_PLANE_DT_01,
									         
									         T.WBS_PLAN_MNG_ID_02,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_MNG_ID_02) AS WBS_PLAN_MNG_NM_02,
									         TO_CHAR(T.WBS_PLANS_DT_02, 'YYYY-MM-DD') AS WBS_PLANS_DT_02,
									         TO_CHAR(T.WBS_PLANE_DT_02, 'YYYY-MM-DD') AS WBS_PLANE_DT_02,
									         
									         T.WBS_PLAN_MNG_ID_03,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_MNG_ID_03) AS WBS_PLAN_MNG_NM_03,
									         TO_CHAR(T.WBS_PLANS_DT_03, 'YYYY-MM-DD') AS WBS_PLANS_DT_03,
									         TO_CHAR(T.WBS_PLANE_DT_03, 'YYYY-MM-DD') AS WBS_PLANE_DT_03,
									         
									         T.WBS_PLAN_NO,
									         TO_CHAR(T.WBS_PLAN_DT, 'YYYY-MM-DD') AS WBS_PLAN_DT,
									         T.WBS_PLAN_ID,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_ID) AS WBS_PLAN_NM,
									         T.WBS_PLAN_CNTS,
									         T.WBS_PLAN_RMK,
									         T.WBS_PLAN_STS_CODE_ID,
									         (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.WBS_PLAN_STS_CODE_ID) AS WBS_PLAN_STS_CODE_NM,
									         T.DSGN_DIF_CODE_ID,
									         (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.DSGN_DIF_CODE_ID) AS DSGN_DIF_CODE_NM,
									         T.DSGN_PLAN_HOUR,
									         T.PRDCTN_DIF_CODE_ID,
									         (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.PRDCTN_DIF_CODE_ID) AS PRDCTN_DIF_CODE_NM,
									         T.PRDCTN_PLAN_HOUR,
									         T.WBS_PLAN_OS_YN,
									         T.LOCK_YN_P,
									         T.CLOSE_YN_P,
									         T.FILE_TRGT_KEY_P,
									         
									         T.WBS_RSLTS_NO,
									         TO_CHAR(T.WBS_RSLTS_DT, 'YYYY-MM-DD') AS WBS_RSLTS_DT,
									         T.WBS_RSLTS_ID,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_RSLTS_ID) AS WBS_RSLTS_NM,
									         T.WBS_RSLTS_RATE,
									         T.WBS_PLAN_MH,
									         T.WBS_RSLTS_MH,
									         T.WBS_RSLTS_CNTS,
									         TO_CHAR(T.WBS_RSLTSS_DT, 'YYYY-MM-DD') AS WBS_RSLTSS_DT,
									         TO_CHAR(T.WBS_RSLTSE_DT, 'YYYY-MM-DD') AS WBS_RSLTSE_DT,
									         T.WBS_RSLTS_RMK,
									         T.LOCK_YN_R,
									         T.CLOSE_YN_R,
									         T.FILE_TRGT_KEY_R,
									         
									         T.WBS_ISS_NO,
									         T.ACT_YN,
									         T.ISS_DIV,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_DIV) AS ISS_DIV_NM,
									         T.ISS_DTL_DIV,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_DTL_DIV) AS ISS_DTL_DIV_NM,
									         T.ISS_GRD,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_GRD) AS ISS_GRD_NM,
									         T.ISS_CNTS,
									         T.ACT_ID,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ACT_ID) AS ACT_NM,
									         TO_CHAR(T.ACTS_DT, 'YYYY-MM-DD') AS ACTS_DT,
									         TO_CHAR(T.ACTE_DT, 'YYYY-MM-DD') AS ACTE_DT,
									         T.ACT_MH,
									         T.ACT_AMT,
									         T.CF_YN,
									         T.CF_ID,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_ID) AS CF_NM,
									         T.CAUSE_CNTS,
									         T.ACT_CNTS,
									         T.CF_DIV,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_DIV) AS CF_DIV_NM,
									         T.CF_DTL_DIV,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_DTL_DIV) AS CF_DTL_DIV_NM,
									         T.CF_GRD,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_GRD) AS CF_GRD_NM,
									         T.CF_CNTS,
									         T.ISS_STS,
									         (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_STS) AS ISS_STS_NM,
									         T.FILE_TRGT_KEY_I,
									         
									         C.ORDRS_CLNT_CD,
									         (SELECT X.CLNT_NM FROM TB_BM02M01 X WHERE X.CLNT_CD = C.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
									         C.CLNT_PJT,
									         C.ORDRS_DTL_DIV20,
									         (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = C.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
									         C.PRDT_CD,
									         (SELECT X.PRDT_NM FROM TB_BM01M01 X WHERE X.PRDT_CD = C.PRDT_CD) AS  PRDT_NM,
									         C.ITEM_DIV,
									         (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = C.ITEM_DIV) AS ITEM_DIV_NM,
									         C.EQP_NM
									                        
									      FROM (
									              SELECT TODO_KEY, 
									                     CO_CD, 
									                     TODO_CO_CD,
									                     TODO_DIV1_CODE_ID, 
									                     TODO_DIV2_CODE_ID,
									                     SALES_CD,
									                     SANCTN_SN,
									                     TODO_ID, 
									                     TODO_CF_DT,
									                     TODO_CF_OPN,
									                     PG_PATH,
									                     TODO_NO,           
									                     TODO_FILE_TRGT_KEY,
									                     CREAT_ID,
									                     CREAT_PGM,
									                     CREAT_DTTM,
									                     UDT_ID,
									                     UDT_PGM,
									                     UDT_DTTM,
									                     PG_PARAM,
									                     0 AS LVL,
									                     
									                     NULL AS TODO_CODE_KIND,
									                     TODO_CODE_ID,
									                     NULL AS TODO_CODE_ID_01, 
									                     NULL AS TODO_CODE_ID_02, 
									                     NULL AS TODO_CODE_ID_03,
									                     
									                     NULL AS WBS_PLAN_MNG_ID_01,
									                     NULL AS WBS_PLANS_DT_01,
									                     NULL AS WBS_PLANE_DT_01,
									                     NULL AS WBS_PLAN_MNG_ID_02,
									                     NULL AS WBS_PLANS_DT_02,
									                     NULL AS WBS_PLANE_DT_02,
									                     NULL AS WBS_PLAN_MNG_ID_03,
									                     NULL AS WBS_PLANS_DT_03,
									                     NULL AS WBS_PLANE_DT_03,
									                     
									                     NULL AS WBS_PLAN_NO,
									                     NULL AS WBS_PLAN_DT,
									                     NULL AS WBS_PLAN_ID,
									                     NULL AS WBS_PLAN_CNTS,
									                     NULL AS WBS_PLAN_RMK,
									                     NULL AS WBS_PLAN_STS_CODE_ID,
									                     NULL AS DSGN_DIF_CODE_ID,
									                     NULL AS DSGN_PLAN_HOUR,
									                     NULL AS PRDCTN_DIF_CODE_ID,
									                     NULL AS PRDCTN_PLAN_HOUR,
									                     NULL AS WBS_PLAN_OS_YN,
									                     NULL AS LOCK_YN_P,
									                     NULL AS CLOSE_YN_P,
									                     NULL AS FILE_TRGT_KEY_P,
									                     
									                     NULL AS WBS_RSLTS_NO,
									                     NULL AS WBS_RSLTS_DT,
									                     NULL AS WBS_RSLTS_ID,
									                     NULL AS WBS_RSLTS_RATE,
									                     NULL AS WBS_PLAN_MH,
									                     NULL AS WBS_RSLTS_MH,
									                     NULL AS WBS_RSLTS_CNTS,
									                     NULL AS WBS_RSLTSS_DT,
									                     NULL AS WBS_RSLTSE_DT,
									                     NULL AS WBS_RSLTS_RMK,
									                     NULL AS LOCK_YN_R,
									                     NULL AS CLOSE_YN_R,
									                     NULL AS FILE_TRGT_KEY_R,
									                     
									                     NULL AS WBS_ISS_NO,
									                     NULL AS ACT_YN,
									                     NULL AS ISS_DIV,
									                     NULL AS ISS_DTL_DIV,
									                     NULL AS ISS_GRD,
									                     NULL AS ISS_CNTS,
									                     NULL AS ACT_ID,
									                     NULL AS ACTS_DT,
									                     NULL AS ACTE_DT,
									                     NULL AS ACT_MH,
									                     NULL AS ACT_AMT,
									                     NULL AS CF_YN,
									                     NULL AS CF_ID,
									                     NULL AS CAUSE_CNTS,
									                     NULL AS ACT_CNTS,
									                     NULL AS CF_DIV,
									                     NULL AS CF_DTL_DIV,
									                     NULL AS CF_GRD,
									                     NULL AS CF_CNTS,
									                     NULL AS ISS_STS,
									                     NULL AS FILE_TRGT_KEY_I
									                     FROM TB_WB20M03
									                     WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 1
									              UNION ALL 
									              -- 1레벨
									              SELECT X.TODO_KEY, 
									                     X.CO_CD, 
									                     X.TODO_CO_CD,
									                     X.TODO_DIV1_CODE_ID, 
									                     X.TODO_DIV2_CODE_ID,
									                     X.SALES_CD,
									                     X.SANCTN_SN,
									                     X.TODO_ID,
									                     X.TODO_CF_DT,
									                     X.TODO_CF_OPN,
									                     X.PG_PATH,
									                     X.TODO_NO,           
									                     X.TODO_FILE_TRGT_KEY,
									                     X.CREAT_ID,
									                     X.CREAT_PGM,
									                     X.CREAT_DTTM,
									                     X.UDT_ID,
									                     X.UDT_PGM,
									                     X.UDT_DTTM,
									                     X.PG_PARAM,
									                     1 AS LVL,
									                     
									                     X.TODO_CODE_KIND,
									                     X.TODO_CODE_ID,
									                     X.TODO_CODE_ID_01,
									                     X.TODO_CODE_ID_02,
									                     X.TODO_CODE_ID_03,
									                     
									                     P1.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_01,
									                     P1.WBS_PLANS_DT AS WBS_PLANS_DT_01,
									                     P1.WBS_PLANE_DT AS WBS_PLANE_DT_01,
									                     NULL AS WBS_PLAN_MNG_ID_02,
									                     NULL AS WBS_PLANS_DT_02,
									                     NULL AS WBS_PLANE_DT_02,
									                     NULL AS WBS_PLAN_MNG_ID_03,
									                     NULL AS WBS_PLANS_DT_03,
									                     NULL AS WBS_PLANE_DT_03,
									                     
									                     P1.WBS_PLAN_NO,
									                     P1.WBS_PLAN_DT,
									                     P1.WBS_PLAN_ID,
									                     P1.WBS_PLAN_CNTS,
									                     P1.WBS_PLAN_RMK,
									                     P1.WBS_PLAN_STS_CODE_ID,
									                     P1.DSGN_DIF_CODE_ID,
									                     P1.DSGN_PLAN_HOUR,
									                     P1.PRDCTN_DIF_CODE_ID,
									                     P1.PRDCTN_PLAN_HOUR,
									                     P1.WBS_PLAN_OS_YN,
									                     P1.LOCK_YN AS LOCK_YN_P,
									                     P1.CLOSE_YN AS CLOSE_YN_P,
									                     P1.FILE_TRGT_KEY AS FILE_TRGT_KEY_P,
									                     
									                     R.WBS_PLAN_NO AS WBS_RSLTS_NO,
									                     R.WBS_RSLTS_DT,
									                     R.WBS_RSLTS_ID,
									                     R.WBS_RSLTS_RATE,
									                     R.WBS_PLAN_MH,
									                     R.WBS_RSLTS_MH,
									                     R.WBS_RSLTS_CNTS,
									                     R.WBS_RSLTSS_DT,
									                     R.WBS_RSLTSE_DT,
									                     R.WBS_RSLTS_RMK,
									                     R.LOCK_YN AS LOCK_YN_R,
									                     R.CLOSE_YN AS CLOSE_YN_R,
									                     R.FILE_TRGT_KEY AS FILE_TRGT_KEY_R,
									                     
									                     I.ISS_NO AS WBS_ISS_NO,
									                     I.ACT_YN,
									                     I.ISS_DIV,
									                     I.ISS_DTL_DIV,
									                     I.ISS_GRD,
									                     I.ISS_CNTS,
									                     I.ACT_ID,
									                     I.ACTS_DT,
									                     I.ACTE_DT,
									                     I.ACT_MH,
									                     I.ACT_AMT,
									                     I.CF_YN,
									                     I.CF_ID,
									                     I.CAUSE_CNTS,
									                     I.ACT_CNTS,
									                     I.CF_DIV,
									                     I.CF_DTL_DIV,
									                     I.CF_GRD,
									                     I.CF_CNTS,
									                     I.ISS_STS,
									                     I.FILE_TRGT_KEY AS FILE_TRGT_KEY_I
									                     
									                     FROM (
									                          SELECT TODO_KEY, 
									                                 CO_CD, 
									                                 TODO_CO_CD,
									                                 TODO_DIV1_CODE_ID, 
									                                 TODO_DIV2_CODE_ID,
									                                 SALES_CD,
									                                 SANCTN_SN,
									                                 TODO_ID, 
									                                 TODO_CF_DT,
									                                 TODO_CF_OPN,
									                                 PG_PATH,
									                                 TODO_NO,           
									                                 TODO_FILE_TRGT_KEY,
									                                 CREAT_ID,
									                                 CREAT_PGM,
									                                 CREAT_DTTM,
									                                 UDT_ID,
									                                 UDT_PGM,
									                                 UDT_DTTM,
									                                 PG_PARAM,
									                                 
									                                 TODO_CODE_KIND,
									                                 '' AS TODO_CODE_ID,
									                                 TODO_CODE_ID AS TODO_CODE_ID_01, 
									                                 '' AS TODO_CODE_ID_02, 
									                                 '' AS TODO_CODE_ID_03
									                                 
									                                 FROM TB_WB20M03
									                                 WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 8 ) X
									                    LEFT OUTER JOIN TB_WB01M01 P1   
									                    ON X.TODO_CO_CD = P1.CO_CD
									                    AND X.TODO_CODE_ID_01 = P1.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = P1.SALES_CD
									                    
									                    LEFT OUTER JOIN TB_WB02M01 R   
									                    ON X.TODO_CO_CD = R.CO_CD
									                    AND X.TODO_CODE_ID_01 = R.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = R.SALES_CD
									                    
									                    LEFT OUTER JOIN TB_WB03M01 I   
									                    ON X.TODO_CO_CD = I.CO_CD
									                    AND X.TODO_CODE_ID_01 = I.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = I.SALES_CD
									                    
									                UNION ALL 
									                -- 2레벨
									                SELECT X.TODO_KEY, 
									                     X.CO_CD, 
									                     X.TODO_CO_CD,
									                     X.TODO_DIV1_CODE_ID, 
									                     X.TODO_DIV2_CODE_ID,
									                     X.SALES_CD,
									                     X.SANCTN_SN,
									                     X.TODO_ID,
									                     X.TODO_CF_DT,
									                     X.TODO_CF_OPN,
									                     X.PG_PATH,
									                     X.TODO_NO,           
									                     X.TODO_FILE_TRGT_KEY,
									                     X.CREAT_ID,
									                     X.CREAT_PGM,
									                     X.CREAT_DTTM,
									                     X.UDT_ID,
									                     X.UDT_PGM,
									                     X.UDT_DTTM,
									                     X.PG_PARAM,
									                     2 AS LVL,
									                     
									                     X.TODO_CODE_KIND,
									                     X.TODO_CODE_ID,
									                     X.TODO_CODE_ID_01,
									                     X.TODO_CODE_ID_02,
									                     X.TODO_CODE_ID_03,
									                     
									                     P1.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_01,
									                     P1.WBS_PLANS_DT AS WBS_PLANS_DT_01,
									                     P1.WBS_PLANE_DT AS WBS_PLANE_DT_01,
									                     P2.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_02,
									                     P2.WBS_PLANS_DT AS WBS_PLANS_DT_02,
									                     P2.WBS_PLANE_DT AS WBS_PLANE_DT_02,
									                     NULL AS WBS_PLAN_MNG_ID_03,
									                     NULL AS WBS_PLANS_DT_03,
									                     NULL AS WBS_PLANE_DT_03,
									                     
									                     P2.WBS_PLAN_NO,
									                     P2.WBS_PLAN_DT,
									                     P2.WBS_PLAN_ID,
									                     P2.WBS_PLAN_CNTS,
									                     P2.WBS_PLAN_RMK,
									                     P2.WBS_PLAN_STS_CODE_ID,
									                     P2.DSGN_DIF_CODE_ID,
									                     P2.DSGN_PLAN_HOUR,
									                     P2.PRDCTN_DIF_CODE_ID,
									                     P2.PRDCTN_PLAN_HOUR,
									                     P2.WBS_PLAN_OS_YN,
									                     P2.LOCK_YN AS LOCK_YN_P,
									                     P2.CLOSE_YN AS CLOSE_YN_P,
									                     P2.FILE_TRGT_KEY AS FILE_TRGT_KEY_P,
									                     
									                     R.WBS_PLAN_NO AS WBS_RSLTS_NO,
									                     R.WBS_RSLTS_DT,
									                     R.WBS_RSLTS_ID,
									                     R.WBS_RSLTS_RATE,
									                     R.WBS_PLAN_MH,
									                     R.WBS_RSLTS_MH,
									                     R.WBS_RSLTS_CNTS,
									                     R.WBS_RSLTSS_DT,
									                     R.WBS_RSLTSE_DT,
									                     R.WBS_RSLTS_RMK,
									                     R.LOCK_YN AS LOCK_YN_R,
									                     R.CLOSE_YN AS CLOSE_YN_R,
									                     R.FILE_TRGT_KEY AS FILE_TRGT_KEY_R,
									                     
									                     I.ISS_NO AS WBS_ISS_NO,
									                     I.ACT_YN,
									                     I.ISS_DIV,
									                     I.ISS_DTL_DIV,
									                     I.ISS_GRD,
									                     I.ISS_CNTS,
									                     I.ACT_ID,
									                     I.ACTS_DT,
									                     I.ACTE_DT,
									                     I.ACT_MH,
									                     I.ACT_AMT,
									                     I.CF_YN,
									                     I.CF_ID,
									                     I.CAUSE_CNTS,
									                     I.ACT_CNTS,
									                     I.CF_DIV,
									                     I.CF_DTL_DIV,
									                     I.CF_GRD,
									                     I.CF_CNTS,
									                     I.ISS_STS,
									                     I.FILE_TRGT_KEY AS FILE_TRGT_KEY_I
									                     
									                     FROM (
									                          SELECT TODO_KEY, 
									                                 CO_CD, 
									                                 TODO_CO_CD,
									                                 TODO_DIV1_CODE_ID, 
									                                 TODO_DIV2_CODE_ID,
									                                 SALES_CD,
									                                 SANCTN_SN,
									                                 TODO_ID,
									                                 TODO_CF_DT,
									                                 TODO_CF_OPN,
									                                 PG_PATH,
									                                 TODO_NO,           
									                                 TODO_FILE_TRGT_KEY,
									                                 CREAT_ID,
									                                 CREAT_PGM,
									                                 CREAT_DTTM,
									                                 UDT_ID,
									                                 UDT_PGM,
									                                 UDT_DTTM,
									                                 PG_PARAM,
									                                 
									                                 TODO_CODE_KIND,
									                                 '' AS TODO_CODE_ID,
									                                 SUBSTR(TODO_CODE_ID,0,8) AS TODO_CODE_ID_01, 
									                                 TODO_CODE_ID AS TODO_CODE_ID_02, 
									                                 '' AS TODO_CODE_ID_03
									                                 
									                                 FROM TB_WB20M03
									                                 WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 10 ) X
									                    LEFT OUTER JOIN TB_WB01M01 P2   
									                    ON X.TODO_CO_CD = P2.CO_CD
									                    AND X.TODO_CODE_ID_02 = P2.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = P2.SALES_CD
									                    
									                    LEFT OUTER JOIN TB_WB01M01 P1   
									                    ON X.TODO_CO_CD = P1.CO_CD
									                    AND X.TODO_CODE_ID_01 = P1.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = P1.SALES_CD
									                    
									                    LEFT OUTER JOIN TB_WB02M01 R   
									                    ON X.TODO_CO_CD = R.CO_CD
									                    AND X.TODO_CODE_ID_02 = R.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = R.SALES_CD
									                    
									                    LEFT OUTER JOIN TB_WB03M01 I   
									                    ON X.TODO_CO_CD = I.CO_CD
									                    AND X.TODO_CODE_ID_02 = I.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = I.SALES_CD
									                    
									                UNION ALL 
									                -- 3레벨
									                SELECT X.TODO_KEY, 
									                     X.CO_CD, 
									                     X.TODO_CO_CD,
									                     X.TODO_DIV1_CODE_ID, 
									                     X.TODO_DIV2_CODE_ID,
									                     X.SALES_CD,
									                     X.SANCTN_SN,
									                     X.TODO_ID,
									                     X.TODO_CF_DT,
									                     X.TODO_CF_OPN,
									                     X.PG_PATH,
									                     X.TODO_NO,           
									                     X.TODO_FILE_TRGT_KEY,
									                     X.CREAT_ID,
									                     X.CREAT_PGM,
									                     X.CREAT_DTTM,
									                     X.UDT_ID,
									                     X.UDT_PGM,
									                     X.UDT_DTTM,
									                     X.PG_PARAM,
									                     3 AS LVL,
									                     
									                     X.TODO_CODE_KIND,
									                     X.TODO_CODE_ID,
									                     X.TODO_CODE_ID_01,
									                     X.TODO_CODE_ID_02,
									                     X.TODO_CODE_ID_03,
									                     
									                     P1.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_01,
									                     P1.WBS_PLANS_DT AS WBS_PLANS_DT_01,
									                     P1.WBS_PLANE_DT AS WBS_PLANE_DT_01,
									                     P2.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_02,
									                     P2.WBS_PLANS_DT AS WBS_PLANS_DT_02,
									                     P2.WBS_PLANE_DT AS WBS_PLANE_DT_02,
									                     P3.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_03,
									                     P3.WBS_PLANS_DT AS WBS_PLANS_DT_03,
									                     P3.WBS_PLANE_DT AS WBS_PLANE_DT_03,
									                     
									                     P3.WBS_PLAN_NO,
									                     P3.WBS_PLAN_DT,
									                     P3.WBS_PLAN_ID,
									                     P3.WBS_PLAN_CNTS,
									                     P3.WBS_PLAN_RMK,
									                     P3.WBS_PLAN_STS_CODE_ID,
									                     P3.DSGN_DIF_CODE_ID,
									                     P3.DSGN_PLAN_HOUR,
									                     P3.PRDCTN_DIF_CODE_ID,
									                     P3.PRDCTN_PLAN_HOUR,
									                     P3.WBS_PLAN_OS_YN,
									                     P3.LOCK_YN AS LOCK_YN_P,
									                     P3.CLOSE_YN AS CLOSE_YN_P,
									                     P3.FILE_TRGT_KEY AS FILE_TRGT_KEY_P,
									                     
									                     R.WBS_PLAN_NO AS WBS_RSLTS_NO,
									                     R.WBS_RSLTS_DT,
									                     R.WBS_RSLTS_ID,
									                     R.WBS_RSLTS_RATE,
									                     R.WBS_PLAN_MH,
									                     R.WBS_RSLTS_MH,
									                     R.WBS_RSLTS_CNTS,
									                     R.WBS_RSLTSS_DT,
									                     R.WBS_RSLTSE_DT,
									                     R.WBS_RSLTS_RMK,
									                     R.LOCK_YN AS LOCK_YN_R,
									                     R.CLOSE_YN AS CLOSE_YN_R,
									                     R.FILE_TRGT_KEY AS FILE_TRGT_KEY_R,
									                     
									                     I.ISS_NO AS WBS_ISS_NO,
									                     I.ACT_YN,
									                     I.ISS_DIV,
									                     I.ISS_DTL_DIV,
									                     I.ISS_GRD,
									                     I.ISS_CNTS,
									                     I.ACT_ID,
									                     I.ACTS_DT,
									                     I.ACTE_DT,
									                     I.ACT_MH,
									                     I.ACT_AMT,
									                     I.CF_YN,
									                     I.CF_ID,
									                     I.CAUSE_CNTS,
									                     I.ACT_CNTS,
									                     I.CF_DIV,
									                     I.CF_DTL_DIV,
									                     I.CF_GRD,
									                     I.CF_CNTS,
									                     I.ISS_STS,
									                     I.FILE_TRGT_KEY AS FILE_TRGT_KEY_I
									                     
									                     FROM (
									                          SELECT TODO_KEY, 
									                                 CO_CD, 
									                                 TODO_CO_CD,
									                                 TODO_DIV1_CODE_ID, 
									                                 TODO_DIV2_CODE_ID,
									                                 SALES_CD,
									                                 SANCTN_SN,
									                                 TODO_ID,
									                                 TODO_CF_DT,
									                                 TODO_CF_OPN,
									                                 PG_PATH,
									                                 TODO_NO,           
									                                 TODO_FILE_TRGT_KEY,
									                                 CREAT_ID,
									                                 CREAT_PGM,
									                                 CREAT_DTTM,
									                                 UDT_ID,
									                                 UDT_PGM,
									                                 UDT_DTTM,
									                                 PG_PARAM,
									                                 
									                                 TODO_CODE_KIND,
									                                 '' AS TODO_CODE_ID,
									                                 SUBSTR(TODO_CODE_ID,0,8) AS TODO_CODE_ID_01, 
									                                 SUBSTR(TODO_CODE_ID,0,10) AS TODO_CODE_ID_02, 
									                                 TODO_CODE_ID AS TODO_CODE_ID_03
									                                 
									                                 FROM TB_WB20M03
									                                 WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 12 ) X
									                    LEFT OUTER JOIN TB_WB01M01 P3   
									                    ON X.TODO_CO_CD = P3.CO_CD
									                    AND X.TODO_CODE_ID_03 = P3.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = P3.SALES_CD
									                    
									                    LEFT OUTER JOIN TB_WB01M01 P2   
									                    ON X.TODO_CO_CD = P2.CO_CD
									                    AND X.TODO_CODE_ID_02 = P2.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = P2.SALES_CD
									                    
									                    LEFT OUTER JOIN TB_WB01M01 P1   
									                    ON X.TODO_CO_CD = P1.CO_CD
									                    AND X.TODO_CODE_ID_01 = P1.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = P1.SALES_CD
									                    
									                    LEFT OUTER JOIN TB_WB02M01 R   
									                    ON X.TODO_CO_CD = R.CO_CD
									                    AND X.TODO_CODE_ID_03 = R.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = R.SALES_CD
									                    
									                    LEFT OUTER JOIN TB_WB03M01 I   
									                    ON X.TODO_CO_CD = I.CO_CD
									                    AND X.TODO_CODE_ID_03 = I.WBS_PLAN_CODE_ID
									                    AND X.SALES_CD = I.SALES_CD ) T
									       INNER JOIN (                
									          SELECT  X1.CO_CD,
									                   X1.SALES_CD,
									                   Y1.ORDRS_CLNT_CD, 
									                   Y1.CLNT_PJT, 
									                   Y1.ORDRS_NO,
									                   X1.ORDRS_DTL_DIV20, 
									                   X1.PRDT_CD, 
									                   X1.ITEM_DIV, 
									                   X1.EQP_NM 
									                   FROM TB_CR02D02 X1
									                    INNER JOIN TB_CR02M01 Y1
									                    ON X1.CO_CD = Y1.CO_CD
									                    AND X1.ORDRS_NO = Y1.ORDRS_NO ) C 
									        ON T.TODO_CO_CD = C.CO_CD
									        AND T.SALES_CD = C.SALES_CD
									        ) T                
				                 
				                 WHERE T.TODO_CO_CD = #{coCd}                 
					             AND T.CREAT_DTTM1 BETWEEN #{wbsPlansDt} AND #{wbsPlaneDt} 
				                 <if test="salesCd != null and !salesCd.equals('')">
					                AND T.SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
					             </if>
					             <if test="!clntCd.equals('') and !clntNm.equals('')">
					                 AND T.ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
					             </if>
					             <if test="clntCd.equals('') and !clntNm.equals('')">
					                 AND T.ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
					             </if>					             
					             <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
					                AND T.TODO_ID = '${salesMngId}'					                  
					             </if> 
					             <if test="salesMngId.equals('') and !salesMngNm.equals('')">
				                    AND T.TODO_NM LIKE '%${salesMngNm}%'                                  
				                 </if>
				                 <if test="!todoDiv.equals('')">
                                    AND T.TODO_DIV1_CODE_ID = #{todoDiv}                                  
                                 </if>
                                 ORDER BY T.TODO_CO_CD,
                                          T.TODO_DIV1_CODE_ID, 
                                          T.TODO_DIV2_CODE_ID,
                                          T.SALES_CD,
                                          T.TODO_NO,
                                          T.SANCTN_SN ASC  
                                  ) T ) T
		                 
			     WHERE RN BETWEEN ${firstIndex} AND ${lastIndex}
					 
		   </select>


           <update id="toDoCfDtUpdate" parameterType="Map">
                UPDATE TB_WB20M03
                   SET TODO_CF_DT = #{todoCfDt},
                       UDT_ID = #{creatId},
                       UDT_PGM = #{creatPgm},
                       UDT_DTTM = SYSDATE
                 WHERE 
                       TODO_KEY = #{todoKey}
           </update>   
           
           <update id="updateRsltsApproval" parameterType="Map">
                UPDATE TB_WB20M03
                   SET TODO_CF_DT = #{todoCfDt},
                       TODO_CF_OPN = #{todoCfOpn},
                       UDT_ID = #{creatId},
                       UDT_PGM = #{creatPgm},
                       UDT_DTTM = SYSDATE
                 WHERE 
                       TODO_KEY = #{todoKey}
           </update>   
           
           <!-- ToDo List 엑셀 리스트  -->
          <select id="selectToDoExcelList" parameterType="Map" resultType="camelMap">  
          SELECT * FROM (
                      SELECT ROWNUM AS RN, 
                             TODO_KEY, 
                             CO_CD, 
                             TODO_CO_CD,
                             TODO_CO_CD_NM,
                             TODO_DIV1_CODE_ID, 
                             TODO_DIV1_CODE_NM,
                             TODO_DIV2_CODE_ID,
                             TODO_DIV2_CODE_NM,
                             SALES_CD,
                             TODO_ID,
                             TODO_NM,
                             TODO_CF_DT,
                             TODO_CF_OPN,
                             PG_PATH,
                             CASE WHEN TODO_DIV1_CODE_ID='APPDIV03' THEN TODO_DIV2_CODE_ID ELSE  TODO_NO END AS TODO_NO,           
                             TODO_FILE_TRGT_KEY,
                             CREAT_ID,
                             CREAT_NM,
                             CREAT_PGM,
                             CREAT_DTTM,
                             CREAT_DTTM1,
                             UDT_ID,
                             UDT_NM,
                             UDT_PGM,
                             UDT_DTTM,
                             PG_PARAM,
                             LVL,
                             
                             TODO_CODE_KIND,
                             CASE WHEN LVL=0 THEN TODO_CODE_ID
                                  WHEN LVL=1 THEN TODO_CODE_ID_01
                                  WHEN LVL=2 THEN TODO_CODE_ID_02
                                  WHEN LVL=3 THEN TODO_CODE_ID_03 END AS TODO_CODE_ID_R,
                                  
                             CASE WHEN LVL=0 THEN ''
                                  WHEN LVL=1 THEN TODO_CODE_NM_01
                                  WHEN LVL=2 THEN TODO_CODE_NM_02
                                  WHEN LVL=3 THEN TODO_CODE_NM_03 END AS TODO_CODE_NM_R, 
                                  
                             CASE WHEN TODO_DIV2_CODE_NM = 'WBS계획' THEN WBS_PLAN_CNTS
                                  WHEN TODO_DIV2_CODE_NM = 'WBS실적' THEN WBS_RSLTS_CNTS
                                  WHEN TODO_DIV2_CODE_NM = 'WBS이슈' THEN ISS_CNTS ELSE '' END AS TODO_CNTS,
                                  
                             TODO_CODE_ID,
                             TODO_CODE_ID_01, 
                             TODO_CODE_NM_01,
                             TODO_CODE_ID_02, 
                             TODO_CODE_NM_02,
                             TODO_CODE_ID_03,
                             TODO_CODE_NM_03,
                             
                             WBS_PLAN_MNG_ID_01,
                             WBS_PLAN_MNG_NM_01,
                             WBS_PLANS_DT_01,
                             WBS_PLANE_DT_01,
                             
                             WBS_PLAN_MNG_ID_02,
                             WBS_PLAN_MNG_NM_02,
                             WBS_PLANS_DT_02,
                             WBS_PLANE_DT_02,
                             
                             WBS_PLAN_MNG_ID_03,
                             WBS_PLAN_MNG_NM_03,
                             WBS_PLANS_DT_03,
                             WBS_PLANE_DT_03,
                             
                             WBS_PLAN_NO,
                             WBS_PLAN_DT,
                             WBS_PLAN_ID,
                             WBS_PLAN_NM,
                             WBS_PLAN_CNTS,
                             WBS_PLAN_RMK,
                             WBS_PLAN_STS_CODE_ID,
                             WBS_PLAN_STS_CODE_NM,
                             DSGN_DIF_CODE_ID,
                             DSGN_DIF_CODE_NM,
                             DSGN_PLAN_HOUR,
                             PRDCTN_DIF_CODE_ID,
                             PRDCTN_DIF_CODE_NM,
                             PRDCTN_PLAN_HOUR,
                             WBS_PLAN_OS_YN,
                             LOCK_YN_P,
                             CLOSE_YN_P,
                             FILE_TRGT_KEY_P,
                             
                             WBS_RSLTS_NO,
                             WBS_RSLTS_DT,
                             WBS_RSLTS_ID,
                             WBS_RSLTS_NM,
                             WBS_RSLTS_RATE,
                             WBS_PLAN_MH,
                             WBS_RSLTS_MH,
                             WBS_RSLTS_CNTS,
                             WBS_RSLTSS_DT,
                             WBS_RSLTSE_DT,
                             WBS_RSLTS_RMK,
                             LOCK_YN_R,
                             CLOSE_YN_R,
                             FILE_TRGT_KEY_R,
                             
                             WBS_ISS_NO,
                             ACT_YN,
                             ISS_DIV,
                             ISS_DIV_NM,
                             ISS_DTL_DIV,
                             ISS_DTL_DIV_NM,
                             ISS_GRD,
                             ISS_GRD_NM,
                             ISS_CNTS,
                             ACT_ID,
                             ACT_NM,
                             ACTS_DT,
                             ACTE_DT,
                             ACT_MH,
                             ACT_AMT,
                             CF_YN,
                             CF_ID,
                             CF_NM,
                             CAUSE_CNTS,
                             ACT_CNTS,
                             CF_DIV,
                             CF_DIV_NM,
                             CF_DTL_DIV,
                             CF_DTL_DIV_NM,
                             CF_GRD,
                             CF_GRD_NM,
                             CF_CNTS,
                             ISS_STS,
                             ISS_STS_NM,
                             FILE_TRGT_KEY_I,
                             
                             ORDRS_CLNT_CD,
                             ORDRS_CLNT_NM,
                             CLNT_PJT,
                             ORDRS_DTL_DIV20,
                             ORDRS_DTL_DIV20_NM,
                             PRDT_CD,
                             PRDT_NM,
                             ITEM_DIV,
                             ITEM_DIV_NM,
                             EQP_NM
                      FROM (
                              SELECT T.* FROM (
                                    SELECT   T.TODO_KEY, 
                                             T.CO_CD, 
                                             T.TODO_CO_CD,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CO_CD) AS TODO_CO_CD_NM,
                                             T.TODO_DIV1_CODE_ID, 
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_DIV1_CODE_ID) AS TODO_DIV1_CODE_NM,
                                             T.TODO_DIV2_CODE_ID,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_DIV2_CODE_ID) AS TODO_DIV2_CODE_NM,
                                             T.SALES_CD,
                                             T.TODO_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.TODO_ID) AS TODO_NM,
                                             TO_CHAR(T.TODO_CF_DT, 'YYYY-MM-DD') AS TODO_CF_DT,
                                             T.TODO_CF_OPN,
                                             T.PG_PATH,
                                             T.TODO_NO,           
                                             T.TODO_FILE_TRGT_KEY,
                                             T.CREAT_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CREAT_ID) AS CREAT_NM,
                                             T.CREAT_PGM,
                                             TO_CHAR(T.CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM,
                                             TO_CHAR(T.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM1,
                                             T.UDT_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.UDT_ID) AS UDT_NM,
                                             T.UDT_PGM,
                                             TO_CHAR(T.UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM,
                                             T.PG_PARAM,
                                             T.LVL,
                                             
                                             T.TODO_CODE_KIND,
                                             T.TODO_CODE_ID,
                                             T.TODO_CODE_ID_01, 
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CODE_ID_01) AS TODO_CODE_NM_01,
                                             T.TODO_CODE_ID_02, 
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CODE_ID_02) AS TODO_CODE_NM_02,
                                             T.TODO_CODE_ID_03,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.TODO_CODE_ID_03) AS TODO_CODE_NM_03,
                                             
                                             T.WBS_PLAN_MNG_ID_01,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_MNG_ID_01) AS WBS_PLAN_MNG_NM_01,
                                             TO_CHAR(T.WBS_PLANS_DT_01, 'YYYY-MM-DD') AS WBS_PLANS_DT_01,
                                             TO_CHAR(T.WBS_PLANE_DT_01, 'YYYY-MM-DD') AS WBS_PLANE_DT_01,
                                             
                                             T.WBS_PLAN_MNG_ID_02,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_MNG_ID_02) AS WBS_PLAN_MNG_NM_02,
                                             TO_CHAR(T.WBS_PLANS_DT_02, 'YYYY-MM-DD') AS WBS_PLANS_DT_02,
                                             TO_CHAR(T.WBS_PLANE_DT_02, 'YYYY-MM-DD') AS WBS_PLANE_DT_02,
                                             
                                             T.WBS_PLAN_MNG_ID_03,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_MNG_ID_03) AS WBS_PLAN_MNG_NM_03,
                                             TO_CHAR(T.WBS_PLANS_DT_03, 'YYYY-MM-DD') AS WBS_PLANS_DT_03,
                                             TO_CHAR(T.WBS_PLANE_DT_03, 'YYYY-MM-DD') AS WBS_PLANE_DT_03,
                                             
                                             T.WBS_PLAN_NO,
                                             TO_CHAR(T.WBS_PLAN_DT, 'YYYY-MM-DD') AS WBS_PLAN_DT,
                                             T.WBS_PLAN_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_PLAN_ID) AS WBS_PLAN_NM,
                                             T.WBS_PLAN_CNTS,
                                             T.WBS_PLAN_RMK,
                                             T.WBS_PLAN_STS_CODE_ID,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.WBS_PLAN_STS_CODE_ID) AS WBS_PLAN_STS_CODE_NM,
                                             T.DSGN_DIF_CODE_ID,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.DSGN_DIF_CODE_ID) AS DSGN_DIF_CODE_NM,
                                             T.DSGN_PLAN_HOUR,
                                             T.PRDCTN_DIF_CODE_ID,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.PRDCTN_DIF_CODE_ID) AS PRDCTN_DIF_CODE_NM,
                                             T.PRDCTN_PLAN_HOUR,
                                             T.WBS_PLAN_OS_YN,
                                             T.LOCK_YN_P,
                                             T.CLOSE_YN_P,
                                             T.FILE_TRGT_KEY_P,
                                             
                                             T.WBS_RSLTS_NO,
                                             TO_CHAR(T.WBS_RSLTS_DT, 'YYYY-MM-DD') AS WBS_RSLTS_DT,
                                             T.WBS_RSLTS_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.WBS_RSLTS_ID) AS WBS_RSLTS_NM,
                                             T.WBS_RSLTS_RATE,
                                             T.WBS_PLAN_MH,
                                             T.WBS_RSLTS_MH,
                                             T.WBS_RSLTS_CNTS,
                                             TO_CHAR(T.WBS_RSLTSS_DT, 'YYYY-MM-DD') AS WBS_RSLTSS_DT,
                                             TO_CHAR(T.WBS_RSLTSE_DT, 'YYYY-MM-DD') AS WBS_RSLTSE_DT,
                                             T.WBS_RSLTS_RMK,
                                             T.LOCK_YN_R,
                                             T.CLOSE_YN_R,
                                             T.FILE_TRGT_KEY_R,
                                             
                                             T.WBS_ISS_NO,
                                             T.ACT_YN,
                                             T.ISS_DIV,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_DIV) AS ISS_DIV_NM,
                                             T.ISS_DTL_DIV,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_DTL_DIV) AS ISS_DTL_DIV_NM,
                                             T.ISS_GRD,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_GRD) AS ISS_GRD_NM,
                                             T.ISS_CNTS,
                                             T.ACT_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ACT_ID) AS ACT_NM,
                                             TO_CHAR(T.ACTS_DT, 'YYYY-MM-DD') AS ACTS_DT,
                                             TO_CHAR(T.ACTE_DT, 'YYYY-MM-DD') AS ACTE_DT,
                                             T.ACT_MH,
                                             T.ACT_AMT,
                                             T.CF_YN,
                                             T.CF_ID,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_ID) AS CF_NM,
                                             T.CAUSE_CNTS,
                                             T.ACT_CNTS,
                                             T.CF_DIV,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_DIV) AS CF_DIV_NM,
                                             T.CF_DTL_DIV,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_DTL_DIV) AS CF_DTL_DIV_NM,
                                             T.CF_GRD,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.CF_GRD) AS CF_GRD_NM,
                                             T.CF_CNTS,
                                             T.ISS_STS,
                                             (SELECT X.NAME FROM TB_CM06M01 X WHERE X.ID = T.ISS_STS) AS ISS_STS_NM,
                                             T.FILE_TRGT_KEY_I,
                                             
                                             C.ORDRS_CLNT_CD,
                                             (SELECT X.CLNT_NM FROM TB_BM02M01 X WHERE X.CLNT_CD = C.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                                             C.CLNT_PJT,
                                             C.ORDRS_DTL_DIV20,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = C.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                                             C.PRDT_CD,
                                             (SELECT X.PRDT_NM FROM TB_BM01M01 X WHERE X.PRDT_CD = C.PRDT_CD) AS  PRDT_NM,
                                             C.ITEM_DIV,
                                             (SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = C.ITEM_DIV) AS ITEM_DIV_NM,
                                             C.EQP_NM
                                                            
                                          FROM (
                                                  SELECT TODO_KEY, 
                                                         CO_CD, 
                                                         TODO_CO_CD,
                                                         TODO_DIV1_CODE_ID, 
                                                         TODO_DIV2_CODE_ID,
                                                         SALES_CD,
                                                         TODO_ID, 
                                                         TODO_CF_DT,
                                                         TODO_CF_OPN,
                                                         PG_PATH,
                                                         TODO_NO,           
                                                         TODO_FILE_TRGT_KEY,
                                                         CREAT_ID,
                                                         CREAT_PGM,
                                                         CREAT_DTTM,
                                                         UDT_ID,
                                                         UDT_PGM,
                                                         UDT_DTTM,
                                                         PG_PARAM,
                                                         0 AS LVL,
                                                         
                                                         NULL AS TODO_CODE_KIND,
                                                         TODO_CODE_ID,
                                                         NULL AS TODO_CODE_ID_01, 
                                                         NULL AS TODO_CODE_ID_02, 
                                                         NULL AS TODO_CODE_ID_03,
                                                         
                                                         NULL AS WBS_PLAN_MNG_ID_01,
                                                         NULL AS WBS_PLANS_DT_01,
                                                         NULL AS WBS_PLANE_DT_01,
                                                         NULL AS WBS_PLAN_MNG_ID_02,
                                                         NULL AS WBS_PLANS_DT_02,
                                                         NULL AS WBS_PLANE_DT_02,
                                                         NULL AS WBS_PLAN_MNG_ID_03,
                                                         NULL AS WBS_PLANS_DT_03,
                                                         NULL AS WBS_PLANE_DT_03,
                                                         
                                                         NULL AS WBS_PLAN_NO,
                                                         NULL AS WBS_PLAN_DT,
                                                         NULL AS WBS_PLAN_ID,
                                                         NULL AS WBS_PLAN_CNTS,
                                                         NULL AS WBS_PLAN_RMK,
                                                         NULL AS WBS_PLAN_STS_CODE_ID,
                                                         NULL AS DSGN_DIF_CODE_ID,
                                                         NULL AS DSGN_PLAN_HOUR,
                                                         NULL AS PRDCTN_DIF_CODE_ID,
                                                         NULL AS PRDCTN_PLAN_HOUR,
                                                         NULL AS WBS_PLAN_OS_YN,
                                                         NULL AS LOCK_YN_P,
                                                         NULL AS CLOSE_YN_P,
                                                         NULL AS FILE_TRGT_KEY_P,
                                                         
                                                         NULL AS WBS_RSLTS_NO,
                                                         NULL AS WBS_RSLTS_DT,
                                                         NULL AS WBS_RSLTS_ID,
                                                         NULL AS WBS_RSLTS_RATE,
                                                         NULL AS WBS_PLAN_MH,
                                                         NULL AS WBS_RSLTS_MH,
                                                         NULL AS WBS_RSLTS_CNTS,
                                                         NULL AS WBS_RSLTSS_DT,
                                                         NULL AS WBS_RSLTSE_DT,
                                                         NULL AS WBS_RSLTS_RMK,
                                                         NULL AS LOCK_YN_R,
                                                         NULL AS CLOSE_YN_R,
                                                         NULL AS FILE_TRGT_KEY_R,
                                                         
                                                         NULL AS WBS_ISS_NO,
                                                         NULL AS ACT_YN,
                                                         NULL AS ISS_DIV,
                                                         NULL AS ISS_DTL_DIV,
                                                         NULL AS ISS_GRD,
                                                         NULL AS ISS_CNTS,
                                                         NULL AS ACT_ID,
                                                         NULL AS ACTS_DT,
                                                         NULL AS ACTE_DT,
                                                         NULL AS ACT_MH,
                                                         NULL AS ACT_AMT,
                                                         NULL AS CF_YN,
                                                         NULL AS CF_ID,
                                                         NULL AS CAUSE_CNTS,
                                                         NULL AS ACT_CNTS,
                                                         NULL AS CF_DIV,
                                                         NULL AS CF_DTL_DIV,
                                                         NULL AS CF_GRD,
                                                         NULL AS CF_CNTS,
                                                         NULL AS ISS_STS,
                                                         NULL AS FILE_TRGT_KEY_I
                                                         FROM TB_WB20M03
                                                         WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 1
                                                  UNION ALL 
                                                  -- 1레벨
                                                  SELECT X.TODO_KEY, 
                                                         X.CO_CD, 
                                                         X.TODO_CO_CD,
                                                         X.TODO_DIV1_CODE_ID, 
                                                         X.TODO_DIV2_CODE_ID,
                                                         X.SALES_CD,
                                                         X.TODO_ID,
                                                         X.TODO_CF_DT,
                                                         X.TODO_CF_OPN,
                                                         X.PG_PATH,
                                                         X.TODO_NO,           
                                                         X.TODO_FILE_TRGT_KEY,
                                                         X.CREAT_ID,
                                                         X.CREAT_PGM,
                                                         X.CREAT_DTTM,
                                                         X.UDT_ID,
                                                         X.UDT_PGM,
                                                         X.UDT_DTTM,
                                                         X.PG_PARAM,
                                                         1 AS LVL,
                                                         
                                                         X.TODO_CODE_KIND,
                                                         X.TODO_CODE_ID,
                                                         X.TODO_CODE_ID_01,
                                                         X.TODO_CODE_ID_02,
                                                         X.TODO_CODE_ID_03,
                                                         
                                                         P1.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_01,
                                                         P1.WBS_PLANS_DT AS WBS_PLANS_DT_01,
                                                         P1.WBS_PLANE_DT AS WBS_PLANE_DT_01,
                                                         NULL AS WBS_PLAN_MNG_ID_02,
                                                         NULL AS WBS_PLANS_DT_02,
                                                         NULL AS WBS_PLANE_DT_02,
                                                         NULL AS WBS_PLAN_MNG_ID_03,
                                                         NULL AS WBS_PLANS_DT_03,
                                                         NULL AS WBS_PLANE_DT_03,
                                                         
                                                         P1.WBS_PLAN_NO,
                                                         P1.WBS_PLAN_DT,
                                                         P1.WBS_PLAN_ID,
                                                         P1.WBS_PLAN_CNTS,
                                                         P1.WBS_PLAN_RMK,
                                                         P1.WBS_PLAN_STS_CODE_ID,
                                                         P1.DSGN_DIF_CODE_ID,
                                                         P1.DSGN_PLAN_HOUR,
                                                         P1.PRDCTN_DIF_CODE_ID,
                                                         P1.PRDCTN_PLAN_HOUR,
                                                         P1.WBS_PLAN_OS_YN,
                                                         P1.LOCK_YN AS LOCK_YN_P,
                                                         P1.CLOSE_YN AS CLOSE_YN_P,
                                                         P1.FILE_TRGT_KEY AS FILE_TRGT_KEY_P,
                                                         
                                                         R.WBS_PLAN_NO AS WBS_RSLTS_NO,
                                                         R.WBS_RSLTS_DT,
                                                         R.WBS_RSLTS_ID,
                                                         R.WBS_RSLTS_RATE,
                                                         R.WBS_PLAN_MH,
                                                         R.WBS_RSLTS_MH,
                                                         R.WBS_RSLTS_CNTS,
                                                         R.WBS_RSLTSS_DT,
                                                         R.WBS_RSLTSE_DT,
                                                         R.WBS_RSLTS_RMK,
                                                         R.LOCK_YN AS LOCK_YN_R,
                                                         R.CLOSE_YN AS CLOSE_YN_R,
                                                         R.FILE_TRGT_KEY AS FILE_TRGT_KEY_R,
                                                         
                                                         I.ISS_NO AS WBS_ISS_NO,
                                                         I.ACT_YN,
                                                         I.ISS_DIV,
                                                         I.ISS_DTL_DIV,
                                                         I.ISS_GRD,
                                                         I.ISS_CNTS,
                                                         I.ACT_ID,
                                                         I.ACTS_DT,
                                                         I.ACTE_DT,
                                                         I.ACT_MH,
                                                         I.ACT_AMT,
                                                         I.CF_YN,
                                                         I.CF_ID,
                                                         I.CAUSE_CNTS,
                                                         I.ACT_CNTS,
                                                         I.CF_DIV,
                                                         I.CF_DTL_DIV,
                                                         I.CF_GRD,
                                                         I.CF_CNTS,
                                                         I.ISS_STS,
                                                         I.FILE_TRGT_KEY AS FILE_TRGT_KEY_I
                                                         
                                                         FROM (
                                                              SELECT TODO_KEY, 
                                                                     CO_CD, 
                                                                     TODO_CO_CD,
                                                                     TODO_DIV1_CODE_ID, 
                                                                     TODO_DIV2_CODE_ID,
                                                                     SALES_CD,
                                                                     TODO_ID, 
                                                                     TODO_CF_DT,
                                                                     TODO_CF_OPN,
                                                                     PG_PATH,
                                                                     TODO_NO,           
                                                                     TODO_FILE_TRGT_KEY,
                                                                     CREAT_ID,
                                                                     CREAT_PGM,
                                                                     CREAT_DTTM,
                                                                     UDT_ID,
                                                                     UDT_PGM,
                                                                     UDT_DTTM,
                                                                     PG_PARAM,
                                                                     
                                                                     TODO_CODE_KIND,
                                                                     '' AS TODO_CODE_ID,
                                                                     TODO_CODE_ID AS TODO_CODE_ID_01, 
                                                                     '' AS TODO_CODE_ID_02, 
                                                                     '' AS TODO_CODE_ID_03
                                                                     
                                                                     FROM TB_WB20M03
                                                                     WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 8 ) X
                                                        LEFT OUTER JOIN TB_WB01M01 P1   
                                                        ON X.TODO_CO_CD = P1.CO_CD
                                                        AND X.TODO_CODE_ID_01 = P1.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P1.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB02M01 R   
                                                        ON X.TODO_CO_CD = R.CO_CD
                                                        AND X.TODO_CODE_ID_01 = R.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = R.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB03M01 I   
                                                        ON X.TODO_CO_CD = I.CO_CD
                                                        AND X.TODO_CODE_ID_01 = I.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = I.SALES_CD
                                                        
                                                    UNION ALL 
                                                    -- 2레벨
                                                    SELECT X.TODO_KEY, 
                                                         X.CO_CD, 
                                                         X.TODO_CO_CD,
                                                         X.TODO_DIV1_CODE_ID, 
                                                         X.TODO_DIV2_CODE_ID,
                                                         X.SALES_CD,
                                                         X.TODO_ID,
                                                         X.TODO_CF_DT,
                                                         X.TODO_CF_OPN,
                                                         X.PG_PATH,
                                                         X.TODO_NO,           
                                                         X.TODO_FILE_TRGT_KEY,
                                                         X.CREAT_ID,
                                                         X.CREAT_PGM,
                                                         X.CREAT_DTTM,
                                                         X.UDT_ID,
                                                         X.UDT_PGM,
                                                         X.UDT_DTTM,
                                                         X.PG_PARAM,
                                                         2 AS LVL,
                                                         
                                                         X.TODO_CODE_KIND,
                                                         X.TODO_CODE_ID,
                                                         X.TODO_CODE_ID_01,
                                                         X.TODO_CODE_ID_02,
                                                         X.TODO_CODE_ID_03,
                                                         
                                                         P1.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_01,
                                                         P1.WBS_PLANS_DT AS WBS_PLANS_DT_01,
                                                         P1.WBS_PLANE_DT AS WBS_PLANE_DT_01,
                                                         P2.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_02,
                                                         P2.WBS_PLANS_DT AS WBS_PLANS_DT_02,
                                                         P2.WBS_PLANE_DT AS WBS_PLANE_DT_02,
                                                         NULL AS WBS_PLAN_MNG_ID_03,
                                                         NULL AS WBS_PLANS_DT_03,
                                                         NULL AS WBS_PLANE_DT_03,
                                                         
                                                         P2.WBS_PLAN_NO,
                                                         P2.WBS_PLAN_DT,
                                                         P2.WBS_PLAN_ID,
                                                         P2.WBS_PLAN_CNTS,
                                                         P2.WBS_PLAN_RMK,
                                                         P2.WBS_PLAN_STS_CODE_ID,
                                                         P2.DSGN_DIF_CODE_ID,
                                                         P2.DSGN_PLAN_HOUR,
                                                         P2.PRDCTN_DIF_CODE_ID,
                                                         P2.PRDCTN_PLAN_HOUR,
                                                         P2.WBS_PLAN_OS_YN,
                                                         P2.LOCK_YN AS LOCK_YN_P,
                                                         P2.CLOSE_YN AS CLOSE_YN_P,
                                                         P2.FILE_TRGT_KEY AS FILE_TRGT_KEY_P,
                                                         
                                                         R.WBS_PLAN_NO AS WBS_RSLTS_NO,
                                                         R.WBS_RSLTS_DT,
                                                         R.WBS_RSLTS_ID,
                                                         R.WBS_RSLTS_RATE,
                                                         R.WBS_PLAN_MH,
                                                         R.WBS_RSLTS_MH,
                                                         R.WBS_RSLTS_CNTS,
                                                         R.WBS_RSLTSS_DT,
                                                         R.WBS_RSLTSE_DT,
                                                         R.WBS_RSLTS_RMK,
                                                         R.LOCK_YN AS LOCK_YN_R,
                                                         R.CLOSE_YN AS CLOSE_YN_R,
                                                         R.FILE_TRGT_KEY AS FILE_TRGT_KEY_R,
                                                         
                                                         I.ISS_NO AS WBS_ISS_NO,
                                                         I.ACT_YN,
                                                         I.ISS_DIV,
                                                         I.ISS_DTL_DIV,
                                                         I.ISS_GRD,
                                                         I.ISS_CNTS,
                                                         I.ACT_ID,
                                                         I.ACTS_DT,
                                                         I.ACTE_DT,
                                                         I.ACT_MH,
                                                         I.ACT_AMT,
                                                         I.CF_YN,
                                                         I.CF_ID,
                                                         I.CAUSE_CNTS,
                                                         I.ACT_CNTS,
                                                         I.CF_DIV,
                                                         I.CF_DTL_DIV,
                                                         I.CF_GRD,
                                                         I.CF_CNTS,
                                                         I.ISS_STS,
                                                         I.FILE_TRGT_KEY AS FILE_TRGT_KEY_I
                                                         
                                                         FROM (
                                                              SELECT TODO_KEY, 
                                                                     CO_CD, 
                                                                     TODO_CO_CD,
                                                                     TODO_DIV1_CODE_ID, 
                                                                     TODO_DIV2_CODE_ID,
                                                                     SALES_CD,
                                                                     TODO_ID,
                                                                     TODO_CF_DT,
                                                                     TODO_CF_OPN,
                                                                     PG_PATH,
                                                                     TODO_NO,           
                                                                     TODO_FILE_TRGT_KEY,
                                                                     CREAT_ID,
                                                                     CREAT_PGM,
                                                                     CREAT_DTTM,
                                                                     UDT_ID,
                                                                     UDT_PGM,
                                                                     UDT_DTTM,
                                                                     PG_PARAM,
                                                                     
                                                                     TODO_CODE_KIND,
                                                                     '' AS TODO_CODE_ID,
                                                                     SUBSTR(TODO_CODE_ID,0,8) AS TODO_CODE_ID_01, 
                                                                     TODO_CODE_ID AS TODO_CODE_ID_02, 
                                                                     '' AS TODO_CODE_ID_03
                                                                     
                                                                     FROM TB_WB20M03
                                                                     WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 10 ) X
                                                        LEFT OUTER JOIN TB_WB01M01 P2   
                                                        ON X.TODO_CO_CD = P2.CO_CD
                                                        AND X.TODO_CODE_ID_02 = P2.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P2.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB01M01 P1   
                                                        ON X.TODO_CO_CD = P1.CO_CD
                                                        AND X.TODO_CODE_ID_01 = P1.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P1.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB02M01 R   
                                                        ON X.TODO_CO_CD = R.CO_CD
                                                        AND X.TODO_CODE_ID_02 = R.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = R.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB03M01 I   
                                                        ON X.TODO_CO_CD = I.CO_CD
                                                        AND X.TODO_CODE_ID_02 = I.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = I.SALES_CD
                                                        
                                                    UNION ALL 
                                                    -- 3레벨
                                                    SELECT X.TODO_KEY, 
                                                         X.CO_CD, 
                                                         X.TODO_CO_CD,
                                                         X.TODO_DIV1_CODE_ID, 
                                                         X.TODO_DIV2_CODE_ID,
                                                         X.SALES_CD,
                                                         X.TODO_ID,
                                                         X.TODO_CF_DT,
                                                         X.TODO_CF_OPN,
                                                         X.PG_PATH,
                                                         X.TODO_NO,           
                                                         X.TODO_FILE_TRGT_KEY,
                                                         X.CREAT_ID,
                                                         X.CREAT_PGM,
                                                         X.CREAT_DTTM,
                                                         X.UDT_ID,
                                                         X.UDT_PGM,
                                                         X.UDT_DTTM,
                                                         X.PG_PARAM,
                                                         3 AS LVL,
                                                         
                                                         X.TODO_CODE_KIND,
                                                         X.TODO_CODE_ID,
                                                         X.TODO_CODE_ID_01,
                                                         X.TODO_CODE_ID_02,
                                                         X.TODO_CODE_ID_03,
                                                         
                                                         P1.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_01,
                                                         P1.WBS_PLANS_DT AS WBS_PLANS_DT_01,
                                                         P1.WBS_PLANE_DT AS WBS_PLANE_DT_01,
                                                         P2.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_02,
                                                         P2.WBS_PLANS_DT AS WBS_PLANS_DT_02,
                                                         P2.WBS_PLANE_DT AS WBS_PLANE_DT_02,
                                                         P3.WBS_PLAN_MNG_ID AS WBS_PLAN_MNG_ID_03,
                                                         P3.WBS_PLANS_DT AS WBS_PLANS_DT_03,
                                                         P3.WBS_PLANE_DT AS WBS_PLANE_DT_03,
                                                         
                                                         P3.WBS_PLAN_NO,
                                                         P3.WBS_PLAN_DT,
                                                         P3.WBS_PLAN_ID,
                                                         P3.WBS_PLAN_CNTS,
                                                         P3.WBS_PLAN_RMK,
                                                         P3.WBS_PLAN_STS_CODE_ID,
                                                         P3.DSGN_DIF_CODE_ID,
                                                         P3.DSGN_PLAN_HOUR,
                                                         P3.PRDCTN_DIF_CODE_ID,
                                                         P3.PRDCTN_PLAN_HOUR,
                                                         P3.WBS_PLAN_OS_YN,
                                                         P3.LOCK_YN AS LOCK_YN_P,
                                                         P3.CLOSE_YN AS CLOSE_YN_P,
                                                         P3.FILE_TRGT_KEY AS FILE_TRGT_KEY_P,
                                                         
                                                         R.WBS_PLAN_NO AS WBS_RSLTS_NO,
                                                         R.WBS_RSLTS_DT,
                                                         R.WBS_RSLTS_ID,
                                                         R.WBS_RSLTS_RATE,
                                                         R.WBS_PLAN_MH,
                                                         R.WBS_RSLTS_MH,
                                                         R.WBS_RSLTS_CNTS,
                                                         R.WBS_RSLTSS_DT,
                                                         R.WBS_RSLTSE_DT,
                                                         R.WBS_RSLTS_RMK,
                                                         R.LOCK_YN AS LOCK_YN_R,
                                                         R.CLOSE_YN AS CLOSE_YN_R,
                                                         R.FILE_TRGT_KEY AS FILE_TRGT_KEY_R,
                                                         
                                                         I.ISS_NO AS WBS_ISS_NO,
                                                         I.ACT_YN,
                                                         I.ISS_DIV,
                                                         I.ISS_DTL_DIV,
                                                         I.ISS_GRD,
                                                         I.ISS_CNTS,
                                                         I.ACT_ID,
                                                         I.ACTS_DT,
                                                         I.ACTE_DT,
                                                         I.ACT_MH,
                                                         I.ACT_AMT,
                                                         I.CF_YN,
                                                         I.CF_ID,
                                                         I.CAUSE_CNTS,
                                                         I.ACT_CNTS,
                                                         I.CF_DIV,
                                                         I.CF_DTL_DIV,
                                                         I.CF_GRD,
                                                         I.CF_CNTS,
                                                         I.ISS_STS,
                                                         I.FILE_TRGT_KEY AS FILE_TRGT_KEY_I
                                                         
                                                         FROM (
                                                              SELECT TODO_KEY, 
                                                                     CO_CD, 
                                                                     TODO_CO_CD,
                                                                     TODO_DIV1_CODE_ID, 
                                                                     TODO_DIV2_CODE_ID,
                                                                     SALES_CD,
                                                                     TODO_ID,
                                                                     TODO_CF_DT,
                                                                     TODO_CF_OPN,
                                                                     PG_PATH,
                                                                     TODO_NO,           
                                                                     TODO_FILE_TRGT_KEY,
                                                                     CREAT_ID,
                                                                     CREAT_PGM,
                                                                     CREAT_DTTM,
                                                                     UDT_ID,
                                                                     UDT_PGM,
                                                                     UDT_DTTM,
                                                                     PG_PARAM,
                                                                     
                                                                     TODO_CODE_KIND,
                                                                     '' AS TODO_CODE_ID,
                                                                     SUBSTR(TODO_CODE_ID,0,8) AS TODO_CODE_ID_01, 
                                                                     SUBSTR(TODO_CODE_ID,0,10) AS TODO_CODE_ID_02, 
                                                                     TODO_CODE_ID AS TODO_CODE_ID_03
                                                                     
                                                                     FROM TB_WB20M03
                                                                     WHERE LENGTH(NVL(TODO_CODE_ID,'0')) = 12 ) X
                                                        LEFT OUTER JOIN TB_WB01M01 P3   
                                                        ON X.TODO_CO_CD = P3.CO_CD
                                                        AND X.TODO_CODE_ID_03 = P3.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P3.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB01M01 P2   
                                                        ON X.TODO_CO_CD = P2.CO_CD
                                                        AND X.TODO_CODE_ID_02 = P2.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P2.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB01M01 P1   
                                                        ON X.TODO_CO_CD = P1.CO_CD
                                                        AND X.TODO_CODE_ID_01 = P1.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = P1.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB02M01 R   
                                                        ON X.TODO_CO_CD = R.CO_CD
                                                        AND X.TODO_CODE_ID_03 = R.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = R.SALES_CD
                                                        
                                                        LEFT OUTER JOIN TB_WB03M01 I   
                                                        ON X.TODO_CO_CD = I.CO_CD
                                                        AND X.TODO_CODE_ID_03 = I.WBS_PLAN_CODE_ID
                                                        AND X.SALES_CD = I.SALES_CD ) T
                                           LEFT OUTER JOIN (                
                                              SELECT  X1.CO_CD,
                                                       X1.SALES_CD,
                                                       Y1.ORDRS_CLNT_CD, -- 고객사
                                                       Y1.CLNT_PJT, -- 고객사 PJT
                                                       X1.ORDRS_DTL_DIV20, -- 신작구분
                                                       X1.PRDT_CD, -- 제품구분
                                                       X1.ITEM_DIV, -- 아이템구분
                                                       X1.EQP_NM -- 설비명
                                                       FROM TB_CR02D02 X1
                                                        INNER JOIN TB_CR02M01 Y1
                                                        ON X1.CO_CD = Y1.CO_CD
                                                        AND X1.ORDRS_NO = Y1.ORDRS_NO ) C 
                                            ON T.TODO_CO_CD = C.CO_CD
                                            AND T.SALES_CD = C.SALES_CD ) T                
                                 
                                 WHERE T.TODO_CO_CD = #{coCd}                 
                                 AND T.CREAT_DTTM1 BETWEEN #{wbsPlansDt} AND #{wbsPlaneDt} 
                                 <if test="salesCd != null and !salesCd.equals('')">
                                    AND T.SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
                                 </if>
                                 <if test="!clntCd.equals('') and !clntNm.equals('')">
                                     AND T.ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
                                 </if>
                                 <if test="clntCd.equals('') and !clntNm.equals('')">
                                     AND T.ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
                                 </if>                               
                                 <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
                                    AND T.TODO_ID = '${salesMngId}'                                   
                                 </if> 
                                 <if test="salesMngId.equals('') and !salesMngNm.equals('')">
                                    AND T.TODO_NM LIKE '%${salesMngNm}%'                                  
                                 </if>
                                 <if test="!todoDiv.equals('')">
                                    AND T.TODO_DIV1_CODE_ID = #{todoDiv}                                  
                                 </if>
                                 ) T ) T
           </select>
           
           <select id="selectApprovalChk" parameterType="Map" resultType="camelMap">
		       SELECT NVL(COUNT(*),0) AS CNT FROM (
                      SELECT X.TODO_KEY, X.TODO_CF_DT, 
                             (SELECT MIN(Y.TODO_KEY) FROM TB_WB20M03 Y
                                  WHERE Y.TODO_CO_CD = #{todoCoCd}
                                   AND Y.SALES_CD = #{salesCd}
                                   AND Y.TODO_FILE_TRGT_KEY = #{todoFileTrgtKey}
                                   AND Y.TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
                                   AND Y.TODO_DIV2_CODE_ID = #{todoDiv2CodeId}) AS CHK
                                   FROM TB_WB20M03 X 
                           WHERE X.TODO_CO_CD = #{todoCoCd}
                           AND X.SALES_CD = #{salesCd}
                           AND X.TODO_FILE_TRGT_KEY = #{todoFileTrgtKey}
                           AND X.TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
                           AND X.TODO_DIV2_CODE_ID = #{todoDiv2CodeId}) S
               WHERE TODO_KEY BETWEEN CHK AND TO_NUMBER(#{todoKey, jdbcType=VARCHAR})-1
               AND  TODO_CF_DT IS NULL 
                      
           </select>  
           
           
           
           <select id="selectTodoDivList" parameterType="Map" resultType="camelMap">
				SELECT CODE_ID, CODE_NM FROM TB_CM05M01 WHERE CODE_KIND = 'TODODIV'
				AND CODE_ID IN ('TODODIV10','TODODIV20') ORDER BY CODE_ID ASC
           </select>   
           
           <select id="selectApprovalYnList" parameterType="Map" resultType="camelMap">
	           SELECT Y.ID, 
	                  Y.NAME, 
	                  Y.DEPT_ID, 
	                  D.DEPT_NM, 
	                  Y.LEVEL_CD, 
	                  L.LEVEL_NM,
	                  X.TODO_CF_DT 
	                  FROM (
						        SELECT TODO_KEY, CO_CD, TODO_ID, TODO_CF_DT FROM TB_WB20M03
						        WHERE TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
						        AND TODO_DIV2_CODE_ID = #{todoDiv2CodeId}
						        AND CO_CD = #{coCd}
						        AND SALES_CD = #{salesCd}
						        AND TODO_FILE_TRGT_KEY = #{fileTrgtKey} 
						        ORDER BY TODO_KEY ASC						        
				        ) X
				       INNER JOIN TB_CM06M01 Y 
				       ON X.CO_CD = Y.CO_CD
				       AND X.TODO_ID = Y.ID 
				       LEFT OUTER JOIN TB_CM04M01 D
				       ON Y.DEPT_ID = D.DEPT_ID 
				       LEFT OUTER JOIN TB_CM07M01 L
				       ON Y.LEVEL_CD = L.LEVEL_CD
			         
			</select>          
        
        
           <select id="selectApprovalMaxTodoKeyChk" parameterType="Map" resultType="camelMap">
               SELECT MAX(TODO_KEY) AS TODO_KEY FROM (
                      SELECT X.TODO_KEY, X.TODO_CF_DT, 
                             (SELECT MIN(Y.TODO_KEY) FROM TB_WB20M03 Y
                                  WHERE Y.TODO_CO_CD = #{todoCoCd}
                                   AND Y.SALES_CD = #{salesCd}
                                   AND Y.TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
                                   AND Y.TODO_DIV2_CODE_ID = #{todoDiv2CodeId}) AS CHK
                                   FROM TB_WB20M03 X 
                           WHERE X.TODO_CO_CD = #{todoCoCd}
                           AND X.SALES_CD = #{salesCd}
                           AND X.TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
                           AND X.TODO_DIV2_CODE_ID = #{todoDiv2CodeId}) S
               WHERE TODO_KEY BETWEEN CHK AND TO_NUMBER(#{todoKey, jdbcType=VARCHAR})-1
               AND  NVL(TO_CHAR(TODO_CF_DT,'YYYY-MM-DD'),'') = ''                       
           </select>  
           
            <update id="updateRsltsQmApproval" parameterType="Map">
                UPDATE TB_WB20M03
                   SET TODO_CF_DT = #{todoCfDt},
                       TODO_CF_OPN = #{todoCfOpn},
                       UDT_ID = #{creatId},
                       UDT_PGM = #{creatPgm},
                       UDT_DTTM = SYSDATE
                 WHERE 
                       TODO_KEY = #{todoKey}
           </update>
           
           <update id="updateQmQeqst" parameterType="Map">
                UPDATE TB_WB20M03
                   SET TODO_CF_DT = #{todoCfDt},
                       TODO_CF_OPN = #{todoCfOpn},
                       UDT_ID = #{creatId},
                       UDT_PGM = #{creatPgm},
                       UDT_DTTM = SYSDATE
                 WHERE 
                       TODO_KEY = #{todoKey}
           </update>
                      
    <update id="updateQmMobileApproval" parameterType="Map">
         UPDATE TB_WB20M03
            SET TODO_CF_DT = #{todoCfDt},
                TODO_CF_OPN = #{todoCfOpn},
                UDT_ID = #{todoId},
                UDT_PGM = #{creatPgm},
                UDT_DTTM = SYSDATE
          WHERE 
                TODO_FILE_TRGT_KEY = #{todoFileTrgtKey}
                AND TODO_CO_CD = #{todoCoCd}
                AND TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
                AND TODO_DIV2_CODE_ID = #{todoDiv2CodeId}
                AND SALES_CD = #{salesCd}
                AND SANCTN_SN = #{sanctnSn}
    </update>   
    
    <select id="selectGetDeptList" parameterType="Map" resultType="camelMap">
        SELECT CODE_ID, CODE_NM FROM TB_CM05M01 WHERE CODE_ID LIKE 'COBGB%'        
    </select> 
                  
                  
	<!-- 결재목록 및 결재상태 결재버튼 등 불러오기 -->
	<select id="selectApprovalList" parameterType="Map" resultType="camelMap">
		SELECT TODO_KEY
			, SANCTN_SN
			, CO_CD
			, TODO_DIV1_CODE_ID
			, TODO_DIV2_CODE_ID
			, TODO_ID			/* 대상자 ID */
			,
			(
				SELECT NAME
					FROM TB_CM06M01 B
				WHERE A.TODO_ID = B.ID
			) AS TODO_NM		/* 작성자 이름 */
			, NVL(TO_CHAR(TODO_CF_DT, 'YYYY-MM-DD'), ' ') AS TODO_CF_DT		/* 승인일자 */
			, TODO_CF_OPN
			, SANCTN_STTUS
			, DECODE(SANCTN_STTUS, 'Y', '승인', 'N', '미승인', ' ') AS SANCTN_STTUS_NM
			, 
			(
				SELECT SANCTN_STTUS
					FROM
					(
					SELECT SANCTN_STTUS 
						, ROWNUM RN
						FROM TB_WB20M03 B
					WHERE 1=1
						  AND B.SANCTN_SN <![CDATA[ < ]]> A.SANCTN_SN
						  AND A.CO_CD = B.CO_CD 
						  AND A.TODO_KEY <![CDATA[ > ]]>  B.TODO_KEY
						  AND A.TODO_ID <![CDATA[ <> ]]>  B.TODO_ID
						AND A.CO_CD = B.CO_CD                                  
						AND A.TODO_DIV1_CODE_ID = B.TODO_DIV1_CODE_ID                                  
						AND A.TODO_DIV2_CODE_ID = B.TODO_DIV2_CODE_ID                                  
						AND A.SALES_CD = B.SALES_CD				
					)
					WHERE RN=1
			) AS PRE_STTUS 			/* 하위 완료여부 */			
			, SALES_CD
			, PG_PATH
			, SUBSTR(PG_PATH, INSTR(PG_PATH, '/', -1)+1) AS DOC_NM		/* 문서명 pgmId */
			, TODO_FILE_TRGT_KEY
			, TODO_CO_CD
			, TODO_NO
			, TODO_CODE_KIND
			, TODO_CODE_ID
			, NVL(NVL(TO_CHAR(SYSDATE, 'YYYY-MM-DD'), TO_CHAR(CREAT_DTTM, 'YYYY-MM-DD')), ' ') AS CREAT_DTTM
			, PG_PARAM
			FROM TB_WB20M03 A
		WHERE 1=1		
			<if test="todoKey != null and !todoKey.equals('')">			
				AND TODO_KEY = #{todoKey}                                  
			</if>
			<if test="sanctnSn != null and !sanctnSn.equals('')">			
				AND SANCTN_SN = #{sanctnSn}                                  
			</if>   
			<if test="coCd != null and !coCd.equals('')">
				AND CO_CD = #{coCd}                                  
			</if>   								
			<if test="todoDiv1CodeId != null and !todoDiv1CodeId.equals('')">
				AND TODO_DIV1_CODE_ID = #{todoDiv1CodeId}                                  
			</if>
			<if test="todoDiv2CodeId != null and !todoDiv2CodeId.equals('')">
				AND TODO_DIV2_CODE_ID = #{todoDiv2CodeId}                                  
			</if>
			<!-- TO_DO ~ 시작컬럼은 대상업무에서 넘어온 데이터 -->
			<if test="salesCd != null and !salesCd.equals('')">
				AND SALES_CD = #{salesCd}                                  
			</if> 			
			<if test="pgPath != null and !pgPath.equals('')">
				<!-- / 로 SLIT 하여 마지막부분이 문서명 -->
				AND PG_PATH = #{pgPath}                                  
			</if>   					
			<if test="todoFileTrgtKey != null and !todoFileTrgtKey.equals('')">
				AND TODO_FILE_TRGT_KEY = #{todoFileTrgtKey}                                  
			</if>
			<if test="todoCoCd != null and !todoCoCd.equals('')">
				AND TODO_CO_CD = #{todoCoCd}                                  
			</if>   			   
			<if test="todoNo != null and !todoNo.equals('')">
				AND TODO_NO = #{todoNo}                                  
			</if>   	
		ORDER BY SANCTN_SN DESC																			        			                      
	</select>             
           
	<!-- 결재 승인 -->
	<update id="updateApprovalLine" parameterType="Map">
		UPDATE TB_WB20M03
			SET
		TODO_CF_DT = SYSDATE
		, SANCTN_STTUS = 'Y'
		, UDT_PGM = #{pgmId}
		, UDT_DTTM = SYSDATE
		WHERE TODO_KEY = #{todoKey}
			AND SANCTN_SN = #{sanctnSn}
			AND CO_CD = #{coCd}
			AND TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
			AND TODO_DIV2_CODE_ID = #{todoDiv2CodeId}
	</update>	 
	
	<!-- 결재대상자 SELECT  -->
	<select id="selectSignResUserlst" parameterType="Map" resultType="camelMap"> 
	  SELECT *
	   FROM(
		SELECT
			ROWNUM AS RNUM, A.*
		FROM
		(
			SELECT   C.CO_CD
			         , A.ID AS WBS_SHARNG_USER_ID
			         , A.EMP_NO AS EMP_NO
					 , A.NAME AS USR_NM
					 , A.TEL_NO AS TEL_NO
					 , A.EMAIL AS EMAIL
					 , B.DEPT_NM AS DT_NM
					 , C.TODO_NO AS RSLT_N
					 , (SELECT D.LEVEL_NM FROM TB_CM07M01 D WHERE D.LEVEL_CD=A.LEVEL_CD) AS LEVEL_NM     /* 직급 */
					 , C.SANCTN_STTUS
					 , DECODE(C.SANCTN_STTUS, 'Y', '승인', 'N', '미승인', ' ') AS SANCTN_STTUS_NM
					 , NVL(TO_CHAR(C.TODO_CF_DT, 'YYYY-MM-DD'), ' ') AS TODO_CF_DT		/* 승인일자 */
					 , C.TODO_KEY
					 , C.SANCTN_SN
					 , C.TODO_ID
					 , C.TODO_DIV1_CODE_ID
					 , C.TODO_DIV2_CODE_ID
					 , C.SALES_CD
					 , C.TODO_FILE_TRGT_KEY
					 , C.PG_PARAM					 
			FROM
				TB_CM06M01 A 
				INNER JOIN TB_CM04M01 B on A.DEPT_ID = B.DEPT_ID
				INNER JOIN TB_WB20M03 C ON(A.ID = C.TODO_ID)
			WHERE 1=1	
			<if test="salesCd != null and !salesCd.equals('')">
				AND SALES_CD = #{salesCd}                                  
			</if>   		
			<if test="todoNo != null and !todoNo.equals('')">
				AND TODO_NO = #{todoNo}                                  
			</if>   	
			<if test="todoDiv1CodeId != null and !todoDiv1CodeId.equals('')">
				AND C.TODO_DIV1_CODE_ID = #{todoDiv1CodeId}                                  
			</if>  
			<if test="todoDiv2CodeId != null and !todoDiv2CodeId.equals('')">
				AND C.TODO_DIV2_CODE_ID = #{todoDiv2CodeId}                                  
			</if>  														
			) AS a
	  ) A
	</select>
	
	<!-- 결재 등록시 사용자 검색후 부서등 SELECT  -->
	<select id="selectShareUserInfo" parameterType="Map" resultType="camelMap">
	    SELECT  A.CO_CD AS CO_CD,
	    		C.CODE_NM AS CO_NM,
				A.ID AS ID,
				A.ID AS TODO_ID,
		        A.EMP_NO AS EMP_NO,
				A.NAME AS USR_NM,
				A.TEL_NO AS TEL_NO,
				A.EMAIL AS EMAIL,
				B.DEPT_NM AS DT_NM
				, (SELECT T.LEVEL_NM FROM TB_CM07M01 T WHERE T.LEVEL_CD=A.LEVEL_CD) AS LEVEL_NM 
			FROM
				TB_CM06M01 A 
				INNER JOIN TB_CM04M01 B on A.DEPT_ID = B.DEPT_ID
				INNER JOIN TB_CM05M01 C ON A.CO_CD = C.CODE_ID 
				AND	A.USE_YN = 'Y'
			    AND A.CO_CD = '${coCd}'
			    AND A.ID =  '${userId}' 
	</select>	
	
	<select id="selectmaxTodoKey" parameterType="Map" resultType="String">
		SELECT NVL(MAX(TODO_KEY)+1, 1) FROM TB_WB20M03 
			WHERE 1=1 
			AND CO_CD = #{coCd}
			AND TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
			AND TODO_DIV2_CODE_ID = #{todoDiv2CodeId}	
	</select>
		                 
	<!-- todo insert -->
	<insert id="insertTodoMaster" parameterType="Map">				
		MERGE INTO TB_WB20M03 
			USING DUAL
			ON (
				TODO_KEY = #{todoKey}
				AND SANCTN_SN = #{sanctnSn} 
				AND CO_CD = #{coCd}
				AND TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
				AND TODO_DIV2_CODE_ID = #{todoDiv2CodeId} 
				)		
		WHEN MATCHED THEN
			UPDATE SET	
				TODO_ID = #{todoId,								jdbcType=VARCHAR}
				, SALES_CD = #{salesCd,							jdbcType=VARCHAR}
				, PG_PATH = #{pgPath,							jdbcType=VARCHAR}
				, TODO_FILE_TRGT_KEY = #{todoFileTrgtKey,		jdbcType=VARCHAR}
				, TODO_CO_CD = #{todoCoCd}
				, TODO_NO = #{todoNo}
				, TODO_CODE_KIND = #{todoCodeKind,				jdbcType=VARCHAR} 
				, TODO_CODE_ID = #{todoCodeId,					jdbcType=VARCHAR}
				, UDT_ID = #{userId}
				, UDT_PGM = #{pgmId}
				/* , UDT_DTTM = SYSDATE */
				, PG_PARAM = #{pgParam,							jdbcType=VARCHAR}          
		WHEN NOT MATCHED THEN						
		INSERT 
		(		
			TODO_KEY
			, SANCTN_SN
			, CO_CD
			, TODO_DIV1_CODE_ID
			, TODO_DIV2_CODE_ID
			, TODO_ID
			, TODO_CF_DT
			, TODO_CF_OPN
			, SANCTN_STTUS
			, SALES_CD
			, PG_PATH
			, TODO_FILE_TRGT_KEY
			, TODO_CO_CD
			, TODO_NO
			, TODO_CODE_KIND
			, TODO_CODE_ID
			, CREAT_ID
			, CREAT_PGM
			, CREAT_DTTM
			, PG_PARAM                
		) 
		VALUES
		(       
			#{todoKey}
			, #{sanctnSn}
			, #{coCd}
			, #{todoDiv1CodeId}
			, #{todoDiv2CodeId}
			, #{todoId,					jdbcType=VARCHAR}
			, #{todoCfDt,				jdbcType=VARCHAR}
			, #{todoCfOpn,				jdbcType=VARCHAR}
			, #{sanctnSttus}
			, #{salesCd,				jdbcType=VARCHAR}
			, #{pgPath,					jdbcType=VARCHAR}
			, #{todoFileTrgtKey,		jdbcType=VARCHAR}
			, #{todoCoCd}
			, #{todoNo}
			, #{todoCodeKind,			jdbcType=VARCHAR}
			, #{todoCodeId,				jdbcType=VARCHAR}
			, #{userId}
			, #{pgmId}
			, SYSDATE
			, #{pgParam,				jdbcType=VARCHAR}    
		)            
	</insert>  
	<!-- todo insert -->
	
	<!-- 결재 todo  삭제 -->         
	<delete id="deleteTodoMaster" parameterType="Map">
		DELETE 
			FROM TB_WB20M03
		WHERE 1=1
			AND TODO_KEY = #{todoKey}
			AND SANCTN_SN = #{sanctnSn} 
			AND CO_CD = #{coCd}
			AND TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
			AND TODO_DIV2_CODE_ID = #{todoDiv2CodeId} 
	</delete>			                 
	                 
 </mapper>