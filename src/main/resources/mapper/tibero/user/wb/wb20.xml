<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.wb.wb20.mapper.WB20Mapper">

          <!-- ToDo List  메인 화면 조회 카운터  -->
          <select id="selectToDoCount" parameterType="Map" resultType="int">
          SELECT COUNT(*) FROM (
                    SELECT ROWNUM AS RN, Z.* FROM (
                               SELECT 
                                    TODO_KEY,
                                    X.CO_CD,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
                                    TODO_DIV1_CODE_ID,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.TODO_DIV1_CODE_ID) AS TODO_DIV1_CODE_NM,
                                    TODO_DIV2_CODE_ID,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.TODO_DIV2_CODE_ID) AS TODO_DIV2_CODE_NM,
                                    TODO_ID,
                                    (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.TODO_ID) AS TODO_NM,
                                    (SELECT Y.WBS_PLAN_CNTS FROM TB_WB01M01 Y WHERE Y.CO_CD = X.CO_CD 
                                              AND Y.WBS_PLAN_CODE_KIND = X.WBS_PLAN_CODE_KIND
                                              AND Y.WBS_PLAN_CODE_ID = X.WBS_PLAN_CODE_ID
                                              AND Y.WBS_PLAN_NO = X.WBS_PLAN_NO
                                              AND Y.SALES_CD = Y.SALES_CD) AS WBS_PLAN_CNTS, -- TO-DO LIST 주요내용
                                    NULL AS TODO_CHK,
                                    TO_CHAR(X.TODO_CF_DT, 'YYYY-MM-DD') AS TODO_CF_DT,
                                    TODO_CF_OPN,
                                    X.SALES_CD,
                                    Y.ORDRS_CLNT_CD,
                                    (SELECT T.CLNT_NM FROM TB_BM02M01 T WHERE T.CLNT_CD =Y.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                                    Y.CLNT_PJT,
                                    Y.ORDRS_DTL_DIV20,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = Y.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                                    Y.PRDT_CD,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = Y.PRDT_CD) AS PRDT_CD_NM,
                                    Y.ITEM_DIV,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = Y.ITEM_DIV) AS ITEM_DIV_NM,
                                    Y.EQP_NM,
                                    X.PG_PATH,
                                    X.WBS_PLANCO_CD,
                                    X.WBS_PLAN_NO,
                                    X.WBS_PLAN_CODE_KIND,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_CODE_KIND) AS WBS_PLAN_CODE_KIND_NM,
                                    X.WBS_PLAN_CODE_ID,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_CODE_ID) AS WBS_PLAN_CODE_NM,
                                    WBS_RSLTS_CO_CD,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS WBS_RSLTS_CO_CD_NM,
                                    WBS_RSLTS_PLAN_NO,
                                    WBS_RSLTS_PLAN_CODE_KIND,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_RSLTS_PLAN_CODE_KIND) AS WBS_RSLTS_PLAN_CODE_KIND_NM,
                                    WBS_RSLTS_PLAN_CODE_ID,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_RSLTS_PLAN_CODE_ID) AS WBS_RSLTS_PLAN_CODE_ID_NM,
                                    X.CREAT_ID,
                                    (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,
                                    X.CREAT_PGM,
                                    TO_CHAR(X.CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM,
                                    TO_CHAR(X.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM1,
                                    X.UDT_ID,
                                    (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,
                                    X.UDT_PGM,
                                    TO_CHAR(X.UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM
                                    FROM TB_WB20M01 X 
                                    INNER JOIN (                
                                        SELECT         X1.CO_CD,
                                                           X1.SALES_CD,
                                                           Y1.ORDRS_CLNT_CD, -- 고객사
                                                           Y1.CLNT_PJT, -- 고객사 PJT
                                                           X1.ORDRS_DTL_DIV20, -- 신작구분
                                                           X1.PRDT_CD, -- 제품구분
                                                           X1.ITEM_DIV, -- 아이템구분
                                                           X1.EQP_NM -- 설비명
                                                           FROM TB_CR02D02 X1
                                                    INNER JOIN TB_CR02M01 Y1
                                                    ON X1.CO_CD = Y1.CO_CD
                                                    AND X1.ORDRS_NO = Y1.ORDRS_NO ) Y 
                                    ON X.CO_CD = Y.CO_CD
                                    AND X.SALES_CD = Y.SALES_CD                            
                                 ORDER BY TODO_KEY DESC ) Z )                                                                   
                                 WHERE CO_CD LIKE '%${coCd}%'
                                 AND CREAT_DTTM1 BETWEEN '${wbsPlansDt}' AND '${wbsPlaneDt}'
                                 <if test="salesCd != null and !salesCd.equals('')">
                                    AND SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
                                 </if>
                                 <if test="!clntCd.equals('') and !clntNm.equals('')">
                                     AND ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
                                 </if>
                                 <if test="clntCd.equals('') and !clntNm.equals('')">
                                     AND ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
                                 </if>
                                 <if test="!prdtDiv.equals('') and !prdtDivNm.equals('')">
                                    AND PRDT_CD LIKE '%${prdtDiv}%' <!--  제품구분 검색    -->               
                                 </if>             
                                 <if test="prdtDiv.equals('') and !prdtDivNm.equals('')">
                                    AND PRDT_CD_NM LIKE '%${prdtDivNm}%' <!--  제품구분명 검색    -->               
                                 </if>
                                 
                                 <if test="prdtItem != null and !prdtItem.equals('')">
                                    AND ITEM_DIV LIKE '%${prdtItem}%'  <!--  아이템구분 검색    -->              
                                 </if> 
                                 <if test="wbsClntPjt != null and !wbsClntPjt.equals('')">
                                    AND CLNT_PJT LIKE '%${wbsClntPjt}%'  <!--  고객사 PJT 검색    -->              
                                 </if> 
                                 <if test="eqp_nm != null and !eqp_nm.equals('')">
                                    AND EQP_NM LIKE '%${eqp_nm}%'   <!--  설비명 검색    -->             
                                 </if>
                                 <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
                                    AND TODO_ID = '${salesMngId}'                                     
                                 </if> 
                                 <if test="salesMngId.equals('') and !salesMngNm.equals('')">
                                    AND TODO_NM LIKE '%${salesMngNm}%'                                  
                                 </if> 
          </select>
          
          <!-- ToDo List 메인 화면 조회 리스트  -->
          <select id="selectToDoList" parameterType="Map" resultType="camelMap">  
           SELECT * FROM (
		          SELECT ROWNUM AS RN, T.*, M1.FILE_TRGT_KEY AS M_FILE_TRGT_KEY, M2.FILE_TRGT_KEY AS R_FILE_TRGT_KEY  FROM (
		                    SELECT  Z.* FROM (
		                               SELECT 
		                                    TODO_KEY,
		                                    X.CO_CD,
		                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
		                                    TODO_DIV1_CODE_ID,
		                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.TODO_DIV1_CODE_ID) AS TODO_DIV1_CODE_NM,
		                                    TODO_DIV2_CODE_ID,
		                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.TODO_DIV2_CODE_ID) AS TODO_DIV2_CODE_NM,
		                                    TODO_ID,
		                                    (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.TODO_ID) AS TODO_NM,                                    
		                                    (SELECT Y.WBS_PLAN_CNTS FROM TB_WB01M01 Y WHERE Y.CO_CD = X.CO_CD 
		                                              AND Y.WBS_PLAN_CODE_KIND = X.WBS_PLAN_CODE_KIND
		                                              AND Y.WBS_PLAN_CODE_ID = X.WBS_PLAN_CODE_ID
		                                              AND Y.WBS_PLAN_NO = X.WBS_PLAN_NO
		                                              AND Y.SALES_CD = Y.SALES_CD) AS WBS_PLAN_CNTS,
		                                    NULL AS TODO_CHK,
		                                    TO_CHAR(X.TODO_CF_DT, 'YYYY-MM-DD') AS TODO_CF_DT,
		                                    TODO_CF_OPN,
		                                    X.SALES_CD,
		                                    Y.ORDRS_CLNT_CD,
		                                    (SELECT T.CLNT_NM FROM TB_BM02M01 T WHERE T.CLNT_CD =Y.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
		                                    Y.CLNT_PJT,
		                                    Y.ORDRS_DTL_DIV20,
		                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = Y.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
		                                    Y.PRDT_CD,
		                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = Y.PRDT_CD) AS PRDT_CD_NM,
		                                    Y.ITEM_DIV,
		                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = Y.ITEM_DIV) AS ITEM_DIV_NM,
		                                    Y.EQP_NM,
		                                    X.PG_PATH,
		                                    X.WBS_PLANCO_CD,
		                                    X.WBS_PLAN_NO,
		                                    X.WBS_PLAN_CODE_KIND,
		                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_CODE_KIND) AS WBS_PLAN_CODE_KIND_NM,
		                                    X.WBS_PLAN_CODE_ID,
		                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_CODE_ID) AS WBS_PLAN_CODE_NM,
		                                    WBS_RSLTS_CO_CD,
		                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS WBS_RSLTS_CO_CD_NM,
		                                    WBS_RSLTS_PLAN_NO,
		                                    WBS_RSLTS_PLAN_CODE_KIND,
		                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_RSLTS_PLAN_CODE_KIND) AS WBS_RSLTS_PLAN_CODE_KIND_NM,
		                                    WBS_RSLTS_PLAN_CODE_ID,
		                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_RSLTS_PLAN_CODE_ID) AS WBS_RSLTS_PLAN_CODE_ID_NM,
		                                    X.CREAT_ID,
		                                    (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,
		                                    X.CREAT_PGM,
		                                    TO_CHAR(X.CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM,
		                                    TO_CHAR(X.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM1,
		                                    X.UDT_ID,
		                                    (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,
		                                    X.UDT_PGM,
		                                    TO_CHAR(X.UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM
		                                    FROM TB_WB20M01 X 
		                                    INNER JOIN (                
		                                        SELECT         X1.CO_CD,
		                                                           X1.SALES_CD,
		                                                           Y1.ORDRS_CLNT_CD, -- 고객사
		                                                           Y1.CLNT_PJT, -- 고객사 PJT
		                                                           X1.ORDRS_DTL_DIV20, -- 신작구분
		                                                           X1.PRDT_CD, -- 제품구분
		                                                           X1.ITEM_DIV, -- 아이템구분
		                                                           X1.EQP_NM -- 설비명
		                                                           FROM TB_CR02D02 X1
		                                                    INNER JOIN TB_CR02M01 Y1
		                                                    ON X1.CO_CD = Y1.CO_CD
		                                                    AND X1.ORDRS_NO = Y1.ORDRS_NO ) Y 
		                                    ON X.CO_CD = Y.CO_CD
		                                    AND X.SALES_CD = Y.SALES_CD                            
		                                 ORDER BY TODO_KEY DESC ) Z ) T 
		                                 
		                                 LEFT OUTER JOIN TB_WB01M01 M1 
		                                 ON T.CO_CD = M1.CO_CD
		                                 AND T.SALES_CD = M1.SALES_CD
		                                 AND T.WBS_PLAN_CODE_KIND = M1.WBS_PLAN_CODE_KIND
		                                 AND T.WBS_PLAN_CODE_ID = M1.WBS_PLAN_CODE_ID
		                                 
		                                 LEFT OUTER JOIN TB_WB02M01 M2 
                                         ON T.CO_CD = M2.CO_CD
                                         AND T.SALES_CD = M2.SALES_CD
                                         AND T.WBS_RSLTS_PLAN_CODE_KIND  = M2.WBS_PLAN_CODE_KIND
                                         AND T.WBS_RSLTS_PLAN_CODE_ID = M2.WBS_PLAN_CODE_ID
                                                                                                         
		                                 WHERE T.CO_CD LIKE '%${coCd}%'
							                AND T.CREAT_DTTM1 BETWEEN '${wbsPlansDt}' AND '${wbsPlaneDt}' 
		                                 <if test="salesCd != null and !salesCd.equals('')">
							                AND T.SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
							             </if>
							             <if test="!clntCd.equals('') and !clntNm.equals('')">
							                 AND T.ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
							             </if>
							             <if test="clntCd.equals('') and !clntNm.equals('')">
							                 AND T.ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
							             </if>
							             <if test="!prdtDiv.equals('') and !prdtDivNm.equals('')">
							                AND T.PRDT_CD LIKE '%${prdtDiv}%' <!--  제품구분 검색    -->               
							             </if>             
							             <if test="prdtDiv.equals('') and !prdtDivNm.equals('')">
							                AND T.PRDT_CD_NM LIKE '%${prdtDivNm}%' <!--  제품구분명 검색    -->               
							             </if>
							             
							             <if test="prdtItem != null and !prdtItem.equals('')">
							                AND T.ITEM_DIV LIKE '%${prdtItem}%'  <!--  아이템구분 검색    -->              
							             </if> 
							             <if test="wbsClntPjt != null and !wbsClntPjt.equals('')">
							                AND T.CLNT_PJT LIKE '%${wbsClntPjt}%'  <!--  고객사 PJT 검색    -->              
							             </if> 
							             <if test="eqp_nm != null and !eqp_nm.equals('')">
							                AND T.EQP_NM LIKE '%${eqp_nm}%'   <!--  설비명 검색    -->             
							             </if>
							             <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
							                AND T.TODO_ID = '${salesMngId}'					                  
							             </if> 
							             <if test="salesMngId.equals('') and !salesMngNm.equals('')">
		                                    AND T.TODO_NM LIKE '%${salesMngNm}%'                                  
		                                 </if> 
		                                 
                )            
			    WHERE RN BETWEEN ${firstIndex} AND ${lastIndex}
					 
		   </select>


           <update id="toDoCfDtUpdate" parameterType="Map">
                UPDATE TB_WB20M01
                   SET TODO_CF_DT = #{todoCfDt},
                       UDT_ID = #{creatId},
                       UDT_PGM = #{creatPgm},
                       UDT_DTTM = SYSDATE
                 WHERE 
                       TODO_KEY = #{todoKey}
           </update>   
           
           <update id="updateRsltsApproval" parameterType="Map">
                UPDATE TB_WB20M01
                   SET TODO_CF_DT = #{todoCfDt},
                       TODO_CF_OPN = #{todoCfOpn},
                       UDT_ID = #{creatId},
                       UDT_PGM = #{creatPgm},
                       UDT_DTTM = SYSDATE
                 WHERE 
                       TODO_KEY = #{todoKey}
           </update>   
           
           <!-- ToDo List 엑셀 리스트  -->
          <select id="selectToDoExcelList" parameterType="Map" resultType="camelMap">  
          SELECT ROWNUM AS RN, T.* FROM (
                    SELECT Z.* FROM (
                               SELECT 
                                    TODO_KEY,
                                    X.CO_CD,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
                                    TODO_DIV1_CODE_ID,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.TODO_DIV1_CODE_ID) AS TODO_DIV1_CODE_NM,
                                    TODO_DIV2_CODE_ID,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.TODO_DIV2_CODE_ID) AS TODO_DIV2_CODE_NM,
                                    TODO_ID,
                                    (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.TODO_ID) AS TODO_NM,                                    
                                    (SELECT Y.WBS_PLAN_CNTS FROM TB_WB01M01 Y WHERE Y.CO_CD = X.CO_CD 
                                              AND Y.WBS_PLAN_CODE_KIND = X.WBS_PLAN_CODE_KIND
                                              AND Y.WBS_PLAN_CODE_ID = X.WBS_PLAN_CODE_ID
                                              AND Y.WBS_PLAN_NO = X.WBS_PLAN_NO
                                              AND Y.SALES_CD = Y.SALES_CD) AS WBS_PLAN_CNTS, -- TO-DO LIST 주요내용
                                    NULL AS TODO_CHK,
                                    TO_CHAR(X.TODO_CF_DT, 'YYYY-MM-DD') AS TODO_CF_DT,
                                    TODO_CF_OPN,
                                    X.SALES_CD,
                                    Y.ORDRS_CLNT_CD,
                                    (SELECT T.CLNT_NM FROM TB_BM02M01 T WHERE T.CLNT_CD =Y.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                                    Y.CLNT_PJT,
                                    Y.ORDRS_DTL_DIV20,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = Y.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                                    Y.PRDT_CD,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = Y.PRDT_CD) AS PRDT_CD_NM,
                                    Y.ITEM_DIV,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = Y.ITEM_DIV) AS ITEM_DIV_NM,
                                    Y.EQP_NM,
                                    X.PG_PATH,
                                    X.WBS_PLANCO_CD,
                                    X.WBS_PLAN_NO,
                                    X.WBS_PLAN_CODE_KIND,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_CODE_KIND) AS WBS_PLAN_CODE_KIND_NM,
                                    X.WBS_PLAN_CODE_ID,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_PLAN_CODE_ID) AS WBS_PLAN_CODE_NM,
                                    WBS_RSLTS_CO_CD,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS WBS_RSLTS_CO_CD_NM,
                                    WBS_RSLTS_PLAN_NO,
                                    WBS_RSLTS_PLAN_CODE_KIND,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_RSLTS_PLAN_CODE_KIND) AS WBS_RSLTS_PLAN_CODE_KIND_NM,
                                    WBS_RSLTS_PLAN_CODE_ID,
                                    (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.WBS_RSLTS_PLAN_CODE_ID) AS WBS_RSLTS_PLAN_CODE_ID_NM,
                                    X.CREAT_ID,
                                    (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.CREAT_ID) AS CREAT_NM,
                                    X.CREAT_PGM,
                                    TO_CHAR(X.CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM,
                                    TO_CHAR(X.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM1,
                                    X.UDT_ID,
                                    (SELECT T.NAME FROM TB_CM06M01 T WHERE T.ID = X.UDT_ID) AS UDT_NM,
                                    X.UDT_PGM,
                                    TO_CHAR(X.UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM
                                    FROM TB_WB20M01 X 
                                    INNER JOIN (                
                                        SELECT         X1.CO_CD,
                                                           X1.SALES_CD,
                                                           Y1.ORDRS_CLNT_CD, -- 고객사
                                                           Y1.CLNT_PJT, -- 고객사 PJT
                                                           X1.ORDRS_DTL_DIV20, -- 신작구분
                                                           X1.PRDT_CD, -- 제품구분
                                                           X1.ITEM_DIV, -- 아이템구분
                                                           X1.EQP_NM -- 설비명
                                                           FROM TB_CR02D02 X1
                                                    INNER JOIN TB_CR02M01 Y1
                                                    ON X1.CO_CD = Y1.CO_CD
                                                    AND X1.ORDRS_NO = Y1.ORDRS_NO ) Y 
                                    ON X.CO_CD = Y.CO_CD
                                    AND X.SALES_CD = Y.SALES_CD                            
                                 ORDER BY TODO_KEY DESC ) Z ) T                                                                  
                                 WHERE CO_CD LIKE '%${coCd}%'
                                AND CREAT_DTTM1 BETWEEN '${wbsPlansDt}' AND '${wbsPlaneDt}' 
                                 <if test="salesCd != null and !salesCd.equals('')">
                                    AND SALES_CD LIKE '%${salesCd}%' <!--  salescode 검색    -->  
                                 </if>
                                 <if test="!clntCd.equals('') and !clntNm.equals('')">
                                     AND ORDRS_CLNT_CD LIKE '%${clntCd}%' <!--  고객사 검색    -->               
                                 </if>
                                 <if test="clntCd.equals('') and !clntNm.equals('')">
                                     AND ORDRS_CLNT_NM LIKE '%${clntNm}%' <!--  고객사명검색    -->               
                                 </if>
                                 <if test="!prdtDiv.equals('') and !prdtDivNm.equals('')">
                                    AND PRDT_CD LIKE '%${prdtDiv}%' <!--  제품구분 검색    -->               
                                 </if>             
                                 <if test="prdtDiv.equals('') and !prdtDivNm.equals('')">
                                    AND PRDT_CD_NM LIKE '%${prdtDivNm}%' <!--  제품구분명 검색    -->               
                                 </if>
                                 
                                 <if test="prdtItem != null and !prdtItem.equals('')">
                                    AND ITEM_DIV LIKE '%${prdtItem}%'  <!--  아이템구분 검색    -->              
                                 </if> 
                                 <if test="wbsClntPjt != null and !wbsClntPjt.equals('')">
                                    AND CLNT_PJT LIKE '%${wbsClntPjt}%'  <!--  고객사 PJT 검색    -->              
                                 </if> 
                                 <if test="eqp_nm != null and !eqp_nm.equals('')">
                                    AND EQP_NM LIKE '%${eqp_nm}%'   <!--  설비명 검색    -->             
                                 </if>
                                 <if test="!salesMngId.equals('') and !salesMngNm.equals('')"> 
                                    AND TODO_ID = '${salesMngId}'                                     
                                 </if> 
                                 <if test="salesMngId.equals('') and !salesMngNm.equals('')">
                                    AND TODO_NM LIKE '%${salesMngNm}%'                                  
                                 </if> 
           </select>
           

 </mapper>