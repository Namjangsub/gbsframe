<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.wb.wb04.mapper.WB04Mapper">
       <select id="selectWbsLeftSalesCodeTreeList" parameterType="Map" resultType="camelMap">                              
                SELECT DISTINCT  
                       '' PID,
                       #{coCd} ID,
                       #{coCd} CO_CD, -- 회사코드
                       FN_CM05M01_CD_TO_NM(#{coCd}) AS CO_CD_NM,
                       '전체' ORDRS_NO,
                       '전사 현황' AS SALES_CD,
                       '' ORGN_SALES_CD,
                       '' ORDRS_CLNT_CD, -- 고객사
                       '전체' AS ORDRS_CLNT_NM,
                       '' CLNT_PJT,
                       '' ORDRS_DTL_DIV20, -- 신작구분
                       '' AS ORDRS_DTL_DIV20_NM,
                       '' EQP_NM, -- 설비명
                       0 PLAN_CNT,
                       'E' WBS_PLAN_OS_YN,
                       'E' PLAN_LOCK_YN,
                       'E' PLAN_CLOSE_YN,
                       0 RSULT_CNT,
                       'E' RSULT_LOCK_YN,
                       'E' RSULT_CLOSE_YN,
                       '' PRDT_CD,
                       '' AS PRDT_CD_NM,
                       '' ITEM_DIV,
                       '' ITEM_DIV_NM,
                       '' DATA_GBN
                  FROM DUAL

              UNION ALL  --회사명을 Top LEVEL 생성
                SELECT DISTINCT  
                       X.CO_CD PID,
                       TO_CHAR(Y.ORDRS_CLNT_CD) ID,
                       X.CO_CD, -- 회사코드
                       FN_CM05M01_CD_TO_NM(X.CO_CD) AS CO_CD_NM,
                       A.CLNT_NM,
                       A.CLNT_NM  AS SALES_CD,
                       '' ORGN_SALES_CD,
                       Y.ORDRS_CLNT_CD , -- 고객사
                       A.CLNT_NM  AS ORDRS_CLNT_NM,
                       '' CLNT_PJT,
                       '' ORDRS_DTL_DIV20, -- 신작구분
                       '' AS ORDRS_DTL_DIV20_NM,
                       '', -- 설비명
                       0 PLAN_CNT,
                       'E' WBS_PLAN_OS_YN,
                       'E' PLAN_LOCK_YN,
                       'E' PLAN_CLOSE_YN,
                       0 RSULT_CNT,
                       'E' RSULT_LOCK_YN,
                       'E' RSULT_CLOSE_YN,
                       '' PRDT_CD,
                       '' AS PRDT_CD_NM,
                       '' ITEM_DIV,
                       '' ITEM_DIV_NM,
                       '' DATA_GBN
                  FROM TB_CR02D02 X
                        INNER JOIN TB_CR02M01 Y  ON X.CO_CD = Y.CO_CD
                                                AND X.ORDRS_NO = Y.ORDRS_NO
                        LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD --거래처마스터
                WHERE X.CO_CD = #{coCd}
               <if test="salesCd != null and !salesCd.equals('')">
                  AND X.SALES_CD like '%${salesCd}%'                
               </if>
                 
               UNION ALL --오더번호로 1 LEVEL 생성
                SELECT DISTINCT  
                       TO_CHAR(Y.ORDRS_CLNT_CD) PID,
                       X.ORDRS_NO ID,
                       X.CO_CD, -- 회사코드
                       FN_CM05M01_CD_TO_NM(X.CO_CD) AS CO_CD_NM,
                       X.ORDRS_NO AS ORDRS_NO,
                       X.ORDRS_NO AS SALES_CD,
                       '',
                       Y.ORDRS_CLNT_CD, -- 고객사
                       A.CLNT_NM  AS ORDRS_CLNT_NM,
                       '',
                       '',
                       '',
                       '', -- 설비명
                       0 PLAN_CNT,
                       'E' WBS_PLAN_OS_YN,
                       'E' PLAN_LOCK_YN,
                       'E' PLAN_CLOSE_YN,
                       0 RSULT_CNT,
                       'E' RSULT_LOCK_YN,
                       'E' RSULT_CLOSE_YN,
                       '' PRDT_CD,
                       '' AS PRDT_CD_NM,
                       '' ITEM_DIV,
                       '' ITEM_DIV_NM,
                       '' DATA_GBN
                  FROM TB_CR02D02 X
                        INNER JOIN TB_CR02M01 Y  ON X.CO_CD = Y.CO_CD
                                                AND X.ORDRS_NO = Y.ORDRS_NO
                        LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD --거래처마스터
                 WHERE X.CO_CD = #{coCd}
               <if test="salesCd != null and !salesCd.equals('')">
                  AND X.SALES_CD like '%${salesCd}%'                
               </if>

               UNION ALL
                SELECT   --Sales 코드 추출
                       X.ORDRS_NO PID,
                       X.SALES_CD ID,
                       X.CO_CD, -- 회사코드
                       FN_CM05M01_CD_TO_NM(X.CO_CD) AS CO_CD_NM,
                       X.ORDRS_NO, -- 수주번호
                       X.SALES_CD, -- SALES CODE
                       max(Y.ORGN_SALES_CD), -- 원천 SALES CODE
                       max(Y.ORDRS_CLNT_CD), -- 고객사
                       max(A.CLNT_NM)  AS ORDRS_CLNT_NM,
                       max(Y.CLNT_PJT), -- 고객사 PJT
                       max(X.ORDRS_DTL_DIV20), -- 신작구분
                       FN_CM05M01_CD_TO_NM(max(X.ORDRS_DTL_DIV20)) AS ORDRS_DTL_DIV20_NM,
                       max(X.EQP_NM), -- 설비명
                       COUNT(W.FILE_TRGT_KEY) PLAN_CNT,
                       NVL(max(W.WBS_PLAN_OS_YN),'N') WBS_PLAN_OS_YN,
                       NVL(max(W.LOCK_YN),'N') PLAN_LOCK_YN,
                       NVL(max(W.CLOSE_YN),'N') PLAN_CLOSE_YN,
                       COUNT(Z.FILE_TRGT_KEY) RSULT_CNT,
                       NVL(max(Z.LOCK_YN),'N') RSULT_LOCK_YN,
                       NVL(max(Z.CLOSE_YN),'N') RSULT_CLOSE_YN,
                       max(X.PRDT_CD) PRDT_CD,
                       FN_BM01M01_ID_TO_NM(max(X.PRDT_CD)) AS PRDT_CD_NM,
                       max(X.ITEM_DIV) ITEM_DIV,
                       FN_CM05M01_CD_TO_NM(max(X.ITEM_DIV)) AS ITEM_DIV_NM,
                       'D' DATA_GBN  --원시데이타
                  FROM TB_CR02D02 X
                        INNER JOIN TB_CR02M01 Y  ON X.CO_CD    = Y.CO_CD
                                                AND X.ORDRS_NO = Y.ORDRS_NO
                                                AND X.CO_CD = #{coCd}
                                               <if test="salesCd != null and !salesCd.equals('')">
                                                AND X.SALES_CD like '%${salesCd}%'                
                                               </if>
                        CROSS JOIN (
                                                SELECT 
                                                         CASE WHEN CODE_KIND = 'ROOT' THEN '' ELSE CODE_KIND END CODE_KIND,
                                                         CODE_ID,
                                                         CODE_RPRC,
                                                         CODE_NM,
                                                         CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
                                                         CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
                                                         CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
                                                         LPAD('', 3*(LEVEL-1)) || LEVEL LVL,
                                                         REGEXP_REPLACE(SYS_CONNECT_BY_PATH(CODE_ID, ' -> '), '^\s+\-\>\s+', '') as PATH,
                                                         CONNECT_BY_ISLEAF AS IS_LEAF,
                                                         CASE WHEN CONNECT_BY_ISLEAF = 0 THEN 'unit' ELSE 'leaf' END TYPE
                                                 FROM TB_CM05M01
                                                 START WITH CODE_ID = 'WBSDIV'
                                                 CONNECT BY PRIOR CODE_ID  =  CODE_KIND 
                                ) CD  
                        LEFT OUTER JOIN TB_WB01M01 W  ON X.CO_CD    = W.CO_CD
                                                     AND X.SALES_CD = w.SALES_CD  
                                                     AND CD.CODE_ID = W.WBS_PLAN_CODE_ID
                        LEFT OUTER JOIN TB_WB02M01 Z  ON X.CO_CD    = Z.CO_CD
                                                     AND X.SALES_CD = Z.SALES_CD  
                                                     AND CD.CODE_ID = Z.WBS_PLAN_CODE_ID
                        LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD --거래처마스터                             
                GROUP BY X.ORDRS_NO, X.SALES_CD, X.CO_CD,Y.ORGN_SALES_CD,Y.ORDRS_CLNT_CD, Y.CLNT_PJT                    

           </select> 
           
<select id="selectWbsPlanTreeList" parameterType="Map" resultType="CamelMap">
            SELECT  
                    T.*,
                    FN_CM05M01_CD_TO_NM(T.CO_CD) AS CO_CD_NM,
                    CASE WHEN W01.FILE_TRGT_KEY  IS NULL  THEN 'N' ELSE 'Y' END WBS_PLAN_CHK_YN,
                    CASE WHEN W02.FILE_TRGT_KEY  IS NULL  THEN 'N' ELSE 'Y' END WBS_RSLTS_CHK_YN,
                    TO_CHAR(W01.WBS_PLANS_DT, 'YYYY-MM-DD') AS WBS_PLANS_DT, -- 계획시작일자
                    TO_CHAR(W01.WBS_PLANE_DT, 'YYYY-MM-DD') AS WBS_PLANE_DT, -- 계획종료일자
                    TO_CHAR(W02.WBS_RSLTSS_DT, 'YYYY-MM-DD') AS WBS_RSLTSS_DT, -- 실적시작일자
                    TO_CHAR(W02.WBS_RSLTSE_DT, 'YYYY-MM-DD') AS WBS_RSLTSE_DT, -- 실적종료일자
                    W01.WBS_PLAN_ID,
                    TO_CHAR(W01.WBS_PLAN_DT, 'YYYY-MM-DD') AS  WBS_PLAN_DT,
                    FN_CM06M01_ID_TO_NM(W01.WBS_PLAN_ID) WBS_PLAN_NM,
                    FN_CM06M01_ID_TO_NM(W01.CREAT_ID)  CREAT_ID,
                    TO_CHAR(W01.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM,
                    FN_CM06M01_ID_TO_NM(W01.UDT_ID)  UDT_ID,
                    TO_CHAR(W01.UDT_DTTM, 'YYYY-MM-DD') AS UDT_DTTM,
                    W02.WBS_PLAN_MH,        --계획공수
                    W02.WBS_RSLTS_MH,       --실적공수
                    W01.FILE_TRGT_KEY,
                    W01.WBS_PLAN_NO,
                    W01.WBS_PLAN_CNTS,
                    W01.WBS_PLAN_RMK,
                    W01.WBS_PLAN_STS_CODE_ID,
                    W01.WBS_PLAN_OS_YN,
                    W01.LOCK_YN,
                    W01.CLOSE_YN,
                    DSGN_DIF_CODE_ID,
                    DSGN_PLAN_HOUR,
                    PRDCTN_DIF_CODE_ID,
                    PRDCTN_PLAN_HOUR,    
                    WBS_PLAN_MNG_ID,
                    FN_CM06M01_ID_TO_NM(W01.WBS_PLAN_MNG_ID) WBS_PLAN_MNG_NM,
                    W02.FILE_TRGT_KEY AS RSLTS_FILE_TRGT_KEY,
                    W02.WBS_PLAN_NO   AS RSLTS_WBS_PLAN_NO,
                    W02.WBS_RSLTS_RATE,
                    W02.LOCK_YN  AS RSLTS_LOCK_YN,
                    W02.CLOSE_YN AS RSLTS_CLOSE_YN,
                    W02.WBS_RSLTS_CNTS,
                    W02.WBS_RSLTS_RMK,
                    TO_CHAR(W02.WBS_RSLTS_DT, 'YYYY-MM-DD') AS WBS_RSLTS_DT,
                    FN_CM06M01_ID_TO_NM(W02.WBS_RSLTS_ID)  AS WBS_RSLTS_ID,
                    W02.*
               FROM         
                    (SELECT  
                           CR.CO_CD, 
                           CR.ORDRS_NO,
                           CR.SALES_CD, 
                           Y.ORDRS_CLNT_CD, 
                           (SELECT P.CLNT_NM FROM TB_BM02M01 P WHERE P.CLNT_CD = Y.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
                           Y.CLNT_PJT, 
                           CR.ORDRS_DTL_DIV20, 
                           (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = CR.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
                           CR.PRDT_CD, 
                           (SELECT T.PRDT_NM FROM TB_BM01M01 T WHERE T.PRDT_CD = CR.PRDT_CD) AS PRDT_CD_NM,
                           CR.ITEM_DIV, 
                           (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = CR.ITEM_DIV) AS ITEM_DIV_NM,
                           CR.EQP_NM ,
                           CD.*
                      FROM TB_CR02D02 CR INNER JOIN TB_CR02M01 Y  ON CR.CO_CD = Y.CO_CD
                                                                 AND CR.ORDRS_NO = Y.ORDRS_NO
                           , (
                                                SELECT 
                                                         CASE WHEN CODE_KIND = 'ROOT' THEN '' ELSE CODE_KIND END CODE_KIND,
                                                         CODE_ID,
                                                         CODE_RPRC,
                                                         CODE_NM,
                                                         CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
                                                         CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
                                                         CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
                                                         LPAD('', 3*(LEVEL-1)) || LEVEL LVL,
                                                         REGEXP_REPLACE(SYS_CONNECT_BY_PATH(CODE_ID, ' -> '), '^\s+\-\>\s+', '') as PATH,
                                                         CONNECT_BY_ISLEAF AS IS_LEAF,
                                                         CASE WHEN CONNECT_BY_ISLEAF = 0 THEN 'unit' ELSE 'leaf' END TYPE
                                                 FROM TB_CM05M01
                                                 START WITH CODE_ID = 'WBSDIV'
                                                 CONNECT BY PRIOR CODE_ID  =  CODE_KIND 
                                )  CD 
                       WHERE CR.CO_CD = #{coCd}
                         AND CR.SALES_CD = #{salesCd} 
                      ORDER BY  CR.SALES_CD, PATH                 
                     ) AS T LEFT OUTER JOIN TB_WB01M01 W01 ON T.CO_CD    = W01.CO_CD
                                                          AND T.SALES_CD = W01.SALES_CD
                                                          AND T.CODE_ID  = W01.WBS_PLAN_CODE_ID
                            LEFT OUTER JOIN TB_WB02M01 W02 ON T.CO_CD    = W02.CO_CD
                                                          AND T.SALES_CD = W02.SALES_CD
                                                          AND T.CODE_ID  = W02.WBS_PLAN_CODE_ID
                                                          
        </select>        


          <select id="selectGanttList" parameterType="Map" resultType="CamelMap">
              
			SELECT 
			            CODE_NM,
			            CODE_ID,
			            DUR,
			            WBS_PLANS_DT,
			            WBS_PLANE_DT,
			            WBS_RSLTS_RATE,
			            WBS_PLAN_MNG_NM,
			            ORDRS_CLNT_NM,
			            WBS_PLAN_CNTS,
			            SUBSTR(TO_CHAR(WBS_PLANS_DT, 'YYYY-MM-DD'),9,2)||'-'||SUBSTR(TO_CHAR(WBS_PLANS_DT, 'YYYY-MM-DD'),6,2)||'-'||SUBSTR(TO_CHAR(WBS_PLANS_DT, 'YYYY-MM-DD'),0,4) AS WBS_PLANS_DT1,
			            SUBSTR(TO_CHAR(WBS_PLANE_DT, 'YYYY-MM-DD'),9,2)||'-'||SUBSTR(TO_CHAR(WBS_PLANE_DT, 'YYYY-MM-DD'),6,2)||'-'||SUBSTR(TO_CHAR(WBS_PLANE_DT, 'YYYY-MM-DD'),0,4) AS WBS_PLANE_DT1,                        
			            LVL
			            FROM (
			                    SELECT  
			                                        T.CODE_NM,
			                                        T.CODE_ID,
			                                        TO_DATE(TO_CHAR( W01.WBS_PLANE_DT,'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(W01.WBS_PLANS_DT,'YYYYMMDD'),'YYYYMMDD') AS DUR,
			                                        W01.WBS_PLANS_DT,
			                                        W01.WBS_PLANE_DT,
			                                        NVL(W02.WBS_RSLTS_RATE,0) AS WBS_RSLTS_RATE,
			                                        NVL(FN_CM06M01_ID_TO_NM(W01.WBS_PLAN_MNG_ID),' ') WBS_PLAN_MNG_NM,
			                                        T.ORDRS_CLNT_NM,
			                                        NVL(W01.WBS_PLAN_CNTS,' ') AS WBS_PLAN_CNTS ,
			                                        T.LVL-1 AS LVL
			                    
			                                   FROM         
			                                        (SELECT  
			                                               CR.CO_CD, 
			                                               CR.ORDRS_NO,
			                                               CR.SALES_CD, 
			                                               Y.ORDRS_CLNT_CD, 
			                                               (SELECT P.CLNT_NM FROM TB_BM02M01 P WHERE P.CLNT_CD = Y.ORDRS_CLNT_CD) AS ORDRS_CLNT_NM,
			                                               Y.CLNT_PJT, 
			                                               CR.ORDRS_DTL_DIV20, 
			                                               (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = CR.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM,
			                                               CR.PRDT_CD, 
			                                               (SELECT T.PRDT_NM FROM TB_BM01M01 T WHERE T.PRDT_CD = CR.PRDT_CD) AS PRDT_CD_NM,
			                                               CR.ITEM_DIV, 
			                                               (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = CR.ITEM_DIV) AS ITEM_DIV_NM,
			                                               CR.EQP_NM ,
			                                               CD.*
			                                          FROM TB_CR02D02 CR INNER JOIN TB_CR02M01 Y  ON CR.CO_CD = Y.CO_CD
			                                                                                     AND CR.ORDRS_NO = Y.ORDRS_NO
			                                               , (
			                                                                    SELECT 
			                                                                             CASE WHEN CODE_KIND = 'ROOT' THEN '' ELSE CODE_KIND END CODE_KIND,
			                                                                             CODE_ID,
			                                                                             CODE_RPRC,
			                                                                             CODE_NM,
			                                                                             CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
			                                                                             CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
			                                                                             CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
			                                                                             LPAD('', 3*(LEVEL-1)) || LEVEL LVL,
			                                                                             REGEXP_REPLACE(SYS_CONNECT_BY_PATH(CODE_ID, ' -> '), '^\s+\-\>\s+', '') as PATH,
			                                                                             CONNECT_BY_ISLEAF AS IS_LEAF,
			                                                                             CASE WHEN CONNECT_BY_ISLEAF = 0 THEN 'unit' ELSE 'leaf' END TYPE
			                                                                     FROM TB_CM05M01
			                                                                     START WITH CODE_ID = 'WBSDIV'
			                                                                     CONNECT BY PRIOR CODE_ID  =  CODE_KIND 
			                                                    )  CD 
			                                           WHERE CR.CO_CD = #{coCd}
			                                             AND CR.SALES_CD = #{salesCd}
			                                          ORDER BY  CR.SALES_CD, PATH                 
			                                         ) AS T LEFT OUTER JOIN TB_WB01M01 W01 ON T.CO_CD    = W01.CO_CD
			                                                                              AND T.SALES_CD = W01.SALES_CD
			                                                                              AND T.CODE_ID  = W01.WBS_PLAN_CODE_ID
			                                                LEFT OUTER JOIN TB_WB02M01 W02 ON T.CO_CD    = W02.CO_CD
			                                                                              AND T.SALES_CD = W02.SALES_CD
			                                                                              AND T.CODE_ID  = W02.WBS_PLAN_CODE_ID  
			                               WHERE  T.CODE_ID != 'WBSDIV' ) X
			    WHERE DUR >=0      
			    ORDER BY CODE_ID ASC                                                                                                                                            
        </select>        

        <update id="updateWbsPlanDate" parameterType="Map">
             UPDATE TB_WB01M01
              SET WBS_PLANS_DT = #{wbsPlansDt},
                  WBS_PLANE_DT = #{wbsPlaneDt}
              WHERE CO_CD = #{coCd}
                    AND SALES_CD = #{salesCd}
                    AND WBS_PLAN_CODE_ID = #{codeId}
        </update>  

     
        <select id="selectGanttAllList_bk" parameterType="Map" resultType="CamelMap">
        
        SELECT PID, 
             ID, 
             CO_CD, 
             CO_CD_NM,
             ORDRS_NO, 
             SALES_CD, 
             ORDRS_CLNT_NM,
             WBS_PLAN_OS_YN,
             PLAN_LOCK_YN,
             CHK,
             LEN,
             NVL(CODE_ID,SALES_CD) AS CODE_ID,
             NVL(CODE_NM,SALES_CD) AS CODE_NM,
             PATH,
             LVL,
             SUBSTR(TO_CHAR(WBS_PLANS_DT, 'YYYY-MM-DD'),9,2)||'-'||SUBSTR(TO_CHAR(WBS_PLANS_DT, 'YYYY-MM-DD'),6,2)||'-'||SUBSTR(TO_CHAR(WBS_PLANS_DT, 'YYYY-MM-DD'),0,4) AS WBS_PLANS_DT,
             SUBSTR(TO_CHAR(WBS_PLANE_DT, 'YYYY-MM-DD'),9,2)||'-'||SUBSTR(TO_CHAR(WBS_PLANE_DT, 'YYYY-MM-DD'),6,2)||'-'||SUBSTR(TO_CHAR(WBS_PLANE_DT, 'YYYY-MM-DD'),0,4) AS WBS_PLANE_DT,
             TO_DATE(TO_CHAR(WBS_PLANE_DT,'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(WBS_PLANS_DT,'YYYYMMDD'),'YYYYMMDD') AS DUR,
             0 AS WBS_RSLTS_RATE
             FROM (
		        SELECT  PID, 
		             ID, 
		             CO_CD, 
		             (SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = W.CO_CD) AS CO_CD_NM,
		             ORDRS_NO, 
		             SALES_CD, 
		             ORDRS_CLNT_NM,
		             WBS_PLAN_OS_YN,
		             PLAN_LOCK_YN,
		             CHK,
		             LEN,
		             CODE_ID,
		             CODE_NM,
		             PATH,
		             CASE WHEN CHK = 1 AND LEN = 3 AND NVL(CODE_ID,' ') = ' ' THEN 1 
		                     WHEN CHK = 0 AND LEN = 3 AND NVL(CODE_ID,' ') = ' ' THEN 2 
		                     WHEN CHK = 0 AND LEN = 5 AND NVL(CODE_ID,' ') = ' ' THEN 3 
		                     --WHEN CHK = 8 AND LEN = 12 AND NVL(CODE_ID,' ') = ' ' THEN 4 
		                     WHEN CHK = 8 AND LEN = 12 AND LENGTH(NVL(CODE_ID,' ')) = 8 THEN 4 
		                     WHEN CHK = 8 AND LEN = 12 AND LENGTH(NVL(CODE_ID,' ')) = 10 THEN 5
		                     WHEN CHK = 8 AND LEN = 12 AND LENGTH(NVL(CODE_ID,' ')) = 12 THEN 6 END LVL,                     
		             CASE WHEN CHK = 1 AND LEN = 3 THEN WBS_PLANS_DT_ALL 
		                     WHEN CHK = 0 AND LEN = 3 THEN WBS_PLANS_DT_ORDRS
		                     WHEN CHK = 0 AND LEN = 5 THEN WBS_PLANS_DT_SALES_GR
		                     WHEN CHK = 8 AND LEN = 12 THEN WBS_PLANS_DT END AS WBS_PLANS_DT,
		
		             CASE WHEN CHK = 1 AND LEN = 3 THEN WBS_PLANE_DT_ALL 
		                     WHEN CHK = 0 AND LEN = 3 THEN WBS_PLANE_DT_ORDRS
		                     WHEN CHK = 0 AND LEN = 5 THEN WBS_PLANE_DT_SALES_GR
		                     WHEN CHK = 8 AND LEN = 12 THEN WBS_PLANE_DT END AS WBS_PLANE_DT
		                     
		                 FROM (
		                     SELECT Z.PID, 
		                                Z.ID, 
		                                Z.CO_CD, 
		                                Z.ORDRS_NO, 
		                                Z.SALES_CD, 
		                                Z.ORDRS_CLNT_NM,
		                                Z.WBS_PLAN_OS_YN,
		                                Z.PLAN_LOCK_YN,
		                                Z.CHK,
		                                Z.LEN,
		                                Z.CODE_ID,
		                                Z.CODE_NM,
		                                Z.PATH,
		                                Z.WBS_PLANS_DT, 
		                                Z.WBS_PLANE_DT,
		                                Z1.WBS_PLANS_DT_ALL, 
		                                Z1.WBS_PLANE_DT_ALL,        
		                                Z2.WBS_PLANS_DT_ORDRS, 
		                                Z2.WBS_PLANE_DT_ORDRS,
		                                Z3.WBS_PLANS_DT_SALES_GR, 
		                                Z3.WBS_PLANE_DT_SALES_GR                    
		                                FROM (
		                                     SELECT X.PID,
		                                                X.ID,
		                                                X.CO_CD, 
		                                                FN_CM05M01_CD_TO_NM(X.CO_CD) AS CO_CD_NM,
		                                                X.ORDRS_NO,
		                                                X.SALES_CD,
		                                                X.ORDRS_CLNT_NM,
		                                                X.WBS_PLAN_OS_YN,
		                                                X.PLAN_LOCK_YN,
		                                                REGEXP_INSTR(X.ID, '[A-Za-z]') AS CHK,
		                                                LENGTH(X.ID) AS LEN,
		                                                --CASE WHEN REGEXP_INSTR(X.ID, '[A-Za-z]') = '1' THEN 00 END ,
		                                                --CASE WHEN X.ID = X.CO_CD THEN '1' END,
		                                                --CASE WHEN LENGTH(X.ID)=3 THEN 2 END, 
		                                                X.PLAN_CLOSE_YN, 
		                                                Y.CODE_ID,
		                                                Y.CODE_NM,
		                                                Y.LVL,
		                                                Y.PATH,
		                                                Y.WBS_PLANS_DT, 
		                                                Y.WBS_PLANE_DT
		                                      FROM (
		                                                 SELECT DISTINCT  
		                                                        '' PID,
		                                                        #{coCd} ID,
		                                                        #{coCd} CO_CD, 
		                                                        FN_CM05M01_CD_TO_NM(#{coCd}) AS CO_CD_NM,
		                                                        '전체' ORDRS_NO,
		                                                        '전사 현황' AS SALES_CD,
		                                                        '' ORGN_SALES_CD,
		                                                        '' ORDRS_CLNT_CD, 
		                                                        '전체' AS ORDRS_CLNT_NM,
		                                                        '' CLNT_PJT,
		                                                        '' ORDRS_DTL_DIV20, 
		                                                        '' AS ORDRS_DTL_DIV20_NM,
		                                                        '' EQP_NM, 
		                                                        0 PLAN_CNT,
		                                                        'E' WBS_PLAN_OS_YN,
		                                                        'E' PLAN_LOCK_YN,
		                                                        'E' PLAN_CLOSE_YN,
		                                                        0 RSULT_CNT,
		                                                        'E' RSULT_LOCK_YN,
		                                                        'E' RSULT_CLOSE_YN,
		                                                        '' PRDT_CD,
		                                                        '' AS PRDT_CD_NM,
		                                                        '' ITEM_DIV,
		                                                        '' ITEM_DIV_NM,
		                                                        '' DATA_GBN
		                                                   FROM DUAL
		                                                
			                                                UNION ALL  --회사명을 Top LEVEL 생성
			                                                  SELECT DISTINCT  
			                                                         X.CO_CD PID,
			                                                         TO_CHAR(Y.ORDRS_CLNT_CD) ID,
			                                                         X.CO_CD, -- 회사코드
			                                                         FN_CM05M01_CD_TO_NM(X.CO_CD) AS CO_CD_NM,
			                                                         A.CLNT_NM,
			                                                         A.CLNT_NM  AS SALES_CD,
			                                                         '' ORGN_SALES_CD,
			                                                         Y.ORDRS_CLNT_CD , -- 고객사
			                                                         A.CLNT_NM  AS ORDRS_CLNT_NM,
			                                                         '' CLNT_PJT,
			                                                         '' ORDRS_DTL_DIV20, -- 신작구분
			                                                         '' AS ORDRS_DTL_DIV20_NM,
			                                                         '', -- 설비명
			                                                         0 PLAN_CNT,
			                                                         'E' WBS_PLAN_OS_YN,
			                                                         'E' PLAN_LOCK_YN,
			                                                         'E' PLAN_CLOSE_YN,
			                                                         0 RSULT_CNT,
			                                                         'E' RSULT_LOCK_YN,
			                                                         'E' RSULT_CLOSE_YN,
			                                                         '' PRDT_CD,
			                                                         '' AS PRDT_CD_NM,
			                                                         '' ITEM_DIV,
			                                                         '' ITEM_DIV_NM,
			                                                         '' DATA_GBN
			                                                    FROM TB_CR02D02 X
			                                                          INNER JOIN TB_CR02M01 Y  ON X.CO_CD = Y.CO_CD
			                                                                                  AND X.ORDRS_NO = Y.ORDRS_NO
			                                                          LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD --거래처마스터
			                                                  WHERE X.CO_CD = 'GUN'                 
			                                                 UNION ALL --오더번호로 1 LEVEL 생성
			                                                  SELECT DISTINCT  
			                                                         TO_CHAR(Y.ORDRS_CLNT_CD) PID,
			                                                         X.ORDRS_NO ID,
			                                                         X.CO_CD, -- 회사코드
			                                                         FN_CM05M01_CD_TO_NM(X.CO_CD) AS CO_CD_NM,
			                                                         X.ORDRS_NO AS ORDRS_NO,
			                                                         X.ORDRS_NO AS SALES_CD,
			                                                         '',
			                                                         Y.ORDRS_CLNT_CD, -- 고객사
			                                                         A.CLNT_NM  AS ORDRS_CLNT_NM,
			                                                         '',
			                                                         '',
			                                                         '',
			                                                         '', -- 설비명
			                                                         0 PLAN_CNT,
			                                                         'E' WBS_PLAN_OS_YN,
			                                                         'E' PLAN_LOCK_YN,
			                                                         'E' PLAN_CLOSE_YN,
			                                                         0 RSULT_CNT,
			                                                         'E' RSULT_LOCK_YN,
			                                                         'E' RSULT_CLOSE_YN,
			                                                         '' PRDT_CD,
			                                                         '' AS PRDT_CD_NM,
			                                                         '' ITEM_DIV,
			                                                         '' ITEM_DIV_NM,
			                                                         '' DATA_GBN
			                                                    FROM TB_CR02D02 X
			                                                          INNER JOIN TB_CR02M01 Y  ON X.CO_CD = Y.CO_CD
			                                                                                  AND X.ORDRS_NO = Y.ORDRS_NO
			                                                          LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD --거래처마스터
			                                                   WHERE X.CO_CD = 'GUN'
			                                                 UNION ALL
			                                                  SELECT   --Sales 코드 추출
			                                                         X.ORDRS_NO PID,
			                                                         X.SALES_CD ID,
			                                                         X.CO_CD, -- 회사코드
			                                                         FN_CM05M01_CD_TO_NM(X.CO_CD) AS CO_CD_NM,
			                                                         X.ORDRS_NO, -- 수주번호
			                                                         X.SALES_CD, -- SALES CODE
			                                                         max(Y.ORGN_SALES_CD), -- 원천 SALES CODE
			                                                         max(Y.ORDRS_CLNT_CD), -- 고객사
			                                                         max(A.CLNT_NM)  AS ORDRS_CLNT_NM,
			                                                         max(Y.CLNT_PJT), -- 고객사 PJT
			                                                         max(X.ORDRS_DTL_DIV20), -- 신작구분
			                                                         FN_CM05M01_CD_TO_NM(max(X.ORDRS_DTL_DIV20)) AS ORDRS_DTL_DIV20_NM,
			                                                         max(X.EQP_NM), -- 설비명
			                                                         COUNT(W.FILE_TRGT_KEY) PLAN_CNT,
			                                                         NVL(max(W.WBS_PLAN_OS_YN),'N') WBS_PLAN_OS_YN,
			                                                         NVL(max(W.LOCK_YN),'N') PLAN_LOCK_YN,
			                                                         NVL(max(W.CLOSE_YN),'N') PLAN_CLOSE_YN,
			                                                         COUNT(Z.FILE_TRGT_KEY) RSULT_CNT,
			                                                         NVL(max(Z.LOCK_YN),'N') RSULT_LOCK_YN,
			                                                         NVL(max(Z.CLOSE_YN),'N') RSULT_CLOSE_YN,
			                                                         max(X.PRDT_CD) PRDT_CD,
			                                                         FN_BM01M01_ID_TO_NM(max(X.PRDT_CD)) AS PRDT_CD_NM,
			                                                         max(X.ITEM_DIV) ITEM_DIV,
			                                                         FN_CM05M01_CD_TO_NM(max(X.ITEM_DIV)) AS ITEM_DIV_NM,
			                                                         'D' DATA_GBN  --원시데이타
			                                                    FROM TB_CR02D02 X
			                                                          INNER JOIN TB_CR02M01 Y  ON X.CO_CD    = Y.CO_CD
			                                                                                  AND X.ORDRS_NO = Y.ORDRS_NO
			                                                                                  AND X.CO_CD = 'GUN'
			                                                          CROSS JOIN (
			                                                             SELECT 
			                                                                      CASE WHEN CODE_KIND = 'ROOT' THEN '' ELSE CODE_KIND END CODE_KIND,
			                                                                      CODE_ID,
			                                                                      CODE_RPRC,
			                                                                      CODE_NM,
			                                                                      CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
			                                                                      CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
			                                                                      CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
			                                                                      LPAD('', 3*(LEVEL-1)) || LEVEL LVL,
			                                                                      REGEXP_REPLACE(SYS_CONNECT_BY_PATH(CODE_ID, ' -> '), '^\s+\-\>\s+', '') as PATH,
			                                                                      CONNECT_BY_ISLEAF AS IS_LEAF,
			                                                                      CASE WHEN CONNECT_BY_ISLEAF = 0 THEN 'unit' ELSE 'leaf' END TYPE
			                                                              FROM TB_CM05M01
			                                                              START WITH CODE_ID = 'WBSDIV'
			                                                              CONNECT BY PRIOR CODE_ID  =  CODE_KIND 
			                                                                  ) CD  
			                                                          LEFT OUTER JOIN TB_WB01M01 W  ON X.CO_CD    = W.CO_CD
			                                                                                       AND X.SALES_CD = w.SALES_CD  
			                                                                                       AND CD.CODE_ID = W.WBS_PLAN_CODE_ID
			                                                          LEFT OUTER JOIN TB_WB02M01 Z  ON X.CO_CD    = Z.CO_CD
			                                                                                       AND X.SALES_CD = Z.SALES_CD  
			                                                                                       AND CD.CODE_ID = Z.WBS_PLAN_CODE_ID
			                                                          LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD --거래처마스터                             
			                                                  GROUP BY X.ORDRS_NO, X.SALES_CD, X.CO_CD,Y.ORGN_SALES_CD,Y.ORDRS_CLNT_CD, Y.CLNT_PJT) X
		                                                                
		                                                      LEFT OUTER JOIN (
		                                                          SELECT X.CODE_KIND,
		                                                                     X.CODE_ID,
		                                                                     X.CODE_NM,
		                                                                     X.LVL,
		                                                                     X.PATH,
		                                                                     Y.WBS_PLANS_DT, 
		                                                                     Y.WBS_PLANE_DT,
		                                                                     Z.CO_CD,
		                                                                     Z.SALES_CD,
		                                                                     Z.ORDRS_CLNT_CD
		                                                                    FROM (
		                                                                      SELECT 
		                                                                             CODE_KIND,
		                                                                             CODE_ID,
		                                                                             CODE_RPRC,
		                                                                             CODE_NM,
		                                                                             CASE WHEN LEVEL = '1' THEN CODE_NM ELSE '' END LVL1,
		                                                                             CASE WHEN LEVEL = '2' THEN CODE_NM ELSE '' END LVL2,
		                                                                             CASE WHEN LEVEL = '3' THEN CODE_NM ELSE '' END LVL3,
		                                                                             LEVEL AS LVL,
		                                                                             LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CODE_NM, '>') PATH
		                                                                         FROM TB_CM05M01
		                                                                         START WITH CODE_KIND = 'WBSDIV'
		                                                                         CONNECT BY PRIOR CODE_ID  =  CODE_KIND
		                                                                         ORDER BY CODE_ID ASC ) X
		                                                                         
		                                                                         INNER  JOIN TB_WB01M01 Y
		                                                                         ON  X.CODE_KIND = Y.WBS_PLAN_CODE_KIND
		                                                                         AND X.CODE_ID = Y.WBS_PLAN_CODE_ID
		                                                                         
		                                                                         INNER JOIN (
		                                                                                 SELECT  X.CO_CD, 
		                                                                                             X.SALES_CD,
		                                                                                             Y.ORDRS_CLNT_CD
		                                                                                        FROM TB_CR02D02 X
		                                                                                 INNER JOIN TB_CR02M01 Y
		                                                                                 ON X.CO_CD = Y.CO_CD
		                                                                                 AND X.ORDRS_NO = Y.ORDRS_NO 
		                                                                                 ORDER BY X.CO_CD, Y.ORDRS_CLNT_CD,  X.SALES_CD ASC ) Z
		                                                                         ON Y.CO_CD = Z.CO_CD
		                                                                         AND Y.SALES_CD = Z.SALES_CD) Y
		                                                      ON X.CO_CD = Y.CO_CD 
		                                                      AND X.SALES_CD = Y.SALES_CD
		                                                      AND X.ORDRS_CLNT_CD =Y.ORDRS_CLNT_CD     ) Z    
		          
		                                                      LEFT OUTER JOIN (
		                                                               SELECT    CO_CD,
		                                                                   WBS_PLANS_DT_ALL,
		                                                                   WBS_PLANE_DT_ALL
		                                                                   FROM (
		                                                                      SELECT   CO_CD,
		                                                                          MIN(WBS_PLANS_DT) AS WBS_PLANS_DT_ALL, 
		                                                                          MAX(WBS_PLANE_DT) AS WBS_PLANE_DT_ALL           
		                                                                        FROM (
		                                                                          SELECT X.CO_CD,
		                                                                                     X.SALES_CD_GR,
		                                                                                     X.SALES_CD,
		                                                                                     X.ORDRS_CLNT_CD,
		                                                                                     Y.WBS_PLANS_DT,
		                                                                                     Y.WBS_PLANE_DT
		                                                                                     FROM (           
		                                                                                      SELECT  X.CO_CD, 
		                                                                                                  X.SALES_CD,
		                                                                                                  Y.ORDRS_CLNT_CD,
		                                                                                                  SUBSTR(X.SALES_CD,0,5) AS SALES_CD_GR
		                                                                                             FROM TB_CR02D02 X
		                                                                                      INNER JOIN TB_CR02M01 Y
		                                                                                      ON X.CO_CD = Y.CO_CD
		                                                                                      AND X.ORDRS_NO = Y.ORDRS_NO  ) X
		                                                                                      LEFT OUTER JOIN TB_WB01M01 Y
		                                                                                      ON X.CO_CD = Y.CO_CD
		                                                                                      AND X.SALES_CD = Y.SALES_CD )Z
		                                                                      GROUP BY CO_CD ) Z
		                                                                      WHERE WBS_PLANS_DT_ALL IS NOT NULL) Z1
		                                                        ON Z.CO_CD = Z1.CO_CD
		                                                        
		                                                        LEFT OUTER JOIN (
		                                                           SELECT     CO_CD,
		                                                                 ORDRS_CLNT_CD,
		                                                                 WBS_PLANS_DT_ORDRS,
		                                                                 WBS_PLANE_DT_ORDRS
		                                                                 FROM (
		                                                                     SELECT   MAX(CO_CD) AS CO_CD,
		                                                                                  MAX(ORDRS_CLNT_CD) AS ORDRS_CLNT_CD,
		                                                                                  MIN(WBS_PLANS_DT) AS WBS_PLANS_DT_ORDRS, 
		                                                                                  MAX(WBS_PLANE_DT) AS WBS_PLANE_DT_ORDRS           
		                                                                       FROM (
		                                                                         SELECT X.CO_CD,
		                                                                                    X.SALES_CD_GR,
		                                                                                    X.SALES_CD,
		                                                                                    X.ORDRS_CLNT_CD,
		                                                                                    Y.WBS_PLANS_DT,
		                                                                                    Y.WBS_PLANE_DT
		                                                                                    FROM (           
		                                                                                     SELECT  X.CO_CD, 
		                                                                                                 X.SALES_CD,
		                                                                                                 Y.ORDRS_CLNT_CD,
		                                                                                                 SUBSTR(X.SALES_CD,0,5) AS SALES_CD_GR
		                                                                                            FROM TB_CR02D02 X
		                                                                                     INNER JOIN TB_CR02M01 Y
		                                                                                     ON X.CO_CD = Y.CO_CD
		                                                                                     AND X.ORDRS_NO = Y.ORDRS_NO  ) X
		                                                                                     LEFT OUTER JOIN TB_WB01M01 Y
		                                                                                     ON X.CO_CD = Y.CO_CD
		                                                                                     AND X.SALES_CD = Y.SALES_CD )Z
		                                                                     GROUP BY CO_CD, ORDRS_CLNT_CD ) Z
		                                                                     WHERE WBS_PLANS_DT_ORDRS IS NOT NULL) Z2
		                                                        ON Z.CO_CD = Z2.CO_CD
		                                                        AND Z.ID =  TO_CHAR(Z2.ORDRS_CLNT_CD) 
		                                                        
		                                                        LEFT OUTER JOIN (
		                                                         SELECT CO_CD,
		                                                                ORDRS_CLNT_CD,
		                                                                SALES_CD_GR,
		                                                                WBS_PLANS_DT_SALES_GR,
		                                                                WBS_PLANE_DT_SALES_GR
		                                                                FROM (
		                                                                     SELECT   MAX(CO_CD) AS CO_CD,
		                                                                                  MAX(ORDRS_CLNT_CD) AS ORDRS_CLNT_CD,
		                                                                                  MAX(SALES_CD_GR) AS SALES_CD_GR,
		                                                                                  MIN(WBS_PLANS_DT) AS WBS_PLANS_DT_SALES_GR, 
		                                                                                  MAX(WBS_PLANE_DT) AS WBS_PLANE_DT_SALES_GR           
		                                                                       FROM (
		                                                                          SELECT X.CO_CD,
		                                                                                     X.SALES_CD_GR,
		                                                                                     X.SALES_CD,
		                                                                                     X.ORDRS_CLNT_CD,
		                                                                                     Y.WBS_PLANS_DT,
		                                                                                     Y.WBS_PLANE_DT
		                                                                                     FROM (           
		                                                                                      SELECT  X.CO_CD, 
		                                                                                                  X.SALES_CD,
		                                                                                                  Y.ORDRS_CLNT_CD,
		                                                                                                  SUBSTR(X.SALES_CD,0,5) AS SALES_CD_GR
		                                                                                             FROM TB_CR02D02 X
		                                                                                      INNER JOIN TB_CR02M01 Y
		                                                                                      ON X.CO_CD = Y.CO_CD
		                                                                                      AND X.ORDRS_NO = Y.ORDRS_NO  ) X
		                                                                                      LEFT OUTER JOIN TB_WB01M01 Y
		                                                                                      ON X.CO_CD = Y.CO_CD
		                                                                                      AND X.SALES_CD = Y.SALES_CD )Z
		                                                                     GROUP BY CO_CD, ORDRS_CLNT_CD, SALES_CD_GR ) Z
		                                                                     WHERE WBS_PLANS_DT_SALES_GR IS NOT NULL) Z3
		                                                        ON Z.CO_CD = Z3.CO_CD
		                                                        AND Z.ID =  Z3.SALES_CD_GR
		                                                                                                                                        
		                                                    ORDER BY LEN, NVL(PID,1),  ID, CODE_ID ASC   ) W )W 
                                 WHERE WBS_PLANS_DT IS NOT NULL AND SALES_CD LIKE '23018%'                                                          
                          </select>  
                          
                          
			    
			<select id="selectGanttAllList" parameterType="Map" resultType="CamelMap">
              SELECT CO_CD,
                     PID,
                     ID,
                     CLNT_NM,
                     LVL,
                     PATH, 
                     TO_DATE(TO_CHAR(WBS_PLANE_DT,'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(WBS_PLANS_DT,'YYYYMMDD'),'YYYYMMDD') AS DUR,
                     NVL(SALES_CD,' ') AS SALES_CD,                     
                     ORDRS_CLNT_CD,
                     WBS_RSLTS_RATE,
                     GANTT_TIT,
                     WBS_PLANS_DT,
                     WBS_PLANE_DT 
                 FROM (
                          SELECT   W.CO_CD,
                                   W.PID, 
                                   W.ID,
                                   W.CLNT_NM,
                                   W.LVL,
                                   W.PATH,
                                   W.DUR,
                                   NVL((SELECT X.WBS_RSLTS_RATE FROM TB_WB02M01 X WHERE X.CO_CD = #{coCd} AND X.WBS_PLAN_NO = W.WBS_PLAN_NO
                                     AND X.SALES_CD = W.SALES_CD),0) AS WBS_RSLTS_RATE,
                                   W.CODE_KIND,
                                   W.CODE_ID,
                                   W.CODE_NM,
                                   W.SALES_CD,
                                   W.WBS_PLAN_NO,
                                   W.CTRT_NM,
                                   W.WBS_PLAN_CNTS,
                                   W.SALES_CD_GR,
                                   W.ORDRS_CLNT_CD,
                                   CASE WHEN W.LVL = 1 THEN W.ID 
                                        WHEN W.LVL = 2 THEN W.CLNT_NM
                                        WHEN W.LVL = 3 THEN W.CTRT_NM
                                        WHEN W.LVL = 4 AND NVL(W.WBS_PLAN_NO,' ') != ' ' THEN '계획번호 : '||W.WBS_PLAN_NO
                                        WHEN W.LVL = 4 AND NVL(W.WBS_PLAN_NO,' ') = ' ' THEN ' '
                                        WHEN W.LVL = 5 OR W.LVL = 6 OR W.LVL = 7 THEN WBS_PLAN_CNTS  
                                        END GANTT_TIT,
                                   CASE WHEN W.LVL = 1 THEN W1.WBS_PLANS_DT_ALL 
                                        WHEN W.LVL = 2 THEN W2.WBS_PLANS_DT_ORDRS_CLNT_CD
                                        WHEN W.LVL = 3 THEN W3.WBS_PLANS_DT_ORDRS_NO
                                        WHEN W.LVL = 4 THEN W4.WBS_PLANS_DT_SALES_CD
                                        ELSE W.WBS_PLANS_DT END  AS WBS_PLANS_DT,
                                   CASE WHEN W.LVL = 1 THEN W1.WBS_PLANE_DT_ALL 
                                        WHEN W.LVL = 2 THEN W2.WBS_PLANE_DT_ORDRS_CLNT_CD
                                        WHEN W.LVL = 3 THEN W3.WBS_PLANE_DT_ORDRS_NO
                                        WHEN W.LVL = 4 THEN W4.WBS_PLANE_DT_SALES_CD
                                        ELSE W.WBS_PLANe_DT END AS WBS_PLANE_DT                             
                                   FROM (
                                        SELECT CO_CD,
                                               PID, 
                                               ID,
                                               CLNT_NM,
                                               LVL,
                                               PATH,
                                               WBS_PLANS_DT,
                                               WBS_PLANE_DT,
                                               DUR,
                                               WBS_RSLTS_RATE,
                                               CODE_KIND,
                                               CODE_ID,
                                               CODE_NM,
                                               SALES_CD,
                                               WBS_PLAN_NO,
                                               (SELECT X.CTRT_NM FROM TB_CR02M01 X WHERE X.CO_CD = #{coCd} AND X.ORDRS_NO = W.ID) AS CTRT_NM,
                                               (SELECT X.WBS_PLAN_CNTS FROM TB_WB01M01 X WHERE X.CO_CD = #{coCd} AND X.SALES_CD = W.SALES_CD AND X.WBS_PLAN_CODE_KIND = W.CODE_KIND 
                                                AND X.WBS_PLAN_CODE_ID = W.CODE_ID) AS WBS_PLAN_CNTS,
                                               SALES_CD_GR,
                                               ORDRS_CLNT_CD   
                                               FROM (
                                                    SELECT     CO_CD,
                                                               PID, 
                                                               ID, 
                                                               CLNT_NM, 
                                                               LEVEL AS LVL, 
                                                               LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CLNT_NM, '>') PATH, 
                                                               WBS_PLANS_DT,
                                                               WBS_PLANE_DT,
                                                               TO_DATE(TO_CHAR(WBS_PLANE_DT,'YYYYMMDD'),'YYYYMMDD') - TO_DATE(TO_CHAR(WBS_PLANS_DT,'YYYYMMDD'),'YYYYMMDD') AS DUR,
                                                               0 AS WBS_RSLTS_RATE,
                                                               CODE_KIND,
                                                               CODE_ID,
                                                               CODE_NM,
                                                               SALES_CD,
                                                               WBS_PLAN_NO,
                                                               SALES_CD_GR,
                                                               ORDRS_CLNT_CD
                                                        FROM (
                                                                -- 1 : 회사 그룹
                                                                SELECT  #{coCd} AS CO_CD,
                                                                        '0' AS PID,
                                                                        '건양ITT' AS ID,
                                                                        '전사 현황' AS CLNT_NM,
                                                                        '' AS WBS_PLANS_DT,
                                                                        '' AS WBS_PLANE_DT,
                                                                        '' AS CODE_KIND,
                                                                        '' AS CODE_ID,
                                                                        '' AS CODE_NM,
                                                                        '' AS SALES_CD,
                                                                        '' AS WBS_PLAN_NO,
                                                                        '' AS SALES_CD_GR,
                                                                        '' AS ORDRS_CLNT_CD                                             
                                                                FROM DUAL

                                                                UNION ALL 

                                                                -- 2 : 고객사 그룹
                                                                SELECT DISTINCT
                                                                       X.CO_CD AS CO_CD, 
                                                                       '건양ITT' AS PID,
                                                                       TO_CHAR(ORDRS_CLNT_CD) AS ID,
                                                                       (SELECT P.CLNT_NM FROM TB_BM02M01 P WHERE P.CLNT_CD = X.ORDRS_CLNT_CD) AS CLNT_NM,
                                                                       '' AS WBS_PLANS_DT,
                                                                       '' AS WBS_PLANE_DT,
                                                                       '' AS CODE_KIND,
                                                                       '' AS CODE_ID,
                                                                       '' AS CODE_NM,
                                                                       '' AS SALES_CD,
                                                                       '' AS WBS_PLAN_NO,
                                                                       '' AS SALES_CD_GR,
                                                                       X.ORDRS_CLNT_CD      
                                                                FROM 
                                                                TB_CR02M01 X
                                                                
                                                                WHERE X.CO_CD = #{coCd} 
                                                                AND X.ORDRS_CLNT_CD > 1
                                                                <if test="clntCd != null and !clntCd .equals('')">
                                                                  AND X.ORDRS_CLNT_CD = #{clntCd}                     
                                                                </if>
                                                                
                                                                UNION ALL 

                                                                -- 3 : 수주번호 그룹
                                                                SELECT  DISTINCT 
                                                                        Y.CO_CD AS CO_CD,
                                                                        TO_CHAR(Y.ORDRS_CLNT_CD) AS PID,
                                                                        SUBSTR(X.SALES_CD,0,5) AS ID,
                                                                        SUBSTR(X.SALES_CD,0,5) AS CLNT_NM,
                                                                        '' AS WBS_PLANS_DT,
                                                                        '' AS WBS_PLANE_DT,
                                                                        '' AS CODE_KIND,
                                                                        '' AS CODE_ID,
                                                                        '' AS CODE_NM,
                                                                        '' AS SALES_CD,
                                                                        '' AS WBS_PLAN_NO,
                                                                        SUBSTR(X.SALES_CD,0,5) AS SALES_CD_GR,
                                                                        Y.ORDRS_CLNT_CD AS ORDRS_CLNT_CD         
                                                                FROM TB_CR02D02 X
                                                                INNER JOIN TB_CR02M01 Y
                                                                ON X.CO_CD = Y.CO_CD
                                                                AND X.ORDRS_NO = Y.ORDRS_NO 
                                                                
                                                                WHERE Y.CO_CD = #{coCd} 
                                                                <if test="clntCd != null and !clntCd .equals('')">
                                                                  AND Y.ORDRS_CLNT_CD = #{clntCd}                     
                                                                </if>
                                                                <if test="salesCd != null and !salesCd.equals('')">
                                                                  AND X.SALES_CD LIKE '%${salesCd}%'                
                                                                </if> 
                                                                                             
                                                                UNION ALL 

                                                                -- 4 : SALES_CD 그룹
                                                                SELECT  DISTINCT 
                                                                        Y.CO_CD AS CO_CD,
                                                                        SUBSTR(X.SALES_CD,0,5) AS PID,
                                                                        X.SALES_CD AS ID,
                                                                        X.SALES_CD AS CLNT_NM,
                                                                        '' AS WBS_PLANS_DT,
                                                                        '' AS WBS_PLANE_DT,
                                                                        '' AS CODE_KIND,
                                                                        '' AS CODE_ID,
                                                                        '' AS CODE_NM,
                                                                        '' AS SALES_CD,
                                                                        (SELECT T.WBS_PLAN_NO FROM TB_WB01M01 T WHERE T.CO_CD = #{coCd} AND T.SALES_CD = X.SALES_CD AND ROWNUM = 1) 
                                                                        AS WBS_PLAN_NO,
                                                                        SUBSTR(X.SALES_CD,0,5) AS SALES_CD_GR,
                                                                        Y.ORDRS_CLNT_CD AS ORDRS_CLNT_CD   
                                                                FROM TB_CR02D02 X
                                                                INNER JOIN TB_CR02M01 Y
                                                                ON X.CO_CD = Y.CO_CD
                                                                AND X.ORDRS_NO = Y.ORDRS_NO
                                                                 
                                                                WHERE Y.CO_CD = #{coCd} 
                                                                <if test="clntCd != null and !clntCd .equals('')">
                                                                  AND Y.ORDRS_CLNT_CD = #{clntCd}                     
                                                                </if>
                                                                <if test="salesCd != null and !salesCd.equals('')">
                                                                  AND X.SALES_CD LIKE '%${salesCd}%'                
                                                                </if>                                                                      

                                                                UNION ALL

                                                                -- 5 : WBS계획 1레벨
                                                                SELECT  X.CO_CD AS CO_CD,
                                                                        SALES_CD AS  PID,
                                                                        SALES_CD||WBS_PLAN_CODE_ID AS ID, 
                                                                        CODE_NM AS CLNT_NM,
                                                                        WBS_PLANS_DT,
                                                                        WBS_PLANE_DT,
                                                                        CODE_KIND,
                                                                        CODE_ID,
                                                                        CODE_NM,
                                                                        SALES_CD,
                                                                        WBS_PLAN_NO,
                                                                        SUBSTR(SALES_CD,0,5) AS SALES_CD_GR,
                                                                        '' AS ORDRS_CLNT_CD
                                                                FROM TB_WB01M01 X
                                                                INNER JOIN (
                                                                       SELECT 
                                                                         CODE_KIND,
                                                                         CODE_ID,
                                                                         CODE_RPRC,
                                                                         CODE_NM,
                                                                         LEVEL AS LVL,
                                                                         LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CODE_NM, '>') PATH
                                                                        FROM TB_CM05M01
                                                                        START WITH CODE_KIND = 'WBSDIV'
                                                                        CONNECT BY PRIOR CODE_ID  =  CODE_KIND
                                                                        ORDER BY CODE_ID ASC ) Y
                                                                ON X.WBS_PLAN_CODE_KIND = Y.CODE_KIND
                                                                AND X.WBS_PLAN_CODE_ID = Y.CODE_ID
                                                                
                                                                WHERE LVL = 1
                                                                AND X.CO_CD = #{coCd} 


                                                               UNION ALL 

                                                               -- 6 : WBS계획 2레벨
                                                               SELECT X.CO_CD AS CO_CD,
                                                                    X.SALES_CD||WBS_PLAN_CODE_KIND AS PID, 
                                                                    X.SALES_CD||WBS_PLAN_CODE_ID AS ID,
                                                                    CODE_NM AS CLNT_NM,
                                                                    WBS_PLANS_DT,
                                                                    WBS_PLANE_DT,
                                                                    CODE_KIND,
                                                                    CODE_ID,
                                                                    CODE_NM,
                                                                    SALES_CD,
                                                                    WBS_PLAN_NO,
                                                                    SUBSTR(SALES_CD,0,5) AS SALES_CD_GR,
                                                                    '' AS ORDRS_CLNT_CD
                                                               FROM TB_WB01M01 X
                                                               INNER JOIN (
                                                                       SELECT 
                                                                         CODE_KIND,
                                                                         CODE_ID,
                                                                         CODE_RPRC,
                                                                         CODE_NM,
                                                                         LEVEL AS LVL,
                                                                         LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CODE_NM, '>') PATH
                                                                        FROM TB_CM05M01
                                                                        START WITH CODE_KIND = 'WBSDIV'
                                                                        CONNECT BY PRIOR CODE_ID  =  CODE_KIND
                                                                        ORDER BY CODE_ID ASC ) Y
                                                               ON X.WBS_PLAN_CODE_KIND = Y.CODE_KIND
                                                               AND X.WBS_PLAN_CODE_ID = Y.CODE_ID
                                                               
                                                               WHERE LVL = 2    
                                                               AND X.CO_CD = #{coCd} 



                                                               UNION ALL 

                                                               -- 7 : WBS계획 3레벨
                                                               SELECT X.CO_CD AS CO_CD, 
                                                                    X.SALES_CD||WBS_PLAN_CODE_KIND AS PID, 
                                                                    X.SALES_CD||WBS_PLAN_CODE_ID AS ID,
                                                                    CODE_NM AS CLNT_NM,
                                                                    WBS_PLANS_DT,
                                                                    WBS_PLANE_DT,
                                                                    CODE_KIND,
                                                                    CODE_ID,
                                                                    CODE_NM,
                                                                    SALES_CD,
                                                                    WBS_PLAN_NO,
                                                                    SUBSTR(SALES_CD,0,5) AS SALES_CD_GR,
                                                                    '' AS ORDRS_CLNT_CD
                                                               FROM TB_WB01M01 X
                                                               INNER JOIN (
                                                                       SELECT 
                                                                         CODE_KIND,
                                                                         CODE_ID,
                                                                         CODE_RPRC,
                                                                         CODE_NM,
                                                                         LEVEL AS LVL,
                                                                         LPAD(' ', 3*LEVEL-1) || SYS_CONNECT_BY_PATH(CODE_NM, '>') PATH
                                                                        FROM TB_CM05M01
                                                                        START WITH CODE_KIND = 'WBSDIV'
                                                                        CONNECT BY PRIOR CODE_ID  =  CODE_KIND
                                                                        ORDER BY CODE_ID ASC ) Y
                                                               ON X.WBS_PLAN_CODE_KIND = Y.CODE_KIND
                                                               AND X.WBS_PLAN_CODE_ID = Y.CODE_ID
                                                               
                                                               WHERE LVL = 3
                                                               AND X.CO_CD = #{coCd} 


                                                            ) W                                
                                                            START WITH PID = '0'
                                                            CONNECT BY PRIOR ID = PID ) W ) W  

                                                            LEFT OUTER JOIN (
                                                                 SELECT MAX(X.CO_CD) AS CO_CD,
                                                                     MIN(Y.WBS_PLANS_DT) AS WBS_PLANS_DT_ALL,
                                                                     MAX(Y.WBS_PLANE_DT) AS WBS_PLANE_DT_ALL
                                                                 FROM (           
                                                                  SELECT  X.CO_CD, 
                                                                              X.SALES_CD
                                                                         FROM TB_CR02D02 X
                                                                  INNER JOIN TB_CR02M01 Y
                                                                  ON X.CO_CD = Y.CO_CD
                                                                  AND X.ORDRS_NO = Y.ORDRS_NO  ) X
                                                                  LEFT OUTER JOIN TB_WB01M01 Y
                                                                  ON X.CO_CD = Y.CO_CD
                                                                  AND X.SALES_CD = Y.SALES_CD
                                                                GROUP BY X.CO_CD ) W1
                                                            ON W.CO_CD = W1.CO_CD 

                                                            LEFT OUTER JOIN (
                                                            SELECT CO_CD,
                                                                   ORDRS_CLNT_CD,
                                                                   WBS_PLANS_DT_ORDRS_CLNT_CD,
                                                                   WBS_PLANE_DT_ORDRS_CLNT_CD
                                                                   FROM (           
                                                                        SELECT MAX(X.CO_CD) AS CO_CD,
                                                                               MAX(X.ORDRS_CLNT_CD) AS ORDRS_CLNT_CD,
                                                                               MIN(Y.WBS_PLANS_DT) AS WBS_PLANS_DT_ORDRS_CLNT_CD,
                                                                               MAX(Y.WBS_PLANE_DT) AS WBS_PLANE_DT_ORDRS_CLNT_CD
                                                                         FROM (           
                                                                          SELECT  Y.CO_CD, 
                                                                                  Y.ORDRS_NO,
                                                                                  Y.ORDRS_CLNT_CD,
                                                                                  X.SALES_CD
                                                                                 FROM TB_CR02D02 X
                                                                          INNER JOIN TB_CR02M01 Y
                                                                          ON X.CO_CD = Y.CO_CD
                                                                          AND X.ORDRS_NO = Y.ORDRS_NO  ) X
                                                                          LEFT OUTER JOIN TB_WB01M01 Y
                                                                          ON X.CO_CD = Y.CO_CD
                                                                          AND X.SALES_CD = Y.SALES_CD
                                                                         GROUP BY X.CO_CD, X.ORDRS_CLNT_CD ) W2 
                                                                 WHERE   WBS_PLANS_DT_ORDRS_CLNT_CD IS NOT NULL ) W2
                                                            ON W.CO_CD = W2.CO_CD
                                                            AND W.ORDRS_CLNT_CD = W2.ORDRS_CLNT_CD         

                                                            LEFT OUTER JOIN (
                                                            SELECT CO_CD,
                                                                   ORDRS_NO,
                                                                   WBS_PLANS_DT_ORDRS_NO,
                                                                   WBS_PLANE_DT_ORDRS_NO
                                                                   FROM (           
                                                                        SELECT MAX(X.CO_CD) AS CO_CD,
                                                                               MAX(X.ORDRS_NO) AS ORDRS_NO,
                                                                               MIN(Y.WBS_PLANS_DT) AS WBS_PLANS_DT_ORDRS_NO,
                                                                               MAX(Y.WBS_PLANE_DT) AS WBS_PLANE_DT_ORDRS_NO
                                                                         FROM (           
                                                                          SELECT  X.CO_CD, 
                                                                                  Y.ORDRS_NO,
                                                                                  X.SALES_CD
                                                                                 FROM TB_CR02D02 X
                                                                          INNER JOIN TB_CR02M01 Y
                                                                          ON X.CO_CD = Y.CO_CD
                                                                          AND X.ORDRS_NO = Y.ORDRS_NO  ) X
                                                                          LEFT OUTER JOIN TB_WB01M01 Y
                                                                          ON X.CO_CD = Y.CO_CD
                                                                          AND X.SALES_CD = Y.SALES_CD
                                                                         GROUP BY X.CO_CD, X.ORDRS_NO ) W3 
                                                                 WHERE   WBS_PLANS_DT_ORDRS_NO IS NOT NULL )W3
                                                            ON W.CO_CD = W3.CO_CD
                                                            AND W.SALES_CD_GR = W3.ORDRS_NO        

                                                            LEFT OUTER JOIN (
                                                            SELECT CO_CD,
                                                                   SALES_CD,
                                                                   WBS_PLANS_DT_SALES_CD,
                                                                   WBS_PLANE_DT_SALES_CD
                                                                   FROM (           
                                                                        SELECT MAX(X.CO_CD) AS CO_CD,
                                                                               MAX(X.SALES_CD) AS SALES_CD,
                                                                               MIN(Y.WBS_PLANS_DT) AS WBS_PLANS_DT_SALES_CD,
                                                                               MAX(Y.WBS_PLANE_DT) AS WBS_PLANE_DT_SALES_CD
                                                                         FROM (           
                                                                          SELECT  X.CO_CD, 
                                                                                  Y.ORDRS_NO,
                                                                                  X.SALES_CD
                                                                                 FROM TB_CR02D02 X
                                                                          INNER JOIN TB_CR02M01 Y
                                                                          ON X.CO_CD = Y.CO_CD
                                                                          AND X.ORDRS_NO = Y.ORDRS_NO  ) X
                                                                          LEFT OUTER JOIN TB_WB01M01 Y
                                                                          ON X.CO_CD = Y.CO_CD
                                                                          AND X.SALES_CD = Y.SALES_CD
                                                                         GROUP BY X.CO_CD, X.SALES_CD ) W4 
                                                                 WHERE   WBS_PLANS_DT_SALES_CD IS NOT NULL )W4
                                                            ON W.CO_CD = W4.CO_CD
                                                            AND W.LVL = 4
                                                            AND W.ID = W4.SALES_CD 
                                    )W
                         WHERE TO_CHAR(WBS_PLANS_DT,'YYYY-MM-DD') IS NOT NULL                 
                </select>                                                                                          
 </mapper>