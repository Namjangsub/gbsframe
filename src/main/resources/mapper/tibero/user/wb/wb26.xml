<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.wb.wb26.mapper.WB26Mapper">
    
    <select id="select_wb26_Count" parameterType="Map" resultType="int">
        SELECT COUNT(*)
        FROM   (
                SELECT X.*
                     , ROWNUM AS RN
                FROM   (
                        WITH SJD AS --수주상세
                        (
                         SELECT M.CO_CD                                            AS CO_CD        --회사코드
                              , M.ORDRS_NO                                         AS ORDRS_NO     --수주번호
                              , X.SALES_CD                                         AS SALES_CD     --SALES Code
                              , M.ORDRS_CLNT_CD                                    AS CLNT_CD      --고객코드
                              , C.CLNT_NM                                          AS CLNT_NM      --고객명
                              , (SELECT FN_CM05M01_CD_TO_NM(M.CLNT_PJT) FROM DUAL) AS CLNT_PJT_NM  --프로젝트
                              , M.CTRT_NM                                          AS CTRT_NM      --계약명
                              , P.VER_NO                                           AS PLAN_VER_NO  --계획ver
                         FROM   TB_WB21M01 AS P
                                INNER JOIN TB_CR02D02 AS X ON X.CO_CD = P.CO_CD AND X.SALES_CD = P.SALES_CD    --수주상세
                                INNER JOIN TB_CR02M01 AS M ON M.CO_CD = P.CO_CD AND M.ORDRS_NO = X.ORDRS_NO    --수주마스터
                                INNER JOIN TB_BM02M01 AS C ON M.ORDRS_CLNT_CD = C.CLNT_CD    --거래처정보
                         WHERE  1 = 1
                         AND    P.VER_NO = (
                                            SELECT MAX(TO_NUMBER(VER_NO))
                                            FROM   TB_WB21M01 AS P1
                                            WHERE  P1.SJ_NO = P.SJ_NO
                                           )
                         AND    P.CLOSE_YN = 'Y'
                        )
                        --과제 등록된 내용중 일정계획 수립확정 되니 않은 건 확정건에 대한 계획수립 안한 내역
                        SELECT SJ.CLNT_NM                            AS CLNT_NM
                             , SJ.CLNT_PJT_NM                        AS CLNT_PJT_NM
                             , P.SALES_CD                            AS SALES_CD
                             , SJ.CTRT_NM                            AS CTRT_NM
                             , (SELECT FN_CM05M01_CD_TO_NM(P.WBS_PLAN_CODE_KIND) FROM DUAL) AS WBS_PLAN_NM --WBS 계획명
                             , TO_CHAR(R.WBS_PLANS_DT, 'YYYY-MM-DD')  AS PLAN_STRT_DT --WBS Task 시작일
                             , TO_CHAR(R.WBS_PLANE_DT, 'YYYY-MM-DD')  AS PLAN_END_DT  --WBS Task 종료일
                             , R.DAYCNT                               AS PLAN_DAYCNT
                             , P.WBS_PLAN_CODE_NM                     AS WBS_TASK_NM --WBS Task NM
                             , TO_CHAR(P.WBS_PLANS_DT, 'YYYY-MM-DD')  AS TASK_STRT_DT --WBS Task 시작일
                             , TO_CHAR(P.WBS_PLANE_DT, 'YYYY-MM-DD')  AS TASK_END_DT  --WBS Task 종료일
                             , P.DAYCNT                               AS TASK_DAYCNT
                             , P.EXPECT_MH                            AS TASK_EXPECT_MH
                             , TO_CHAR(S.WBS_RSLTSS_DT, 'YYYY-MM-DD') AS RSLT_STRT_DT --WBS Task 시작일
                             , TO_CHAR(S.WBS_RSLTSE_DT, 'YYYY-MM-DD') AS RSLT_END_DT  --WBS Task 종료일
                             , NVL(S.DAYCNT,0)                        AS RSLT_DAYCNT
                             , S.WBS_RSLTS_MH                         AS RSLT_INTOCNT
                             , NVL(S.WBS_RSLTS_RATE,0)                AS RSLT_RATE    --WBS 실적 진행율
                             , (SELECT FN_CM06M01_ID_TO_NM(P.WBS_PLAN_MNG_ID) FROM DUAL)  AS WBS_MNG_NM --담당자명
                             -- 관련코드 참고정보 -----------------------------------------------
                             , SJ.CLNT_CD                      AS CLNT_CD 
                             , P.WBS_PLAN_CODE_KIND            AS WBS_PLAN_CD --WBS 계획CD
                             , P.WBS_PLAN_CODE_ID              AS WBS_TASK_ID --WBS Task ID 
                             , P.WBS_PLAN_MNG_ID               AS WBS_MNG_ID  --담당자ID
                             , ROUND(P.WBS_PLANE_DT - SYSDATE) AS VARIANCE_DT --종료예정 차이 일수 
                             , P.CO_CD
                             , SJ.PLAN_VER_NO                  AS PLAN_VER_NO --계획ver
                             , NVL(S.CLOSE_YN, 'N')            AS RSLT_CLOSE_YN
                             , CONCAT(CONCAT(SJ.CLNT_NM, ' - '), SJ.CLNT_PJT_NM) AS CLNT_NM_PJT_NM
                             , NVL(S.FILE_TRGT_KEY, '.')       AS RSLT_FILE_TRGT_KEY
                             , CASE WHEN NVL(S.FILE_TRGT_KEY, '.') = '.' THEN 'I' ELSE 'U' END AS DATA_STS
                             , ''                              AS DATA_CHK
                             , P.WBS_PLAN_NO                   AS WBS_PLAN_NO
                             , 'N'                             AS NONE_PLAN_YN
                        FROM   TB_WB22M01 AS P    --WBS계획
                               INNER JOIN SJD  AS SJ  ON P.CO_CD    = SJ.CO_CD
                                                     AND P.SALES_CD = SJ.SALES_CD
                               LEFT OUTER JOIN TB_WB22M01 AS R  ON R.CO_CD    = P.CO_CD
                                                               AND R.SALES_CD = P.SALES_CD
                                                               AND R.WBS_PLAN_CODE_ID = P.WBS_PLAN_CODE_KIND
                               LEFT OUTER JOIN TB_WB23M01 AS S  ON P.CO_CD              = S.CO_CD
                                                               AND P.SALES_CD           = S.SALES_CD
                                                               AND P.WBS_PLAN_CODE_KIND = S.WBS_PLAN_CODE_KIND
                                                               AND P.WBS_PLAN_CODE_ID   = S.WBS_PLAN_CODE_ID
                        WHERE  1 = 1
                        AND    P.WBS_PLANS_DT  <![CDATA[ <= ]]> ( SYSDATE ) --현재일 이전 시작일 기준
                        AND    P.WBS_PLAN_MNG_ID = #{usrId}
                        AND    P.WBS_PLAN_CODE_KIND <![CDATA[<>]]> 'WBSCODE'
                        <if test="coCd != null and !coCd.equals('')">
                        AND    P.CO_CD = #{coCd}
                        </if>
		                <if test="salesCd != null and !salesCd.equals('')">
		                AND    P.SALES_CD LIKE '%'||#{salesCd}||'%'
		                </if>
		                <if test="rsltCloseYn != null and !rsltCloseYn.equals('')">
		                AND    NVL(S.CLOSE_YN, 'N') LIKE #{rsltCloseYn}
		                </if>
                        --AND    NVL(R.WBS_RSLTS_RATE,0) <![CDATA[<>]]> 100
                  UNION All    --일정계획 확정건에 대한 계획수립 안한 내역
                        SELECT SJ.CLNT_NM                             AS CLNT_NM
                             , SJ.CLNT_PJT_NM                         AS CLNT_PJT_NM
                             , P.SALES_CD                             AS SALES_CD
                             , SJ.CTRT_NM                             AS CTRT_NM
                             , '일정계획수립'                          AS WBS_PLAN_NM --WBS 계획명
                             , TO_CHAR(R.WBS_PLANS_DT, 'YYYY-MM-DD')  AS PLAN_STRT_DT --WBS Task 시작일
                             , TO_CHAR(R.WBS_PLANE_DT, 'YYYY-MM-DD')  AS PLAN_END_DT  --WBS Task 종료일
                             , R.DAYCNT                               AS PLAN_DAYCNT
                             , (SELECT FN_CM05M01_CD_TO_NM(P.WBS_PLAN_CODE_ID) FROM DUAL) || ' 계획등록' AS WBS_TASK_NM  --WBS Task NM
                             , TO_CHAR(P.WBS_PLANS_DT, 'YYYY-MM-DD')  AS TASK_STRT_DT --WBS Task 시작일
                             , TO_CHAR(P.WBS_PLANE_DT, 'YYYY-MM-DD')  AS TASK_END_DT  --WBS Task 종료일
                             , P.DAYCNT                               AS TASK_DAYCNT
                             , P.EXPECT_MH                            AS TASK_EXPECT_MH
                             , ''                                     AS RSLT_STRT_DT --WBS Task 시작일
                             , ''                                     AS RSLT_END_DT  --WBS Task 종료일
                             , '0'                                    AS RSLT_DAYCNT
                             , 0                                      AS RSLT_INTOCNT
                             , 0                                      AS RSLT_RATE    --WBS 실적 진행율
                             , (SELECT FN_CM06M01_ID_TO_NM(P.WBS_PLAN_MNG_ID) FROM DUAL)  AS WBS_MNG_NM --담당자명
                             -- 관련코드 참고정보 -----------------------------------------------
                             , SJ.CLNT_CD                      AS CLNT_CD 
                             , P.WBS_PLAN_CODE_KIND            AS WBS_PLAN_CD --WBS 계획CD
                             , P.WBS_PLAN_CODE_ID              AS WBS_TASK_ID --WBS Task ID 
                             , P.WBS_PLAN_MNG_ID               AS WBS_MNG_ID  --담당자ID
                             , ROUND(P.WBS_PLANE_DT - SYSDATE) AS VARIANCE_DT --종료예정 차이 일수 
                             , P.CO_CD
                             , SJ.PLAN_VER_NO                  AS PLAN_VER_NO --계획ver
                             , 'N'                             AS RSLT_CLOSE_YN
                             , CONCAT(CONCAT(SJ.CLNT_NM, ' - '), SJ.CLNT_PJT_NM) AS CLNT_NM_PJT_NM
                             , '.'                             AS RSLT_FILE_TRGT_KEY
                             , ''                              AS DATA_STS
                             , ''                              AS DATA_CHK
                             , P.WBS_PLAN_NO                   AS WBS_PLAN_NO
                             , 'Y'                             AS NONE_PLAN_YN
                        FROM   TB_WB22M01 AS P
                               LEFT OUTER JOIN TB_WB22M01 AS R  ON R.CO_CD    = P.CO_CD
                                                               AND R.SALES_CD = P.SALES_CD
                                                               AND R.WBS_PLAN_CODE_KIND = P.WBS_PLAN_CODE_ID
                               LEFT OUTER JOIN SJD AS SJ  ON P.SALES_CD = SJ.SALES_CD
                        WHERE  1 = 1
                        AND    P.WBS_PLAN_MNG_ID = #{usrId}
                        AND    P.WBS_PLAN_CODE_KIND = 'WBSCODE'
                        AND    P.WBS_PLANS_DT IS NOT NULL
                        AND    P.WBS_PLAN_MNG_ID IS NOT NULL
                        AND    R.FILE_TRGT_KEY IS NULL
                        AND    P.CLOSE_YN = 'Y'
                        AND    SJ.SALES_CD IS NOT NULL
				 UNION All   --과제별  매뉴얼 작성 대상인경우 기계매뉴얼 체크  						     	 
                        SELECT SJ.CLNT_NM                             AS CLNT_NM
                             , SJ.CLNT_PJT_NM                         AS CLNT_PJT_NM
                             , P.SALES_CD                             AS SALES_CD
                             , SJ.CTRT_NM                             AS CTRT_NM
                             , '기계매뉴얼등록' 						  AS WBS_PLAN_NM --WBS 계획명
						     , TO_CHAR(R.WBS_PLANS_DT, 'YYYY-MM-DD')  AS PLAN_STRT_DT --WBS Task 시작일
						     , TO_CHAR(R.WBS_PLANE_DT, 'YYYY-MM-DD')  AS PLAN_END_DT  --WBS Task 종료일
                             , '0'                                    AS PLAN_DAYCNT
                             , '기계매뉴얼등록'                     	  AS WBS_TASK_NM --WBS Task NM
                             , ''  									  AS TASK_STRT_DT --WBS Task 시작일
                             , CASE WHEN WD.MANUAL_MC IS NOT NULL 
                                    THEN TO_CHAR(WD.CREAT_DTTM, 'YYYY-MM-DD')
                                    ELSE ''
                                    END 							  AS TASK_END_DT  --WBS Task 종료일
                             , ''                               	  AS TASK_DAYCNT
                             , 0                          		  	  AS TASK_EXPECT_MH
                             , '' 									  AS RSLT_STRT_DT --WBS Task 시작일
                             , CASE WHEN WD.MANUAL_MC IS NOT NULL 
                                    THEN TO_CHAR(WD.CREAT_DTTM, 'YYYY-MM-DD')
                                    ELSE ''
                                    END 							  AS RSLT_END_DT  --WBS Task 종료일
                             , ''                        			  AS RSLT_DAYCNT
                             , 0			                          AS RSLT_INTOCNT
                             , 0					                  AS RSLT_RATE    --WBS 실적 진행율
                             , (SELECT FN_CM06M01_ID_TO_NM(R.WBS_PLAN_MNG_ID) FROM DUAL)  AS WBS_MNG_NM --담당자명
                             -- 관련코드 참고정보 -----------------------------------------------
                             , SJ.CLNT_CD                      		AS CLNT_CD 
						     , 'MANUAL'                       		AS WBS_PLAN_CD --WBS 계획CD
						     , 'MANUALMC'   				   		AS WBS_TASK_ID --WBS Task ID 
                             , R.WBS_PLAN_MNG_ID               		AS WBS_MNG_ID  --담당자ID
                             , ROUND(R.WBS_PLANE_DT - SYSDATE) 		AS VARIANCE_DT --종료예정 차이 일수 
                             , P.CO_CD
                             , SJ.PLAN_VER_NO                  		AS PLAN_VER_NO --계획ver
                             , 'N'            				   		AS RSLT_CLOSE_YN
                             , CONCAT(CONCAT(SJ.CLNT_NM, ' - '), SJ.CLNT_PJT_NM) AS CLNT_NM_PJT_NM
                             , P.FILE_TRGT_KEY       	   	   		AS RSLT_FILE_TRGT_KEY
                             , CASE WHEN NVL(WD.SALES_CD, '.') = '.' THEN 'I' ELSE 'U' END AS DATA_STS
                             , ''                              		AS DATA_CHK
                             , 'MANUALMC'                   		AS WBS_PLAN_NO
                             , 'Y'                             		AS NONE_PLAN_YN
						FROM TB_WB21M01 P
								LEFT OUTER JOIN TB_WB21D02 AS WD ON WD.SALES_CD = P.SALES_CD
								LEFT OUTER JOIN SJD        AS SJ ON SJ.SALES_CD = P.SALES_CD
								INNER JOIN TB_WB22M01 AS R  ON R.CO_CD     = P.CO_CD
								                                AND R.SALES_CD  =  P.SALES_CD
								                                AND R.WBS_PLAN_CODE_ID = 'WBSCODE03'
								                                AND R.WBS_PLAN_MNG_ID = #{usrId}
						WHERE P.MANUAL_YN = 'Y'
						  AND P.CLOSE_YN = 'Y'
						  AND R.WBS_PLANE_DT   <![CDATA[ <]]>  ( SYSDATE + 7) --종료일 7일 이전 내역
						  AND P.VER_NO  = (SELECT MAX(TO_NUMBER(VER_NO)) FROM TB_WB21M01 P1 WHERE P1.SJ_NO = P.SJ_NO)
						  AND WD.MANUAL_MC IS NULL   --WD.MANUAL_ELEC
						  
				 UNION All   --과제별  매뉴얼 작성 대상인경우 전기매뉴얼 체크   					     	 
                        SELECT SJ.CLNT_NM                            AS CLNT_NM
                             , SJ.CLNT_PJT_NM                        AS CLNT_PJT_NM
                             , P.SALES_CD                            AS SALES_CD
                             , SJ.CTRT_NM                            AS CTRT_NM
                             , '전기매뉴얼등록' 						 AS WBS_PLAN_NM --WBS 계획명
						     , TO_CHAR(R.WBS_PLANS_DT, 'YYYY-MM-DD') AS PLAN_STRT_DT --WBS Task 시작일
						     , TO_CHAR(R.WBS_PLANE_DT, 'YYYY-MM-DD') AS PLAN_END_DT  --WBS Task 종료일
                             , '0'                                   AS PLAN_DAYCNT
                             , '전기매뉴얼등록'                     	  AS WBS_TASK_NM --WBS Task NM
                             , ''  									  AS TASK_STRT_DT --WBS Task 시작일
                             , CASE WHEN WD.MANUAL_MC IS NOT NULL 
                                    THEN TO_CHAR(WD.CREAT_DTTM, 'YYYY-MM-DD')
                                    ELSE ''
                                    END 							  AS TASK_END_DT  --WBS Task 종료일
                             , ''                               	  AS TASK_DAYCNT
                             , 0                          		  	  AS TASK_EXPECT_MH
                             , '' 									  AS RSLT_STRT_DT --WBS Task 시작일
                             , CASE WHEN WD.MANUAL_MC IS NOT NULL 
                                    THEN TO_CHAR(WD.CREAT_DTTM, 'YYYY-MM-DD')
                                    ELSE ''
                                    END 							  AS RSLT_END_DT  --WBS Task 종료일
                             , ''                        			  AS RSLT_DAYCNT
                             , 0			                          AS RSLT_INTOCNT
                             , 0					                  AS RSLT_RATE    --WBS 실적 진행율
                             , (SELECT FN_CM06M01_ID_TO_NM(R.WBS_PLAN_MNG_ID) FROM DUAL)  AS WBS_MNG_NM --담당자명
                             -- 관련코드 참고정보 -----------------------------------------------
                             , SJ.CLNT_CD                      		AS CLNT_CD 
						     , 'MANUAL'                       		AS WBS_PLAN_CD --WBS 계획CD
						     , 'MANUALELEC'   				   		AS WBS_TASK_ID --WBS Task ID 
                             , R.WBS_PLAN_MNG_ID               		AS WBS_MNG_ID  --담당자ID
                             , ROUND(R.WBS_PLANE_DT - SYSDATE) 		AS VARIANCE_DT --종료예정 차이 일수 
                             , P.CO_CD
                             , SJ.PLAN_VER_NO                  		AS PLAN_VER_NO --계획ver
                             , 'N'            				   		AS RSLT_CLOSE_YN
                             , CONCAT(CONCAT(SJ.CLNT_NM, ' - '), SJ.CLNT_PJT_NM) AS CLNT_NM_PJT_NM
                             , P.FILE_TRGT_KEY       	   	   		AS RSLT_FILE_TRGT_KEY
                             , CASE WHEN NVL(WD.SALES_CD, '.') = '.' THEN 'I' ELSE 'U' END AS DATA_STS
                             , ''                              		AS DATA_CHK
                             , 'MANUALELEC'                    		AS WBS_PLAN_NO
                             , 'Y'                             		AS NONE_PLAN_YN
						FROM TB_WB21M01 P
								LEFT OUTER JOIN TB_WB21D02 AS WD ON WD.SALES_CD = P.SALES_CD
								LEFT OUTER JOIN SJD        AS SJ ON SJ.SALES_CD = P.SALES_CD
								INNER JOIN TB_WB22M01 AS R  ON R.CO_CD     = P.CO_CD
								                                AND R.SALES_CD  =  P.SALES_CD
								                                AND R.WBS_PLAN_CODE_ID = 'WBSCODE06'
								                                AND R.WBS_PLAN_MNG_ID = #{usrId}
						WHERE P.MANUAL_YN = 'Y'
						  AND P.CLOSE_YN = 'Y' 
						  AND R.WBS_PLANE_DT   <![CDATA[ <]]>  ( SYSDATE + 7) --종료일 7일 이전 내역
						  AND P.VER_NO  = (SELECT MAX(TO_NUMBER(VER_NO)) FROM TB_WB21M01 P1 WHERE P1.SJ_NO = P.SJ_NO)
						  AND WD.MANUAL_ELEC IS NULL
                       ) AS X
                WHERE  1 = 1
                <if test="salesCd != null and !salesCd.equals('')">
                AND    X.SALES_CD LIKE '%'||#{salesCd}||'%'
                </if>
                <if test="rsltCloseYn != null and !rsltCloseYn.equals('')">
                AND    X.RSLT_CLOSE_YN LIKE #{rsltCloseYn}
                </if>
                ORDER BY SALES_CD, WBS_PLAN_CD, WBS_TASK_ID
                
               ) AS Z
    </select>
    
    <select id="select_wb26_List" parameterType="Map" resultType="camelMap">
        SELECT Z.*
        FROM   (
                SELECT X.*
                     , ROWNUM AS RN
                FROM   (
                        WITH SJD AS --수주상세
                        (
                         SELECT M.CO_CD                                            AS CO_CD        --회사코드
                              , M.ORDRS_NO                                         AS ORDRS_NO     --수주번호
                              , X.SALES_CD                                         AS SALES_CD     --SALES Code
                              , M.ORDRS_CLNT_CD                                    AS CLNT_CD      --고객코드
                              , C.CLNT_NM                                          AS CLNT_NM      --고객명
                              , (SELECT FN_CM05M01_CD_TO_NM(M.CLNT_PJT) FROM DUAL) AS CLNT_PJT_NM  --프로젝트
                              , M.CTRT_NM                                          AS CTRT_NM      --계약명
                              , P.VER_NO                                           AS PLAN_VER_NO  --계획ver
                         FROM   TB_WB21M01 AS P
                                INNER JOIN TB_CR02D02 AS X ON X.CO_CD = P.CO_CD AND X.SALES_CD = P.SALES_CD    --수주상세
                                INNER JOIN TB_CR02M01 AS M ON M.CO_CD = P.CO_CD AND M.ORDRS_NO = X.ORDRS_NO    --수주마스터
                                INNER JOIN TB_BM02M01 AS C ON M.ORDRS_CLNT_CD = C.CLNT_CD    --거래처정보
                         WHERE  1 = 1
                         AND    P.VER_NO = (
                                            SELECT MAX(TO_NUMBER(VER_NO))
                                            FROM   TB_WB21M01 AS P1
                                            WHERE  P1.SJ_NO = P.SJ_NO
                                           )
                         AND    P.CLOSE_YN = 'Y'
                        )
                        --과제 등록된 내용중 일정계획 수립확정 되니 않은 건 확정건에 대한 계획수립 안한 내역
                        SELECT SJ.CLNT_NM                            AS CLNT_NM
                             , SJ.CLNT_PJT_NM                        AS CLNT_PJT_NM
                             , P.SALES_CD                            AS SALES_CD
                             , SJ.CTRT_NM                            AS CTRT_NM
                             , (SELECT FN_CM05M01_CD_TO_NM(P.WBS_PLAN_CODE_KIND) FROM DUAL) AS WBS_PLAN_NM --WBS 계획명
                             , TO_CHAR(R.WBS_PLANS_DT, 'YYYY-MM-DD')  AS PLAN_STRT_DT --WBS Task 시작일
                             , TO_CHAR(R.WBS_PLANE_DT, 'YYYY-MM-DD')  AS PLAN_END_DT  --WBS Task 종료일
                             , R.DAYCNT                               AS PLAN_DAYCNT
                             , P.WBS_PLAN_CODE_NM                     AS WBS_TASK_NM --WBS Task NM
                             , TO_CHAR(P.WBS_PLANS_DT, 'YYYY-MM-DD')  AS TASK_STRT_DT --WBS Task 시작일
                             , TO_CHAR(P.WBS_PLANE_DT, 'YYYY-MM-DD')  AS TASK_END_DT  --WBS Task 종료일
                             , P.DAYCNT                               AS TASK_DAYCNT
                             , P.EXPECT_MH                            AS TASK_EXPECT_MH
                             , TO_CHAR(S.WBS_RSLTSS_DT, 'YYYY-MM-DD') AS RSLT_STRT_DT --WBS Task 시작일
                             , TO_CHAR(S.WBS_RSLTSE_DT, 'YYYY-MM-DD') AS RSLT_END_DT  --WBS Task 종료일
                             , NVL(S.DAYCNT,0)                        AS RSLT_DAYCNT
                             , S.WBS_RSLTS_MH                         AS RSLT_INTOCNT
                             , NVL(S.WBS_RSLTS_RATE,0)                AS RSLT_RATE    --WBS 실적 진행율
                             , (SELECT FN_CM06M01_ID_TO_NM(P.WBS_PLAN_MNG_ID) FROM DUAL)  AS WBS_MNG_NM --담당자명
                             -- 관련코드 참고정보 -----------------------------------------------
                             , SJ.CLNT_CD                      AS CLNT_CD 
                             , P.WBS_PLAN_CODE_KIND            AS WBS_PLAN_CD --WBS 계획CD
                             , P.WBS_PLAN_CODE_ID              AS WBS_TASK_ID --WBS Task ID 
                             , P.WBS_PLAN_MNG_ID               AS WBS_MNG_ID  --담당자ID
                             , ROUND(P.WBS_PLANE_DT - SYSDATE) AS VARIANCE_DT --종료예정 차이 일수 
                             , P.CO_CD
                             , SJ.PLAN_VER_NO                  AS PLAN_VER_NO --계획ver
                             , NVL(S.CLOSE_YN, 'N')            AS RSLT_CLOSE_YN
                             , CONCAT(CONCAT(SJ.CLNT_NM, ' - '), SJ.CLNT_PJT_NM) AS CLNT_NM_PJT_NM
                             , NVL(S.FILE_TRGT_KEY, '.')       AS RSLT_FILE_TRGT_KEY
                             , CASE WHEN NVL(S.FILE_TRGT_KEY, '.') = '.' THEN 'I' ELSE 'U' END AS DATA_STS
                             , ''                              AS DATA_CHK
                             , P.WBS_PLAN_NO                   AS WBS_PLAN_NO
                             , 'N'                             AS NONE_PLAN_YN
                        FROM   TB_WB22M01 AS P    --WBS계획
                               INNER JOIN SJD  AS SJ  ON P.CO_CD    = SJ.CO_CD
                                                     AND P.SALES_CD = SJ.SALES_CD
                               LEFT OUTER JOIN TB_WB22M01 AS R  ON R.CO_CD    = P.CO_CD
                                                               AND R.SALES_CD = P.SALES_CD
                                                               AND R.WBS_PLAN_CODE_ID = P.WBS_PLAN_CODE_KIND
                               LEFT OUTER JOIN TB_WB23M01 AS S  ON P.CO_CD              = S.CO_CD
                                                               AND P.SALES_CD           = S.SALES_CD
                                                               AND P.WBS_PLAN_CODE_KIND = S.WBS_PLAN_CODE_KIND
                                                               AND P.WBS_PLAN_CODE_ID   = S.WBS_PLAN_CODE_ID
                        WHERE  1 = 1
                        AND    P.WBS_PLANS_DT  <![CDATA[ <= ]]> ( SYSDATE ) --현재일 이전 시작일 기준
                        AND    P.WBS_PLAN_MNG_ID = #{usrId}
                        AND    P.WBS_PLAN_CODE_KIND <![CDATA[<>]]> 'WBSCODE'
                        <if test="coCd != null and !coCd.equals('')">
                        AND    P.CO_CD = #{coCd}
                        </if>
		                <if test="salesCd != null and !salesCd.equals('')">
		                AND    P.SALES_CD LIKE '%'||#{salesCd}||'%'
		                </if>
		                <if test="rsltCloseYn != null and !rsltCloseYn.equals('')">
		                AND    NVL(S.CLOSE_YN, 'N') LIKE #{rsltCloseYn}
		                </if>
                        --AND    NVL(R.WBS_RSLTS_RATE,0) <![CDATA[<>]]> 100
                  UNION All    --일정계획 확정건에 대한 계획수립 안한 내역
                        SELECT SJ.CLNT_NM                             AS CLNT_NM
                             , SJ.CLNT_PJT_NM                         AS CLNT_PJT_NM
                             , P.SALES_CD                             AS SALES_CD
                             , SJ.CTRT_NM                             AS CTRT_NM
                             , '일정계획수립'                          AS WBS_PLAN_NM --WBS 계획명
                             , TO_CHAR(R.WBS_PLANS_DT, 'YYYY-MM-DD')  AS PLAN_STRT_DT --WBS Task 시작일
                             , TO_CHAR(R.WBS_PLANE_DT, 'YYYY-MM-DD')  AS PLAN_END_DT  --WBS Task 종료일
                             , R.DAYCNT                               AS PLAN_DAYCNT
                             , (SELECT FN_CM05M01_CD_TO_NM(P.WBS_PLAN_CODE_ID) FROM DUAL) || ' 계획등록' AS WBS_TASK_NM  --WBS Task NM
                             , TO_CHAR(P.WBS_PLANS_DT, 'YYYY-MM-DD')  AS TASK_STRT_DT --WBS Task 시작일
                             , TO_CHAR(P.WBS_PLANE_DT, 'YYYY-MM-DD')  AS TASK_END_DT  --WBS Task 종료일
                             , P.DAYCNT                               AS TASK_DAYCNT
                             , P.EXPECT_MH                            AS TASK_EXPECT_MH
                             , ''                                     AS RSLT_STRT_DT --WBS Task 시작일
                             , ''                                     AS RSLT_END_DT  --WBS Task 종료일
                             , '0'                                    AS RSLT_DAYCNT
                             , 0                                      AS RSLT_INTOCNT
                             , 0                                      AS RSLT_RATE    --WBS 실적 진행율
                             , (SELECT FN_CM06M01_ID_TO_NM(P.WBS_PLAN_MNG_ID) FROM DUAL)  AS WBS_MNG_NM --담당자명
                             -- 관련코드 참고정보 -----------------------------------------------
                             , SJ.CLNT_CD                      AS CLNT_CD 
                             , P.WBS_PLAN_CODE_KIND            AS WBS_PLAN_CD --WBS 계획CD
                             , P.WBS_PLAN_CODE_ID              AS WBS_TASK_ID --WBS Task ID 
                             , P.WBS_PLAN_MNG_ID               AS WBS_MNG_ID  --담당자ID
                             , ROUND(P.WBS_PLANE_DT - SYSDATE) AS VARIANCE_DT --종료예정 차이 일수 
                             , P.CO_CD
                             , SJ.PLAN_VER_NO                  AS PLAN_VER_NO --계획ver
                             , 'N'                             AS RSLT_CLOSE_YN
                             , CONCAT(CONCAT(SJ.CLNT_NM, ' - '), SJ.CLNT_PJT_NM) AS CLNT_NM_PJT_NM
                             , '.'                             AS RSLT_FILE_TRGT_KEY
                             , ''                              AS DATA_STS
                             , ''                              AS DATA_CHK
                             , P.WBS_PLAN_NO                   AS WBS_PLAN_NO
                             , 'Y'                             AS NONE_PLAN_YN
                        FROM   TB_WB22M01 AS P
                               LEFT OUTER JOIN TB_WB22M01 AS R  ON R.CO_CD    = P.CO_CD
                                                               AND R.SALES_CD = P.SALES_CD
                                                               AND R.WBS_PLAN_CODE_KIND = P.WBS_PLAN_CODE_ID
                               LEFT OUTER JOIN SJD AS SJ  ON P.SALES_CD = SJ.SALES_CD
                        WHERE  1 = 1
                        AND    P.WBS_PLAN_MNG_ID = #{usrId}
                        AND    P.WBS_PLAN_CODE_KIND = 'WBSCODE'
                        AND    P.WBS_PLANS_DT IS NOT NULL
                        AND    P.WBS_PLAN_MNG_ID IS NOT NULL
                        AND    R.FILE_TRGT_KEY IS NULL
                        AND    P.CLOSE_YN = 'Y'
                        AND    SJ.SALES_CD IS NOT NULL
				 UNION All   --과제별  매뉴얼 작성 대상인경우 기계매뉴얼 체크  						     	 
                        SELECT SJ.CLNT_NM                             AS CLNT_NM
                             , SJ.CLNT_PJT_NM                         AS CLNT_PJT_NM
                             , P.SALES_CD                             AS SALES_CD
                             , SJ.CTRT_NM                             AS CTRT_NM
                             , '매뉴얼등록' 							  AS WBS_PLAN_NM --WBS 계획명
						     , TO_CHAR(R.WBS_PLANS_DT, 'YYYY-MM-DD')  AS PLAN_STRT_DT --WBS Task 시작일
						     , TO_CHAR(R.WBS_PLANE_DT, 'YYYY-MM-DD')  AS PLAN_END_DT  --WBS Task 종료일
                             , '0'                                    AS PLAN_DAYCNT
                             , '기계매뉴얼등록'                     	  AS WBS_TASK_NM --WBS Task NM
                             , ''  									  AS TASK_STRT_DT --WBS Task 시작일
                             , CASE WHEN WD.MANUAL_MC IS NOT NULL 
                                    THEN TO_CHAR(WD.CREAT_DTTM, 'YYYY-MM-DD')
                                    ELSE ''
                                    END 							  AS TASK_END_DT  --WBS Task 종료일
                             , ''                               	  AS TASK_DAYCNT
                             , 0                          		  	  AS TASK_EXPECT_MH
                             , '' 									  AS RSLT_STRT_DT --WBS Task 시작일
                             , CASE WHEN WD.MANUAL_MC IS NOT NULL 
                                    THEN TO_CHAR(WD.CREAT_DTTM, 'YYYY-MM-DD')
                                    ELSE ''
                                    END 							  AS RSLT_END_DT  --WBS Task 종료일
                             , ''                        			  AS RSLT_DAYCNT
                             , 0			                          AS RSLT_INTOCNT
                             , 0					                  AS RSLT_RATE    --WBS 실적 진행율
                             , (SELECT FN_CM06M01_ID_TO_NM(R.WBS_PLAN_MNG_ID) FROM DUAL)  AS WBS_MNG_NM --담당자명
                             -- 관련코드 참고정보 -----------------------------------------------
                             , SJ.CLNT_CD                      		AS CLNT_CD 
						     , 'MANUAL'                       		AS WBS_PLAN_CD --WBS 계획CD
						     , 'MANUALMC'   				   		AS WBS_TASK_ID --WBS Task ID 
                             , R.WBS_PLAN_MNG_ID               		AS WBS_MNG_ID  --담당자ID
                             , ROUND(R.WBS_PLANE_DT - SYSDATE) 		AS VARIANCE_DT --종료예정 차이 일수 
                             , P.CO_CD
                             , SJ.PLAN_VER_NO                  		AS PLAN_VER_NO --계획ver
                             , 'N'            				   		AS RSLT_CLOSE_YN
                             , CONCAT(CONCAT(SJ.CLNT_NM, ' - '), SJ.CLNT_PJT_NM) AS CLNT_NM_PJT_NM
                             , P.FILE_TRGT_KEY       	   	   		AS RSLT_FILE_TRGT_KEY
                             , CASE WHEN NVL(WD.SALES_CD, '.') = '.' THEN 'I' ELSE 'U' END AS DATA_STS
                             , ''                              		AS DATA_CHK
                             , 'MANUALMC'                   		AS WBS_PLAN_NO
                             , 'Y'                             		AS NONE_PLAN_YN
						FROM TB_WB21M01 P
								LEFT OUTER JOIN TB_WB21D02 AS WD ON WD.SALES_CD = P.SALES_CD
								LEFT OUTER JOIN SJD        AS SJ ON SJ.SALES_CD = P.SALES_CD
								INNER JOIN TB_WB22M01 AS R  ON R.CO_CD     = P.CO_CD
								                                AND R.SALES_CD  =  P.SALES_CD
								                                AND R.WBS_PLAN_CODE_ID = 'WBSCODE03'
								                                AND R.WBS_PLAN_MNG_ID = #{usrId}
						WHERE P.MANUAL_YN = 'Y'
						  AND P.CLOSE_YN = 'Y'
						  AND R.WBS_PLANE_DT   <![CDATA[ <]]>  ( SYSDATE + 7) --종료일 7일 이전 내역
						  AND P.VER_NO  = (SELECT MAX(TO_NUMBER(VER_NO)) FROM TB_WB21M01 P1 WHERE P1.SJ_NO = P.SJ_NO)
						  AND WD.MANUAL_MC IS NULL   --WD.MANUAL_ELEC
						  
				 UNION All   --과제별  매뉴얼 작성 대상인경우 전기매뉴얼 체크   					     	 
                        SELECT SJ.CLNT_NM                            AS CLNT_NM
                             , SJ.CLNT_PJT_NM                        AS CLNT_PJT_NM
                             , P.SALES_CD                            AS SALES_CD
                             , SJ.CTRT_NM                            AS CTRT_NM
                             , '매뉴얼등록' 							 AS WBS_PLAN_NM --WBS 계획명
						     , TO_CHAR(R.WBS_PLANS_DT, 'YYYY-MM-DD') AS PLAN_STRT_DT --WBS Task 시작일
						     , TO_CHAR(R.WBS_PLANE_DT, 'YYYY-MM-DD') AS PLAN_END_DT  --WBS Task 종료일
                             , '0'                                   AS PLAN_DAYCNT
                             , '전기매뉴얼등록'                     	  AS WBS_TASK_NM --WBS Task NM
                             , ''  									  AS TASK_STRT_DT --WBS Task 시작일
                             , CASE WHEN WD.MANUAL_MC IS NOT NULL 
                                    THEN TO_CHAR(WD.CREAT_DTTM, 'YYYY-MM-DD')
                                    ELSE ''
                                    END 							  AS TASK_END_DT  --WBS Task 종료일
                             , ''                               	  AS TASK_DAYCNT
                             , 0                          		  	  AS TASK_EXPECT_MH
                             , '' 									  AS RSLT_STRT_DT --WBS Task 시작일
                             , CASE WHEN WD.MANUAL_MC IS NOT NULL 
                                    THEN TO_CHAR(WD.CREAT_DTTM, 'YYYY-MM-DD')
                                    ELSE ''
                                    END 							  AS RSLT_END_DT  --WBS Task 종료일
                             , ''                        			  AS RSLT_DAYCNT
                             , 0			                          AS RSLT_INTOCNT
                             , 0					                  AS RSLT_RATE    --WBS 실적 진행율
                             , (SELECT FN_CM06M01_ID_TO_NM(R.WBS_PLAN_MNG_ID) FROM DUAL)  AS WBS_MNG_NM --담당자명
                             -- 관련코드 참고정보 -----------------------------------------------
                             , SJ.CLNT_CD                      		AS CLNT_CD 
						     , 'MANUAL'                       		AS WBS_PLAN_CD --WBS 계획CD
						     , 'MANUALELEC'   				   		AS WBS_TASK_ID --WBS Task ID 
                             , R.WBS_PLAN_MNG_ID               		AS WBS_MNG_ID  --담당자ID
                             , ROUND(R.WBS_PLANE_DT - SYSDATE) 		AS VARIANCE_DT --종료예정 차이 일수 
                             , P.CO_CD
                             , SJ.PLAN_VER_NO                  		AS PLAN_VER_NO --계획ver
                             , 'N'            				   		AS RSLT_CLOSE_YN
                             , CONCAT(CONCAT(SJ.CLNT_NM, ' - '), SJ.CLNT_PJT_NM) AS CLNT_NM_PJT_NM
                             , P.FILE_TRGT_KEY       	   	   		AS RSLT_FILE_TRGT_KEY
                             , CASE WHEN NVL(WD.SALES_CD, '.') = '.' THEN 'I' ELSE 'U' END AS DATA_STS
                             , ''                              		AS DATA_CHK
                             , 'MANUALELEC'                    		AS WBS_PLAN_NO
                             , 'Y'                             		AS NONE_PLAN_YN
						FROM TB_WB21M01 P
								LEFT OUTER JOIN TB_WB21D02 AS WD ON WD.SALES_CD = P.SALES_CD
								LEFT OUTER JOIN SJD        AS SJ ON SJ.SALES_CD = P.SALES_CD
								INNER JOIN TB_WB22M01 AS R  ON R.CO_CD     = P.CO_CD
								                                AND R.SALES_CD  =  P.SALES_CD
								                                AND R.WBS_PLAN_CODE_ID = 'WBSCODE06'
								                                AND R.WBS_PLAN_MNG_ID = #{usrId}
						WHERE P.MANUAL_YN = 'Y'
						  AND P.CLOSE_YN = 'Y' 
						  AND R.WBS_PLANE_DT   <![CDATA[ <]]>  ( SYSDATE + 7) --종료일 7일 이전 내역
						  AND P.VER_NO  = (SELECT MAX(TO_NUMBER(VER_NO)) FROM TB_WB21M01 P1 WHERE P1.SJ_NO = P.SJ_NO)
						  AND WD.MANUAL_ELEC IS NULL
                       ) AS X
                WHERE  1 = 1
                <if test="salesCd != null and !salesCd.equals('')">
                AND    X.SALES_CD LIKE '%'||#{salesCd}||'%'
                </if>
                <if test="rsltCloseYn != null and !rsltCloseYn.equals('')">
                AND    X.RSLT_CLOSE_YN LIKE #{rsltCloseYn}
                </if>
                ORDER BY SALES_CD, WBS_PLAN_CD, WBS_TASK_ID
               ) AS Z
        WHERE  1 = 1
        AND    RN BETWEEN #{firstIndex} AND #{lastIndex}
    </select>

	<update id="update_wb26_confirmYn" parameterType="Map">
		UPDATE TB_WB23M01
		SET    CLOSE_YN = #{rsltCloseYn, jdbcType=VARCHAR}
			 , UDT_ID   = #{userId}
			 , UDT_PGM  = #{pgmId}
			 , UDT_DTTM = SYSDATE
		WHERE  FILE_TRGT_KEY = #{rsltFileTrgtKey}
	</update>
	
	<update id="update_wb26" parameterType="Map">
		UPDATE TB_WB23M01
		SET    WBS_RSLTS_RATE = #{rsltRate}
		     , WBS_RSLTS_MH   = #{rsltIntocnt}
			 , WBS_RSLTSS_DT  = #{rsltStrtDt}
			 , WBS_RSLTSE_DT  = #{rsltEndDt}
			 , DAYCNT         = #{rsltDaycnt}
			 , UDT_ID         = #{userId}
			 , UDT_PGM        = #{pgmId}
			 , UDT_DTTM       = SYSDATE
		WHERE FILE_TRGT_KEY =  #{rsltFileTrgtKey}
    </update>

	<insert id="insert_wb26" parameterType="Map">
		<selectKey keyProperty="rsltsFileTrgtKey" resultType="String" order="BEFORE">
			SELECT TB_WB23M01_SQ01.NEXTVAL FROM DUAL
		</selectKey>
		INSERT INTO TB_WB23M01
		( FILE_TRGT_KEY
		, CO_CD
		, WBS_RSLTS_NO
		, WBS_PLAN_CODE_KIND
		, WBS_PLAN_CODE_ID
		, SALES_CD
		, WBS_RSLTS_ID
		, WBS_RSLTS_RATE
		, WBS_RSLTS_MH
		, WBS_RSLTS_CNTS
		, WBS_RSLTSS_DT
		, WBS_RSLTSE_DT
		, DAYCNT
		, LOCK_YN
		, CLOSE_YN
		, CREAT_ID
		, CREAT_PGM
		, CREAT_DTTM
		)
		VALUES
		( #{rsltsFileTrgtKey}
		, #{coCd}
		, #{wbsPlanNo}
		, #{wbsPlanCd}
		, #{wbsTaskId}
		, #{salesCd}
		, #{wbsMngId}
		, #{rsltRate}
		, #{rsltIntocnt}
		, ''
		, #{rsltStrtDt}
		, #{rsltEndDt, jdbcType=VARCHAR}
		, #{rsltDaycnt}
		, 'N'
		, 'N'
		, #{userId}
		, #{pgmId}
		, SYSDATE
		)
    </insert>
	
    
    <select id="select_wb2602_List_Count" parameterType="Map" resultType="int">
        SELECT COUNT(*)
        FROM   (
                SELECT 
							 CO_CD, PRDT_GRP, ORDRS_NO, SALES_CD
	   					   , (SELECT FN_CM05M01_CD_TO_NM(W.PRDT_GRP) FROM DUAL) AS 제품유형
						   , (SELECT FN_CM05M01_CD_TO_NM(W.ORDRS_DIV) FROM DUAL) AS 수주구분
						   , (SELECT FN_CM05M01_CD_TO_NM(W.ITEM_DIV) FROM DUAL) AS 아이템구분
					  FROM (
										  SELECT   W2.CO_CD, B1.PRDT_GRP, C2.ORDRS_NO, W2.SALES_CD, W2.WBS_PLAN_CODE_KIND
										         , count(W2.WBS_PLAN_CODE_ID) AS RESULT_CNT
										         , SUM(W2.WBS_RSLTS_RATE)	AS RESULT_PCT
										         , SUM(W2.WBS_RSLTS_MH) 	AS RESULT_MH
					                             , MIN(W2.WBS_RSLTSS_DT)	AS RSLTSS_DT     --TASK실적시작일
					                             , MAX(W2.WBS_RSLTSE_DT)	AS RSLTSE_DT     --TASK실적종료일 
					                             , SUM(W2.DAYCNT)			AS RSLT_DAYCNT   --TASK실적소요일
					                             , TRUNC(MAX(W2.WBS_RSLTSE_DT) - MIN(W2.WBS_RSLTSS_DT)) AS TERM_DAY
					                             , max(C2.ITEM_DIV)			AS ITEM_DIV		 --ITEM 구분
					                             , max(M2.ORDRS_DIV)		AS ORDRS_DIV	 --수주구분
									         FROM TB_WB23M01 W2
										  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
										  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
										  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
									         WHERE 1 = 1
									           AND W2.CO_CD = #{coCd}
												<if test="salesCd == null or salesCd == ''">
									           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
												</if>
												<!-- SalesCode -->
												<if test="salesCd != null and salesCd != ''">
												AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
												</if>
												<!-- 기계종류 -->
										        <if test="prdtGrp != null and prdtGrp != ''">
										        AND B1.PRDT_GRP IN ( ${prdtGrp} )
												</if>
												<!-- 수주구분 -->
										        <if test="ordrsDiv != null and ordrsDiv != ''">
										        AND M2.ORDRS_DIV = #{ordrsDiv}
												</if>
												<!-- 아이템구분 -->
										        <if test="itemDiv != null and itemDiv != ''">
										        AND C2.ITEM_DIV = #{itemDiv}
												</if>
												<!-- 기계구분 -->
										        <if test="mctype != null and mctype != ''">
										        AND C2.MCTYPE = #{mctype}
												</if>
									           AND W2.WBS_RSLTSE_DT IS NOT NULL
									        GROUP BY W2.CO_CD, B1.PRDT_GRP, C2.ORDRS_NO, W2.SALES_CD, W2.WBS_PLAN_CODE_KIND
							) AS W
					 GROUP BY CO_CD, PRDT_GRP, ORDRS_NO, SALES_CD, ORDRS_DIV, ITEM_DIV
               ) AS Z
    </select>
    
    
    <select id="select_wb2602_List" parameterType="Map" resultType="camelMap">
        SELECT    Z.*
        FROM   (
                SELECT X.*
                     , ROWNUM AS RN
                FROM   (
					SELECT 
							 CO_CD, PRDT_GRP, ORDRS_NO, SALES_CD
						   , (SELECT FN_CM05M01_CD_TO_NM(W.PRDT_GRP) FROM DUAL) 	AS 기계종류
						   , (SELECT FN_CM05M01_CD_TO_NM(W.ORDRS_DIV) FROM DUAL) 	AS 수주구분
						   , (SELECT FN_CM05M01_CD_TO_NM(W.ITEM_DIV) FROM DUAL) 	AS 아이템구분
						   , (SELECT FN_CM05M01_CD_TO_NM(W.MCTYPE) FROM DUAL)   	AS 기계구분
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE01'  THEN TERM_DAY END) AS MIN_TERM_DAY01     --C.CODE_NM = '수주확정' 		   
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE02'  THEN TERM_DAY END) AS MIN_TERM_DAY02     --C.CODE_NM = '목표원가/PFU배포'
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE03'  THEN TERM_DAY END) AS MIN_TERM_DAY03     --C.CODE_NM = '설계완료'		    
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE17'  THEN TERM_DAY END) AS MIN_TERM_DAY17     --C.CODE_NM = '모델링완료'		   
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE04'  THEN TERM_DAY END) AS MIN_TERM_DAY04     --C.CODE_NM = '구매완료'		    
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE18'  THEN TERM_DAY END) AS MIN_TERM_DAY18     --C.CODE_NM = '제품(샘플)공급완료'
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE05'  THEN TERM_DAY END) AS MIN_TERM_DAY05     --C.CODE_NM = '기계조립완료'		  
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE06'  THEN TERM_DAY END) AS MIN_TERM_DAY06     --C.CODE_NM = '전기완료'		    
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE07'  THEN TERM_DAY END) AS MIN_TERM_DAY07     --C.CODE_NM = '자체시운전완료'	  
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE16'  THEN TERM_DAY END) AS MIN_TERM_DAY16     --C.CODE_NM = '외부제작검수'		  
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE09'  THEN TERM_DAY END) AS MIN_TERM_DAY09     --C.CODE_NM = '고객검수'		    
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE10'  THEN TERM_DAY END) AS MIN_TERM_DAY10     --C.CODE_NM = '포장'			     
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE11'  THEN TERM_DAY END) AS MIN_TERM_DAY11     --C.CODE_NM = '출고'			     
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE12'  THEN TERM_DAY END) AS MIN_TERM_DAY12     --C.CODE_NM = '도착'			     
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE13'  THEN TERM_DAY END) AS MIN_TERM_DAY13     --C.CODE_NM = '설치시운전(출발일)'
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE14'  THEN TERM_DAY END) AS MIN_TERM_DAY14     --C.CODE_NM = '설치시운전(복귀일)'
						   
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE01'  THEN TERM_DAY END) AS MAX_TERM_DAY01     --C.CODE_NM = '수주확정' 		   
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE02'  THEN TERM_DAY END) AS MAX_TERM_DAY02     --C.CODE_NM = '목표원가/PFU배포'
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE03'  THEN TERM_DAY END) AS MAX_TERM_DAY03     --C.CODE_NM = '설계완료'		    
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE17'  THEN TERM_DAY END) AS MAX_TERM_DAY17     --C.CODE_NM = '모델링완료'		   
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE04'  THEN TERM_DAY END) AS MAX_TERM_DAY04     --C.CODE_NM = '구매완료'		    
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE18'  THEN TERM_DAY END) AS MAX_TERM_DAY18     --C.CODE_NM = '제품(샘플)공급완료'
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE05'  THEN TERM_DAY END) AS MAX_TERM_DAY05     --C.CODE_NM = '기계조립완료'		  
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE06'  THEN TERM_DAY END) AS MAX_TERM_DAY06     --C.CODE_NM = '전기완료'		    
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE07'  THEN TERM_DAY END) AS MAX_TERM_DAY07     --C.CODE_NM = '자체시운전완료'	  
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE16'  THEN TERM_DAY END) AS MAX_TERM_DAY16     --C.CODE_NM = '외부제작검수'		  
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE09'  THEN TERM_DAY END) AS MAX_TERM_DAY09     --C.CODE_NM = '고객검수'		    
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE10'  THEN TERM_DAY END) AS MAX_TERM_DAY10     --C.CODE_NM = '포장'			     
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE11'  THEN TERM_DAY END) AS MAX_TERM_DAY11     --C.CODE_NM = '출고'			     
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE12'  THEN TERM_DAY END) AS MAX_TERM_DAY12     --C.CODE_NM = '도착'			     
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE13'  THEN TERM_DAY END) AS MAX_TERM_DAY13     --C.CODE_NM = '설치시운전(출발일)'
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE14'  THEN TERM_DAY END) AS MAX_TERM_DAY14     --C.CODE_NM = '설치시운전(복귀일)'
						   
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE01'  THEN RESULT_MH END) AS MIN_RESULT_MH01     --C.CODE_NM = '수주확정' 		   
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE02'  THEN RESULT_MH END) AS MIN_RESULT_MH02     --C.CODE_NM = '목표원가/PFU배포'
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE03'  THEN RESULT_MH END) AS MIN_RESULT_MH03     --C.CODE_NM = '설계완료'		    
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE17'  THEN RESULT_MH END) AS MIN_RESULT_MH17     --C.CODE_NM = '모델링완료'		   
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE04'  THEN RESULT_MH END) AS MIN_RESULT_MH04     --C.CODE_NM = '구매완료'		    
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE18'  THEN RESULT_MH END) AS MIN_RESULT_MH18     --C.CODE_NM = '제품(샘플)공급완료'
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE05'  THEN RESULT_MH END) AS MIN_RESULT_MH05     --C.CODE_NM = '기계조립완료'		  
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE06'  THEN RESULT_MH END) AS MIN_RESULT_MH06     --C.CODE_NM = '전기완료'		    
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE07'  THEN RESULT_MH END) AS MIN_RESULT_MH07     --C.CODE_NM = '자체시운전완료'	  
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE16'  THEN RESULT_MH END) AS MIN_RESULT_MH16     --C.CODE_NM = '외부제작검수'		  
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE09'  THEN RESULT_MH END) AS MIN_RESULT_MH09     --C.CODE_NM = '고객검수'		    
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE10'  THEN RESULT_MH END) AS MIN_RESULT_MH10     --C.CODE_NM = '포장'			     
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE11'  THEN RESULT_MH END) AS MIN_RESULT_MH11     --C.CODE_NM = '출고'			     
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE12'  THEN RESULT_MH END) AS MIN_RESULT_MH12     --C.CODE_NM = '도착'			     
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE13'  THEN RESULT_MH END) AS MIN_RESULT_MH13     --C.CODE_NM = '설치시운전(출발일)'
						   , MIN(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE14'  THEN RESULT_MH END) AS MIN_RESULT_MH14     --C.CODE_NM = '설치시운전(복귀일)'
						   
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE01'  THEN RESULT_MH END) AS MAX_RESULT_MH01     --C.CODE_NM = '수주확정' 		   
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE02'  THEN RESULT_MH END) AS MAX_RESULT_MH02     --C.CODE_NM = '목표원가/PFU배포'
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE03'  THEN RESULT_MH END) AS MAX_RESULT_MH03     --C.CODE_NM = '설계완료'		    
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE17'  THEN RESULT_MH END) AS MAX_RESULT_MH17     --C.CODE_NM = '모델링완료'		   
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE04'  THEN RESULT_MH END) AS MAX_RESULT_MH04     --C.CODE_NM = '구매완료'		    
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE18'  THEN RESULT_MH END) AS MAX_RESULT_MH18     --C.CODE_NM = '제품(샘플)공급완료'
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE05'  THEN RESULT_MH END) AS MAX_RESULT_MH05     --C.CODE_NM = '기계조립완료'		  
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE06'  THEN RESULT_MH END) AS MAX_RESULT_MH06     --C.CODE_NM = '전기완료'		    
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE07'  THEN RESULT_MH END) AS MAX_RESULT_MH07     --C.CODE_NM = '자체시운전완료'	  
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE16'  THEN RESULT_MH END) AS MAX_RESULT_MH16     --C.CODE_NM = '외부제작검수'		  
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE09'  THEN RESULT_MH END) AS MAX_RESULT_MH09     --C.CODE_NM = '고객검수'		    
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE10'  THEN RESULT_MH END) AS MAX_RESULT_MH10     --C.CODE_NM = '포장'			     
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE11'  THEN RESULT_MH END) AS MAX_RESULT_MH11     --C.CODE_NM = '출고'			     
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE12'  THEN RESULT_MH END) AS MAX_RESULT_MH12     --C.CODE_NM = '도착'			     
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE13'  THEN RESULT_MH END) AS MAX_RESULT_MH13     --C.CODE_NM = '설치시운전(출발일)'
						   , MAX(CASE WHEN W.WBS_PLAN_CODE_KIND = 'WBSCODE14'  THEN RESULT_MH END) AS MAX_RESULT_MH14     --C.CODE_NM = '설치시운전(복귀일)'
					  FROM (
										  SELECT   W2.CO_CD, B1.PRDT_GRP, C2.ORDRS_NO, W2.SALES_CD, W2.WBS_PLAN_CODE_KIND
										         , count(W2.WBS_PLAN_CODE_ID) AS RESULT_CNT
										         , SUM(W2.WBS_RSLTS_RATE)	AS RESULT_PCT
										         , SUM(decode(W2.WBS_RSLTS_MH, 0, '', W2.WBS_RSLTS_MH)) 	AS RESULT_MH
					                             , MIN(W2.WBS_RSLTSS_DT)	AS RSLTSS_DT     --TASK실적시작일
					                             , MAX(W2.WBS_RSLTSE_DT)	AS RSLTSE_DT     --TASK실적종료일 
					                             , SUM(decode(W2.DAYCNT, 0, '', W2.DAYCNT))			AS RSLT_DAYCNT   --TASK실적소요일
					                             , TRUNC(MAX(W2.WBS_RSLTSE_DT) - MIN(W2.WBS_RSLTSS_DT)+1) AS TERM_DAY
					                             , max(C2.ITEM_DIV)			AS ITEM_DIV		 --ITEM 구분
					                             , max(M2.ORDRS_DIV)		AS ORDRS_DIV	 --수주구분
                             					 , max(C2.MCTYPE)			AS MCTYPE	 	 --기계구분
									         FROM TB_WB23M01 W2
										  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
										  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
										  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
									         WHERE 1 = 1
									           AND W2.CO_CD = #{coCd}
												<if test="salesCd == null or salesCd == ''">
									           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
												</if>
									           AND W2.WBS_RSLTSE_DT IS NOT NULL
												<!-- SalesCode -->
												<if test="salesCd != null and salesCd != ''">
												AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
												</if>
												<!-- 기계종류 -->
										        <if test="prdtGrp != null and prdtGrp != ''">
										        AND B1.PRDT_GRP IN ( ${prdtGrp} )
												</if>
												<!-- 수주구분 -->
										        <if test="ordrsDiv != null and ordrsDiv != ''">
										        AND M2.ORDRS_DIV = #{ordrsDiv}
												</if>
												<!-- 아이템구분 -->
										        <if test="itemDiv != null and itemDiv != ''">
										        AND C2.ITEM_DIV = #{itemDiv}
												</if>
												<!-- 기계구분 -->
										        <if test="mctype != null and mctype != ''">
										        AND C2.MCTYPE = #{mctype}
												</if>
									        GROUP BY W2.CO_CD, B1.PRDT_GRP, C2.ORDRS_NO, W2.SALES_CD, W2.WBS_PLAN_CODE_KIND
							) AS W
					 GROUP BY CO_CD, PRDT_GRP, ORDRS_NO, SALES_CD, ORDRS_DIV, ITEM_DIV, MCTYPE
					 ORDER BY CO_CD, PRDT_GRP, ORDRS_DIV, ITEM_DIV, ORDRS_NO DESC, SALES_CD
                 ) AS X
           ) AS Z
        WHERE  1 = 1
        AND    RN BETWEEN #{firstIndex} AND #{lastIndex}
    </select>
    
    
    
    
    
    <select id="select_wb2603_List_Count" parameterType="Map" resultType="int">
        SELECT COUNT(*)
        FROM   (
                	WITH RST AS (
							SELECT 
									  W2.SALES_CD
									, W2.CO_CD
									, W2.WBS_PLAN_CODE_ID
									, W2.WBS_PLANS_DT
									, W2.WBS_PLANE_DT
									, W2.EXPECT_MH
									, TRUNC(W2.WBS_PLANE_DT - W2.WBS_PLANS_DT + 1) AS CAL_DAY
									, 'PM계획' AS PLAN_TYPE
		                            , C2.ITEM_DIV				AS ITEM_DIV		 --ITEM 구분
                          			, C2.MCTYPE					AS MCTYPE	 	 --기계구분
		                            , M2.ORDRS_DIV				AS ORDRS_DIV	 --수주구분
                          			, B1.PRDT_GRP				AS PRDT_GRP
							  FROM TB_WB22M01 W2
							  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
							  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
							  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
							 
							 WHERE 1 = 1
					           AND W2.CO_CD = #{coCd}
								<if test="salesCd == null or salesCd == ''">
					           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
								</if>
							   AND W2.WBS_PLAN_CODE_KIND = 'WBSCODE'
								<!-- SalesCode -->
								<if test="salesCd != null and !salesCd.equals('')">
								AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
								</if>
								<!-- 기계종류 -->
						        <if test="prdtGrp != null and !prdtGrp.equals('')">
						        AND B1.PRDT_GRP IN ( ${prdtGrp} )
								</if>
								<!-- 수주구분 -->
						        <if test="ordrsDiv != null and !ordrsDiv.equals('')">
						        AND M2.ORDRS_DIV = #{ordrsDiv}
								</if>
								<!-- 아이템구분 -->
						        <if test="itemDiv != null and !itemDiv.equals('')">
						        AND C2.ITEM_DIV = #{itemDiv}
								</if>
								<!-- 기계구분 -->
						        <if test="mctype != null and !mctype.equals('')">
						        AND C2.MCTYPE = #{mctype}
								</if>
							   AND W2.WBS_PLANS_DT IS NOT NULL
						UNION ALL   
							SELECT W2.SALES_CD
									, W2.CO_CD
									, W2.WBS_PLAN_CODE_KIND 	AS WBS_PLAN_CODE_ID
									, MIN(W2.WBS_PLANS_DT)		AS WBS_PLANS_DT
									, MAX(W2.WBS_PLANE_DT)		AS WBS_PLANE_DT
									, SUM(W2.EXPECT_MH)			AS EXPECT_MH		--계획공수
									, TRUNC(MAX(W2.WBS_PLANE_DT) - MIN(W2.WBS_PLANS_DT) + 1) AS CAL_DAY
									, '담당계획' AS PLAN_TYPE
		                            , MAX(C2.ITEM_DIV)				AS ITEM_DIV		 --ITEM 구분
                          			, MAX(C2.MCTYPE)				AS MCTYPE	 	 --기계구분
		                            , MAX(M2.ORDRS_DIV)				AS ORDRS_DIV	 --수주구분
                          			, MAX(B1.PRDT_GRP)				AS PRDT_GRP
							  FROM TB_WB22M01 W2
							  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
							  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
							  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
							 WHERE 1 = 1
					           AND W2.CO_CD = #{coCd}
								<if test="salesCd == null or salesCd == ''">
					           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
								</if>
							   AND W2.WBS_PLAN_CODE_KIND != 'WBSCODE'
								<!-- SalesCode -->
								<if test="salesCd != null and !salesCd.equals('')">
								AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
								</if>
								<!-- 기계종류 -->
						        <if test="prdtGrp != null and !prdtGrp.equals('')">
						        AND B1.PRDT_GRP IN ( ${prdtGrp} )
								</if>
								<!-- 수주구분 -->
						        <if test="ordrsDiv != null and !ordrsDiv.equals('')">
						        AND M2.ORDRS_DIV = #{ordrsDiv}
								</if>
								<!-- 아이템구분 -->
						        <if test="itemDiv != null and !itemDiv.equals('')">
						        AND C2.ITEM_DIV = #{itemDiv}
								</if>
								<!-- 기계구분 -->
						        <if test="mctype != null and !mctype.equals('')">
						        AND C2.MCTYPE = #{mctype}
								</if>
							 GROUP BY W2.CO_CD, W2.SALES_CD, W2.WBS_PLAN_CODE_KIND
						UNION ALL 
							SELECT    W2.SALES_CD
									, W2.CO_CD
									, W2.WBS_PLAN_CODE_KIND
									, MIN(W2.WBS_RSLTSS_DT)		AS WBS_PLANS_DT
									, MAX(W2.WBS_RSLTSE_DT)		AS WBS_PLANE_DT
									, SUM(W2.WBS_RSLTS_MH)			AS EXPECT_MH		--계획공수
					--				, SUM(W2.DAYCNT)				AS DAYCNT			--소요일수
									, TRUNC(MAX(W2.WBS_RSLTSE_DT) - MIN(W2.WBS_RSLTSS_DT) + 1) AS CAL_DAY
									, '담당실적' AS PLAN_TYPE
		                            , MAX(C2.ITEM_DIV)				AS ITEM_DIV		 --ITEM 구분
                          			, MAX(C2.MCTYPE)				AS MCTYPE	 	 --기계구분
		                            , MAX(M2.ORDRS_DIV)				AS ORDRS_DIV	 --수주구분
                          			, MAX(B1.PRDT_GRP)				AS PRDT_GRP
							  FROM TB_WB23M01 W2
							  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
							  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
							  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
							 WHERE 1 = 1
					           AND W2.CO_CD = #{coCd}
								<if test="salesCd == null or salesCd == ''">
					           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
								</if>
								<!-- SalesCode -->
								<if test="salesCd != null and !salesCd.equals('')">
								AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
								</if>
								<!-- 기계종류 -->
						        <if test="prdtGrp != null and !prdtGrp.equals('')">
						        AND B1.PRDT_GRP IN ( ${prdtGrp} )
								</if>
								<!-- 수주구분 -->
						        <if test="ordrsDiv != null and !ordrsDiv.equals('')">
						        AND M2.ORDRS_DIV = #{ordrsDiv}
								</if>
								<!-- 아이템구분 -->
						        <if test="itemDiv != null and !itemDiv.equals('')">
						        AND C2.ITEM_DIV = #{itemDiv}
								</if>
								<!-- 기계구분 -->
						        <if test="mctype != null and !mctype.equals('')">
						        AND C2.MCTYPE = #{mctype}
								</if> 
							 GROUP BY W2.CO_CD, W2.SALES_CD, W2.WBS_PLAN_CODE_KIND
					) 
					SELECT T.CO_CD, T.PRDT_GRP, T.SALES_CD, T.PLAN_TYPE
					   FROM RST AS T
					  GROUP BY T.CO_CD, T.PRDT_GRP, T.SALES_CD, T.PLAN_TYPE
               ) AS Z
    </select>
    <select id="select_wb2603_List" parameterType="Map" resultType="camelMap">
        SELECT    Z.*
        FROM   (
                SELECT X.*
                     , ROWNUM AS RN
                FROM   (
                	WITH RST AS (
							SELECT 
									  W2.SALES_CD
									, W2.CO_CD
									, C2.ORDRS_NO
									, W2.WBS_PLAN_CODE_ID
									, W2.WBS_PLANS_DT
									, W2.WBS_PLANE_DT
									, W2.EXPECT_MH
									, TRUNC(W2.WBS_PLANE_DT - W2.WBS_PLANS_DT + 1) AS CAL_DAY
									, 'PM계획' AS PLAN_TYPE
		                            , C2.ITEM_DIV				AS ITEM_DIV		 --ITEM 구분
                          			, C2.MCTYPE					AS MCTYPE	 	 --기계구분
		                            , M2.ORDRS_DIV				AS ORDRS_DIV	 --수주구분
                          			, B1.PRDT_GRP				AS PRDT_GRP
							  FROM TB_WB22M01 W2
							  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
							  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
							  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
							 
							 WHERE 1 = 1
					           AND W2.CO_CD = #{coCd}
								<if test="salesCd == null or salesCd == ''">
					           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
								</if>
							   AND W2.WBS_PLAN_CODE_KIND = 'WBSCODE'
								<!-- SalesCode -->
								<if test="salesCd != null and !salesCd.equals('')">
								AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
								</if>
								<!-- 기계종류 -->
						        <if test="prdtGrp != null and !prdtGrp.equals('')">
						        AND B1.PRDT_GRP IN ( ${prdtGrp} )
								</if>
								<!-- 수주구분 -->
						        <if test="ordrsDiv != null and !ordrsDiv.equals('')">
						        AND M2.ORDRS_DIV = #{ordrsDiv}
								</if>
								<!-- 아이템구분 -->
						        <if test="itemDiv != null and !itemDiv.equals('')">
						        AND C2.ITEM_DIV = #{itemDiv}
								</if>
								<!-- 기계구분 -->
						        <if test="mctype != null and !mctype.equals('')">
						        AND C2.MCTYPE = #{mctype}
								</if>
							   AND W2.WBS_PLANS_DT IS NOT NULL
						UNION ALL   
							SELECT W2.SALES_CD
									, W2.CO_CD
									, C2.ORDRS_NO
									, W2.WBS_PLAN_CODE_KIND 	AS WBS_PLAN_CODE_ID
									, MIN(W2.WBS_PLANS_DT)		AS WBS_PLANS_DT
									, MAX(W2.WBS_PLANE_DT)		AS WBS_PLANE_DT
									, SUM(W2.EXPECT_MH)			AS EXPECT_MH		--계획공수
									, TRUNC(MAX(W2.WBS_PLANE_DT) - MIN(W2.WBS_PLANS_DT) + 1) AS CAL_DAY
									, '담당계획' AS PLAN_TYPE
		                            , MAX(C2.ITEM_DIV)				AS ITEM_DIV		 --ITEM 구분
                          			, MAX(C2.MCTYPE)				AS MCTYPE	 	 --기계구분
		                            , MAX(M2.ORDRS_DIV)				AS ORDRS_DIV	 --수주구분
                          			, MAX(B1.PRDT_GRP)				AS PRDT_GRP
							  FROM TB_WB22M01 W2
							  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
							  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
							  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
							 WHERE 1 = 1
					           AND W2.CO_CD = #{coCd}
								<if test="salesCd == null or salesCd == ''">
					           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
								</if>
							   AND W2.WBS_PLAN_CODE_KIND != 'WBSCODE'
								<!-- SalesCode -->
								<if test="salesCd != null and !salesCd.equals('')">
								AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
								</if>
								<!-- 기계종류 -->
						        <if test="prdtGrp != null and !prdtGrp.equals('')">
						        AND B1.PRDT_GRP IN ( ${prdtGrp} )
								</if>
								<!-- 수주구분 -->
						        <if test="ordrsDiv != null and !ordrsDiv.equals('')">
						        AND M2.ORDRS_DIV = #{ordrsDiv}
								</if>
								<!-- 아이템구분 -->
						        <if test="itemDiv != null and !itemDiv.equals('')">
						        AND C2.ITEM_DIV = #{itemDiv}
								</if>
								<!-- 기계구분 -->
						        <if test="mctype != null and !mctype.equals('')">
						        AND C2.MCTYPE = #{mctype}
								</if>
							 GROUP BY W2.CO_CD, C2.ORDRS_NO, W2.SALES_CD, W2.WBS_PLAN_CODE_KIND
						UNION ALL 
							SELECT    W2.SALES_CD
									, W2.CO_CD
									, C2.ORDRS_NO
									, W2.WBS_PLAN_CODE_KIND
									, MIN(W2.WBS_RSLTSS_DT)		AS WBS_PLANS_DT
									, MAX(W2.WBS_RSLTSE_DT)		AS WBS_PLANE_DT
									, SUM(W2.WBS_RSLTS_MH)			AS EXPECT_MH		--계획공수
					--				, SUM(W2.DAYCNT)				AS DAYCNT			--소요일수
									, TRUNC(MAX(W2.WBS_RSLTSE_DT) - MIN(W2.WBS_RSLTSS_DT) + 1) AS CAL_DAY
									, '담당실적' AS PLAN_TYPE
		                            , MAX(C2.ITEM_DIV)				AS ITEM_DIV		 --ITEM 구분
                          			, MAX(C2.MCTYPE)				AS MCTYPE	 	 --기계구분
		                            , MAX(M2.ORDRS_DIV)				AS ORDRS_DIV	 --수주구분
                          			, MAX(B1.PRDT_GRP)				AS PRDT_GRP
							  FROM TB_WB23M01 W2
							  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
							  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
							  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
							 WHERE 1 = 1
					           AND W2.CO_CD = #{coCd}
								<if test="salesCd == null or salesCd == ''">
					           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
								</if>
								<!-- SalesCode -->
								<if test="salesCd != null and !salesCd.equals('')">
								AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
								</if>
								<!-- 기계종류 -->
						        <if test="prdtGrp != null and !prdtGrp.equals('')">
						        AND B1.PRDT_GRP IN ( ${prdtGrp} )
								</if>
								<!-- 수주구분 -->
						        <if test="ordrsDiv != null and !ordrsDiv.equals('')">
						        AND M2.ORDRS_DIV = #{ordrsDiv}
								</if>
								<!-- 아이템구분 -->
						        <if test="itemDiv != null and !itemDiv.equals('')">
						        AND C2.ITEM_DIV = #{itemDiv}
								</if>
								<!-- 기계구분 -->
						        <if test="mctype != null and !mctype.equals('')">
						        AND C2.MCTYPE = #{mctype}
								</if> 
							 GROUP BY W2.CO_CD, C2.ORDRS_NO, W2.SALES_CD, W2.WBS_PLAN_CODE_KIND
					) 
					SELECT T.CO_CD, T.PRDT_GRP, T.SALES_CD, T.PLAN_TYPE
						   , (SELECT FN_CM05M01_CD_TO_NM(T.PRDT_GRP) FROM DUAL) 	AS 기계종류
						   , MAX((SELECT FN_CM05M01_CD_TO_NM(T.ORDRS_DIV) FROM DUAL)) 	AS 수주구분
						   , MAX((SELECT FN_CM05M01_CD_TO_NM(T.ITEM_DIV) FROM DUAL)) 	AS 아이템구분
						   , MAX((SELECT FN_CM05M01_CD_TO_NM(T.MCTYPE) FROM DUAL))   	AS 기계구분
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE01'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN01_SDT     --C.CODE_NM = '수주확정' 		   
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE02'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN02_SDT     --C.CODE_NM = '목표원가/PFU배포'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE03'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN03_SDT     --C.CODE_NM = '설계완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE17'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN17_SDT     --C.CODE_NM = '모델링완료'		   
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE04'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN04_SDT     --C.CODE_NM = '구매완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE18'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN18_SDT     --C.CODE_NM = '제품(샘플)공급완료'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE05'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN05_SDT     --C.CODE_NM = '기계조립완료'		  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE06'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN06_SDT     --C.CODE_NM = '전기완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE07'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN07_SDT     --C.CODE_NM = '자체시운전완료'	  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE16'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN16_SDT     --C.CODE_NM = '외부제작검수'		  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE09'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN09_SDT     --C.CODE_NM = '고객검수'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE10'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN10_SDT     --C.CODE_NM = '포장'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE11'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN11_SDT     --C.CODE_NM = '출고'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE12'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN12_SDT     --C.CODE_NM = '도착'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE13'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN13_SDT     --C.CODE_NM = '설치시운전(출발일)'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE14'  THEN TO_CHAR(T.WBS_PLANS_DT,'YYYY-MM-DD') END) AS PLAN14_SDT     --C.CODE_NM = '설치시운전(복귀일)'
						   ------------------------------------------------------------------
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE01'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN01_EDT     --C.CODE_NM = '수주확정' 		   
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE02'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN02_EDT     --C.CODE_NM = '목표원가/PFU배포'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE03'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN03_EDT     --C.CODE_NM = '설계완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE17'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN17_EDT     --C.CODE_NM = '모델링완료'		   
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE04'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN04_EDT     --C.CODE_NM = '구매완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE18'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN18_EDT     --C.CODE_NM = '제품(샘플)공급완료'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE05'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN05_EDT     --C.CODE_NM = '기계조립완료'		  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE06'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN06_EDT     --C.CODE_NM = '전기완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE07'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN07_EDT     --C.CODE_NM = '자체시운전완료'	  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE16'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN16_EDT     --C.CODE_NM = '외부제작검수'		  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE09'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN09_EDT     --C.CODE_NM = '고객검수'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE10'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN10_EDT     --C.CODE_NM = '포장'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE11'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN11_EDT     --C.CODE_NM = '출고'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE12'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN12_EDT     --C.CODE_NM = '도착'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE13'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN13_EDT     --C.CODE_NM = '설치시운전(출발일)'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE14'  THEN TO_CHAR(T.WBS_PLANE_DT,'YYYY-MM-DD') END) AS PLAN14_EDT     --C.CODE_NM = '설치시운전(복귀일)'
						    ------------------------------------------------------------------
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE01'  THEN T.EXPECT_MH END) AS PLAN01_MH     --C.CODE_NM = '수주확정' 		   
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE02'  THEN T.EXPECT_MH END) AS PLAN02_MH     --C.CODE_NM = '목표원가/PFU배포'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE03'  THEN T.EXPECT_MH END) AS PLAN03_MH     --C.CODE_NM = '설계완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE17'  THEN T.EXPECT_MH END) AS PLAN17_MH     --C.CODE_NM = '모델링완료'		   
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE04'  THEN T.EXPECT_MH END) AS PLAN04_MH     --C.CODE_NM = '구매완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE18'  THEN T.EXPECT_MH END) AS PLAN18_MH     --C.CODE_NM = '제품(샘플)공급완료'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE05'  THEN T.EXPECT_MH END) AS PLAN05_MH     --C.CODE_NM = '기계조립완료'		  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE06'  THEN T.EXPECT_MH END) AS PLAN06_MH     --C.CODE_NM = '전기완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE07'  THEN T.EXPECT_MH END) AS PLAN07_MH     --C.CODE_NM = '자체시운전완료'	  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE16'  THEN T.EXPECT_MH END) AS PLAN16_MH     --C.CODE_NM = '외부제작검수'		  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE09'  THEN T.EXPECT_MH END) AS PLAN09_MH     --C.CODE_NM = '고객검수'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE10'  THEN T.EXPECT_MH END) AS PLAN10_MH     --C.CODE_NM = '포장'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE11'  THEN T.EXPECT_MH END) AS PLAN11_MH     --C.CODE_NM = '출고'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE12'  THEN T.EXPECT_MH END) AS PLAN12_MH     --C.CODE_NM = '도착'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE13'  THEN T.EXPECT_MH END) AS PLAN13_MH     --C.CODE_NM = '설치시운전(출발일)'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE14'  THEN T.EXPECT_MH END) AS PLAN14_MH     --C.CODE_NM = '설치시운전(복귀일)'
						    ------------------------------------------------------------------
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE01'  THEN T.CAL_DAY END) AS PLAN01_DAY     --C.CODE_NM = '수주확정' 		   
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE02'  THEN T.CAL_DAY END) AS PLAN02_DAY     --C.CODE_NM = '목표원가/PFU배포'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE03'  THEN T.CAL_DAY END) AS PLAN03_DAY     --C.CODE_NM = '설계완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE17'  THEN T.CAL_DAY END) AS PLAN17_DAY     --C.CODE_NM = '모델링완료'		   
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE04'  THEN T.CAL_DAY END) AS PLAN04_DAY     --C.CODE_NM = '구매완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE18'  THEN T.CAL_DAY END) AS PLAN18_DAY     --C.CODE_NM = '제품(샘플)공급완료'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE05'  THEN T.CAL_DAY END) AS PLAN05_DAY     --C.CODE_NM = '기계조립완료'		  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE06'  THEN T.CAL_DAY END) AS PLAN06_DAY     --C.CODE_NM = '전기완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE07'  THEN T.CAL_DAY END) AS PLAN07_DAY     --C.CODE_NM = '자체시운전완료'	  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE16'  THEN T.CAL_DAY END) AS PLAN16_DAY     --C.CODE_NM = '외부제작검수'		  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE09'  THEN T.CAL_DAY END) AS PLAN09_DAY     --C.CODE_NM = '고객검수'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE10'  THEN T.CAL_DAY END) AS PLAN10_DAY     --C.CODE_NM = '포장'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE11'  THEN T.CAL_DAY END) AS PLAN11_DAY     --C.CODE_NM = '출고'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE12'  THEN T.CAL_DAY END) AS PLAN12_DAY     --C.CODE_NM = '도착'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE13'  THEN T.CAL_DAY END) AS PLAN13_DAY     --C.CODE_NM = '설치시운전(출발일)'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE14'  THEN T.CAL_DAY END) AS PLAN14_DAY     --C.CODE_NM = '설치시운전(복귀일)'
						    ------------------------------------------------------------------
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE01' THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN '' 
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN01_CHA    --C.CODE_NM = '수주확정' 
						   		   
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE02'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN '' 
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN02_CHA    --C.CODE_NM = '목표원가/PFU배포'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE03'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN03_CHA    --C.CODE_NM = '설계완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE17'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN17_CHA    --C.CODE_NM = '모델링완료'		   
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE04'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN04_CHA    --C.CODE_NM = '구매완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE18'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN18_CHA    --C.CODE_NM = '제품(샘플)공급완료'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE05'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN05_CHA    --C.CODE_NM = '기계조립완료'		  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE06'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN06_CHA    --C.CODE_NM = '전기완료'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE07'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN07_CHA    --C.CODE_NM = '자체시운전완료'	  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE16'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN16_CHA    --C.CODE_NM = '외부제작검수'		  
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE09'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN09_CHA    --C.CODE_NM = '고객검수'		    
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE10'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN10_CHA    --C.CODE_NM = '포장'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE11'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN11_CHA    --C.CODE_NM = '출고'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE12'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN12_CHA    --C.CODE_NM = '도착'			     
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE13'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN13_CHA    --C.CODE_NM = '설치시운전(출발일)'
						   , MIN(CASE WHEN T.WBS_PLAN_CODE_ID = 'WBSCODE14'   THEN
						   			     CASE WHEN T.PLAN_TYPE = 'PM계획'  THEN ''
								              WHEN T.PLAN_TYPE = '담당계획' THEN 
								              		CASE WHEN '일수'  =  #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R1.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R1.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R1.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
								              WHEN T.PLAN_TYPE = '담당실적' THEN
								              		CASE WHEN '일수'  = #{qryType} THEN NVL(T.CAL_DAY, 0) - NVL(R2.CAL_DAY, 0)
								              		     WHEN '시작일' = #{qryType} THEN T.WBS_PLANS_DT - R2.WBS_PLANS_DT
								              		     WHEN '종료일' = #{qryType} THEN T.WBS_PLANE_DT - R2.WBS_PLANE_DT
								              		     ELSE NULL
								              		END
					             			  ELSE NULL  END
					             	  ELSE NULL
					             END) AS PLAN14_CHA    --C.CODE_NM = '설치시운전(복귀일)'
					   FROM RST AS T
					           LEFT OUTER JOIN RST AS R1 ON R1.SALES_CD = T.SALES_CD AND R1.WBS_PLAN_CODE_ID = T.WBS_PLAN_CODE_ID AND R1.PLAN_TYPE = 'PM계획'
					           LEFT OUTER JOIN RST AS R2 ON R2.SALES_CD = T.SALES_CD AND R2.WBS_PLAN_CODE_ID = T.WBS_PLAN_CODE_ID AND R2.PLAN_TYPE = '담당계획'
					  GROUP BY T.CO_CD, T.PRDT_GRP, T.ORDRS_NO, T.SALES_CD, T.PLAN_TYPE
					  ORDER BY T.CO_CD, T.PRDT_GRP, T.ORDRS_NO DESC, T.SALES_CD, T.PLAN_TYPE	
							 
                 ) AS X
           ) AS Z
        WHERE  1 = 1
        AND    RN BETWEEN #{firstIndex} AND #{lastIndex}
    </select>
    
    
    <select id="select_wb2604_List" parameterType="Map" resultType="camelMap">
        SELECT    Z.*
        FROM   (
                SELECT X.*
                     , ROWNUM AS RN
                FROM   (
                	WITH RST AS (
							SELECT 
									  W2.SALES_CD
									, W2.CO_CD
									, C2.ORDRS_NO
									, W2.WBS_PLAN_CODE_ID
									, W2.WBS_PLANS_DT
									, W2.WBS_PLANE_DT
									, W2.EXPECT_MH
									, TRUNC(W2.WBS_PLANE_DT - W2.WBS_PLANS_DT + 1) AS CAL_DAY
									, 'PM계획' AS PLAN_TYPE
		                            , C2.ITEM_DIV				AS ITEM_DIV		 --ITEM 구분
                          			, C2.MCTYPE					AS MCTYPE	 	 --기계구분
		                            , M2.ORDRS_DIV				AS ORDRS_DIV	 --수주구분
                          			, B1.PRDT_GRP				AS PRDT_GRP
                          			, M2.MNG_ID					AS MNG_ID
                          			, M2.CLNT_PJT				AS CLNT_PJT
                          			, C2.EQP_NM					AS EQP_NM
                          			, B2.CLNT_NM				AS CLNT_NM
							  FROM TB_WB22M01 W2
							  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
							  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
							  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
							  			LEFT OUTER JOIN TB_BM02M01 AS B2 ON M2.ORDRS_CLNT_CD = B2.CLNT_CD
							 WHERE 1 = 1
					           AND W2.CO_CD = #{coCd}
								<if test="salesCd == null or salesCd == ''">
					           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
								</if>
							   AND W2.WBS_PLAN_CODE_KIND = 'WBSCODE'
								<!-- SalesCode -->
								<if test="salesCd != null and !salesCd.equals('')">
								AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
								</if>
								<!-- 기계종류 -->
						        <if test="prdtGrp != null and !prdtGrp.equals('')">
						        AND B1.PRDT_GRP IN ( ${prdtGrp} )
								</if>
								<!-- 수주구분 -->
						        <if test="ordrsDiv != null and !ordrsDiv.equals('')">
						        AND M2.ORDRS_DIV = #{ordrsDiv}
								</if>
								<!-- 아이템구분 -->
						        <if test="itemDiv != null and !itemDiv.equals('')">
						        AND C2.ITEM_DIV = #{itemDiv}
								</if>
								<!-- 기계구분 -->
						        <if test="mctype != null and !mctype.equals('')">
						        AND C2.MCTYPE = #{mctype}
								</if>
								<!-- 고객사PJT -->
						        <if test="clntPjt != null and !clntPjt.equals('')">
						        AND M2.CLNT_PJT = #{clntPjt}
								</if> 
								<!-- 고객사 -->
						        <if test="ordrsClntCd != null and !ordrsClntCd.equals('')">
						        AND M2.ORDRS_CLNT_CD = #{ordrsClntCd}
								</if>  
								<!-- 고객사 -->
						        <if test="ordrsClntNm != null and !ordrsClntNm.equals('')">
						        AND B2.CLNT_NM like '%' || #{ordrsClntNm} || '%'
								</if>  
							   AND W2.WBS_PLANS_DT IS NOT NULL
						UNION ALL   
							SELECT W2.SALES_CD
									, W2.CO_CD
									, C2.ORDRS_NO
									, W2.WBS_PLAN_CODE_KIND 	AS WBS_PLAN_CODE_ID
									, MIN(W2.WBS_PLANS_DT)		AS WBS_PLANS_DT
									, MAX(W2.WBS_PLANE_DT)		AS WBS_PLANE_DT
									, SUM(W2.EXPECT_MH)			AS EXPECT_MH		--계획공수
									, TRUNC(MAX(W2.WBS_PLANE_DT) - MIN(W2.WBS_PLANS_DT) + 1) AS CAL_DAY
									, '담당계획' AS PLAN_TYPE
		                            , MAX(C2.ITEM_DIV)				AS ITEM_DIV		 --ITEM 구분
                          			, MAX(C2.MCTYPE)				AS MCTYPE	 	 --기계구분
		                            , MAX(M2.ORDRS_DIV)				AS ORDRS_DIV	 --수주구분
                          			, MAX(B1.PRDT_GRP)				AS PRDT_GRP
                          			, MAX(M2.MNG_ID)				AS MNG_ID
                          			, MAX(M2.CLNT_PJT)				AS CLNT_PJT
                          			, MAX(C2.EQP_NM)				AS EQP_NM
                          			, MAX(B2.CLNT_NM)				AS CLNT_NM
							  FROM TB_WB22M01 W2
							  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
							  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
							  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
							  			LEFT OUTER JOIN TB_BM02M01 AS B2 ON M2.ORDRS_CLNT_CD = B2.CLNT_CD
							 WHERE 1 = 1
					           AND W2.CO_CD = #{coCd}
								<if test="salesCd == null or salesCd == ''">
					           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
								</if>
							   AND W2.WBS_PLAN_CODE_KIND != 'WBSCODE'
								<!-- SalesCode -->
								<if test="salesCd != null and !salesCd.equals('')">
								AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
								</if>
								<!-- 기계종류 -->
						        <if test="prdtGrp != null and !prdtGrp.equals('')">
						        AND B1.PRDT_GRP IN ( ${prdtGrp} )
								</if>
								<!-- 수주구분 -->
						        <if test="ordrsDiv != null and !ordrsDiv.equals('')">
						        AND M2.ORDRS_DIV = #{ordrsDiv}
								</if>
								<!-- 아이템구분 -->
						        <if test="itemDiv != null and !itemDiv.equals('')">
						        AND C2.ITEM_DIV = #{itemDiv}
								</if>
								<!-- 기계구분 -->
						        <if test="mctype != null and !mctype.equals('')">
						        AND C2.MCTYPE = #{mctype}
								</if>
								<!-- 고객사PJT -->
						        <if test="clntPjt != null and !clntPjt.equals('')">
						        AND M2.CLNT_PJT = #{clntPjt}
								</if> 
								<!-- 고객사 -->
						        <if test="ordrsClntCd != null and !ordrsClntCd.equals('')">
						        AND M2.ORDRS_CLNT_CD = #{ordrsClntCd}
								</if>  
								<!-- 고객사 -->
						        <if test="ordrsClntNm != null and !ordrsClntNm.equals('')">
						        AND B2.CLNT_NM like '%' || #{ordrsClntNm} || '%'
								</if>  
							 GROUP BY W2.CO_CD, C2.ORDRS_NO, W2.SALES_CD, W2.WBS_PLAN_CODE_KIND
						UNION ALL 
							SELECT    W2.SALES_CD
									, W2.CO_CD
									, C2.ORDRS_NO
									, W2.WBS_PLAN_CODE_KIND
									, MIN(W2.WBS_RSLTSS_DT)		AS WBS_PLANS_DT
									, MAX(
										  CASE
										    WHEN W2.WBS_RSLTSS_DT <![CDATA[ < ]]> TRUNC(SYSDATE)
										         AND W2.WBS_RSLTSE_DT IS NULL
										    THEN SYSDATE
										    ELSE W2.WBS_RSLTSE_DT
										  END
										) AS WBS_PLANE_DT
									, SUM(W2.WBS_RSLTS_MH)			AS EXPECT_MH		--계획공수
					--				, SUM(W2.DAYCNT)				AS DAYCNT			--소요일수
									, TRUNC(MAX(W2.WBS_RSLTSE_DT) - MIN(W2.WBS_RSLTSS_DT) + 1) AS CAL_DAY
									, '담당실적' AS PLAN_TYPE
		                            , MAX(C2.ITEM_DIV)				AS ITEM_DIV		 --ITEM 구분
                          			, MAX(C2.MCTYPE)				AS MCTYPE	 	 --기계구분
		                            , MAX(M2.ORDRS_DIV)				AS ORDRS_DIV	 --수주구분
                          			, MAX(B1.PRDT_GRP)				AS PRDT_GRP
                          			, MAX(M2.MNG_ID)				AS MNG_ID
                          			, MAX(M2.CLNT_PJT)				AS CLNT_PJT
                          			, MAX(C2.EQP_NM)				AS EQP_NM
                          			, MAX(B2.CLNT_NM)				AS CLNT_NM
							  FROM TB_WB23M01 W2
							  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
							  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
							  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
							  			LEFT OUTER JOIN TB_BM02M01 AS B2 ON M2.ORDRS_CLNT_CD = B2.CLNT_CD
							 WHERE 1 = 1
					           AND W2.CO_CD = #{coCd}
								<if test="salesCd == null or salesCd == ''">
					           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
								</if>
								<!-- SalesCode -->
								<if test="salesCd != null and !salesCd.equals('')">
								AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
								</if>
								<!-- 기계종류 -->
						        <if test="prdtGrp != null and !prdtGrp.equals('')">
						        AND B1.PRDT_GRP IN ( ${prdtGrp} )
								</if>
								<!-- 수주구분 -->
						        <if test="ordrsDiv != null and !ordrsDiv.equals('')">
						        AND M2.ORDRS_DIV = #{ordrsDiv}
								</if>
								<!-- 아이템구분 -->
						        <if test="itemDiv != null and !itemDiv.equals('')">
						        AND C2.ITEM_DIV = #{itemDiv}
								</if>
								<!-- 기계구분 -->
						        <if test="mctype != null and !mctype.equals('')">
						        AND C2.MCTYPE = #{mctype}
								</if>
								<!-- 고객사PJT -->
						        <if test="clntPjt != null and !clntPjt.equals('')">
						        AND M2.CLNT_PJT = #{clntPjt}
								</if> 
								<!-- 고객사 -->
						        <if test="ordrsClntCd != null and !ordrsClntCd.equals('')">
						        AND M2.ORDRS_CLNT_CD = #{ordrsClntCd}
								</if>  
								<!-- 고객사 -->
						        <if test="ordrsClntNm != null and !ordrsClntNm.equals('')">
						        AND B2.CLNT_NM like '%' || #{ordrsClntNm} || '%'
								</if>  
							 GROUP BY W2.CO_CD, C2.ORDRS_NO, W2.SALES_CD, W2.WBS_PLAN_CODE_KIND
					) 
					 , SCD AS (
						SELECT    CO_CD, SALES_CD
								, MIN(WBS_PLANS_DT) AS WBS_PLANS_DT
								, MAX(WBS_PLANE_DT) AS WBS_PLANE_DT
						  FROM RST AS T
						 WHERE PLAN_TYPE = 'PM계획'
						 GROUP BY CO_CD, SALES_CD
						 <if test="scdStatus == '진행중'">
						 HAVING MIN(WBS_PLANS_DT) <![CDATA[ <= ]]> SYSDATE AND SYSDATE <![CDATA[ <= ]]> MAX(WBS_PLANE_DT)
  						 </if>
						 <if test="scdStatus == '완료된'">
						 HAVING  SYSDATE <![CDATA[ > ]]> MAX(WBS_PLANE_DT)
  						 </if>
						 <if test="scdStatus == '미도래'">
						 HAVING  MIN(WBS_PLANS_DT) <![CDATA[ > ]]> SYSDATE
  						 </if>
					)
					SELECT T.*
						   ,  TO_CHAR(T.WBS_PLANS_DT, 'YYYY-MM-DD') 				AS WBS_PLANS_DT_FM
						   ,  TO_CHAR(T.WBS_PLANE_DT, 'YYYY-MM-DD') 				AS WBS_PLANE_DT_FM
						   , (SELECT FN_CM05M01_CD_TO_NM(T.PRDT_GRP) FROM DUAL) 	AS 기계종류
						   , (SELECT FN_CM05M01_CD_TO_NM(T.ORDRS_DIV) FROM DUAL) 	AS 수주구분
						   , (SELECT FN_CM05M01_CD_TO_NM(T.ITEM_DIV) FROM DUAL) 	AS 아이템구분
						   , (SELECT FN_CM05M01_CD_TO_NM(T.MCTYPE) FROM DUAL)   	AS 기계구분
						   , (SELECT FN_CM05M01_CD_TO_NM(WBS_PLAN_CODE_ID) FROM DUAL)   	AS WBS_PLAN_CODE_NM
						   , (SELECT FN_CM05M01_CD_TO_NM(CLNT_PJT) FROM DUAL)   	AS CLNT_PJT_NM
						   , (SELECT FN_CM06M01_ID_TO_NM(MNG_ID) FROM DUAL)   		AS MNG_ID_NM
					   FROM RST AS T
					   WHERE 1 = 1
					     AND EXISTS (SELECT 1 FROM SCD WHERE SCD.SALES_CD = T.SALES_CD)
					  ORDER BY T.CO_CD, T.PRDT_GRP, T.ORDRS_NO DESC, T.SALES_CD, T.PLAN_TYPE, 	T.WBS_PLAN_CODE_ID
							 
                 ) AS X
           ) AS Z
        WHERE  1 = 1
<!--         AND    RN BETWEEN #{firstIndex} AND #{lastIndex} -->
    </select>
    
    
    
    
    <select id="select_wb2605_List" parameterType="Map" resultType="camelMap">
        SELECT    Z.*
        FROM   (
                SELECT X.*
                     , ROWNUM AS RN
                FROM   (
                	WITH SCD AS (
						SELECT    W2.CO_CD, C2.ORDRS_NO, W2.SALES_CD
								, MIN(W2.WBS_PLANS_DT) 			AS WBS_PLANS_DT
								, MAX(W2.WBS_PLANE_DT) 			AS WBS_PLANE_DT
								, MAX(W21.FILE_TRGT_KEY)		AS FILE_TRGT_KEY
								, MAX(W2.CLOSE_YN)				AS CONFIRM_YN		--일정 확정여부
							    , MAX(W21.SMRIZE_ID)			AS SMRIZE_ID		--총괄PM담당자
							    , MAX(W21.CLOSE_YN)				AS CLOSE_YN			--과제 확정여부
						  FROM TB_WB22M01 AS W2
							  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
							  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
							  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
							  			LEFT OUTER JOIN TB_BM02M01 AS B2 ON M2.ORDRS_CLNT_CD = B2.CLNT_CD
							  			LEFT OUTER JOIN TB_CM06M01 AS C6 ON C6.ID = W2.WBS_PLAN_MNG_ID
					   			LEFT OUTER JOIN TB_WB21M01 AS W21 ON W2.CO_CD = W21.CO_CD 
					   			                                 AND W2.SALES_CD = W21.SALES_CD 
					   			                                 AND W21.VER_NO = (
																			       SELECT MAX(W21_SUB.VER_NO)
																			         FROM TB_WB21M01 W21_SUB
																			        WHERE W21_SUB.CO_CD   = W2.CO_CD
																			          AND W21_SUB.SALES_CD= W2.SALES_CD
																				  )
							  	LEFT OUTER JOIN TB_BM02M01 AS B21  ON W21.MKER_CD = B21.CLNT_CD
						 WHERE 1 = 1
					       AND W2.CO_CD = #{coCd}
						   AND W2.WBS_PLAN_CODE_KIND = 'WBSCODE'
							<if test="salesCd == null or salesCd == ''">
				           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
							</if>
								<!-- SalesCode -->
								<if test="salesCd != null and !salesCd.equals('')">
								AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
								</if>
								<!-- 기계종류 -->
						        <if test="prdtGrp != null and !prdtGrp.equals('')">
						        AND B1.PRDT_GRP IN ( ${prdtGrp} )
								</if>
								<!-- 수주구분 -->
						        <if test="ordrsDiv != null and !ordrsDiv.equals('')">
						        AND M2.ORDRS_DIV = #{ordrsDiv}
								</if>
								<!-- 아이템구분 -->
						        <if test="itemDiv != null and !itemDiv.equals('')">
						        AND C2.ITEM_DIV = #{itemDiv}
								</if>
								<!-- 기계구분 -->
						        <if test="mctype != null and !mctype.equals('')">
						        AND C2.MCTYPE = #{mctype}
								</if>
								<!-- 고객사PJT -->
						        <if test="clntPjt != null and !clntPjt.equals('')">
						        AND M2.CLNT_PJT = #{clntPjt}
								</if> 
								<!-- 고객사 -->
						        <if test="ordrsClntCd != null and !ordrsClntCd.equals('')">
						        AND M2.ORDRS_CLNT_CD = #{ordrsClntCd}
								</if>  
								<!-- 고객사 -->
						        <if test="ordrsClntNm != null and !ordrsClntNm.equals('')">
						        AND B2.CLNT_NM like '%' || #{ordrsClntNm} || '%'
								</if>  
								<!-- 당당자 -->
						        <if test="wbsPlanMngId != null and !wbsPlanMngId.equals('')">
						        AND W2.WBS_PLAN_MNG_ID = #{wbsPlanMngId}
								</if>  
								<!-- 당당자 -->
						        <if test="wbsPlanMngIdNm != null and !wbsPlanMngIdNm.equals('')">
						        AND C6.NAME like '%' || #{wbsPlanMngIdNm} || '%'
								</if>  
							   AND W2.WBS_PLANS_DT IS NOT NULL
						 GROUP BY W2.CO_CD, C2.ORDRS_NO, W2.SALES_CD
						 <if test="scdStatus == '진행중'">
						 HAVING MIN(W2.WBS_PLANS_DT) <![CDATA[ <= ]]> SYSDATE AND SYSDATE <![CDATA[ <= ]]> MAX(W2.WBS_PLANE_DT)
  						 </if>
						 <if test="scdStatus == '완료된'">
						 HAVING  SYSDATE <![CDATA[ > ]]> MAX(W2.WBS_PLANE_DT)
  						 </if>
						 <if test="scdStatus == '미도래'">
						 HAVING  MIN(W2.WBS_PLANS_DT) <![CDATA[ > ]]> SYSDATE
  						 </if>
					), 
					RST AS (
							SELECT 
									  W2.SALES_CD
									, W2.CO_CD
									, SCD.ORDRS_NO
									, W2.WBS_PLAN_NO
									, W2.WBS_PLAN_CODE_KIND 	AS WBS_PLAN_CODE_KIND
									, W2.WBS_PLAN_CODE_ID
						   			, (SELECT FN_CM05M01_CD_TO_NM(W2.WBS_PLAN_CODE_ID) FROM DUAL)   	AS WBS_PLAN_CODE_NM
									, W2.WBS_PLANS_DT
									, W2.WBS_PLANE_DT
									, ''						AS WBS_RSLTS_RATE
									, W2.EXPECT_MH
									, TRUNC(W2.WBS_PLANE_DT - W2.WBS_PLANS_DT + 1) AS CAL_DAY
									, 'PM' 						AS PLAN_TYPE
                          			, W2.FILE_TRGT_KEY			AS FILE_TRGT_KEY
                          			, W2.WBS_PLAN_MNG_ID		AS WBS_PLAN_MNG_ID
                          			, C6.NAME					AS WBS_PLAN_MNG_ID_NM
                          			, W2.CLOSE_YN				AS PM_CLOSE_YN
						   			, SCD.CLOSE_YN				AS CLOSE_YN
						   			, SCD.CONFIRM_YN			AS CONFIRM_YN
						   			, CASE WHEN NVL(W22.PLAN_CNT,0)  <![CDATA[ > ]]> 0 
						   			          THEN 'N'
						   				      ELSE 'Y' END 		AS OVER_DUE
							  FROM TB_WB22M01 W2
							  			INNER JOIN SCD  ON W2.CO_CD = SCD.CO_CD AND W2.SALES_CD = SCD.SALES_CD
							  			LEFT OUTER JOIN TB_CM06M01 AS C6 ON C6.ID = W2.WBS_PLAN_MNG_ID
							  			LEFT OUTER JOIN ( 
													    SELECT W22.CO_CD,
													           W22.SALES_CD,
													           W22.WBS_PLAN_CODE_KIND,
													           MIN(W22.WBS_PLANS_DT)   AS WBS_PLANS_DT,
													           MAX(W22.WBS_PLANE_DT)   AS WBS_PLANE_DT,
													           COUNT(W22.WBS_PLAN_NO)  AS PLAN_CNT
													    FROM   TB_WB22M01 W22
													    WHERE  W22.WBS_PLAN_CODE_KIND != 'WBSCODE'
													    GROUP BY W22.CO_CD, W22.SALES_CD, W22.WBS_PLAN_CODE_KIND
													) W22
													   ON W22.CO_CD              = W2.CO_CD
													  AND W22.SALES_CD           = W2.SALES_CD
													  AND W22.WBS_PLAN_CODE_KIND = W2.WBS_PLAN_CODE_ID
							 WHERE 1 = 1
						  	   AND W2.WBS_PLAN_CODE_KIND = 'WBSCODE'
							   AND W2.WBS_PLANS_DT IS NOT NULL
								<!-- 당당자 -->
						        <if test="wbsPlanMngId != null and !wbsPlanMngId.equals('')">
						        AND W2.WBS_PLAN_MNG_ID = #{wbsPlanMngId}
								</if>  
								<!-- 당당자 -->
						        <if test="wbsPlanMngIdNm != null and !wbsPlanMngIdNm.equals('')">
						        AND C6.NAME like '%' || #{wbsPlanMngIdNm} || '%'
								</if>  
						UNION ALL   
							SELECT W2.SALES_CD
									, W2.CO_CD
									, SCD.ORDRS_NO
									, W2.WBS_PLAN_NO
									, W2.WBS_PLAN_CODE_KIND 	AS WBS_PLAN_CODE_KIND
									, W2.WBS_PLAN_CODE_ID 		AS WBS_PLAN_CODE_ID
									, W2.WBS_PLAN_CODE_NM   	AS WBS_PLAN_CODE_NM
									, W2.WBS_PLANS_DT			AS WBS_PLANS_DT
									, W2.WBS_PLANE_DT			AS WBS_PLANE_DT
									, ''						AS WBS_RSLTS_RATE
									, W2.EXPECT_MH				AS EXPECT_MH		--계획공수
									, TRUNC(W2.WBS_PLANE_DT - W2.WBS_PLANS_DT + 1) AS CAL_DAY
									, 'PLAN' 					AS PLAN_TYPE
									, W2.FILE_TRGT_KEY			AS FILE_TRGT_KEY
									, NVL(W2.WBS_PLAN_MNG_ID, W2.CREAT_ID)		AS WBS_PLAN_MNG_ID
                          			, C6.NAME					AS WBS_PLAN_MNG_ID_NM
									, W23.CLOSE_YN				AS PM_CLOSE_YN
						   			, SCD.CLOSE_YN				AS CLOSE_YN
						   			, SCD.CONFIRM_YN			AS CONFIRM_YN
						   			, CASE WHEN  W2.WBS_PLANS_DT  <![CDATA[ <= ]]> SYSDATE AND NVL(W23.CLOSE_YN,'N') != 'Y'
						   			          THEN 'Y'
						   				      ELSE 'N' END 		AS OVER_DUE
							  FROM TB_WB22M01 W2
							  			INNER JOIN SCD  ON W2.CO_CD = SCD.CO_CD AND W2.SALES_CD = SCD.SALES_CD
							  			LEFT OUTER JOIN TB_WB23M01 AS W23 ON W2.WBS_PLAN_NO = W23.WBS_RSLTS_NO
							  			LEFT OUTER JOIN TB_CM06M01 AS C6 ON C6.ID = NVL(W2.WBS_PLAN_MNG_ID, W2.CREAT_ID)
							 WHERE 1 = 1
						  	   AND W2.WBS_PLAN_CODE_KIND != 'WBSCODE'
								<!-- 당당자 -->
						        <if test="wbsPlanMngId != null and !wbsPlanMngId.equals('')">
						        AND W2.WBS_PLAN_MNG_ID = #{wbsPlanMngId}
								</if>  
								<!-- 당당자 -->
						        <if test="wbsPlanMngIdNm != null and !wbsPlanMngIdNm.equals('')">
						        AND C6.NAME like '%' || #{wbsPlanMngIdNm} || '%'
								</if> 
						UNION ALL 
							SELECT    W2.SALES_CD
									, W2.CO_CD
									, SCD.ORDRS_NO
									, W2.WBS_RSLTS_NO
									, W2.WBS_PLAN_CODE_KIND
									, W2.WBS_PLAN_CODE_ID
									, W22.WBS_PLAN_CODE_NM      AS WBS_PLAN_CODE_NM
									, W2.WBS_RSLTSS_DT			AS WBS_PLANS_DT
									, W2.WBS_RSLTSE_DT			AS WBS_PLANE_DT
									, W2.WBS_RSLTS_RATE			AS WBS_RSLTS_RATE
									, W2.WBS_RSLTS_MH			AS EXPECT_MH		--계획공수
									, TRUNC(W2.WBS_RSLTSE_DT - W2.WBS_RSLTSS_DT + 1) AS CAL_DAY
									, 'DO' 						AS PLAN_TYPE
									, W2.FILE_TRGT_KEY			AS FILE_TRGT_KEY
									, NVL(W2.WBS_RSLTS_ID, W2.CREAT_ID)			AS WBS_PLAN_MNG_ID
                          			, C6.NAME					AS WBS_PLAN_MNG_ID_NM
									, W2.CLOSE_YN				AS PM_CLOSE_YN		--일정 확정여부
						   			, SCD.CLOSE_YN				AS CLOSE_YN
						   			, SCD.CONFIRM_YN			AS CONFIRM_YN
						   			, 'N' 						AS OVER_DUE			--실적자료는 무조건 N으로 설정함
							  FROM TB_WB23M01 W2
							  			INNER JOIN SCD  ON W2.CO_CD = SCD.CO_CD AND W2.SALES_CD = SCD.SALES_CD
							  			LEFT OUTER JOIN TB_WB22M01 AS W22 ON W22.WBS_PLAN_NO = W2.WBS_RSLTS_NO
							  			LEFT OUTER JOIN TB_CM06M01 AS C6 ON C6.ID = NVL(W2.WBS_RSLTS_ID, W2.CREAT_ID)
							 WHERE 1 = 1
								<!-- 당당자 -->
						        <if test="wbsPlanMngId != null and !wbsPlanMngId.equals('')">
						        AND W2.WBS_RSLTS_ID = #{wbsPlanMngId}
								</if>  
								<!-- 당당자 -->
						        <if test="wbsPlanMngIdNm != null and !wbsPlanMngIdNm.equals('')">
						        AND C6.NAME like '%' || #{wbsPlanMngIdNm} || '%'
								</if> 
					) 
					SELECT T.*
						   ,  TO_CHAR(T.WBS_PLANS_DT, 'YYYY-MM-DD') 				AS WBS_PLANS_DT_FM
						   ,  TO_CHAR(T.WBS_PLANE_DT, 'YYYY-MM-DD') 				AS WBS_PLANE_DT_FM
					   FROM RST AS T
					   WHERE 1 = 1
					     AND EXISTS (SELECT 1 FROM SCD WHERE SCD.SALES_CD = T.SALES_CD)
					  ORDER BY T.CO_CD, T.ORDRS_NO DESC, T.SALES_CD, T.PLAN_TYPE, 	T.WBS_PLAN_CODE_ID
							 
                 ) AS X
           ) AS Z
        WHERE  1 = 1
<!--         AND    RN BETWEEN #{firstIndex} AND #{lastIndex} -->
    </select>
    
    
    <select id="select_wb2605_metaList" parameterType="Map" resultType="camelMap">
        SELECT    Z.*
        FROM   (
                SELECT X.*
                     , ROWNUM AS RN
                FROM   (
                	WITH SCD AS (
						SELECT    W2.CO_CD, C2.ORDRS_NO, W2.SALES_CD
								, MIN(W2.WBS_PLANS_DT) 			AS WBS_PLANS_DT
								, MAX(W2.WBS_PLANE_DT) 			AS WBS_PLANE_DT
								, MAX(W2.WBS_PLAN_MNG_ID) 		AS WBS_PLAN_MNG_ID
								, MAX(C6.NAME) 					AS WBS_PLAN_MNG_ID_NM
								
	                            , MAX(C2.ITEM_DIV)				AS ITEM_DIV		 --ITEM 구분
                         		, MAX(C2.MCTYPE)				AS MCTYPE	 	 --기계구분
	                            , MAX(M2.ORDRS_DIV)				AS ORDRS_DIV	 --수주구분
                        		, MAX(B1.PRDT_GRP)				AS PRDT_GRP
                        		, MAX(M2.MNG_ID)				AS MNG_ID
                        		, MAX(M2.CLNT_PJT)				AS CLNT_PJT
                        		, MAX(C2.EQP_NM)				AS EQP_NM
                        		, MAX(B2.CLNT_NM)				AS CLNT_NM
								, MAX(W2.FILE_TRGT_KEY)			AS FILE_TRGT_KEY
								, MAX(W2.CLOSE_YN)				AS PM_CLOSE_YN		--일정 확정여부
							    , MAX(W21.MKER_CD)				AS MKER_CD
							    , MAX(B21.CLNT_NM)				AS MKER_CD_NM
							    , MAX(W21.SMRIZE_ID)			AS SMRIZE_ID
							    , MAX(W21.CLOSE_YN)				AS CLOSE_YN
						  FROM TB_WB22M01 AS W2
							  			LEFT OUTER JOIN TB_CR02D02 AS C2 ON W2.SALES_CD = C2.SALES_CD
							  			LEFT OUTER JOIN TB_BM01M01 AS B1 ON C2.PRDT_CD = B1.PRDT_CD
							  			LEFT OUTER JOIN TB_CR02M01 AS M2 ON C2.ORDRS_NO = M2.ORDRS_NO
							  			LEFT OUTER JOIN TB_BM02M01 AS B2 ON M2.ORDRS_CLNT_CD = B2.CLNT_CD
							  			LEFT OUTER JOIN TB_CM06M01 AS C6 ON C6.ID = W2.WBS_PLAN_MNG_ID
					   			LEFT OUTER JOIN TB_WB21M01 AS W21 ON W2.CO_CD = W21.CO_CD 
					   			                                 AND W2.SALES_CD = W21.SALES_CD 
					   			                                 AND W21.VER_NO = (
																			       SELECT MAX(W21_SUB.VER_NO)
																			         FROM TB_WB21M01 W21_SUB
																			        WHERE W21_SUB.CO_CD   = W2.CO_CD
																			          AND W21_SUB.SALES_CD= W2.SALES_CD
																				  )
							  	LEFT OUTER JOIN TB_BM02M01 AS B21  ON W21.MKER_CD = B21.CLNT_CD
						 WHERE 1 = 1
					       AND W2.CO_CD = #{coCd}
						   AND W2.WBS_PLAN_CODE_KIND = 'WBSCODE'
							<if test="salesCd == null or salesCd == ''">
				           AND M2.ORDRS_DT BETWEEN TO_DATE(#{strtDt},'YYYYMMDD') AND TO_DATE(#{endDt},'YYYYMMDD')  
							</if>
								<!-- SalesCode -->
								<if test="salesCd != null and !salesCd.equals('')">
								AND W2.SALES_CD LIKE  '%' || #{salesCd} || '%'
								</if>
								<!-- 기계종류 -->
						        <if test="prdtGrp != null and !prdtGrp.equals('')">
						        AND B1.PRDT_GRP IN ( ${prdtGrp} )
								</if>
								<!-- 수주구분 -->
						        <if test="ordrsDiv != null and !ordrsDiv.equals('')">
						        AND M2.ORDRS_DIV = #{ordrsDiv}
								</if>
								<!-- 아이템구분 -->
						        <if test="itemDiv != null and !itemDiv.equals('')">
						        AND C2.ITEM_DIV = #{itemDiv}
								</if>
								<!-- 기계구분 -->
						        <if test="mctype != null and !mctype.equals('')">
						        AND C2.MCTYPE = #{mctype}
								</if>
								<!-- 고객사PJT -->
						        <if test="clntPjt != null and !clntPjt.equals('')">
						        AND M2.CLNT_PJT = #{clntPjt}
								</if> 
								<!-- 고객사 -->
						        <if test="ordrsClntCd != null and !ordrsClntCd.equals('')">
						        AND M2.ORDRS_CLNT_CD = #{ordrsClntCd}
								</if>  
								<!-- 고객사 -->
						        <if test="ordrsClntNm != null and !ordrsClntNm.equals('')">
						        AND B2.CLNT_NM like '%' || #{ordrsClntNm} || '%'
								</if>  
								<!-- 당당자 -->
						        <if test="wbsPlanMngId != null and !wbsPlanMngId.equals('')">
						        AND W2.WBS_PLAN_MNG_ID = #{wbsPlanMngId}
								</if>  
								<!-- 당당자 -->
						        <if test="wbsPlanMngIdNm != null and !wbsPlanMngIdNm.equals('')">
						        AND C6.NAME like '%' || #{wbsPlanMngIdNm} || '%'
								</if>  
							   AND W2.WBS_PLANS_DT IS NOT NULL
						 GROUP BY W2.CO_CD, C2.ORDRS_NO, W2.SALES_CD
						 <if test="scdStatus == '진행중'">
						 HAVING MIN(W2.WBS_PLANS_DT) <![CDATA[ <= ]]> SYSDATE AND SYSDATE <![CDATA[ <= ]]> MAX(W2.WBS_PLANE_DT)
  						 </if>
						 <if test="scdStatus == '완료된'">
						 HAVING  SYSDATE <![CDATA[ > ]]> MAX(W2.WBS_PLANE_DT)
  						 </if>
						 <if test="scdStatus == '미도래'">
						 HAVING  MIN(W2.WBS_PLANS_DT) <![CDATA[ > ]]> SYSDATE
  						 </if>
					)
					SELECT    T.SALES_CD
							, T.CO_CD
							, T.ORDRS_NO
							, T.WBS_PLAN_MNG_ID
							, T.WBS_PLAN_MNG_ID_NM
							, T.CLNT_NM
							, T.EQP_NM
							, T.PM_CLOSE_YN
						    , (SELECT FN_CM05M01_CD_TO_NM(T.PRDT_GRP) FROM DUAL) 	AS 기계종류
						    , (SELECT FN_CM05M01_CD_TO_NM(T.ORDRS_DIV) FROM DUAL) 	AS 수주구분
						    , (SELECT FN_CM05M01_CD_TO_NM(T.ITEM_DIV) FROM DUAL) 	AS 아이템구분
						    , (SELECT FN_CM05M01_CD_TO_NM(T.MCTYPE) FROM DUAL)   	AS 기계구분
						    , (SELECT FN_CM05M01_CD_TO_NM(T.CLNT_PJT) FROM DUAL)   	AS CLNT_PJT_NM
						    , (SELECT FN_CM06M01_ID_TO_NM(T.MNG_ID) FROM DUAL)   	AS MNG_ID_NM
						    , FN_CM06M01_ID_TO_NM(T.SMRIZE_ID)						AS SMRIZE_ID_NM
						    , T.SMRIZE_ID											AS SMRIZE_ID
						    , T.CLOSE_YN											AS CLOSE_YN
					   FROM SCD AS T
					   WHERE 1 = 1
					  ORDER BY T.CO_CD, T.PRDT_GRP, T.ORDRS_NO DESC, T.SALES_CD
							 
                 ) AS X
           ) AS Z
        WHERE  1 = 1
<!--         AND    RN BETWEEN #{firstIndex} AND #{lastIndex} -->
    </select>
    
    
    <select id="selectWbsTaskTempletGantList" parameterType="Map" resultType="camelMap">
		  SELECT 
		 		  C.CODE_ID 
		 		, C.CODE_NM
		 		, C.CODE_ID AS CODE
		 		, C.CODE_NM AS NAME
		 		, C.CODE_KIND
		 		, C.SORT_NO
		 		, C.USE_YN
		 		, W.WBS_PLANS_DT
		 		, W.WBS_PLANE_DT
		 		, W.DAYCNT
		 		, W.WBS_PLAN_STS_CODE_ID
		 		, W.EXPECT_MH
		   FROM TB_CM05M01 AS C 
		   			LEFT OUTER JOIN TB_WB22M01 AS W ON C.CODE_KIND 			= W.WBS_PLAN_CODE_ID 
		   			                               AND W.SALES_CD 			= #{salesCd}
		   			                               AND W.WBS_PLAN_CODE_KIND = 'WBSCODE'
		 WHERE CODE_KIND IN (
		 						SELECT WBS_PLAN_CODE_ID
		  						  FROM TB_WB22M01 AS T 
		  						 WHERE T.SALES_CD 			= #{salesCd}
		  						   AND T.WBS_PLAN_MNG_ID 	= #{userId}
		  						   AND T.WBS_PLAN_CODE_KIND = 'WBSCODE'
		  					)
		   AND NOT EXISTS ( SELECT WBS_PLAN_CODE_ID
							  FROM TB_WB22M01 AS T 
							 WHERE T.SALES_CD 			= #{salesCd}
							   AND T.WBS_PLAN_MNG_ID 	= #{userId}
							   AND T.WBS_PLAN_CODE_NM 	= C.CODE_NM)
		  ORDER BY C.CODE_KIND, C.SORT_NO
    </select>
    
    
    
    <select id="select_wb06_List" parameterType="Map" resultType="camelMap">
		WITH DEPT_TBL AS (
			SELECT *
			FROM (
                        SELECT 'WBSCODE01' AS WBS_PLAN_CODE_ID, '영업'    AS FULL_NM, '영' AS DEPT_NM, 'S01' AS DEPT_ID, 'GUN30' AS MNG_DEPT FROM DUAL
                UNION SELECT 'WBSCODE02',                      '영업',             '영',            'S01',         'GUN30'    FROM DUAL
                UNION SELECT 'WBSCODE03',                      '설계',             '설',            'S03',         'GUN40'    FROM DUAL
                UNION SELECT 'WBSCODE17',                      '구매',             '구',            'S04',         'TRN50'    FROM DUAL
                UNION SELECT 'WBSCODE04',                      '구매',             '구',            'S04',         'TRN50'    FROM DUAL
                UNION SELECT 'WBSCODE18',                      '제품입고',          '제',            'S06',        'GUN30'     FROM DUAL
                UNION SELECT 'WBSCODE05',                      '생산',             '생',            'S07',         'GUN60'    FROM DUAL
                UNION SELECT 'WBSCODE06',                      '전기',             '전',            'S08',         'TRN50'    FROM DUAL
                UNION SELECT 'WBSCODE07',                      '시운전',            '시',            'S09',        'TRN50'     FROM DUAL
                UNION SELECT 'WBSCODE16',                      '시운전',            '시',            'S09',        'TRN50'   FROM DUAL
                UNION SELECT 'WBSCODE09',                      '고객검수',          '고',            'S11',        'GUN30'     FROM DUAL
                UNION SELECT 'WBSCODE11',                      '출하',             '출',            'S13',         'GUN30'    FROM DUAL
                UNION SELECT 'WBSCODE13',                      '설치',             '치',            'S14',         'GUN30'    FROM DUAL
                UNION SELECT 'WBSCODE14',                      '설치',             '치',            'S14',         'GUN30'    FROM DUAL
                ) T 
                LEFT OUTER JOIN ( 
             SELECT  substr(VIEW_DEPT_ID,1,5) VIEW_DEPT_ID, MNG_ID AS TEAM_MNG_ID
             FROM TB_CM06M01
             WHERE TEAM_MANAGER = 'TEAM01'
             AND USE_YN = 'Y'
             AND MNG_ID IS NOT NULL
                ) M ON M.VIEW_DEPT_ID = T.MNG_DEPT
		),
		src AS (
			SELECT DISTINCT
				W.CO_CD,
				W.SALES_CD,
				D.DEPT_ID,
				D.DEPT_NM,
				D.FULL_NM,
				D.TEAM_MNG_ID,
				W.WBS_PLANS_DT,
				W.WBS_PLANE_DT,
				W.WBS_PLAN_CODE_ID,
				W.FILE_TRGT_KEY,
				W.CLOSE_YN AS WBS_CLOSE_YN
			FROM TB_WB22M01 W
			LEFT JOIN DEPT_TBL D
			ON D.WBS_PLAN_CODE_ID = W.WBS_PLAN_CODE_ID
			WHERE W.WBS_PLAN_CODE_KIND = 'WBSCODE'
			<!-- SalesCode -->
			<if test="salesCd != null and !salesCd.equals('')">
			AND W.SALES_CD LIKE  '%' || #{salesCd} || '%'
			</if>
			AND W.CO_CD = 'GUN'
			AND W.WBS_PLANS_DT IS NOT NULL
			AND W.WBS_PLANE_DT IS NOT NULL
			AND D.DEPT_ID IS NOT NULL
		),
		/* sales는 1회만 집계 */
		sales AS (
			SELECT
				S0.CO_CD,
				S0.SALES_CD,
				MAX(C.EQP_NM)        AS EQP_NM,
				MAX(C.ORDRS_NO)      AS ORDRS_NO,
				MAX(M.ORDRS_CLNT_CD) AS ORDRS_CLNT_CD,
				MAX(B.CLNT_NM)       AS CLNT_NM,
				MAX(M.CLNT_PJT)      AS CLNT_PJT,
				FN_CM05M01_CD_TO_NM(MAX(M.CLNT_PJT)) AS CLNT_PJT_NM,
				MAX(W.FILE_TRGT_KEY) AS SJ_FILE_TRGT_KEY,
                MAX(W.WBS_REMARK) 	 AS WBS_REMARK,
                MAX(NVL(W.CLOSE_YN,'N')) AS CLOSE_YN,
                MAX(W.SMRIZE_ID) 	 AS SMRIZE_ID
			FROM (SELECT DISTINCT CO_CD, SALES_CD FROM src) S0
			JOIN TB_CR02D02 C ON C.CO_CD = S0.CO_CD AND C.SALES_CD = S0.SALES_CD
			JOIN TB_CR02M01 M ON M.ORDRS_NO = C.ORDRS_NO
			JOIN TB_BM02M01 B ON B.CLNT_CD  = M.ORDRS_CLNT_CD
            LEFT OUTER JOIN  (
            			SELECT CO_CD, SALES_CD, FILE_TRGT_KEY, WBS_REMARK, CLOSE_YN , VER_NO, SMRIZE_ID
            			FROM TB_WB21M01 W 
            			WHERE W.VER_NO = (SELECT MAX(TO_NUMBER(VER_NO)) FROM TB_WB21M01 P1 WHERE P1.SJ_NO = W.SJ_NO)
            ) W ON W.CO_CD = S0.CO_CD AND W.SALES_CD = S0.SALES_CD
			GROUP BY S0.CO_CD, S0.SALES_CD
		),
		base_lag AS (
			SELECT
				s.*,
				LAG(DEPT_ID) OVER (
					PARTITION BY CO_CD, SALES_CD
					ORDER BY WBS_PLANS_DT, WBS_PLANE_DT, DEPT_ID, WBS_PLAN_CODE_ID, FILE_TRGT_KEY
				) AS PREV_DEPT_ID
			FROM src s
		),
		base_run AS (
			SELECT
				b.*,
				SUM(
					CASE WHEN b.PREV_DEPT_ID = b.DEPT_ID THEN 0 ELSE 1 END
				) OVER (
					PARTITION BY CO_CD, SALES_CD
					ORDER BY WBS_PLANS_DT, WBS_PLANE_DT, DEPT_ID, WBS_PLAN_CODE_ID
				) AS RUN_ID
			FROM base_lag b
		),
		/* 여기서 먼저 run 단위로 집계(최종 GROUP BY 문제 제거) */
		final_base AS (
			SELECT
				CO_CD,
				SALES_CD,
				RUN_ID,
				DEPT_ID,
				MAX(DEPT_NM)  AS DEPT_NM,
				MAX(FULL_NM)  AS FULL_NM,
				MAX(TEAM_MNG_ID)   AS TEAM_MNG_ID,
				MIN(WBS_PLANS_DT)  AS WBS_PLANS_DT_FM,
				MAX(WBS_PLANE_DT)  AS WBS_PLANE_DT_FM,
				MAX(FILE_TRGT_KEY) AS FILE_TRGT_KEY,
				MAX(WBS_CLOSE_YN)  AS WBS_CLOSE_YN		--일정마감여부
			FROM base_run
			GROUP BY CO_CD, SALES_CD, RUN_ID, DEPT_ID
		),
		sales_range AS (
			SELECT
				CO_CD,
				SALES_CD,
				MIN(WBS_PLANS_DT_FM) AS SALES_START,
				MAX(WBS_PLANE_DT_FM) AS SALES_END
			FROM final_base
			GROUP BY CO_CD, SALES_CD
		)
		SELECT
			F.CO_CD,
			F.SALES_CD,
			F.DEPT_ID,
			F.DEPT_NM,
			F.FULL_NM,
			F.TEAM_MNG_ID,
			TO_CHAR(F.WBS_PLANS_DT_FM, 'YYYY-MM-DD') AS WBS_PLANS_DT_FM,
			TO_CHAR(F.WBS_PLANE_DT_FM, 'YYYY-MM-DD') AS WBS_PLANE_DT_FM,
			F.WBS_CLOSE_YN,			--일정마감여부
			S.EQP_NM,
			S.ORDRS_NO,
			S.ORDRS_CLNT_CD,
			S.CLNT_NM,
			S.CLNT_PJT,
			S.CLNT_PJT_NM,
            F.FILE_TRGT_KEY,
            S.SJ_FILE_TRGT_KEY, --과제마스터키
            S.CLOSE_YN,		--과제마감여부
            S.WBS_REMARK,	--WBS 특이사항
            S.SMRIZE_ID
		FROM final_base F
		JOIN sales S
		ON S.CO_CD = F.CO_CD AND S.SALES_CD = F.SALES_CD
		JOIN sales_range R
		ON R.CO_CD = F.CO_CD AND R.SALES_CD = F.SALES_CD
		WHERE 1=1

		<choose>
		  <!-- 1) salesCd, ordrsClntNm, clntPjt 모두 비었을 때만 "오늘 포함" 조건 적용 -->
		  <when test="(salesCd == null or salesCd == '') 
		          and (ordrsClntNm == null or ordrsClntNm == '') 
		          and (clntPjt == null or clntPjt == '')">
		    AND R.SALES_START <![CDATA[<]]> TRUNC(SYSDATE)
		    AND R.SALES_END   <![CDATA[>]]> TRUNC(SYSDATE)
		  </when>
		
		  <!-- 2) 하나라도 값이 있으면 해당 값 기준으로만 필터 -->
		  <otherwise>
		
		    <if test="ordrsClntNm != null and ordrsClntNm != ''">
		      AND S.CLNT_NM LIKE '%' || #{ordrsClntNm} || '%'
		    </if>
		
		    <if test="clntPjt != null and clntPjt != ''">
		      AND S.CLNT_PJT = #{clntPjt}
		    </if>
		  </otherwise>
		</choose>
		ORDER BY
			F.CO_CD,
			F.SALES_CD,
			F.WBS_PLANS_DT_FM,
			F.DEPT_ID

    </select>
    
    

	<update id="updateWbsRemarks" parameterType="Map">
		UPDATE TB_WB21M01
		SET    WBS_REMARK = #{remarks, jdbcType=VARCHAR}
			 , UDT_ID   = #{userId}
			 , UDT_PGM  = #{pgmId}
			 , UDT_DTTM = SYSDATE
		WHERE  FILE_TRGT_KEY = #{sjFileTrgtKey}
	</update>

	<insert id="insertWbsScheduleHIST" parameterType="Map">
		INSERT INTO TB_WB22M01_HIST
		SELECT FILE_TRGT_KEY, 	CO_CD, 				WBS_PLAN_NO,	 	WBS_PLAN_CODE_KIND, 	WBS_PLAN_CODE_ID, 	WBS_PLAN_CODE_NM, 	VER_NO, 
			   SALES_CD, 		SEQ, 				WBS_PLAN_MNG_ID, 	WBS_PLANS_DT, 			WBS_PLANE_DT, 		DAYCNT, 			WBS_PLAN_STS_CODE_ID, 
			   LOCK_YN, 		CLOSE_YN, 			CLOSE_ID, 			CLOSE_DTTM,             EXPECT_MH, 			CHG_REQ_STR_DT, 	CHG_REQ_END_DT, 
			   CHG_REASON, 		CHG_REQ_USER_ID, 	CHG_REQ_STATUS, 	CHG_REQ_APPLY_DT, 		VER_UP_REASON, 		CREAT_ID, 			CREAT_PGM, 
			   CREAT_DTTM, 		UDT_ID, 			UDT_PGM, 			UDT_DTTM
		 FROM   TB_WB22M01
		WHERE  CO_CD = #{coCd}
		  AND  SALES_CD = #{salesCd}
		  AND  CLOSE_YN = 'Y'
	</insert>

	<update id="updateWbsScheduleVersionUp" parameterType="Map">
		UPDATE TB_WB22M01
		SET    VER_NO = TO_CHAR(TO_NUMBER(NVL(VER_NO, '0')) + 1)
			 , UDT_ID = #{userId}
			 , UDT_PGM = #{pgmId}
			 , UDT_DTTM = SYSDATE
		WHERE  CO_CD = #{coCd}
		  AND  SALES_CD = #{salesCd}
	</update>

	<update id="updateWbsSchedule" parameterType="Map">
		UPDATE TB_WB22M01
		SET    WBS_PLANS_DT = TO_DATE(#{wbsPlansDtFm}, 'YYYY-MM-DD')
			 , WBS_PLANE_DT = TO_DATE(#{wbsPlaneDtFm}, 'YYYY-MM-DD')
			 , UDT_ID = #{userId}
			 , UDT_PGM = #{pgmId}
			 , UDT_DTTM = SYSDATE
		WHERE  FILE_TRGT_KEY = #{fileTrgtKey}
	</update>
</mapper>
