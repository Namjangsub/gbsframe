<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.qm.qm01.mapper.QM01Mapper">

	<select id="selectQualityReqCount" parameterType="Map" resultType="int">
		SELECT COUNT(*)   
		FROM TB_QM01M01 T
		 LEFT OUTER JOIN TB_QM01P01 P ON P.REQ_NO = T.REQ_NO
		 LEFT OUTER JOIN TB_CR02D02 S ON T.SALES_CD = S.SALES_CD  
		 LEFT OUTER JOIN TB_CR02M01 SM ON S.CO_CD =  SM.CO_CD  AND S.ORDRS_NO = SM.ORDRS_NO
		 LEFT OUTER JOIN TB_BM01M01 B ON S.PRDT_CD = B.PRDT_CD  
		 LEFT OUTER JOIN TB_CM05M01 C ON C.CODE_ID  = T.REQ_ST AND C.USE_YN='Y' AND C.CODE_KIND = 'REQST'       
		 LEFT OUTER JOIN TB_CM05M01 C1 ON C1.CODE_ID = T.BUST_CD AND C1.USE_YN='Y' AND C1.CODE_KIND = 'BUSTCD' 
		 LEFT OUTER JOIN TB_CM05M01 C2 ON C2.CODE_ID = T.INWK_CD AND C2.USE_YN='Y' AND C2.CODE_KIND = 'INWKCD'		
		 LEFT OUTER JOIN TB_CM05M01 C3 ON C3.CODE_ID = T.DEPT_CD AND C3.USE_YN='Y' AND C3.CODE_KIND = 'COBGB'
		 LEFT OUTER JOIN TB_CM05M01 C4 ON C4.CODE_ID = T.MID_CD AND C4.USE_YN='Y' 
		 LEFT OUTER JOIN TB_CM05M01 C5 ON C5.CODE_ID = T.SUB_CD AND C5.USE_YN='Y' 	
		 LEFT OUTER JOIN TB_CM05M01 C6 ON C6.CODE_ID = T.PART_CD AND C6.USE_YN='Y' AND C6.CODE_KIND = 'COBTP'	 
		 LEFT OUTER JOIN TB_CM06M01 N1 ON N1.ID = T.REG_ID  AND N1.CO_CD =  T.CO_CD
		 LEFT OUTER JOIN TB_CM06M01 N2 ON N2.ID = T.ORDRG_ID  AND N2.CO_CD =  T.CO_CD
		 LEFT OUTER JOIN TB_CM06M01 N3 ON N3.ID = T.CREAT_ID  AND N3.CO_CD =  T.CO_CD
		 WHERE 1=1 
		<if test="coCd !=null and !coCd.equals('')">
		  AND T.CO_CD = #{coCd}
		 </if>
		 <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')" >
          AND T.ORDRG_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYY-MM-DD') AND TO_DATE( #{reqDtTo},'YYYY-MM-DD') +1
         </if>
         <if test="ordrgId !=null and !ordrgId.equals('')">
          AND T.ORDRG_ID = #{ordrgId}
         </if>
         <if test="salesCd !=null and !salesCd.equals('')">
          AND T.SALES_CD  LIKE '%${salesCd}%'
         </if>
         <!-- <if test="prdtCd !=null and !prdtCd.equals('')">
     	  AND S.PRDT_CD = #{prdtCd}
         </if>-->
         <if test="prdtCd !=null and !prdtCd.equals('')">
          AND B.PRDT_GRP = #{prdtCd}
         </if>         	
         <if test="prdtNm !=null and !prdtNm.equals('')">
          AND P.PRDT_NM LIKE '%${prdtNm}%'
         </if>
         <if test="itemCd !=null and !itemCd.equals('')">
          AND S.ITEM_DIV = #{itemCd}
         </if>
         <if test="sharId !=null and !sharId.equals('')">
          AND (T.SHAR_ID1 = #{sharId}           
                OR T.SHAR_ID2 = #{sharId} 
                OR T.SHAR_ID3 = #{sharId} 
                OR T.SHAR_ID4 = #{sharId} 
                OR T.SHAR_ID5 = #{sharId} 
                OR T.SHAR_ID6 = #{sharId} 
                OR T.SHAR_ID7 = #{sharId} 
                OR T.SHAR_ID8 = #{sharId} 
                OR T.SHAR_ID9 = #{sharId} 
                OR T.SHAR_ID10 = #{sharId} ) 
         </if>
        <if test="clntPjt !=null and !clntPjt.equals('')">
          AND T.PROJ_NM LIKE '%${clntPjt}%' 
        </if>
        <if test="eqpNm !=null and !eqpNm.equals('')">
          AND S.EQP_NM  LIKE '%${eqpNm}%'  
        </if>
        <if test="clntCd !=null and !clntCd.equals('')">
          AND T.EST_CLNT_CD = #{clntCd}
        </if> 
        <if test="partCd !=null and !partCd.equals('')">
          AND T.PART_CD = #{partCd}
        </if>  
	</select>
	
	<select id="selectQualityReqList" parameterType="Map" resultType="CamelMap">	
	   SELECT *
	   FROM(
		SELECT
			ROWNUM AS RNUM, A.*
		FROM
		(
	   SELECT     T.FILE_TRGT_KEY AS FILE_TRGT_KEY, 
		          T.CO_CD AS CO_CD,  
		          T.REQ_NO AS REQ_NO,
		          P.RSLT_NO AS RSLT_NO,             
		          T.INWK_CD AS INWK_CD, 
		          T.BUST_CD AS BUST_CD, 
		          NVL(T.SALES_CD,' ') AS SALES_CD,
		          T.REQ_ST AS REQ_ST,
		          T.REQ_CD AS REQ_CD, 
		          T.REG_ID AS REQ_ID, 
		          T.ORDRG_ID AS ORDRG_ID, 
		          T.DEPT_CD AS DEPT_CD, 
		          T.MID_CD AS MID_CD,
		          T.SUB_CD AS SUB_CD,
		          T.STAT_YM,	
		          SM.ORDRS_CLNT_CD AS CLNT_CD,
		          P.CREAT_ID AS CREAT_ID,
		          T.PART_CD AS COBTB_CD, 
		          S.ITEM_DIV AS ITEM_DIV,
		          FN_CM05M01_CD_TO_NM(S.ITEM_DIV) AS ITEM_DIV_NM,
		          S.PRDT_CD AS PRDT_CD1,
		          B.PRDT_GRP AS PRDT_CD,	
		          TO_CHAR(T.ORDRG_DT, 'YYYY-MM-DD') AS ORDRG_DT,
		          T.RSLT_YN AS RSLT_YN,
		          DECODE(T.REQ_CD,'REQCD01','Y',' ') AS REQ_1YN,
		          DECODE(T.REQ_CD,'REQCD02','Y',' ') AS REQ_2YN, 
		          CASE WHEN (T.INWK_CD = 'INWK01' OR INWK_CD = 'INWK02') THEN 'Y' ELSE ' ' END AS INWK_YN,
		          NVL(C1.CODE_NM,' ') AS BUST_NM,
		          NVL(C2.CODE_NM,' ') AS INWK_NM,   
				  N1.NAME AS REG_NM,
				  N2.NAME AS ORDRG_NM,
			      C3.CODE_NM AS DEPT_NM,
				  C4.CODE_NM AS MID_NM,
				  C5.CODE_NM AS SUB_NM,
		          CT.CLNT_NM AS CLNT_NM, 
		          SM.CLNT_PJT AS CLNT_PJT, 
		          T.SALES_CD AS MATR_DRW_NO, 
		          NVL(S.EQP_NM,' ') AS EQP_NM, 		         
		          C6.CODE_NM AS PART_NM,            
		          C.CODE_NM AS CODE_NM, 
		          T.REQ_RMK AS REQ_RMK, 
		          TO_CHAR(P.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM,
		          N3.NAME AS CREAT_NM,    
		          NVL(P.RESLT_RST,' ')  AS RESLT_RST,
		          NVL(P.SUB_CD, '') AS RESLT_SUB_CD
		FROM TB_QM01M01 T
		 LEFT OUTER JOIN TB_QM01P01 P ON P.REQ_NO = T.REQ_NO
		 LEFT OUTER JOIN TB_CR02D02 S ON T.SALES_CD = S.SALES_CD  
		 LEFT OUTER JOIN TB_CR02M01 SM ON S.CO_CD =  SM.CO_CD  AND S.ORDRS_NO = SM.ORDRS_NO
		 LEFT OUTER JOIN TB_BM01M01 B ON S.PRDT_CD = B.PRDT_CD  
		 LEFT OUTER JOIN TB_CM05M01 C ON C.CODE_ID  = T.REQ_ST AND C.USE_YN='Y' AND C.CODE_KIND = 'REQST'       
		 LEFT OUTER JOIN TB_CM05M01 C1 ON C1.CODE_ID = T.BUST_CD AND C1.USE_YN='Y' AND C1.CODE_KIND = 'BUSTCD' 
		 LEFT OUTER JOIN TB_CM05M01 C2 ON C2.CODE_ID = T.INWK_CD AND C2.USE_YN='Y' AND C2.CODE_KIND = 'INWKCD'		
		 LEFT OUTER JOIN TB_CM05M01 C3 ON C3.CODE_ID = T.DEPT_CD AND C3.USE_YN='Y' AND C3.CODE_KIND = 'COBGB'
		 LEFT OUTER JOIN TB_CM05M01 C4 ON C4.CODE_ID = T.MID_CD AND C4.USE_YN='Y' 
		 LEFT OUTER JOIN TB_CM05M01 C5 ON C5.CODE_ID = T.SUB_CD AND C5.USE_YN='Y' 	
		 LEFT OUTER JOIN TB_CM05M01 C6 ON C6.CODE_ID = T.PART_CD AND C6.USE_YN='Y' AND C6.CODE_KIND = 'COBTP'	 
		 LEFT OUTER JOIN TB_CM06M01 N1 ON N1.ID = T.REG_ID  AND N1.CO_CD =  T.CO_CD
		 LEFT OUTER JOIN TB_CM06M01 N2 ON N2.ID = T.ORDRG_ID  AND N2.CO_CD =  T.CO_CD
		 LEFT OUTER JOIN TB_CM06M01 N3 ON N3.ID = T.CREAT_ID  AND N3.CO_CD =  T.CO_CD		 
		 LEFT OUTER JOIN TB_BM02M01 CT ON CT.CLNT_CD = SM.ORDRS_CLNT_CD AND CT.USE_YN = 'Y' 
		 WHERE 1=1  
		<if test="coCd !=null and !coCd.equals('')">
		  AND T.CO_CD = #{coCd}
		 </if>
		 <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')" >
          AND T.ORDRG_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYY-MM-DD') AND TO_DATE( #{reqDtTo},'YYYY-MM-DD') +1
         </if>
         <if test="ordrgId !=null and !ordrgId.equals('')">
          AND T.ORDRG_ID = #{ordrgId}
         </if>
         <if test="salesCd !=null and !salesCd.equals('')">
          AND T.SALES_CD  LIKE '%${salesCd}%'
         </if>
         <!-- <if test="prdtCd !=null and !prdtCd.equals('')">
     	  AND S.PRDT_CD = #{prdtCd}
         </if>-->
         <if test="prdtCd !=null and !prdtCd.equals('')">
          AND B.PRDT_GRP = #{prdtCd}
         </if>         	
         <if test="prdtNm !=null and !prdtNm.equals('')">
          AND P.PRDT_NM LIKE '%${prdtNm}%'
         </if>
         <if test="itemCd !=null and !itemCd.equals('')">
          AND S.ITEM_DIV = #{itemCd}
         </if>
        <if test="clntPjt !=null and !clntPjt.equals('')">
          AND T.PROJ_NM LIKE '%${clntPjt}%' 
        </if>
        <if test="eqpNm !=null and !eqpNm.equals('')">
          AND S.EQP_NM  LIKE '%${eqpNm}%'  
        </if>
        <if test="clntCd !=null and !clntCd.equals('')">
          AND T.EST_CLNT_CD = #{clntCd}
        </if> 
        <if test="partCd !=null and !partCd.equals('')">
          AND T.PART_CD = #{partCd}
        </if>  
          <!--ORDER BY T.CO_CD, T.REQ_NO-->
            ORDER BY T.REQ_NO DESC
		 ) AS a
		) A
	  WHERE  RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>
	
	<select id="selectQualityReqExList" parameterType="Map" resultType="camelMap"> 	 
	     SELECT     T.FILE_TRGT_KEY AS FILE_TRGT_KEY, 
		          T.CO_CD AS CO_CD,  
		          T.REQ_NO AS REQ_NO,         
		          T.INWK_CD AS INWK_CD, 
		          T.BUST_CD AS BUST_CD, 
		          NVL(T.SALES_CD,' ') AS SALES_CD,
		          T.REQ_ST AS REQ_ST,
		          T.REQ_CD AS REQ_CD, 
		          T.REG_ID AS REQ_ID, 
		          T.ORDRG_ID AS ORDRG_ID, 
		          T.DEPT_CD AS DEPT_CD, 
		          T.MID_CD AS MID_CD,
		          T.SUB_CD AS SUB_CD,	
		          T.EST_CLNT_CD AS CLNT_CD,
		          P.CREAT_ID AS CREAT_ID,
		          T.PART_CD AS COBTB_CD, 
		          S.ITEM_DIV AS ITEM_DIV,
		          FN_CM05M01_CD_TO_NM(S.ITEM_DIV) AS ITEM_DIV_NM,
		          S.PRDT_CD AS PRDT_CD1,
		          B.PRDT_GRP AS PRDT_CD,	
		          TO_CHAR(T.ORDRG_DT, 'YYYY-MM-DD') AS ORDRG_DT,
		          T.RSLT_YN AS RSLT_YN,
		          DECODE(T.REQ_CD,'REQCD01','Y',' ') AS REQ_1YN,
		          DECODE(T.REQ_CD,'REQCD02','Y',' ') AS REQ_2YN, 
		          CASE WHEN (T.INWK_CD = 'INWK01' OR INWK_CD = 'INWK02') THEN 'Y' ELSE ' ' END AS INWK_YN,
		          NVL(C1.CODE_NM,' ') AS BUST_NM,
		          NVL(C2.CODE_NM,' ') AS INWK_NM,   
				  N1.NAME AS REG_NM,
				  N2.NAME AS ORDRG_NM,
			      C3.CODE_NM AS DEPT_NM,
				  C4.CODE_NM AS MID_NM,
				  C5.CODE_NM AS SUB_NM,
		          CT.CLNT_NM AS CLNT_NM, 
		          T.PROJ_NM AS CLNT_PJT, 
		          T.MATR_DRW_NO AS MATR_DRW_NO, 
		          NVL(S.EQP_NM,' ') AS EQP_NM, 		         
		          C6.CODE_NM AS PART_NM,            
		          C.CODE_NM AS CODE_NM, 
		          T.REQ_RMK AS REQ_RMK, 
		          P.CREAT_DTTM AS CREAT_DTTM,
		          N3.NAME AS CREAT_NM,    
		          NVL(P.RESLT_RST,' ')  AS RESLT_RST
		FROM TB_QM01M01 T
		 LEFT OUTER JOIN TB_QM01P01 P ON P.REQ_NO = T.REQ_NO
		 LEFT OUTER JOIN TB_CR02D02 S ON T.SALES_CD = S.SALES_CD  ----수주상세(Sales Code)
		 LEFT OUTER JOIN TB_CR02M01 SM ON S.CO_CD =  SM.CO_CD  AND S.ORDRS_NO = SM.ORDRS_NO
		 LEFT OUTER JOIN TB_BM01M01 B ON S.PRDT_CD = B.PRDT_CD  
		 LEFT OUTER JOIN TB_CM05M01 C ON C.CODE_ID  = T.REQ_ST AND C.USE_YN='Y' AND C.CODE_KIND = 'REQST'       
		 LEFT OUTER JOIN TB_CM05M01 C1 ON C1.CODE_ID = T.BUST_CD AND C1.USE_YN='Y' AND C1.CODE_KIND = 'BUSTCD' 
		 LEFT OUTER JOIN TB_CM05M01 C2 ON C2.CODE_ID = T.INWK_CD AND C2.USE_YN='Y' AND C2.CODE_KIND = 'INWKCD'		
		 LEFT OUTER JOIN TB_CM05M01 C3 ON C3.CODE_ID = T.DEPT_CD AND C3.USE_YN='Y' AND C3.CODE_KIND = 'COBGB'
		 LEFT OUTER JOIN TB_CM05M01 C4 ON C4.CODE_ID = T.MID_CD AND C4.USE_YN='Y' 
		 LEFT OUTER JOIN TB_CM05M01 C5 ON C5.CODE_ID = T.SUB_CD AND C5.USE_YN='Y' 	
		 LEFT OUTER JOIN TB_CM05M01 C6 ON C6.CODE_ID = T.PART_CD AND C6.USE_YN='Y' AND C6.CODE_KIND = 'COBTP'	 
		 LEFT OUTER JOIN TB_CM06M01 N1 ON N1.ID = T.REG_ID  AND N1.CO_CD =  T.CO_CD
		 LEFT OUTER JOIN TB_CM06M01 N2 ON N2.ID = T.ORDRG_ID  AND N2.CO_CD =  T.CO_CD
		 LEFT OUTER JOIN TB_CM06M01 N3 ON N3.ID = T.CREAT_ID  AND N3.CO_CD =  T.CO_CD
		 LEFT OUTER JOIN TB_BM02M01 CT ON CT.CLNT_CD = T.EST_CLNT_CD AND CT.USE_YN = 'Y' 
		 WHERE 1=1 
		<if test="coCd !=null and !coCd.equals('')">
		  AND T.CO_CD = #{coCd}
		 </if>
		 <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')" >
          AND T.ORDRG_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYY-MM-DD') AND TO_DATE( #{reqDtTo},'YYYY-MM-DD') +1
         </if>
         <if test="ordrgId !=null and !ordrgId.equals('')">
          AND T.ORDRG_ID = #{ordrgId}
         </if>
         <if test="salesCd !=null and !salesCd.equals('')">
          AND T.SALES_CD  LIKE '%${salesCd}%'
         </if>
         <!-- <if test="prdtCd !=null and !prdtCd.equals('')">
     	  AND S.PRDT_CD = #{prdtCd}
         </if>-->
         <if test="prdtCd !=null and !prdtCd.equals('')">
          AND B.PRDT_GRP = #{prdtCd}
         </if>         	
         <if test="prdtNm !=null and !prdtNm.equals('')">
          AND P.PRDT_NM LIKE '%${prdtNm}%'
         </if>
         <if test="itemCd !=null and !itemCd.equals('')">
          AND S.ITEM_DIV = #{itemCd}
         </if>
        <if test="clntPjt !=null and !clntPjt.equals('')">
          AND T.PROJ_NM LIKE '%${clntPjt}%' 
        </if>
        <if test="eqpNm !=null and !eqpNm.equals('')">
          AND S.EQP_NM  LIKE '%${eqpNm}%'  
        </if>
        <if test="clntCd !=null and !clntCd.equals('')">
          AND T.EST_CLNT_CD = #{clntCd}
        </if> 
        <if test="partCd !=null and !partCd.equals('')">
          AND T.PART_CD = #{partCd}
        </if>  
          ORDER BY T.CO_CD, T.REQ_NO
  </select>
  
  <select id="selectQtyReqInfo" resultType="CamelMap">
   SELECT  T.CO_CD AS CO_CD 
           ,(SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.CO_CD) AS CO_NM 
          ,T.REQ_NO AS REQ_NO 
          ,TO_CHAR(T.ORDRG_DT, 'YYYY-MM-DD') AS ORDRG_DT 
          ,T.ORDRG_ID AS ORDRG_ID 
	      ,N2.NAME AS ORDRG_NM 
          ,T.REG_ID AS REG_ID 
          ,N1.NAME AS REG_NM 
          ,T.SALES_CD AS SALES_CD 
          ,T.SALES_CD AS MATR_DRW_NO 
          ,SM.ORDRS_CLNT_CD  AS CLNT_CD 
          ,CT.CLNT_NM AS CLNT_NM 
          ,SM.CLNT_PJT AS CLNT_PJT 
          --,T.NEW_CD AS NEW_CD  
          ,T.REQ_CD AS REQ_CD
          , (SELECT FN_CM05M01_CD_TO_NM(T.REQ_CD) FROM DUAL) AS REQ_CD_NM
          ,TO_CHAR(T.REQ_DT, 'YYYY-MM-DD') AS REQ_DT 
          ,S.ORDRS_NO AS ORDRS_NO 
          ,SM.CTRT_NM AS PROJ_NM 
          ,T.BUST_CD AS BUST_CD
          , (SELECT FN_CM05M01_CD_TO_NM(T.BUST_CD) FROM DUAL) AS BUST_CD_NM 
          ,T.BUST_NM AS BUST_NM 
          ,T.INWK_CD AS  INWK_CD 
          , (SELECT FN_CM05M01_CD_TO_NM(T.INWK_CD) FROM DUAL) AS INWK_CD_NM
          ,T.BUST_PE AS BUST_PE 
          ,T.PART_CD AS PART_CD
          , (SELECT FN_CM05M01_CD_TO_NM(T.PART_CD) FROM DUAL) AS PART_CD_NM
          ,T.DEPT_CD AS DEPT_CD
          , (SELECT FN_CM05M01_CD_TO_NM(T.DEPT_CD) FROM DUAL) AS DEPT_NM
          ,T.DEPT_CD2 AS DEPT_CD2
          , (SELECT FN_CM05M01_CD_TO_NM(T.DEPT_CD2) FROM DUAL) AS DEPT2_NM
          ,T.MID_CD AS MID_CD
          , (SELECT FN_CM05M01_CD_TO_NM(T.MID_CD) FROM DUAL) AS MID_NM
          ,T.SUB_CD AS SUB_CD
          , (SELECT FN_CM05M01_CD_TO_NM(T.SUB_CD) FROM DUAL) AS SUB_CD_NM
          ,T.REQ_RMK AS REQ_RMK
          ,T.FILE_TRGT_KEY
          , S.ORDRS_DTL_DIV20 AS ORDRS_DTL_DIV20
          , (SELECT FN_CM05M01_CD_TO_NM(S.ordrs_dtl_div20) FROM DUAL) AS NEW_CD  
	FROM TB_QM01M01 T
	LEFT OUTER JOIN TB_CM06M01 N1 ON N1.ID = T.REG_ID  AND N1.CO_CD =  T.CO_CD
	LEFT OUTER JOIN TB_CM06M01 N2 ON N2.ID = T.ORDRG_ID  AND N2.CO_CD =  T.CO_CD
	LEFT OUTER JOIN TB_CR02D02 S ON T.SALES_CD = S.SALES_CD  
    LEFT OUTER JOIN TB_CR02M01 SM ON S.CO_CD = SM.CO_CD  AND S.ORDRS_NO = SM.ORDRS_NO
	LEFT OUTER JOIN TB_BM02M01 CT ON CT.CLNT_CD = SM.ORDRS_CLNT_CD AND CT.USE_YN = 'Y'
	WHERE T.FILE_TRGT_KEY = #{fileTrgtKey}
 </select>
 
 <select id="selectQtyReqRespInfo" resultType="CamelMap">
   SELECT  T.CO_CD AS CO_CD 
          ,(SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.CO_CD) AS CO_NM 
          ,T.REQ_NO AS REQ_NO 
          ,TO_CHAR(T.ORDRG_DT, 'YYYY-MM-DD') AS ORDRG_DT 
          ,T.ORDRG_ID AS ORDRG_ID 
	      ,N2.NAME AS ORDRG_NM 
          ,T.REG_ID AS REG_ID 
          ,N1.NAME AS REG_NM 
          ,T.SALES_CD AS SALES_CD 
          ,T.MATR_DRW_NO AS MATR_DRW_NO 
          ,T.EST_CLNT_CD  AS CLNT_CD 
          ,CT.CLNT_NM AS CLNT_NM 
          ,T.CLNT_PJT AS CLNT_PJT 
          ,T.NEW_CD AS NEW_CD  
          ,T.REQ_CD AS REQ_CD
          ,(SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.REQ_CD) AS REQ_CD_NM 
          ,TO_CHAR(T.REQ_DT, 'YYYY-MM-DD') AS REQ_DT 
          ,T.ORDRS_NO AS ORDRS_NO 
          ,T.PROJ_NM AS PROJ_NM 
          ,T.BUST_CD AS BUST_CD
          ,(SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.BUST_CD) AS BUST_CD_NM  
          ,T.BUST_NM AS BUST_NM 
          ,T.INWK_CD AS  INWK_CD 
          ,(SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.INWK_CD) AS INWK_CD_NM 
          ,T.BUST_PE AS BUST_PE 
          ,T.PART_CD AS PART_CD 
          ,(SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = T.PART_CD) AS PART_CD_NM 
          ,T.DEPT_CD AS DEPT_CD 
          ,T.DEPT_CD2 AS DEPT_CD2 
          ,T.MID_CD AS MID_CD
          ,T.SUB_CD AS SUB_CD
          ,(SELECT A.CODE_NM
			FROM TB_CM05M01 A
			WHERE  A.CODE_ID = T.DEPT_CD AND USE_YN = 'Y')AS DEPT_NM1
		  ,(SELECT A.CODE_NM
			FROM TB_CM05M01 A
			WHERE  A.CODE_ID = T.DEPT_CD2 AND USE_YN = 'Y')AS DEPT_NM2   
		  ,(SELECT A.CODE_NM
			FROM TB_CM05M01 A
			WHERE  A.CODE_ID = T.MID_CD AND USE_YN = 'Y')AS MID_NM  	  
		  ,(SELECT A.CODE_NM
			FROM TB_CM05M01 A
			WHERE  A.CODE_ID = T.SUB_CD AND USE_YN = 'Y')AS SUB_NM
          ,T.REQ_RMK AS REQ_RMK
          ,T.FILE_TRGT_KEY
          ,P.CO_CD AS RES_CO_CD
         <!-- ,P.REQ_NO AS RES_REQ_NO-->
          ,P.RSLT_NO AS RSLT_NO
          ,TO_CHAR(P.RSLT_DT, 'YYYY-MM-DD') AS RSLT_DT 
          ,P.CREAT_ID AS RES_REG_ID
          ,(SELECT NAME FROM TB_CM06M01 X WHERE X.ID = P.CREAT_ID) AS RES_REG_NM
          ,P.DEPT_CD AS RES_DEPT_CD 
          ,(SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = P.DEPT_CD) AS RES_DEPT_NM
          ,P.DEPT_CD2 AS RES_DEPT_CD2 
          ,(SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = P.DEPT_CD2) AS RES_DEPT2_NM
          ,P.MID_CD AS RES_MID_CD
          ,(SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = P.MID_CD) AS RES_MID_NM
          ,P.SUB_CD AS RES_SUB_CD
          ,(SELECT X.CODE_NM FROM TB_CM05M01 X WHERE X.CODE_ID = P.SUB_CD) AS RES_SUB_NM
          ,P.RSLT_RMK AS RSLT_RMK
          ,P.MEAS_RST AS MEAS_RST
          ,P.RESLT_RST AS RESLT_RST
          ,P.THGH_RST AS THGH_RST
          ,P.SIGN_ID1 AS SIGN_ID1
          ,P.SIGN_ID2 AS SIGN_ID2
          ,P.SIGN_ID3 AS SIGN_ID3
          ,P.SIGN_ID4 AS SIGN_ID4
          ,P.SIGN_ID5 AS SIGN_ID5
          ,P.SIGN_ID6 AS SIGN_ID6
          ,P.SIGN_ID7 AS SIGN_ID7
          ,P.SIGN_ID8 AS SIGN_ID8
          ,P.SIGN_ID9 AS SIGN_ID9
          ,P.SIGN_ID10 AS SIGN_ID10
          ,P.SHAR_ID1 AS SHAR_ID1
          ,P.SHAR_ID2 AS SHAR_ID2
          ,P.SHAR_ID3 AS SHAR_ID3
          ,P.SHAR_ID4 AS SHAR_ID4
          ,P.SHAR_ID5 AS SHAR_ID5
          ,P.SHAR_ID6 AS SHAR_ID6
          ,P.SHAR_ID7 AS SHAR_ID7
          ,P.SHAR_ID8 AS SHAR_ID8
          ,P.SHAR_ID9 AS SHAR_ID9
          ,P.SHAR_ID10 AS SHAR_ID10
	FROM TB_QM01M01 T
	LEFT OUTER JOIN TB_QM01P01 P ON P.REQ_NO = T.REQ_NO
	LEFT OUTER JOIN TB_CM06M01 N1 ON N1.ID = T.REG_ID  AND N1.CO_CD =  T.CO_CD
	LEFT OUTER JOIN TB_CM06M01 N2 ON N2.ID = T.ORDRG_ID  AND N2.CO_CD =  T.CO_CD
	LEFT OUTER JOIN TB_BM02M01 CT ON CT.CLNT_CD = T.EST_CLNT_CD AND CT.USE_YN = 'Y' 	
	WHERE FILE_TRGT_KEY = #{fileTrgtKey}
 </select>
	
<select id="selectShareUserlst" parameterType="Map" resultType="camelMap"> 
 SELECT *
   FROM(
	SELECT
		ROWNUM AS RNUM, A.*
	FROM
	(
		SELECT   A.CO_CD AS WBS_PLANCO_CD,
				 FN_CM05M01_CD_TO_NM(A.CO_CD) WBS_PLANCO_CD_NM,
		         A.ID AS USR_NM,
		         A.EMP_NO AS EMP_NO,
				 A.NAME AS NAME,
				 A.TEL_NO AS TEL_NO,
				 A.EMAIL AS EMAIL,
				 B.DEPT_NM AS DT_NM,
				 D.LEVEL_NM AS JIK,
				 C.TODO_DIV1_CODE_ID  AS TODO_DIV1_CODE_ID,
				 DECODE(C.TODO_DIV1_CODE_ID, 'TODODIV10', '공유', 'TODODIV20', '결재', '') AS GB
		FROM
			TB_CM06M01 A
			LEFT OUTER JOIN TB_CM07M01 D ON A.LEVEL_CD = D.LEVEL_CD 
			INNER JOIN TB_CM04M01 B on A.DEPT_ID = B.DEPT_ID
			INNER JOIN TB_WB20M03 C ON A.ID = C.TODO_ID
			  AND C.TODO_FILE_TRGT_KEY = #{fileTrgtKey}
			  AND C.TODO_NO = #{reqNo}
		) AS a
  ) A
</select>

<select id="selectSignResCount" parameterType="Map" resultType="int">
		SELECT
			COUNT(*)
		FROM
		(
           	SELECT   A.CO_CD AS CO_CD,
			         A.ID AS ID,
			         A.EMP_NO AS EMP_NO,
					 A.NAME AS USR_NM,
					 A.TEL_NO AS TEL_NO,
					 A.EMAIL AS E_MAIL,
					 B.DEPT_NM AS DT_NM,
					 C.TODO_NO AS RSLT_NO
				<!-- C.REQ_NO AS RES_REQ_NO-->
			FROM
				TB_CM06M01 A 
				INNER JOIN TB_CM04M01 B on A.DEPT_ID = B.DEPT_ID
				INNER JOIN TB_WB20M03 C on A.ID = C.TODO_ID
		    AND C.TODO_NO = #{rsltNo}
		    AND C.TODO_DIV1_CODE_ID = 'TODODIV20'
		    AND C.TODO_DIV2_CODE_ID = 'TODODIV2020'
		 <!--  AND C.REQ_NO= #{reqNo}--> 
		 ) A
		 
		 
</select>

<select id="selectSignResUserlst" parameterType="Map" resultType="camelMap"> 
  SELECT *
   FROM(
	SELECT
		ROWNUM AS RNUM, A.*
	FROM
	(
		SELECT   A.CO_CD AS CO_CD,
		         A.ID AS WBS_SHARNG_USER_ID,
		         A.EMP_NO AS EMP_NO,
				 A.NAME AS USR_NM,
				 A.TEL_NO AS TEL_NO,
				 A.EMAIL AS E_MAIL,
				 B.DEPT_NM AS DT_NM,
				 C.TODO_NO AS RSLT_NO
		FROM
			TB_CM06M01 A 
			INNER JOIN TB_CM04M01 B on A.DEPT_ID = B.DEPT_ID
			INNER JOIN TB_WB20M03 C ON A.ID = C.TODO_ID	
		    AND C.TODO_NO = #{rsltNo}
		    AND C.TODO_DIV1_CODE_ID = 'TODODIV20'
		    AND C.TODO_DIV2_CODE_ID = 'TODODIV2020'
		) AS a
  ) A
</select>

<select id="selectShareResUserlst" parameterType="Map" resultType="camelMap"> 
  SELECT *
   FROM(
	SELECT
		ROWNUM AS RNUM, A.*
	FROM
	(
		SELECT   A.CO_CD AS CO_CD,
		         A.ID AS WBS_SHARNG_USER_ID,
		         A.EMP_NO AS EMP_NO,
				 A.NAME AS USR_NM,
				 A.TEL_NO AS TEL_NO,
				 A.EMAIL AS E_MAIL,
				 B.DEPT_NM AS DT_NM,
				 C.TODO_NO AS RSLT_NO
		FROM
			TB_CM06M01 A 
			INNER JOIN TB_CM04M01 B on A.DEPT_ID = B.DEPT_ID
			INNER JOIN TB_WB20M03 C ON A.ID = C.TODO_ID	
		    AND C.TODO_NO = #{rsltNo}
		    AND C.TODO_DIV1_CODE_ID = 'TODODIV10'
		    AND C.TODO_DIV2_CODE_ID = 'TODODIV1040'
		) AS a
  ) A
</select>



<select id="selectShareUserCount" parameterType="Map" resultType="int">
		SELECT
			COUNT(*)
		FROM
		(
           SELECT   A.EMP_NO AS EMPNO,
					A.NAME AS USRNM,
					A.TEL_NO AS TELNO,
					A.EMAIL AS EMAIL,
					B.DEPT_NM AS DTNM 
			FROM
				TB_CM06M01 A 
				INNER JOIN TB_CM04M01 B on A.DEPT_ID = B.DEPT_ID
				INNER JOIN TB_WB20M03 C ON A.ID = C.TODO_ID	
			    AND C.TODO_NO = #{reqNo}
			    AND C.TODO_DIV1_CODE_ID = 'TODODIV10'
			    AND C.TODO_DIV2_CODE_ID = 'TODODIV1040'
		 ) A
</select>

<select id="selectSignUserCount" parameterType="Map" resultType="int">
		SELECT
			COUNT(*)
		FROM
		(
           	SELECT   A.CO_CD AS CO_CD,
			         A.ID AS ID,
			         A.EMP_NO AS EMP_NO,
					 A.NAME AS USR_NM,
					 A.TEL_NO AS TEL_NO,
					 A.EMAIL AS E_MAIL,
					 B.DEPT_NM AS DT_NM,
					 C.TODO_NO AS RSLT_NO
					 <!-- C.REQ_NO AS RES_REQ_NO-->
			FROM
				TB_CM06M01 A 
				INNER JOIN TB_CM04M01 B on A.DEPT_ID = B.DEPT_ID
				INNER JOIN TB_WB20M03 C ON A.ID = C.TODO_ID	
			    AND C.TODO_NO = #{rsltNo}
			    AND C.TODO_DIV1_CODE_ID = 'TODODIV20'
			    AND C.TODO_DIV2_CODE_ID = 'TODODIV2020'
		  <!-- AND C.REQ_NO= #{reqNo}-->
		 ) A
</select>

<select id="selectShareUserResCount" parameterType="Map" resultType="int">
		SELECT
			COUNT(*)
		FROM
		(
           	SELECT   A.CO_CD AS CO_CD,
			         A.ID AS ID,
			         A.EMP_NO AS EMP_NO,
					 A.NAME AS USR_NM,
					 A.TEL_NO AS TEL_NO,
					 A.EMAIL AS E_MAIL,
					 B.DEPT_NM AS DT_NM,
					 C.TODO_NO AS RSLT_NO
				<!-- C.REQ_NO AS RES_REQ_NO-->
			FROM
				TB_CM06M01 A 
				INNER JOIN TB_CM04M01 B on A.DEPT_ID = B.DEPT_ID
				INNER JOIN TB_WB20M03 C on A.ID = C.TODO_ID
		    AND C.TODO_NO = #{rsltNo}
		    AND C.TODO_DIV1_CODE_ID = 'TODODIV10'
		    AND C.TODO_DIV2_CODE_ID = 'TODODIV1040'
		 <!--  AND C.REQ_NO= #{reqNo}--> 
		 ) A
		 
		 
</select>

<select id="selectSignUserInfo" parameterType="Map" resultType="camelMap">
	  SELECT A.CO_CD AS CO_CD,
		          A.APP_ID AS ID,	
		          B.EMP_NO AS EMP_NO,
		          B.NAME AS USR_NM,
		          B.TEL_NO AS TEL_NO,
		          B.EMAIL AS E_MAIL,
		          B.DEPT_ID AS DT_NM
		FROM TB_BM13M01 A
		LEFT OUTER JOIN TB_CM06M01 B ON A.APP_ID = B.ID AND A.USE_YN = 'Y'
		WHERE 1=1
		AND A.APP_DIV = 'APPDIV02' <!-- 결제선구분 : APPDIV02 발부및 출장요청 결제선 -->
		AND A.CO_CD = '${coCd}'  
		AND A.APP_ID =  '${userId}'  
</select>

<select id="selectConfirmCount" parameterType="Map" resultType="int">
    SELECT COUNT(FILE_TRGT_KEY) CNT
      FROM TB_SM10M01
     WHERE FILE_TRGT_KEY = #{fileTrgtKey}
</select>
  
<update id="updateQualityReq" parameterType="Map">
		UPDATE TB_QM01M01
		SET   BUST_CD = #{bustCd, jdbcType=VARCHAR} /*출장자*/
		     ,BUST_NM = #{bustNm, jdbcType=VARCHAR} /*출장자명*/
		     ,INWK_CD = #{inwkCd, jdbcType=VARCHAR} /*사내작업*/
		     ,BUST_PE = #{bustPe, jdbcType=VARCHAR} /*출장장소*/
		     ,PART_CD = #{COBTP, jdbcType=VARCHAR} /*분류*/
		     ,MID_CD = #{midCd, jdbcType=VARCHAR} /*중분류*/
		     ,SUB_CD = #{CODECOBGB, jdbcType=VARCHAR} /*소분류*/
		     ,REQ_RMK = #{reqRmk, jdbcType=VARCHAR} /*비고*/
		     ,UDT_ID  = #{userId}
			 ,UDT_PGM = #{pgmId}
			 ,UDT_DTTM = SYSDATE
		WHERE FILE_TRGT_KEY = #{fileTrgtKey}
  </update>
  
  <update id="updateQualityResp" parameterType="Map">
    UPDATE TB_QM01P01
	SET CO_CD = #{resCoCd}, 
	    RSLT_DT =  to_date(#{rsltDt}, 'YYYY-MM-DD'),
		DEPT_CD = #{resDeptCd},
		DEPT_CD2 = #{copArr},
		MID_CD = #{resMidCd}, 
		SUB_CD = #{copBgbDiv}, 
		MEAS_RST = #{measRst}, 
		RESLT_RST = #{resltRst}, 
		THGH_RST = #{thghRst}, 
		RSLT_RMK = #{rsltRmk}, 
		CREAT_ID = #{resRegId},<!-- 등록자 아이디 -->
		UDT_ID = #{userId},
		UDT_PGM = #{pgmId},
		UDT_DTTM = SYSDATE
	WHERE RSLT_NO = #{rsltNo}
</update>

  <update id="updateReqRsltChg" parameterType="Map">
	  UPDATE TB_QM01M01
	  SET RSLT_YN = 'Y' <!-- 실적등록 여부 갱신 -->
	  WHERE REQ_NO = #{reqNo}
  </update>

  
  <select id="selectQualityReqSeqNext" parameterType="Map" resultType="int">
		SELECT TB_QM01M01_SQ01.NEXTVAL FROM DUAL
  </select>
  
  <select id="selectQualityReqCalNext" parameterType="Map" resultType="String">
 <!--   SELECT 'REQ' || TO_CHAR(SYSDATE,'YY') || '-' || LPAD(NVL(MAX(REQ_NO),0)+1,4,0) -->
   SELECT CASE WHEN MAX(REQ_NO) IS NULL THEN  'REQ' || TO_CHAR(SYSDATE,'YY') || '00001' 
               ELSE 'REQ' || TO_CHAR(SYSDATE,'YY') || LPAD(SUBSTR(NVL(MAX(REQ_NO),0),7,10)+1,5,0) END AS REQ_NO
   FROM   TB_QM01M01
   WHERE  CO_CD = #{coCd}     
  </select>
  
<insert id="insertQualityReq" parameterType="Map">
   INSERT INTO   TB_QM01M01     
	 (   FILE_TRGT_KEY,
	     REQ_NO,
	     CO_CD,
	     ORDRG_DT,
	     ORDRG_ID,
	     REG_ID,
	     SALES_CD,
	     REQ_CD,
	     REQ_DT, 
	     BUST_CD,
	     BUST_NM,
	     INWK_CD,
	     BUST_PE,
	     PART_CD,
	     REQ_RMK,
	     MID_CD,
	     SUB_CD,
	     CREAT_ID,       
		 CREAT_PGM,      
		 CREAT_DTTM 
	)VALUES(
	     #{fileTrgtKey},
	     #{reqNo},
	     #{coCd},
	     to_date(#{ordrgDt}, 'YYYY-MM-DD'),
	     #{ordrgId},
	     #{regId},
	     #{salesCd},
	     #{reqCd, jdbcType=VARCHAR},
	     to_date(#{reqDt}, 'YYYY-MM-DD'),
	     #{bustCd, jdbcType=VARCHAR},
	     #{bustNm, jdbcType=VARCHAR},
	     #{inwkCd, jdbcType=VARCHAR},
	     #{bustPe, jdbcType=VARCHAR},
	     #{COBTP},
	     #{reqRmk, jdbcType=VARCHAR}, <!--null #{reqRmk, jdbcType=VARCHAR}-->
	     #{midCd},
	     #{CODECOBGB},
	     #{userId},       
		 #{pgmId},      
		 SYSDATE 
	)
 </insert>
  
  <delete id="deleteQualityReq" parameterType="Map">
    DELETE TB_QM01M01 WHERE FILE_TRGT_KEY = #{fileTrgtKey}
  </delete>
  
  <delete id="deleteQualityResp" parameterType="Map">
    DELETE TB_QM01P01 WHERE RSLT_NO = #{rsltNo}
  </delete>
  
  <insert id="insertQualityResp" parameterType="Map">
  INSERT INTO   TB_QM01P01     
(   RSLT_NO, 
	REQ_NO,
	CO_CD,
	RSLT_DT,
	DEPT_CD,
	DEPT_CD2,
	MID_CD,
	SUB_CD,
	MEAS_RST,
	RESLT_RST,
	THGH_RST,
	RSLT_RMK,
	CREAT_ID,
	CREAT_PGM,
	CREAT_DTTM
)VALUES(
    #{rsltNo}, 
	#{resReqNo},  
	#{resCoCd}, 
	to_date(#{rsltDt}, 'YYYY-MM-DD'),
	#{resDeptCd}, 
	#{copArr},  
	#{resMidCd},  
	#{copBgbDiv},   
	#{measRst}, 
	#{resltRst}, 
	#{thghRst}, 
	#{rsltRmk},  
	#{resRegId},
	#{pgmId},    
	SYSDATE
)
  </insert>

  <select id="selectApprovalList" parameterType="Map" resultType="camelMap"> 
   SELECT X.CO_CD, X.APP_ID, X.APP_SEQ, Y.EMP_NO,
          Y.NAME, Y.TEL_NO, Y.EMAIL
           FROM (   
		      SELECT CO_CD, APP_ID, APP_SEQ 
		           FROM TB_BM13M01 
		           WHERE CO_CD = #{coCd} 
		           AND APP_DIV = 'APPDIV02'
		           AND ID = #{userId} ) X
		    INNER JOIN TB_CM06M01 Y
		    ON X.CO_CD = Y.CO_CD
		    AND X.APP_ID = Y.ID       
           ORDER BY X.APP_SEQ ASC
  </select>


  <select id="deleteWbsSharngListChk" parameterType="Map" resultType="camelMap">
               SELECT *  FROM TB_WB20M03
                   WHERE TODO_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND TODO_NO  = #{reqNo}
  </select>    
        
        
  <delete id="deleteWbsSharngList" parameterType="Map">
               DELETE FROM TB_WB20M03
                   WHERE TODO_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND TODO_NO  = #{reqNo}
  </delete>
  
  <select id="deleteWbsApprovalListChk" parameterType="Map" resultType="camelMap">
               SELECT *  FROM TB_WB20M03
                   WHERE TODO_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND TODO_NO  = #{reqNo}
                         AND TODO_DIV1_CODE_ID  = 'TODODIV20'
                         AND TODO_DIV2_CODE_ID  = 'TODODIV2020'
  </select>    
        
        
  <delete id="deleteWbsApprovalList" parameterType="Map">
               DELETE FROM TB_WB20M03
                   WHERE TODO_CO_CD  = #{coCd}
                         AND SALES_CD  = #{salesCd}
                         AND TODO_NO  = #{reqNo}
                         AND TODO_DIV1_CODE_ID  = 'TODODIV20'
                         AND TODO_DIV2_CODE_ID  = 'TODODIV2020'
  </delete>
  
  
  <insert id="insertWbsSharngList" parameterType="Map">
       <selectKey keyProperty="toDoKey" resultType="Int" order="BEFORE">
           SELECT NVL(MAX(TODO_KEY), 0) + 1 FROM TB_WB20M03
       </selectKey>
       INSERT INTO TB_WB20M03
       (
           TODO_KEY,
           SANCTN_SN,
           CO_CD,
           TODO_DIV1_CODE_ID,
           TODO_DIV2_CODE_ID,
           TODO_ID,
           SALES_CD,
           PG_PATH,
           TODO_FILE_TRGT_KEY,
           TODO_CO_CD,
           TODO_NO,
           CREAT_ID,
           CREAT_PGM,
           CREAT_DTTM,
           PG_PARAM          
       ) 
       VALUES
       (
           #{toDoKey},
           #{sanCtnSn},
           #{coCd},
           #{todoDiv1CodeId},
           #{todoDiv2CodeId},
           #{usrNm},
           #{salesCd},
           #{pgPath},
           #{fileTrgtKey},
           #{todoCoCd},
           #{reqNo},
           #{userId},
           #{pgmId},
           SYSDATE,
           #{pgParam}
       )
  </insert>
  
  <insert id="insertWbsApprovalList" parameterType="Map">
        <selectKey keyProperty="toDoKey" resultType="Int" order="BEFORE">
            SELECT NVL(MAX(TODO_KEY), 0) + 1 AS TODO_KEY FROM TB_WB20M03
        </selectKey>
        INSERT INTO TB_WB20M03
        (
            TODO_KEY,
            SANCTN_SN,
            CO_CD,
            TODO_DIV1_CODE_ID,
            TODO_DIV2_CODE_ID,
            TODO_ID,
            SALES_CD,
            PG_PATH,
            TODO_FILE_TRGT_KEY,
            TODO_CO_CD,
            TODO_NO,
            CREAT_ID,
            CREAT_PGM,
            CREAT_DTTM,
            PG_PARAM       
        ) 
        VALUES
        (
            #{toDoKey},
            #{sanCtnSn},
            #{coCd},
            #{todoDiv1CodeId},
            #{todoDiv2CodeId},
            #{usrNm},
            #{salesCd},
            #{pgPath},
            #{fileTrgtKey},
            #{todoCoCd},
            #{reqNo},
            #{userId},
            #{pgmId},
            SYSDATE,
            #{pgParam}
        )
  </insert>
                
<select id="selectCodeMaxCount" parameterType="Map" resultType="int">
    SELECT MAX(CNT) 
      FROM 
			(
			     SELECT SUM(CNT) AS CNT
			          , CODE1
			       FROM 
					     (
							SELECT M.CODE_ID AS CODE_ID
							     , (
								        SELECT COUNT(*) FROM TB_CM05M01 S 
								         WHERE S.CODE_KIND =  M.CODE_ID 
								           AND LENGTH(S.CODE_ID) = 9
							        ) AS CNT 
							     , SUBSTR(M.CODE_ID,0, 6) AS CODE1
							 FROM TB_CM05M01 M
							WHERE M.CODE_KIND LIKE 'COBGB%'
							  AND LENGTH(M.CODE_ID) = 7
					     )
			 
			      GROUP BY CODE1 
			  ) A
</select>
                
      <select id="selectMainCodeList" resultType="CamelMap">
		 SELECT ROWNUM AS RNUM, B.*
        FROM(  
          SELECT  
                     A.CODE_KIND
                     ,A.MID_CD
                     ,A.MID_NM
                     ,CASE WHEN A.SUB_CNT > 1 AND SUBSTR(A.SUB_CD,-1) > 1 THEN ' ' ELSE A.MID_NM END AS MID_NM2
                     ,A.SUB_CD
                     ,A.SUB_NM
                     ,A.SUB_CNT
	      FROM
	      ( SELECT M.CODE_KIND AS CODE_KIND,
	               M.CODE_ID AS MID_CD,
			       M.CODE_NM AS MID_NM,
			       S.CODE_ID AS SUB_CD,
			       S.CODE_NM AS SUB_NM,
			       M.CNT AS SUB_CNT
			FROM TB_CM05M01 S,
			(SELECT M.CODE_ID,
				    M.CODE_NM,
				    M.CODE_KIND
				    ,(SELECT COUNT(*) FROM TB_CM05M01 S WHERE S.CODE_KIND =  M.CODE_ID) AS CNT 
			 FROM TB_CM05M01 M
			 WHERE 1=1 
			       AND M.USE_YN = 'Y'
			      <if test="codeKind != null and !codeKind.equals('')">
					AND M.CODE_KIND = #{codeKind}
				  </if>
			)M
			WHERE 1=1 
<!-- 			<if test="codeKind != null and !codeKind.equals('')"> -->
<!-- 			AND S.CODE_KIND LIKE '${codeKind}%' -->
<!-- 			</if> -->
			AND M.CODE_ID = S.CODE_KIND
			AND S.USE_YN = 'Y'
			ORDER BY M.CODE_ID,S.CODE_ID )A
			)B
	</select>  
	
	
	<select id="selectShareUserInfo" parameterType="Map" resultType="camelMap">
	    SELECT  A.CO_CD AS CO_CD,
	    		C.CODE_NM AS CO_NM,
				A.ID AS ID,
		        A.EMP_NO AS EMP_NO,
				A.NAME AS USR_NM,
				A.TEL_NO AS TEL_NO,
				A.EMAIL AS EMAIL,
				B.DEPT_NM AS DT_NM
			FROM
				TB_CM06M01 A 
				INNER JOIN TB_CM04M01 B on A.DEPT_ID = B.DEPT_ID
				INNER JOIN TB_CM05M01 C ON A.CO_CD = C.CODE_ID 
				AND	A.USE_YN = 'Y'
			    AND A.CO_CD = '${coCd}'
			    AND A.ID =  '${userId}' 
	</select>	 
        
</mapper>