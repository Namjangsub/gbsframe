<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.cr.cr18.mapper.CR18Mapper">
	<!-- 그리드 조회 카운트-->
    <select id="select_cr18_Count" parameterType="Map" resultType="int">
		WITH SJM AS
		( 
		  SELECT *
		  FROM   (
		          SELECT ROWNUM AS RRN
		               , AA.*
		          FROM   (
		                  SELECT M.*
		                       , C.CLNT_NM
		                  FROM   TB_CR02M01 AS M  -- 수주마스터
		                         LEFT OUTER JOIN TB_BM02M01 AS C ON M.ORDRS_CLNT_CD = C.CLNT_CD
		                  WHERE  1 = 1
		                  <if test="coCd != null and !coCd.equals('')">
		                  AND    M.CO_CD    = #{coCd}
		                  </if>
		                  <if test="strtDt != null and !strtDt.equals('') and endDt != null and !endDt.equals('')" >
		                  AND    M.ORDRS_DT BETWEEN TO_DATE(#{strtDt}, 'YYYYMMDD') AND TO_DATE(#{endDt}, 'YYYYMMDD')
		                  </if>
		                  <if test="ordrsClntCd != null and !ordrsClntCd.equals('')">
		                  AND    M.ORDRS_CLNT_CD = #{ordrsClntCd}
		                  </if>
						  <if test="ordrsClntNm != null and !ordrsClntNm.equals('')">
		                  AND    C.CLNT_NM LIKE '%' || #{ordrsClntNm} || '%'
		                  </if>
		                  <if test="ordrsNo != null and !ordrsNo.equals('')">
		                  AND    M.ORDRS_NO LIKE '%' || #{ordrsNo} || '%'
		                  </if>
		                  <if test="clntPjt != null and !clntPjt.equals('')">
		                  AND    M.CLNT_PJT = #{clntPjt}
		                  </if>
		                  <if test="ctrtNm != null and !ctrtNm.equals('')">
		                  AND    M.CTRT_NM  LIKE '%' || #{ctrtNm} || '%'
		                  </if>
		                  <if test="ordrsDiv != null and !ordrsDiv.equals('')">
		                  AND    M.ORDRS_DIV = #{ordrsDiv}
		                  </if>
		                  ORDER BY M.CO_CD, M.ORDRS_CLNT_CD, M.CLNT_PJT, M.ORDRS_NO, M.FILE_TRGT_KEY
		                 ) AS AA
		          WHERE  1 = 1
		         )
		  <if test="firstIndex != null and !firstIndex.equals('')">
		  WHERE RRN BETWEEN #{firstIndex} AND #{lastIndex}
		  </if>
		)
		, SJD AS
		(
		  SELECT SM.CO_CD                                      AS CO_CD              --회사코드
		       , FN_CM05M01_CD_TO_NM(SM.CO_CD)                 AS CO_NM              --회사명
		       , SM.ORDRS_NO                                   AS ORDRS_NO           --수주번호
		       , SM.ORDRS_DIV                                  AS ORDRS_DIV          --수주구분
		       , FN_CM05M01_CD_TO_NM(SM.ORDRS_DIV)             AS ORDRS_DIV_NM       --수주구분명
		       , TO_CHAR(SM.ORDRS_DT, 'YYYY-MM-DD')            AS IO_DT              --수주일자
		       , SM.ORDRS_CLNT_CD                              AS CLNT_CD            --고객사
		       , SM.CLNT_NM                                    AS CLNT_NM            --고객사명
		       , SM.CLNT_PJT                                   AS CLNT_PJT           --고객사PJT
		       , SM.CTRT_NM                                    AS CTRT_NM            --계약명
		       , SM.ORDRS_AMT                                  AS ORDRS_AMT          --수주금액
		       , SM.EST_NO                                     AS EST_NO             --견적번호
		       , SM.EST_DEG                                    AS EST_DEG            --견적차수
		       , SM.CO_CD||'_'||SM.ORDRS_NO                    AS PID                --
		       , SM.CO_CD||'_'||SM.ORDRS_NO||'_'||SD.ORDRS_SEQ AS ID                 --
		       , SD.ORDRS_SEQ                                  AS IO_SEQ             --
		       , NVL(SD.SALES_CD, SM.ORDRS_NO||'-'||NVL2(SD.ORDRS_SEQ,TO_CHAR(SD.ORDRS_SEQ, '00')||FN_CM05M01_CD_TO_NM(SD.ORDRS_DTL_DIV10),'상세없음')) AS SALES_CD --SalesCode
		       , SD.ORDRS_DTL_DIV10                            AS ORDRS_DTL_DIV10    --입력구분
		       , FN_CM05M01_CD_TO_NM(SD.ORDRS_DTL_DIV10)       AS ORDRS_DTL_DIV10_NM --입력구분명
		       , SD.PRDT_CD                                    AS PRDT_CD            --제품구분
		       , P.PRDT_NM                                     AS PRDT_NM            --제품구분명
		       , SD.ITEM_DIV                                   AS ITEM_DIV           --아이템구분
		       , FN_CM05M01_CD_TO_NM(SD.ITEM_DIV)              AS ITEM_DIV_NM        --아이템구분명
		       , SD.ORDRS_DTL_DIV20                            AS ORDRS_DTL_DIV20    --작업구분
		       , FN_CM05M01_CD_TO_NM(SD.ORDRS_DTL_DIV20)       AS ORDRS_DTL_DIV20_NM --작업구분명
		       , SD.ORDRS_DTL_DIV30                            AS ORDRS_DTL_DIV30    --자체구분
		       , FN_CM05M01_CD_TO_NM(SD.ORDRS_DTL_DIV30)       AS ORDRS_DTL_DIV30_NM --자체구분명
		       , SD.EQP_NM                                     AS EQP_NM             --설비명
		       , SD.ORDRS_PRC_MACH                             AS ORDRS_PRC_MACH     --수주가-기계파트
		       , SD.ORDRS_PRC_ELCTY                            AS ORDRS_PRC_ELCTY    --수주가-전기파트
		       , SD.ORDRS_PRC                                  AS ORDRS_PRC          --수주가
		       , SD.ORDRS_QTY                                  AS ORDRS_QTY          --수량
		       , SD.EST_EPCT_MAT_PRC                           AS EST_EPCT_MAT_PRC   --견적예상재료비
		       , SD.TRGT_PCHS_PCOST_MACH                       AS TRGT_PCHS_PCOST_MACH --목표구매원가-기계
		       , SD.TRGT_PCHS_PCOST_ELCTY                      AS TRGT_PCHS_PCOST_ELCTY--목표구매원가-전기
		       , SD.TRGT_PCHS_PCOST_IN_HOUSE_PRCSN             AS TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표구매원가-기자체가공
		       , SD.LABOR_COST_MFG_COST                        AS LABOR_COST_MFG_COST
		       , SD.CREAT_ID                                   AS CREAT_ID      --작성자ID
		       , FN_CM06M01_ID_TO_NM(SD.CREAT_ID)              AS CREAT_ID_NM   --작성자명
		       , TO_CHAR(SD.CREAT_DTTM,'YYYY-MM-DD')           AS CREAT_DTTM    --작성일시
		       , SD.UDT_ID                                     AS UDT_ID        --수정자ID
		       , FN_CM06M01_ID_TO_NM(SD.UDT_ID)                AS UDT_ID_NM     --수정자명
		       , TO_CHAR(SD.UDT_DTTM, 'YYYY-MM-DD')            AS UDT_DTTM      --수정일시
		       , SM.FILE_TRGT_KEY                              AS FILE_TRGT_KEY
		       , RRN
		  FROM   SJM AS SM --수주마스터
		         LEFT OUTER JOIN TB_CR02D02 AS SD  ON SM.CO_CD    = SD.CO_CD
		                                          AND SM.ORDRS_NO = SD.ORDRS_NO
		         LEFT OUTER JOIN TB_BM01M01 AS P   ON SD.PRDT_CD  = P.PRDT_CD
		  WHERE  1 = 1
		)
		SELECT COUNT(*)
		FROM   (
				SELECT CO_CD                   --회사코드
					, FN_CM05M01_CD_TO_NM(CO_CD) CO_NM                   --회사명
					, ORDRS_NO                --수주번호
					, ORDRS_DIV               --수주구분
					, FN_CM05M01_CD_TO_NM(ORDRS_DIV) ORDRS_DIV_NM            --수주구분명
					, TO_CHAR(ORDRS_DT, 'YYYY-MM-DD') IO_DT                   --수주일자
					, ORDRS_CLNT_CD                 --고객사
					, CLNT_NM                 --고객사명
					, CLNT_PJT                --고객사PJT
					, CTRT_NM                 --계약명
					, ORDRS_AMT               --수주금액
					, EST_NO                  --견적번호
					, EST_DEG                 --견적차수
					, '' PID                     --PID
					, CO_CD||'_'||ORDRS_NO ID  --ID
					, 0  IO_SEQ                  --IO_SEQ
					, ORDRS_NO AS  SALES_CD   --SalesCode
					, '' ORDRS_DTL_DIV10      --입력구분
					, '' ORDRS_DTL_DIV10_NM   --입력구분명
					, '' PRDT_CD              --제품구분
					, '' PRDT_NM              --제품구분명
					, '' ITEM_DIV             --아이템구분
					, '' ITEM_DIV_NM          --아이템구분명
					, '' ORDRS_DTL_DIV20      --작업구분
					, '' ORDRS_DTL_DIV20_NM   --작업구분명
					, '' ORDRS_DTL_DIV30      --자체구분
					, '' ORDRS_DTL_DIV30_NM   --자체구분명 
					, '' EQP_NM               --설비명
					, '' ORDRS_PRC_MACH       --수주가-기계파트
					, '' ORDRS_PRC_ELCTY      --수주가-전기파트
					, '' ORDRS_PRC            --수주가
					, '' ORDRS_QTY            --수량 
					, '' EST_EPCT_MAT_PRC     --견적예상재료비
					, '' TRGT_PCHS_PCOST_MACH --목표구매원가-기계
					, '' TRGT_PCHS_PCOST_ELCTY--목표구매원가-전기
					, '' TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표구매원가-기자체가공
					, '' LABOR_COST_MFG_COST  --노무비및제조경비
					, CREAT_ID                --작성자ID
					, FN_CM06M01_ID_TO_NM(CREAT_ID) CREAT_ID_NM             --작성자명
					, TO_CHAR(CREAT_DTTM,'YYYY-MM-DD') CREAT_DTTM              --작성일시
					, UDT_ID                  --수정자ID
					, FN_CM06M01_ID_TO_NM(UDT_ID) UDT_ID_NM               --수정자명
					, TO_CHAR(UDT_DTTM, 'YYYY-MM-DD') UDT_DTTM                --수정일시 
					, FILE_TRGT_KEY
					, 1 AS COLLAPSE
					, RRN
				FROM   SJM
		       )
    </select>

	<!-- 그리드 조회 -->
	<select id="select_cr18_List" parameterType="Map" resultType="camelMap">
		WITH SJS AS
		( 
		  SELECT A.CO_CD                                                AS CO_CD
		       , A.ORDRS_NO                                             AS ORDRS_NO
			   , ROUND(SUM(A.ORDRS_PRC10) / 1000, 1)                    AS ORDRS_PRC10                    --수주가 설비
			   , ROUND(SUM(A.ORDRS_PRC20) / 1000, 1)                    AS ORDRS_PRC20                    --수주가 부대비용
			   , ROUND(SUM(A.ORDRS_PRC30) / 1000, 1)                    AS ORDRS_PRC30                    --수주가 추가비용
		       , ROUND(SUM(A.ORDRS_PRC_MACH) / 1000, 1)                 AS ORDRS_PRC_MACH                 --수주가-기계파트
		       , ROUND(SUM(A.ORDRS_PRC_ELCTY) / 1000, 1)                AS ORDRS_PRC_ELCTY                --수주가-전기파트
		       , ROUND(SUM(A.ORDRS_PRC) / 1000, 1)                      AS ORDRS_PRC                      --수주가
		       , ROUND(SUM(A.ORDRS_QTY) / 1000, 1)                      AS ORDRS_QTY                      --수주수량
		       , ROUND(SUM(A.EST_EPCT_MAT_PRC) / 1000, 1)               AS EST_EPCT_MAT_PRC               --견적예상재료비
		       , ROUND(SUM(A.TRGT_PCHS_PCOST_MACH) / 1000, 1)           AS TRGT_PCHS_PCOST_MACH           --목표구매원가-기계
		       , ROUND(SUM(A.TRGT_PCHS_PCOST_ELCTY) / 1000, 1)          AS TRGT_PCHS_PCOST_ELCTY          --목표구매원가-전기
		       , ROUND(SUM(A.TRGT_PCHS_PCOST_TOT) / 1000, 1)            AS TRGT_PCHS_PCOST_TOT            --목표구매원가-합계
		       , ROUND(SUM(A.TRGT_PCHS_PCOST_IN_HOUSE_PRCSN) / 1000, 1) AS TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표원가-기계자체가공
		       , ROUND(SUM(A.TRGT_PCHS_PCOST_MACH2) / 1000, 1)          AS TRGT_PCHS_PCOST_MACH2          --목표구매원가-차감 후 기계
		       , ROUND(SUM(A.LABOR_COST_MFG_COST) / 1000, 1)            AS LABOR_COST_MFG_COST            --노무비 및 제조경비
		       , ROUND(SUM(A.ACT_RGL_MACH) / 1000, 1)                   AS ACT_RGL_MACH                   --실행원가-정상-기계
		       , ROUND(SUM(A.ACT_OBS_MACH) / 1000, 1)                   AS ACT_OBS_MACH                   --실행원가-장애-기계
		       , ROUND(SUM(A.ACT_TOT_MACH) / 1000, 1)                   AS ACT_TOT_MACH                   --실행원가-기계
		       , ROUND(SUM(A.ACT_RGL_ELCTY) / 1000, 1)                  AS ACT_RGL_ELCTY                  --실행원가-정상-전기
		       , ROUND(SUM(A.ACT_OBS_ELCTY) / 1000, 1)                  AS ACT_OBS_ELCTY                  --실행원가-장애-전기
		       , ROUND(SUM(A.ACT_TOT_ELCTY) / 1000, 1)                  AS ACT_TOT_ELCTY                  --실행원가-전기
		       , ROUND(SUM(A.ACT_EXP_COST) / 1000, 1)                   AS ACT_EXP_COST                   --실행원가-경비관리비
		  FROM   (
		          SELECT CO_CD
				       , ORDRS_NO
				       , ORDRS_SEQ
				       , ORDRS_DTL_DIV10
					   , CASE WHEN ORDRS_DTL_DIV10 = 'ORDRSDTLDIV1010' THEN NVL(ORDRS_PRC_MACH, 0) + NVL(ORDRS_PRC_ELCTY, 0)
				                                                       ELSE 0 END              AS ORDRS_PRC10                    --수주가 설비
				       , CASE WHEN ORDRS_DTL_DIV10 = 'ORDRSDTLDIV1020' THEN NVL(ORDRS_PRC_MACH, 0) + NVL(ORDRS_PRC_ELCTY, 0)
				                                                       ELSE 0 END              AS ORDRS_PRC20                    --수주가 부대비용
				       , CASE WHEN ORDRS_DTL_DIV10 = 'ORDRSDTLDIV1030' THEN NVL(ORDRS_PRC_MACH, 0) + NVL(ORDRS_PRC_ELCTY, 0)
				                                                       ELSE 0 END              AS ORDRS_PRC30                    --수주가 추가비용
				       , NVL(ORDRS_PRC_MACH, 0)                                                AS ORDRS_PRC_MACH                 --수주가-기계파트
				       , NVL(ORDRS_PRC_ELCTY, 0)                                               AS ORDRS_PRC_ELCTY                --수주가-전기파트
				       , NVL(ORDRS_PRC_MACH, 0) + NVL(ORDRS_PRC_ELCTY, 0)                      AS ORDRS_PRC                      --수주가
				       , CASE WHEN ORDRS_DTL_DIV10 = 'ORDRSDTLDIV1010' THEN NVL(ORDRS_QTY, 0)
				                                                       ELSE 0 END              AS ORDRS_QTY                      --수주수량
				       , NVL(EST_EPCT_MAT_PRC, 0)                                              AS EST_EPCT_MAT_PRC               --견적예상재료비
				       , NVL(TRGT_PCHS_PCOST_MACH, 0)                                          AS TRGT_PCHS_PCOST_MACH           --목표구매원가-기계
				       , NVL(TRGT_PCHS_PCOST_ELCTY, 0)                                         AS TRGT_PCHS_PCOST_ELCTY          --목표구매원가-전기
				       , NVL(TRGT_PCHS_PCOST_MACH, 0) + NVL(TRGT_PCHS_PCOST_ELCTY, 0)          AS TRGT_PCHS_PCOST_TOT            --목표구매원가-합계
				       , NVL(TRGT_PCHS_PCOST_IN_HOUSE_PRCSN, 0)                                AS TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표원가-기계자체가공
				       , NVL(TRGT_PCHS_PCOST_MACH, 0) + NVL(TRGT_PCHS_PCOST_IN_HOUSE_PRCSN, 0) AS TRGT_PCHS_PCOST_MACH2          --목표구매원가-차감 후 기계
				       , NVL(LABOR_COST_MFG_COST, 0)                                           AS LABOR_COST_MFG_COST            --노무비 및 제조경비
				       , NVL(ACT_RGL_MACH, 0)                                                  AS ACT_RGL_MACH                   --실행원가-정상-기계
					   , NVL(ACT_OBS_MACH, 0)                                                  AS ACT_OBS_MACH                   --실행원가-장애-기계
				       , NVL(ACT_RGL_MACH, 0) + NVL(ACT_OBS_MACH, 0)                           AS ACT_TOT_MACH                   --실행원가-기계
				       , NVL(ACT_RGL_ELCTY, 0)                                                 AS ACT_RGL_ELCTY                  --실행원가-정상-전기
				       , NVL(ACT_OBS_ELCTY, 0)                                                 AS ACT_OBS_ELCTY                  --실행원가-장애-전기
				       , NVL(ACT_RGL_ELCTY, 0) + NVL(ACT_OBS_ELCTY, 0)                         AS ACT_TOT_ELCTY                  --실행원가-전기
				       , NVL(ACT_EXP_COST, 0)                                                  AS ACT_EXP_COST                   --실행원가-경비관리비
		          FROM   TB_CR02D02
				  WHERE  1 = 1
		         ) AS A
		  GROUP BY A.CO_CD, A.ORDRS_NO
		)
		, SJM AS
		( 
		  SELECT *
		  FROM   (
		          SELECT ROWNUM AS RRN
		               , AA.*
		          FROM   (
		                  SELECT M.*
		                       , C.CLNT_NM
							   , SDS.ORDRS_PRC10                    --수주가 설비
							   , SDS.ORDRS_PRC20                    --수주가 부대비용
							   , SDS.ORDRS_PRC30                    --수주가 추가비용
							   , SDS.ORDRS_PRC_MACH                 --수주가-기계파트
							   , SDS.ORDRS_PRC_ELCTY                --수주가-전기파트
							   , SDS.ORDRS_PRC                      --수주가
							   , SDS.ORDRS_QTY                      --수주수량
							   , SDS.EST_EPCT_MAT_PRC               --견적예상재료비
							   , SDS.TRGT_PCHS_PCOST_MACH           --목표구매원가-기계
							   , SDS.TRGT_PCHS_PCOST_ELCTY          --목표구매원가-전기
							   , SDS.TRGT_PCHS_PCOST_TOT            --목표구매원가-합계
							   , SDS.TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표원가-기계자체가공
							   , SDS.TRGT_PCHS_PCOST_MACH2          --목표구매원가-차감 후 기계
							   , SDS.LABOR_COST_MFG_COST            --노무비 및 제조경비
							   , SDS.ACT_RGL_MACH                   --실행원가-정상-기계
							   , SDS.ACT_OBS_MACH                   --실행원가-장애-기계
							   , SDS.ACT_TOT_MACH                   --실행원가-기계
							   , SDS.ACT_RGL_ELCTY                  --실행원가-정상-전기
							   , SDS.ACT_OBS_ELCTY                  --실행원가-장애-전기
							   , SDS.ACT_TOT_ELCTY                  --실행원가-전기
							   , SDS.ACT_EXP_COST                   --실행원가-경비관리비
		                  FROM   TB_CR02M01 AS M  -- 수주마스터
		                         LEFT OUTER JOIN TB_BM02M01 AS C ON M.ORDRS_CLNT_CD = C.CLNT_CD
								 LEFT OUTER JOIN SJS AS SDS  ON M.CO_CD    = SDS.CO_CD
		                                                    AND M.ORDRS_NO = SDS.ORDRS_NO
		                  WHERE  1 = 1
		                  <if test="coCd != null and !coCd.equals('')">
		                  AND    M.CO_CD    = #{coCd}
		                  </if>
		                  <if test="strtDt != null and !strtDt.equals('') and endDt != null and !endDt.equals('')" >
		                  AND    M.ORDRS_DT BETWEEN TO_DATE(#{strtDt}, 'YYYYMMDD') AND TO_DATE(#{endDt}, 'YYYYMMDD')
		                  </if>
		                  <if test="ordrsClntCd != null and !ordrsClntCd.equals('')">
		                  AND    M.ORDRS_CLNT_CD = #{ordrsClntCd}
		                  </if>
						  <if test="ordrsClntNm != null and !ordrsClntNm.equals('')">
		                  AND    C.CLNT_NM LIKE '%' || #{ordrsClntNm} || '%'
		                  </if>
		                  <if test="ordrsNo != null and !ordrsNo.equals('')">
		                  AND    M.ORDRS_NO LIKE '%' || #{ordrsNo} || '%'
		                  </if>
		                  <if test="clntPjt != null and !clntPjt.equals('')">
		                  AND    M.CLNT_PJT = #{clntPjt}
		                  </if>
		                  <if test="ctrtNm != null and !ctrtNm.equals('')">
		                  AND    M.CTRT_NM  LIKE '%' || #{ctrtNm} || '%'
		                  </if>
		                  <if test="ordrsDiv != null and !ordrsDiv.equals('')">
		                  AND    M.ORDRS_DIV = #{ordrsDiv}
		                  </if>
		                  ORDER BY M.CO_CD, M.ORDRS_CLNT_CD, M.CLNT_PJT, M.ORDRS_NO, M.FILE_TRGT_KEY
		                 ) AS AA
		          WHERE  1 = 1
		         )
		  WHERE RRN BETWEEN #{firstIndex} AND #{lastIndex}
		)
		, SJD AS
		(
		  SELECT SM.CO_CD                                      AS CO_CD              --회사코드
		       , FN_CM05M01_CD_TO_NM(SM.CO_CD)                 AS CO_NM              --회사명
		       , SM.ORDRS_NO                                   AS ORDRS_NO           --수주번호
		       , SM.ORDRS_DIV                                  AS ORDRS_DIV          --수주구분
		       , FN_CM05M01_CD_TO_NM(SM.ORDRS_DIV)             AS ORDRS_DIV_NM       --수주구분명
		       , TO_CHAR(SM.ORDRS_DT, 'YYYY-MM-DD')            AS IO_DT              --수주일자
		       , SM.ORDRS_CLNT_CD                              AS CLNT_CD            --고객사
		       , SM.CLNT_NM                                    AS CLNT_NM            --고객사명
		       , SM.CLNT_PJT                                   AS CLNT_PJT           --고객사PJT
		       , SM.CTRT_NM                                    AS CTRT_NM            --계약명
		       , ROUND(SM.ORDRS_AMT / 1000, 1)                 AS ORDRS_AMT          --수주금액
		       , SM.EST_NO                                     AS EST_NO             --견적번호
		       , SM.EST_DEG                                    AS EST_DEG            --견적차수
		       , SM.CO_CD||'_'||SM.ORDRS_NO                    AS PID                --
		       , SM.CO_CD||'_'||SM.ORDRS_NO||'_'||SD.ORDRS_SEQ AS ID                 --
		       , SD.ORDRS_SEQ                                  AS IO_SEQ             --
		       , NVL(SD.SALES_CD, SM.ORDRS_NO||'-'||NVL2(SD.ORDRS_SEQ, TO_CHAR(SD.ORDRS_SEQ, '00'),'상세없음')) AS SALES_CD --SalesCode
		       , SD.ORDRS_DTL_DIV10                            AS ORDRS_DTL_DIV10    --입력구분
		       , FN_CM05M01_CD_TO_NM(SD.ORDRS_DTL_DIV10)       AS ORDRS_DTL_DIV10_NM --입력구분명
		       , SD.PRDT_CD                                    AS PRDT_CD            --제품구분
		       , P.PRDT_NM                                     AS PRDT_NM            --제품구분명
		       , SD.ITEM_DIV                                   AS ITEM_DIV           --아이템구분
		       , FN_CM05M01_CD_TO_NM(SD.ITEM_DIV)              AS ITEM_DIV_NM        --아이템구분명
		       , SD.ORDRS_DTL_DIV20                            AS ORDRS_DTL_DIV20    --작업구분
		       , FN_CM05M01_CD_TO_NM(SD.ORDRS_DTL_DIV20)       AS ORDRS_DTL_DIV20_NM --작업구분명
		       , SD.ORDRS_DTL_DIV30                            AS ORDRS_DTL_DIV30    --자체구분
		       , FN_CM05M01_CD_TO_NM(SD.ORDRS_DTL_DIV30)       AS ORDRS_DTL_DIV30_NM --자체구분명
		       , SD.EQP_NM                                     AS EQP_NM             --설비명
			   , CASE WHEN SD.ORDRS_DTL_DIV10 = 'ORDRSDTLDIV1010' THEN ROUND((NVL(SD.ORDRS_PRC_MACH, 0) + NVL(SD.ORDRS_PRC_ELCTY, 0)) / 1000, 1)
				                                                  ELSE 0 END    AS ORDRS_PRC10        --수주가 설비
			   , CASE WHEN SD.ORDRS_DTL_DIV10 = 'ORDRSDTLDIV1020' THEN ROUND((NVL(SD.ORDRS_PRC_MACH, 0) + NVL(SD.ORDRS_PRC_ELCTY, 0)) / 1000, 1)
				                                                  ELSE 0 END    AS ORDRS_PRC20        --수주가 부대비용
			   , CASE WHEN SD.ORDRS_DTL_DIV10 = 'ORDRSDTLDIV1030' THEN ROUND((NVL(SD.ORDRS_PRC_MACH, 0) + NVL(SD.ORDRS_PRC_ELCTY, 0)) / 1000, 1)
				                                                  ELSE 0 END    AS ORDRS_PRC30        --수주가 추가비용
		       , ROUND(NVL(SD.ORDRS_PRC_MACH, 0) / 1000, 1)                     AS ORDRS_PRC_MACH     --수주가-기계파트
		       , ROUND(NVL(SD.ORDRS_PRC_ELCTY, 0) / 1000, 1)                    AS ORDRS_PRC_ELCTY    --수주가-전기파트
		       , ROUND((NVL(SD.ORDRS_PRC_MACH, 0) + NVL(SD.ORDRS_PRC_ELCTY, 0)) / 1000, 1) AS ORDRS_PRC --수주가
		       , NVL(SD.ORDRS_QTY, 0)                                           AS ORDRS_QTY          --수량
		       , ROUND(NVL(SD.EST_EPCT_MAT_PRC, 0) / 1000, 1)                   AS EST_EPCT_MAT_PRC   --견적예상재료비
		       , ROUND(NVL(SD.TRGT_PCHS_PCOST_MACH, 0) / 1000, 1)               AS TRGT_PCHS_PCOST_MACH --목표구매원가-기계
		       , ROUND(NVL(SD.TRGT_PCHS_PCOST_ELCTY, 0) / 1000, 1)              AS TRGT_PCHS_PCOST_ELCTY --목표구매원가-전기
			   , ROUND((NVL(SD.TRGT_PCHS_PCOST_MACH, 0) + NVL(SD.TRGT_PCHS_PCOST_ELCTY, 0)) / 1000, 1) AS TRGT_PCHS_PCOST_TOT --목표구매원가-합계
		       , ROUND(NVL(SD.TRGT_PCHS_PCOST_IN_HOUSE_PRCSN, 0) / 1000, 1)     AS TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표구매원가-기자체가공
			   , ROUND((NVL(SD.TRGT_PCHS_PCOST_MACH, 0) + NVL(SD.TRGT_PCHS_PCOST_IN_HOUSE_PRCSN, 0)) / 1000, 1) AS TRGT_PCHS_PCOST_MACH2 --목표구매원가-차감 후 기계
		       , ROUND(NVL(SD.LABOR_COST_MFG_COST, 0) / 1000, 1)                AS LABOR_COST_MFG_COST --노무비 및 제조경비
			   , ROUND(NVL(SD.ACT_RGL_MACH, 0) / 1000, 1)                             AS ACT_RGL_MACH                   --실행원가-정상-기계
		       , ROUND(NVL(SD.ACT_OBS_MACH, 0) / 1000, 1)                             AS ACT_OBS_MACH                   --실행원가-장애-기계
		       , ROUND((NVL(SD.ACT_RGL_MACH, 0) + NVL(SD.ACT_OBS_MACH, 0)) / 1000, 1)   AS ACT_TOT_MACH                   --실행원가-기계
		       , ROUND(NVL(SD.ACT_RGL_ELCTY, 0) / 1000, 1)                            AS ACT_RGL_ELCTY                  --실행원가-정상-전기
		       , ROUND(NVL(SD.ACT_OBS_ELCTY, 0) / 1000, 1)                            AS ACT_OBS_ELCTY                  --실행원가-장애-전기
		       , ROUND((NVL(SD.ACT_RGL_ELCTY, 0) + NVL(SD.ACT_OBS_ELCTY, 0)) / 1000, 1) AS ACT_TOT_ELCTY                  --실행원가-전기
		       , ROUND(NVL(SD.ACT_EXP_COST, 0) / 1000, 1)                             AS ACT_EXP_COST                   --실행원가-경비관리비
		       , SD.CREAT_ID                                   AS CREAT_ID      --작성자ID
		       , FN_CM06M01_ID_TO_NM(SD.CREAT_ID)              AS CREAT_ID_NM   --작성자명
		       , TO_CHAR(SD.CREAT_DTTM,'YYYY-MM-DD')           AS CREAT_DTTM    --작성일시
		       , SD.UDT_ID                                     AS UDT_ID        --수정자ID
		       , FN_CM06M01_ID_TO_NM(SD.UDT_ID)                AS UDT_ID_NM     --수정자명
		       , TO_CHAR(SD.UDT_DTTM, 'YYYY-MM-DD')            AS UDT_DTTM      --수정일시
		       , SM.FILE_TRGT_KEY                              AS FILE_TRGT_KEY
		       , RRN
		  FROM   SJM AS SM --수주마스터
		         LEFT OUTER JOIN TB_CR02D02 AS SD  ON SM.CO_CD    = SD.CO_CD
		                                          AND SM.ORDRS_NO = SD.ORDRS_NO
		         LEFT OUTER JOIN TB_BM01M01 AS P   ON SD.PRDT_CD  = P.PRDT_CD
		  WHERE  1 = 1
		)
		, SJG1 AS
		(
		  SELECT CO_CD                                   AS CO_CD        --회사코드
		       , ORDRS_CLNT_CD                           AS CLNT_CD      --고객사
		       , MAX(CLNT_NM)                            AS CLNT_NM
		       , SUM(ROUND(NVL(ORDRS_AMT, 0) / 1000, 1)) AS ORDRS_AMT --수주금액
			   , SUM(ORDRS_PRC10)                        AS ORDRS_PRC10        --수주가 설비
			   , SUM(ORDRS_PRC20)                        AS ORDRS_PRC20        --수주가 부대비용
			   , SUM(ORDRS_PRC30)                        AS ORDRS_PRC30        --수주가 추가비용
		       , SUM(ORDRS_PRC_MACH)                     AS ORDRS_PRC_MACH     --수주가-기계파트
		       , SUM(ORDRS_PRC_ELCTY)                    AS ORDRS_PRC_ELCTY    --수주가-전기파트
		       , SUM(ORDRS_PRC)                          AS ORDRS_PRC          --수주가
		       , SUM(ORDRS_QTY)                          AS ORDRS_QTY          --수량 
		       , SUM(EST_EPCT_MAT_PRC)                   AS EST_EPCT_MAT_PRC   --견적예상재료비
		       , SUM(TRGT_PCHS_PCOST_MACH)               AS TRGT_PCHS_PCOST_MACH           --목표구매원가-기계
		       , SUM(TRGT_PCHS_PCOST_ELCTY)              AS TRGT_PCHS_PCOST_ELCTY          --목표구매원가-전기
			   , SUM(TRGT_PCHS_PCOST_TOT)                AS TRGT_PCHS_PCOST_TOT            --목표구매원가-합계
		       , SUM(TRGT_PCHS_PCOST_IN_HOUSE_PRCSN)     AS TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표구매원가-기자체가공
			   , SUM(TRGT_PCHS_PCOST_MACH2)              AS TRGT_PCHS_PCOST_MACH2          --목표구매원가-차감 후 기계		     
			   , SUM(ACT_RGL_MACH)                       AS ACT_RGL_MACH        --실행원가-정상-기계
			   , SUM(ACT_OBS_MACH)                       AS ACT_OBS_MACH        --실행원가-장애-기계
			   , SUM(ACT_TOT_MACH)                       AS ACT_TOT_MACH        --실행원가-기계
			   , SUM(ACT_RGL_ELCTY)                      AS ACT_RGL_ELCTY       --실행원가-정상-전기
			   , SUM(ACT_OBS_ELCTY)                      AS ACT_OBS_ELCTY       --실행원가-장애-전기
			   , SUM(ACT_TOT_ELCTY)                      AS ACT_TOT_ELCTY       --실행원가-전기
			   , SUM(ACT_TOT_MACH) + SUM(ACT_TOT_ELCTY)  AS ACT_TOT
			   , SUM(LABOR_COST_MFG_COST)                AS LABOR_COST_MFG_COST --노무비및제조경비
			   , SUM(ACT_EXP_COST)                       AS ACT_EXP_COST        --실행원가-경비관리비
			   , SUM(ACT_TOT_MACH) + SUM(ACT_TOT_ELCTY) + SUM(LABOR_COST_MFG_COST) AS WONGA_TOT
		       , SUM(ORDRS_PRC) - (SUM(ACT_TOT_MACH) + SUM(ACT_TOT_ELCTY) + SUM(LABOR_COST_MFG_COST)) - SUM(ACT_EXP_COST) AS FIT
		       , MAX(FILE_TRGT_KEY)                      AS FILE_TRGT_KEY
		       , MAX(RRN)                                AS RRN
		  FROM   SJM
		  GROUP BY CO_CD, ORDRS_CLNT_CD
		)
		, SJG2 AS
		(
		  SELECT CO_CD                                   AS CO_CD        --회사코드
		       , SUM(ROUND(NVL(ORDRS_AMT, 0) / 1000, 1)) AS ORDRS_AMT --수주금액
			   , SUM(ORDRS_PRC10)                        AS ORDRS_PRC10        --수주가 설비
			   , SUM(ORDRS_PRC20)                        AS ORDRS_PRC20        --수주가 부대비용
			   , SUM(ORDRS_PRC30)                        AS ORDRS_PRC30        --수주가 추가비용
		       , SUM(ORDRS_PRC_MACH)                     AS ORDRS_PRC_MACH     --수주가-기계파트
		       , SUM(ORDRS_PRC_ELCTY)                    AS ORDRS_PRC_ELCTY    --수주가-전기파트
		       , SUM(ORDRS_PRC)                          AS ORDRS_PRC          --수주가
		       , SUM(ORDRS_QTY)                          AS ORDRS_QTY          --수량 
		       , SUM(EST_EPCT_MAT_PRC)                   AS EST_EPCT_MAT_PRC   --견적예상재료비
		       , SUM(TRGT_PCHS_PCOST_MACH)               AS TRGT_PCHS_PCOST_MACH           --목표구매원가-기계
		       , SUM(TRGT_PCHS_PCOST_ELCTY)              AS TRGT_PCHS_PCOST_ELCTY          --목표구매원가-전기
			   , SUM(TRGT_PCHS_PCOST_TOT)                AS TRGT_PCHS_PCOST_TOT            --목표구매원가-합계
		       , SUM(TRGT_PCHS_PCOST_IN_HOUSE_PRCSN)     AS TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표구매원가-기자체가공
			   , SUM(TRGT_PCHS_PCOST_MACH2)              AS TRGT_PCHS_PCOST_MACH2          --목표구매원가-차감 후 기계		     
			   , SUM(ACT_RGL_MACH)                       AS ACT_RGL_MACH        --실행원가-정상-기계
			   , SUM(ACT_OBS_MACH)                       AS ACT_OBS_MACH        --실행원가-장애-기계
			   , SUM(ACT_TOT_MACH)                       AS ACT_TOT_MACH        --실행원가-기계
			   , SUM(ACT_RGL_ELCTY)                      AS ACT_RGL_ELCTY       --실행원가-정상-전기
			   , SUM(ACT_OBS_ELCTY)                      AS ACT_OBS_ELCTY       --실행원가-장애-전기
			   , SUM(ACT_TOT_ELCTY)                      AS ACT_TOT_ELCTY       --실행원가-전기
			   , SUM(ACT_TOT_MACH) + SUM(ACT_TOT_ELCTY)  AS ACT_TOT
			   , SUM(LABOR_COST_MFG_COST)                AS LABOR_COST_MFG_COST --노무비및제조경비
			   , SUM(ACT_EXP_COST)                       AS ACT_EXP_COST        --실행원가-경비관리비
			   , SUM(ACT_TOT_MACH) + SUM(ACT_TOT_ELCTY) + SUM(LABOR_COST_MFG_COST) AS WONGA_TOT
		       , SUM(ORDRS_PRC) - (SUM(ACT_TOT_MACH) + SUM(ACT_TOT_ELCTY) + SUM(LABOR_COST_MFG_COST)) - SUM(ACT_EXP_COST) AS FIT
		       , MAX(FILE_TRGT_KEY)                      AS FILE_TRGT_KEY
		       , MAX(RRN)                                AS RRN
		  FROM   SJM
		  GROUP BY CO_CD
		)
		, SJALL AS
		(
		  SELECT CO_CD                           AS CO_CD        --회사코드
		     , FN_CM05M01_CD_TO_NM(CO_CD)      AS CO_NM        --회사명
		     , ORDRS_NO                        AS ORDRS_NO     --수주번호
		     , ORDRS_DIV                       AS ORDRS_DIV    --수주구분
		     , FN_CM05M01_CD_TO_NM(ORDRS_DIV)  AS ORDRS_DIV_NM --수주구분명
		     , TO_CHAR(ORDRS_DT, 'YYYY-MM-DD') AS IO_DT        --수주일자
		     , ORDRS_CLNT_CD                   AS CLNT_CD      --고객사
		     , CLNT_NM                         AS CLNT_NM      --고객사명
		     , CLNT_PJT                        AS CLNT_PJT     --고객사PJT
			 , (SELECT FN_CM05M01_CD_TO_NM(CLNT_PJT) FROM DUAL) AS CLNT_PJT_NM --고객사PJT명
		     , CTRT_NM                         AS CTRT_NM   --계약명
		     , ROUND(NVL(ORDRS_AMT, 0) / 1000, 1) AS ORDRS_AMT --수주금액
		     , EST_NO                          AS EST_NO    --견적번호
		     , EST_DEG                         AS EST_DEG   --견적차수
		     , ''                              AS PID       --PID
		     , CO_CD||'_'||ORDRS_NO            AS ID        --ID
		     , 0                               AS IO_SEQ    --IO_SEQ
		     , ORDRS_NO                        AS SALES_CD  --SalesCode
		     , ''                              AS ORDRS_DTL_DIV10    --입력구분
		     , ''                              AS ORDRS_DTL_DIV10_NM --입력구분명
		     , ''                              AS PRDT_CD            --제품구분
		     , ''                              AS PRDT_NM            --제품구분명
		     , ''                              AS ITEM_DIV           --아이템구분
		     , ''                              AS ITEM_DIV_NM        --아이템구분명
		     , ''                              AS ORDRS_DTL_DIV20    --작업구분
		     , ''                              AS ORDRS_DTL_DIV20_NM --작업구분명
		     , ''                              AS ORDRS_DTL_DIV30    --자체구분
		     , ''                              AS ORDRS_DTL_DIV30_NM --자체구분명 
		     , ''                              AS EQP_NM             --설비명
			 , ORDRS_PRC10                     AS ORDRS_PRC10        --수주가 설비
			 , ORDRS_PRC20                     AS ORDRS_PRC20        --수주가 부대비용
			 , ORDRS_PRC30                     AS ORDRS_PRC30        --수주가 추가비용
		     , ORDRS_PRC_MACH                  AS ORDRS_PRC_MACH     --수주가-기계파트
		     , ORDRS_PRC_ELCTY                 AS ORDRS_PRC_ELCTY    --수주가-전기파트
		     , ORDRS_PRC                       AS ORDRS_PRC          --수주가
		     , ORDRS_QTY                       AS ORDRS_QTY          --수량 
		     , EST_EPCT_MAT_PRC                AS EST_EPCT_MAT_PRC   --견적예상재료비
		     , TRGT_PCHS_PCOST_MACH            AS TRGT_PCHS_PCOST_MACH           --목표구매원가-기계
		     , TRGT_PCHS_PCOST_ELCTY           AS TRGT_PCHS_PCOST_ELCTY          --목표구매원가-전기
			 , TRGT_PCHS_PCOST_TOT             AS TRGT_PCHS_PCOST_TOT            --목표구매원가-합계
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND((TRGT_PCHS_PCOST_TOT / ORDRS_PRC) * 100, 1)
			   END                             AS TRGT_PCHS_PCOST_PER
		     , TRGT_PCHS_PCOST_IN_HOUSE_PRCSN  AS TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표구매원가-기자체가공
			 , TRGT_PCHS_PCOST_MACH2           AS TRGT_PCHS_PCOST_MACH2          --목표구매원가-차감 후 기계
		     
			 , ACT_RGL_MACH                    AS ACT_RGL_MACH        --실행원가-정상-기계
			 , ACT_OBS_MACH                    AS ACT_OBS_MACH        --실행원가-장애-기계
			 , ACT_TOT_MACH                    AS ACT_TOT_MACH        --실행원가-기계
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND((ACT_TOT_MACH / ORDRS_PRC) * 100, 1)
			   END                             AS ACT_PER_MACH
			 , ACT_RGL_ELCTY                   AS ACT_RGL_ELCTY       --실행원가-정상-전기
			 , ACT_OBS_ELCTY                   AS ACT_OBS_ELCTY       --실행원가-장애-전기
			 , ACT_TOT_ELCTY                   AS ACT_TOT_ELCTY       --실행원가-전기
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND((ACT_TOT_ELCTY / ORDRS_PRC) * 100, 1)
			   END                             AS ACT_PER_ELCTY
			 , ACT_TOT_MACH + ACT_TOT_ELCTY    AS ACT_TOT
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND(((ACT_TOT_MACH + ACT_TOT_ELCTY) / ORDRS_PRC) * 100, 1)
			   END                             AS ACT_TOT_PER
			 , CASE WHEN (ACT_TOT_MACH + ACT_TOT_ELCTY) = 0 THEN 0
			                            ELSE ROUND((TRGT_PCHS_PCOST_TOT / (ACT_TOT_MACH + ACT_TOT_ELCTY)) * 100, 1)
			   END                             AS TRGT_ACT_PER
			 , LABOR_COST_MFG_COST             AS LABOR_COST_MFG_COST --노무비및제조경비
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND((LABOR_COST_MFG_COST / ORDRS_PRC) * 100, 1)
			   END                             AS LABOR_COST_PER
			 , ACT_EXP_COST                    AS ACT_EXP_COST        --실행원가-경비관리비
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((ACT_EXP_COST / ORDRS_PRC) * 100, 1)
			   END                             AS ACT_EXP_PER
			 , ACT_TOT_MACH + ACT_TOT_ELCTY + LABOR_COST_MFG_COST AS WONGA_TOT
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND(((ACT_TOT_MACH + ACT_TOT_ELCTY + LABOR_COST_MFG_COST) / ORDRS_PRC) * 100, 1)
			   END                            AS WONGA_PER
		     , ORDRS_PRC - (ACT_TOT_MACH + ACT_TOT_ELCTY + LABOR_COST_MFG_COST) - ACT_EXP_COST AS FIT
		     , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND(((ORDRS_PRC - (ACT_TOT_MACH + ACT_TOT_ELCTY + LABOR_COST_MFG_COST) - ACT_EXP_COST) / ORDRS_PRC) * 100, 1)
			   END                             AS FIT_PER
		     , CREAT_ID                         AS CREAT_ID     --작성자ID
		     , FN_CM06M01_ID_TO_NM(CREAT_ID)    AS CREAT_ID_NM  --작성자명
		     , TO_CHAR(CREAT_DTTM,'YYYY-MM-DD') AS CREAT_DTTM   --작성일시
		     , UDT_ID                           AS UDT_ID       --수정자ID
		     , FN_CM06M01_ID_TO_NM(UDT_ID)      AS UDT_ID_NM    --수정자명
		     , TO_CHAR(UDT_DTTM, 'YYYY-MM-DD')  AS UDT_DTTM     --수정일시 
		     , FILE_TRGT_KEY                    AS FILE_TRGT_KEY
		     , 0                                AS COLLAPSE
		     , RRN                              AS RRN
		FROM   SJM
		UNION ALL
		SELECT CO_CD                           AS CO_CD        --회사코드
		     , CO_NM                           AS CO_NM        --회사명
		     , ORDRS_NO                        AS ORDRS_NO     --수주번호
		     , ORDRS_DIV                       AS ORDRS_DIV    --수주구분
		     , ORDRS_DIV_NM                    AS ORDRS_DIV_NM --수주구분명
		     , IO_DT                           AS IO_DT        --수주일자
		     , CLNT_CD                         AS CLNT_CD      --고객사
		     , CLNT_NM                         AS CLNT_NM      --고객사명
		     , CLNT_PJT                        AS CLNT_PJT     --고객사PJT
			 , (SELECT FN_CM05M01_CD_TO_NM(CLNT_PJT) FROM DUAL) AS CLNT_PJT_NM --고객사PJT명
		     , CTRT_NM                         AS CTRT_NM   --계약명
		     , ORDRS_AMT                       AS ORDRS_AMT --수주금액
		     , EST_NO                          AS EST_NO    --견적번호
		     , EST_DEG                         AS EST_DEG   --견적차수
		     , PID                             AS PID       --PID
		     , ID                              AS ID        --ID
		     , IO_SEQ                          AS IO_SEQ    --IO_SEQ
		     , REPLACE(SALES_CD, ' ', '')      AS SALES_CD  --SalesCode
		     , ORDRS_DTL_DIV10                 AS ORDRS_DTL_DIV10    --입력구분
		     , ORDRS_DTL_DIV10_NM              AS ORDRS_DTL_DIV10_NM --입력구분명
		     , PRDT_CD                         AS PRDT_CD            --제품구분
		     , PRDT_NM                         AS PRDT_NM            --제품구분명
		     , ITEM_DIV             AS ITEM_DIV           --아이템구분
		     , ITEM_DIV_NM          AS ITEM_DIV_NM        --아이템구분명
		     , ORDRS_DTL_DIV20      AS ORDRS_DTL_DIV20    --작업구분
		     , ORDRS_DTL_DIV20_NM   AS ORDRS_DTL_DIV20_NM --작업구분명
		     , ORDRS_DTL_DIV30      AS ORDRS_DTL_DIV30    --자체구분
		     , ORDRS_DTL_DIV30_NM   AS ORDRS_DTL_DIV30_NM --자체구분명
		     , EQP_NM               AS EQP_NM             --설비명
			 , ORDRS_PRC10                    AS ORDRS_PRC10        --수주가 설비
			 , ORDRS_PRC20                    AS ORDRS_PRC20        --수주가 부대비용
			 , ORDRS_PRC30                    AS ORDRS_PRC30        --수주가 추가비용
			 , ORDRS_PRC_MACH                 AS ORDRS_PRC_MACH     --수주가-기계파트
		     , ORDRS_PRC_ELCTY                AS ORDRS_PRC_ELCTY    --수주가-전기파트
		     , ORDRS_PRC                      AS ORDRS_PRC          --수주가
		     , ORDRS_QTY                      AS ORDRS_QTY          --수량 
		     , EST_EPCT_MAT_PRC               AS EST_EPCT_MAT_PRC   --견적예상재료비
		     , TRGT_PCHS_PCOST_MACH           AS TRGT_PCHS_PCOST_MACH           --목표구매원가-기계
		     , TRGT_PCHS_PCOST_ELCTY          AS TRGT_PCHS_PCOST_ELCTY          --목표구매원가-전기
			 , TRGT_PCHS_PCOST_TOT            AS TRGT_PCHS_PCOST_TOT            --목표구매원가-합계
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND((TRGT_PCHS_PCOST_TOT / ORDRS_PRC) * 100, 1)
			   END                             AS TRGT_PCHS_PCOST_PER
		     , TRGT_PCHS_PCOST_IN_HOUSE_PRCSN AS TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표구매원가-기자체가공
			 , TRGT_PCHS_PCOST_MACH2          AS TRGT_PCHS_PCOST_MACH2          --목표구매원가-차감 후 기계		     
			 , ACT_RGL_MACH                   AS ACT_RGL_MACH        --실행원가-정상-기계
			 , ACT_OBS_MACH                   AS ACT_OBS_MACH        --실행원가-장애-기계
			 , ACT_TOT_MACH                   AS ACT_TOT_MACH        --실행원가-기계
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND((ACT_TOT_MACH / ORDRS_PRC) * 100, 1)
			   END                            AS ACT_PER_MACH
			 , ACT_RGL_ELCTY                  AS ACT_RGL_ELCTY       --실행원가-정상-전기
			 , ACT_OBS_ELCTY                  AS ACT_OBS_ELCTY       --실행원가-장애-전기
			 , ACT_TOT_ELCTY                  AS ACT_TOT_ELCTY       --실행원가-전기
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND((ACT_TOT_ELCTY / ORDRS_PRC) * 100, 1)
			   END                            AS ACT_PER_ELCTY
			 , ACT_TOT_MACH + ACT_TOT_ELCTY   AS ACT_TOT
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND(((ACT_TOT_MACH + ACT_TOT_ELCTY) / ORDRS_PRC) * 100, 1)
			   END                            AS ACT_TOT_PER
			 , CASE WHEN (ACT_TOT_MACH + ACT_TOT_ELCTY) = 0 THEN 0
			                            ELSE ROUND((TRGT_PCHS_PCOST_TOT / (ACT_TOT_MACH + ACT_TOT_ELCTY)) * 100, 1)
			   END                            AS TRGT_ACT_PER
			 , LABOR_COST_MFG_COST            AS LABOR_COST_MFG_COST --노무비및제조경비
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND((LABOR_COST_MFG_COST / ORDRS_PRC) * 100, 1)
			   END                            AS LABOR_COST_PER
			 , ACT_EXP_COST                    AS ACT_EXP_COST        --실행원가-경비관리비
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((ACT_EXP_COST / ORDRS_PRC) * 100, 1)
			   END                             AS ACT_EXP_PER
			 , ACT_TOT_MACH + ACT_TOT_ELCTY + LABOR_COST_MFG_COST AS WONGA_TOT
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND(((ACT_TOT_MACH + ACT_TOT_ELCTY + LABOR_COST_MFG_COST) / ORDRS_PRC) * 100, 1)
			   END                            AS WONGA_PER
		     , ORDRS_PRC - (ACT_TOT_MACH + ACT_TOT_ELCTY + LABOR_COST_MFG_COST) - ACT_EXP_COST AS FIT
		     , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND(((ORDRS_PRC - (ACT_TOT_MACH + ACT_TOT_ELCTY + LABOR_COST_MFG_COST) - ACT_EXP_COST) / ORDRS_PRC) * 100, 1)
			   END                             AS FIT_PER
		     , CREAT_ID      AS CREAT_ID     --작성자ID
		     , CREAT_ID_NM   AS CREAT_ID_NM  --작성자명
		     , CREAT_DTTM    AS CREAT_DTTM   --작성일시
		     , UDT_ID        AS UDT_ID       --수정자ID
		     , UDT_ID_NM     AS UDT_ID_NM    --수정자명
		     , UDT_DTTM      AS UDT_DTTM     --수정일시 
		     , FILE_TRGT_KEY AS FILE_TRGT_KEY
		     , 1             AS COLLAPSE
		     , RRN           AS RRN
		FROM   SJD
		UNION ALL
		SELECT CO_CD                          AS CO_CD        --회사코드
			 , ''                             AS CO_NM        --회사명
			 , ''                             AS ORDRS_NO     --수주번호
			 , ''                             AS ORDRS_DIV    --수주구분
			 , ''                             AS ORDRS_DIV_NM --수주구분명
			 , ''                             AS IO_DT        --수주일자
		     , CLNT_CD                        AS CLNT_CD      --고객사
		     , ''                             AS CLNT_NM      --고객사명
		     , ''                             AS CLNT_PJT     --고객사PJT
			 , ''                             AS CLNT_PJT_NM --고객사PJT명
			 , ''                             AS CTRT_NM   --계약명
		     , ORDRS_AMT                      AS ORDRS_AMT --수주금액
			 , ''                             AS EST_NO    --견적번호
			 , ''                             AS EST_DEG   --견적차수
		     , ''                             AS PID       --PID
		     , ''                             AS ID        --ID
			 , ''                             AS IO_SEQ    --IO_SEQ
			 , ' [소계] '                     AS SALES_CD  --SalesCode
			 , ''                             AS ORDRS_DTL_DIV10    --입력구분
			 , ''                             AS ORDRS_DTL_DIV10_NM --입력구분명
			 , ''                             AS PRDT_CD            --제품구분
			 , ''                             AS PRDT_NM            --제품구분명
			 , ''                             AS ITEM_DIV           --아이템구분
			 , ''                             AS ITEM_DIV_NM        --아이템구분명
			 , ''                             AS ORDRS_DTL_DIV20    --작업구분
			 , ''                             AS ORDRS_DTL_DIV20_NM --작업구분명
			 , ''                             AS ORDRS_DTL_DIV30    --자체구분
			 , ''                             AS ORDRS_DTL_DIV30_NM --자체구분명 
			 , ''                             AS EQP_NM             --설비명
			 , ORDRS_PRC10                    AS ORDRS_PRC10        --수주가 설비
			 , ORDRS_PRC20                    AS ORDRS_PRC20        --수주가 부대비용
			 , ORDRS_PRC30                    AS ORDRS_PRC30        --수주가 추가비용
		     , ORDRS_PRC_MACH                 AS ORDRS_PRC_MACH     --수주가-기계파트
		     , ORDRS_PRC_ELCTY                AS ORDRS_PRC_ELCTY    --수주가-전기파트
		     , ORDRS_PRC                      AS ORDRS_PRC          --수주가
		     , ORDRS_QTY                      AS ORDRS_QTY          --수량 
		     , EST_EPCT_MAT_PRC               AS EST_EPCT_MAT_PRC   --견적예상재료비
		     , TRGT_PCHS_PCOST_MACH           AS TRGT_PCHS_PCOST_MACH           --목표구매원가-기계
		     , TRGT_PCHS_PCOST_ELCTY          AS TRGT_PCHS_PCOST_ELCTY          --목표구매원가-전기
			 , TRGT_PCHS_PCOST_TOT            AS TRGT_PCHS_PCOST_TOT            --목표구매원가-합계
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((TRGT_PCHS_PCOST_TOT / ORDRS_PRC) * 100, 1)
			   END                            AS TRGT_PCHS_PCOST_PER
			 , TRGT_PCHS_PCOST_IN_HOUSE_PRCSN AS TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표구매원가-기자체가공
			 , TRGT_PCHS_PCOST_MACH2          AS TRGT_PCHS_PCOST_MACH2          --목표구매원가-차감 후 기계		     
			 , ACT_RGL_MACH                   AS ACT_RGL_MACH        --실행원가-정상-기계
			 , ACT_OBS_MACH                   AS ACT_OBS_MACH        --실행원가-장애-기계
			 , ACT_TOT_MACH                   AS ACT_TOT_MACH        --실행원가-기계
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((ACT_TOT_MACH / ORDRS_PRC) * 100, 1)
			   END                            AS ACT_PER_MACH
			 , ACT_RGL_ELCTY                  AS ACT_RGL_ELCTY       --실행원가-정상-전기
			 , ACT_OBS_ELCTY                  AS ACT_OBS_ELCTY       --실행원가-장애-전기
			 , ACT_TOT_ELCTY                  AS ACT_TOT_ELCTY       --실행원가-전기
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((ACT_TOT_ELCTY / ORDRS_PRC) * 100, 1)
			   END                            AS ACT_PER_ELCTY
			 , ACT_TOT AS ACT_TOT
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND((ACT_TOT / ORDRS_PRC) * 100, 1)
			   END                            AS ACT_TOT_PER
			 , CASE WHEN ACT_TOT = 0 THEN 0
			                         ELSE ROUND((TRGT_PCHS_PCOST_TOT / ACT_TOT) * 100, 1)
			   END                            AS TRGT_ACT_PER
			 , LABOR_COST_MFG_COST            AS LABOR_COST_MFG_COST --노무비및제조경비
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((LABOR_COST_MFG_COST / ORDRS_PRC) * 100, 1)
			   END                            AS LABOR_COST_PER
			 , ACT_EXP_COST                   AS ACT_EXP_COST        --실행원가-경비관리비
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((ACT_EXP_COST / ORDRS_PRC) * 100, 1)
			   END                            AS ACT_EXP_PER
			 , WONGA_TOT AS WONGA_TOT
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((WONGA_TOT / ORDRS_PRC) * 100, 1)
			   END                            AS WONGA_PER
		     , FIT AS FIT
		     , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((FIT / ORDRS_PRC) * 100, 1)
			   END                            AS FIT_PER
			 , ''                             AS CREAT_ID     --작성자ID
			 , ''                             AS CREAT_ID_NM  --작성자명
			 , ''                             AS CREAT_DTTM   --작성일시
			 , ''                             AS UDT_ID       --수정자ID
			 , ''                             AS UDT_ID_NM    --수정자명
			 , ''                             AS UDT_DTTM     --수정일시 
		     , FILE_TRGT_KEY                  AS FILE_TRGT_KEY
		     , 2                              AS COLLAPSE
		     , RRN                            AS RRN
		FROM   SJG1
		UNION ALL
		SELECT CO_CD                          AS CO_CD        --회사코드
			 , ''                             AS CO_NM        --회사명
			 , ''                             AS ORDRS_NO     --수주번호
			 , ''                             AS ORDRS_DIV    --수주구분
			 , ''                             AS ORDRS_DIV_NM --수주구분명
			 , ''                             AS IO_DT        --수주일자
		     , ''                             AS CLNT_CD      --고객사
		     , '[ 합계 ]'                             AS CLNT_NM      --고객사명
		     , ''                             AS CLNT_PJT     --고객사PJT
			 , ''                             AS CLNT_PJT_NM --고객사PJT명
			 , ''                             AS CTRT_NM   --계약명
		     , ORDRS_AMT                      AS ORDRS_AMT --수주금액
			 , ''                             AS EST_NO    --견적번호
			 , ''                             AS EST_DEG   --견적차수
		     , ''                             AS PID       --PID
		     , ''                             AS ID        --ID
			 , ''                             AS IO_SEQ    --IO_SEQ
			 , ''                             AS SALES_CD  --SalesCode
			 , ''                             AS ORDRS_DTL_DIV10    --입력구분
			 , ''                             AS ORDRS_DTL_DIV10_NM --입력구분명
			 , ''                             AS PRDT_CD            --제품구분
			 , ''                             AS PRDT_NM            --제품구분명
			 , ''                             AS ITEM_DIV           --아이템구분
			 , ''                             AS ITEM_DIV_NM        --아이템구분명
			 , ''                             AS ORDRS_DTL_DIV20    --작업구분
			 , ''                             AS ORDRS_DTL_DIV20_NM --작업구분명
			 , ''                             AS ORDRS_DTL_DIV30    --자체구분
			 , ''                             AS ORDRS_DTL_DIV30_NM --자체구분명 
			 , ''                             AS EQP_NM             --설비명
			 , ORDRS_PRC10                    AS ORDRS_PRC10        --수주가 설비
			 , ORDRS_PRC20                    AS ORDRS_PRC20        --수주가 부대비용
			 , ORDRS_PRC30                    AS ORDRS_PRC30        --수주가 추가비용
		     , ORDRS_PRC_MACH                 AS ORDRS_PRC_MACH     --수주가-기계파트
		     , ORDRS_PRC_ELCTY                AS ORDRS_PRC_ELCTY    --수주가-전기파트
		     , ORDRS_PRC                      AS ORDRS_PRC          --수주가
		     , ORDRS_QTY                      AS ORDRS_QTY          --수량 
		     , EST_EPCT_MAT_PRC               AS EST_EPCT_MAT_PRC   --견적예상재료비
		     , TRGT_PCHS_PCOST_MACH           AS TRGT_PCHS_PCOST_MACH           --목표구매원가-기계
		     , TRGT_PCHS_PCOST_ELCTY          AS TRGT_PCHS_PCOST_ELCTY          --목표구매원가-전기
			 , TRGT_PCHS_PCOST_TOT            AS TRGT_PCHS_PCOST_TOT            --목표구매원가-합계
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((TRGT_PCHS_PCOST_TOT / ORDRS_PRC) * 100, 1)
			   END                            AS TRGT_PCHS_PCOST_PER
			 , TRGT_PCHS_PCOST_IN_HOUSE_PRCSN AS TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --목표구매원가-기자체가공
			 , TRGT_PCHS_PCOST_MACH2          AS TRGT_PCHS_PCOST_MACH2          --목표구매원가-차감 후 기계		     
			 , ACT_RGL_MACH                   AS ACT_RGL_MACH        --실행원가-정상-기계
			 , ACT_OBS_MACH                   AS ACT_OBS_MACH        --실행원가-장애-기계
			 , ACT_TOT_MACH                   AS ACT_TOT_MACH        --실행원가-기계
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((ACT_TOT_MACH / ORDRS_PRC) * 100, 1)
			   END                            AS ACT_PER_MACH
			 , ACT_RGL_ELCTY                  AS ACT_RGL_ELCTY       --실행원가-정상-전기
			 , ACT_OBS_ELCTY                  AS ACT_OBS_ELCTY       --실행원가-장애-전기
			 , ACT_TOT_ELCTY                  AS ACT_TOT_ELCTY       --실행원가-전기
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((ACT_TOT_ELCTY / ORDRS_PRC) * 100, 1)
			   END                            AS ACT_PER_ELCTY
			 , ACT_TOT AS ACT_TOT
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                            ELSE ROUND((ACT_TOT / ORDRS_PRC) * 100, 1)
			   END                            AS ACT_TOT_PER
			 , CASE WHEN ACT_TOT = 0 THEN 0
			                         ELSE ROUND((TRGT_PCHS_PCOST_TOT / ACT_TOT) * 100, 1)
			   END                            AS TRGT_ACT_PER
			 , LABOR_COST_MFG_COST            AS LABOR_COST_MFG_COST --노무비및제조경비
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((LABOR_COST_MFG_COST / ORDRS_PRC) * 100, 1)
			   END                            AS LABOR_COST_PER
			 , ACT_EXP_COST                   AS ACT_EXP_COST        --실행원가-경비관리비
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((ACT_EXP_COST / ORDRS_PRC) * 100, 1)
			   END                            AS ACT_EXP_PER
			 , WONGA_TOT AS WONGA_TOT
			 , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((WONGA_TOT / ORDRS_PRC) * 100, 1)
			   END                            AS WONGA_PER
		     , FIT AS FIT
		     , CASE WHEN ORDRS_PRC = 0 THEN 0
			                           ELSE ROUND((FIT / ORDRS_PRC) * 100, 1)
			   END                            AS FIT_PER
			 , ''                             AS CREAT_ID     --작성자ID
			 , ''                             AS CREAT_ID_NM  --작성자명
			 , ''                             AS CREAT_DTTM   --작성일시
			 , ''                             AS UDT_ID       --수정자ID
			 , ''                             AS UDT_ID_NM    --수정자명
			 , ''                             AS UDT_DTTM     --수정일시 
		     , FILE_TRGT_KEY                  AS FILE_TRGT_KEY
		     , 3                              AS COLLAPSE
		     , RRN                            AS RRN
		FROM   SJG2
		)
		SELECT *
		FROM   SJALL
		ORDER BY CO_CD, RRN, COLLAPSE
	</select>

	<!-- 수금유형 -->		
	<select id="selectPmntmtdCd" parameterType="Map" resultType="camelMap">
		SELECT CODE_ID AS CODE_ID
		     , CODE_NM AS CODE_NM
		FROM   TB_CM05M01 AS A
		WHERE  A.CODE_KIND = 'PMNTMTD'
		<if test="codeId != null and !codeId.equals('')">
		AND    A.CODE_ID = #{codeId}
		</if>
	</select>
</mapper>