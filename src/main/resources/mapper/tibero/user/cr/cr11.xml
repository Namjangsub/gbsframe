<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.cr.cr11.mapper.CR11Mapper">
   <!-- 그리드 카운트 -->	
   <select id="grid1_selectCount" parameterType="Map" resultType="int">
   		SELECT COUNT(*)
   		FROM	(
   					SELECT 
						  FILE_TRGT_KEY	
						, A.CO_CD                     --회사코드
						, R.CODE_NM AS CO_NM          --회사이름
						, A.ORDRS_CLNT_CD             --고객사코드
						, BM.CLNT_NM AS CLNT_NM       --고객사명
						, A.ORDRS_NO                  --수주번호
						, TO_CHAR(A.ORDRS_DT, 'YYYY-MM-DD') AS ORDRS_DT  --수주일자
						, A.ORDRS_DIV	              --수주구분
						, A.CLNT_PJT	              --고객사PJT
						, CRD.SALES_CD                --SALESCODE
						
						, CRD.PRDT_CD                 --제품구분
						, R1.CODE_NM AS PRDT_NM       --제품구분
						
						, CRD.ITEM_DIV                --아이템구분
						, R2.CODE_NM AS ITEM_DIV_NM   --아이템구분
						
						, CRD.ORDRS_DTL_DIV20         --작업구분
						, CRD.ORDRS_DTL_DIV30         --자체구분
						, CRD.EQP_NM                  --설비명
						, A.CTRT_NM                   --계약명
						
						, CRD.ORDRS_PRC_MACH          --기계PART(수주)
						, CRD.ORDRS_PRC_ELCTY         --전기PART(수주)
						, CRD.ORDRS_PRC               --합계(수주)
						, CRD.ORDRS_QTY               --수량
						, CRD.EST_EPCT_MAT_PRC        --견적예상재료비
						
						, CRD.TRGT_PCHS_PCOST_MACH          --기계PART(목표)
						, CRD.TRGT_PCHS_PCOST_ELCTY         --전기PART(목표)						
						, CRD.TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --자체가공
						
						, CRD.LABOR_COST_MFG_COST          --노무비 및 제조경비
						
					FROM TB_CR02M01 AS A 
						
					 	<!-- 수주상세 조인 -->
						LEFT OUTER JOIN TB_CR02D02 AS CRD ON CRD.CO_CD = A.CO_CD 
						 								  AND CRD.ORDRS_NO = A.ORDRS_NO	 												  
						<!-- 고객사명 조인 -->
						LEFT OUTER JOIN TB_BM02M01 AS BM ON BM.CLNT_CD = A.ORDRS_CLNT_CD 
						<!-- 회사이름 조인 -->
						LEFT OUTER JOIN TB_CM05M01 AS R ON R.CODE_ID = A.CO_CD	 	
						<!-- 제품구분 -->
						LEFT OUTER JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = CRD.PRDT_CD
						<!-- 아이템구분 -->
						LEFT OUTER JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = CRD.ITEM_DIV
					WHERE 1 = 1
					
					<!-- 검색조건 -->
					<if test="coCd != null and !coCd.equals('')">
						AND	 A.CO_CD = '${coCd}' --회사
					</if>
					<if test="strtDt != null and !strtDt.equals('') and endDt != null and !endDt.equals('')" >
						AND    A.ORDRS_DT BETWEEN TO_DATE( #{strtDt},'YYYYMMDD') AND TO_DATE( #{endDt},'YYYYMMDD') --수주일자
					</if>
					<if test="ordrsClntCd != null and !ordrsClntCd.equals('')"> 
						AND    A.ORDRS_CLNT_CD = #{OrdrsClntCd} --고객사
					</if>
					<if test="clntNm != null and !clntNm.equals('')">
						AND    BM.CLNT_NM = #{clntNm}  --고객사명
					</if>
					<if test="ordrsNo != null and !ordrsNo.equals('')">
						AND    A.ORDRS_NO = #{ordrsNo}  --수주번호
					</if>
					<if test="clntPjt != null and !clntPjt.equals('')">
						AND    A.CLNT_PJT = #{clntPjt}  --고객사PJT
					</if>
					<if test="ctrtNm != null and !ctrtNm.equals('')"> 
						AND    A.CTRT_NM = #{ctrtNm} --계약명
					</if>
					<if test="ordrsDiv != null and !ordrsDiv.equals('')">		  
						AND    A.ORDRS_DIV = #{ordrsDiv} --수주구분
					</if>
   				)T
   </select>
   
   <!-- 그리드 조회 -->
   <select id="grid1_selectList" parameterType="Map" resultType="camelMap">
	   	SELECT 
			  FILE_TRGT_KEY	
			, A.CO_CD                     --회사코드
			, R.CODE_NM AS CO_NM          --회사이름
			, A.ORDRS_CLNT_CD             --고객사코드
			, BM.CLNT_NM AS CLNT_NM       --고객사명
			, A.ORDRS_NO                  --수주번호		
			, TO_CHAR(A.ORDRS_DT, 'YYYY-MM-DD') AS ORDRS_DT  --수주일자
			, A.ORDRS_DIV	              --수주구분
			, A.CLNT_PJT	              --고객사PJT
			, CRD.SALES_CD                --SALESCODE
			
			, CRD.PRDT_CD                 --제품구분
			, R1.CODE_NM AS PRDT_NM       --제품구분
			
			, CRD.ITEM_DIV                --아이템구분
			, R2.CODE_NM AS ITEM_DIV_NM   --아이템구분
			
			, CRD.ORDRS_DTL_DIV20         --작업구분
			, CRD.ORDRS_DTL_DIV30         --자체구분
			, CRD.EQP_NM                  --설비명
			, A.CTRT_NM                   --계약명
			
			, CRD.ORDRS_PRC_MACH          --기계PART(수주)
			, CRD.ORDRS_PRC_ELCTY         --전기PART(수주)
			, CRD.ORDRS_PRC               --합계(수주)
			, CRD.ORDRS_QTY               --수량
			, CRD.EST_EPCT_MAT_PRC        --견적예상재료비
			
			, CRD.TRGT_PCHS_PCOST_MACH          --기계PART(목표)
			, CRD.TRGT_PCHS_PCOST_ELCTY         --전기PART(목표)			
			, CRD.TRGT_PCHS_PCOST_IN_HOUSE_PRCSN --자체가공
			
			, CRD.LABOR_COST_MFG_COST          --노무비 및 제조경비
		FROM TB_CR02M01 AS A 
			
		 	<!-- 수주상세 조인 -->
			LEFT OUTER JOIN TB_CR02D02 AS CRD ON CRD.CO_CD = A.CO_CD 
			 								  AND CRD.ORDRS_NO = A.ORDRS_NO	 												  
			<!-- 고객사명 조인 -->
			LEFT OUTER JOIN TB_BM02M01 AS BM ON BM.CLNT_CD = A.ORDRS_CLNT_CD 
			<!-- 회사이름 조인 -->
			LEFT OUTER JOIN TB_CM05M01 AS R ON R.CODE_ID = A.CO_CD	 	
			<!-- 제품구분 -->
			LEFT OUTER JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = CRD.PRDT_CD
			<!-- 아이템구분 -->
			LEFT OUTER JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = CRD.ITEM_DIV
		WHERE 1 = 1
		
		<!-- 검색조건 -->
		<if test="coCd != null and !coCd.equals('')">
			AND	 A.CO_CD = '${coCd}' --회사
		</if>
		<if test="strtDt != null and !strtDt.equals('') and endDt != null and !endDt.equals('')" >
			AND    A.ORDRS_DT BETWEEN TO_DATE( #{strtDt},'YYYYMMDD') AND TO_DATE( #{endDt},'YYYYMMDD') --수주일자
		</if>
		<if test="ordrsClntCd != null and !ordrsClntCd.equals('')"> 
			AND    A.ORDRS_CLNT_CD = #{OrdrsClntCd} --고객사
		</if>
		<if test="clntNm != null and !clntNm.equals('')">
			AND    BM.CLNT_NM = #{clntNm}  --고객사명
		</if>
		<if test="ordrsNo != null and !ordrsNo.equals('')">
			AND    A.ORDRS_NO = #{ordrsNo}  --수주번호
		</if>
		<if test="clntPjt != null and !clntPjt.equals('')">
			AND    A.CLNT_PJT = #{clntPjt}  --고객사PJT
		</if>
		<if test="ctrtNm != null and !ctrtNm.equals('')"> 
			AND    A.CTRT_NM = #{ctrtNm} --계약명
		</if>
		<if test="ordrsDiv != null and !ordrsDiv.equals('')">		  
			AND    A.ORDRS_DIV = #{ordrsDiv} --수주구분
		</if>
   </select>
    
	 
</mapper>