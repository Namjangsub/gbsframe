<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.cr.cr05.mapper.CR05Mapper">
	<select id="selectClmnListCount" parameterType="Map" resultType="int">
		SELECT COUNT(*)
		FROM   (
				SELECT A.*
					, ROWNUM AS RN
				FROM	(
						SELECT DISTINCT
							 A.FILE_TRGT_KEY
							, T.PID
							, T.ID
							, T.CO_CD
							, T.CO_NM
							, T.LVL
							, CASE WHEN T.CLMN_PLAN_SEQ IS NULL OR T.CLMN_PLAN_SEQ = '' THEN A.FILE_TRGT_KEY
												ELSE A.FILE_TRGT_KEY||'-'||T.CLMN_PLAN_SEQ
					  							END AS TREE_ID
					 		, T.CLMN_PLAN_SEQ				-- 수금계획순번
					 		, T.CLMN_NO						-- 수금번호
					 		, T.CLMN_PLAN_DIV				-- 수금구분	
					 		, T.CLMN_PLAN_DIV_NM 			-- 수금구분명		
					 		, T.CLMN_DT						-- 수금일자	
							, T.ORDRS_DIV					-- 수주구분
					 		, T.ORDRS_NO 					-- 수주번호
					 		, T.ORDRS_DT 					-- 수주일자
					 		, T.CLNT_CD AS ORDRS_CLNT_CD    -- 고객사
							, T.CLNT_NM  AS ORDRS_CLNT_NM   -- 고객사명
							, T.CLNT_PJT      				-- 고객사PJT
							, T.CTRT_NM						-- 계약명
							, T.CURR_CD  AS ORDRS_CURR_CD   -- 통화단위
		    				, T.CURR_NM  AS ORDRS_CURR_NM   -- 통화단위명
		    				, T.ORDRS_AMT 				    -- 수주금액
		    				, T.BKAC_CD						-- 계좌번호
							, T.EXRATE						-- 환율
							, T.PMNTMTD_CD					-- 수금유형
							, T.CLMN_DTL_AMT				-- 수금금액
							, T.CLMN_RMK 					-- 비고
							, T.CREAT_PGM 
							, T.CREAT_ID
							, T.CREAT_ID_NM
							, T.CREAT_DTTM
							, T.UDT_PGM
							, T.UDT_ID
							, T.UDT_ID_NM
							, T.UDT_DTTM
			FROM   
			(	
			
				SELECT DISTINCT A.FILE_TRGT_KEY --파일대상KEY
				FROM   TB_CR05M01 AS A
				LEFT OUTER JOIN (
								 SELECT DISTINCT SM.CO_CD
								, SM.ORDRS_NO				--수주번호
								, TO_CHAR(SM.ORDRS_DT, 'YYYY-MM-DD') AS ORDRS_DT --수주일자
								, TO_CHAR(SM.ORDRS_CLNT_CD) AS CLNT_CD --고객사
								, C.CLNT_NM                 AS CLNT_NM --고객사명
								, SM.CLNT_PJT          		--고객사PJT							
								, SM.CTRT_NM
								, SM.ORDRS_DIV
								, SM.CURR_CD			AS  ORDRS_CURR_CD   -- 통화단위
								, R2.CODE_NM            AS  ORDRS_CURR_NM   -- 통화단위명
								, SM.ORDRS_AMT          AS ORDRS_AMT 		-- 수주금액
								, SD.CLMN_PLAN_DIV	  						-- 수금구분	
								, R3.CODE_NM 			AS CLMN_PLAN_DIV_NM	-- 수금구분명 
								FROM   TB_CR02M01 AS SM		--수주마스터
								LEFT OUTER JOIN TB_CR02D01 AS SD  ON SD.CO_CD    = SM.CO_CD		--수주상세 조인
									AND SD.ORDRS_NO = SM.ORDRS_NO
									
								LEFT OUTER JOIN TB_BM02M01 AS C ON C.CLNT_CD = SM.ORDRS_CLNT_CD	--거래처 조인
					        	LEFT OUTER JOIN TB_CM05M01 AS R  ON R.CODE_ID  = SM.CO_CD   	-- 회사
								LEFT OUTER JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = SM.ORDRS_DIV   -- 수주구분
						    	LEFT OUTER JOIN TB_CM05M01 AS R3 ON R3.CODE_ID = SD.CLMN_PLAN_DIV	-- 수금구분
						    	LEFT OUTER JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = SM.CURR_CD   	-- 통화단위	
				) AS O ON  O.CO_CD    = A.CO_CD
				LEFT OUTER JOIN TB_CR05D01 AS B  ON B.CO_CD = A.CO_CD
				AND B.CLMN_NO	= A.CLMN_NO
				WHERE  1 = 1
				
				<!-- 검색조건 -->
				<if test="coCd != null and !coCd.equals('')">
					AND	 A.CO_CD = '${coCd}' --회사
				</if>
				<if test="ordrsClntCd != null and !ordrsClntCd.equals('')"> 
					AND NVL(TO_CHAR(O.ORDRS_CLNT_CD), '.') LIKE '%${ordrsClntCd}%' --고객사
				</if>
				<if test="clntNm != null and !clntNm.equals('')">
					AND NVL(C.CLNT_NM, '.') LIKE '%${clntNm}%' --고객사명
				</if>
				<if test="ordrsNo != null and !ordrsNo.equals('')">
					AND NVL(SM.ORDRS_NO , '.') LIKE '%${ordrsNo}%' --수주번호
				</if>
				<if test="clntPjt != null and !clntPjt.equals('')">
					AND NVL(SM.CLNT_PJT , '.') LIKE '%${clntPjt}%' --고객사PJT
				</if>
				<if test="ctrtNm != null and !ctrtNm.equals('')">
					AND NVL(SM.CTRT_NM  , '.') LIKE '%${ctrtNm}%' --계약명
				</if>
				<if test="ordrsDiv != null and !ordrsDiv.equals('')">
					AND NVL(SM.ORDRS_DIV, '.') LIKE '%${ordrsDiv}%' --수주구분
				</if>
				)AS A -- 조회 결과 1
				<!-- ) -->
				<!--★맨위에서 조회할 것 여기 아래에 추가해야함 -->
		LEFT OUTER JOIN (
			SELECT
				DISTINCT 
				T.PID
				, T.ID
				, T.FILE_TRGT_KEY
				, T.CO_CD
				, T.CLMN_PLAN_SEQ
				, R.CODE_NM AS CO_NM
				, T.CLMN_NO					-- 수금번호
				, T.CLMN_DT					-- 수금일자				
				, O.ORDRS_NO AS ORDRS_NO    -- 수주번호
				, O.ORDRS_DT AS ORDRS_DT	-- 수주일자
				, O.CLNT_CD  AS CLNT_CD    	-- 고객사
				, O.CLNT_NM  AS CLNT_NM     -- 고객사명
				, O.CLNT_PJT AS CLNT_PJT  	-- 고객사PJT
				, O.CTRT_NM	 AS CTRT_NM 	-- 계약명
				, O.ORDRS_DIV AS ORDRS_DIV 	-- 수주구분
				, O.ORDRS_AMT AS ORDRS_AMT 	-- 수주금액
				, T.CURR_CD					-- 통화코드
				, R2.CODE_NM AS CURR_NM 	-- 통화코드명
				, T.BKAC_CD					-- 계좌번호
				, T.EXRATE					-- 환율
				, T.PMNTMTD_CD				-- 수금유형
				, T.CLMN_DTL_AMT 			-- 수금금액
				, T.CLMN_RMK 				-- 비고
				, O.CLMN_PLAN_DIV	 AS CLMN_PLAN_DIV	-- 수금구분
				, O.CLMN_PLAN_DIV_NM AS CLMN_PLAN_DIV_NM -- 수금구분명
				<!-- 수금구분명 -->
				<!-- , R3.CODE_NM AS CLMN_PLAN_DIV_NM   -->
				, T.CREAT_PGM
				, T.CREAT_ID
				, U1.NAME AS CREAT_ID_NM
				, T.CREAT_DTTM
				, T.UDT_PGM
				, T.UDT_ID
				, U2.NAME AS UDT_ID_NM
				, T.UDT_DTTM
				, T.LVL
		FROM ( 
			SELECT '' AS PID
					, M.CO_CD ||'_'|| M.CLMN_NO AS ID
					, M.FILE_TRGT_KEY AS FILE_TRGT_KEY
					, M.CO_CD
					, '' AS ORDRS_NO		-- 수주번호
					, '' AS CLMN_PLAN_SEQ	-- 수금계획순번
					, M.CLMN_NO	  -- 수금번호
					, TO_CHAR(M.CLMN_DT, 'YYYY-MM-DD') AS CLMN_DT	-- 수금일자
					, M.PMNTMTD_CD -- 수금유형
					, M.CURR_CD -- 통화단위
					, M.EXRATE  -- 환율
					, M.BKAC_CD -- 계좌번호
					, '' AS CLMN_DTL_AMT -- 수금금액
					, M.CLMN_RMK -- 비고
					, M.CREAT_PGM
					, M.CREAT_ID
					, TO_CHAR(M.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM
					, M.UDT_PGM
					, M.UDT_ID
					, TO_CHAR(M.UDT_DTTM, 'YYYY-MM-DD') AS UDT_DTTM
					, '1' AS LVL
			FROM   TB_CR05M01 AS M
			UNION ALL
			SELECT 	D.CO_CD ||'_'|| D.CLMN_NO AS PID
				, D.CO_CD ||'_'|| D.CLMN_NO || D.CLMN_PLAN_SEQ  AS ID
				, M.FILE_TRGT_KEY AS FILE_TRGT_KEY
				, D.CO_CD
				, D.ORDRS_NO		-- 수주번호
				, D.CLMN_PLAN_SEQ	--수금계획순번
				, M.CLMN_NO	  -- 수금번호
				, TO_CHAR(M.CLMN_DT, 'YYYY-MM-DD') AS CLMN_DT	-- 수금일자
				, M.PMNTMTD_CD -- 수금유형
				, M.CURR_CD -- 통화단위
				, M.EXRATE  -- 환율
				, M.BKAC_CD -- 계좌번호
				, D.CLMN_DTL_AMT -- 수금금액
				, M.CLMN_RMK -- 비고
				, D.CREAT_PGM
				, D.CREAT_ID
				, TO_CHAR(D.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM
				, D.UDT_PGM
				, D.UDT_ID
				, TO_CHAR(D.UDT_DTTM, 'YYYY-MM-DD') AS UDT_DTTM
				, '2' AS LVL
			FROM TB_CR05D01 AS D
			LEFT OUTER JOIN TB_CR05M01 AS M ON	M.CO_CD = D.CO_CD
					AND M.CLMN_NO	= D.CLMN_NO
				 	WHERE  1 = 1
		    ) AS T  
	<!-- ) AS C -->
	<!-- 수주마스터 조인 -->
		LEFT OUTER JOIN (
						SELECT DISTINCT SM.CO_CD
							, SM.ORDRS_NO          --수주번호
							, TO_CHAR(SM.ORDRS_DT, 'YYYY-MM-DD') AS ORDRS_DT --수주일자
							, TO_CHAR(SM.ORDRS_CLNT_CD) AS CLNT_CD --고객사
							, C.CLNT_NM                 AS CLNT_NM --고객사명
							, SM.CLNT_PJT							--고객사PJT							
							, SM.CTRT_NM
							, SM.ORDRS_DIV
							, SM.CURR_CD						-- 통화단위
							, R2.CODE_NM		AS CURR_NM    	-- 통화단위명
							, SM.ORDRS_AMT      AS ORDRS_AMT 	-- 수주금액
							, SD.CLMN_PLAN_DIV						-- 수금구분
							, R3.CODE_NM		AS CLMN_PLAN_DIV_NM -- 수금구분명
							FROM TB_CR02M01 AS SM	-- 수주마스터
							LEFT OUTER JOIN TB_CR02D01 AS SD  ON SD.CO_CD    = SM.CO_CD			--수주상세 조인
								AND SD.ORDRS_NO = SM.ORDRS_NO		
							LEFT OUTER JOIN TB_BM02M01 AS C ON C.CLNT_CD = SM.ORDRS_CLNT_CD	 	--거래처 조인
							<!-- 추가 -->
				       		LEFT OUTER JOIN TB_CM05M01 AS R  ON R.CODE_ID  = SM.CO_CD   		-- 회사
							LEFT OUTER JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = SM.ORDRS_DIV   	-- 수주구분
					    	LEFT OUTER JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = SM.CURR_CD   		-- 통화단위
							LEFT OUTER JOIN TB_CM05M01 AS R3 ON R3.CODE_ID = SD.CLMN_PLAN_DIV	-- 수금구분
					    	<!-- 추가 -->
							) AS O  ON O.CO_CD    = T.CO_CD
							AND O.ORDRS_NO = T.ORDRS_NO <!--  ★O LEFT JOIN T -->
							LEFT OUTER JOIN TB_CM05M01 AS R  ON R.CODE_ID  = T.CO_CD
							<!-- 통화단위  -->
							LEFT OUTER JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = T.CURR_CD
					    	<!-- 생성자 -->
							LEFT OUTER JOIN TB_CM06M01 AS U1 ON U1.ID = T.CREAT_ID
							<!--변경자 -->
							LEFT OUTER JOIN TB_CM06M01 AS U2 ON U2.ID = T.UDT_ID
							) AS T ON T.FILE_TRGT_KEY = A.FILE_TRGT_KEY
						WHERE  1 = 1
						ORDER BY A.FILE_TRGT_KEY, T.PID DESC, T.ID
						) AS A
					WHERE  1 = 1
		       ) AS A
			WHERE  1 = 1
	</select>
	
	<select id="selectClmnList" parameterType="Map" resultType="camelMap">
		SELECT A.*
		FROM   (
				SELECT A.*
					, ROWNUM AS RN
				FROM	(
						SELECT DISTINCT
							 A.FILE_TRGT_KEY
							, T.PID
							, T.ID
							, T.CO_CD
							, T.CO_NM
							, T.LVL
							, CASE WHEN T.CLMN_PLAN_SEQ IS NULL OR T.CLMN_PLAN_SEQ = '' THEN A.FILE_TRGT_KEY
												ELSE A.FILE_TRGT_KEY||'-'||T.CLMN_PLAN_SEQ
					  							END AS TREE_ID
					 		, T.CLMN_PLAN_SEQ				-- 수금계획순번
					 		, T.CLMN_NO						-- 수금번호
					 		, T.CLMN_PLAN_DIV				-- 수금구분	
					 		, T.CLMN_PLAN_DIV_NM 			-- 수금구분명		
					 		, T.CLMN_DT						-- 수금일자	
							, T.ORDRS_DIV					-- 수주구분
					 		, T.ORDRS_NO 					-- 수주번호
					 		, T.ORDRS_DT 					-- 수주일자
					 		, T.CLNT_CD AS ORDRS_CLNT_CD    -- 고객사
							, T.CLNT_NM  AS ORDRS_CLNT_NM   -- 고객사명
							, T.CLNT_PJT      				-- 고객사PJT
							, T.CTRT_NM						-- 계약명
							, T.CURR_CD  AS ORDRS_CURR_CD   -- 통화단위
		    				, T.CURR_NM  AS ORDRS_CURR_NM   -- 통화단위명
		    				, T.ORDRS_AMT 				    -- 수주금액
		    				, T.BKAC_CD						-- 계좌번호
							, T.EXRATE						-- 환율
							, T.PMNTMTD_CD					-- 수금유형
							, T.CLMN_DTL_AMT				-- 수금금액
							, T.CLMN_RMK 					-- 비고
							, T.CREAT_PGM 
							, T.CREAT_ID
							, T.CREAT_ID_NM
							, T.CREAT_DTTM
							, T.UDT_PGM
							, T.UDT_ID
							, T.UDT_ID_NM
							, T.UDT_DTTM
			FROM   
			(	
			
				SELECT DISTINCT A.FILE_TRGT_KEY --파일대상KEY
				FROM   TB_CR05M01 AS A
				LEFT OUTER JOIN (
								 SELECT DISTINCT SM.CO_CD
								, SM.ORDRS_NO				--수주번호
								, TO_CHAR(SM.ORDRS_DT, 'YYYY-MM-DD') AS ORDRS_DT --수주일자
								, TO_CHAR(SM.ORDRS_CLNT_CD) AS CLNT_CD --고객사
								, C.CLNT_NM                 AS CLNT_NM --고객사명
								, SM.CLNT_PJT          		--고객사PJT							
								, SM.CTRT_NM
								, SM.ORDRS_DIV
								, SM.CURR_CD			AS  ORDRS_CURR_CD   -- 통화단위
								, R2.CODE_NM            AS  ORDRS_CURR_NM   -- 통화단위명
								, SM.ORDRS_AMT          AS ORDRS_AMT 		-- 수주금액
								, SD.CLMN_PLAN_DIV	  						-- 수금구분	
								, R3.CODE_NM 			AS CLMN_PLAN_DIV_NM	-- 수금구분명 
								FROM   TB_CR02M01 AS SM		--수주마스터
								LEFT OUTER JOIN TB_CR02D01 AS SD  ON SD.CO_CD    = SM.CO_CD		--수주상세 조인
									AND SD.ORDRS_NO = SM.ORDRS_NO
									
								LEFT OUTER JOIN TB_BM02M01 AS C ON C.CLNT_CD = SM.ORDRS_CLNT_CD	--거래처 조인
					        	LEFT OUTER JOIN TB_CM05M01 AS R  ON R.CODE_ID  = SM.CO_CD   	-- 회사
								LEFT OUTER JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = SM.ORDRS_DIV   -- 수주구분
						    	LEFT OUTER JOIN TB_CM05M01 AS R3 ON R3.CODE_ID = SD.CLMN_PLAN_DIV	-- 수금구분
						    	LEFT OUTER JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = SM.CURR_CD   	-- 통화단위	
				) AS O ON  O.CO_CD    = A.CO_CD
				LEFT OUTER JOIN TB_CR05D01 AS B  ON B.CO_CD = A.CO_CD
				AND B.CLMN_NO	= A.CLMN_NO
				WHERE  1 = 1
				
				<!-- 검색조건 -->
				<if test="coCd != null and !coCd.equals('')">
					AND	 A.CO_CD = '${coCd}' --회사
				</if>
				<if test="ordrsClntCd != null and !ordrsClntCd.equals('')"> 
					AND NVL(TO_CHAR(O.ORDRS_CLNT_CD), '.') LIKE '%${ordrsClntCd}%' --고객사
				</if>
				<if test="clntNm != null and !clntNm.equals('')">
					AND NVL(C.CLNT_NM, '.') LIKE '%${clntNm}%' --고객사명
				</if>
				<if test="ordrsNo != null and !ordrsNo.equals('')">
					AND NVL(SM.ORDRS_NO , '.') LIKE '%${ordrsNo}%' --수주번호
				</if>
				<if test="clntPjt != null and !clntPjt.equals('')">
					AND NVL(SM.CLNT_PJT , '.') LIKE '%${clntPjt}%' --고객사PJT
				</if>
				<if test="ctrtNm != null and !ctrtNm.equals('')">
					AND NVL(SM.CTRT_NM  , '.') LIKE '%${ctrtNm}%' --계약명
				</if>
				<if test="ordrsDiv != null and !ordrsDiv.equals('')">
					AND NVL(SM.ORDRS_DIV, '.') LIKE '%${ordrsDiv}%' --수주구분
				</if>
				)AS A -- 조회 결과 1
				<!-- ) -->
				<!--★맨위에서 조회할 것 여기 아래에 추가해야함 -->
		LEFT OUTER JOIN (
			SELECT
				DISTINCT 
				T.PID
				, T.ID
				, T.FILE_TRGT_KEY
				, T.CO_CD
				, T.CLMN_PLAN_SEQ
				, R.CODE_NM AS CO_NM
				, T.CLMN_NO					-- 수금번호
				, T.CLMN_DT					-- 수금일자				
				, O.ORDRS_NO AS ORDRS_NO    -- 수주번호
				, O.ORDRS_DT AS ORDRS_DT	-- 수주일자
				, O.CLNT_CD  AS CLNT_CD    	-- 고객사
				, O.CLNT_NM  AS CLNT_NM     -- 고객사명
				, O.CLNT_PJT AS CLNT_PJT  	-- 고객사PJT
				, O.CTRT_NM	 AS CTRT_NM 	-- 계약명
				, O.ORDRS_DIV AS ORDRS_DIV 	-- 수주구분
				, O.ORDRS_AMT AS ORDRS_AMT 	-- 수주금액
				, T.CURR_CD					-- 통화코드
				, R2.CODE_NM AS CURR_NM 	-- 통화코드명
				, T.BKAC_CD					-- 계좌번호
				, T.EXRATE					-- 환율
				, T.PMNTMTD_CD				-- 수금유형
				, T.CLMN_DTL_AMT 			-- 수금금액
				, T.CLMN_RMK 				-- 비고
				, O.CLMN_PLAN_DIV	 AS CLMN_PLAN_DIV	-- 수금구분
				, O.CLMN_PLAN_DIV_NM AS CLMN_PLAN_DIV_NM -- 수금구분명
				<!-- 수금구분명 -->
				<!-- , R3.CODE_NM AS CLMN_PLAN_DIV_NM   -->
				, T.CREAT_PGM
				, T.CREAT_ID
				, U1.NAME AS CREAT_ID_NM
				, T.CREAT_DTTM
				, T.UDT_PGM
				, T.UDT_ID
				, U2.NAME AS UDT_ID_NM
				, T.UDT_DTTM
				, T.LVL
		FROM ( 
			SELECT '' AS PID
					, M.CO_CD ||'_'|| M.CLMN_NO AS ID
					, M.FILE_TRGT_KEY AS FILE_TRGT_KEY
					, M.CO_CD
					, '' AS ORDRS_NO		-- 수주번호
					, '' AS CLMN_PLAN_SEQ	-- 수금계획순번
					, M.CLMN_NO	  -- 수금번호
					, TO_CHAR(M.CLMN_DT, 'YYYY-MM-DD') AS CLMN_DT	-- 수금일자
					, M.PMNTMTD_CD -- 수금유형
					, M.CURR_CD -- 통화단위
					, M.EXRATE  -- 환율
					, M.BKAC_CD -- 계좌번호
					, '' AS CLMN_DTL_AMT -- 수금금액
					, M.CLMN_RMK -- 비고
					, M.CREAT_PGM
					, M.CREAT_ID
					, TO_CHAR(M.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM
					, M.UDT_PGM
					, M.UDT_ID
					, TO_CHAR(M.UDT_DTTM, 'YYYY-MM-DD') AS UDT_DTTM
					, '1' AS LVL
			FROM   TB_CR05M01 AS M
			UNION ALL
			SELECT 	D.CO_CD ||'_'|| D.CLMN_NO AS PID
				, D.CO_CD ||'_'|| D.CLMN_NO || D.CLMN_PLAN_SEQ  AS ID
				, M.FILE_TRGT_KEY AS FILE_TRGT_KEY
				, D.CO_CD
				, D.ORDRS_NO		-- 수주번호
				, D.CLMN_PLAN_SEQ	--수금계획순번
				, M.CLMN_NO	  -- 수금번호
				, TO_CHAR(M.CLMN_DT, 'YYYY-MM-DD') AS CLMN_DT	-- 수금일자
				, M.PMNTMTD_CD -- 수금유형
				, M.CURR_CD -- 통화단위
				, M.EXRATE  -- 환율
				, M.BKAC_CD -- 계좌번호
				, D.CLMN_DTL_AMT -- 수금금액
				, M.CLMN_RMK -- 비고
				, D.CREAT_PGM
				, D.CREAT_ID
				, TO_CHAR(D.CREAT_DTTM, 'YYYY-MM-DD') AS CREAT_DTTM
				, D.UDT_PGM
				, D.UDT_ID
				, TO_CHAR(D.UDT_DTTM, 'YYYY-MM-DD') AS UDT_DTTM
				, '2' AS LVL
			FROM TB_CR05D01 AS D
			LEFT OUTER JOIN TB_CR05M01 AS M ON	M.CO_CD = D.CO_CD
					AND M.CLMN_NO	= D.CLMN_NO
				 	WHERE  1 = 1
		    ) AS T  
	<!-- ) AS C -->
	<!-- 수주마스터 조인 -->
		LEFT OUTER JOIN (
						SELECT DISTINCT SM.CO_CD
							, SM.ORDRS_NO          --수주번호
							, TO_CHAR(SM.ORDRS_DT, 'YYYY-MM-DD') AS ORDRS_DT --수주일자
							, TO_CHAR(SM.ORDRS_CLNT_CD) AS CLNT_CD --고객사
							, C.CLNT_NM                 AS CLNT_NM --고객사명
							, SM.CLNT_PJT							--고객사PJT							
							, SM.CTRT_NM
							, SM.ORDRS_DIV
							, SM.CURR_CD						-- 통화단위
							, R2.CODE_NM		AS CURR_NM    	-- 통화단위명
							, SM.ORDRS_AMT      AS ORDRS_AMT 	-- 수주금액
							, SD.CLMN_PLAN_DIV						-- 수금구분
							, R3.CODE_NM		AS CLMN_PLAN_DIV_NM -- 수금구분명
							FROM TB_CR02M01 AS SM	-- 수주마스터
							LEFT OUTER JOIN TB_CR02D01 AS SD  ON SD.CO_CD    = SM.CO_CD			--수주상세 조인
								AND SD.ORDRS_NO = SM.ORDRS_NO		
							LEFT OUTER JOIN TB_BM02M01 AS C ON C.CLNT_CD = SM.ORDRS_CLNT_CD	 	--거래처 조인
							<!-- 추가 -->
				       		LEFT OUTER JOIN TB_CM05M01 AS R  ON R.CODE_ID  = SM.CO_CD   		-- 회사
							LEFT OUTER JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = SM.ORDRS_DIV   	-- 수주구분
					    	LEFT OUTER JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = SM.CURR_CD   		-- 통화단위
							LEFT OUTER JOIN TB_CM05M01 AS R3 ON R3.CODE_ID = SD.CLMN_PLAN_DIV	-- 수금구분
					    	<!-- 추가 -->
							) AS O  ON O.CO_CD    = T.CO_CD
							AND O.ORDRS_NO = T.ORDRS_NO <!--  ★O LEFT JOIN T -->
							LEFT OUTER JOIN TB_CM05M01 AS R  ON R.CODE_ID  = T.CO_CD
							<!-- 통화단위  -->
							LEFT OUTER JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = T.CURR_CD
					    	<!-- 생성자 -->
							LEFT OUTER JOIN TB_CM06M01 AS U1 ON U1.ID = T.CREAT_ID
							<!--변경자 -->
							LEFT OUTER JOIN TB_CM06M01 AS U2 ON U2.ID = T.UDT_ID
							) AS T ON T.FILE_TRGT_KEY = A.FILE_TRGT_KEY
						WHERE  1 = 1
						ORDER BY A.FILE_TRGT_KEY, T.PID DESC, T.ID
						) AS A
					WHERE  1 = 1
		       ) AS A
			WHERE  1 = 1
			AND    A.RN BETWEEN ${firstIndex} AND ${lastIndex}
	</select>
	
	<select id="selectClmnInfoCount" parameterType="Map" resultType="int">
		SELECT COUNT(*) FROM TB_CR05D01
	</select>
	
	<select id="selectClmnInfo" parameterType="Map" resultType="camelMap">
		SELECT *
			FROM TB_CR05D01
	</select>
	
	<!-- 수금번호 -->
	<select id="select_cr05_clmnNo" parameterType="Map" resultType="String">
		SELECT 'CLMN' || TO_CHAR(SYSDATE, 'YY') ||  LPAD((SELECT (TO_CHAR(MAX(TO_NUMBER(FILE_TRGT_KEY)))) + 1 FROM TB_CR05M01),4,0) FROM DUAL;
	</select>
	
	<select id="select_cr05_SeqNext" parameterType="Map" resultType="int">
		SELECT MAX(TO_NUMBER(FILE_TRGT_KEY)) + 1
		FROM TB_CR05M01
	</select>
	
</mapper>