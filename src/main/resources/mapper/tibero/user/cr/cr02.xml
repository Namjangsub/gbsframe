<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.cr.cr02.mapper.CR02Mapper">
    <!-- ... -->

    <select id="selectOrdrsCount" resultType="int">
        SELECT
        COUNT(*)
        FROM
        TB_CR02M01 A
        WHERE 1=1
        <!-- Add any necessary conditions here -->
    </select>

    <select id="selectOrdrsList" resultType="CamelMap">
        SELECT
        *
        FROM
        (
        SELECT
        ROWNUM AS RNUM, T.*
        FROM
        (
        SELECT
        *
        FROM
        TB_CR02M01 A
        <!-- Add any necessary conditions here -->
        ) T
        )
        WHERE ROWNUM BETWEEN #{firstIndex} AND #{lastIndex}
    </select>
    <resultMap id="resultInfoMap" type="CamelMap">
        <collection select="selectPmntPlan" property="plan" column="{coCd=CO_CD, ordrsNo=ORDRS_NO}" ofType="CamelMap"/>
        <collection select="selectOrdrsDetails" property="details" column="{coCd=CO_CD, ordrsNo=ORDRS_NO}" ofType="CamelMap"/>
    </resultMap>

    <select id="selectOrdrsInfo" parameterType="map" resultMap="resultInfoMap">
        SELECT
            TO_CHAR(T.ORDRS_DT, 'YYYY-MM-DD') AS ORDRS_DT,
            TO_CHAR(T.FWD_EXCH_JOIN_DT, 'YYYY-MM-DD') AS FWD_EXCH_JOIN_DT,

            T.*
        FROM (
                 SELECT * FROM TB_CR02M01
                 WHERE CO_CD = #{coCd} AND ORDRS_NO = #{ordrsNo}
             ) T
    </select>
    <select id="selectPmntPlan" parameterType="map" resultType="CamelMap">
        SELECT

            TO_CHAR(T.CLMN_DT, 'YYYY-MM-DDd') AS CLMN_DT,
            TO_CHAR(T.BILL_PBLS_DT, 'YYYY-MM-DD') AS BILL_PBLS_DT,
            T.*
        FROM (
                 SELECT * FROM TB_CR02D01
                 WHERE CO_CD = #{coCd} AND ORDRS_NO = #{ordrsNo}
             ) T
    </select>

    <select id="selectOrdrsDetails" parameterType="map" resultType="CamelMap">
        SELECT * FROM TB_CR02D02
        WHERE CO_CD = #{coCd} AND ORDRS_NO = #{ordrsNo}
    </select>

    <select id="selectMaxOrdrsNo" resultType="java.lang.String">
        SELECT CONCAT(SUBSTR(TO_CHAR(CURRENT_DATE, 'YY'), 1, 2), LPAD(COUNT(*) + 1, 3, '0')) as maxOrdrsNo
        FROM TB_CR02M01
        WHERE CO_CD = #{coCd}
    </select>



    <insert id="insertOrdrs" parameterType="map">
        INSERT INTO TB_CR02M01 (
            CO_CD, ORDRS_NO, EST_NO, ORDRS_CLNT_CD, ORDRS_DT, ORDRS_DIV, CLNT_PJT, CTRT_NM,
            CURR_UNIT, ORDRS_AMT, FWD_EXCH_JOIN_DT, FWD_EXCH_CHK_LIST, ORDRGER, MGR, CTRT_DOC,
            PMNT_MTD, ORDRS_RMK, ORGN_SALES_CD
        )
        VALUES (
                   #{coCd}, #{ordrsNo}, #{estNo}, #{ordrsClntCd}, #{ordrsDt}, #{ordrsDiv}, #{clntPjt}, #{ctrtNm},
                   #{currUnit}, #{ordrsAmt}, #{fwdExchJoinDt}, #{fwdExchChkList}, #{ordrger}, #{mgr}, #{ctrtDoc},
                   #{pmntMtd}, #{ordrsRmk}, #{orgnSalesCd}


               )
    </insert>
    <insert id="insertClmnPlan" parameterType="map">
        INSERT INTO TB_CR02D01 (


           CO_CD,ORDRS_NO, CLMN_PLAN_SEQ, CLMN_PLAN_DIV, CLMN_DIV_SEQ, CLMN_RATE, CLMN_AMT,
            BILL_PBLS_DT, CLMN_DT, PMNT_DT_AFTER_BILL, CURR_UNIT, RMK
        )
        VALUES (

             #{coCd}, #{ordrsNo},   #{clmnPlanSeq},  #{clmnPlanDiv}, #{clmnDivSeq}, #{clmnRate}, #{clmnAmt},
               #{billPblsDt}, #{clmnDt}, #{pmntDtAfterBill}, #{currUnit}, #{rmk}


               )
    </insert>
    <insert id="insertClmnPlanHis" parameterType="map">
        INSERT INTO TB_CR02D01HIST (
            CO_CD,ORDRS_NO, CLMN_PLAN_SEQ, CLMN_PLAN_DIV, CLMN_DIV_SEQ, CLMN_RATE, CLMN_AMT,
            BILL_PBLS_DT, CLMN_DT, PMNT_DT_AFTER_BILL, CURR_UNIT, RMK,CREAT_DTTM

        )
        VALUES (

                   #{coCd}, #{ordrsNo},   #{clmnPlanSeq},  #{clmnPlanDiv}, #{clmnDivSeq}, #{clmnRate}, #{clmnAmt},
                   #{billPblsDt}, #{clmnDt}, #{pmntDtAfterBill}, #{currUnit}, #{rmk}, SYSDATE


               )
    </insert>



    <insert id="insertOrdrsDetail" parameterType="map">
        INSERT INTO TB_CR02D02 (
            CO_CD, ORDRS_NO, ORDRS_SEQ, ORDRS_DTL_DIV, PRDT_DIV, ITEM_DIV, SALES_CD, EQ_NM,
            ORDRS_PRC_MACH, ORDRS_PRC_ELCTY, ORDRS_PRC, ORDRS_QTY, EST_EPCT_MAT_PRC, TRGT_PCHS_PCOST_MACH,
            TRGT_PCHS_PCOST_ELCTY, TRGT_PCHS_PCOST_IN_HOUSE_PRCSN, LABOR_COST_MFG_COST
        )
        VALUES (
            #{coCd}, #{ordrsNo}, #{ordrsSeq}, #{ordrsDtlDiv}, #{prdtDiv}, #{itemDiv}, #{salesCd}, #{eqNm},
            #{ordrsPrcMach}, #{ordrsPrcElcty}, #{ordrsPrc}, #{ordrsQty}, #{estEpctMatPrc}, #{trgtPchsPcostMach},
            #{trgtPchsPcostElcty}, #{trgtPchsPcostInHousePrcsn}, #{laborCostMfgCost}


               )
    </insert>


    <!-- ... -->
</mapper>