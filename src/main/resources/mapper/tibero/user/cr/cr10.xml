<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.cr.cr10.mapper.CR10Mapper">
	<sql id = "selectLgistReqSql">
		  /* 물류진행요청관리 */
	WITH SJD AS  
	     (
	      SELECT M.* 
	           , C.CLNT_NM
	           , C.BIZ_ADDR||DECODE(C.BIZ_ADDR_DTL,NULL,'',' '||C.BIZ_ADDR_DTL) AS CLNT_ADDR
	           , (SELECT FN_CM05M01_CD_TO_NM(M.CLNT_PJT) FROM DUAL)            AS CLNT_PJT_NM
	        FROM TB_CR02M01  M
	              INNER JOIN TB_BM02M01 AS C ON M.ORDRS_CLNT_CD = C.CLNT_CD 
	            --INNER JOIN TB_CR02D02 AS X ON X.CO_CD = M.CO_CD AND X.ORDRS_NO = M.ORDRS_NO--수주상세  
	       WHERE 1=1
	         AND M.CO_CD = #{coCd}
	         AND M.ORDRS_DT <![CDATA[>=]]> #{pblicteDtFr}
	         AND M.ORDRS_DT <![CDATA[<=]]> #{pblicteDtTo}
	          <if test="clntNm != null and !clntNm.equals('')">
	           AND C.CLNT_NM LIKE '%'||#{clntNm}||'%'
	          </if>
	          <if test="clntPjt != null and !clntPjt.equals('')">
	           AND M.CLNT_PJT LIKE '%'||#{clntPjt}||'%'
	          </if>
	          <if test="ordrsDiv != null and !ordrsDiv.equals('')">
	           AND M.ORDRS_DIV = #{ordrsDiv}
	          </if>
	          <if test="ordrsNo != null and !ordrsNo.equals('')">
	           AND M.ORDRS_NO LIKE '%'||#{ordrsNo}||'%'
	          </if>
	          <if test="ctrtNm != null and !ctrtNm.equals('')">
	           AND M.CTRT_NM LIKE '%'||#{ctrtNm}||'%'
	          </if>
	      )
	    , LGIST_LIST AS
	      (SELECT LGIST_NO 
	             , COUNT(*)                                                        AS SALES_CD_CNT
	             , LISTAGG(SALES_CD, ' , ') WITHIN GROUP (ORDER BY SALES_CD ASC) AS SALES_CD_LIST
	          FROM TB_CR11D01 
	         WHERE 1=1 
	         GROUP BY LGIST_NO		   
	      )
	   , SCR AS
	     (
	      SELECT TO_CHAR(A.ORDRS_CLNT_CD)||T.ORDRS_NO  AS UPPER_CD
	           , T.ORDRS_NO||'-'||TRIM(TO_CHAR(ROW_NUMBER() OVER(PARTITION BY T.ORDRS_NO ORDER BY T.ORDRS_NO, T.FILE_TRGT_KEY),'0000')) AS LOWER_CD
	           , T.CO_CD
	           , T.ORDRS_NO
	           , T.ORDRS_NO||'-'||TRIM(TO_CHAR(ROW_NUMBER() OVER(PARTITION BY T.ORDRS_NO ORDER BY T.ORDRS_NO, T.FILE_TRGT_KEY),'0000')) AS TITLE
	           , A.ORDRS_CLNT_CD
	           , A.CLNT_NM AS ORDRS_CLNT_NM
	           , A.CLNT_ADDR
	           , T.CLNT_PJT
	           , A.CLNT_PJT_NM
	           , T.FILE_TRGT_KEY
	           , T.LGIST_NO
	           , T.PBLICTE_DT
	           , T.REQ_ID
	           , (SELECT FN_CM06M01_ID_TO_NM(T.REQ_ID) FROM DUAL)   	      AS REQ_ID_NM
	           , T.PART_NO
	           , T.REQ_FX_DT
	           , (SELECT FN_CM05M01_CD_TO_NM(T.CLAS_DIV) FROM DUAL)          AS CLAS_DIV_NM
	           , (SELECT FN_CM05M01_CD_TO_NM(T.TRNS_DIV) FROM DUAL)          AS TRNS_DIV_NM
	           , (SELECT FN_CM05M01_CD_TO_NM(T.DMS_TRNS_AREA_DIV) FROM DUAL) AS DMS_TRNS_AREA_DIV_NM
	           , (SELECT FN_CM05M01_CD_TO_NM(T.DMS_SEND_CND_DIV) FROM DUAL)  AS DMS_SEND_CND_DIV_NM
	           , T.DMS_SEND_CND_DIV_ETC
	           , (SELECT FN_CM05M01_CD_TO_NM(T.DMS_PACK_KIND_DIV) FROM DUAL) AS DMS_PACK_KIND_DIV_NM
	           , (SELECT FN_CM05M01_CD_TO_NM(T.OVS_TRNS_AREA_DIV) FROM DUAL) AS OVS_TRNS_AREA_DIV_NM
	           , (SELECT FN_CM05M01_CD_TO_NM(T.OVS_SEND_CND_DIV) FROM DUAL)  AS OVS_SEND_CND_DIV_NM
	           , T.OVS_SEND_CND_DIV_ETC
	           , (SELECT FN_CM05M01_CD_TO_NM(T.OVS_PACK_KIND_DIV) FROM DUAL) AS OVS_PACK_KIND_DIV_NM
	           , (SELECT FN_CM05M01_CD_TO_NM(CASE WHEN TRNS_DIV = 'LGISTDIV0301' THEN DMS_TRNS_AREA_DIV ELSE OVS_TRNS_AREA_DIV END) FROM DUAL) AS TRNS_AREA_DIV_NM
	           , CASE WHEN INSTR(DMS_SEND_CND_DIV,'99') = 13 THEN DMS_SEND_CND_DIV_ETC
	                   WHEN INSTR(OVS_SEND_CND_DIV,'99') = 13 THEN OVS_SEND_CND_DIV_ETC
	                   ELSE FN_CM05M01_CD_TO_NM(CASE WHEN TRNS_DIV = 'LGISTDIV0301' THEN DMS_SEND_CND_DIV ELSE OVS_SEND_CND_DIV END)
	             END AS SEND_CND_DIV_NM
	           , (SELECT FN_CM05M01_CD_TO_NM(CASE WHEN TRNS_DIV = 'LGISTDIV0301' THEN DMS_PACK_KIND_DIV ELSE OVS_PACK_KIND_DIV END) FROM DUAL) AS PACK_KIND_DIV_NM
	           , T.STA_PLACE
	           , T.STA_ADDR
	           , T.STA_CHRG_ID
	           , (SELECT FN_CM06M01_ID_TO_NM(T.STA_CHRG_ID) FROM DUAL) AS STA_CHRG_ID_NM
	           , T.ARVL_PLACE
	           , T.ARVL_ADDR
	           , T.ARVL_CHRG_CONT
	           , T.PRDLST_CONT
	           , T.PRD_AMT
	           , T.WIDTH_SIZE
	           , T.VRTICL_SIZE
	           , T.HEIGHT_SIZE
	           , T.FRMLC_BEFORE_WT
	           , T.FRMLC_AFTER_WT
	           , T.SHIPMNT_DT
	           , T.HOPE_ARVL_DT
	           , T.LGIST_RMK
	           , T.TODO_DIV1_CODE_ID
	           , T.TODO_DIV2_CODE_ID
	           , L.SALES_CD_LIST
	           , L.SALES_CD_CNT
	           , T.STA_CHRG_CONT
	        FROM TB_CR11M01 T
	              LEFT OUTER JOIN LGIST_LIST L ON T.LGIST_NO = L.LGIST_NO
	              INNER      JOIN SJD        A ON T.CO_CD = A.CO_CD AND T.ORDRS_NO = A.ORDRS_NO
	       WHERE  T.CO_CD = #{coCd}
	       -------------------------------------------------------------------------------------------------
	       -- 요청자, 분류구분, 운송구분, PART_NO 조건은 여기...
	       -------------------------------------------------------------------------------------------------
	      )
	    , CO_ADDR AS
	      ( 
	        SELECT BIZ_ADDR||DECODE(BIZ_ADDR_DTL,NULL,'',' '||BIZ_ADDR_DTL) AS BIZ_ADDR
	          FROM TB_BM02M01
	         WHERE ROWNUM = 1
	           AND CLNT_CD = ( SELECT CODE_ETC FROM TB_CM05M01
	                             WHERE USE_YN = 'Y' AND CODE_KIND = 'CO' AND CODE_ID = #{coCd}
	                          )
	      ) 
	SELECT (SELECT FN_CM05M01_CD_TO_NM(T.CO_CD) FROM DUAL) AS CO_NM
	      , T.*
	      , (SELECT CASE WHEN ( COUNT(A.TODO_KEY) = SUM(DECODE(NVL(A.SANCTN_STTUS, 'N'), 'N', 0, 'Y', 1) ) ) 
								THEN 'Y'
								ELSE TO_CHAR( SUM(DECODE(NVL(A.SANCTN_STTUS, 'N'), 'N', 0, 'Y', 1) ) )
				            	END TODO_YN
			   FROM TB_WB20M03 A
		      WHERE A.TODO_NO = T.LGIST_NO
		        AND A.TODO_DIV1_CODE_ID = 'TODODIV20') AS APP_STATUS
	      , ( SELECT BIZ_ADDR FROM CO_ADDR )                                                                                     AS CO_ADDR   
	  FROM (
			SELECT DISTINCT ''                      AS UPPER_CD 
	             , TO_CHAR(X.ORDRS_CLNT_CD)||X.ORDRS_NO  AS LOWER_CD  
	             , X.CO_CD                               AS CO_CD
	             , X.ORDRS_NO                            AS ORDRS_NO
	             , X.ORDRS_NO                            AS TITLE
	             , X.ORDRS_CLNT_CD                       AS ORDRS_CLNT_CD
	             , X.CLNT_NM                             AS ORDRS_CLNT_NM
	             , X.CLNT_PJT                            AS CLNT_PJT
	             , X.CLNT_PJT_NM                         AS CLNT_PJT_NM
	             , ''                                    AS FILE_TRGT_KEY
	             , ''                                    AS LGIST_NO
	             , ''                                    AS PBLICTE_DT
	             , ''                                    AS REQ_ID
	             , ''                                    AS REQ_ID_NM
	             , ''                                    AS PART_NO
	             , ''                                    AS REQ_FX_DT
	             , ''                                    AS CLAS_DIV_NM
	             , ''                                    AS TRNS_DIV_NM
	             , ''                                    AS DMS_TRNS_AREA_DIV_NM
	             , ''                                    AS DMS_SEND_CND_DIV_NM
	             , ''                                    AS DMS_SEND_CND_DIV_ETC
	             , ''                                    AS DMS_PACK_KIND_DIV_NM
	             , ''                                    AS OVS_TRNS_AREA_DIV_NM
	             , ''                                    AS OVS_SEND_CND_DIV_NM
	             , ''                                    AS OVS_SEND_CND_DIV_ETC
	             , ''                                    AS OVS_PACK_KIND_DIV_NM
	             , ''                                    AS TRNS_AREA_DIV_NM
	             , ''                                    AS SEND_CND_DIV_NM
	             , ''                                    AS PACK_KIND_DIV_NM
	             , ''                                    AS STA_PLACE
	             , ''                                    AS STA_ADDR
	             , ''                                    AS STA_CHRG_ID
	             , ''                                    AS STA_CHRG_ID_NM
	             , ''                                    AS ARVL_PLACE
	             , ''                                    AS ARVL_ADDR
	             , ''                                    AS ARVL_CHRG_CONT
	             , ''                                    AS PRDLST_CONT
	             , ''                                    AS PRD_AMT
	             , ''                                    AS WIDTH_SIZE
	             , ''                                    AS VRTICL_SIZE
	             , ''                                    AS HEIGHT_SIZE
	             , ''                                    AS FRMLC_BEFORE_WT
	             , ''                                    AS FRMLC_AFTER_WT
	             , ''                                    AS SHIPMNT_DT
	             , ''                                    AS HOPE_ARVL_DT
	             , ''                                    AS LGIST_RMK
	             , ''                                    AS TODO_DIV1_CODE_ID
	             , ''                                    AS TODO_DIV2_CODE_ID
	             , ''                                    AS SALES_CD_LIST
	             , ''                                    AS SALES_CD_CNT
	             , CLNT_ADDR                             AS CLNT_ADDR
	             , ''									 AS STA_CHRG_CONT
	          FROM SJD X
	         WHERE 1=1
	        UNION ALL
	        SELECT R.UPPER_CD         
	             , R.LOWER_CD
	             , R.CO_CD
	             , R.ORDRS_NO
	             , R.TITLE
	             , R.ORDRS_CLNT_CD
	             , R.ORDRS_CLNT_NM
	             , R.CLNT_PJT
	             , R.CLNT_PJT_NM
	             , R.FILE_TRGT_KEY
	             , R.LGIST_NO
	             , R.PBLICTE_DT
	             , R.REQ_ID
	             , R.REQ_ID_NM     
	             , R.PART_NO
	             , R.REQ_FX_DT
	             , R.CLAS_DIV_NM
	             , R.TRNS_DIV_NM
	             , R.DMS_TRNS_AREA_DIV_NM
	             , R.DMS_SEND_CND_DIV_NM
	             , R.DMS_SEND_CND_DIV_ETC
	             , R.DMS_PACK_KIND_DIV_NM
	             , R.OVS_TRNS_AREA_DIV_NM
	             , R.OVS_SEND_CND_DIV_NM
	             , R.OVS_SEND_CND_DIV_ETC
	             , R.OVS_PACK_KIND_DIV_NM
	             , R.TRNS_AREA_DIV_NM
	             , R.SEND_CND_DIV_NM
	             , R.PACK_KIND_DIV_NM
	             , R.STA_PLACE
	             , R.STA_ADDR
	             , R.STA_CHRG_ID
	             , R.STA_CHRG_ID_NM
	             , R.ARVL_PLACE
	             , R.ARVL_ADDR
	             , R.ARVL_CHRG_CONT
	             , R.PRDLST_CONT
	             , R.PRD_AMT
	             , R.WIDTH_SIZE
	             , R.VRTICL_SIZE
	             , R.HEIGHT_SIZE
	             , R.FRMLC_BEFORE_WT
	             , R.FRMLC_AFTER_WT
	             , R.SHIPMNT_DT
	             , R.HOPE_ARVL_DT
	             , R.LGIST_RMK
	             , R.TODO_DIV1_CODE_ID
	             , R.TODO_DIV2_CODE_ID
	             , R.SALES_CD_LIST
	             , R.SALES_CD_CNT
	             , R.CLNT_ADDR
	             , R.STA_CHRG_CONT
	        FROM  SCR R
	        WHERE 1=1
	       ) T
		</sql>
		
	<sql id = "selectLgistReqSql1">
	  /* 물류진행요청관리 */
WITH SJD AS  
     (
      SELECT M.* 
           , C.CLNT_NM
           , C.BIZ_ADDR||DECODE(C.BIZ_ADDR_DTL,NULL,'',' '||C.BIZ_ADDR_DTL) AS CLNT_ADDR
           , (SELECT FN_CM05M01_CD_TO_NM(M.CLNT_PJT) FROM DUAL)            AS CLNT_PJT_NM
        FROM TB_CR02M01  M
              INNER JOIN TB_BM02M01 AS C ON M.ORDRS_CLNT_CD = C.CLNT_CD 
            --INNER JOIN TB_CR02D02 AS X ON X.CO_CD = M.CO_CD AND X.ORDRS_NO = M.ORDRS_NO--수주상세  
       WHERE 1=1
         AND M.CO_CD = #{coCd}
         AND M.ORDRS_DT <![CDATA[>=]]> #{pblicteDtFr}
         AND M.ORDRS_DT <![CDATA[<=]]> #{pblicteDtTo}
          <if test="clntNm != null and !clntNm.equals('')">
           AND C.CLNT_NM LIKE '%'||#{clntNm}||'%'
          </if>
          <if test="clntPjt != null and !clntPjt.equals('')">
           AND M.CLNT_PJT LIKE '%'||#{clntPjt}||'%'
          </if>
          <if test="ordrsDiv != null and !ordrsDiv.equals('')">
           AND M.ORDRS_DIV = #{ordrsDiv}
          </if>
          <if test="ordrsNo != null and !ordrsNo.equals('')">
           AND M.ORDRS_NO LIKE '%'||#{ordrsNo}||'%'
          </if>
          <if test="ctrtNm != null and !ctrtNm.equals('')">
           AND M.CTRT_NM LIKE '%'||#{ctrtNm}||'%'
          </if>
      )
    , LGIST_LIST AS
      (SELECT LGIST_NO 
             , COUNT(*)                                                        AS SALES_CD_CNT
             , LISTAGG(SALES_CD, ' , ') WITHIN GROUP (ORDER BY SALES_CD ASC) AS SALES_CD_LIST
          FROM TB_CR11D01 
         WHERE 1=1 
         GROUP BY LGIST_NO		   
      )
   , SCR AS
     (
      SELECT TO_CHAR(A.ORDRS_CLNT_CD)||T.ORDRS_NO  AS UPPER_CD
           , T.ORDRS_NO||'-'||TRIM(TO_CHAR(ROW_NUMBER() OVER(PARTITION BY T.ORDRS_NO ORDER BY T.ORDRS_NO, T.FILE_TRGT_KEY),'0000')) AS LOWER_CD
           , T.CO_CD
           , T.ORDRS_NO
           , T.ORDRS_NO||'-'||TRIM(TO_CHAR(ROW_NUMBER() OVER(PARTITION BY T.ORDRS_NO ORDER BY T.ORDRS_NO, T.FILE_TRGT_KEY),'0000')) AS TITLE
           , A.ORDRS_CLNT_CD
           , A.CLNT_NM AS ORDRS_CLNT_NM
           , A.CLNT_ADDR
           , T.CLNT_PJT
           , A.CLNT_PJT_NM
           , T.FILE_TRGT_KEY
           , T.LGIST_NO
           , T.PBLICTE_DT
           , T.REQ_ID
           , (SELECT FN_CM06M01_ID_TO_NM(T.REQ_ID) FROM DUAL)   	      AS REQ_ID_NM
           , T.PART_NO
           , T.REQ_FX_DT
           , (SELECT FN_CM05M01_CD_TO_NM(T.CLAS_DIV) FROM DUAL)          AS CLAS_DIV_NM
           , (SELECT FN_CM05M01_CD_TO_NM(T.TRNS_DIV) FROM DUAL)          AS TRNS_DIV_NM
           , (SELECT FN_CM05M01_CD_TO_NM(T.DMS_TRNS_AREA_DIV) FROM DUAL) AS DMS_TRNS_AREA_DIV_NM
           , (SELECT FN_CM05M01_CD_TO_NM(T.DMS_SEND_CND_DIV) FROM DUAL)  AS DMS_SEND_CND_DIV_NM
           , T.DMS_SEND_CND_DIV_ETC
           , (SELECT FN_CM05M01_CD_TO_NM(T.DMS_PACK_KIND_DIV) FROM DUAL) AS DMS_PACK_KIND_DIV_NM
           , (SELECT FN_CM05M01_CD_TO_NM(T.OVS_TRNS_AREA_DIV) FROM DUAL) AS OVS_TRNS_AREA_DIV_NM
           , (SELECT FN_CM05M01_CD_TO_NM(T.OVS_SEND_CND_DIV) FROM DUAL)  AS OVS_SEND_CND_DIV_NM
           , T.OVS_SEND_CND_DIV_ETC
           , (SELECT FN_CM05M01_CD_TO_NM(T.OVS_PACK_KIND_DIV) FROM DUAL) AS OVS_PACK_KIND_DIV_NM
           , (SELECT FN_CM05M01_CD_TO_NM(CASE WHEN TRNS_DIV = 'LGISTDIV0301' THEN DMS_TRNS_AREA_DIV ELSE OVS_TRNS_AREA_DIV END) FROM DUAL) AS TRNS_AREA_DIV_NM
           , CASE WHEN INSTR(DMS_SEND_CND_DIV,'99') = 13 THEN DMS_SEND_CND_DIV_ETC
                   WHEN INSTR(OVS_SEND_CND_DIV,'99') = 13 THEN OVS_SEND_CND_DIV_ETC
                   ELSE FN_CM05M01_CD_TO_NM(CASE WHEN TRNS_DIV = 'LGISTDIV0301' THEN DMS_SEND_CND_DIV ELSE OVS_SEND_CND_DIV END)
             END AS SEND_CND_DIV_NM
           , (SELECT FN_CM05M01_CD_TO_NM(CASE WHEN TRNS_DIV = 'LGISTDIV0301' THEN DMS_PACK_KIND_DIV ELSE OVS_PACK_KIND_DIV END) FROM DUAL) AS PACK_KIND_DIV_NM
           , T.STA_PLACE
           , T.STA_ADDR
           , T.STA_CHRG_ID
           , (SELECT FN_CM06M01_ID_TO_NM(T.STA_CHRG_ID) FROM DUAL) AS STA_CHRG_ID_NM
           , T.ARVL_PLACE
           , T.ARVL_ADDR
           , T.ARVL_CHRG_CONT
           , T.PRDLST_CONT
           , T.PRD_AMT
           , T.WIDTH_SIZE
           , T.VRTICL_SIZE
           , T.HEIGHT_SIZE
           , T.FRMLC_BEFORE_WT
           , T.FRMLC_AFTER_WT
           , T.SHIPMNT_DT
           , T.HOPE_ARVL_DT
           , T.LGIST_RMK
           , T.TODO_DIV1_CODE_ID
           , T.TODO_DIV2_CODE_ID
           , L.SALES_CD_LIST
           , L.SALES_CD_CNT
           , T.STA_CHRG_CONT
        FROM TB_CR11M01 T
              LEFT OUTER JOIN LGIST_LIST L ON T.LGIST_NO = L.LGIST_NO
              INNER      JOIN SJD        A ON T.CO_CD = A.CO_CD AND T.ORDRS_NO = A.ORDRS_NO
       WHERE  T.CO_CD = #{coCd}
       -------------------------------------------------------------------------------------------------
       -- 요청자, 분류구분, 운송구분, PART_NO 조건은 여기...
       -------------------------------------------------------------------------------------------------
      )
    , CO_ADDR AS
      ( 
        SELECT BIZ_ADDR||DECODE(BIZ_ADDR_DTL,NULL,'',' '||BIZ_ADDR_DTL) AS BIZ_ADDR
          FROM TB_BM02M01
         WHERE ROWNUM = 1
           AND CLNT_CD = ( SELECT CODE_ETC FROM TB_CM05M01
                             WHERE USE_YN = 'Y' AND CODE_KIND = 'CO' AND CODE_ID = #{coCd}
                          )
      ) 
    , APP_STATUS_LIST AS
     (
      SELECT A.CO_CD
            , B.TODO_DIV1_CODE_ID
            , B.TODO_DIV2_CODE_ID
            , CASE WHEN SUM(CASE WHEN B.TODO_CF_DT IS NOT NULL THEN 1 ELSE 0 END) = SUM(CASE WHEN A.USE_YN = 'Y' THEN 1 ELSE 0 END) THEN 'APP9'
                   WHEN SUM(CASE WHEN B.TODO_CF_DT IS NOT NULL THEN 1 ELSE 0 END) <![CDATA[>]]> 0 THEN 'APP1'
                   ELSE 'APP0'
               END AS APP_STATUS
        FROM TB_BM13M01 A 
              JOIN TB_WB20M03 B  ON A.CO_CD   = B.CO_CD AND A.APP_DIV = B.TODO_DIV1_CODE_ID AND A.APP_ID  = B.TODO_ID
       WHERE  A.APP_DIV = 'APPDIV03'
       GROUP BY A.CO_CD
               , B.TODO_DIV1_CODE_ID
               , B.TODO_DIV2_CODE_ID
     )
SELECT (SELECT FN_CM05M01_CD_TO_NM(T.CO_CD) FROM DUAL) AS CO_NM
      , T.*
      , CASE WHEN T.FILE_TRGT_KEY IS NOT NULL THEN NVL(AP.APP_STATUS, 'APP0') END                                             AS APP_STATUS
      , ( SELECT BIZ_ADDR FROM CO_ADDR )                                                                                     AS CO_ADDR   
  FROM (
		SELECT DISTINCT ''                      AS UPPER_CD 
             , TO_CHAR(X.ORDRS_CLNT_CD)||X.ORDRS_NO  AS LOWER_CD  
             , X.CO_CD                               AS CO_CD
             , X.ORDRS_NO                            AS ORDRS_NO
             , X.ORDRS_NO                            AS TITLE
             , X.ORDRS_CLNT_CD                       AS ORDRS_CLNT_CD
             , X.CLNT_NM                             AS ORDRS_CLNT_NM
             , X.CLNT_PJT                            AS CLNT_PJT
             , X.CLNT_PJT_NM                         AS CLNT_PJT_NM
             , ''                                    AS FILE_TRGT_KEY
             , ''                                    AS LGIST_NO
             , ''                                    AS PBLICTE_DT
             , ''                                    AS REQ_ID
             , ''                                    AS REQ_ID_NM
             , ''                                    AS PART_NO
             , ''                                    AS REQ_FX_DT
             , ''                                    AS CLAS_DIV_NM
             , ''                                    AS TRNS_DIV_NM
             , ''                                    AS DMS_TRNS_AREA_DIV_NM
             , ''                                    AS DMS_SEND_CND_DIV_NM
             , ''                                    AS DMS_SEND_CND_DIV_ETC
             , ''                                    AS DMS_PACK_KIND_DIV_NM
             , ''                                    AS OVS_TRNS_AREA_DIV_NM
             , ''                                    AS OVS_SEND_CND_DIV_NM
             , ''                                    AS OVS_SEND_CND_DIV_ETC
             , ''                                    AS OVS_PACK_KIND_DIV_NM
             , ''                                    AS TRNS_AREA_DIV_NM
             , ''                                    AS SEND_CND_DIV_NM
             , ''                                    AS PACK_KIND_DIV_NM
             , ''                                    AS STA_PLACE
             , ''                                    AS STA_ADDR
             , ''                                    AS STA_CHRG_ID
             , ''                                    AS STA_CHRG_ID_NM
             , ''                                    AS ARVL_PLACE
             , ''                                    AS ARVL_ADDR
             , ''                                    AS ARVL_CHRG_CONT
             , ''                                    AS PRDLST_CONT
             , ''                                    AS PRD_AMT
             , ''                                    AS WIDTH_SIZE
             , ''                                    AS VRTICL_SIZE
             , ''                                    AS HEIGHT_SIZE
             , ''                                    AS FRMLC_BEFORE_WT
             , ''                                    AS FRMLC_AFTER_WT
             , ''                                    AS SHIPMNT_DT
             , ''                                    AS HOPE_ARVL_DT
             , ''                                    AS LGIST_RMK
             , ''                                    AS TODO_DIV1_CODE_ID
             , ''                                    AS TODO_DIV2_CODE_ID
             , ''                                    AS SALES_CD_LIST
             , ''                                    AS SALES_CD_CNT
             , CLNT_ADDR                             AS CLNT_ADDR
             , ''									 AS STA_CHRG_CONT
          FROM SJD X
         WHERE 1=1
        UNION ALL
        SELECT R.UPPER_CD         
             , R.LOWER_CD
             , R.CO_CD
             , R.ORDRS_NO
             , R.TITLE
             , R.ORDRS_CLNT_CD
             , R.ORDRS_CLNT_NM
             , R.CLNT_PJT
             , R.CLNT_PJT_NM
             , R.FILE_TRGT_KEY
             , R.LGIST_NO
             , R.PBLICTE_DT
             , R.REQ_ID
             , R.REQ_ID_NM     
             , R.PART_NO
             , R.REQ_FX_DT
             , R.CLAS_DIV_NM
             , R.TRNS_DIV_NM
             , R.DMS_TRNS_AREA_DIV_NM
             , R.DMS_SEND_CND_DIV_NM
             , R.DMS_SEND_CND_DIV_ETC
             , R.DMS_PACK_KIND_DIV_NM
             , R.OVS_TRNS_AREA_DIV_NM
             , R.OVS_SEND_CND_DIV_NM
             , R.OVS_SEND_CND_DIV_ETC
             , R.OVS_PACK_KIND_DIV_NM
             , R.TRNS_AREA_DIV_NM
             , R.SEND_CND_DIV_NM
             , R.PACK_KIND_DIV_NM
             , R.STA_PLACE
             , R.STA_ADDR
             , R.STA_CHRG_ID
             , R.STA_CHRG_ID_NM
             , R.ARVL_PLACE
             , R.ARVL_ADDR
             , R.ARVL_CHRG_CONT
             , R.PRDLST_CONT
             , R.PRD_AMT
             , R.WIDTH_SIZE
             , R.VRTICL_SIZE
             , R.HEIGHT_SIZE
             , R.FRMLC_BEFORE_WT
             , R.FRMLC_AFTER_WT
             , R.SHIPMNT_DT
             , R.HOPE_ARVL_DT
             , R.LGIST_RMK
             , R.TODO_DIV1_CODE_ID
             , R.TODO_DIV2_CODE_ID
             , R.SALES_CD_LIST
             , R.SALES_CD_CNT
             , R.CLNT_ADDR
             , R.STA_CHRG_CONT
        FROM  SCR R
        WHERE 1=1
       ) T
         LEFT OUTER JOIN APP_STATUS_LIST AP  ON T.CO_CD = AP.CO_CD
                                            AND T.TODO_DIV1_CODE_ID = AP.TODO_DIV1_CODE_ID
                                            AND T.TODO_DIV2_CODE_ID = AP.TODO_DIV2_CODE_ID
	</sql>
	<sql id="selectLgistReqSql2">
		WITH APP_STATUS_LIST AS (
			SELECT A.CO_CD
			     , B.TODO_DIV1_CODE_ID
				 , B.TODO_DIV2_CODE_ID
			     , CASE WHEN SUM(CASE WHEN B.TODO_CF_DT IS NOT NULL THEN 1 ELSE 0 END) = SUM(CASE WHEN A.USE_YN = 'Y' THEN 1 ELSE 0 END) THEN 'APP9'
					    WHEN SUM(CASE WHEN B.TODO_CF_DT IS NOT NULL THEN 1 ELSE 0 END) <![CDATA[>]]> 0 THEN 'APP1'
		            	ELSE 'APP0'
				   END AS APP_STATUS
			FROM   TB_BM13M01 A
			       JOIN TB_WB20M03 B  ON A.CO_CD   = B.CO_CD
				                     AND A.APP_DIV = B.TODO_DIV1_CODE_ID
									 AND A.APP_ID  = B.TODO_ID
			WHERE  A.APP_DIV = 'APPDIV03'
			GROUP BY A.CO_CD, B.TODO_DIV1_CODE_ID, B.TODO_DIV2_CODE_ID
		)
		, APP_TODO_LIST AS (
			SELECT A.CO_CD
			     , B.TODO_DIV1_CODE_ID
				 , B.TODO_DIV2_CODE_ID
				 , A.APP_SEQ
				 , B.TODO_ID
				 , FN_CM06M01_ID_TO_NM(B.TODO_ID) AS TODO_ID_NM
				 , DECODE(B.TODO_CF_DT,NULL,'N','Y') AS TODO_CF_YN
				 , X.DEPT_NM
				 , (SELECT LEVEL_NM FROM TB_CM07M01 WHERE LEVEL_CD=X.LEVEL_CD) AS LEVEL_NM
			FROM   TB_BM13M01 A
				   JOIN TB_WB20M03 B  ON A.CO_CD   = B.CO_CD
				                     AND A.APP_DIV = B.TODO_DIV1_CODE_ID
									 AND A.APP_ID  = B.TODO_ID
				   LEFT OUTER JOIN (
					                SELECT BB.ID
									     , BB.NAME
										 , BB.LEVEL_CD
										 , BB.EMAIL
										 , BB.TEL_NO
										 , BB.OFF_TEL_NO
										 , BB.FAX_NO
										 , CC.DEPT_NM
									FROM   TB_CM06M01 BB
									       INNER JOIN TB_CM04M01 CC ON(BB.DEPT_ID=CC.DEPT_ID)
									WHERE  1 = 1
				                   ) X ON(B.TODO_ID=X.ID)
			WHERE  A.APP_DIV = 'APPDIV03'
		)
		SELECT LEVEL AS LEV
		     , FN_CM05M01_CD_TO_NM(T.CO_CD) CO_NM
			 , T.*
			 , FN_CM06M01_ID_TO_NM(T.STA_CHRG_ID) AS STA_CHRG_ID_NM
			 , (SELECT LISTAGG(SALES_CD, ' , ') WITHIN GROUP (ORDER BY SALES_CD ASC) FROM TB_CR11D01 WHERE LGIST_NO = T.LGIST_NO) AS SALES_CD_LIST
			 , CASE WHEN LGIST_NO IS NULL THEN '' ELSE (SELECT COUNT(*) FROM TB_CR11D01 WHERE LGIST_NO = T.LGIST_NO) END AS SALES_CD_CNT
			 , REGEXP_REPLACE(SYS_CONNECT_BY_PATH(T.LOWER_CD, ' -> '), '^\s+\-\>\s+', '') AS PATH
			 , CASE WHEN T.FILE_TRGT_KEY IS NOT NULL THEN NVL(AP.APP_STATUS, 'APP0') END AS APP_STATUS
			 , ( SELECT BIZ_ADDR||DECODE(BIZ_ADDR_DTL,NULL,'',' '||BIZ_ADDR_DTL) AS BIZ_ADDR
			     FROM   TB_BM02M01
				 WHERE  CLNT_CD = (
					               SELECT CODE_ETC
				                   FROM   TB_CM05M01
								   WHERE  USE_YN = 'Y'
								   AND    CODE_KIND = 'CO'
								   AND    CODE_ID = #{coCd}
								  )
			   ) AS CO_ADDR
			 , ( SELECT BIZ_ADDR||DECODE(BIZ_ADDR_DTL,NULL,'',' '||BIZ_ADDR_DTL) AS BIZ_ADDR
			     FROM   TB_BM02M01
				 WHERE  CLNT_CD = T.ORDRS_CLNT_CD ) AS CLNT_ADDR
		FROM   (
				/* top -> 회사 -> 고객사 */
				SELECT DISTINCT
				       'top' AS UPPER_CD
					 , TO_CHAR(Y.ORDRS_CLNT_CD) LOWER_CD
					 , X.CO_CD
					 , '' AS ORDRS_NO
					 , A.CLNT_NM AS TITLE
					 , Y.ORDRS_CLNT_CD
					 , A.CLNT_NM  AS ORDRS_CLNT_NM
					 , '' AS CLNT_PJT
					 , '' AS CLNT_PJT_NM
					 , '' AS FILE_TRGT_KEY
					 , '' AS LGIST_NO
					 , '' AS PBLICTE_DT
					 , '' AS REQ_ID
					 , '' AS REQ_ID_NM
					 , '' AS PART_NO
					 , '' AS REQ_FX_DT
					 , '' AS CLAS_DIV_NM
					 , '' AS TRNS_DIV_NM
					 , '' AS DMS_TRNS_AREA_DIV_NM
					 , '' AS DMS_SEND_CND_DIV_NM
					 , '' AS DMS_SEND_CND_DIV_ETC
					 , '' AS DMS_PACK_KIND_DIV_NM
					 , '' AS OVS_TRNS_AREA_DIV_NM
					 , '' AS OVS_SEND_CND_DIV_NM
					 , '' AS OVS_SEND_CND_DIV_ETC
					 , '' AS OVS_PACK_KIND_DIV_NM
					 , '' AS TRNS_AREA_DIV_NM
					 , '' AS SEND_CND_DIV_NM
					 , '' AS PACK_KIND_DIV_NM
					 , '' AS STA_PLACE
					 , '' AS STA_ADDR
					 , '' AS STA_CHRG_ID
					 , '' AS ARVL_PLACE
					 , '' AS ARVL_ADDR
					 , '' AS ARVL_CHRG_CONT
					 , '' AS PRDLST_CONT
					 , '' AS PRD_AMT
					 , '' AS WIDTH_SIZE
					 , '' AS VRTICL_SIZE
					 , '' AS HEIGHT_SIZE
					 , '' AS FRMLC_BEFORE_WT
					 , '' AS FRMLC_AFTER_WT
					 , '' AS SHIPMNT_DT
					 , '' AS HOPE_ARVL_DT
					 , '' AS LGIST_RMK
					 , '' AS TODO_DIV1_CODE_ID
					 , '' AS TODO_DIV2_CODE_ID
				FROM   TB_CR02D02 X
				       INNER JOIN TB_CR02M01 Y  ON X.CO_CD    = Y.CO_CD
					                           AND X.ORDRS_NO = Y.ORDRS_NO
				       LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD
				WHERE  X.CO_CD = #{coCd}
				<if test="clntNm != null and !clntNm.equals('')">
				AND    A.CLNT_NM LIKE '%'||#{clntNm}||'%'
				</if>
				UNION ALL
				/* top -> 고객사 -> 수주번호 */
				SELECT DISTINCT
				       TO_CHAR(Y.ORDRS_CLNT_CD) UPPER_CD
					 , X.ORDRS_NO LOWER_CD
					 , X.CO_CD
					 , X.ORDRS_NO
					 , X.ORDRS_NO AS TITLE
					 , Y.ORDRS_CLNT_CD
					 , A.CLNT_NM AS ORDRS_CLNT_NM
					 , Y.CLNT_PJT
					 , FN_CM05M01_CD_TO_NM(Y.CLNT_PJT) AS CLNT_PJT_NM
					 , '' AS FILE_TRGT_KEY
					 , '' AS LGIST_NO
					 , '' AS PBLICTE_DT
					 , '' AS REQ_ID
					 , '' AS REQ_ID_NM
					 , '' AS PART_NO
					 , '' AS REQ_FX_DT
					 , '' AS CLAS_DIV_NM
					 , '' AS TRNS_DIV_NM
					 , '' AS DMS_TRNS_AREA_DIV_NM
					 , '' AS DMS_SEND_CND_DIV_NM
					 , '' AS DMS_SEND_CND_DIV_ETC
					 , '' AS DMS_PACK_KIND_DIV_NM
					 , '' AS OVS_TRNS_AREA_DIV_NM
					 , '' AS OVS_SEND_CND_DIV_NM
					 , '' AS OVS_SEND_CND_DIV_ETC
					 , '' AS OVS_PACK_KIND_DIV_NM
					 , '' AS TRNS_AREA_DIV_NM
					 , '' AS SEND_CND_DIV_NM
					 , '' AS PACK_KIND_DIV_NM
					 , '' AS STA_PLACE
					 , '' AS STA_ADDR
					 , '' AS STA_CHRG_ID
					 , '' AS ARVL_PLACE
					 , '' AS ARVL_ADDR
					 , '' AS ARVL_CHRG_CONT
					 , '' AS PRDLST_CONT
					 , '' AS PRD_AMT
					 , '' AS WIDTH_SIZE
					 , '' AS VRTICL_SIZE
					 , '' AS HEIGHT_SIZE
					 , '' AS FRMLC_BEFORE_WT
					 , '' AS FRMLC_AFTER_WT
					 , '' AS SHIPMNT_DT
					 , '' AS HOPE_ARVL_DT
					 , '' AS LGIST_RMK
					 , '' AS TODO_DIV1_CODE_ID
					 , '' AS TODO_DIV2_CODE_ID
				FROM   TB_CR02D02 X
				       INNER JOIN TB_CR02M01 Y  ON X.CO_CD    = Y.CO_CD
					                           AND X.ORDRS_NO = Y.ORDRS_NO
				       LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD
				WHERE  X.CO_CD = #{coCd}
				<if test="clntNm != null and !clntNm.equals('')">
				AND    A.CLNT_NM LIKE '%'||#{clntNm}||'%'
				</if>
				<if test="clntPjt != null and !clntPjt.equals('')">
				AND    Y.CLNT_PJT LIKE '%'||#{clntPjt}||'%'
				</if>
				UNION ALL
				/* top -> 고객사 -> 수주번호 -> 물류번호 */
				SELECT T.ORDRS_NO AS UPPER_CD
				     , T.ORDRS_NO||'-'||TRIM(TO_CHAR(ROW_NUMBER() OVER(PARTITION BY T.ORDRS_NO ORDER BY T.ORDRS_NO, T.FILE_TRGT_KEY),'0000')) AS LOWER_CD
					 , T.CO_CD
					 , T.ORDRS_NO
					 , T.ORDRS_NO||'-'||TRIM(TO_CHAR(ROW_NUMBER() OVER(PARTITION BY T.ORDRS_NO ORDER BY T.ORDRS_NO, T.FILE_TRGT_KEY),'0000')) AS TITLE
					 , A.ORDRS_CLNT_CD
					 , B.CLNT_NM AS ORDRS_CLNT_NM
					 , T.CLNT_PJT
					 , FN_CM05M01_CD_TO_NM(T.CLNT_PJT) AS CLNT_PJT_NM
					 , T.FILE_TRGT_KEY
					 , T.LGIST_NO
					 , T.PBLICTE_DT
					 , T.REQ_ID
					 , U.NAME AS REQ_ID_NM
					 , T.PART_NO
					 , T.REQ_FX_DT
					 , FN_CM05M01_CD_TO_NM(T.CLAS_DIV) AS CLAS_DIV_NM
					 , FN_CM05M01_CD_TO_NM(T.TRNS_DIV) AS TRNS_DIV_NM
					 , FN_CM05M01_CD_TO_NM(T.DMS_TRNS_AREA_DIV) AS DMS_TRNS_AREA_DIV_NM
					 , FN_CM05M01_CD_TO_NM(T.DMS_SEND_CND_DIV) AS DMS_SEND_CND_DIV_NM
					 , T.DMS_SEND_CND_DIV_ETC
					 , FN_CM05M01_CD_TO_NM(T.DMS_PACK_KIND_DIV) AS DMS_PACK_KIND_DIV_NM
					 , FN_CM05M01_CD_TO_NM(T.OVS_TRNS_AREA_DIV) AS OVS_TRNS_AREA_DIV_NM
					 , FN_CM05M01_CD_TO_NM(T.OVS_SEND_CND_DIV) AS OVS_SEND_CND_DIV_NM
					 , T.OVS_SEND_CND_DIV_ETC
					 , FN_CM05M01_CD_TO_NM(T.OVS_PACK_KIND_DIV) AS OVS_PACK_KIND_DIV_NM
					 , FN_CM05M01_CD_TO_NM(CASE WHEN TRNS_DIV = 'LGISTDIV0301' THEN DMS_TRNS_AREA_DIV ELSE OVS_TRNS_AREA_DIV END) AS TRNS_AREA_DIV_NM
					 , CASE WHEN INSTR(DMS_SEND_CND_DIV,'99') = 13 THEN DMS_SEND_CND_DIV_ETC
					        WHEN INSTR(OVS_SEND_CND_DIV,'99') = 13 THEN OVS_SEND_CND_DIV_ETC
							ELSE FN_CM05M01_CD_TO_NM(CASE WHEN TRNS_DIV = 'LGISTDIV0301' THEN DMS_SEND_CND_DIV ELSE OVS_SEND_CND_DIV END)
					   END AS SEND_CND_DIV_NM
					 , FN_CM05M01_CD_TO_NM(CASE WHEN TRNS_DIV = 'LGISTDIV0301' THEN DMS_PACK_KIND_DIV ELSE OVS_PACK_KIND_DIV END) AS PACK_KIND_DIV_NM
					 , T.STA_PLACE
					 , T.STA_ADDR
					 , T.STA_CHRG_ID
					 , T.ARVL_PLACE
					 , T.ARVL_ADDR
					 , T.ARVL_CHRG_CONT
					 , T.PRDLST_CONT
					 , T.PRD_AMT
					 , T.WIDTH_SIZE
					 , T.VRTICL_SIZE
					 , T.HEIGHT_SIZE
					 , T.FRMLC_BEFORE_WT
					 , T.FRMLC_AFTER_WT
					 , T.SHIPMNT_DT
					 , T.HOPE_ARVL_DT
					 , T.LGIST_RMK
					 , T.TODO_DIV1_CODE_ID
					 , T.TODO_DIV2_CODE_ID
				FROM   TB_CR11M01 T
				       LEFT OUTER JOIN TB_CR02M01 A ON T.CO_CD = A.CO_CD AND T.ORDRS_NO = A.ORDRS_NO
				       LEFT OUTER JOIN TB_BM02M01 B ON A.ORDRS_CLNT_CD = B.CLNT_CD
					   LEFT OUTER JOIN TB_CM06M01 U ON T.REQ_ID = U.ID
				WHERE  T.CO_CD = #{coCd}
				AND    T.PBLICTE_DT <![CDATA[>=]]> #{pblicteDtFr}
				AND    T.PBLICTE_DT <![CDATA[<=]]> #{pblicteDtTo}
				<if test="reqIdNm != null and !reqIdNm.equals('')">
				AND    U.NAME LIKE '%'||#{reqIdNm}||'%'
				</if>
				<if test="clntNm != null and !clntNm.equals('')">
				AND    B.CLNT_NM LIKE '%'||#{clntNm}||'%'
				</if>
				<if test="clntPjt != null and !clntPjt.equals('')">
				AND    T.CLNT_PJT LIKE '%'||#{clntPjt}||'%'
				</if>
				<if test="clasDiv != null and !clasDiv.equals('')">
				AND    T.CLAS_DIV = #{clasDiv}
				</if>
				<if test="trnsDiv != null and !trnsDiv.equals('')">
				AND    T.TRNS_DIV = #{trnsDiv}
				</if>
				<if test="partNo != null and !partNo.equals('')">
				AND    T.PART_NO LIKE '%'||#{partNo}||'%'
				</if>
		       ) T
		       LEFT OUTER JOIN APP_STATUS_LIST AP  ON T.CO_CD = AP.CO_CD
			                                      AND T.TODO_DIV1_CODE_ID = AP.TODO_DIV1_CODE_ID
												  AND T.TODO_DIV2_CODE_ID = AP.TODO_DIV2_CODE_ID
		START WITH UPPER_CD = 'top' CONNECT BY PRIOR LOWER_CD = UPPER_CD
		ORDER BY PATH
	</sql>

	<select id="selectLgistReqPageCount" parameterType="Map" resultType="int">
        SELECT
        COUNT(*)
        FROM (
        	<include refid="selectLgistReqSql"></include>
        )
	</select>

	<select id="selectLgistReqPageList" parameterType="Map" resultType="CamelMap">
        SELECT
        *
        FROM(
        SELECT
        ROWNUM AS RNUM, A.*
        FROM
        (
        <include refid="selectLgistReqSql"></include>
        ) AS a
        ) A
        WHERE RNUM BETWEEN #{firstIndex} AND #{lastIndex}
	</select>

	<select id="selectLgistReqList" parameterType="Map" resultType="CamelMap">
        <include refid="selectLgistReqSql"></include>
	</select>

	<select id="selectSelesCdList" parameterType="Map" resultType="camelMap">
       SELECT '' AS DTA_CHK
			, X.CO_CD
			, X.ORDRS_NO
			, X.ORDRS_SEQ
			, X.SALES_CD
			, #{lgistNo} AS LGIST_NO
			, T.SALES_SEQ
			, CASE WHEN T.SALES_SEQ IS NOT NULL THEN 'Y' ELSE 'N' END AS CHK_YN
			, #{clasDiv, jdbcType=VARCHAR} AS CLAS_DIV
			, (SELECT CASE WHEN COUNT(*) = 0 THEN 'N' ELSE 'Y' END FROM TB_CR11M01 A1
						LEFT OUTER JOIN TB_CR11D01 B1 ON A1.LGIST_NO = B1.LGIST_NO
			          	WHERE A1.CO_CD = X.CO_CD AND A1.ORDRS_NO = X.ORDRS_NO AND A1.CLAS_DIV = #{clasDiv, jdbcType=VARCHAR} AND B1.SALES_CD = X.SALES_CD
			  ) AS USE_YN
			, (SELECT CASE WHEN COUNT(*) = 0 THEN 'N' ELSE 'Y' END FROM TB_CR11M01 A1
						LEFT OUTER JOIN TB_CR11D01 B1 ON A1.LGIST_NO = B1.LGIST_NO
			          	WHERE A1.CO_CD = X.CO_CD AND A1.ORDRS_NO = X.ORDRS_NO AND A1.CLAS_DIV = #{clasDiv, jdbcType=VARCHAR} AND B1.SALES_CD = X.SALES_CD
			  ) AS OLD_USE_YN
			, (SELECT CASE WHEN COUNT(*) = 0 THEN 'N' ELSE 'Y' END FROM TB_CR11M01 A1
						LEFT OUTER JOIN TB_CR11D01 B1 ON A1.LGIST_NO = B1.LGIST_NO
			          	WHERE A1.CO_CD = X.CO_CD AND A1.ORDRS_NO = X.ORDRS_NO AND A1.CLAS_DIV = #{clasDiv, jdbcType=VARCHAR} AND B1.SALES_CD = X.SALES_CD
			          	  AND A1.LGIST_NO <![CDATA[<>]]> #{lgistNo, jdbcType=VARCHAR}
			  ) AS ANO_USE_YN
			, Y.ORDRS_CLNT_CD -- 고객사
			, A.CLNT_NM AS ORDRS_CLNT_NM
			, Y.CLNT_PJT -- 고객사 PJT
			, FN_CM05M01_CD_TO_NM(X.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM -- 신작구분
			, FN_CM05M01_CD_TO_NM(X.ORDRS_DTL_DIV30) AS ORDRS_DTL_DIV30_NM -- 자체구분
			, X.PRDT_CD -- 제품구분
			, P.PRDT_NM AS PRDT_CD_NM
			, X.ITEM_DIV -- 아이템구분
			, FN_CM05M01_CD_TO_NM(X.ITEM_DIV) AS ITEM_DIV_NM
			, TO_CHAR(X.DUDT_INTEND_DT,'YYYY-MM-DD') AS DUDT_INTEND_DT --납기예정일
			, X.EQP_NM -- 설비명
         FROM TB_CR02D02 X
               INNER JOIN TB_CR02M01 Y ON X.CO_CD = Y.CO_CD AND X.ORDRS_NO = Y.ORDRS_NO
               LEFT OUTER JOIN TB_BM01M01 P ON X.PRDT_CD = P.PRDT_CD  --제품마스터
               LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD --거래처마스터
               LEFT OUTER JOIN TB_CR11D01 T ON T.SALES_CD = X.SALES_CD AND T.LGIST_NO = #{lgistNo, jdbcType=VARCHAR}
		WHERE X.SALES_CD IS NOT NULL
		  AND X.CO_CD = #{coCd}
		  AND X.ORDRS_NO = #{ordrsNo}
	    ORDER BY X.ORDRS_SEQ
	</select>

	<select id="selectSelesCdViewList" parameterType="Map" resultType="camelMap">
       SELECT   T.CO_CD
       		  , T.ORDRS_NO
       		  , T1.SALES_CD
       		  , T.LGIST_NO
       		  , T1.SALES_SEQ
       		  , 'Y' AS CHK_YN
       		  , Y.ORDRS_CLNT_CD
       		  , A.CLNT_NM AS ORDRS_CLNT_NM
       		  , Y.CLNT_PJT
       		  , FN_CM05M01_CD_TO_NM(X.ORDRS_DTL_DIV20) AS ORDRS_DTL_DIV20_NM
       		  , FN_CM05M01_CD_TO_NM(X.ORDRS_DTL_DIV30) AS ORDRS_DTL_DIV30_NM
       		  , X.PRDT_CD
       		  , P.PRDT_NM AS PRDT_CD_NM
       		  , FN_CM05M01_CD_TO_NM(X.ITEM_DIV) AS ITEM_DIV_NM
       		  , TO_CHAR(X.DUDT_INTEND_DT,'YYYY-MM-DD') AS DUDT_INTEND_DT
       		  , X.EQP_NM
		FROM TB_CR11M01 T
		LEFT OUTER JOIN TB_CR11D01 T1 ON T.LGIST_NO = T1.LGIST_NO
		INNER JOIN TB_CR02M01 Y  ON T.CO_CD = Y.CO_CD AND T.ORDRS_NO = Y.ORDRS_NO
		LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD
		LEFT OUTER JOIN TB_CR02D02 X ON X.CO_CD = T.CO_CD AND X.ORDRS_NO = T.ORDRS_NO AND X.SALES_CD = T1.SALES_CD
		LEFT OUTER JOIN TB_BM01M01 P ON X.PRDT_CD = P.PRDT_CD
		WHERE T.FILE_TRGT_KEY = #{fileTrgtKey}
		  AND T1.SALES_CD IS NOT NULL
		ORDER BY T1.SALES_SEQ
	</select>

	<select id="selectLgistMastInfo" resultType="camelMap">
		WITH APP_STATUS_LIST AS (
			SELECT A.CO_CD, B.TODO_DIV1_CODE_ID, B.TODO_DIV2_CODE_ID
			     , CASE WHEN SUM(CASE WHEN B.TODO_CF_DT IS NOT NULL THEN 1 ELSE 0 END) = SUM(CASE WHEN A.USE_YN = 'Y' THEN 1 ELSE 0 END) THEN 'APP9'
			     		WHEN SUM(CASE WHEN B.TODO_CF_DT IS NOT NULL THEN 1 ELSE 0 END) > 0 THEN 'APP1'
		            	ELSE 'APP0'
		        END AS APP_STATUS
			   FROM TB_BM13M01 A
			   JOIN TB_WB20M03 B ON A.CO_CD = B.CO_CD AND A.APP_DIV = B.TODO_DIV1_CODE_ID AND A.APP_ID = B.TODO_ID
			  WHERE A.APP_DIV = 'APPDIV03'
			  GROUP BY A.CO_CD, B.TODO_DIV1_CODE_ID, B.TODO_DIV2_CODE_ID
		)
		, APP_TODO_LIST AS (
			SELECT A.CO_CD, B.TODO_DIV1_CODE_ID, B.TODO_DIV2_CODE_ID, A.APP_SEQ,  B.TODO_ID,  FN_CM06M01_ID_TO_NM(B.TODO_ID) AS TODO_ID_NM , DECODE(B.TODO_CF_DT,NULL,'N','Y') AS TODO_CF_YN
				   , X.DEPT_NM , (SELECT LEVEL_NM FROM TB_CM07M01 WHERE LEVEL_CD=X.LEVEL_CD) AS LEVEL_NM
				   FROM TB_BM13M01 A
				   JOIN TB_WB20M03 B ON A.CO_CD = B.CO_CD AND A.APP_DIV = B.TODO_DIV1_CODE_ID AND A.APP_ID = B.TODO_ID
				   LEFT OUTER JOIN (
							SELECT BB.ID
									, BB.NAME
									, BB.LEVEL_CD
									, BB.EMAIL
									, BB.TEL_NO
									, BB.OFF_TEL_NO
									, BB.FAX_NO
									, CC.DEPT_NM
								FROM TB_CM06M01 BB
								INNER JOIN TB_CM04M01 CC ON(BB.DEPT_ID=CC.DEPT_ID)
							) X ON(B.TODO_ID=X.ID)
				  WHERE A.APP_DIV = 'APPDIV03'
		)
		SELECT FILE_TRGT_KEY
		, T.CO_CD
		, FN_CM05M01_CD_TO_NM(T.CO_CD) CO_NM
		, T.LGIST_NO
		, T.ORDRS_NO
		, (SELECT A.CLNT_NM FROM TB_CR02M01 Y
	            LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD
	            WHERE T.CO_CD = Y.CO_CD AND T.ORDRS_NO = Y.ORDRS_NO
		  ) AS ORDRS_CLNT_NM
		, T.CLNT_PJT
		, FN_CM05M01_CD_TO_NM(T.CLNT_PJT) AS CLNT_PJT_NM
		, T.PBLICTE_DT
		, T.REQ_ID
		, FN_CM06M01_ID_TO_NM(T.REQ_ID) AS REQ_ID_NM
		, T.PART_NO
		, T.REQ_FX_DT
		, T.CLAS_DIV
		, T.TRNS_DIV
		, T.DMS_TRNS_AREA_DIV
		, T.DMS_SEND_CND_DIV
		, T.DMS_SEND_CND_DIV_ETC
		, T.DMS_PACK_KIND_DIV
		, T.OVS_TRNS_AREA_DIV
		, T.OVS_SEND_CND_DIV
		, T.OVS_SEND_CND_DIV_ETC
		, T.OVS_PACK_KIND_DIV
		, T.STA_PLACE
		, T.STA_ADDR
		, T.STA_CHRG_ID
		, FN_CM06M01_ID_TO_NM(T.STA_CHRG_ID) AS STA_CHRG_ID_NM
		, (SELECT TEL_NO FROM TB_CM06M01 WHERE ID = T.STA_CHRG_ID) AS STA_CHRG_ID_TEL_NO
		, T.ARVL_PLACE
		, T.ARVL_ADDR
		, T.ARVL_CHRG_CONT
		, T.PRDLST_CONT
		, T.PRD_AMT
		, T.WIDTH_SIZE
		, T.VRTICL_SIZE
		, T.HEIGHT_SIZE
		, T.FRMLC_BEFORE_WT
		, T.FRMLC_AFTER_WT
		, T.SHIPMNT_DT
		, T.HOPE_ARVL_DT
		, T.LGIST_RMK
		, T.TODO_DIV1_CODE_ID
		, T.TODO_DIV2_CODE_ID
		, FN_CM05M01_CD_TO_NM(T.CLAS_DIV) AS CLAS_DIV_NM
		, FN_CM05M01_CD_TO_NM(T.TRNS_DIV) AS TRNS_DIV_NM
		, FN_CM05M01_CD_TO_NM(T.DMS_TRNS_AREA_DIV) AS DMS_TRNS_AREA_DIV_NM
		, FN_CM05M01_CD_TO_NM(T.DMS_SEND_CND_DIV) AS DMS_SEND_CND_DIV_NM
		, FN_CM05M01_CD_TO_NM(T.DMS_PACK_KIND_DIV) AS DMS_PACK_KIND_DIV_NM
		, FN_CM05M01_CD_TO_NM(T.OVS_TRNS_AREA_DIV) AS OVS_TRNS_AREA_DIV_NM
		, FN_CM05M01_CD_TO_NM(T.OVS_SEND_CND_DIV) AS OVS_SEND_CND_DIV_NM
		, FN_CM05M01_CD_TO_NM(T.OVS_PACK_KIND_DIV) AS OVS_PACK_KIND_DIV_NM
		, FN_CM05M01_CD_TO_NM(CASE WHEN T.TRNS_DIV = 'LGISTDIV0301' THEN T.DMS_TRNS_AREA_DIV ELSE T.OVS_TRNS_AREA_DIV END) AS TRNS_AREA_DIV_NM
		, CASE WHEN INSTR(T.DMS_SEND_CND_DIV,'99') = 13 THEN DMS_SEND_CND_DIV_ETC
		       WHEN INSTR(T.OVS_SEND_CND_DIV,'99') = 13 THEN OVS_SEND_CND_DIV_ETC
		       ELSE FN_CM05M01_CD_TO_NM(CASE WHEN T.TRNS_DIV = 'LGISTDIV0301' THEN T.DMS_SEND_CND_DIV ELSE T.OVS_SEND_CND_DIV END) END AS SEND_CND_DIV_NM
		, FN_CM05M01_CD_TO_NM(CASE WHEN T.TRNS_DIV = 'LGISTDIV0301' THEN T.DMS_PACK_KIND_DIV ELSE T.OVS_PACK_KIND_DIV END) AS PACK_KIND_DIV_NM
        , T.ETC_FIELD1
        , T.ETC_FIELD2
        , T.ETC_FIELD3
        , T.CREAT_ID
        , TO_CHAR(T.CREAT_DTTM, 'YYYY-MM-DD') CREAT_DTTM
        , T.UDT_ID
        , TO_CHAR(T.UDT_DTTM, 'YYYY-MM-DD') UDT_DTTM
		--,CASE WHEN T.FILE_TRGT_KEY IS NOT NULL THEN NVL(AP.APP_STATUS, 'APP0') END AS APP_STATUS
		, (SELECT CASE WHEN ( COUNT(A.TODO_KEY) = SUM(DECODE(NVL(A.SANCTN_STTUS, 'N'), 'N', 0, 'Y', 1) ) ) 
								THEN 'Y'
								ELSE TO_CHAR( SUM(DECODE(NVL(A.SANCTN_STTUS, 'N'), 'N', 0, 'Y', 1) ) )
				            END TODO_YN
				        FROM TB_WB20M03 A
				        WHERE A.TODO_NO = T.LGIST_NO) AS APP_STATUS
		, T.STA_CHRG_CONT
		FROM TB_CR11M01 T
		--LEFT OUTER JOIN APP_STATUS_LIST AP ON T.CO_CD = AP.CO_CD AND T.TODO_DIV1_CODE_ID = AP.TODO_DIV1_CODE_ID AND T.TODO_DIV2_CODE_ID = AP.TODO_DIV2_CODE_ID
	  WHERE FILE_TRGT_KEY = #{fileTrgtKey}
	</select>

	<!-- 결재선 체크 -->
	<select id="selectLgistAppCount" resultType="String">
		SELECT COUNT(*)
			FROM TB_BM13M01 A
		WHERE CO_CD = #{coCd}
		AND APP_DIV = #{appDiv}
		ORDER BY APP_SEQ
	</select>

	<select id="selectLgistAppList" parameterType="Map" resultType="camelMap">
		SELECT A.APP_SEQ,  B.TODO_ID,  FN_CM06M01_ID_TO_NM(B.TODO_ID) AS TODO_ID_NM , DECODE(B.TODO_CF_DT,NULL,'N','Y') AS TODO_CF_YN
			   , X.DEPT_NM , (SELECT LEVEL_NM FROM TB_CM07M01 WHERE LEVEL_CD=X.LEVEL_CD) AS LEVEL_NM
			   FROM TB_BM13M01 A
			   JOIN TB_WB20M03 B ON A.CO_CD = B.CO_CD AND A.APP_DIV = B.TODO_DIV1_CODE_ID AND A.APP_ID = B.TODO_ID
			   LEFT OUTER JOIN (
						SELECT BB.ID
								, BB.NAME
								, BB.LEVEL_CD
								, BB.EMAIL
								, BB.TEL_NO
								, BB.OFF_TEL_NO
								, BB.FAX_NO
								, CC.DEPT_NM
							FROM TB_CM06M01 BB
							INNER JOIN TB_CM04M01 CC ON(BB.DEPT_ID=CC.DEPT_ID)
						) X ON(B.TODO_ID=X.ID)
			   LEFT OUTER JOIN TB_CR11M01 T ON B.CO_CD = T.CO_CD AND B.TODO_DIV1_CODE_ID = T.TODO_DIV1_CODE_ID AND B.TODO_DIV2_CODE_ID = T.TODO_DIV2_CODE_ID
		  WHERE T.FILE_TRGT_KEY = #{fileTrgtKey}
		  ORDER BY APP_SEQ
	</select>

	<select id="selectLgistNoNext" parameterType="Map" resultType="String">
		SELECT 'LGT'||TO_CHAR(SYSDATE,'YY')||'-'||TRIM(TO_CHAR(NVL(MAX(TO_NUMBER(NVL(FILE_TRGT_KEY,'0'))),0) + 1,'00000')) FROM TB_CR11M01
	</select>

    <insert id="insertLgistMast" parameterType="Map">
        <selectKey keyProperty="fileTrgtKey" resultType="int" order="BEFORE">
			SELECT NVL(MAX(TO_NUMBER(NVL(FILE_TRGT_KEY,'0'))),0) + 1 FROM TB_CR11M01
        </selectKey>
        INSERT INTO TB_CR11M01
        ( FILE_TRGT_KEY
		, CO_CD
		, LGIST_NO
		, ORDRS_NO
		, CLNT_PJT
		, PBLICTE_DT
		, REQ_ID
		, PART_NO
		, REQ_FX_DT
		, CLAS_DIV
		, TRNS_DIV
		, DMS_TRNS_AREA_DIV
		, DMS_SEND_CND_DIV
		, DMS_SEND_CND_DIV_ETC
		, DMS_PACK_KIND_DIV
		, OVS_TRNS_AREA_DIV
		, OVS_SEND_CND_DIV
		, OVS_SEND_CND_DIV_ETC
		, OVS_PACK_KIND_DIV
		, STA_PLACE
		, STA_ADDR
		, STA_CHRG_ID
		, ARVL_PLACE
		, ARVL_ADDR
		, ARVL_CHRG_CONT
		, PRDLST_CONT
		, PRD_AMT
		, WIDTH_SIZE
		, VRTICL_SIZE
		, HEIGHT_SIZE
		, FRMLC_BEFORE_WT
		, FRMLC_AFTER_WT
		, SHIPMNT_DT
		, HOPE_ARVL_DT
		, LGIST_RMK
        , ETC_FIELD1
        , ETC_FIELD2
        , ETC_FIELD3
        , CREAT_ID
        , CREAT_PGM
        , CREAT_DTTM
        , STA_CHRG_CONT
        )
        VALUES
        ( #{fileTrgtKey}
		, #{coCd, jdbcType=VARCHAR}
		, #{lgistNo, jdbcType=VARCHAR}
		, #{ordrsNo, jdbcType=VARCHAR}
		, #{clntPjt, jdbcType=VARCHAR}
		, #{pblicteDt, jdbcType=VARCHAR}
		, #{reqId, jdbcType=VARCHAR}
		, #{partNo, jdbcType=VARCHAR}
		, #{reqFxDt, jdbcType=VARCHAR}
		, #{clasDiv, jdbcType=VARCHAR}
		, #{trnsDiv, jdbcType=VARCHAR}
		, #{dmsTrnsAreaDiv, jdbcType=VARCHAR}
		, #{dmsSendCndDiv, jdbcType=VARCHAR}
		, #{dmsSendCndDivEtc, jdbcType=VARCHAR}
		, #{dmsPackKindDiv, jdbcType=VARCHAR}
		, #{ovsTrnsAreaDiv, jdbcType=VARCHAR}
		, #{ovsSendCndDiv, jdbcType=VARCHAR}
		, #{ovsSendCndDivEtc, jdbcType=VARCHAR}
		, #{ovsPackKindDiv, jdbcType=VARCHAR}
		, #{staPlace, jdbcType=VARCHAR}
		, #{staAddr, jdbcType=VARCHAR}
		, #{staChrgId, jdbcType=VARCHAR}
		, #{arvlPlace, jdbcType=VARCHAR}
		, #{arvlAddr, jdbcType=VARCHAR}
		, #{arvlChrgCont, jdbcType=VARCHAR}
		, #{prdlstCont, jdbcType=VARCHAR}
		, #{prdAmt, jdbcType=VARCHAR}
		, #{widthSize, jdbcType=VARCHAR}
		, #{vrticlSize, jdbcType=VARCHAR}
		, #{heightSize, jdbcType=VARCHAR}
		, #{frmlcBeforeWt, jdbcType=VARCHAR}
		, #{frmlcAfterWt, jdbcType=VARCHAR}
		, #{shipmntDt, jdbcType=VARCHAR}
		, #{hopeArvlDt, jdbcType=VARCHAR}
		, #{lgistRmk, jdbcType=VARCHAR}
        , #{etcField1, jdbcType=VARCHAR}
        , #{etcField2, jdbcType=VARCHAR}
        , #{etcField3, jdbcType=VARCHAR}
        , #{userId, jdbcType=VARCHAR}
        , #{pgmId, jdbcType=VARCHAR}
        , SYSDATE
        , #{staChrgCont, jdbcType=VARCHAR}
        )
    </insert>

    <update id="updateLgistMast" parameterType="Map">
        UPDATE TB_CR11M01
        SET   CO_CD = #{coCd, jdbcType=VARCHAR}
            , LGIST_NO = #{lgistNo, jdbcType=VARCHAR}
            , ORDRS_NO = #{ordrsNo, jdbcType=VARCHAR}
            , CLNT_PJT = #{clntPjt, jdbcType=VARCHAR}
            , PBLICTE_DT = #{pblicteDt, jdbcType=VARCHAR}
            , REQ_ID = #{reqId, jdbcType=VARCHAR}
            , PART_NO = #{partNo, jdbcType=VARCHAR}
            , REQ_FX_DT = #{reqFxDt, jdbcType=VARCHAR}
            , CLAS_DIV = #{clasDiv, jdbcType=VARCHAR}
            , TRNS_DIV = #{trnsDiv, jdbcType=VARCHAR}
            , DMS_TRNS_AREA_DIV = #{dmsTrnsAreaDiv, jdbcType=VARCHAR}
            , DMS_SEND_CND_DIV = #{dmsSendCndDiv, jdbcType=VARCHAR}
            , DMS_SEND_CND_DIV_ETC = #{dmsSendCndDivEtc, jdbcType=VARCHAR}
            , DMS_PACK_KIND_DIV = #{dmsPackKindDiv, jdbcType=VARCHAR}
            , OVS_TRNS_AREA_DIV = #{ovsTrnsAreaDiv, jdbcType=VARCHAR}
            , OVS_SEND_CND_DIV = #{ovsSendCndDiv, jdbcType=VARCHAR}
            , OVS_SEND_CND_DIV_ETC = #{ovsSendCndDivEtc, jdbcType=VARCHAR}
            , OVS_PACK_KIND_DIV = #{ovsPackKindDiv, jdbcType=VARCHAR}
            , STA_PLACE = #{staPlace, jdbcType=VARCHAR}
            , STA_ADDR = #{staAddr, jdbcType=VARCHAR}
            , STA_CHRG_ID = #{staChrgId, jdbcType=VARCHAR}
            , ARVL_PLACE = #{arvlPlace, jdbcType=VARCHAR}
            , ARVL_ADDR = #{arvlAddr, jdbcType=VARCHAR}
            , ARVL_CHRG_CONT = #{arvlChrgCont, jdbcType=VARCHAR}
            , PRDLST_CONT = #{prdlstCont, jdbcType=VARCHAR}
            , PRD_AMT = #{prdAmt, jdbcType=VARCHAR}
            , WIDTH_SIZE = #{widthSize, jdbcType=VARCHAR}
            , VRTICL_SIZE = #{vrticlSize, jdbcType=VARCHAR}
            , HEIGHT_SIZE = #{heightSize, jdbcType=VARCHAR}
            , FRMLC_BEFORE_WT = #{frmlcBeforeWt, jdbcType=VARCHAR}
            , FRMLC_AFTER_WT = #{frmlcAfterWt, jdbcType=VARCHAR}
            , SHIPMNT_DT = #{shipmntDt, jdbcType=VARCHAR}
            , HOPE_ARVL_DT = #{hopeArvlDt, jdbcType=VARCHAR}
            , LGIST_RMK = #{lgistRmk, jdbcType=VARCHAR}
            , ETC_FIELD1    = #{etcField1, jdbcType=VARCHAR}
            , ETC_FIELD2    = #{etcField2, jdbcType=VARCHAR}
            , ETC_FIELD3    = #{etcField3, jdbcType=VARCHAR}
            , UDT_ID        = #{userId, jdbcType=VARCHAR}
            , UDT_PGM       = #{pgmId, jdbcType=VARCHAR}
            , UDT_DTTM      = SYSDATE
            , STA_CHRG_CONT = #{staChrgCont, jdbcType=VARCHAR}
        WHERE FILE_TRGT_KEY = #{fileTrgtKey, jdbcType=VARCHAR}
    </update>

	<delete id="deleteLgistMast" parameterType="Map">
	  DELETE TB_CR11M01
	   WHERE FILE_TRGT_KEY = #{fileTrgtKey}
	</delete>

    <insert id="insertLgistDetail" parameterType="Map">
        <selectKey keyProperty="salesSeq" resultType="int" order="BEFORE">
			SELECT NVL(MAX(SALES_SEQ), 0) + 1 FROM TB_CR11D01
			 WHERE LGIST_NO = #{lgistNo}
        </selectKey>
        INSERT INTO TB_CR11D01
        ( LGIST_NO
		, SALES_SEQ
		, SALES_CD
        , ETC_FIELD1
        , ETC_FIELD2
        , ETC_FIELD3
        , CREAT_ID
        , CREAT_PGM
        , CREAT_DTTM
        )
        VALUES
        ( #{lgistNo, jdbcType=VARCHAR}
		, #{salesSeq}
		, #{salesCd, jdbcType=VARCHAR}
        , #{etcField1, jdbcType=VARCHAR}
        , #{etcField2, jdbcType=VARCHAR}
        , #{etcField3, jdbcType=VARCHAR}
        , #{userId}
        , #{pgmId}
        , SYSDATE
        )
    </insert>

    <update id="updateLgistDetail" parameterType="Map">
        UPDATE TB_CR11D01
        SET   SALES_CD 			= #{salesCd, jdbcType=VARCHAR}
            , ETC_FIELD1        = #{etcField1, jdbcType=VARCHAR}
            , ETC_FIELD2        = #{etcField2, jdbcType=VARCHAR}
            , ETC_FIELD3        = #{etcField3, jdbcType=VARCHAR}
            , UDT_ID        = #{userId}
            , UDT_PGM       = #{pgmId}
            , UDT_DTTM      = SYSDATE
	  WHERE LGIST_NO = #{lgistNo}
	    AND SALES_SEQ = #{salesSeq, jdbcType=VARCHAR}
    </update>

	<delete id="deleteLgistDetail" parameterType="Map">
	  DELETE TB_CR11D01
	  WHERE LGIST_NO = #{lgistNo}
	    AND SALES_SEQ = #{salesSeq, jdbcType=VARCHAR}
	</delete>

	<delete id="deleteLgistDetailAll" parameterType="Map">
	  DELETE TB_CR11D01
	  WHERE LGIST_NO = #{lgistNo}
	</delete>

	<!-- 결재요청 목록 조회 -->
	<select id="selectTodoAppReqList" resultType="CamelMap">
		SELECT CO_CD
			, A.APP_DIV AS TODO_DIV1_CODE_ID
			, A.APP_DIV||TRIM(TO_CHAR(#{fileTrgtKey},'00000')) AS TODO_DIV2_CODE_ID
			, APP_ID AS TODO_ID
			, '' AS PG_PATH
			, '' AS PG_PARAM
			, '' AS SALES_CD
			, '' AS WBS_PLANCO_CD
			, '' AS WBS_PLAN_NO
			, '' AS WBS_PLAN_CODE_KIND
			, '' AS WBS_PLAN_CODE_ID
			, '' AS WBS_RSLTS_FILE_TRGT_KEY
			, '' AS WBS_RSLTS_CO_CD
			, '' AS WBS_RSLTS_PLAN_NO
			, '' AS WBS_RSLTS_PLAN_CODE_KIND
			, '' AS WBS_RSLTS_PLAN_CODE_ID
			FROM TB_BM13M01 A
		WHERE CO_CD = #{coCd}
		AND APP_DIV = #{appDiv}
		ORDER BY APP_SEQ
	</select>

	<select id="selectTodoAppCount" parameterType="Map" resultType="int">
		SELECT COUNT(*) FROM TB_WB20M03
        WHERE CO_CD = #{coCd, jdbcType=VARCHAR}
          AND TODO_DIV1_CODE_ID = #{todoDiv1CodeId, jdbcType=VARCHAR}
          AND TODO_DIV2_CODE_ID = #{todoDiv2CodeId, jdbcType=VARCHAR}
	</select>

	<select id="selectTodoAppSanctnSn" parameterType="Map" resultType="int">
		SELECT NVL(MAX(SANCTN_SN), 0) + 1 FROM TB_WB20M03
        WHERE CO_CD = #{coCd, jdbcType=VARCHAR}
          AND TODO_DIV1_CODE_ID = #{todoDiv1CodeId, jdbcType=VARCHAR}
          AND TODO_DIV2_CODE_ID = #{todoDiv2CodeId, jdbcType=VARCHAR}
	</select>

	<!-- ToDoList 등록  -->
    <insert id="insertTodoAppList" parameterType="Map">
        <selectKey keyProperty="todoKey" resultType="int" order="BEFORE">
			SELECT NVL(MAX(TODO_KEY), 0) + 1 FROM TB_WB20M03
        </selectKey>
        INSERT INTO TB_WB20M03
        ( TODO_KEY
        , SANCTN_SN
		, CO_CD
		, TODO_DIV1_CODE_ID
		, TODO_DIV2_CODE_ID
		, TODO_ID
		, PG_PATH
		, PG_PARAM
		, SALES_CD
		, ETC_FIELD1
		, ETC_FIELD2
		, ETC_FIELD3
		, CREAT_ID
		, CREAT_PGM
		, CREAT_DTTM
		, TODO_CO_CD
        )
        VALUES
        ( #{todoKey}
        , #{sanctnSn}
        , #{coCd}
        , #{todoDiv1CodeId}
        , #{todoDiv2CodeId}
        , #{todoId}
        , #{pgPath, jdbcType=VARCHAR}
        , #{pgParam, jdbcType=VARCHAR}
        , #{salesCd, jdbcType=VARCHAR}
        , #{etcField1, jdbcType=VARCHAR}
        , #{etcField2, jdbcType=VARCHAR}
        , #{etcField3, jdbcType=VARCHAR}
        , #{userId}
        , #{pgmId}
        , SYSDATE
        , #{coCd}
        )
    </insert>

    <update id="updateLgistMastTodoApp" parameterType="Map">
        UPDATE TB_CR11M01
        SET   TODO_DIV1_CODE_ID = #{todoDiv1CodeId, jdbcType=VARCHAR}
            , TODO_DIV2_CODE_ID = #{todoDiv2CodeId, jdbcType=VARCHAR}
            , UDT_ID        = #{userId, jdbcType=VARCHAR}
            , UDT_PGM       = #{pgmId, jdbcType=VARCHAR}
            , UDT_DTTM      = SYSDATE
        WHERE FILE_TRGT_KEY = #{fileTrgtKey, jdbcType=VARCHAR}
    </update>

    <update id="updateTodoAppConfirm" parameterType="Map">
        UPDATE TB_WB20M03
        SET   TODO_CF_DT	= #{todoCfDt}
        	, TODO_CF_OPN	= #{todoCfOpn, jdbcType=VARCHAR}
            , UDT_ID        = #{userId, jdbcType=VARCHAR}
            , UDT_PGM       = #{pgmId, jdbcType=VARCHAR}
            , UDT_DTTM      = SYSDATE
        WHERE CO_CD = #{coCd}
          AND TODO_DIV1_CODE_ID = #{todoDiv1CodeId}
          AND TODO_DIV2_CODE_ID = #{todoDiv2CodeId}
          AND TODO_ID = #{todoId}
    </update>

</mapper>
