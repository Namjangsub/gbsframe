<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.pm.pm10.mapper.PM10Mapper">

    <select id="selectMnList" parameterType="Map" resultType="CamelMap">
		SELECT ROWNUM AS RNUM
		     , A.*
		FROM   (
				SELECT
					    T.MN_DATE,
					    MAX(T.MN_WEEKS)              AS MN_WEEKS,
					    MAX(T.MN_RMK)                AS MN_RMK,
					    D1.MN_SUB_SEQ,
					    D1.MN_SUBJECT,
					
					    -- GUN00: 임원실
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN00' THEN D3.MN_CNTS   END) AS GUN00_MN_CNTS,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN00' THEN D3.MN_ETC    END) AS GUN00_MN_ETC,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN00' THEN D3.MN_RESULT END) AS GUN00_MN_RESULT,
					
					    -- GUN30: 영업팀
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN30' THEN D3.MN_CNTS   END) AS GUN30_MN_CNTS,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN30' THEN D3.MN_ETC    END) AS GUN30_MN_ETC,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN30' THEN D3.MN_RESULT END) AS GUN30_MN_RESULT,
					
					    -- GUN40: 기술연구소
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN40' THEN D3.MN_CNTS   END) AS GUN40_MN_CNTS,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN40' THEN D3.MN_ETC    END) AS GUN40_MN_ETC,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN40' THEN D3.MN_RESULT END) AS GUN40_MN_RESULT,
					
					    -- GUN60: 생산팀
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN60' THEN D3.MN_CNTS   END) AS GUN60_MN_CNTS,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN60' THEN D3.MN_ETC    END) AS GUN60_MN_ETC,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN60' THEN D3.MN_RESULT END) AS GUN60_MN_RESULT,
					
					    -- TRN5010: 기계
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'TRN5010' THEN D3.MN_CNTS   END) AS TRN5010_MN_CNTS,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'TRN5010' THEN D3.MN_ETC    END) AS TRN5010_MN_ETC,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'TRN5010' THEN D3.MN_RESULT END) AS TRN5010_MN_RESULT,
					
					    -- TRN5020: 전기
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'TRN5020' THEN D3.MN_CNTS   END) AS TRN5020_MN_CNTS,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'TRN5020' THEN D3.MN_ETC    END) AS TRN5020_MN_ETC,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'TRN5020' THEN D3.MN_RESULT END) AS TRN5020_MN_RESULT,
					
					    -- GUN10: 경영지원팀
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN10' THEN D3.MN_CNTS   END) AS GUN10_MN_CNTS,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN10' THEN D3.MN_ETC    END) AS GUN10_MN_ETC,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN10' THEN D3.MN_RESULT END) AS GUN10_MN_RESULT,
					
					    -- GUN80: 전산실
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN80' THEN D3.MN_CNTS   END) AS GUN80_MN_CNTS,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN80' THEN D3.MN_ETC    END) AS GUN80_MN_ETC,
					    MAX(CASE WHEN D3.MN_DEPT_CD = 'GUN80' THEN D3.MN_RESULT END) AS GUN80_MN_RESULT
				FROM TB_PM10M01 T
							LEFT OUTER JOIN TB_PM10D01 D1 ON D1.MN_DATE = T.MN_DATE
							LEFT OUTER JOIN TB_PM10D02 D2 ON D2.MN_DATE = T.MN_DATE
							LEFT OUTER JOIN TB_PM10D03 D3 ON D3.MN_DATE = T.MN_DATE AND D3.MN_SUB_SEQ = D1.MN_SUB_SEQ
				WHERE 1 = 1
		        <if test="mnDate !=null and !mnDate.equals('')">
		        AND T.MN_DATE = #{mnDate}
		        </if>
		        <if test="mnDeptCd !=null and !mnDeptCd.equals('')">
		        AND D3.MN_DEPT_CD = #{mnDeptCd}
		        </if>
				GROUP BY T.MN_DATE, D1.MN_SUB_SEQ, D1.MN_SUBJECT
				ORDER BY T.MN_DATE, D1.MN_SUB_SEQ, D1.MN_SUBJECT
		       ) AS A
    </select>
    
</mapper>