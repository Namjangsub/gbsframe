<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.pm.pm01.mapper.PM01Mapper">

    <select id="selectDailyWorkCount" parameterType="Map" resultType="int">
        SELECT COUNT(*)
		FROM   (
				SELECT ROWNUM AS RNUM
				     , A.*
				FROM   (
				        SELECT T.FILE_TRGT_KEY
				             , T.CO_CD
				             , FN_CM05M01_CD_TO_NM(T.CO_CD) CO_NM
				             , T.WORK_RPT_NO
				             , T.WORK_RPT_ID
				             , B.NAME					 AS WORK_RPT_ID_NM
				             , TO_CHAR(T.WORK_RPT_DT,'YYYY-MM-DD') AS WORK_RPT_DT
				             , T.WORK_RPT_L
				             , T.WORK_RPT_M
				             , T.WORK_RPT_S
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_L) AS WORK_RPT_L_NM
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_M) AS WORK_RPT_M_NM
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_S) AS WORK_RPT_S_NM
				             , T.WORK_RPT_HOUR
				             , T.SALES_CD
				             , T.PRDT_CD
				             , C.PRDT_NM                        AS PRDT_CD_NM
				             , T.ITEM_DIV
				             , FN_CM05M01_CD_TO_NM(T.ITEM_DIV) AS ITEM_DIV_NM
				             , T.WORK_RPT_RMK
				             , T.WORK_RPT_RMK
				             , T.ETC_FIELD1
				             , T.ETC_FIELD2
				             , T.ETC_FIELD3
				             , T.CREAT_ID
				             , FN_CM06M01_ID_TO_NM(T.CREAT_ID) AS CREAT_NM
				             , T.CREAT_DTTM
				             , T.UDT_ID
				             , FN_CM06M01_ID_TO_NM(T.UDT_ID)  AS UDT_NM
				             , T.UDT_DTTM
				        FROM   TB_PM01M01 AS T
				               LEFT OUTER JOIN TB_CR02D02 AS CR  ON T.ORD_CO_CD   = CR.CO_CD
				                                                AND T.SALES_CD    = CR.SALES_CD
				               LEFT OUTER JOIN TB_CR02M01 AS Y  ON T.ORD_CO_CD    = Y.CO_CD
                                                               AND T.ORDRS_NO     = Y.ORDRS_NO
				               LEFT OUTER JOIN TB_BM02M01 AS A  ON T.CLNT_CD = A.CLNT_CD
				               LEFT OUTER JOIN TB_CM06M01 AS B  ON T.WORK_RPT_ID = B.ID
				               LEFT OUTER JOIN TB_BM01M01 AS C  ON T.PRDT_CD = C.PRDT_CD
				        WHERE  1 = 1
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    T.CO_CD = #{coCd}
				        </if>
				        <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')">
				        AND    T.WORK_RPT_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD')
				        </if>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    T.WORK_RPT_ID = #{workRptId}
				        </if>
				        <if test="salesCd != null and !salesCd.equals('')">
				        AND    T.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    CR.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    CR.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptL != null and !workRptL.equals('')">
				        AND    T.WORK_RPT_L = #{workRptL}
				        </if>
				        <if test="workRptM != null and !workRptM.equals('')">
				        AND    T.WORK_RPT_M = #{workRptM}
				        </if>
				        <if test="workRptS !=null and !workRptS.equals('')">
				        AND    T.WORK_RPT_S = #{workRptS}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        <if test="sortType !=null and sortType.equals('DATE')">
				        ORDER BY T.CO_CD, T.WORK_RPT_DT DESC, T.WORK_RPT_ID, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S, T.WORK_RPT_NO DESC, T.FILE_TRGT_KEY DESC
				        </if>
				        <if test="sortType !=null and sortType.equals('CODE')">
				        ORDER BY T.CO_CD, T.WORK_RPT_DT DESC, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S, T.WORK_RPT_NO DESC, T.FILE_TRGT_KEY DESC
				        </if>
				       ) AS A
				WHERE  1 = 1
			   ) AS A
		WHERE  1 = 1
    </select>

    <select id="selectDailyWorkList" parameterType="Map" resultType="CamelMap">
        SELECT A.*
		FROM   (
				SELECT ROWNUM AS RNUM
				     , A.*
				FROM   (
				        SELECT T.FILE_TRGT_KEY
				             , T.CO_CD
				             , FN_CM05M01_CD_TO_NM(T.CO_CD) CO_NM
				             , T.WORK_RPT_NO
				             , T.WORK_RPT_ID
				             , B.NAME					 AS WORK_RPT_ID_NM
				             , TO_CHAR(T.WORK_RPT_DT,'YYYY-MM-DD') AS WORK_RPT_DT
				             , T.WORK_RPT_L
				             , T.WORK_RPT_M
				             , T.WORK_RPT_S
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_L) AS WORK_RPT_L_NM
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_M) AS WORK_RPT_M_NM
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_S) AS WORK_RPT_S_NM
				             , T.ORDRS_NO
				             , T.WORK_RPT_HOUR
				             , T.CLNT_CD
				             , A.CLNT_NM AS CLNT_NM
				             , T.CLNT_PJT
				             , FN_CM05M01_CD_TO_NM(T.CLNT_PJT) AS CLNT_PJT_NM
				             , T.SALES_CD
				             , T.PRDT_CD
				             , C.PRDT_NM                        AS PRDT_CD_NM
				             , T.ITEM_DIV
				             , FN_CM05M01_CD_TO_NM(T.ITEM_DIV) AS ITEM_DIV_NM
				             , T.WORK_RPT_RMK
				             , T.WORK_RPT_RMK
				             , CR.EQP_NM
				             , T.ETC_FIELD1
				             , T.ETC_FIELD2
				             , T.ETC_FIELD3
				             , T.CREAT_ID
				             , FN_CM06M01_ID_TO_NM(T.CREAT_ID) AS CREAT_NM
				             , TO_CHAR(T.CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM
				             , T.UDT_ID
				             , FN_CM06M01_ID_TO_NM(T.UDT_ID)  AS UDT_NM
				             , TO_CHAR(T.UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM
				             , T.ISSUE_YN
				             , T.ISSUE_TITLE
				             , T.ORD_CO_CD
				             , (SELECT SUM(TRIP_RPT_AMT) FROM TB_PM01D01 D WHERE D.WORK_RPT_NO = T.WORK_RPT_NO) AS TRIP_RPT_AMT
				        FROM   TB_PM01M01 AS T
				               LEFT OUTER JOIN TB_CR02D02 AS CR  ON T.ORD_CO_CD = CR.CO_CD
				                                                AND T.SALES_CD  = CR.SALES_CD
				               LEFT OUTER JOIN TB_CR02M01 AS Y  ON T.ORD_CO_CD  = Y.CO_CD
                                                               AND T.ORDRS_NO   = Y.ORDRS_NO
				               LEFT OUTER JOIN TB_BM02M01 AS A  ON T.CLNT_CD = A.CLNT_CD
				               LEFT OUTER JOIN TB_CM06M01 AS B  ON T.WORK_RPT_ID = B.ID
				               LEFT OUTER JOIN TB_BM01M01 AS C  ON T.PRDT_CD = C.PRDT_CD
				        WHERE  1 = 1
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    T.CO_CD = #{coCd}
				        </if>
				        <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')">
				        AND    T.WORK_RPT_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD')
				        </if>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    T.WORK_RPT_ID = #{workRptId}
				        </if>
				        <if test="salesCd != null and !salesCd.equals('')">
				        AND    T.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    T.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    T.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptL != null and !workRptL.equals('')">
				        AND    T.WORK_RPT_L = #{workRptL}
				        </if>
				        <if test="workRptM != null and !workRptM.equals('')">
				        AND    T.WORK_RPT_M = #{workRptM}
				        </if>
				        <if test="workRptS !=null and !workRptS.equals('')">
				        AND    T.WORK_RPT_S = #{workRptS}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        <if test="sortType !=null and sortType.equals('DATE')">
				        ORDER BY T.CO_CD, T.WORK_RPT_DT DESC, T.WORK_RPT_ID, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S, T.WORK_RPT_NO DESC, T.FILE_TRGT_KEY DESC
				        </if>
				        <if test="sortType !=null and sortType.equals('CODE')">
				        ORDER BY T.CO_CD, T.WORK_RPT_DT DESC, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S, T.WORK_RPT_NO DESC, T.FILE_TRGT_KEY DESC
				        </if>
				       ) AS A
				WHERE  1 = 1
			   ) AS A
		WHERE  A.RNUM BETWEEN #{firstIndex} AND #{lastIndex}
    </select>

    <select id="selectDailyWorkInfo" resultType="CamelMap">
        SELECT T.FILE_TRGT_KEY,
               T.CO_CD,
               T.WORK_RPT_NO,
               T.WORK_RPT_ID,
               (SELECT NAME FROM TB_CM06M01 WHERE ID = T.WORK_RPT_ID) AS WORK_RPT_ID_NM,
               TO_CHAR(T.WORK_RPT_DT, 'YYYY-MM-DD')                AS WORK_RPT_DT,
               T.WORK_RPT_L,
               T.WORK_RPT_M,
               T.WORK_RPT_S,
               T.WORK_RPT_HOUR,
               T.SALES_CD,
               T.WORK_RPT_RMK,
               T.ETC_FIELD1,
               T.ETC_FIELD2,
               T.ETC_FIELD3,
               T.WORK_RPT_RMK,
               T.ETC_FIELD1,
               T.ETC_FIELD2,
               T.ETC_FIELD3,
               T.CREAT_ID,
               T.CLNT_CD,
               T3.CLNT_NM,
               T.ORDRS_NO,
               T.CLNT_PJT,
               FN_CM05M01_CD_TO_NM(T.CLNT_PJT) CLNT_PJT_NM,
               T.PRDT_CD,
               (SELECT X.PRDT_NM FROM TB_BM01M01 X WHERE X.PRDT_CD = T.PRDT_CD) AS PRDT_CD_NM,
               T.ITEM_DIV,
               FN_CM05M01_CD_TO_NM(T.ITEM_DIV)    AS ITEM_DIV_NM,
               T.EQP_NM,
               T.ISSUE_YN,
               T.ISSUE_TITLE,
               T.ORD_CO_CD
        FROM TB_PM01M01 T
             LEFT OUTER JOIN TB_CR02D02 AS T2   ON T2.CO_CD    = T.ORD_CO_CD
                                               AND T2.SALES_CD = T.SALES_CD
             LEFT OUTER JOIN TB_CR02M01 AS A    ON A.CO_CD    = T.ORD_CO_CD
                                               AND A.ORDRS_NO = T.ORDRS_NO
             LEFT OUTER JOIN TB_BM02M01 AS T3   ON T3.CLNT_CD  =T.CLNT_CD
        WHERE T.FILE_TRGT_KEY = #{fileTrgtKey}
    </select>

    <select id="selectConfirmCount" parameterType="Map" resultType="int">
        SELECT COUNT(FILE_TRGT_KEY) CNT
        FROM TB_PM01M01
        WHERE FILE_TRGT_KEY = #{fileTrgtKey}
    </select>

    <update id="updateDailyWork" parameterType="Map">
        UPDATE TB_PM01M01
        SET CO_CD         = #{coCd},
            WORK_RPT_NO   = #{workRptNo},
            WORK_RPT_ID   = #{workRptId},
            WORK_RPT_DT   = #{workRptDt},
            WORK_RPT_L    = #{workRptL},
            WORK_RPT_M    = #{workRptM},
            WORK_RPT_S    = #{workRptS},
            WORK_RPT_HOUR = #{workRptHour},
            SALES_CD      = #{salesCd},
            WORK_RPT_RMK  = #{workRptRmk},
            ETC_FIELD1    = #{etcField1, jdbcType=VARCHAR},
            ETC_FIELD2    = #{etcField2, jdbcType=VARCHAR},
            ETC_FIELD3    = #{etcField3, jdbcType=VARCHAR},
            UDT_ID        = #{userId},
            UDT_PGM       = #{pgmId},
            UDT_DTTM      = SYSDATE,
            CLNT_CD		  = #{clntCd, jdbcType=VARCHAR},
			ORDRS_NO	  = #{ordrsNo, jdbcType=VARCHAR},
			CLNT_PJT	  = #{clntPjt, jdbcType=VARCHAR},
			EQP_NM		  = #{eqpNm, jdbcType=VARCHAR},
			PRDT_CD		  = #{prdtCd, jdbcType=VARCHAR},
			ITEM_DIV	  = #{itemDiv, jdbcType=VARCHAR},
			ISSUE_YN	  = #{issueYn, jdbcType=VARCHAR},
			ISSUE_TITLE	  = #{issueTitle, jdbcType=VARCHAR},
			ORD_CO_CD	  = #{ordCoCd, jdbcType=VARCHAR}
        WHERE FILE_TRGT_KEY = #{fileTrgtKey}

    </update>

    <select id="selectDailyWorkSeqNext" parameterType="Map" resultType="String">
        SELECT TB_PM01M01_SQ01.NEXTVAL
		FROM   DUAL
    </select>

    <insert id="insertDailyWork" parameterType="Map">
        <selectKey keyProperty="workRptNo" resultType="String" order="BEFORE">
            SELECT 'DM' || TO_CHAR(SYSDATE, 'YYYYMMDD')||'-'||LPAD(MOD(TB_PM01M01_SQ02.NEXTVAL, 10000), 4, '0') FROM DUAL
        </selectKey>
        INSERT INTO TB_PM01M01
        (
        FILE_TRGT_KEY,
        CO_CD,
        WORK_RPT_NO,
        WORK_RPT_ID,
        WORK_RPT_DT,
        WORK_RPT_L,
        WORK_RPT_M,
        WORK_RPT_S,
        WORK_RPT_HOUR,
        SALES_CD,
        WORK_RPT_RMK,
        ETC_FIELD1,
        ETC_FIELD2,
        ETC_FIELD3,
        CREAT_ID,
        CREAT_PGM,
        CREAT_DTTM,
        CLNT_CD,
		ORDRS_NO,
		CLNT_PJT,
		EQP_NM,
		PRDT_CD,
		ITEM_DIV,
		ISSUE_YN,
		ISSUE_TITLE,
		ORD_CO_CD
        )
        VALUES
        (
        #{fileTrgtKey},
        #{coCd},
        #{workRptNo},
        #{workRptId},
        #{workRptDt},
        #{workRptL},
        #{workRptM},
        #{workRptS},
        #{workRptHour},
        #{salesCd},
        #{workRptRmk},
        #{etcField1, jdbcType=VARCHAR},
        #{etcField2, jdbcType=VARCHAR},
        #{etcField3, jdbcType=VARCHAR},
        #{userId},
        #{pgmId},
        SYSDATE,
        #{clntCd, jdbcType=VARCHAR},
		#{ordrsNo, jdbcType=VARCHAR},
		#{clntPjt, jdbcType=VARCHAR},
		#{eqpNm, jdbcType=VARCHAR},
		#{prdtCd, jdbcType=VARCHAR},
		#{itemDiv, jdbcType=VARCHAR},
		#{issueYn, jdbcType=VARCHAR},
		#{issueTitle, jdbcType=VARCHAR},
		#{ordCoCd, jdbcType=VARCHAR}
        )

    </insert>

    <delete id="deleteDailyWork" parameterType="Map">
        DELETE
        TB_PM01M01 WHERE FILE_TRGT_KEY =
        #{fileTrgtKey}
    </delete>

    <select id="selectMonthlyWorkList" parameterType="Map" resultType="CamelMap">
				SELECT  CO_CD,
						DEPT_ID,
						MAX(DEPT_NM) DEPT_NM,
						LEVEL_CD,
						(SELECT LEVEL_NM FROM TB_CM07M01 i WHERE T.LEVEL_CD = i.LEVEL_CD) LEVEL_NM,
						ID,
						NAME,
					    SUM(CASE WHEN DD = '01' THEN WORK_TIME ELSE '' END) AS "1",
					    SUM(CASE WHEN DD = '02' THEN WORK_TIME ELSE '' END) AS "2",
					    SUM(CASE WHEN DD = '03' THEN WORK_TIME ELSE '' END) AS "3",
					    SUM(CASE WHEN DD = '04' THEN WORK_TIME ELSE '' END) AS "4",
					    SUM(CASE WHEN DD = '05' THEN WORK_TIME ELSE '' END) AS "5",
					    SUM(CASE WHEN DD = '06' THEN WORK_TIME ELSE '' END) AS "6",
					    SUM(CASE WHEN DD = '07' THEN WORK_TIME ELSE '' END) AS "7",
					    SUM(CASE WHEN DD = '08' THEN WORK_TIME ELSE '' END) AS "8",
					    SUM(CASE WHEN DD = '09' THEN WORK_TIME ELSE '' END) AS "9",
					    SUM(CASE WHEN DD = '10' THEN WORK_TIME ELSE '' END) AS "10",
					    SUM(CASE WHEN DD = '11' THEN WORK_TIME ELSE '' END) AS "11",
					    SUM(CASE WHEN DD = '12' THEN WORK_TIME ELSE '' END) AS "12",
					    SUM(CASE WHEN DD = '14' THEN WORK_TIME ELSE '' END) AS "14",
					    SUM(CASE WHEN DD = '13' THEN WORK_TIME ELSE '' END) AS "13",
					    SUM(CASE WHEN DD = '15' THEN WORK_TIME ELSE '' END) AS "15",
					    SUM(CASE WHEN DD = '16' THEN WORK_TIME ELSE '' END) AS "16",
					    SUM(CASE WHEN DD = '17' THEN WORK_TIME ELSE '' END) AS "17",
					    SUM(CASE WHEN DD = '18' THEN WORK_TIME ELSE '' END) AS "18",
					    SUM(CASE WHEN DD = '19' THEN WORK_TIME ELSE '' END) AS "19",
					    SUM(CASE WHEN DD = '20' THEN WORK_TIME ELSE '' END) AS "20",
					    SUM(CASE WHEN DD = '21' THEN WORK_TIME ELSE '' END) AS "21",
					    SUM(CASE WHEN DD = '22' THEN WORK_TIME ELSE '' END) AS "22",
					    SUM(CASE WHEN DD = '23' THEN WORK_TIME ELSE '' END) AS "23",
					    SUM(CASE WHEN DD = '24' THEN WORK_TIME ELSE '' END) AS "24",
					    SUM(CASE WHEN DD = '25' THEN WORK_TIME ELSE '' END) AS "25",
					    SUM(CASE WHEN DD = '26' THEN WORK_TIME ELSE '' END) AS "26",
					    SUM(CASE WHEN DD = '27' THEN WORK_TIME ELSE '' END) AS "27",
					    SUM(CASE WHEN DD = '28' THEN WORK_TIME ELSE '' END) AS "28",
					    SUM(CASE WHEN DD = '29' THEN WORK_TIME ELSE '' END) AS "29",
					    SUM(CASE WHEN DD = '30' THEN WORK_TIME ELSE '' END) AS "30",
					    SUM(CASE WHEN DD = '31' THEN WORK_TIME ELSE '' END) AS "31",
					    SUM(HOLY_TIME) AS HOLY_TIME,
					    nvl(SUM(WORK_TIME),0) AS tot,
					    MAX(CASE WHEN DD = '01' THEN HOLY_DAY ELSE '' END) AS "JOB1",
					    MAX(CASE WHEN DD = '02' THEN HOLY_DAY ELSE '' END) AS "JOB2",
					    MAX(CASE WHEN DD = '03' THEN HOLY_DAY ELSE '' END) AS "JOB3",
					    MAX(CASE WHEN DD = '04' THEN HOLY_DAY ELSE '' END) AS "JOB4",
					    MAX(CASE WHEN DD = '05' THEN HOLY_DAY ELSE '' END) AS "JOB5",
					    MAX(CASE WHEN DD = '06' THEN HOLY_DAY ELSE '' END) AS "JOB6",
					    MAX(CASE WHEN DD = '07' THEN HOLY_DAY ELSE '' END) AS "JOB7",
					    MAX(CASE WHEN DD = '08' THEN HOLY_DAY ELSE '' END) AS "JOB8",
					    MAX(CASE WHEN DD = '09' THEN HOLY_DAY ELSE '' END) AS "JOB9",
					    MAX(CASE WHEN DD = '10' THEN HOLY_DAY ELSE '' END) AS "JOB10",
					    MAX(CASE WHEN DD = '11' THEN HOLY_DAY ELSE '' END) AS "JOB11",
					    MAX(CASE WHEN DD = '12' THEN HOLY_DAY ELSE '' END) AS "JOB12",
					    MAX(CASE WHEN DD = '14' THEN HOLY_DAY ELSE '' END) AS "JOB14",
					    MAX(CASE WHEN DD = '13' THEN HOLY_DAY ELSE '' END) AS "JOB13",
					    MAX(CASE WHEN DD = '15' THEN HOLY_DAY ELSE '' END) AS "JOB15",
					    MAX(CASE WHEN DD = '16' THEN HOLY_DAY ELSE '' END) AS "JOB16",
					    MAX(CASE WHEN DD = '17' THEN HOLY_DAY ELSE '' END) AS "JOB17",
					    MAX(CASE WHEN DD = '18' THEN HOLY_DAY ELSE '' END) AS "JOB18",
					    MAX(CASE WHEN DD = '19' THEN HOLY_DAY ELSE '' END) AS "JOB19",
					    MAX(CASE WHEN DD = '20' THEN HOLY_DAY ELSE '' END) AS "JOB20",
					    MAX(CASE WHEN DD = '21' THEN HOLY_DAY ELSE '' END) AS "JOB21",
					    MAX(CASE WHEN DD = '22' THEN HOLY_DAY ELSE '' END) AS "JOB22",
					    MAX(CASE WHEN DD = '23' THEN HOLY_DAY ELSE '' END) AS "JOB23",
					    MAX(CASE WHEN DD = '24' THEN HOLY_DAY ELSE '' END) AS "JOB24",
					    MAX(CASE WHEN DD = '25' THEN HOLY_DAY ELSE '' END) AS "JOB25",
					    MAX(CASE WHEN DD = '26' THEN HOLY_DAY ELSE '' END) AS "JOB26",
					    MAX(CASE WHEN DD = '27' THEN HOLY_DAY ELSE '' END) AS "JOB27",
					    MAX(CASE WHEN DD = '28' THEN HOLY_DAY ELSE '' END) AS "JOB28",
					    MAX(CASE WHEN DD = '29' THEN HOLY_DAY ELSE '' END) AS "JOB29",
					    MAX(CASE WHEN DD = '30' THEN HOLY_DAY ELSE '' END) AS "JOB30",
					    MAX(CASE WHEN DD = '31' THEN HOLY_DAY ELSE '' END) AS "JOB31",

					    SUM(CASE WHEN DD = '01' THEN HOLY_TIME ELSE '' END) AS "ETC1",
					    SUM(CASE WHEN DD = '02' THEN HOLY_TIME ELSE '' END) AS "ETC2",
					    SUM(CASE WHEN DD = '03' THEN HOLY_TIME ELSE '' END) AS "ETC3",
					    SUM(CASE WHEN DD = '04' THEN HOLY_TIME ELSE '' END) AS "ETC4",
					    SUM(CASE WHEN DD = '05' THEN HOLY_TIME ELSE '' END) AS "ETC5",
					    SUM(CASE WHEN DD = '06' THEN HOLY_TIME ELSE '' END) AS "ETC6",
					    SUM(CASE WHEN DD = '07' THEN HOLY_TIME ELSE '' END) AS "ETC7",
					    SUM(CASE WHEN DD = '08' THEN HOLY_TIME ELSE '' END) AS "ETC8",
					    SUM(CASE WHEN DD = '09' THEN HOLY_TIME ELSE '' END) AS "ETC9",
					    SUM(CASE WHEN DD = '10' THEN HOLY_TIME ELSE '' END) AS "ETC10",
					    SUM(CASE WHEN DD = '11' THEN HOLY_TIME ELSE '' END) AS "ETC11",
					    SUM(CASE WHEN DD = '12' THEN HOLY_TIME ELSE '' END) AS "ETC12",
					    SUM(CASE WHEN DD = '14' THEN HOLY_TIME ELSE '' END) AS "ETC14",
					    SUM(CASE WHEN DD = '13' THEN HOLY_TIME ELSE '' END) AS "ETC13",
					    SUM(CASE WHEN DD = '15' THEN HOLY_TIME ELSE '' END) AS "ETC15",
					    SUM(CASE WHEN DD = '16' THEN HOLY_TIME ELSE '' END) AS "ETC16",
					    SUM(CASE WHEN DD = '17' THEN HOLY_TIME ELSE '' END) AS "ETC17",
					    SUM(CASE WHEN DD = '18' THEN HOLY_TIME ELSE '' END) AS "ETC18",
					    SUM(CASE WHEN DD = '19' THEN HOLY_TIME ELSE '' END) AS "ETC19",
					    SUM(CASE WHEN DD = '20' THEN HOLY_TIME ELSE '' END) AS "ETC20",
					    SUM(CASE WHEN DD = '21' THEN HOLY_TIME ELSE '' END) AS "ETC21",
					    SUM(CASE WHEN DD = '22' THEN HOLY_TIME ELSE '' END) AS "ETC22",
					    SUM(CASE WHEN DD = '23' THEN HOLY_TIME ELSE '' END) AS "ETC23",
					    SUM(CASE WHEN DD = '24' THEN HOLY_TIME ELSE '' END) AS "ETC24",
					    SUM(CASE WHEN DD = '25' THEN HOLY_TIME ELSE '' END) AS "ETC25",
					    SUM(CASE WHEN DD = '26' THEN HOLY_TIME ELSE '' END) AS "ETC26",
					    SUM(CASE WHEN DD = '27' THEN HOLY_TIME ELSE '' END) AS "ETC27",
					    SUM(CASE WHEN DD = '28' THEN HOLY_TIME ELSE '' END) AS "ETC28",
					    SUM(CASE WHEN DD = '29' THEN HOLY_TIME ELSE '' END) AS "ETC29",
					    SUM(CASE WHEN DD = '30' THEN HOLY_TIME ELSE '' END) AS "ETC30",
					    SUM(CASE WHEN DD = '31' THEN HOLY_TIME ELSE '' END) AS "ETC31"
				FROM (
						SELECT A.CO_CD, A.DEPT_ID, A.LEVEL_CD, A.ID, A.NAME, DD, WORK_RPT_HOUR, HOLY_DAY, WORK_TIME, HOLY_TIME, C.DEPT_NM, CODE
						  FROM TB_CM06M01 A
						        LEFT OUTER JOIN (
										SELECT 	CO_CD,
												WORK_RPT_ID,
												WORK_RPT_DT,
												SUBSTRING(WORK_RPT_DT,9,2) AS DD,
												WORK_RPT_HOUR,
												CASE WHEN SUBSTRING(WORK_RPT_S, LENGTH(WORK_RPT_S) - 3, 4) = '9901' THEN '휴'
												     WHEN SUBSTRING(WORK_RPT_S, LENGTH(WORK_RPT_S) - 3, 4) = '9902' THEN '출'
												     WHEN WORK_RPT_M='GUN6020' THEN '출' ELSE  '' END AS HOLY_DAY,  --생산팀 출장 추가
												CASE WHEN SUBSTRING(WORK_RPT_S, LENGTH(WORK_RPT_S) - 3, 4) = '9901' THEN 0 ELSE  WORK_RPT_HOUR END AS WORK_TIME,
												CASE WHEN SUBSTRING(WORK_RPT_S, LENGTH(WORK_RPT_S) - 3, 4) = '9901' THEN WORK_RPT_HOUR ELSE  0 END AS HOLY_TIME,
												WORK_RPT_S,  -- 근무코드
												SUBSTRING(WORK_RPT_S, LENGTH(WORK_RPT_S) - 3, 4) AS CODE --근무코드 뒤에4자리 9901은 휴가 임
											FROM TB_PM01M01 P
											WHERE 1=1
										     AND P.WORK_RPT_DT BETWEEN  #{workYm} || '-01' AND LAST_DAY(TO_DATE(#{workYm} || '-01', 'YYYY-MM-DD'))
								        ) B ON A.ID    = B.WORK_RPT_ID
								          -- AND A.CO_CD = B.CO_CD
								LEFT OUTER JOIN TB_CM04M01 C ON A.DEPT_ID = C.DEPT_ID
		        			WHERE 1=1
		        			  AND A.USE_YN  = 'Y'
      		<choose>
	      		<when test="userId == 'js.nam' or userId == 'ceo' or userId == 'EMJ8105'">
			        <if test="deptId !=null and !deptId.equals('')">
							AND A.DEPT_ID BETWEEN #{deptId} AND #{deptId} || 'ZZ'
			        </if>
	      		</when>
	      		<otherwise>
			        <if test="deptId !=null and !deptId.equals('')">
							AND A.DEPT_ID BETWEEN #{deptId} AND #{deptId} || 'ZZ'
			        </if>
			        <if test="(deptId ==null or deptId.equals('')) and deptNm !=null and !deptNm.equals('')">
				    		AND C.DEPT_NM LIKE '%'||#{deptNm}||'%'
			        </if>
				</otherwise>
		    </choose>
				   	) T
				   	GROUP BY CO_CD, DEPT_ID, LEVEL_CD, ID, NAME
				   	ORDER BY LEVEL_CD DESC, ID, NAME
    </select>

	<select id="selectWorkPrtCount" parameterType="Map" resultType="int">
        SELECT COUNT(*)
		FROM   (
				SELECT ROWNUM AS RNUM
				     , A.*
				FROM   (
				       SELECT  T.WORK_RPT_ID
						     , B.NAME					 AS WORK_RPT_ID_NM
						     , TO_CHAR(T.WORK_RPT_DT,'YYYY-MM-DD') AS WORK_RPT_DT
						     , T.WORK_RPT_L
						     , T.WORK_RPT_M
						     , T.WORK_RPT_S
						     , FN_CM05M01_CD_TO_NM(T.WORK_RPT_L) AS WORK_RPT_L_NM
						     , FN_CM05M01_CD_TO_NM(T.WORK_RPT_M) AS WORK_RPT_M_NM
						     , FN_CM05M01_CD_TO_NM(T.WORK_RPT_S) AS WORK_RPT_S_NM
						     , SUM(T.WORK_RPT_HOUR) AS WORK_RPT_HOUR
				        FROM   TB_PM01M01 AS T
				               LEFT OUTER JOIN TB_CR02D02 AS CR  ON T.ORD_CO_CD= CR.CO_CD
				                                                AND T.SALES_CD = CR.SALES_CD
				               LEFT OUTER JOIN TB_CR02M01 AS Y  ON CR.CO_CD    = Y.CO_CD
                                                               AND CR.ORDRS_NO = Y.ORDRS_NO
				               LEFT OUTER JOIN TB_BM02M01 AS A  ON Y.ORDRS_CLNT_CD = A.CLNT_CD
				               LEFT OUTER JOIN TB_CM06M01 AS B  ON T.WORK_RPT_ID = B.ID
				               LEFT OUTER JOIN TB_BM01M01 AS C  ON CR.PRDT_CD = C.PRDT_CD
				        WHERE  1 = 1
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    T.CO_CD = #{coCd}
				        </if>
				        <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')">
				        AND    T.WORK_RPT_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD')
				        </if>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    T.WORK_RPT_ID = #{workRptId}
				        </if>
				        <if test="salesCd != null and !salesCd.equals('')">
				        AND    T.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    CR.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    CR.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptL != null and !workRptL.equals('')">
				        AND    T.WORK_RPT_L = #{workRptL}
				        </if>
				        <if test="workRptM != null and !workRptM.equals('')">
				        AND    T.WORK_RPT_M = #{workRptM}
				        </if>
				        <if test="workRptS !=null and !workRptS.equals('')">
				        AND    T.WORK_RPT_S = #{workRptS}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        GROUP BY T.WORK_RPT_ID, B.NAME, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S,T.WORK_RPT_DT
				       ) AS A
				WHERE  1 = 1
			   ) AS A
		WHERE  1 = 1
    </select>

    <select id="selectWorkPrtList" parameterType="Map" resultType="CamelMap">
        	SELECT *
				FROM   (SELECT  B.NAME					 AS WORK_RPT_ID_NM
						     , T.WORK_RPT_L
						     , T.WORK_RPT_M
						     , T.WORK_RPT_S
						     , FN_CM05M01_CD_TO_NM(T.WORK_RPT_L) AS WORK_RPT_L_NM
						     , FN_CM05M01_CD_TO_NM(T.WORK_RPT_M) AS WORK_RPT_M_NM
						     , FN_CM05M01_CD_TO_NM(T.WORK_RPT_S) AS WORK_RPT_S_NM
						     , SUM(T.WORK_RPT_HOUR) AS WORK_RPT_HOUR
						     , SUM(SUM(T.WORK_RPT_HOUR)) OVER (PARTITION BY T.WORK_RPT_S) AS TOTAL_SUM
				        FROM   TB_PM01M01 AS T
				               LEFT OUTER JOIN TB_CM06M01 AS B  ON T.WORK_RPT_ID = B.ID
				        WHERE  1 = 1
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    T.CO_CD = #{coCd}
				        </if>
				        <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')">
				        AND    T.WORK_RPT_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD')
				        </if>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    T.WORK_RPT_ID = #{workRptId}
				        </if>
				        <if test="workRptL != null and !workRptL.equals('')">
				        AND    T.WORK_RPT_L = #{workRptL}
				        </if>
				        <if test="workRptM != null and !workRptM.equals('')">
				        AND    T.WORK_RPT_M = #{workRptM}
				        </if>
				        <if test="workRptS !=null and !workRptS.equals('')">
				        AND    T.WORK_RPT_S = #{workRptS}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        GROUP BY T.WORK_RPT_ID, B.NAME, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S
				       )
			   PIVOT (SUM(WORK_RPT_HOUR) FOR WORK_RPT_ID_NM IN ( ${test} )  )--해당부서 인원 읽어와서 넣어주기
			 ORDER BY WORK_RPT_L, WORK_RPT_M, WORK_RPT_S
    </select>

    <select id="selectWorkOrdrsCount" parameterType="Map" resultType="int">
        SELECT COUNT(*)
		FROM   (
				SELECT ROWNUM AS RNUM
				     , A.*
				FROM   (
				       SELECT  B.NAME					 AS WORK_RPT_ID_NM
						     , T.ORDRS_NO
						     , T.SALES_CD
						     , SUM(T.WORK_RPT_HOUR) AS WORK_RPT_HOUR
						     , T.CLNT_CD
						     , A.CLNT_NM
						     , T.CLNT_PJT --고객사PJT
						     , FN_CM05M01_CD_TO_NM(T.CLNT_PJT) AS CLNT_PJT_NM --고객사PJT명
						     , Y.CTRT_NM --계약명
						     , TO_CHAR(Y.ORDRS_DT, 'YYYY-MM-DD')                           AS IO_DT              --수주일자
						     , Y.MNG_ID
						     , FN_CM06M01_ID_TO_NM(Y.MNG_ID) AS MNG_NM
						     , CR.ORDRS_DTL_DIV10                                           AS ORDRS_DTL_DIV10    --입력구분
						     , FN_CM05M01_CD_TO_NM(CR.ORDRS_DTL_DIV10)  					   AS ORDRS_DTL_DIV10_NM --입력구분명
						     , CR.ORDRS_DTL_DIV20                                           AS ORDRS_DTL_DIV20    --작업구분
						     , FN_CM05M01_CD_TO_NM(CR.ORDRS_DTL_DIV20)  					   AS ORDRS_DTL_DIV20_NM --작업구분명
						     , CR.ORDRS_DTL_DIV30                                           AS ORDRS_DTL_DIV30    --자체구분
						     , FN_CM05M01_CD_TO_NM(CR.ORDRS_DTL_DIV30)  					   AS ORDRS_DTL_DIV30_NM --자체구분명
						     , CR.MCTYPE                                                    AS MCTYPE             --기계구분
						     , FN_CM05M01_CD_TO_NM(CR.MCTYPE)  					   		   AS MCTYPE_NM          --기계구분명
						     , T.EQP_NM                                                    AS EQP_NM             --설비명
						     , TO_CHAR(CR.DUDT_INTEND_DT, 'YYYY-MM-DD') AS DUDT_INTEND_DT
						     , T.PRDT_CD
						     , C.PRDT_NM
						     , T.ITEM_DIV
						     , FN_CM05M01_CD_TO_NM(T.ITEM_DIV) AS ITEM_DIV_NM
						     , T.WORK_RPT_L
						     , FN_CM05M01_CD_TO_NM(T.WORK_RPT_L) AS WORK_RPT_L_NM
				        FROM   TB_PM01M01 AS T
				               JOIN TB_CR02D02 AS CR  ON    T.SALES_CD = CR.SALES_CD
				                                     AND    T.ORD_CO_CD= CR.CO_CD
				               JOIN TB_CR02M01 AS Y  ON     T.ORDRS_NO = Y.ORDRS_NO
				                                     AND    T.ORD_CO_CD= Y.CO_CD
				               LEFT OUTER JOIN TB_BM02M01 AS A  ON T.CLNT_CD = A.CLNT_CD
				               LEFT OUTER JOIN TB_CM06M01 AS B  ON T.WORK_RPT_ID = B.ID
				               LEFT OUTER JOIN TB_BM01M01 AS C  ON T.PRDT_CD = C.PRDT_CD
				        WHERE  1 = 1
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    T.CO_CD = #{coCd}
				        </if>
				        <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')">
				        AND    T.WORK_RPT_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD')
				        </if>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    T.WORK_RPT_ID = #{workRptId}
				        </if>
				        <if test="ordrsNo != null and !ordrsNo.equals('')">
				        AND    T.ORDRS_NO LIKE  '%'||#{ordrsNo}||'%'
				        </if>
				        <if test="salesCd != null and !salesCd.equals('')">
				        AND    T.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    T.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    T.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptL != null and !workRptL.equals('')">
				        AND    T.WORK_RPT_L = #{workRptL}
				        </if>
				        <if test="workRptM != null and !workRptM.equals('')">
				        AND    T.WORK_RPT_M = #{workRptM}
				        </if>
				        <if test="workRptS !=null and !workRptS.equals('')">
				        AND    T.WORK_RPT_S = #{workRptS}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        GROUP BY B.NAME
						     , T.ORDRS_NO
						     , T.SALES_CD
						     , T.CLNT_CD
						     , A.CLNT_NM
						     , T.CLNT_PJT
						     , Y.CTRT_NM
						     , Y.ORDRS_DT
						     , Y.MNG_ID
						     , CR.ORDRS_DTL_DIV10
						     , CR.ORDRS_DTL_DIV20
						     , CR.ORDRS_DTL_DIV30
						     , CR.MCTYPE
						     , T.EQP_NM
						     , CR.DUDT_INTEND_DT
						     , T.PRDT_CD
						     , C.PRDT_NM
						     , T.ITEM_DIV
						     , T.WORK_RPT_L
				       ) AS A
				WHERE  1 = 1
			   ) AS A
		WHERE  1 = 1
    </select>

    <select id="selectWorkOrdrsList" parameterType="Map" resultType="CamelMap">
        SELECT A.*
		FROM   (
				SELECT ROWNUM AS RNUM
				     , A.*
				FROM   (
				        SELECT  B.NAME					 AS WORK_RPT_ID_NM
						     , T.ORDRS_NO
						     , T.SALES_CD
						     , SUM(T.WORK_RPT_HOUR) AS WORK_RPT_HOUR
						     , T.CLNT_CD
						     , A.CLNT_NM
						     , T.CLNT_PJT --고객사PJT
						     , FN_CM05M01_CD_TO_NM(T.CLNT_PJT) AS CLNT_PJT_NM --고객사PJT명
						     , Y.CTRT_NM --계약명
						     , TO_CHAR(Y.ORDRS_DT, 'YYYY-MM-DD')                           AS IO_DT              --수주일자
						     , Y.MNG_ID
						     , FN_CM06M01_ID_TO_NM(Y.MNG_ID) AS MNG_NM
						     , CR.ORDRS_DTL_DIV10                                           AS ORDRS_DTL_DIV10    --입력구분
						     , FN_CM05M01_CD_TO_NM(CR.ORDRS_DTL_DIV10)  					   AS ORDRS_DTL_DIV10_NM --입력구분명
						     , CR.ORDRS_DTL_DIV20                                           AS ORDRS_DTL_DIV20    --작업구분
						     , FN_CM05M01_CD_TO_NM(CR.ORDRS_DTL_DIV20)  					   AS ORDRS_DTL_DIV20_NM --작업구분명
						     , CR.ORDRS_DTL_DIV30                                           AS ORDRS_DTL_DIV30    --자체구분
						     , FN_CM05M01_CD_TO_NM(CR.ORDRS_DTL_DIV30)  					   AS ORDRS_DTL_DIV30_NM --자체구분명
						     , CR.MCTYPE                                                    AS MCTYPE             --기계구분
						     , FN_CM05M01_CD_TO_NM(CR.MCTYPE)  					   		   AS MCTYPE_NM          --기계구분명
						     , T.EQP_NM                                                    AS EQP_NM             --설비명
						     , TO_CHAR(CR.DUDT_INTEND_DT, 'YYYY-MM-DD') AS DUDT_INTEND_DT
						     , T.PRDT_CD
						     , C.PRDT_NM
						     , T.ITEM_DIV
						     , FN_CM05M01_CD_TO_NM(T.ITEM_DIV) AS ITEM_DIV_NM
						     , T.WORK_RPT_L
						     , FN_CM05M01_CD_TO_NM(T.WORK_RPT_L) AS WORK_RPT_L_NM
				        FROM   TB_PM01M01 AS T
				               JOIN TB_CR02D02 AS CR  ON    T.SALES_CD = CR.SALES_CD
				                                     AND    T.ORD_CO_CD= CR.CO_CD
				               JOIN TB_CR02M01 AS Y  ON     T.ORDRS_NO = Y.ORDRS_NO
				                                     AND    T.ORD_CO_CD= Y.CO_CD
				               LEFT OUTER JOIN TB_BM02M01 AS A  ON T.CLNT_CD = A.CLNT_CD
				               LEFT OUTER JOIN TB_CM06M01 AS B  ON T.WORK_RPT_ID = B.ID
				               LEFT OUTER JOIN TB_BM01M01 AS C  ON T.PRDT_CD = C.PRDT_CD
				        WHERE  1 = 1
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    T.CO_CD = #{coCd}
				        </if>
				        <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')">
				        AND    T.WORK_RPT_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD')
				        </if>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    T.WORK_RPT_ID = #{workRptId}
				        </if>
				        <if test="ordrsNo != null and !ordrsNo.equals('')">
				        AND    T.ORDRS_NO LIKE  '%'||#{ordrsNo}||'%'
				        </if>
				        <if test="salesCd != null and !salesCd.equals('')">
				        AND    T.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    T.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    T.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptL != null and !workRptL.equals('')">
				        AND    T.WORK_RPT_L = #{workRptL}
				        </if>
				        <if test="workRptM != null and !workRptM.equals('')">
				        AND    T.WORK_RPT_M = #{workRptM}
				        </if>
				        <if test="workRptS !=null and !workRptS.equals('')">
				        AND    T.WORK_RPT_S = #{workRptS}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        GROUP BY B.NAME
						     , T.ORDRS_NO
						     , T.SALES_CD
						     , T.CLNT_CD
						     , A.CLNT_NM
						     , T.CLNT_PJT
						     , Y.CTRT_NM
						     , Y.ORDRS_DT
						     , Y.MNG_ID
						     , CR.ORDRS_DTL_DIV10
						     , CR.ORDRS_DTL_DIV20
						     , CR.ORDRS_DTL_DIV30
						     , CR.MCTYPE
						     , T.EQP_NM
						     , CR.DUDT_INTEND_DT
						     , T.PRDT_CD
						     , C.PRDT_NM
						     , T.ITEM_DIV
						     , T.WORK_RPT_L
						ORDER BY T.WORK_RPT_L, T.ORDRS_NO, T.SALES_CD
				       ) AS A
				WHERE  1 = 1
			   ) AS A
		WHERE  A.RNUM BETWEEN #{firstIndex} AND #{lastIndex}
    </select>

    <select id="selectIssueWorkCount" parameterType="Map" resultType="int">
        SELECT COUNT(*)
		FROM   (
				SELECT ROWNUM AS RNUM
				     , A.*
				FROM   (
				        SELECT T.FILE_TRGT_KEY
				             , T.CO_CD
				             , FN_CM05M01_CD_TO_NM(T.CO_CD) CO_NM
				             , T.WORK_RPT_NO
				             , T.WORK_RPT_ID
				             , B.NAME					 AS WORK_RPT_ID_NM
				             , TO_CHAR(T.WORK_RPT_DT,'YYYY-MM-DD') AS WORK_RPT_DT
				             , T.WORK_RPT_L
				             , T.WORK_RPT_M
				             , T.WORK_RPT_S
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_L) AS WORK_RPT_L_NM
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_M) AS WORK_RPT_M_NM
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_S) AS WORK_RPT_S_NM
				             , T.WORK_RPT_HOUR
				             , T.SALES_CD
				             , T.PRDT_CD
				             , C.PRDT_NM                        AS PRDT_CD_NM
				             , T.ITEM_DIV
				             , FN_CM05M01_CD_TO_NM(T.ITEM_DIV) AS ITEM_DIV_NM
				             , T.WORK_RPT_RMK
				             , T.WORK_RPT_RMK
				             , T.ETC_FIELD1
				             , T.ETC_FIELD2
				             , T.ETC_FIELD3
				             , T.CREAT_ID
				             , FN_CM06M01_ID_TO_NM(T.CREAT_ID) AS CREAT_NM
				             , T.CREAT_DTTM
				             , T.UDT_ID
				             , FN_CM06M01_ID_TO_NM(T.UDT_ID)  AS UDT_NM
				             , T.UDT_DTTM
				             , T.ISSUE_TITLE
				        FROM   TB_PM01M01 AS T
				               LEFT OUTER JOIN TB_CR02D02 AS CR  ON T.ORD_CO_CD= CR.CO_CD
				                                                AND T.SALES_CD = CR.SALES_CD
				               LEFT OUTER JOIN TB_CR02M01 AS Y  ON T.ORD_CO_CD= CR.CO_CD
                                                               AND T.ORDRS_NO = Y.ORDRS_NO
				               LEFT OUTER JOIN TB_BM02M01 AS A  ON T.CLNT_CD = A.CLNT_CD
				               LEFT OUTER JOIN TB_CM06M01 AS B  ON T.WORK_RPT_ID = B.ID
				               LEFT OUTER JOIN TB_BM01M01 AS C  ON T.PRDT_CD = C.PRDT_CD
				        WHERE  T.ISSUE_YN = 'Y'
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    T.CO_CD = #{coCd}
				        </if>
				        <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')">
				        AND    T.WORK_RPT_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD')
				        </if>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    T.WORK_RPT_ID = #{workRptId}
				        </if>
				        <if test="salesCd != null and !salesCd.equals('')">
				        AND    T.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    CR.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    CR.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptL != null and !workRptL.equals('')">
				        AND    T.WORK_RPT_L = #{workRptL}
				        </if>
				        <if test="workRptM != null and !workRptM.equals('')">
				        AND    T.WORK_RPT_M = #{workRptM}
				        </if>
				        <if test="workRptS !=null and !workRptS.equals('')">
				        AND    T.WORK_RPT_S = #{workRptS}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        <if test="sortType !=null and sortType.equals('DATE')">
				        ORDER BY T.CO_CD, T.WORK_RPT_ID, T.WORK_RPT_DT, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S, T.WORK_RPT_NO DESC, T.FILE_TRGT_KEY DESC
				        </if>
				        <if test="sortType !=null and sortType.equals('CODE')">
				        ORDER BY T.CO_CD, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S, T.WORK_RPT_NO DESC, T.FILE_TRGT_KEY DESC
				        </if>
				       ) AS A
				WHERE  1 = 1
			   ) AS A
		WHERE  1 = 1
    </select>

    <select id="selectIssueWorkList" parameterType="Map" resultType="CamelMap">
        SELECT A.*
		FROM   (
				SELECT ROWNUM AS RNUM
				     , A.*
				FROM   (
				        SELECT T.FILE_TRGT_KEY
				             , T.CO_CD
				             , FN_CM05M01_CD_TO_NM(T.CO_CD) CO_NM
				             , T.WORK_RPT_NO
				             , T.WORK_RPT_ID
				             , B.NAME					 AS WORK_RPT_ID_NM
				             , TO_CHAR(T.WORK_RPT_DT,'YYYY-MM-DD') AS WORK_RPT_DT
				             , T.WORK_RPT_L
				             , T.WORK_RPT_M
				             , T.WORK_RPT_S
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_L) AS WORK_RPT_L_NM
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_M) AS WORK_RPT_M_NM
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_S) AS WORK_RPT_S_NM
				             , T.ORDRS_NO
				             , T.WORK_RPT_HOUR
				             , T.SALES_CD
				             , T.PRDT_CD
				             , C.PRDT_NM                        AS PRDT_CD_NM
				             , T.ITEM_DIV
				             , FN_CM05M01_CD_TO_NM(T.ITEM_DIV) AS ITEM_DIV_NM
				             , T.WORK_RPT_RMK
				             , T.ETC_FIELD1
				             , T.ETC_FIELD2
				             , T.ETC_FIELD3
				             , T.CREAT_ID
				             , FN_CM06M01_ID_TO_NM(T.CREAT_ID) AS CREAT_NM
				             , TO_CHAR(T.CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM
				             , T.UDT_ID
				             , FN_CM06M01_ID_TO_NM(T.UDT_ID)  AS UDT_NM
				             , TO_CHAR(T.UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM
				             , T.ISSUE_TITLE
				             , T.CLNT_CD
				             , A.CLNT_NM
				             , T.ORDRS_NO
				             , T.CLNT_PJT
				             , FN_CM05M01_CD_TO_NM(T.CLNT_PJT)  AS CLNT_PJT_NM
				             , T.EQP_NM
				        FROM   TB_PM01M01 AS T
				               LEFT OUTER JOIN TB_CR02D02 AS CR  ON T.ORD_CO_CD= CR.CO_CD
				                                                AND T.SALES_CD = CR.SALES_CD
				               LEFT OUTER JOIN TB_CR02M01 AS Y  ON T.ORD_CO_CD= CR.CO_CD
                                                               AND T.ORDRS_NO = Y.ORDRS_NO
				               LEFT OUTER JOIN TB_BM02M01 AS A  ON T.CLNT_CD = A.CLNT_CD
				               LEFT OUTER JOIN TB_CM06M01 AS B  ON T.WORK_RPT_ID = B.ID
				               LEFT OUTER JOIN TB_BM01M01 AS C  ON T.PRDT_CD = C.PRDT_CD
				        WHERE  T.ISSUE_YN = 'Y'
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    T.CO_CD = #{coCd}
				        </if>
				        <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')">
				        AND    T.WORK_RPT_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD')
				        </if>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    T.WORK_RPT_ID = #{workRptId}
				        </if>
				        <if test="salesCd != null and !salesCd.equals('')">
				        AND    T.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    T.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    T.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptL != null and !workRptL.equals('')">
				        AND    T.WORK_RPT_L = #{workRptL}
				        </if>
				        <if test="workRptM != null and !workRptM.equals('')">
				        AND    T.WORK_RPT_M = #{workRptM}
				        </if>
				        <if test="workRptS !=null and !workRptS.equals('')">
				        AND    T.WORK_RPT_S = #{workRptS}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        <if test="sortType !=null and sortType.equals('DATE')">
				        ORDER BY T.CO_CD, T.WORK_RPT_ID, T.WORK_RPT_DT, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S, T.WORK_RPT_NO DESC, T.FILE_TRGT_KEY DESC
				        </if>
				        <if test="sortType !=null and sortType.equals('CODE')">
				        ORDER BY T.CO_CD, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S, T.WORK_RPT_NO DESC, T.FILE_TRGT_KEY DESC
				        </if>
				       ) AS A
				WHERE  1 = 1
			   ) AS A
		WHERE  A.RNUM BETWEEN #{firstIndex} AND #{lastIndex}
    </select>



    <select id="selectAllIssueWorkListCount" parameterType="Map" resultType="int">
    SELECT COUNT(*)
		FROM   (
			SELECT ROWNUM AS RNUM
			     , A.*
			FROM   ( SELECT
				       A.*
				     , REQ.REQ_AMT
				FROM   (
						SELECT '일보' AS GUBUN
     						 , T.FILE_TRGT_KEY
				             , T.CO_CD
				             , FN_CM05M01_CD_TO_NM(T.CO_CD) CO_NM
				             , T.WORK_RPT_NO
				             , T.WORK_RPT_ID
				             , B.NAME					 AS WORK_RPT_ID_NM
				             , B1.DEPT_NM				 AS WORK_RPT_DEPT_NM
				             , TO_CHAR(T.WORK_RPT_DT,'YYYY-MM-DD') AS WORK_RPT_DT
				             , T.ORDRS_NO
				             , T.SALES_CD
				             , T.PRDT_CD
				             , C.PRDT_NM                        AS PRDT_CD_NM
				             , T.ITEM_DIV
				             , FN_CM05M01_CD_TO_NM(T.ITEM_DIV) AS ITEM_DIV_NM
				             , T.WORK_RPT_RMK
				             , T.ISSUE_TITLE
				             , T.CLNT_CD
				             , A.CLNT_NM
				             , T.CLNT_PJT
				             , FN_CM05M01_CD_TO_NM(T.CLNT_PJT)  AS CLNT_PJT_NM
				             , T.EQP_NM
				             , '작업일보' as JOB_DIV
				             , ''        AS ISS_DIV
							 , ''        AS ISS_DIV_NM
				             , 'ISSSTS03'  AS ISS_STS
				             , '발생으로완료'  AS ISS_STS_NM
							 , ''        AS ACT_ID
							 , ''        AS ACT_ID_NM
				             , '' 		 AS ACT_DEPT_NM		  --조치부서
				             , '' 		 AS ACT_DEPT_ID		  --조치부서
							 , ''        AS ACTS_DT
							 , ''        AS ACTE_DT
							 , ''        AS ACT_MH
							 , ''        AS ACT_AMT
							 , ''        AS WBS_RSLTSS_DT
							 , ''        AS WBS_RSLTSE_DT
		                     , '' 		 AS ACT_AMT_STS
		                     , ''		 AS ACT_AMT_STS_NM
		                     , ''		 AS ACT_DNG
		                     , '' 		 AS ACT_DNG_NM
		                     , '' 		 AS ACT_DNG_EVAL
		                     , '' 		 AS ACT_DNG_EVAL_NM
					        , C.PRDT_GRP 	AS PRDT_DIV_CD
					        , C7.CODE_NM    AS PRDT_DIV_NM
					        , ''  AS MID_CD
		                    , ''  AS MID_CD_NM
					        , ''  AS SUB_CD
		                    , ''  AS SUB_CD_NM
					        , ''  AS REQ_NO
					        , ''  AS RES_FILE_TRGT_KEY
					        , ''  AS ACT_COMP_DGN_FILE_NM --도면반영파일명
					        , 'REQST03' AS REQ_ST
					        , ''  AS ACT_CNTS	--결과
					        , ''  AS MEAS_RST	--원인
					        , ''  AS RSLT_NO
					        , ''		 AS USER_ID
		                    , ''		 AS USER_NAME
					        , ''		 AS DEPT_ID
				        FROM   TB_PM01M01 AS T
				               LEFT OUTER JOIN TB_CR02D02 AS CR  ON T.ORD_CO_CD= CR.CO_CD
				                                                AND T.SALES_CD = CR.SALES_CD
				               LEFT OUTER JOIN TB_CR02M01 AS Y  ON T.ORD_CO_CD= Y.CO_CD
                                                               AND T.ORDRS_NO = Y.ORDRS_NO
				               LEFT OUTER JOIN TB_BM02M01 AS A  ON T.CLNT_CD = A.CLNT_CD
				               LEFT OUTER JOIN TB_CM06M01 AS B  ON T.WORK_RPT_ID = B.ID
				               LEFT OUTER JOIN TB_CM04M01 AS B1 ON B1.DEPT_ID = SUBSTRING(B.DEPT_ID,0,5)
				               LEFT OUTER JOIN TB_BM01M01 AS C  ON T.PRDT_CD = C.PRDT_CD
				               LEFT OUTER JOIN TB_CM05M01 AS C7 ON C7.CODE_ID = C.PRDT_GRP
				        WHERE  T.ISSUE_YN = 'Y'
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    T.CO_CD = #{coCd}
				        </if>
				    <choose>
				        <when test="salesCd != null and !salesCd.equals('')">
				        AND    T.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        </when>
				        <otherwise>
						AND    T.WORK_RPT_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD')
				        </otherwise>
				    </choose>
				    <choose>
				        <when test="issSts == 'STS04' or issSts.equals('STS04')">
		                AND  1 = 1
				        </when>
				        <otherwise>
						AND  1 = 2
				        </otherwise>
				    </choose>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    T.WORK_RPT_ID = #{workRptId}
				        </if>
				        <if test="prjctCd != null and !prjctCd.equals('')">
				        AND    T.CLNT_PJT = #{prjctCd}
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    T.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    T.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        <if test="actId != null and !actId.equals('')">
				        AND    1 = 0
				        </if>
				        <if test="actId.equals('') and actIdNm !=null and !actIdNm.equals('')">
				        AND    1 = 0
				        </if>
				        <if test="prdtDiv !=null and !prdtDiv.equals('')">
				        AND    C.PRDT_GRP = #{prdtDiv}
				        </if>
			    UNION ALL
		              SELECT '실적'  AS GUBUN
		                    , ISU.FILE_TRGT_KEY                                       --이슈 FILE_TRGT_KEY
		                    , ISU.CO_CD                                               --회사코드
			             	, FN_CM05M01_CD_TO_NM(ISU.CO_CD) CO_NM
		                    , ISU.ISS_NO        		 AS WORK_RPT_NO               --이슈번호
		                    , ISU.CREAT_ID  --생성자
			             	, B.NAME					 AS WORK_RPT_ID_NM
				            , B1.DEPT_NM				 AS WORK_RPT_DEPT_NM
		                    , TO_CHAR(ISU.CREAT_DTTM,'YYYY-MM-DD') AS CREAT_DTTM   --생성일자
		                    , Y.ORDRS_NO
		                    , ISU.SALES_CD                                			--SALES Code
				            , CR.PRDT_CD
				            , C.PRDT_NM                        AS PRDT_CD_NM
				            , CR.ITEM_DIV
				            , FN_CM05M01_CD_TO_NM(CR.ITEM_DIV) AS ITEM_DIV_NM
		                    , ISU.ISS_CNTS                                            --이슈내용
		                    , ISU.ISS_SJ                                              --이슈제목
				            , TO_CHAR(Y.ORDRS_CLNT_CD)  AS  CLNT_CD
				            , A.CLNT_NM
				            , Y.CLNT_PJT
				            , FN_CM05M01_CD_TO_NM(Y.CLNT_PJT)  AS CLNT_PJT_NM
				            , CR.EQP_NM
				            , '일정관리' as JOB_DIV
		                    , ISU.ISS_DIV                                             --이슈유형
		                    , (SELECT FN_CM05M01_CD_TO_NM(ISU.ISS_DIV) FROM DUAL) AS ISS_DIV_NM
		                    , decode(ISU.REQ_NO, '', ISU.ISS_STS, QM.REQ_ST)      AS ISS_STS	--이슈상태
		                    , (SELECT FN_CM05M01_CD_TO_NM( decode(ISU.REQ_NO, '', ISU.ISS_STS, QM.REQ_ST)) FROM DUAL) AS ISS_STS_NM
		                    , decode(ISU.REQ_NO, '', ISU.ACT_ID, QM.ORDRG_ID)       					AS ACT_ID    --조치담당자
							, decode(ISU.REQ_NO, '', B2.NAME, B4.NAME) 			 						AS ACT_ID_NM
				            , decode(ISU.REQ_NO, '', B3.DEPT_NM,B5.DEPT_NM) 							AS ACT_DEPT_NM		  --조치부서
				            , SUBSTRING(decode(ISU.REQ_NO, '', B2.DEPT_ID,B4.DEPT_ID),0,5) 		 		AS ACT_DEPT_ID		  --조치부서
		                    , TO_CHAR(decode(ISU.REQ_NO, '', ACT.ACTS_DT, QM.ORDRG_DT),'YYYY-MM-DD')  	AS ACTS_DT           --조치 시작일
		                    , TO_CHAR(decode(ISU.REQ_NO, '', ACT.ACTE_DT, QP.RSLT_DT),'YYYY-MM-DD')  	AS ACTE_DT           --조치 종료일
--		                    , decode(ISU.REQ_NO, '', ACT.ACT_MH, QP.ACT_MH)          					AS ACT_MH   --조치 투입공수
		                    , ACT.ACT_MH          					AS ACT_MH   --조치 투입공수
		                    , ACT.ACT_AMT                                             --조치 투입비용
		                    , TO_CHAR(RSL.WBS_RSLTSS_DT,'YYYY-MM-DD') 									AS WBS_RSLTSS_DT--실적시작일
		                    , TO_CHAR(RSL.WBS_RSLTSE_DT,'YYYY-MM-DD') 									AS WBS_RSLTSE_DT--실적종료일
		                    , ACT.ACT_AMT_STS
		                    , (SELECT FN_CM05M01_CD_TO_NM(ACT.ACT_AMT_STS) FROM DUAL) AS ACT_AMT_STS_NM
		                    , ACT.ACT_DNG
		                    , (SELECT FN_CM05M01_CD_TO_NM(ACT.ACT_DNG) FROM DUAL) AS ACT_DNG_NM
		                    , ACT.ACT_DNG_EVAL
		                    , (SELECT FN_CM05M01_CD_TO_NM(ACT.ACT_DNG_EVAL) FROM DUAL) AS ACT_DNG_EVAL_NM
					        , C.PRDT_GRP 	AS PRDT_DIV_CD
					        , C7.CODE_NM    AS PRDT_DIV_NM
					        , ISU.MID_CD
		                    , (SELECT FN_CM05M01_CD_TO_NM(ISU.MID_CD) FROM DUAL) AS MID_CD_NM
					        , ISU.SUB_CD
		                    , (SELECT FN_CM05M01_CD_TO_NM(ISU.SUB_CD) FROM DUAL) AS SUB_CD_NM
					        , ISU.REQ_NO
					        , QM.FILE_TRGT_KEY 								 AS RES_FILE_TRGT_KEY
					        , QM.ACT_COMP_DGN_FILE_NM --도면반영파일명
					        , QM.REQ_ST
					        , NVL2(QP.RESLT_RST, QP.RESLT_RST, ACT.ACT_CNTS) 		 AS ACT_CNTS	--결과(ISU.REQ_NO가 Null이 아니면 QP.결과, null이면 ACT.결과)
					        , NVL2(QP.MEAS_RST, QP.MEAS_RST, ACT.MEAS_RST)		 AS MEAS_RST	--원인
					        , QP.RSLT_NO
					        , B2.ID 			 AS USER_ID
		                    , B2.NAME			 AS USER_NAME
					        , B2.DEPT_ID		 AS DEPT_ID
		                FROM TB_WB24M02  AS ISU --WBS이슈 정보
			            		LEFT OUTER JOIN TB_CR02D02 AS CR  ON ISU.CO_CD= CR.CO_CD
			                                                	AND ISU.SALES_CD = CR.SALES_CD
			            		LEFT OUTER JOIN TB_CR02M01 AS Y  ON ISU.CO_CD= Y.CO_CD
                                                              	AND CR.ORDRS_NO = Y.ORDRS_NO
			            		LEFT OUTER JOIN TB_BM02M01 AS A  ON Y.ORDRS_CLNT_CD = A.CLNT_CD
			           			LEFT OUTER JOIN TB_CM06M01 AS B  ON ISU.CREAT_ID = B.ID
				                LEFT OUTER JOIN TB_CM04M01 AS B1 ON B1.DEPT_ID = SUBSTRING(B.DEPT_ID,0,5)
			           			LEFT OUTER JOIN TB_CM06M01 AS B2 ON ISU.ACT_ID = B2.ID
				                LEFT OUTER JOIN TB_CM04M01 AS B3 ON B3.DEPT_ID = SUBSTRING(B2.DEPT_ID,0,5)
			          			LEFT OUTER JOIN TB_BM01M01 AS C  ON CR.PRDT_CD = C.PRDT_CD
				                LEFT OUTER JOIN TB_CM05M01 AS C7 ON C7.CODE_ID = C.PRDT_GRP
		            			LEFT OUTER JOIN TB_WB24M03 AS ACT ON ISU.ISS_NO = ACT.ISS_NO --실적이슈 조치내용
		              			LEFT OUTER JOIN TB_WB23M01 AS RSL ON ISU.CO_CD = RSL.CO_CD AND ISU.SALES_CD = RSL.SALES_CD AND ISU.WBS_PLAN_CODE_KIND = RSL.WBS_PLAN_CODE_KIND AND ISU.WBS_PLAN_CODE_ID = RSL.WBS_PLAN_CODE_ID AND ISU.WBS_RSLTS_NO = RSL.WBS_RSLTS_NO
		              			LEFT OUTER JOIN TB_QM01M01 AS QM ON QM.REQ_NO = ISU.REQ_NO
								LEFT OUTER JOIN TB_QM01P01 AS QP ON QP.REQ_NO = ISU.REQ_NO
			           			LEFT OUTER JOIN TB_CM06M01 AS B4 ON QM.ORDRG_ID = B4.ID
				                LEFT OUTER JOIN TB_CM04M01 AS B5 ON B5.DEPT_ID = SUBSTRING(B4.DEPT_ID,0,5)
		               WHERE 1=1
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    ISU.CO_CD = #{coCd}
				        </if>
				    <choose>
				        <when test="salesCd != null and !salesCd.equals('')">
				        AND    (ISU.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        OR    ISU.ISS_NO LIKE  '%'||#{salesCd}||'%'
				        OR    ISU.REQ_NO LIKE  '%'||#{salesCd}||'%')
				        </when>
				        <otherwise>
		                AND (
		                		(QM.REQ_ST = 'REQST03' AND  ISU.CREAT_DTTM BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD'))
		                         OR (NVL(QM.REQ_ST,'REQST01') != 'REQST03')
		                         OR (NVL(ISU.ISS_STS,'ISSSTS01') != 'ISSSTS03' AND ISU.REQ_NO IS NULL)  
		                    )
				        </otherwise>
				    </choose>
				    <choose>
				        <when test="issSts == 'STS01' or issSts.equals('STS01')">
		                AND  ((ISU.REQ_NO IS NOT NULL AND QM.REQ_ST = 'REQST01')
		                OR  (ISU.REQ_NO IS NULL AND ISU.ISS_STS = 'ISSSTS01'))
		                --decode(ISU.REQ_NO, '', ISU.ISS_STS, QM.REQ_ST)      AS ISS_STS	--이슈상태
				        </when>
				        <when test="issSts == 'STS04' or issSts.equals('STS04')">
		                AND  ((ISU.REQ_NO IS NOT NULL AND QM.REQ_ST = 'REQST03')
		                OR  (ISU.REQ_NO IS NULL AND ISU.ISS_STS = 'ISSSTS03'))
				        </when>
				        <when test="issSts == 'STS02' or issSts.equals('STS02')">
		                AND  (ISU.REQ_NO IS NULL AND ISU.ISS_STS = 'ISSSTS02')
				        </when>
				        <when test="issSts == 'STS03' or issSts.equals('STS03')">
		                AND  (ISU.REQ_NO IS NOT NULL AND QM.REQ_ST = 'REQST02')
				        </when>
				    </choose>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    ISU.CREAT_ID = #{workRptId}
				        </if>
				        <if test="prjctCd != null and !prjctCd.equals('')">
				        AND    Y.CLNT_PJT = #{prjctCd}
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    CR.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    CR.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        <if test="actId != null and !actId.equals('')">
				        AND    ISU.ACT_ID = #{actId}
				        </if>
				        <if test="actId.equals('') and actIdNm !=null and !actIdNm.equals('')">
				        AND    B2.NAME LIKE  '%'||#{actIdNm}||'%'
				        </if>
				        <if test="prdtDiv !=null and !prdtDiv.equals('')">
				        AND    C.PRDT_GRP = #{prdtDiv}
				        </if>
				       ) AS A
				       		LEFT OUTER JOIN ( SELECT ME.REQ_NO, sum(ME.PCHS_AMT) AS REQ_AMT
												FROM TB_SM12D01 ME
												GROUP BY ME.REQ_NO
												) AS REQ ON REQ.REQ_NO = A.REQ_NO
				WHERE  1 = 1
				ORDER BY ISS_STS, WORK_RPT_DT DESC, WORK_RPT_ID_NM,  ACT_ID_NM, SUB_CD_NM
				) AS A
			WHERE  1 = 1
		   ) AS A
    </select>

    <select id="selectAllIssueWorkList" parameterType="Map" resultType="CamelMap">
    SELECT A.*
		FROM   (
			SELECT ROWNUM AS RNUM
			     , A.*
			FROM   ( SELECT
				       A.*
				     , REQ.REQ_AMT
				FROM   (
						SELECT '일보' AS GUBUN
     						 , T.FILE_TRGT_KEY
				             , T.CO_CD
				             , FN_CM05M01_CD_TO_NM(T.CO_CD) CO_NM
				             , T.WORK_RPT_NO
				             , T.WORK_RPT_ID
				             , B.NAME					 AS WORK_RPT_ID_NM
				             , B1.DEPT_NM				 AS WORK_RPT_DEPT_NM
				             , TO_CHAR(T.WORK_RPT_DT,'YYYY-MM-DD') AS WORK_RPT_DT
				             , T.ORDRS_NO
				             , T.SALES_CD
				             , T.PRDT_CD
				             , C.PRDT_NM                        AS PRDT_CD_NM
				             , T.ITEM_DIV
				             , FN_CM05M01_CD_TO_NM(T.ITEM_DIV) AS ITEM_DIV_NM
				             , T.WORK_RPT_RMK
				             , T.ISSUE_TITLE
				             , T.CLNT_CD
				             , A.CLNT_NM
				             , T.CLNT_PJT
				             , FN_CM05M01_CD_TO_NM(T.CLNT_PJT)  AS CLNT_PJT_NM
				             , T.EQP_NM
				             , '작업일보' as JOB_DIV
				             , ''        AS ISS_DIV
							 , ''        AS ISS_DIV_NM
				             , 'ISSSTS03'  AS ISS_STS
				             , '발생으로완료'  AS ISS_STS_NM
							 , ''        AS ACT_ID
							 , ''        AS ACT_ID_NM
				             , '' 		 AS ACT_DEPT_NM		  --조치부서
				             , '' 		 AS ACT_DEPT_ID		  --조치부서
							 , ''        AS ACTS_DT
							 , ''        AS ACTE_DT
							 , ''        AS ACT_MH
							 , ''        AS ACT_AMT
							 , ''        AS WBS_RSLTSS_DT
							 , ''        AS WBS_RSLTSE_DT
		                     , '' 		 AS ACT_AMT_STS
		                     , ''		 AS ACT_AMT_STS_NM
		                     , ''		 AS ACT_DNG
		                     , '' 		 AS ACT_DNG_NM
		                     , '' 		 AS ACT_DNG_EVAL
		                     , '' 		 AS ACT_DNG_EVAL_NM
					        , C.PRDT_GRP 	AS PRDT_DIV_CD
					        , C7.CODE_NM    AS PRDT_DIV_NM
					        , ''  AS MID_CD
		                    , ''  AS MID_CD_NM
					        , ''  AS SUB_CD
		                    , ''  AS SUB_CD_NM
					        , ''  AS REQ_NO
					        , ''  AS RES_FILE_TRGT_KEY
					        , ''  AS ACT_COMP_DGN_FILE_NM --도면반영파일명
					        , 'REQST03' AS REQ_ST
					        , ''  AS ACT_CNTS	--결과
					        , ''  AS MEAS_RST	--원인
					        , ''  AS RSLT_NO
					        , '' AS USER_ID
		                    , '' AS USER_NAME
					        , '' AS DEPT_ID
					        , '' AS MC_PART_CD	--기계분류
					        , '' AS IMPORTANT_CD	--중요도
					        , '' AS IMPACT_CD	--영향도
					        , '' AS MC_PART_CD_NM
					        , '' AS IMPORTANT_CD_NM
					        , '' AS IMPACT_CD_NM
					        , '' AS LAB_STS		--연구소 결재
					        , '' AS PUR_STS		--구매 결재
					        , '' AS PRD_STS		--생산 결재
					        , '' AS OUT_STS		--직접매출 결재
					        , '' AS LAB_APPROVAL_DT		--연구소 결재
					        , '' AS PUR_APPROVAL_DT		--구매 결재
					        , '' AS PRD_APPROVAL_DT		--생산 결재
					        , '' AS OUT_APPROVAL_DT		--직접매출 결재
					        , '' AS CUST_REQ_DT			--과제 납기예정일 ->고객요구일
					        , '' AS DUDT_INTEND_DT		--수주 납기예정일 ->고객요구일
				        FROM   TB_PM01M01 AS T
				               LEFT OUTER JOIN TB_CR02D02 AS CR  ON T.ORD_CO_CD= CR.CO_CD
				                                                AND T.SALES_CD = CR.SALES_CD
				               LEFT OUTER JOIN TB_CR02M01 AS Y  ON T.ORD_CO_CD= Y.CO_CD
                                                               AND T.ORDRS_NO = Y.ORDRS_NO
				               LEFT OUTER JOIN TB_BM02M01 AS A  ON T.CLNT_CD = A.CLNT_CD
				               LEFT OUTER JOIN TB_CM06M01 AS B  ON T.WORK_RPT_ID = B.ID
				               LEFT OUTER JOIN TB_CM04M01 AS B1 ON B1.DEPT_ID = SUBSTRING(B.DEPT_ID,0,5)
				               LEFT OUTER JOIN TB_BM01M01 AS C  ON T.PRDT_CD = C.PRDT_CD
				               LEFT OUTER JOIN TB_CM05M01 AS C7 ON C7.CODE_ID = C.PRDT_GRP
				        WHERE  T.ISSUE_YN = 'Y'
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    T.CO_CD = #{coCd}
				        </if>
				    <choose>
				        <when test="salesCd != null and !salesCd.equals('')">
				        AND    T.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        </when>
				        <otherwise>
						AND    T.WORK_RPT_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD')
				        </otherwise>
				    </choose>
				    <choose>
				        <when test="issSts == 'STS04' or issSts.equals('STS04')">
		                AND  1 = 1
				        </when>
				        <otherwise>
						AND  1 = 2
				        </otherwise>
				    </choose>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    T.WORK_RPT_ID = #{workRptId}
				        </if>
				        <if test="prjctCd != null and !prjctCd.equals('')">
				        AND    T.CLNT_PJT = #{prjctCd}
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    T.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    T.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        <if test="actId != null and !actId.equals('')">
				        AND    1 = 0
				        </if>
				        <if test="actId.equals('') and actIdNm !=null and !actIdNm.equals('')">
				        AND    1 = 0
				        </if>
				        <if test="prdtDiv !=null and !prdtDiv.equals('')">
				        AND    C.PRDT_GRP = #{prdtDiv}
				        </if>
			    UNION ALL
		              SELECT '실적'  AS GUBUN
		                    , ISU.FILE_TRGT_KEY                                       --이슈 FILE_TRGT_KEY
		                    , ISU.CO_CD                                               --회사코드
			             	, FN_CM05M01_CD_TO_NM(ISU.CO_CD) CO_NM
		                    , ISU.ISS_NO        		 AS WORK_RPT_NO               --이슈번호
		                    , ISU.CREAT_ID  --생성자
			             	, B.NAME					 AS WORK_RPT_ID_NM
				            , B1.DEPT_NM				 AS WORK_RPT_DEPT_NM
		                    , TO_CHAR(ISU.CREAT_DTTM,'YYYY-MM-DD') AS CREAT_DTTM   --생성일자
		                    , Y.ORDRS_NO
		                    , ISU.SALES_CD                                			--SALES Code
				            , CR.PRDT_CD
				            , C.PRDT_NM                        AS PRDT_CD_NM
				            , CR.ITEM_DIV
				            , FN_CM05M01_CD_TO_NM(CR.ITEM_DIV) AS ITEM_DIV_NM
		                    , ISU.ISS_CNTS                                            --이슈내용
		                    , ISU.ISS_SJ                                              --이슈제목
				            , TO_CHAR(Y.ORDRS_CLNT_CD)  AS  CLNT_CD
				            , A.CLNT_NM
				            , Y.CLNT_PJT
				            , FN_CM05M01_CD_TO_NM(Y.CLNT_PJT)  AS CLNT_PJT_NM
				            , CR.EQP_NM
				            , '일정관리' as JOB_DIV
		                    , ISU.ISS_DIV                                             --이슈유형
		                    , (SELECT FN_CM05M01_CD_TO_NM(ISU.ISS_DIV) FROM DUAL) AS ISS_DIV_NM
		                    , decode(ISU.REQ_NO, '', ISU.ISS_STS, QM.REQ_ST)      AS ISS_STS	--이슈상태
		                    , (SELECT FN_CM05M01_CD_TO_NM( decode(ISU.REQ_NO, '', ISU.ISS_STS, QM.REQ_ST)) FROM DUAL) AS ISS_STS_NM
		                    , decode(ISU.REQ_NO, '', ISU.ACT_ID, QM.ORDRG_ID)       					AS ACT_ID    --조치담당자
							, decode(ISU.REQ_NO, '', B2.NAME, B4.NAME) 			 						AS ACT_ID_NM
				            , decode(ISU.REQ_NO, '', B3.DEPT_NM,B5.DEPT_NM) 							AS ACT_DEPT_NM		  --조치부서
				            , SUBSTRING(decode(ISU.REQ_NO, '', B2.DEPT_ID,B4.DEPT_ID),0,5) 		 		AS ACT_DEPT_ID		  --조치부서
		                    , TO_CHAR(decode(ISU.REQ_NO, '', ACT.ACTS_DT, QM.ORDRG_DT),'YYYY-MM-DD')  	AS ACTS_DT           --조치 시작일
		                    , TO_CHAR(decode(ISU.REQ_NO, '', ACT.ACTE_DT, QP.RSLT_DT),'YYYY-MM-DD')  	AS ACTE_DT           --조치 종료일
--		                    , decode(ISU.REQ_NO, '', ACT.ACT_MH, QP.ACT_MH)          					AS ACT_MH   --조치 투입공수
		                    , ACT.ACT_MH          					AS ACT_MH   --조치 투입공수
		                    , ACT.ACT_AMT                                             --조치 투입비용
		                    , TO_CHAR(RSL.WBS_RSLTSS_DT,'YYYY-MM-DD') 									AS WBS_RSLTSS_DT--실적시작일
		                    , TO_CHAR(RSL.WBS_RSLTSE_DT,'YYYY-MM-DD') 									AS WBS_RSLTSE_DT--실적종료일
		                    , ACT.ACT_AMT_STS
		                    , (SELECT FN_CM05M01_CD_TO_NM(ACT.ACT_AMT_STS) FROM DUAL) AS ACT_AMT_STS_NM
		                    , ACT.ACT_DNG
		                    , (SELECT FN_CM05M01_CD_TO_NM(ACT.ACT_DNG) FROM DUAL) AS ACT_DNG_NM
		                    , ACT.ACT_DNG_EVAL
		                    , (SELECT FN_CM05M01_CD_TO_NM(ACT.ACT_DNG_EVAL) FROM DUAL) AS ACT_DNG_EVAL_NM
					        , C.PRDT_GRP 	AS PRDT_DIV_CD
					        , C7.CODE_NM    AS PRDT_DIV_NM
					        , ISU.MID_CD
		                    , (SELECT FN_CM05M01_CD_TO_NM(ISU.MID_CD) FROM DUAL) AS MID_CD_NM
					        , ISU.SUB_CD
		                    , (SELECT FN_CM05M01_CD_TO_NM(ISU.SUB_CD) FROM DUAL) AS SUB_CD_NM
					        , ISU.REQ_NO
					        , QM.FILE_TRGT_KEY 								 AS RES_FILE_TRGT_KEY
					        , QM.ACT_COMP_DGN_FILE_NM --도면반영파일명
					        , QM.REQ_ST
					        , NVL2(QP.RESLT_RST, QP.RESLT_RST, ACT.ACT_CNTS) 		 AS ACT_CNTS	--결과(ISU.REQ_NO가 Null이 아니면 QP.결과, null이면 ACT.결과)
					        , NVL2(QP.MEAS_RST, QP.MEAS_RST, ACT.MEAS_RST)		 AS MEAS_RST	--원인
					        , QP.RSLT_NO
					        , B2.ID 			 AS USER_ID
		                    , B2.NAME			 AS USER_NAME
					        , B2.DEPT_ID		 AS DEPT_ID
					        , decode(QP.MC_PART_CD	, '', decode(QM.MC_PART_CD	, '', ISU.MC_PART_CD	, QM.MC_PART_CD)	, QP.MC_PART_CD)	 AS MC_PART_CD	--기계분류
					        , decode(QP.IMPORTANT_CD, '', decode(QM.IMPORTANT_CD, '', ISU.IMPORTANT_CD	, QM.IMPORTANT_CD)	, QP.IMPORTANT_CD)	 AS IMPORTANT_CD	--중요도
					        , decode(QP.IMPACT_CD	, '', decode(QM.IMPACT_CD	, '', ISU.IMPACT_CD		, QM.IMPACT_CD)		, QP.IMPACT_CD)		 AS IMPACT_CD	--영향도
					        , (SELECT FN_CM05M01_CD_TO_NM(decode(QP.MC_PART_CD	, '', decode(QM.MC_PART_CD	, '', ISU.MC_PART_CD	, QM.MC_PART_CD)	, QP.MC_PART_CD)	) FROM DUAL) AS MC_PART_CD_NM
					        , (SELECT FN_CM05M01_CD_TO_NM(decode(QP.IMPORTANT_CD, '', decode(QM.IMPORTANT_CD, '', ISU.IMPORTANT_CD	, QM.IMPORTANT_CD)	, QP.IMPORTANT_CD)	) FROM DUAL) AS IMPORTANT_CD_NM
					        , (SELECT FN_CM05M01_CD_TO_NM(decode(QP.IMPACT_CD	, '', decode(QM.IMPACT_CD	, '', ISU.IMPACT_CD		, QM.IMPACT_CD)		, QP.IMPACT_CD)		) FROM DUAL) AS IMPACT_CD_NM
					        , W1.SANCTN_STTUS AS LAB_STS		--연구소 결재
					        , W2.SANCTN_STTUS AS PUR_STS		--구매 결재
					        , W3.SANCTN_STTUS AS PRD_STS		--생산 결재
					        , W4.SANCTN_STTUS AS OUT_STS		--직접매출 결재
					        , to_char(W1.TODO_CF_DT,'MM/DD')  AS LAB_APPROVAL_DT		--연구소 결재
					        , to_char(W2.TODO_CF_DT,'MM/DD')  AS PUR_APPROVAL_DT		--구매 결재
					        , to_char(W3.TODO_CF_DT,'MM/DD')  AS PRD_APPROVAL_DT		--생산 결재
					        , to_char(W4.TODO_CF_DT,'MM/DD')  AS OUT_APPROVAL_DT		--직접매출 결재
                            , TO_CHAR(W9.DE_DT, 'YYYY-MM-DD') AS CUST_REQ_DT			--과제 출고일 = 고객요구일
					        , TO_CHAR(CR.DUDT_INTEND_DT,'YYYY-MM-DD') AS DUDT_INTEND_DT	--수주 납기예정일 ->고객요구일
		                FROM TB_WB24M02  AS ISU --WBS이슈 정보
			            		LEFT OUTER JOIN TB_CR02D02 AS CR  ON ISU.CO_CD= CR.CO_CD
			                                                	AND ISU.SALES_CD = CR.SALES_CD
			            		LEFT OUTER JOIN TB_CR02M01 AS Y  ON ISU.CO_CD= Y.CO_CD
                                                              	AND CR.ORDRS_NO = Y.ORDRS_NO
			            		LEFT OUTER JOIN TB_BM02M01 AS A  ON Y.ORDRS_CLNT_CD = A.CLNT_CD
			           			LEFT OUTER JOIN TB_CM06M01 AS B  ON ISU.CREAT_ID = B.ID
				                LEFT OUTER JOIN TB_CM04M01 AS B1 ON B1.DEPT_ID = SUBSTRING(B.DEPT_ID,0,5)
			           			LEFT OUTER JOIN TB_CM06M01 AS B2 ON ISU.ACT_ID = B2.ID
				                LEFT OUTER JOIN TB_CM04M01 AS B3 ON B3.DEPT_ID = SUBSTRING(B2.DEPT_ID,0,5)
			          			LEFT OUTER JOIN TB_BM01M01 AS C  ON CR.PRDT_CD = C.PRDT_CD
				                LEFT OUTER JOIN TB_CM05M01 AS C7 ON C7.CODE_ID = C.PRDT_GRP
		            			LEFT OUTER JOIN TB_WB24M03 AS ACT ON ISU.ISS_NO = ACT.ISS_NO --실적이슈 조치내용
		              			LEFT OUTER JOIN TB_WB23M01 AS RSL ON ISU.CO_CD = RSL.CO_CD AND ISU.SALES_CD = RSL.SALES_CD AND ISU.WBS_PLAN_CODE_KIND = RSL.WBS_PLAN_CODE_KIND AND ISU.WBS_PLAN_CODE_ID = RSL.WBS_PLAN_CODE_ID AND ISU.WBS_RSLTS_NO = RSL.WBS_RSLTS_NO
		              			LEFT OUTER JOIN TB_QM01M01 AS QM ON QM.REQ_NO = ISU.REQ_NO
								LEFT OUTER JOIN TB_QM01P01 AS QP ON QP.REQ_NO = ISU.REQ_NO
			           			LEFT OUTER JOIN TB_CM06M01 AS B4 ON QM.ORDRG_ID = B4.ID
				                LEFT OUTER JOIN TB_CM04M01 AS B5 ON B5.DEPT_ID = SUBSTRING(B4.DEPT_ID,0,5)
				                LEFT OUTER JOIN TB_WB20M03 AS W1 ON W1.TODO_NO = ISU.REQ_NO AND W1.TODO_DIV2_CODE_ID='TODODIV2020' AND W1.TODO_ID='kimjhv' 		--김재현상무
				                LEFT OUTER JOIN TB_WB20M03 AS W2 ON W2.TODO_NO = ISU.REQ_NO AND W2.TODO_DIV2_CODE_ID='TODODIV2020' AND W2.TODO_ID='h4ng10'		--허상렬팀장
				                LEFT OUTER JOIN TB_WB20M03 AS W3 ON W3.TODO_NO = ISU.REQ_NO AND W3.TODO_DIV2_CODE_ID='TODODIV2020' AND W3.TODO_ID='K98452000'	--김동현이사
				                LEFT OUTER JOIN TB_WB20M03 AS W4 ON W4.TODO_NO = ISU.REQ_NO AND W4.TODO_DIV2_CODE_ID='TODODIV2020' AND W4.TODO_ID='choigss'		--최경식이사
                                LEFT OUTER JOIN (
											    SELECT W9.*, ROW_NUMBER() OVER (PARTITION BY SALES_CD ORDER BY VER_NO DESC) AS rn
											    FROM TB_WB21M01 W9
											) W9 ON W9.CO_CD = CR.CO_CD AND W9.SALES_CD = CR.SALES_CD AND W9.rn = 1  --마지막 버전의 과제정보 가져오기
		               WHERE 1=1
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    ISU.CO_CD = #{coCd}
				        </if>
				    <choose>
				        <when test="salesCd != null and !salesCd.equals('')">
				        AND    (ISU.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        OR    ISU.ISS_NO LIKE  '%'||#{salesCd}||'%'
				        OR    ISU.REQ_NO LIKE  '%'||#{salesCd}||'%')
				        </when>
				        <otherwise>
		                AND (
		                		(QM.REQ_ST = 'REQST03' AND  ISU.CREAT_DTTM BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD'))
		                         OR (NVL(QM.REQ_ST,'REQST01') != 'REQST03')
		                         OR (NVL(ISU.ISS_STS,'ISSSTS01') != 'ISSSTS03' AND ISU.REQ_NO IS NULL)  
		                    )
				        </otherwise>
				    </choose>
				    <choose>
				        <when test="issSts == 'STS01' or issSts.equals('STS01')">
		                AND  ((ISU.REQ_NO IS NOT NULL AND QM.REQ_ST = 'REQST01')
		                OR  (ISU.REQ_NO IS NULL AND ISU.ISS_STS = 'ISSSTS01'))
		                --decode(ISU.REQ_NO, '', ISU.ISS_STS, QM.REQ_ST)      AS ISS_STS	--이슈상태
				        </when>
				        <when test="issSts == 'STS04' or issSts.equals('STS04')">
		                AND  ((ISU.REQ_NO IS NOT NULL AND QM.REQ_ST = 'REQST03')
		                OR  (ISU.REQ_NO IS NULL AND ISU.ISS_STS = 'ISSSTS03'))
				        </when>
				        <when test="issSts == 'STS02' or issSts.equals('STS02')">
		                AND  (ISU.REQ_NO IS NULL AND ISU.ISS_STS = 'ISSSTS02')
				        </when>
				        <when test="issSts == 'STS03' or issSts.equals('STS03')">
		                AND  (ISU.REQ_NO IS NOT NULL AND QM.REQ_ST = 'REQST02')
				        </when>
				    </choose>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    ISU.CREAT_ID = #{workRptId}
				        </if>
				        <if test="prjctCd != null and !prjctCd.equals('')">
				        AND    Y.CLNT_PJT = #{prjctCd}
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    CR.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    CR.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        <if test="actId != null and !actId.equals('')">
				        AND    ISU.ACT_ID = #{actId}
				        </if>
				        <if test="actId.equals('') and actIdNm !=null and !actIdNm.equals('')">
				        AND    B2.NAME LIKE  '%'||#{actIdNm}||'%'
				        </if>
				        <if test="prdtDiv !=null and !prdtDiv.equals('')">
				        AND    C.PRDT_GRP = #{prdtDiv}
				        </if>
				       ) AS A
				       		LEFT OUTER JOIN ( SELECT ME.REQ_NO, sum(ME.PCHS_AMT) AS REQ_AMT
												FROM TB_SM12D01 ME
												GROUP BY ME.REQ_NO
												) AS REQ ON REQ.REQ_NO = A.REQ_NO
				WHERE  1 = 1
				ORDER BY ISS_STS, WORK_RPT_DT DESC, WORK_RPT_ID_NM,  ACT_ID_NM, SUB_CD_NM
				) AS A
			WHERE  1 = 1
		   ) AS A
		WHERE  A.RNUM BETWEEN #{firstIndex} AND #{lastIndex}
    </select>


    <select id="selectDailyWorkPrductList" parameterType="Map" resultType="CamelMap">
				        SELECT T.FILE_TRGT_KEY
				             , T.CO_CD
				             , FN_CM05M01_CD_TO_NM(T.CO_CD) CO_NM
				             , T.WORK_RPT_NO
				             , T.WORK_RPT_ID
				             , B.NAME					 AS WORK_RPT_ID_NM
				             , TO_CHAR(T.WORK_RPT_DT,'YYYY-MM-DD') AS WORK_RPT_DT
				             , T.WORK_RPT_L
				             , T.WORK_RPT_M
				             , T.WORK_RPT_S
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_L) AS WORK_RPT_L_NM
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_M) AS WORK_RPT_M_NM
				             , FN_CM05M01_CD_TO_NM(T.WORK_RPT_S) AS WORK_RPT_S_NM
				             , T.ORDRS_NO
				             , TO_CHAR(T.WORK_RPT_HOUR, '990.00')	AS WORK_RPT_HOUR
				             , T.CLNT_CD
				             , A.CLNT_NM AS CLNT_NM
				             , T.CLNT_PJT
				             , FN_CM05M01_CD_TO_NM(T.CLNT_PJT) AS CLNT_PJT_NM
				             , T.SALES_CD
				             , T.PRDT_CD
				             , C.PRDT_NM                        AS PRDT_CD_NM
				             , T.ITEM_DIV
				             , FN_CM05M01_CD_TO_NM(T.ITEM_DIV) AS ITEM_DIV_NM
				             , T.WORK_RPT_RMK
				             , T.WORK_RPT_RMK
				             , CR.EQP_NM
				             , T.ETC_FIELD1
				             , T.ETC_FIELD2
				             , T.ETC_FIELD3
				             , T.CREAT_ID
				             , FN_CM06M01_ID_TO_NM(T.CREAT_ID) AS CREAT_NM
				             , TO_CHAR(T.CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM
				             , T.UDT_ID
				             , FN_CM06M01_ID_TO_NM(T.UDT_ID)  AS UDT_NM
				             , TO_CHAR(T.UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM
				             , T.ISSUE_YN
				             , T.ISSUE_TITLE
				             , T.ORD_CO_CD
				             , TO_CHAR(T.WORK_RPT_DT, 'YYYY')    AS YYYY --년
				             , 'Q'||TO_CHAR(T.WORK_RPT_DT, 'Q')  AS QUA  --분기
				             , TO_CHAR(T.WORK_RPT_DT, 'MON')     AS MON --월
				             , TO_CHAR(T.WORK_RPT_DT, 'YY/MM/DD/DY')     AS YMDW --월
				        FROM   TB_PM01M01 AS T
				               LEFT OUTER JOIN TB_CR02D02 AS CR  ON T.ORD_CO_CD = CR.CO_CD
				                                                AND T.SALES_CD  = CR.SALES_CD
				               LEFT OUTER JOIN TB_CR02M01 AS Y  ON T.ORD_CO_CD  = Y.CO_CD
                                                               AND T.ORDRS_NO   = Y.ORDRS_NO
				               LEFT OUTER JOIN TB_BM02M01 AS A  ON T.CLNT_CD = A.CLNT_CD
				               LEFT OUTER JOIN TB_CM06M01 AS B  ON T.WORK_RPT_ID = B.ID
				               LEFT OUTER JOIN TB_BM01M01 AS C  ON T.PRDT_CD = C.PRDT_CD
				        WHERE  1 = 1
				        <if test="coCd !=null and !coCd.equals('')">
				        AND    T.CO_CD = #{coCd}
				        </if>
				        <if test="reqDtFrom != null and !reqDtFrom.equals('') and  reqDtTo != null and !reqDtTo.equals('')">
				        AND    T.WORK_RPT_DT BETWEEN TO_DATE( #{reqDtFrom},'YYYYMMDD') AND TO_DATE( #{reqDtTo},'YYYYMMDD')
				        </if>
				        <if test="workRptId !=null and !workRptId.equals('')">
				        AND    T.WORK_RPT_ID = #{workRptId}
				        </if>
				        <if test="salesCd != null and !salesCd.equals('')">
				        AND    T.SALES_CD LIKE  '%'||#{salesCd}||'%'
				        </if>
				        <if test="prdtCd != null and !prdtCd.equals('')">
				        AND    T.PRDT_CD = #{prdtCd}
				        </if>
				        <if test="itemDiv != null and !itemDiv.equals('')">
				        AND    T.ITEM_DIV = #{itemDiv}
				        </if>
				        <if test="workRptL != null and !workRptL.equals('')">
				        AND    T.WORK_RPT_L = #{workRptL}
				        </if>
				        <if test="workRptM != null and !workRptM.equals('')">
				        AND    T.WORK_RPT_M = #{workRptM}
				        </if>
				        <if test="workRptS !=null and !workRptS.equals('')">
				        AND    T.WORK_RPT_S = #{workRptS}
				        </if>
				        <if test="workRptId.equals('') and workRptIdNm !=null and !workRptIdNm.equals('')">
				        AND    B.NAME LIKE  '%'||#{workRptIdNm}||'%'
				        </if>
				        <if test="prdtCd.equals('') and prdtNm !=null and !prdtNm.equals('')">
				        AND    C.PRDT_NM LIKE  '%'||#{prdtNm}||'%'
				        </if>
				        <if test="sortType !=null and sortType.equals('DATE')">
				        ORDER BY T.CO_CD, T.WORK_RPT_DT DESC, T.WORK_RPT_ID, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S, T.WORK_RPT_NO DESC, T.FILE_TRGT_KEY DESC
				        </if>
				        <if test="sortType !=null and sortType.equals('CODE')">
				        ORDER BY T.CO_CD, T.WORK_RPT_DT DESC, T.WORK_RPT_L, T.WORK_RPT_M, T.WORK_RPT_S, T.WORK_RPT_NO DESC, T.FILE_TRGT_KEY DESC
				        </if>
    </select>


    <select id="selectTripRptSeqNext" parameterType="Map" resultType="String">
        SELECT MAX(NVL(TO_NUMBER(FILE_TRGT_KEY),0)) + 1
		  FROM  TB_PM01D01
    </select>

    <insert id="insertTripRpt" parameterType="Map">
        <selectKey keyProperty="fileTrgtKey" resultType="String" order="BEFORE">
        SELECT MAX(NVL(TO_NUMBER(FILE_TRGT_KEY),0)) + 1
		  FROM  TB_PM01D01
        </selectKey>
        INSERT INTO TB_PM01D01
	        (
				  FILE_TRGT_KEY
				, CO_CD
				, WORK_RPT_NO
				, WORK_RPT_NO_SEQ
				, WORK_RPT_ID
				, TRIP_RPT_TYP
				, TRIP_RPT_RMK
				, TRIP_RPT_CUR_TYP
				, TRIP_RPT_CARD_NO
				, TRIP_RPT_CURR
				, TRIP_RPT_AMT
				, TRIP_RPT_FILE_NM
				, ETC_FIELD1
				, ETC_FIELD2
				, ETC_FIELD3
				, CREAT_ID
				, CREAT_PGM
				, CREAT_DTTM
				, UDT_ID
				, UDT_PGM
				, UDT_DTTM
	        )
	        VALUES
	        (
				  #{fileTrgtKey}
				, #{coCd}
				, #{workRptNo}
				, #{workRptNoSeq}
				, #{workRptId}
				, #{tripRptTyp}
				, #{tripRptRmk}
				, #{tripRptCurTyp}
				, #{tripRptCardNo}
				, #{tripRptCurr}
				, #{tripRptAmt}
				, #{tripRptFileNm}
				, #{etcField1, jdbcType=VARCHAR}
				, #{etcField2, jdbcType=VARCHAR}
				, #{etcField3, jdbcType=VARCHAR}
		        , #{userId}
		        , #{pgmId}
		        , SYSDATE
				, ''
				, ''
				, ''
	        )
    </insert>


    <update id="updateTripRpt" parameterType="Map">
        UPDATE TB_PM01D01 AS T
        SET
				  TRIP_RPT_TYP		= #{tripRptTyp}
				, TRIP_RPT_RMK      = #{tripRptRmk}
				, TRIP_RPT_CUR_TYP  = #{tripRptCurTyp}
				, TRIP_RPT_CARD_NO  = #{tripRptCardNo}
				, TRIP_RPT_CURR     = #{tripRptCurr}
				, TRIP_RPT_AMT      = #{tripRptAmt}
				, TRIP_RPT_FILE_NM  = #{tripRptFileNm}
				, UDT_ID 			= #{userId}
				, UDT_PGM 			= #{pgmId}
				, UDT_DTTM 			= SYSDATE
        WHERE
				T.CO_CD              = #{coCd}
			AND T.WORK_RPT_NO  		 = #{workRptNo}
			AND T.WORK_RPT_NO_SEQ    = #{workRptNoSeq}
    </update>

    <delete id="deleteTripRpt" parameterType="Map">
        DELETE
        		TB_PM01D01
        WHERE CO_CD 	  = #{coCd}
          AND WORK_RPT_NO = #{workRptNo}
		  AND WORK_RPT_NO_SEQ    = #{workRptNoSeq}
    </delete>



    <select id="selectDailyWorkTripRows" parameterType="Map" resultType="CamelMap">
        SELECT T.*, FILE_KEY
        FROM   TB_PM01D01 AS T
        		LEFT OUTER JOIN  TB_CM08M01 AS C  ON C.FILE_TRGT_TYP = 'PM0101M01_M'
        		 							     AND C.FILE_TRGT_KEY = WORK_RPT_NO || '-' || WORK_RPT_NO_SEQ
        WHERE  1 = 1
        <if test="coCd !=null and !coCd.equals('')">
        AND    T.CO_CD = #{coCd}
        </if>
        <if test="workRptNo !=null and !workRptNo.equals('')">
        AND    T.WORK_RPT_NO = #{workRptNo}
        </if>
        <if test="workRptId !=null and !workRptId.equals('')">
        AND    T.WORK_RPT_ID = #{workRptId}
        </if>
        ORDER BY T.WORK_RPT_NO,  T.WORK_RPT_NO_SEQ
    </select>

</mapper>