<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.bm.bm11.mapper.BM11Mapper">

	<select id="selectBmUprMstrCount" parameterType="Map"
		resultType="int">
	SELECT COUNT(*) FROM (
			SELECT ROWNUM AS RN, A.FILE_TRGT_KEY --파일대상KEY
			     , A.CO_CD --회사코드
			     , R.CODE_NM AS CO_CD_NM
			     
			     , A.MATR_CD --자재코드
			     , M.MATR_NM --자재명
			     , M.GOODS_DIV --제품/자재구분
			     , M.GOODS_DIV_NM
			     , M.MATR_CLNT_DIV --거래처구분
			     , M.MATR_CLNT_DIV_NM
			     , M.MATR_DIV --자재유형
			     , M.MATR_DIV_NM
			     , M.MATR_GRP --자재분류-자재그룹
			     , M.MATR_GRP_NM
			     , M.MATR_MAT --소재
			     --, M.MATR_SIZE --크기
			     , M.MATR_SPEC --규격
			     , M.MATR_MAKR_NM --제조사
			     , M.MATR_MNO --형번(Model No)
			     --, M.MATR_WT --중량
			     , M.MATR_UNIT --단위
			     , M.MATR_UNIT_NM
			     --, M.ORIGIN_NM --원산지
			     --, M.MATR_DRW_NO --대표도면
			     --, M.MATR_TEST_DIV --입고검사구분
			     --, M.MATR_TEST_DIV_NM
			     , M.DLVR_RQM_DAY --리드타임(납품소요일자)
			     , M.MATR_PURC_DIV --구매/외주구분
			     , M.MATR_PURC_DIV_NM
			     
			     , A.CLNT_CD --거래처
			     , C.CLNT_NM AS CLNT_NM
			     
			     , A.CURR_CD --통화단위
			     , R1.CODE_NM AS CURR_NM
			     
			     , A.ADPT_DT --적용일자
			     , A.UPR_DIV --단가구분
			     , R2.CODE_NM AS UPR_DIV_NM
			     
			     , A.MATR_UPR --구매단가
			     , A.DEDUCT_UPR --공제단가
			     , A.MATR_UPR_RMK --비고
			     , A.USE_YN --사용여부
			     , A.CREAT_ID --생성자
			     , A.CREAT_PGM --생성프로그램ID
			     , A.CREAT_DTTM --생성일시
			     , A.UDT_ID --최종변경자
			     , A.UDT_PGM --최종수정프로그램ID
			     , A.UDT_DTTM --최종변경일시
			FROM   TB_BM11M01 AS A
			       JOIN (
			              SELECT CO_CD
							   , MATR_CD
							   , CLNT_CD
							   , CURR_CD
							   , MAX(ADPT_DT) AS ADPT_DT
						  FROM   TB_BM11M01
						  GROUP BY CO_CD, MATR_CD, CLNT_CD, CURR_CD
			            ) AS B  ON B.CO_CD   = A.CO_CD
			                   AND B.MATR_CD = A.MATR_CD
			                   AND B.CLNT_CD = A.CLNT_CD
			                   AND B.CURR_CD = A.CURR_CD
			                   AND B.ADPT_DT = A.ADPT_DT
			       LEFT JOIN TB_BM02M01 AS C  ON C.CLNT_CD = A.CLNT_CD
			       LEFT JOIN (
			                   SELECT M.FILE_TRGT_KEY --파일대상KEY
								    , M.CO_CD --회사코드
								    , R.CODE_NM AS CO_CD_NM
								    , M.MATR_CD --자재코드
								    , M.MATR_NM --자재명
								    , M.GOODS_DIV --제품/자재구분
								    , R1.CODE_NM AS GOODS_DIV_NM
								    , M.MATR_CLNT_DIV --거래처구분
								    , R2.CODE_NM AS MATR_CLNT_DIV_NM
								    , M.MATR_DIV --자재유형
								    , R3.CODE_NM AS MATR_DIV_NM
								    , M.MATR_GRP --자재분류-자재그룹
								    , R4.CODE_NM AS MATR_GRP_NM
								    , M.MATR_MAT --소재
								    , M.MATR_SIZE --크기
								    , M.MATR_SPEC --규격
								    , M.MATR_MAKR_NM --제조사
								    , M.MATR_MNO --형번(Model No)
								    , M.MATR_WT --중량
								    , M.MATR_UNIT --단위
								    , R5.CODE_NM AS MATR_UNIT_NM
								    , M.ORIGIN_NM --원산지
								    , M.MATR_DRW_NO --대표도면
								    , M.MATR_TEST_DIV --입고검사구분
								    , R6.CODE_NM AS MATR_TEST_DIV_NM
								    , M.DLVR_RQM_DAY --리드타임(납품소요일자)
								    , M.MATR_PURC_DIV --구매/외주구분
								    , R7.CODE_NM AS MATR_PURC_DIV_NM
								    , M.MIN_ORDRG_QTY --최소발주량
								    , M.MATR_SAFT_QTY --안전재고
								    , M.MATR_STOCK_CD --재고관리여부
								    , M.DSGN_2D_MD --2D설계소요일
								    , M.AVRG_2D_MD --2D평균소요일
								    , M.DSGN_3D_MD --3D설계소요일
								    , M.AVRG_3D_MD --3D평균소요일
								    , M.PRDCTN_RQM_MD --생산소요일
								    , M.PRDCTN_AVRG_MD --생산평균소요일
								    , M.USE_YN --사용여부
								    , M.MATR_PART_NO --파트번호
								    , M.PCHS_CLNT_CD1 --구매업체1
								    , M.PCHS_CLNT_PCT1 --구매업체1%
								    , M.PCHS_CLNT_CD2 --구매업체2
								    , M.PCHS_CLNT_PCT2 --구매업체2%
								    , M.PCHS_CLNT_CD3 --구매업체3
								    , M.PCHS_CLNT_PCT3 --구매업체3%
								    , M.MATR_UPR --최종구매단가
								    , M.MATR_AVRG_UPR --평균구매단가
								    , M.MATR_RMK --비고
								    , M.MATR_LAST_TRST_DT --최종거래일자
								    , M.MATR_ATNT_CD --대체자재코드
								    , M.MATR_NO --자재번호
								    , M.DSGN_TRGT_YN --설계대상구분
								    , M.CREAT_ID --생성자
								    , M.CREAT_PGM --생성프로그램ID
								    , M.CREAT_DTTM --생성일시
								    , M.UDT_ID --최종변경자
								    , M.UDT_PGM --최종수정프로그램ID
								    , M.UDT_DTTM --최종변경일시
							   FROM   TB_BM05M01 AS M
								      LEFT JOIN TB_CM05M01 AS R  ON R.CODE_ID  = M.CO_CD
								      LEFT JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = M.GOODS_DIV
								      LEFT JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = M.MATR_CLNT_DIV
								      LEFT JOIN TB_CM05M01 AS R3 ON R3.CODE_ID = M.MATR_DIV
								      LEFT JOIN TB_CM05M01 AS R4 ON R4.CODE_ID = M.MATR_GRP
								      LEFT JOIN TB_CM05M01 AS R5 ON R5.CODE_ID = M.MATR_UNIT
								      LEFT JOIN TB_CM05M01 AS R6 ON R6.CODE_ID = M.MATR_TEST_DIV
								      LEFT JOIN TB_CM05M01 AS R7 ON R7.CODE_ID = M.MATR_PURC_DIV
			                 ) AS M  ON M.CO_CD   = A.CO_CD
			                        AND M.MATR_CD = A.MATR_CD
			       LEFT JOIN TB_CM05M01 AS R  ON R.CODE_ID  = A.CO_CD
			       LEFT JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = A.CURR_CD
			       LEFT JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = A.UPR_DIV ) Z
			  WHERE  Z.CO_CD LIKE #{coCd} 
			 <if test="goodsDiv != null and !goodsDiv.equals('')">
		      AND Z.GOODS_DIV LIKE '%${goodsDiv}%'
		     </if>
		     <if test="matrDiv != null and !matrDiv.equals('')">
		      AND Z.MATR_DIV LIKE '${matrDiv}'
		     </if>
		     <if test="matrGrp != null and !matrGrp.equals('')">
		      AND Z.MATR_GRP LIKE '${matrGrp}'
		     </if>
		     <if test="matrCd != null and !matrCd.equals('')">
		      AND Z.MATR_CD LIKE '%'||'${matrCd}'||'%' 
		     </if>
		     <if test="matrNm != null and !matrNm.equals('')">
		      AND Z.MATR_NM LIKE '%'||'${matrNm}'||'%'
		     </if>
		     <if test="matrMno != null and !matrMno.equals('')">
		      AND Z.MATR_MNO LIKE '%'||'${matrMno}'||'%'
		     </if>
		     <if test="matrSpec != null and !matrSpec.equals('')">
		      AND Z.MATR_SPEC LIKE '%'||'${matrSpec}'||'%'
		     </if>
		     <if test="clntCd != null and !clntCd.equals('')">
		      AND Z.CLNT_CD LIKE '${clntCd}'
		     </if>
		     <if test="clntNm != null and clntNm.equals('')">
		      AND Z.CLNT_NM LIKE '${clntNm}'
		     </if>
		     <if test="currCd != null and !currCd.equals('')">
		      AND Z.CURR_CD LIKE '${currCd}'
		     </if>
		     <if test="useYn != null and !useYn.equals('')">
		      AND Z.USE_YN LIKE '${useYn}'
		     </if>	
		     ;		     
	</select>

	<select id="selectBmUprMstrList" parameterType="Map" resultType="camelMap">
         SELECT * FROM (
			SELECT ROWNUM AS RN, A.FILE_TRGT_KEY --파일대상KEY
			     , A.CO_CD --회사코드
			     , R.CODE_NM AS CO_CD_NM
			     
			     , A.MATR_CD --자재코드
			     , M.MATR_NM --자재명
			     , M.GOODS_DIV --제품/자재구분
			     , M.GOODS_DIV_NM
			     , M.MATR_CLNT_DIV --거래처구분
			     , M.MATR_CLNT_DIV_NM
			     , M.MATR_DIV --자재유형
			     , M.MATR_DIV_NM
			     , M.MATR_GRP --자재분류-자재그룹
			     , M.MATR_GRP_NM
			     , M.MATR_MAT --소재
			     --, M.MATR_SIZE --크기
			     , M.MATR_SPEC --규격
			     , M.MATR_MAKR_NM --제조사
			     , M.MATR_MNO --형번(Model No)
			     --, M.MATR_WT --중량
			     , M.MATR_UNIT --단위
			     , M.MATR_UNIT_NM
			     --, M.ORIGIN_NM --원산지
			     --, M.MATR_DRW_NO --대표도면
			     --, M.MATR_TEST_DIV --입고검사구분
			     --, M.MATR_TEST_DIV_NM
			     , M.DLVR_RQM_DAY --리드타임(납품소요일자)
			     , M.MATR_PURC_DIV --구매/외주구분
			     , M.MATR_PURC_DIV_NM
			     
			     , A.CLNT_CD --거래처
			     , C.CLNT_NM AS CLNT_NM
			     
			     , A.CURR_CD --통화단위
			     , R1.CODE_NM AS CURR_NM
			     
			     , A.ADPT_DT --적용일자
			     , A.UPR_DIV --단가구분
			     , R2.CODE_NM AS UPR_DIV_NM
			     
			     , A.MATR_UPR --구매단가
			     , A.DEDUCT_UPR --공제단가
			     , A.MATR_UPR_RMK --비고
			     , A.USE_YN --사용여부
			     , A.CREAT_ID --생성자
			     , A.CREAT_PGM --생성프로그램ID
			     , A.CREAT_DTTM --생성일시
			     , A.UDT_ID --최종변경자
			     , A.UDT_PGM --최종수정프로그램ID
			     , A.UDT_DTTM --최종변경일시
			FROM   TB_BM11M01 AS A
			       JOIN (
			              SELECT CO_CD
							   , MATR_CD
							   , CLNT_CD
							   , CURR_CD
							   , MAX(ADPT_DT) AS ADPT_DT
						  FROM   TB_BM11M01
						  GROUP BY CO_CD, MATR_CD, CLNT_CD, CURR_CD
			            ) AS B  ON B.CO_CD   = A.CO_CD
			                   AND B.MATR_CD = A.MATR_CD
			                   AND B.CLNT_CD = A.CLNT_CD
			                   AND B.CURR_CD = A.CURR_CD
			                   AND B.ADPT_DT = A.ADPT_DT
			       LEFT JOIN TB_BM02M01 AS C  ON C.CLNT_CD = A.CLNT_CD
			       LEFT JOIN (
			                   SELECT M.FILE_TRGT_KEY --파일대상KEY
								    , M.CO_CD --회사코드
								    , R.CODE_NM AS CO_CD_NM
								    , M.MATR_CD --자재코드
								    , M.MATR_NM --자재명
								    , M.GOODS_DIV --제품/자재구분
								    , R1.CODE_NM AS GOODS_DIV_NM
								    , M.MATR_CLNT_DIV --거래처구분
								    , R2.CODE_NM AS MATR_CLNT_DIV_NM
								    , M.MATR_DIV --자재유형
								    , R3.CODE_NM AS MATR_DIV_NM
								    , M.MATR_GRP --자재분류-자재그룹
								    , R4.CODE_NM AS MATR_GRP_NM
								    , M.MATR_MAT --소재
								    , M.MATR_SIZE --크기
								    , M.MATR_SPEC --규격
								    , M.MATR_MAKR_NM --제조사
								    , M.MATR_MNO --형번(Model No)
								    , M.MATR_WT --중량
								    , M.MATR_UNIT --단위
								    , R5.CODE_NM AS MATR_UNIT_NM
								    , M.ORIGIN_NM --원산지
								    , M.MATR_DRW_NO --대표도면
								    , M.MATR_TEST_DIV --입고검사구분
								    , R6.CODE_NM AS MATR_TEST_DIV_NM
								    , M.DLVR_RQM_DAY --리드타임(납품소요일자)
								    , M.MATR_PURC_DIV --구매/외주구분
								    , R7.CODE_NM AS MATR_PURC_DIV_NM
								    , M.MIN_ORDRG_QTY --최소발주량
								    , M.MATR_SAFT_QTY --안전재고
								    , M.MATR_STOCK_CD --재고관리여부
								    , M.DSGN_2D_MD --2D설계소요일
								    , M.AVRG_2D_MD --2D평균소요일
								    , M.DSGN_3D_MD --3D설계소요일
								    , M.AVRG_3D_MD --3D평균소요일
								    , M.PRDCTN_RQM_MD --생산소요일
								    , M.PRDCTN_AVRG_MD --생산평균소요일
								    , M.USE_YN --사용여부
								    , M.MATR_PART_NO --파트번호
								    , M.PCHS_CLNT_CD1 --구매업체1
								    , M.PCHS_CLNT_PCT1 --구매업체1%
								    , M.PCHS_CLNT_CD2 --구매업체2
								    , M.PCHS_CLNT_PCT2 --구매업체2%
								    , M.PCHS_CLNT_CD3 --구매업체3
								    , M.PCHS_CLNT_PCT3 --구매업체3%
								    , M.MATR_UPR --최종구매단가
								    , M.MATR_AVRG_UPR --평균구매단가
								    , M.MATR_RMK --비고
								    , M.MATR_LAST_TRST_DT --최종거래일자
								    , M.MATR_ATNT_CD --대체자재코드
								    , M.MATR_NO --자재번호
								    , M.DSGN_TRGT_YN --설계대상구분
								    , M.CREAT_ID --생성자
								    , M.CREAT_PGM --생성프로그램ID
								    , M.CREAT_DTTM --생성일시
								    , M.UDT_ID --최종변경자
								    , M.UDT_PGM --최종수정프로그램ID
								    , M.UDT_DTTM --최종변경일시
							   FROM   TB_BM05M01 AS M
								      LEFT JOIN TB_CM05M01 AS R  ON R.CODE_ID  = M.CO_CD
								      LEFT JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = M.GOODS_DIV
								      LEFT JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = M.MATR_CLNT_DIV
								      LEFT JOIN TB_CM05M01 AS R3 ON R3.CODE_ID = M.MATR_DIV
								      LEFT JOIN TB_CM05M01 AS R4 ON R4.CODE_ID = M.MATR_GRP
								      LEFT JOIN TB_CM05M01 AS R5 ON R5.CODE_ID = M.MATR_UNIT
								      LEFT JOIN TB_CM05M01 AS R6 ON R6.CODE_ID = M.MATR_TEST_DIV
								      LEFT JOIN TB_CM05M01 AS R7 ON R7.CODE_ID = M.MATR_PURC_DIV
			                 ) AS M  ON M.CO_CD   = A.CO_CD
			                        AND M.MATR_CD = A.MATR_CD
			       LEFT JOIN TB_CM05M01 AS R  ON R.CODE_ID  = A.CO_CD
			       LEFT JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = A.CURR_CD
			       LEFT JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = A.UPR_DIV ) Z
			WHERE  Z.CO_CD LIKE #{coCd} --회사
		     <if test="goodsDiv != null and !goodsDiv.equals('')">
		      AND Z.GOODS_DIV LIKE '%${goodsDiv}%'--품목구분
		     </if>
		     <if test="matrDiv != null and !matrDiv.equals('')">
		      AND Z.MATR_DIV LIKE '${matrDiv}'--자재유형
		     </if>
		     <if test="matrGrp != null and !matrGrp.equals('')">
		      AND Z.MATR_GRP LIKE '${matrGrp}'--자재그룹
		     </if>
		     <if test="matrCd != null and !matrCd.equals('')">
		      AND Z.MATR_CD LIKE '%'||'${matrCd}'||'%' --자재코드
		     </if>
		     <if test="matrNm != null and !matrNm.equals('')">
		      AND Z.MATR_NM LIKE '%'||'${matrNm}'||'%'--품명
		     </if>
		     <if test="matrMno != null and !matrMno.equals('')">
		      AND Z.MATR_MNO LIKE '%'||'${matrMno}'||'%'--형번(Model No)
		     </if>
		     <if test="matrSpec != null and !matrSpec.equals('')">
		      AND Z.MATR_SPEC LIKE '%'||'${matrSpec}'||'%'--규격
		     </if>
		     <if test="clntCd != null and !clntCd.equals('')">
		      AND Z.CLNT_CD LIKE '${clntCd}'--거래처
		     </if>
		     <if test="clntNm != null and clntNm.equals('')">
		      AND Z.CLNT_NM LIKE '${clntNm}'--거래처 이름
		     </if>
		     <if test="currCd != null and !currCd.equals('')">
		      AND Z.CURR_CD LIKE '${currCd}'--통화단위
		     </if>
		     <if test="useYn != null and !useYn.equals('')">
		      AND Z.USE_YN LIKE '${useYn}'--사용여부
		     </if>		     
				
             AND  RN BETWEEN ${firstIndex} AND ${lastIndex};
		<!-- <if test="coCd != null and !coCd.equals('')"> AND X.CO_CD = ${coCd}' 
			</if> <if test="goodsDiv != null and !goodsDiv.equals('')"> AND X.GOODS_DIV 
			= ${goodsDiv}' </if> -->
	</select>

	

	<select id="selectUprHsMstrList" parameterType="Map" resultType="camelMap">		
				
		SELECT A.FILE_TRGT_KEY --파일대상KEY
		     , A.CO_CD --회사코드
		     , R.CODE_NM AS CO_CD_NM
		     
		     , A.MATR_CD --자재코드
		     , M.MATR_NM --자재명
		     , M.GOODS_DIV --제품/자재구분
		     , M.GOODS_DIV_NM
		     , M.MATR_CLNT_DIV --거래처구분
		     , M.MATR_CLNT_DIV_NM
		     , M.MATR_DIV --자재유형
		     , M.MATR_DIV_NM
		     , M.MATR_GRP --자재분류-자재그룹
		     , M.MATR_GRP_NM
		     , M.MATR_MAT --소재
		     --, M.MATR_SIZE --크기
		     , M.MATR_SPEC --규격
		     , M.MATR_MAKR_NM --제조사
		     , M.MATR_MNO --형번(Model No)
		     --, M.MATR_WT --중량
		     , M.MATR_UNIT --단위
		     , M.MATR_UNIT_NM
		     --, M.ORIGIN_NM --원산지
		     --, M.MATR_DRW_NO --대표도면
		     --, M.MATR_TEST_DIV --입고검사구분
		     --, M.MATR_TEST_DIV_NM
		     , M.DLVR_RQM_DAY --리드타임(납품소요일자)
		     , M.MATR_PURC_DIV --구매/외주구분
		     , M.MATR_PURC_DIV_NM
		     
		     , A.CLNT_CD --거래처
		     , C.CLNT_NM AS CLNT_NM
		     
		     , A.CURR_CD --통화단위
		     , R1.CODE_NM AS CURR_NM
		     
		     , A.ADPT_DT --적용일자
		     , A.UPR_DIV --단가구분
		     , R2.CODE_NM AS UPR_DIV_NM
		     
		     , A.MATR_UPR --구매단가
		     , A.DEDUCT_UPR --공제단가
		     , A.MATR_UPR_RMK --비고
		     , A.USE_YN --사용여부
		     , A.CREAT_ID --생성자
		     , A.CREAT_PGM --생성프로그램ID
		     , A.CREAT_DTTM --생성일시
		     , A.UDT_ID --최종변경자
		     , A.UDT_PGM --최종수정프로그램ID
		     , A.UDT_DTTM --최종변경일시
		FROM   TB_BM11M01 AS A
		       LEFT JOIN TB_BM02M01 AS C  ON C.CLNT_CD = A.CLNT_CD
		       LEFT JOIN (
		                   SELECT M.FILE_TRGT_KEY --파일대상KEY
		    , M.CO_CD --회사코드
		    , R.CODE_NM AS CO_CD_NM
		    , M.MATR_CD --자재코드
		    , M.MATR_NM --자재명
		    , M.GOODS_DIV --제품/자재구분
		    , R1.CODE_NM AS GOODS_DIV_NM
		    , M.MATR_CLNT_DIV --거래처구분
		    , R2.CODE_NM AS MATR_CLNT_DIV_NM
		    , M.MATR_DIV --자재유형
		    , R3.CODE_NM AS MATR_DIV_NM
		    , M.MATR_GRP --자재분류-자재그룹
		    , R4.CODE_NM AS MATR_GRP_NM
		    , M.MATR_MAT --소재
		    , M.MATR_SIZE --크기
		    , M.MATR_SPEC --규격
		    , M.MATR_MAKR_NM --제조사
		    , M.MATR_MNO --형번(Model No)
		    , M.MATR_WT --중량
		    , M.MATR_UNIT --단위
		    , R5.CODE_NM AS MATR_UNIT_NM
		    , M.ORIGIN_NM --원산지
		    , M.MATR_DRW_NO --대표도면
		    , M.MATR_TEST_DIV --입고검사구분
		    , R6.CODE_NM AS MATR_TEST_DIV_NM
		    , M.DLVR_RQM_DAY --리드타임(납품소요일자)
		    , M.MATR_PURC_DIV --구매/외주구분
		    , R7.CODE_NM AS MATR_PURC_DIV_NM
		    , M.MIN_ORDRG_QTY --최소발주량
		    , M.MATR_SAFT_QTY --안전재고
		    , M.MATR_STOCK_CD --재고관리여부
		    , M.DSGN_2D_MD --2D설계소요일
		    , M.AVRG_2D_MD --2D평균소요일
		    , M.DSGN_3D_MD --3D설계소요일
		    , M.AVRG_3D_MD --3D평균소요일
		    , M.PRDCTN_RQM_MD --생산소요일
		    , M.PRDCTN_AVRG_MD --생산평균소요일
		    , M.USE_YN --사용여부
		    , M.MATR_PART_NO --파트번호
		    , M.PCHS_CLNT_CD1 --구매업체1
		    , M.PCHS_CLNT_PCT1 --구매업체1%
		    , M.PCHS_CLNT_CD2 --구매업체2
		    , M.PCHS_CLNT_PCT2 --구매업체2%
		    , M.PCHS_CLNT_CD3 --구매업체3
		    , M.PCHS_CLNT_PCT3 --구매업체3%
		    , M.MATR_UPR --최종구매단가
		    , M.MATR_AVRG_UPR --평균구매단가
		    , M.MATR_RMK --비고
		    , M.MATR_LAST_TRST_DT --최종거래일자
		    , M.MATR_ATNT_CD --대체자재코드
		    , M.MATR_NO --자재번호
		    , M.DSGN_TRGT_YN --설계대상구분
		    , M.CREAT_ID --생성자
		    , M.CREAT_PGM --생성프로그램ID
		    , M.CREAT_DTTM --생성일시
		    , M.UDT_ID --최종변경자
		    , M.UDT_PGM --최종수정프로그램ID
		    , M.UDT_DTTM --최종변경일시
		   FROM   TB_BM05M01 AS M
		      LEFT JOIN TB_CM05M01 AS R  ON R.CODE_ID  = M.CO_CD
		      LEFT JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = M.GOODS_DIV
		      LEFT JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = M.MATR_CLNT_DIV
		      LEFT JOIN TB_CM05M01 AS R3 ON R3.CODE_ID = M.MATR_DIV
		      LEFT JOIN TB_CM05M01 AS R4 ON R4.CODE_ID = M.MATR_GRP
		      LEFT JOIN TB_CM05M01 AS R5 ON R5.CODE_ID = M.MATR_UNIT
		      LEFT JOIN TB_CM05M01 AS R6 ON R6.CODE_ID = M.MATR_TEST_DIV
		      LEFT JOIN TB_CM05M01 AS R7 ON R7.CODE_ID = M.MATR_PURC_DIV
		                 ) AS M  ON M.CO_CD   = A.CO_CD
		                        AND M.MATR_CD = A.MATR_CD
		       LEFT JOIN TB_CM05M01 AS R  ON R.CODE_ID  = A.CO_CD
		       LEFT JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = A.CURR_CD
		       LEFT JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = A.UPR_DIV
			WHERE  A.CO_CD     = #{coCd} -- 'GUN' --회사
			AND    A.MATR_CD   = #{matrCd} --'200-00001' --자재코드
			AND    A.CLNT_CD   = #{clntCd} -- '599' --거래처
			AND    A.CURR_CD   = #{currCd}  -- 'CURR01' --통화단위
			;
		<!-- <if test="coCd != null and !coCd.equals('')"> AND X.CO_CD = ${coCd}' 
			</if> <if test="goodsDiv != null and !goodsDiv.equals('')"> AND X.GOODS_DIV 
			= ${goodsDiv}' </if> -->
	</select>

	<insert id="insertBmUprMstr" parameterType="Map">
		<selectKey keyProperty="fileTrgtKey" resultType="int" order="BEFORE">
			SELECT NVL(MAX(TO_NUMBER(FILE_TRGT_KEY)),0) + 1 FROM TB_BM11M01
       </selectKey>

	  INSERT INTO TB_BM11M01
		(		
		FILE_TRGT_KEY, 
		CO_CD, 
		MATR_CD,
		CLNT_CD,
		CURR_CD,
		ADPT_DT,
		UPR_DIV,
		MATR_UPR,
		DEDUCT_UPR,
		MATR_UPR_RMK,
		USE_YN,		
		ETC_FIELD1,
		ETC_FIELD2,
		ETC_FIELD3,
		CREAT_ID,
		CREAT_PGM,
		CREAT_DTTM,
		UDT_ID,
		UDT_PGM,
		UDT_DTTM
		)
		VALUES
		(	
		#{fileTrgtKey},
		#{coCd},
		#{matrCd},
		#{clntCd},
		#{currCd},
		#{adptDt},
		#{uprDiv, jdbcType=VARCHAR},
		#{matrUpr, jdbcType=VARCHAR},
		#{deductUpr, jdbcType=NUMERIC},
		#{matrUprRmk, jdbcType=VARCHAR},
		#{useYn, jdbcType=VARCHAR},
		#{etcField1, jdbcType=CHAR},
		#{etcField2, jdbcType=NUMERIC},
		#{etcField3, jdbcType=VARCHAR},
		#{creatId},
		#{creatPgm},
		SYSDATE,
		#{udtId, jdbcType=VARCHAR},
		#{udtPgm, jdbcType=VARCHAR},
		#{udtDttm, jdbcType=VARCHAR}
		)
	</insert>
	
	
    <update id="UpdateBmUprMstr" parameterType="Map">
         UPDATE TB_BM11M01
            	SET 
					CURR_CD = #{currCd, jdbcType=VARCHAR} , 
					UPR_DIV = #{uprDiv, jdbcType=VARCHAR} , 
					MATR_UPR = #{matrUpr, jdbcType=NUMERIC},	
					DEDUCT_UPR = #{deductUpr, jdbcType=NUMERIC},	
					USE_YN = 'Y',		
					MATR_UPR_RMK = #{matrUprRmk, jdbcType=VARCHAR},	
					UDT_ID = #{udtId, jdbcType=VARCHAR},
					UDT_PGM = #{udtPgm, jdbcType=VARCHAR},
		                    	UDT_DTTM = SYSDATE
               
              WHERE                 
                 	FILE_TRGT_KEY = #{fileTrgtKey}
    </update>  
		
		
		
     <select id="selectMsExcelList" parameterType="Map" resultType="camelMap">   
               SELECT * FROM (
			SELECT ROWNUM AS RN, A.FILE_TRGT_KEY --파일대상KEY
			     , A.CO_CD --회사코드
			     , R.CODE_NM AS CO_CD_NM
			     
			     , A.MATR_CD --자재코드
			     , M.MATR_NM --자재명
			     , M.GOODS_DIV --제품/자재구분
			     , M.GOODS_DIV_NM
			     , M.MATR_CLNT_DIV --거래처구분
			     , M.MATR_CLNT_DIV_NM
			     , M.MATR_DIV --자재유형
			     , M.MATR_DIV_NM
			     , M.MATR_GRP --자재분류-자재그룹
			     , M.MATR_GRP_NM
			     , M.MATR_MAT --소재
			     --, M.MATR_SIZE --크기
			     , M.MATR_SPEC --규격
			     , M.MATR_MAKR_NM --제조사
			     , M.MATR_MNO --형번(Model No)
			     --, M.MATR_WT --중량
			     , M.MATR_UNIT --단위
			     , M.MATR_UNIT_NM
			     --, M.ORIGIN_NM --원산지
			     --, M.MATR_DRW_NO --대표도면
			     --, M.MATR_TEST_DIV --입고검사구분
			     --, M.MATR_TEST_DIV_NM
			     , M.DLVR_RQM_DAY --리드타임(납품소요일자)
			     , M.MATR_PURC_DIV --구매/외주구분
			     , M.MATR_PURC_DIV_NM
			     
			     , A.CLNT_CD --거래처
			     , C.CLNT_NM AS CLNT_NM
			     
			     , A.CURR_CD --통화단위
			     , R1.CODE_NM AS CURR_NM
			     
			     , A.ADPT_DT --적용일자
			     , A.UPR_DIV --단가구분
			     , R2.CODE_NM AS UPR_DIV_NM
			     
			     , A.MATR_UPR --구매단가
			     , A.DEDUCT_UPR --공제단가
			     , A.MATR_UPR_RMK --비고
			     , A.USE_YN --사용여부
			     , A.CREAT_ID --생성자
			     , A.CREAT_PGM --생성프로그램ID
			     , A.CREAT_DTTM --생성일시
			     , A.UDT_ID --최종변경자
			     , A.UDT_PGM --최종수정프로그램ID
			     , A.UDT_DTTM --최종변경일시
			FROM   TB_BM11M01 AS A
			       JOIN (
			              SELECT CO_CD
							   , MATR_CD
							   , CLNT_CD
							   , CURR_CD
							   , MAX(ADPT_DT) AS ADPT_DT
						  FROM   TB_BM11M01
						  GROUP BY CO_CD, MATR_CD, CLNT_CD, CURR_CD
			            ) AS B  ON B.CO_CD   = A.CO_CD
			                   AND B.MATR_CD = A.MATR_CD
			                   AND B.CLNT_CD = A.CLNT_CD
			                   AND B.CURR_CD = A.CURR_CD
			                   AND B.ADPT_DT = A.ADPT_DT
			       LEFT JOIN TB_BM02M01 AS C  ON C.CLNT_CD = A.CLNT_CD
			       LEFT JOIN (
			                   SELECT M.FILE_TRGT_KEY --파일대상KEY
								    , M.CO_CD --회사코드
								    , R.CODE_NM AS CO_CD_NM
								    , M.MATR_CD --자재코드
								    , M.MATR_NM --자재명
								    , M.GOODS_DIV --제품/자재구분
								    , R1.CODE_NM AS GOODS_DIV_NM
								    , M.MATR_CLNT_DIV --거래처구분
								    , R2.CODE_NM AS MATR_CLNT_DIV_NM
								    , M.MATR_DIV --자재유형
								    , R3.CODE_NM AS MATR_DIV_NM
								    , M.MATR_GRP --자재분류-자재그룹
								    , R4.CODE_NM AS MATR_GRP_NM
								    , M.MATR_MAT --소재
								    , M.MATR_SIZE --크기
								    , M.MATR_SPEC --규격
								    , M.MATR_MAKR_NM --제조사
								    , M.MATR_MNO --형번(Model No)
								    , M.MATR_WT --중량
								    , M.MATR_UNIT --단위
								    , R5.CODE_NM AS MATR_UNIT_NM
								    , M.ORIGIN_NM --원산지
								    , M.MATR_DRW_NO --대표도면
								    , M.MATR_TEST_DIV --입고검사구분
								    , R6.CODE_NM AS MATR_TEST_DIV_NM
								    , M.DLVR_RQM_DAY --리드타임(납품소요일자)
								    , M.MATR_PURC_DIV --구매/외주구분
								    , R7.CODE_NM AS MATR_PURC_DIV_NM
								    , M.MIN_ORDRG_QTY --최소발주량
								    , M.MATR_SAFT_QTY --안전재고
								    , M.MATR_STOCK_CD --재고관리여부
								    , M.DSGN_2D_MD --2D설계소요일
								    , M.AVRG_2D_MD --2D평균소요일
								    , M.DSGN_3D_MD --3D설계소요일
								    , M.AVRG_3D_MD --3D평균소요일
								    , M.PRDCTN_RQM_MD --생산소요일
								    , M.PRDCTN_AVRG_MD --생산평균소요일
								    , M.USE_YN --사용여부
								    , M.MATR_PART_NO --파트번호
								    , M.PCHS_CLNT_CD1 --구매업체1
								    , M.PCHS_CLNT_PCT1 --구매업체1%
								    , M.PCHS_CLNT_CD2 --구매업체2
								    , M.PCHS_CLNT_PCT2 --구매업체2%
								    , M.PCHS_CLNT_CD3 --구매업체3
								    , M.PCHS_CLNT_PCT3 --구매업체3%
								    , M.MATR_UPR --최종구매단가
								    , M.MATR_AVRG_UPR --평균구매단가
								    , M.MATR_RMK --비고
								    , M.MATR_LAST_TRST_DT --최종거래일자
								    , M.MATR_ATNT_CD --대체자재코드
								    , M.MATR_NO --자재번호
								    , M.DSGN_TRGT_YN --설계대상구분
								    , M.CREAT_ID --생성자
								    , M.CREAT_PGM --생성프로그램ID
								    , M.CREAT_DTTM --생성일시
								    , M.UDT_ID --최종변경자
								    , M.UDT_PGM --최종수정프로그램ID
								    , M.UDT_DTTM --최종변경일시
							   FROM   TB_BM05M01 AS M
								      LEFT JOIN TB_CM05M01 AS R  ON R.CODE_ID  = M.CO_CD
								      LEFT JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = M.GOODS_DIV
								      LEFT JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = M.MATR_CLNT_DIV
								      LEFT JOIN TB_CM05M01 AS R3 ON R3.CODE_ID = M.MATR_DIV
								      LEFT JOIN TB_CM05M01 AS R4 ON R4.CODE_ID = M.MATR_GRP
								      LEFT JOIN TB_CM05M01 AS R5 ON R5.CODE_ID = M.MATR_UNIT
								      LEFT JOIN TB_CM05M01 AS R6 ON R6.CODE_ID = M.MATR_TEST_DIV
								      LEFT JOIN TB_CM05M01 AS R7 ON R7.CODE_ID = M.MATR_PURC_DIV
			                 ) AS M  ON M.CO_CD   = A.CO_CD
			                        AND M.MATR_CD = A.MATR_CD
			       LEFT JOIN TB_CM05M01 AS R  ON R.CODE_ID  = A.CO_CD
			       LEFT JOIN TB_CM05M01 AS R1 ON R1.CODE_ID = A.CURR_CD
			       LEFT JOIN TB_CM05M01 AS R2 ON R2.CODE_ID = A.UPR_DIV ) Z
			WHERE  Z.CO_CD LIKE #{coCd} --회사
		     <if test="goodsDiv != null and !goodsDiv.equals('')">
		      AND Z.GOODS_DIV LIKE '%${goodsDiv}%'--품목구분
		     </if>
		     <if test="matrDiv != null and !matrDiv.equals('')">
		      AND Z.MATR_DIV LIKE '${matrDiv}'--자재유형
		     </if>
		     <if test="matrGrp != null and !matrGrp.equals('')">
		      AND Z.MATR_GRP LIKE '${matrGrp}'--자재그룹
		     </if>
		     <if test="matrCd != null and !matrCd.equals('')">
		      AND Z.MATR_CD LIKE '%'||'${matrCd}'||'%' --자재코드
		     </if>
		     <if test="matrNm != null and !matrNm.equals('')">
		      AND Z.MATR_NM LIKE '%'||'${matrNm}'||'%'--품명
		     </if>
		     <if test="matrMno != null and !matrMno.equals('')">
		      AND Z.MATR_MNO LIKE '%'||'${matrMno}'||'%'--형번(Model No)
		     </if>
		     <if test="matrSpec != null and !matrSpec.equals('')">
		      AND Z.MATR_SPEC LIKE '%'||'${matrSpec}'||'%'--규격
		     </if>
		     <if test="clntCd != null and !clntCd.equals('')">
		      AND Z.CLNT_CD LIKE '${clntCd}'--거래처
		     </if>
		     <if test="currCd != null and !currCd.equals('')">
		      AND Z.CURR_CD LIKE '${currCd}'--통화단위
		     </if>
		     <if test="useYn != null and !useYn.equals('')">
		      AND Z.USE_YN LIKE '${useYn}'--사용여부
		     </if>		
     </select>
	
		
		
		
		
</mapper>