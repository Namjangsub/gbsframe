<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.bm.bm05.mapper.BM05Mapper">

	<select id="selectBmMstrCount" parameterType="Map" resultType="int">
		SELECT 
			COUNT(*)
		FROM TB_BM05M01 BM05
	</select>

	<select id="selectBmMstrList" parameterType="Map" resultType="camelMap">
		SELECT * FROM (
			SELECT
				ROWNUM AS RN,	-- No.
				-- 자재마스터 TB_BM05M01 AS X 
				-- 공통에서 가져와야하는 컬럼 검색 시 사용 TB_CM05M01
				X.FILE_TRGT_KEY,	-- 파일대상KEY
				X.CO_CD AS CO, 		-- 회사코드
				(SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.CO_CD) AS CO_CD_NM,
				X.GOODS_DIV, 	-- 품목구분
				(SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.GOODS_DIV) AS GOODS_DIV_NM,
				X.MATR_DIV,	-- 자재유형
				(SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.MATR_DIV) AS MATR_DIV_NM,
				X.MATR_GRP,	-- 자재그룹
				(SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.MATR_GRP) AS MATR_GRP_NM,
				X.MATR_NO,		-- 품번
				X.MATR_NM,		-- 품명
				X.MATR_CLNT_DIV,	-- 거래처분류
				(SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.MATR_CLNT_DIV) AS MATR_CLNT_DIV_NM,
				X.MATR_MAT,	-- 재질
				X.MATR_MAKR_NM,	-- Maker
				X.MATR_MNO,	-- 형번
				X.MATR_SPEC,	-- 규격
				X.MATR_SIZE,	-- 크기	
				X.MATR_TEST_DIV,	-- 입고검사구분
				(SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.MATR_TEST_DIV) AS MATR_TEST_DIV_NM,
				X.DLVR_RQM_DAY,		-- 리드타임 -> 19번 납품소요일자
				X.MIN_ORDRG_QTY,	-- 최소발주량
				X.MATR_SAFT_QTY,	-- 안전재고
				X.CREAT_ID,	-- 등록자
				(SELECT T.CREAT_ID FROM TB_CM06M01 T WHERE T.CREAT_ID = X.CREAT_ID) AS CREAT_NM,
				X.CREAT_PGM,		-- 생성프로그램ID	
				TO_CHAR(CREAT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS CREAT_DTTM, -- 등록일시
				X.UDT_ID,		-- 수정자
				(SELECT T.UDT_ID FROM TB_CM06M01 T WHERE T.UDT_ID = X.UDT_ID) AS UDT_NM,
				X.UDT_PGM,			-- 최종수정프로그램ID	
				TO_CHAR(UDT_DTTM, 'YYYY-MM-DD HH24:MI:SS') AS UDT_DTTM,	-- 수정일시
				X.MATR_WT,		-- 중량
				X.MATR_UNIT,	-- 관리단위
				(SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.MATR_UNIT) AS MATR_UNIT_NM,
				X.ORIGIN_NM,	-- 원산지
				X.MATR_DRW_NO,	-- 대표도번
				X.MATR_PURC_DIV,	-- 구매/외주
				(SELECT T.CODE_NM FROM TB_CM05M01 T WHERE T.CODE_ID = X.MATR_PURC_DIV) AS MATR_PURC_DIV_NM,
				X.MATR_STOCK_CD,	-- 재고관리여부
				X.DSGN_2D_MD,	-- 2D설계소요일
				X.DSGN_3D_MD,	-- 3D설계소요일
				X.AVRG_2D_MD,	-- 2D평균소요일
				X.AVRG_3D_MD,	-- 3D평균소요일
				X.PRDCTN_RQM_MD,	-- 최종생산소요일
				X.PRDCTN_AVRG_MD,	-- 평균생산소요일
				X.PCHS_CLNT_CD1,	-- 구매업체1
				X.PCHS_CLNT_PCT1,	-- 발주비율1 디폴트값 0 -> 구매업체1%
				X.PCHS_CLNT_CD2,	-- 구매업체2 
				X.PCHS_CLNT_PCT2,	-- 발주비율2 -> 구매업체2%
				X.PCHS_CLNT_CD3,	-- 구매업체3
				X.PCHS_CLNT_PCT3,	-- 발주비율3 -> 구매업체3%
				X.MATR_UPR,			-- 최종구매단가	
				X.MATR_AVRG_UPR,	-- 평균구매단가
				-- X.MATR_LAST_TRST_DT,
				TO_CHAR(X.MATR_LAST_TRST_DT, 'YYYY-MM-DD') AS MATR_LAST_TRST_DT, -- 최종거래일자
				X.DSGN_TRGT_YN,		-- 설계대상구분
				X.MATR_PART_NO,		-- 파트번호
				X.MATR_ATNT_CD,		-- 대체자재코드
				X.ETC_FIELD1,		-- 여분필드(고정)	
				X.ETC_FIELD2,		-- 여분필드(숫자)	
				X.ETC_FIELD3,		-- 여분필드(가변)	
				X.USE_YN,			-- 사용여부
				X.MATR_RMK			-- 비고
			FROM TB_BM05M01 X 
		) Y
	<!-- 	<if test="coCd != null and !coCd.equals('')">
            AND X.CO_CD = ${coCd}'                
       	</if>
       	<if test="goodsDiv != null and !goodsDiv.equals('')">
       		AND X.GOODS_DIV = ${goodsDiv}'
       	</if> -->
	</select>
	
	<insert id="insertBmMstr" parameterType="Map">
	<!-- 	
		<selectKey keyProperty="fileTrgtKey" resultType="String" order="BEFORE">
			SELECT SEQ_FILE_TRGT_KEY.NEXTVAL FROM DUAL
		</selectKey>
	 -->
		INSERT INTO TB_BM05M01 
		(
			FILE_TRGT_KEY,	-- 시퀀스 안씀
			CO_CD, -- 회사
			MATR_CD,
			MATR_NM,
			GOODS_DIV,
			MATR_CLNT_DIV,
			MATR_DIV,
			MATR_GRP,
			MATR_MAT,
			MATR_SIZE,
			MATR_SPEC,
			MATR_MAKR_NM,
			MATR_MNO,
			MATR_WT,
			MATR_UNIT,
			ORIGIN_NM,
			MATR_DRW_NO,
			MATR_TEST_DIV,
			DLVR_RQM_DAY,
			MATR_PURC_DIV,
			MIN_ORDRG_QTY,
			MATR_SAFT_QTY,
			MATR_STOCK_CD,
			DSGN_2D_MD,
			AVRG_2D_MD,
			DSGN_3D_MD,
			AVRG_3D_MD,
			PRDCTN_RQM_MD,
			PRDCTN_AVRG_MD,
			USE_YN,
			MATR_PART_NO,
			MATR_NO,
			PCHS_CLNT_CD1,
			PCHS_CLNT_PCT1,
			PCHS_CLNT_CD2,
			PCHS_CLNT_PCT2,
			PCHS_CLNT_CD3,
			PCHS_CLNT_PCT3,
			MATR_UPR,
			MATR_AVRG_UPR,
			MATR_RMK,
			MATR_LAST_TRST_DT,
			MATR_ATNT_CD,
			ETC_FIELD1,
			ETC_FIELD2,
			ETC_FIELD3,
			CREAT_ID,
			CREAT_PGM,
			CREAT_DTTM,
			UDT_ID,
			UDT_PGM,
			UDT_DTTM
		)
		VALUES
		(
			#{fileTrgtKey},
			#{coCd},
			#{matrCd},
			#{matrNm},
			#{goodsDiv},
			#{matrClntDiv},
			#{matrDiv},
			#{matrGrp},
			#{matrMat},
			#{matrSize},
			#{matrSpec},
			#{matrMakrNm},
			#{matrMno},
			#{matrWt},
			#{matrUnit},
			#{originNm},
			#{matrDrwNo},
			#{matrTestDiv},
			#{DlvrRqmDay},
			#{matrPurcDiv},
			#{minOrdrgQty},
			#{matrSaftQty},
			#{matrStockCd},
			#{dsgn2dMd},
			#{avrg2dMd},
			#{dsgn3dMd},
			#{avrg3dMd},
			#{prdctnRqmMd},
			#{prdctnAvrgMd},
			#{useYn},
			#{matrPartNo},
			#{matrNo},
			#{pchsClntCd1},
			#{pchsClntPct1},
			#{pchsClntCd2},
			#{pchsClntPct2},
			#{pchsClntCd3},
			#{pchsClntPct3},
			#{matrUpr},
			#{matrAvrgUpr},
			#{matrRmk},
			#{matrLastTrstDt},
			#{matrAtntCd},
			#{etcField1},
			#{etcField2},
			#{etcField3},
			#{creatId},
			#{creatPgm},
			#{creatDttm},
			#{udtId},
			#{udtPgm},
			#{udtDttm}
		)
	</insert>
<!-- 	
	<update id="updateBmMstr" parameterType="Map">
		UPDATE TB_BM05M01
		SET
		WHERE 
	
	</update>
	 -->
</mapper>