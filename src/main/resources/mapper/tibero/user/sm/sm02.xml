<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dksys.biz.user.sm.sm02.mapper.SM02Mapper">

	<!-- 매입관리 - 발주관리 조회 리스트  조회조건 -->
	<sql id="selectOrderListCondition">

		<!-- 회사코드 -->         
		<if test="coCd != null and !coCd.equals('')">
			AND A.CO_CD = #{coCd}   
		</if>
		<!-- sales Code -->
		<if test="salesCd != null and !salesCd.equals('')">
			AND A.SALES_CD = #{salesCd}   
		</if>		
		
		<!-- 발주일자 -->         
		<if test="ordrgDtFrom != null and !ordrgDtFrom.equals('')">
			<if test="ordrgDtTo != null and !ordrgDtTo.equals('')">
            			AND A.ORDRG_DT BETWEEN #{ordrgDtFrom} AND #{ordrgDtTo}
            		</if>   
		</if>	
		
		<!-- 구매처 -->         
		<if test="pchsClntCd != null and !pchsClntCd.equals('')">
			AND A.PCHS_CLNT_CD = #{pchsClntCd}   
		</if>
		<!-- 발주구분 -->
		<if test="ordrgdiv10 != null and !ordrgdiv10.equals('')">
			AND A.ORDRG_DIV10 = #{ordrgdiv10}   
		</if>				
		<!-- 용도구분 -->
		<if test="ordrgdiv20 != null and !ordrgdiv20.equals('')">
			AND A.ORDRG_DIV20 = #{ordrgdiv20}   
		</if>
		<!-- 특성구분 -->
		<if test="ordrgdiv30 != null and !ordrgdiv30.equals('')">
			AND A.ORDRG_DIV30 = #{ordrgdiv30}   
		</if>			
	</sql>	
		
	<!-- 기준관리 - 결재선 조회 리스트  카운트 -->
	<select id="selectOrderListCount" parameterType="Map" resultType="int">
		SELECT COUNT(*) 
			FROM TB_SM02M01 A
		WHERE 1=1
		<include refid="selectOrderListCondition"></include>
	</select>
	
	<!-- 발주관리 리스트  -->
	<select id="selectOrderList" parameterType="Map" resultType="camelMap">   
		/* No. 내림차순 */
		SELECT *
			FROM
			(
			SELECT X.*
					, ROWNUM AS RN
					FROM
						(
						SELECT A.FILE_TRGT_KEY
								, A.CO_CD
								, FN_CM05M01_CD_TO_NM(A.CO_CD) AS CO_CD_NM	/* 회사명명 */
								, A.ORDRG_NO
								, A.REQ_NO
								, A.SALES_CD
								, A.PCHS_CLNT_CD				/* 구매처cd */
                       			,
                       			(
                       				SELECT D.CLNT_NM
                       					FROM TB_BM02M01 D
                       				WHERE A.PCHS_CLNT_CD=D.CLNT_CD
                       			) AS PCHS_CLNT_NM		/* 구매처명 */
                       			, B.ORDRS_CLNT_CD				 /* 고객사 */
								, B.ORDRS_CLNT_NM				/* 고객사명 */
                       			, B.CLNT_PJT					 /* 고객사 PJT */
			                    , B.PRDT_CD			/* 제품구분 */
			                    , B.PRDT_NM			/* 제품구분명 */			                    
			                    , B.ITEM_DIV		/* 아이템 구분 */                		
			                    , FN_CM05M01_CD_TO_NM(B.ITEM_DIV) AS ITEM_DIV_NM	/* 아이템 구분명 */			
                       			, B.EQP_NM						/* 설비명 */
								, TO_CHAR(A.ORDRG_DT, 'YYYY-MM-DD') ORDRG_DT		/* 발주일자 */
								, A.ORDRG_DIV10					/* 발주구분 */
								, FN_CM05M01_CD_TO_NM(A.ORDRG_DIV10) AS ORDRG_DIV10_NM	/* 발주구분명 */
								, A.ORDRG_DIV20					/* 용도구분 */
								, FN_CM05M01_CD_TO_NM(A.ORDRG_DIV20) AS ORDRG_DIV20_NM	/* 용도구분명 */
								, A.ORDRG_DIV30					/* 특성구분 */
								, FN_CM05M01_CD_TO_NM(A.ORDRG_DIV30) AS ORDRG_DIV30_NM	/* 특성구분명 */								
								, A.CURR_CD						/* 통화단위 */
								, A.EXRATE
								, 
								(
									SELECT SUM(ORDRG_QTY)
										FROM TB_SM02D01 D
									WHERE A.CO_CD=D.CO_CD AND A.ORDRG_NO=D.ORDRG_NO AND A.SALES_CD=D.SALES_CD
								) AS ORDRG_QTY			/* 발주수량 */								
								, 
								(
									SELECT SUM(D.ORDRG_AMT)
										FROM TB_SM02D01 D
									WHERE A.CO_CD=D.CO_CD AND A.ORDRG_NO=D.ORDRG_NO AND A.SALES_CD=D.SALES_CD
								) AS ORDRG_AMT			/* 발주금액 */								
								, TO_CHAR(A.DUDT_DEQ_DT, 'YYYY-MM-DD') DUDT_DEQ_DT
								, A.ORDRG_RMK
								, A.IN_CMPLET_YN
								, A.ETC_FIELD1
								, A.ETC_FIELD2
								, A.ETC_FIELD3
								, A.CREAT_ID
								, A.CREAT_PGM
								, A.CREAT_DTTM
							FROM TB_SM02M01 A
							LEFT OUTER JOIN
							(
							 SELECT  X.CO_CD 					/* 회사코드 */
							 		, Y.ORDRS_CLNT_CD 			/* 고객사 */
			                        , A.CLNT_NM  AS ORDRS_CLNT_NM		/* 고객사명 */
			                        , X.SALES_CD
			                        , Y.CLNT_PJT		/* 고객사PJT */
			                        , X.PRDT_CD			/* 제품구분 */
			                        , E.PRDT_NM			/* 제품구분명 */
			                        , X.ITEM_DIV		/* 아이템 구분 */
			                        , X.EQP_NM			/* 설비명 */
			                  FROM TB_CR02D02 X		/* 수주상세 */
			                        INNER JOIN TB_CR02M01 Y ON(X.CO_CD = Y.CO_CD AND X.ORDRS_NO = Y.ORDRS_NO)	/* 수주마스터 */
			                        LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD /* 거래처마스터 */
			                        LEFT OUTER JOIN TB_BM01M01 E ON(X.PRDT_CD=E.PRDT_CD)							
							) B ON(A.CO_CD=B.CO_CD AND A.SALES_CD=B.SALES_CD)											
						WHERE 1=1						
						<include refid="selectOrderListCondition"></include>
						ORDER BY A.CO_CD DESC, A.ORDRG_NO DESC, A.CREAT_DTTM DESC, A.UDT_DTTM DESC		
						) X		
			)							
			WHERE 1=1
				AND RN BETWEEN ${firstIndex} AND ${lastIndex}
	</select>

	<!-- 기준관리 - 일정계획 등록 메인 화면 엑셀 조회 리스트  -->
	<select id="selectOrderExcelList" parameterType="Map" resultType="camelMap">   
		/* No. 내림차순 */
		SELECT *
			FROM
			(
			SELECT X.*
					, ROWNUM AS RN
					FROM
						(
						SELECT A.FILE_TRGT_KEY
								, A.CO_CD
								, A.ORDRG_NO
								, A.REQ_NO
								, A.SALES_CD
								, A.PCHS_CLNT_CD				/* 구매처cd */
                       			,
                       			(
                       				SELECT D.CLNT_NM
                       					FROM TB_BM02M01 D
                       				WHERE A.PCHS_CLNT_CD=D.CLNT_CD
                       			) AS PCHS_CLNT_NM		/* 구매처명 */
                       			, B.ORDRS_CLNT_CD				 /* 고객사 */
								, B.ORDRS_CLNT_NM				/* 고객사명 */
                       			, B.CLNT_PJT					 /* 고객사 PJT */
			                    , B.PRDT_CD			/* 제품구분 */
			                    , B.PRDT_NM			/* 제품구분명 */			                    
			                    , B.ITEM_DIV		/* 아이템 구분 */                		
			                    , FN_CM05M01_CD_TO_NM(B.ITEM_DIV) AS ITEM_DIV_NM	/* 아이템 구분명 */			
                       			, B.EQP_NM						/* 설비명 */
								, TO_CHAR(A.ORDRG_DT, 'YYYY-MM-DD') ORDRG_DT		/* 발주일자 */
								, A.ORDRG_DIV10					/* 발주구분 */
								, FN_CM05M01_CD_TO_NM(A.ORDRG_DIV10) AS ORDRG_DIV10_NM	/* 발주구분명 */
								, A.ORDRG_DIV20					/* 용도구분 */
								, FN_CM05M01_CD_TO_NM(A.ORDRG_DIV20) AS ORDRG_DIV20_NM	/* 용도구분명 */
								, A.ORDRG_DIV30					/* 특성구분 */
								, FN_CM05M01_CD_TO_NM(A.ORDRG_DIV30) AS ORDRG_DIV30_NM	/* 특성구분명 */								
								, A.CURR_CD						/* 통화단위 */
								, A.EXRATE
								, 
								(
									SELECT SUM(ORDRG_QTY)
										FROM TB_SM02D01 D
									WHERE A.CO_CD=D.CO_CD AND A.ORDRG_NO=D.ORDRG_NO AND A.SALES_CD=D.SALES_CD
								) AS ORDRG_QTY			/* 발주수량 */								
								, 
								(
									SELECT SUM(D.ORDRG_AMT)
										FROM TB_SM02D01 D
									WHERE A.CO_CD=D.CO_CD AND A.ORDRG_NO=D.ORDRG_NO AND A.SALES_CD=D.SALES_CD
								) AS ORDRG_AMT			/* 발주금액 */								
								, TO_CHAR(A.DUDT_DEQ_DT, 'YYYY-MM-DD') DUDT_DEQ_DT
								, A.ORDRG_RMK
								, A.IN_CMPLET_YN
								, A.ETC_FIELD1
								, A.ETC_FIELD2
								, A.ETC_FIELD3
								, A.CREAT_ID
								, A.CREAT_PGM
								, A.CREAT_DTTM
							FROM TB_SM02M01 A
							LEFT OUTER JOIN
							(
							 SELECT  X.CO_CD 					/* 회사코드 */
							 		, Y.ORDRS_CLNT_CD 			/* 고객사 */
			                        , A.CLNT_NM  AS ORDRS_CLNT_NM		/* 고객사명 */
			                        , X.SALES_CD
			                        , Y.CLNT_PJT		/* 고객사PJT */
			                        , X.PRDT_CD			/* 제품구분 */
			                        , E.PRDT_NM			/* 제품구분명 */
			                        , X.ITEM_DIV		/* 아이템 구분 */
			                        , X.EQP_NM			/* 설비명 */
			                  FROM TB_CR02D02 X		/* 수주상세 */
			                        INNER JOIN TB_CR02M01 Y ON(X.CO_CD = Y.CO_CD AND X.ORDRS_NO = Y.ORDRS_NO)	/* 수주마스터 */
			                        LEFT OUTER JOIN TB_BM02M01 A ON Y.ORDRS_CLNT_CD = A.CLNT_CD /* 거래처마스터 */
			                        LEFT OUTER JOIN TB_BM01M01 E ON(X.PRDT_CD=E.PRDT_CD)							
							) B ON(A.CO_CD=B.CO_CD AND A.SALES_CD=B.SALES_CD)														
						WHERE 1=1								
						<include refid="selectOrderListCondition"></include>
						ORDER BY A.CO_CD DESC, A.ORDRG_NO DESC, A.CREAT_DTTM DESC, A.UDT_DTTM DESC		
						) X		
			)							
			WHERE 1=1
			/* 엑셀은 전체 조회 */
	</select>
	
	<!--  file target key -->
	<select id="selectMaxTrgtKey" parameterType="Map" resultType="int">
    	SELECT NVL(MAX(TO_NUMBER(FILE_TRGT_KEY)),0) + 1 FROM TB_SM02M01
	</select>	
	
	<!-- 발주번호 max -->	
	<select id="selectMaxOrdrgNo" parameterType="Map" resultType="String">
		SELECT NVL(MAX_ORDRG_NO, 'BAL'||TO_CHAR(SYSDATE, 'YY')||'00001') AS MAX_ORDRG_NO
			FROM
			(
			SELECT DISTINCT DECODE( INSTR(ORDRG_NO, 'BAL'||TO_CHAR(SYSDATE, 'YY')), 0, 'BAL'||TO_CHAR(SYSDATE, 'YY')||'00001'
							, 'BAL' || MAX( TO_CHAR(SYSDATE, 'YY')|| LPAD( SUBSTRING(ORDRG_NO, -5)+1, 5, '0') ) OVER()
						  ) AS MAX_ORDRG_NO
				FROM TB_SM02M01
			UNION ALL
			SELECT NULL AS MAX_ORDRG_NO
				FROM DUAL		
			)		
			WHERE MAX_ORDRG_NO IS NOT NULL OR ROWNUM = 1	
	</select>		
	
	<!-- 발주 DETAIL SELECT -->
	<select id="selectOrderDetailList" parameterType="Map" resultType="camelMap">	
		SELECT CO_CD
			, ORDRG_NO
			, ORDRG_SEQ
			, SALES_CD
			, MATR_SEQ
			, UPPER_CD
			, LOWER_CD
			, DSGN_NO
			, MATR_CD
			, FN_CM05M01_CD_TO_NM(D.MATR_TEST_DIV) MATR_TEST_DIV    
			, ORDRG_PRC			/* 발주단가		*/
			, ORDRG_QTY			/* 발주수량 */
			, ORDRG_AMT			/* 발주금액  */
			, TO_CHAR(D.DUDT_DEQ_DT, 'YYYY-MM-DD') DUDT_DEQ_DT
			, TO_CHAR(D.DUDT_INTEND_DT, 'YYYY-MM-DD') DUDT_INTEND_DT
			, ORDRG_DTL_RMK
			, ETC_FIELD1
			, ETC_FIELD2
			, ETC_FIELD3
			, CREAT_ID
			, CREAT_PGM
			, CREAT_DTTM
			, UDT_ID
			, UDT_PGM
			, UDT_DTTM
			, IN_CMPLET_YN
	        , D.WH_CD AS MATR_WH_CD		/* 입고창고  */
	        , FN_CM05M01_CD_TO_NM(D.WH_CD) AS MATR_WH_NM		/* 입고창고  */		
	        , 
	        (
	        	SELECT NVL(SUM(ORDRG_QTY), 0) 
	        		FROM TB_SM02D01 CC
	        	WHERE D.CO_CD = CC.CO_CD 
	        		AND D.ORDRG_NO != CC.ORDRG_NO
	        		AND D.SALES_CD = CC.SALES_CD 
	        		AND D.LOWER_CD = CC.LOWER_CD
	        		AND D.MATR_CD = CC.MATR_CD
	        ) AS PRE_BOM_QTY			/* 구매 BOM 기발주 수량 임시 */      
	        ,
	        (
	        	SELECT CC.BOM_QTY			/* 구매 BOM 수량 */
	        		FROM TB_SM01D01 CC 						        		
				WHERE 1=1
	        		AND D.SALES_CD = CC.SALES_CD AND D.MATR_SEQ = CC.MATR_SEQ
        			AND D.UPPER_CD=CC.UPPER_CD  AND D.LOWER_CD=CC.LOWER_CD       		
	        ) BOM_QTY /* 구매 BOM 수량 */
	        , 'Y' AS USER_CHK_V		/* 수정시 CHK값 SET */
		FROM TB_SM02D01 D
		WHERE 1=1
		<if test="coCd != null and !coCd.equals('')">
			AND D.CO_CD = #{coCd}   
		</if>		
		<if test="ordrgNo != null and !ordrgNo.equals('')">
			AND D.ORDRG_NO = #{ordrgNo}   
		</if>	
		<if test="ordrgSeq != null and !ordrgSeq.equals('')">
			AND D.ORDRG_SEQ = #{ordrgSeq}   
		</if>		
		<if test="salesCd != null and !salesCd.equals('')">
			AND D.SALES_CD = #{salesCd}   
		</if>							
	</select>
	
	<!-- bom detail list -->
	<select id="selectBomDetailList" parameterType="Map" resultType="camelMap">
        SELECT T.FILE_TRGT_KEY
        , T.LVL
        , T.CO_CD
        , FN_CM05M01_CD_TO_NM(T.CO_CD) CO_NM
		, T.SALES_CD
		, T.PART_NO
		, T.UNIT_NO
		, T.REV_NO
		, T.DSGN_NO
		, T.UPPER_CD
		, T.LOWER_CD
		, D.MATR_SEQ
		, D.ORDRG_DIV_10
		, D.ORDRG_DIV_20
		, D.NEXT_PRCSN_NM
		, D.DLVPLC_NM
		, D.MATR_CD
		, D.MATR_NM
		, D.GOODS_DIV
		, D.MATR_CLNT_DIV
		, D.MATR_DIV
		, D.MATR_GRP
		, D.MATR_MAT
		, D.MATR_SIZE
		, D.MATR_SPEC
		, D.MATR_MAKR_NM
		, D.MATR_MNO
		, D.MATR_WT
		, D.MATR_UNIT
		, D.ORIGIN_NM
		, D.MATR_DRW_NO
		, FN_CM05M01_CD_TO_NM(D.MATR_TEST_DIV) MATR_TEST_DIV    
		, D.DLVR_RQM_DAY
		, D.MATR_PURC_DIV
		, D.MIN_ORDRG_QTY
		, D.MATR_SAFT_QTY
		, D.MATR_STOCK_CD
		, D.DSGN_2D_MD
		, D.AVRG_2D_MD
		, D.DSGN_3D_MD
		, D.AVRG_3D_MD
		, D.PRDCTN_RQM_MD
		, D.PRDCTN_AVRG_MD
		, D.USE_YN
		, D.MATR_PART_NO
		, D.PCHS_CLNT_CD1
		, D.PCHS_CLNT_PCT1
		, D.PCHS_CLNT_CD2
		, D.PCHS_CLNT_PCT2
		, D.PCHS_CLNT_CD3
		, D.PCHS_CLNT_PCT3
		, D.MATR_UPR
		, D.MATR_AVRG_UPR
		, D.MATR_RMK
		, D.MATR_LAST_TRST_DT
		, D.MATR_ATNT_CD
		, D.MATR_NO
		, T.ETC_FIELD1
		, T.ETC_FIELD2
		, T.ETC_FIELD3
        , T.CREAT_ID
        , (SELECT NAME FROM TB_CM06M01 WHERE ID = T.CREAT_ID) AS CREAT_NM
        , TO_CHAR(T.CREAT_DTTM,'YYYY-MM-DD HH24:MM:SS') AS CREAT_DTTM
        , T.UDT_ID
        , (SELECT NAME FROM TB_CM06M01 WHERE ID = T.UDT_ID) AS UDT_NM
        , TO_CHAR(T.UDT_DTTM,'YYYY-MM-DD HH24:MM:SS') AS UDT_DTTM
        , F_CO_DEFAULT_WH('GUN', 'GDSGRPWHDIV01', 'CD') AS MATR_WH_CD		/* 입고창고 하드코딩값 */
        , F_CO_DEFAULT_WH('GUN', 'GDSGRPWHDIV01', 'NM') AS MATR_WH_NM		/* 입고창고 하드코딩값 */
        , D.BOM_QTY /* 구매 BOM 수량 */
        , 
        (
        	SELECT NVL(SUM(ORDRG_QTY), 0) 
        		FROM TB_SM02D01 CC
        	WHERE D.CO_CD = CC.CO_CD 
	        		AND D.SALES_CD = CC.SALES_CD 
	        		AND D.LOWER_CD = CC.LOWER_CD
	        		AND D.MATR_CD = CC.MATR_CD        		
        ) AS PRE_BOM_QTY			/* 구매 BOM 기발주 수량 임시 */        
        FROM
  		( SELECT X1.*, LEVEL AS LVL FROM TB_SM01M01 X1
           /* START WITH X1.UPPER_CD = '.' AND X1.SALES_CD = #{salesCd} */
           START WITH X1.UPPER_CD = 'top' AND X1.SALES_CD = #{salesCd}
          CONNECT BY PRIOR X1.LOWER_CD = X1.UPPER_CD
        ) T
        LEFT OUTER JOIN TB_SM01D01 D
		ON T.CO_CD = D.CO_CD AND T.SALES_CD = D.SALES_CD AND T.UPPER_CD = D.UPPER_CD AND T.LOWER_CD = D.LOWER_CD
        LEFT OUTER JOIN
        ( SELECT T1.CO_CD
		        , T2.SALES_CD
		        , T2.PRDT_CD
		        , (SELECT X.PRDT_NM FROM TB_BM01M01 X WHERE X.PRDT_CD = T2.PRDT_CD) AS PRDT_NM
		        , T2.ITEM_DIV
		        , FN_CM05M01_CD_TO_NM(T2.ITEM_DIV) AS ITEM_DIV_NM
		        , T1.CLNT_PJT
		        , T2.EQP_NM
		        , T3.CLNT_NM
		        FROM TB_CR02M01 AS T1
		        JOIN TB_CR02D02 AS T2 ON T1.CO_CD = T2.CO_CD AND T1.ORDRS_NO = T2.ORDRS_NO
		        LEFT JOIN TB_BM02M01 AS T3 ON T3.CLNT_CD = T1.ORDRS_CLNT_CD
        ) A
        ON T.CO_CD = A.CO_CD AND T.SALES_CD = A.SALES_CD
		WHERE 1=1	
		ORDER BY T.CO_CD, NVL(T.PART_NO,'0'), NVL(T.UNIT_NO,'0'), NVL(T.REV_NO,'0'),T.LOWER_CD, T.UPPER_CD
		         , D.MATR_SEQ
	</select>	
	
	<!-- 발주관리 - 발주마스터 등록 -->
	<insert id="insertOrderMaster" parameterType="Map">	
		INSERT INTO TB_SM02M01
	      (
			FILE_TRGT_KEY
			, CO_CD
			, ORDRG_NO
			, REQ_NO
			, SALES_CD
			, PCHS_CLNT_CD
			, ORDRG_DT
			, ORDRG_DIV10
			, ORDRG_DIV20
			, ORDRG_DIV30
			, CURR_CD
			, EXRATE
			, ORDRG_AMT
			, DUDT_DEQ_DT
			, ORDRG_RMK
			, IN_CMPLET_YN
			, ETC_FIELD1
			, ETC_FIELD2
			, ETC_FIELD3
			, CREAT_ID
			, CREAT_PGM
			, CREAT_DTTM
	      )
	    VALUES
	    (
			#{fileTrgtKey}
			, #{coCd}
			, #{maxOrdrgNo}
			, #{reqNo,  jdbcType=VARCHAR}
			, #{salesCd,  jdbcType=VARCHAR}
			, #{pchsClntCd,  jdbcType=VARCHAR}
			, #{ordrgDt,  jdbcType=VARCHAR}
			, #{ordrgDiv10,  jdbcType=VARCHAR}
			, #{ordrgDiv20,  jdbcType=VARCHAR}
			, #{ordrgDiv30,  jdbcType=VARCHAR}
			, #{currCd,  jdbcType=VARCHAR}
			, #{exrate,  jdbcType=VARCHAR}
			, #{ordrgAmt,  jdbcType=VARCHAR}
			, #{dudtDeqDt,  jdbcType=VARCHAR}
			, #{ordrgRmk,  jdbcType=VARCHAR}
			, #{inCmpletYn,  jdbcType=VARCHAR}
			, #{etcField1,  jdbcType=VARCHAR}
			, #{etcField2,  jdbcType=VARCHAR}
			, #{etcField3,  jdbcType=VARCHAR}
			, #{userId}
			, #{pgmId}
			, SYSDATE
	    )
	</insert>	
	
	<!-- 발주 detail 등록 -->
	<insert id="insertOrderDetail" parameterType="Map">

	    <selectKey keyProperty="ordrgSeq" resultType="String" order="BEFORE">
			SELECT NVL(MAX(ORDRG_SEQ)+1, 1) FROM TB_SM02D01 
				WHERE CO_CD = #{coCd}
						AND ORDRG_NO = #{maxOrdrgNo}
	    </selectKey>		    
	    INSERT INTO TB_SM02D01
	    (
			CO_CD
			, ORDRG_NO
			, ORDRG_SEQ
			, SALES_CD
			, MATR_SEQ
			, UPPER_CD
			, LOWER_CD
			, DSGN_NO 
			, MATR_CD
			, MATR_TEST_DIV
			, ORDRG_PRC
			, ORDRG_QTY
			, ORDRG_AMT
			, DUDT_DEQ_DT
			, DUDT_INTEND_DT
			, ORDRG_DTL_RMK
			, ETC_FIELD1
			, ETC_FIELD2
			, ETC_FIELD3
			, CREAT_ID
			, CREAT_PGM
			, CREAT_DTTM
			, IN_CMPLET_YN
			, WH_CD			
	      )
	    VALUES
	    (
			#{coCd}
			, #{maxOrdrgNo}
			, #{ordrgSeq}
			, #{salesCd}
			, #{matrSeq}
			, #{upperCd}
			, #{lowerCd}
			, #{dsgnNo}
			, #{matrCd}
			, #{matrTestDiv}			
			, #{ordrgPrc,  jdbcType=VARCHAR}	  
			, #{ordrgQty,  jdbcType=VARCHAR}	  
			, #{ordrgAmt,  jdbcType=VARCHAR}	   
			, #{dudtDeqDt,  jdbcType=VARCHAR}	  
			, #{dudtIntendDt,  jdbcType=VARCHAR}	  
			, #{ordrgDtlRmk,  jdbcType=VARCHAR}	   
			, #{etcField1,  jdbcType=VARCHAR}
			, #{etcField2,  jdbcType=VARCHAR}
			, #{etcField3,  jdbcType=VARCHAR}
			, #{userId}
			, #{pgmId}
			, SYSDATE
			, #{inCmpletYn,			jdbcType=VARCHAR}			
			, #{matrWhCd,			jdbcType=VARCHAR}	 			   
	    )
	</insert>	
	
	<!-- 발주관리 마스터 수정 -->
	<update id="updateOrderMaster" parameterType="Map">
		UPDATE TB_SM02M01
			SET
		REQ_NO = #{reqNo} 
		, SALES_CD = #{salesCd}
		, PCHS_CLNT_CD = #{pchsClntCd}
		, ORDRG_DT = #{ordrgDt}
		, ORDRG_DIV10 = #{ordrgDiv10}
		, ORDRG_DIV20 = #{ordrgDiv20}
		, ORDRG_DIV30 = #{ordrgDiv30}
		, CURR_CD = #{currCd}
		, EXRATE = #{exrate}
		, ORDRG_AMT = #{ordrgAmt}
		, DUDT_DEQ_DT = #{dudtDeqDt}
		, ORDRG_RMK = #{ordrgRmk,			jdbcType=VARCHAR}	 	
		, IN_CMPLET_YN = #{inCmpletYn,			jdbcType=VARCHAR}
		, UDT_ID = #{userId}
		, UDT_PGM = #{pgmId}
		, UDT_DTTM = SYSDATE
		WHERE FILE_TRGT_KEY = #{fileTrgtKey}
			AND CO_CD = #{coCd}
			AND ORDRG_NO = #{ordrgNo}
	</update>
		
	<!-- 발주관리 상세 수정 -->
	<update id="updateOrderDetail" parameterType="Map">
		UPDATE TB_SM02D01
			SET 
		SALES_CD = #{salesCd}
		, MATR_SEQ = #{matrSeq}
		, UPPER_CD = #{upperCd}
		, LOWER_CD = #{lowerCd}
		, DSGN_NO = #{dsgnNo}
		, MATR_CD = #{matrCd}
		, MATR_TEST_DIV = #{matrTestDiv}
		, ORDRG_PRC = #{ordrgPrc}
		, ORDRG_QTY = #{ordrgQty}
		, ORDRG_AMT = #{ordrgAmt}
		, DUDT_DEQ_DT = #{dudtDeqDt}
		, DUDT_INTEND_DT = #{dudtIntendDt}
		, ORDRG_DTL_RMK = #{ordrgDtlRmk,			jdbcType=VARCHAR}	
		, UDT_ID = #{userId}
		, UDT_PGM = #{pgmId}
		, UDT_DTTM = SYSDATE	
		, WH_CD = #{matrWhCd}		
		WHERE CO_CD = #{coCd} 
		 AND ORDRG_NO = #{ordrgNo} 
		 AND ORDRG_SEQ = #{ordrgSeq} 
	</update>
	
		
	
	<!-- 발주 디테일  삭제 -->         
	<delete id="deleteOrderDetail" parameterType="Map">
		DELETE 
			FROM TB_SM02D01
		WHERE 1=1
			AND CO_CD = #{coCd}
			AND ORDRG_NO = #{ordrgNo}
			AND ORDRG_SEQ = #{ordrgSeq}	
	</delete>	
		
 </mapper>